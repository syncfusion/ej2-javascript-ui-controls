this.ej=this.ej||{},this.ej.pivotview=function(exports,ej.base,ej.data,ej.popups,ej.grids,ej.navigations,ej.inputs,ej.dropdowns,ej.excelexport,ej.pdfexport,ej.charts,ej.calendars,ej.buttons){"use strict";var PivotUtil=function(){function e(){}return e.getType=function(e){return e&&e.getDay?e.getHours()>0||e.getMinutes()>0||e.getSeconds()>0||e.getMilliseconds()>0?"datetime":"date":typeof e},e.resetTime=function(e){return e.setHours(0,0,0,0),e},e.getClonedData=function(e){for(var t=[],i=Object.keys(e[0]),a=0,r=e;a<r.length;a++){for(var o=r[a],n=0,s={};n<i.length;)s[i[n]]=o[i[n]],n++;t.push(s)}return t},e}(),PivotEngine=function(){function PivotEngine(){this.valueContent=[],this.formatFields={},this.calculatedFields={},this.calculatedFormulas={},this.valueAxis=0,this.saveDataHeaders={},this.columnCount=0,this.rowCount=0,this.colFirstLvl=0,this.rowFirstLvl=0,this.rowStartPos=0,this.colStartPos=0,this.enableValueSorting=!1,this.headerCollection={rowHeaders:[],columnHeaders:[],rowHeadersCount:0,columnHeadersCount:0},this.rMembers=[],this.cMembers=[],this.valueMatrix=[],this.indexMatrix=[],this.memberCnt=-1,this.pageInLimit=!1,this.endPos=0,this.removeCount=0,this.colHdrBufferCalculated=!1,this.colValuesLength=1,this.rowValuesLength=1,this.slicedHeaders=[],this.fieldFilterMem={},this.filterPosObj={},this.selectedHeaders={selectedHeader:[],values:[]},this.rawIndexObject={},this.isEditing=!1,this.data=[],this.frameHeaderObjectsCollection=!1,this.headerObjectsCollection={}}return PivotEngine.prototype.renderEngine=function(e,t){this.formatFields={},this.calculatedFields={},this.calculatedFormulas={},this.valueAxis=0,this.saveDataHeaders={},this.columnCount=0,this.rowCount=0,this.colFirstLvl=0,this.rowFirstLvl=0,this.rowStartPos=0,this.colStartPos=0,this.enableValueSorting=!1,this.headerCollection={rowHeaders:[],columnHeaders:[],rowHeadersCount:0,columnHeadersCount:0},this.valueMatrix=[],this.indexMatrix=[],this.rMembers=[],this.cMembers=[],this.memberCnt=-1,this.pageInLimit=!1,this.endPos=0,this.removeCount=0,this.colHdrBufferCalculated=!1,this.colValuesLength=1,this.rowValuesLength=1,this.slicedHeaders=[],this.fieldFilterMem={},this.filterPosObj={},this.selectedHeaders={selectedHeader:[],values:[]},this.rawIndexObject={},this.isEditing=!1;var i;this.globalize=new ej2Base.Internationalization,this.localeObj=t?t.localeObj:void 0,this.enableSort=e.enableSorting,this.alwaysShowValueHeader=e.alwaysShowValueHeader,this.showSubTotals=!!ej2Base.isNullOrUndefined(e.showSubTotals)||e.showSubTotals,this.showRowSubTotals=!!ej2Base.isNullOrUndefined(e.showRowSubTotals)||e.showRowSubTotals,this.showColumnSubTotals=!!ej2Base.isNullOrUndefined(e.showColumnSubTotals)||e.showColumnSubTotals,this.showGrandTotals=!!ej2Base.isNullOrUndefined(e.showGrandTotals)||e.showGrandTotals,this.showRowGrandTotals=!!ej2Base.isNullOrUndefined(e.showRowGrandTotals)||e.showRowGrandTotals,this.showColumnGrandTotals=!!ej2Base.isNullOrUndefined(e.showColumnGrandTotals)||e.showColumnGrandTotals,this.allowValueFilter=e.allowValueFilter,this.isValueFilterEnabled=!1,this.enableValueSorting=!!t&&t.enableValueSorting,this.valueContent=[],e.data&&e.data[0]&&(this.fields=Object.keys(e.data[0]),this.rows=e.rows?e.rows:[],this.columns=e.columns?e.columns:[],this.filters=e.filters?e.filters:[],this.formats=e.formatSettings?e.formatSettings:[],this.values=e.values?e.values:[],this.groups=e.groupSettings?e.groupSettings:[],this.calculatedFieldSettings=e.calculatedFieldSettings?e.calculatedFieldSettings:[],this.enableSort=void 0===e.enableSorting||e.enableSorting,i=this.getGroupData(e.data),this.data=e.data,this.validateFilters(e),this.isExpandAll=!(!this.isValueFiltersAvail||!e.allowValueFilter)||e.expandAll,this.drilledMembers=e.drilledMembers?this.isValueFiltersAvail&&e.allowValueFilter?[]:e.drilledMembers:[],this.isMutiMeasures=this.values.length>1,this.valueAxis="row"===e.valueAxis?1:0,this.emptyCellTextContent=e.emptyCellsTextContent?e.emptyCellsTextContent:"",this.rowValuesLength=1===this.valueAxis?this.values.length:1,this.colValuesLength=0===this.valueAxis?this.values.length:1,this.valueSortSettings=e.valueSortSettings||{sortOrder:"None",headerDelimiter:".",headerText:"",columnIndex:void 0},this.valueSortData=[],this.pageSettings=t?t.pageSettings?t.pageSettings:this.pageSettings:void 0,this.savedFieldList=t?t.savedFieldList:void 0,this.isDrillThrough=!!t&&(!!t.isDrillThrough&&t.isDrillThrough),this.getFieldList(i,this.enableSort,e.allowValueFilter),this.fillFieldMembers(e.data,this.indexMatrix),this.updateSortSettings(e.sortSettings,this.enableSort),this.valueMatrix=this.generateValueMatrix(e.data),this.filterMembers=[],this.updateFilterMembers(e),this.generateGridData(e))},PivotEngine.prototype.getGroupData=function(e){for(var t=e[0],i=this,a=0,r=this.groups;a<r.length;a++){var o=function(a){var r=a.name;if(!(i.fields.indexOf(r)>-1))return{value:t};var o={};if("Number"===a.type){if("number"!==PivotUtil.getType(t[r]))return{value:t};a.rangeInterval&&e.sort(function(e,t){return e[r]>t[r]?1:t[r]>e[r]?-1:0})}for(var n=e.length;n--;){var s=e[n];if(s[r]&&"Date"===a.type){var l=new Date(s[r].toString());if(!ej2Base.isNullOrUndefined(l)&&a.groupInterval.length>0){for(var d=!1,p=0,h=a.groupInterval;p<h.length;p++){var c=h[p];d=!0;var u=i.getRange(a,l.getTime()),g=PivotUtil.resetTime(new Date);switch(c){case"Years":o[v=r+"_years"]=c,s[v]=u?void 0:new Date(g.setFullYear(l.getFullYear())).toString();break;case"Quarters":o[v=r+"_quarters"]=c;var m=Math.ceil((l.getMonth()+1)/3);s[v]=u?void 0:"Qtr"+m.toString();break;case"Months":o[v=r+"_months"]=c,s[v]=u?void 0:new Date(g.setMonth(l.getMonth(),g.getDate())).toString();break;case"Days":o[v=r+"_days"]=c,s[v]=u?void 0:new Date(g.setMonth(l.getMonth(),l.getDate())).toString();break;case"Hours":o[v=r+"_hours"]=c,s[v]=u?void 0:new Date(g.setHours(l.getHours())).toString();break;case"Minutes":o[v=r+"_minutes"]=c,s[v]=u?void 0:new Date(g.setMinutes(l.getMinutes())).toString();break;case"Seconds":var v=r+"_seconds";o[v]=c,s[v]=u?void 0:new Date(g.setSeconds(l.getSeconds())).toString()}}d&&delete s[r]}}else{u=i.getRange(a,s[r]);s[r]=u?void 0:s[r]}for(var f=[],y=0,S=G=Object.keys(s);y<S.length;y++){z=S[y];f.push(!!s[z])}t=-1===f.indexOf(!1)&&G.length===Object.keys(e[0]).length?s:t}if("Date"===a.type){for(var b=[i.rows,i.columns,i.values,i.filters],C=Object.keys(o),x=Object.keys(C).length,w=void 0,j=0,E=b;j<E.length;j++){var T=E[j];if(T){for(var B=T.length,D=0;D<B;){if(T[D].name===r){var _=T[D];for(T.splice(D,1);x--;){w=o[C[x]];var L={name:C[x],caption:(i.localeObj?i.localeObj.getConstant(w):w)+" ("+r+")",type:"Count",showNoDataItems:_.showNoDataItems,baseField:_.baseField,baseItem:_.baseItem};T.splice(D,0,L)}break}D++}break}}for(x=Object.keys(C).length;x--;){w=o[C[x]];var O=new ej2Data.DataManager({json:i.formats}).executeLocal((new ej2Data.Query).where("name","equal",C[x]))[0];if("Quarters"!==w&&!O){var P={name:C[x],type:["Years","Months","Days"].indexOf(w)>-1?"date":"time",format:"Years"===w?"yyyy":"Months"===w?"MMM":"Days"===w?"d-MMM":"Hours"===w?"hh a":"Minutes"===w?":mm":"Seconds"===w?":ss":void 0};i.formats.push(P)}}}else if("Number"===a.type&&a.rangeInterval){for(var M=void 0,A=void 0,I=void 0,N=void 0,R=[],F=[],k=e.length,B=0;B<k;)F.push(e[B][r]),e[B][r]&&-1===R.indexOf(e[B][r])&&R.push(e[B][r]),B++;for(var V=Math.max.apply(Math,R),D=R[0],q=V;D<q;D++)if(F.indexOf(D)<0){var H=i.frameData(e[0]);H[r]=D;var U=F.lastIndexOf(D-1);F.splice(U+1,0,D),e.splice(U+1,0,H)}for(k=e.length,B=0;B<k;){if(e[B]&&e[B][r]){N=(I=e[B][r])+(a.rangeInterval-1),M=M||I,A=A?A>V?V:A:N>V?V:N,I>=M&&I<=A?e[B][r]=M===A?M.toString():M.toString()+"-"+A.toString():I>A&&I===A+1&&(A=(M=A+1)+(a.rangeInterval-1)>V?V:M+(a.rangeInterval-1),e[B][r]=M===A?M.toString():M.toString()+"-"+A.toString());for(var G=Object.keys(e[B]),f=[],$=0,W=G;$<W.length;$++){var z=W[$];f.push(!!e[B][z])}t=-1===f.indexOf(!1)&&G.length===Object.keys(e[0]).length?e[B]:t}B++}for(var X=0,Q=b=[i.rows,i.columns,i.values,i.filters];X<Q.length;X++){var Y=Q[X],K=new ej2Data.DataManager({json:Y}).executeLocal((new ej2Data.Query).where("name","equal",r))[0];K&&((K=K.properties?K.properties:K).type="Count")}for(var D=0,Z=i.formats.length;D<Z;D++)if(i.formats[D].name===r){i.formats.splice(D,1);break}}}(r[a]);if("object"==typeof o)return o.value}return this.fields=Object.keys(t),t},PivotEngine.prototype.frameData=function(e){for(var t=Object.keys(e),i=0,a={};i<t.length;)a[t[i]]=void 0,i++;return a},PivotEngine.prototype.getRange=function(e,t){var i;if("Date"===e.type){var a=new Date(t);i=!!(e.startingAt&&a.getTime()<e.startingAt.getTime()||e.endingAt&&a.getTime()>e.endingAt.getTime())}else i=!!(e.startingAt&&t<e.startingAt||e.endingAt&&t>e.endingAt);return i},PivotEngine.prototype.getFormattedFields=function(e){for(var t=this.formats.length;t--;)this.formatFields[this.formats[t].name]=this.formats[t]},PivotEngine.prototype.getFieldList=function(e,t,i){var a,r=this.fields,o=ej2Base.extend([],this.rows,null,!0);o=o.concat(this.columns,this.values,this.filters),this.getFormattedFields(o),this.getCalculatedField(r);var n=(r=this.fields).length;if(this.savedFieldList)for(this.fieldList=this.savedFieldList;n--;){s=r[n];this.fieldList[s]?(this.fieldList[s].isSelected=!1,this.fieldList[s].index=n,this.fieldList[s].filter=[],this.fieldList[s].isExcelFilter=!1,this.fieldList[s].filterType="",this.isValueFiltersAvail&&i&&(this.fieldList[s].dateMember=[],this.fieldList[s].formattedMembers={},this.fieldList[s].members={})):this.fieldList[s]={id:s,caption:s,type:void 0===a||"undefined"===a?"number":a,filterType:"",index:n,filter:[],sort:t?"Ascending":"None",isSelected:!1}}else for(;n--;){var s=r[n];a=PivotUtil.getType(e[s]),this.fieldList||(this.fieldList={}),this.fieldList[s]={id:s,caption:s,type:void 0===a||"undefined"===a?"number":a,filterType:"",index:n,filter:[],sort:t?"Ascending":"None",isSelected:!1}}this.updateTreeViewData(o)},PivotEngine.prototype.updateFieldList=function(e){for(var t=this.fields,i=t.length;i--;)this.fieldList[t[i]].isExcelFilter=e[t[i]].isExcelFilter},PivotEngine.prototype.updateTreeViewData=function(e){for(var t=e.length,i=this.calculatedFieldSettings.length;t--;)if(this.fieldList[e[t].name]){var a=this.fieldList[e[t].name];a.caption=e[t].caption?e[t].caption:e[t].name,a.isSelected=!0,a.showNoDataItems=e[t].showNoDataItems,a.aggregateType=e[t].type,a.baseField=e[t].baseField,a.baseItem=e[t].baseItem}for(;i--;)this.fieldList[this.calculatedFieldSettings[i].name].aggregateType="CalculatedField",this.fieldList[this.calculatedFieldSettings[i].name].formula=this.calculatedFieldSettings[i].formula},PivotEngine.prototype.getCalculatedField=function(e){for(var t=0,i=this.calculatedFieldSettings;t<i.length;t++){var a=i[t];this.calculatedFields[a.name]=ej2Base.extend({},a,null,!0),this.calculatedFields[a.name].actualFormula=a.formula}for(var r=Object.keys(this.calculatedFields),o=this,n=0,s=r.length;n<s;n++)!function(t,i){var a=o.calculatedFields[r[t]],n=a.properties,s=(n?n.formula:a.formula).replace(/ +/g,""),l=s.replace(/"/g,"");a.formula=l.indexOf("^")>-1?o.powerFunction(l):l,a.name=n?n.name:a.name,(e=e.filter(function(e){return e!==a.name})).push(a.name);for(var d=s.split('"'),p=0,h=d.length;p<h;p++){var c=d[p],u=c.split(/[ .:;?!~,`"&|()<>{}\[\]\r\n\/\\]+/),g="DistinctCount"===u[0]?"DistinctCount":"PopulationStDev"===u[0]?"PopulationStDev":"SampleStDev"===u[0]?"SampleStDev":"PopulationVar"===u[0]?"PopulationVar":"SampleVar"===u[0]?"SampleVar":u[0];if(-1!==["Sum","Count","Min","Max","Avg","Product","DistinctCount","PopulationStDev","SampleStDev","PopulationVar","SampleVar"].indexOf(g)){var m=e.indexOf(u[1]);o.calculatedFormulas[a.name]?o.calculatedFormulas[a.name].push({index:m,type:g,formula:c}):o.calculatedFormulas[a.name]=[{index:m,type:g,formula:c}]}}}(n);this.fields=e},PivotEngine.prototype.validateFilters=function(e){this.isValueFiltersAvail=!1;var t=e.filterSettings?e.filterSettings:[],i=ej2Base.extend([],this.rows,null,!0);i=i.concat(this.columns);for(var a=0,r=t;a<r.length;a++){for(var o=r[a],n=0,s=i;n<s.length;n++){var l=s[n];if(o.name===l.name&&"Value"===o.type){this.isValueFiltersAvail=!0;break}}if(this.isValueFiltersAvail)break}},PivotEngine.prototype.fillFieldMembers=function(e,t){for(var i=this.fields,a=e.length,r=this.fieldList,o=i.length,n=0;n<o;n++){var s=i[n];r[s].members||(r[s].members={}),r[s].formattedMembers||(r[s].formattedMembers={}),r[s].dateMember||(r[s].dateMember=[]);for(var l=r[s].members,d=Object.keys(l).length>0,p=r[s].formattedMembers,h=r[s].dateMember,c=0,u=0,g=0;g<a;g++){var m=e[g][s];if(!ej2Base.isNullOrUndefined(m)){if(!d){var v=m,f=!this.pageSettings||this.formatFields[s]&&["date","dateTime","time"].indexOf(this.formatFields[s].type)>-1?this.getFormattedValue(m,s):{formattedText:ej2Base.isNullOrUndefined(m)?m:m.toString(),actualText:m};f.formattedText&&(v=f.formattedText),l.hasOwnProperty(m)?l[m].index.push(g):(c++,l[m]={index:[g],ordinal:c,isDrilled:!!this.isExpandAll},h.push({formattedText:f.formattedText,actualText:f.dateText?f.dateText:f.actualText})),p.hasOwnProperty(v)?p[v].index.push(g):(u++,p[v]={index:[g],ordinal:u,isDrilled:!!this.isExpandAll})}t[g]?t[g][n]=l[m].ordinal:(t[g]=[],t[g][n]=l[m].ordinal)}}}this.fillDrilledInfo()},PivotEngine.prototype.fillDrilledInfo=function(){for(var e=0;e<this.drilledMembers.length;e++)for(var t=this.drilledMembers[e].name,i=0;i<this.drilledMembers[e].items.length;i++){var a=this.drilledMembers[e].items[i],r=this.fieldList[t];r&&r.members[a]&&(r.members[a].isDrilled=!this.isExpandAll)}},PivotEngine.prototype.generateValueMatrix=function(e){for(var t=this.fields,i=e.length,a=[],r=t.length,o=this.fieldList;i--;){e[i];var n=r;for(a[i]=[];n--;){var s=t[n];a[i][n]="number"===o[s].type?e[i][s]:1}}return a},PivotEngine.prototype.updateSortSettings=function(e,t){for(var i=0,a=e?e.length:0;i<a&&t;i++)this.fieldList[e[i].name].sort=e[i].order},PivotEngine.prototype.updateFilterMembers=function(e){var t=this.filterMembers,i={},a=this.getFilters(e,i),r=this.indexMatrix.length;if(a)for(var o=i.include.index,n=0;n<o.length;n++)void 0!==i.exclude&&void 0!==i.exclude.indexObject[o[n]]||t.push(o[n]);else for(n=0;n<r;n++)void 0!==i.exclude&&void 0!==i.exclude.indexObject[n]||t.push(n)},PivotEngine.prototype.getFilters=function(e,t){for(var i=e.filterSettings?e.filterSettings:[],a=(this.filters,!1),r=[],o=0,n=i.length;o<n;o++){var s=i[o].properties?i[o].properties:i[o];this.fieldList[s.name].isSelected&&this.isValidFilterField(s,e.allowLabelFilter)&&(this.applyLabelFilter(s),s&&(r=s.items),s.type&&"Include"===s.type?(this.frameFilterList(r,s.name,t,"include",s.showLabelFilter,a),a=!0):this.frameFilterList(r,s.name,t,"exclude",s.showLabelFilter),s.showLabelFilter&&(s.items=[],s.type=s.showDateFilter?"Date":s.showNumberFilter?"Number":"Label"))}return a},PivotEngine.prototype.isValidFilterField=function(e,t){var i=!1,a=["Include","Exclude"],r=ej2Base.extend([],this.rows,null,!0);if(r=r.concat(this.columns),this.fieldList[e.name].isSelected&&a.indexOf(e.type)>=0){for(var o=!1,n=0,s=this.values;n<s.length;n++){p=s[n];if(e.name===p.name){o=!0;break}}o||(i=!0)}else for(var l=0,d=r;l<d.length;l++){var p=d[l];if(e.name===p.name&&t&&["Label","Date","Number"].indexOf(e.type)>=0){i=!0;break}}return i},PivotEngine.prototype.applyLabelFilter=function(e){if(["Label","Date","Number"].indexOf(e.type)>=0){var t=Object.keys(this.fieldList[e.name].members);if(e.showLabelFilter=!0,"Label"===e.type)e.items=this.getLabelFilterMembers(t,e.condition,e.value1,e.value2);else if("Date"===e.type)e.showDateFilter=!0,e.items=this.getDateFilterMembers(t,e.name,e.condition,e.value1,e.value2);else{e.showNumberFilter=!0,e.items=[];for(var i=0,a=t;i<a.length;i++){var r=a[i],o=this.getParsedValue(e.name,e.value1),n=this.getParsedValue(e.name,e.value2),s=this.getParsedValue(e.name,r);this.validateFilterValue(s,e.condition,o,n)&&e.items.push(r)}}var l=["DoesNotBeginWith","DoesNotContains","DoesNotEndsWith","DoesNotEquals","NotBetween"];e.type=l.indexOf(e.condition)>-1&&!e.showNumberFilter?"Exclude":"Include"}else e.showLabelFilter=!1},PivotEngine.prototype.getLabelFilterMembers=function(e,t,i,a){for(var r=[],o=0,n=e;o<n.length;o++){var s=n[o],l=s.toLowerCase();if(i.toString())switch(t){case"Equals":case"DoesNotEquals":l===i.toLowerCase()&&r.push(s);break;case"BeginWith":case"DoesNotBeginWith":0===l.indexOf(i.toLowerCase())&&r.push(s);break;case"EndsWith":case"DoesNotEndsWith":null!==l.match(i.toLowerCase()+"$")&&r.push(s);break;case"Contains":case"DoesNotContains":l.indexOf(i.toLowerCase())>-1&&r.push(s);break;case"GreaterThan":l>i.toLowerCase()&&r.push(s);break;case"GreaterThanOrEqualTo":l>=i.toLowerCase()&&r.push(s);break;case"LessThan":l<i.toLowerCase()&&r.push(s);break;case"LessThanOrEqualTo":l<=i.toLowerCase()&&r.push(s);break;case"Between":case"NotBetween":l>=i.toLowerCase()&&l<=a.toLowerCase()&&r.push(s)}}return r},PivotEngine.prototype.getDateFilterMembers=function(e,t,i,a,r){for(var o=[],n=0,s=e;n<s.length;n++){var l=s[n],d=new Date(l);if(a)switch(i){case"Equals":case"DoesNotEquals":this.getFormattedValue(d.toString(),t).formattedText===this.getFormattedValue(a.toString(),t).formattedText&&o.push(this.getFormattedValue(l,t).formattedText);break;case"After":d.getTime()>a.getTime()&&o.push(this.getFormattedValue(l,t).formattedText);break;case"AfterOrEqualTo":d.getTime()>=a.getTime()&&o.push(this.getFormattedValue(l,t).formattedText);break;case"Before":d.getTime()<a.getTime()&&o.push(this.getFormattedValue(l,t).formattedText);break;case"BeforeOrEqualTo":d.getTime()<=a.getTime()&&o.push(this.getFormattedValue(l,t).formattedText);break;case"Between":case"NotBetween":d.getTime()>=a.getTime()&&d.getTime()<=r.getTime()&&o.push(this.getFormattedValue(l,t).formattedText)}}return o},PivotEngine.prototype.validateFilterValue=function(e,t,i,a){var r=!1;if("number"==typeof i)switch(t){case"Equals":e===i&&(r=!0);break;case"DoesNotEquals":e!==i&&(r=!0);break;case"GreaterThan":e>i&&(r=!0);break;case"GreaterThanOrEqualTo":e>=i&&(r=!0);break;case"LessThan":e<i&&(r=!0);break;case"LessThanOrEqualTo":e<=i&&(r=!0);break;case"Between":e>=i&&e<=a&&(r=!0);break;case"NotBetween":e>=i&&e<=a||(r=!0)}return r},PivotEngine.prototype.frameFilterList=function(e,t,i,a,r,o){i[a]?this.updateFilter(e,t,i,a,r,o):(i[a]={indexObject:{},index:[]},this.updateFilter(e,t,i,a,r,o))},PivotEngine.prototype.updateFilter=function(e,t,i,a,r,o){var n=0,s=this.fieldList[t];s.filter=e,s.filterType=a,s.isExcelFilter=r;var l=this.formatFields[t]&&["date","dateTime","time"].indexOf(this.formatFields[t].type)>-1?s.formattedMembers:s.members,d=o,p={},h={};for(p[a]={indexObject:{},index:[]},this.fieldFilterMem[t]={memberObj:{}};e[n];){var c=l[e[n]].index;if("include"===a)for(var u=0,g=c.length;u<g;u++)d&&void 0===i[a].indexObject[c[u]]||(p[a].indexObject[c[u]]=c[u],p[a].index.push(c[u]));else{for(var u=0,g=c.length;u<g;u++)void 0===i[a].indexObject[c[u]]&&(i[a].indexObject[c[u]]=c[u],i[a].index.push(c[u]));this.fieldFilterMem[t].memberObj[e[n]]=e[n]}n++}if("include"===a){i[a]=p[a];for(u=0;u<e.length;u++)h[e[u]]=e[u];for(var m=Object.keys(l),u=0,g=m.length;u<g;u++)void 0===h[m[u]]&&(this.fieldFilterMem[t].memberObj[m[u]]=m[u])}},PivotEngine.prototype.applyValueFiltering=function(e,t,i,a,r,o,n){this.isValueFiltered=!1;var s=ej2Base.extend({},i[i.length-1],null,!0);return this.getFilteredData(i,a,r,o,t,e.name,s,n),this.isValueFiltered&&(o.push(s),i=o),i},PivotEngine.prototype.getFilteredData=function(e,t,i,a,r,o,n,s){for(var l=e.length,d=0;d<l;d++)if(i[o])if(e[d].level===r){this.isValueFiltered=!0,this.fieldList[o].isExcelFilter=!0;var p=0,h=i[o].measure,c=this.fieldList[h].index,u=this.fieldList[h].aggregateType;p="row"===s?this.getAggregateValue(e[d].index,t.indexObject,c,u):this.getAggregateValue(t.index,e[d].indexObject,c,u);var g=this.getParsedValue(h,i[o].value1),m=this.getParsedValue(h,i[o].value2);if(this.validateFilterValue(p,i[o].condition,g,m)||"grand sum"===e[d].type)"grand sum"!==e[d].type&&(a.push(ej2Base.extend({},e[d],null,!0)),a[a.length-1].isLevelFiltered=!0);else{var v=this.removefilteredData(e[d],this.valueFilteredData),f=v||e[d];this.validateFilteredParentData(f,this.valueFilteredData,n,0,r,s)}}else e[d].hasChild&&e[d].members.length>0&&"grand sum"!==e[d].type&&(a.push(ej2Base.extend({},e[d],null,!0)),a[a.length-1].members=[],a[a.length-1].isLevelFiltered=!0,this.getFilteredData(e[d].members,t,i,a[a.length-1].members,r,o,n,s))},PivotEngine.prototype.getParsedValue=function(e,t){var i=t?t.toString():"";if(this.formatFields[e]&&t){var a=ej2Base.extend({},this.formatFields[e],null,!0);return delete a.name,this.globalize.parseNumber(i,a)}return this.globalize.parseNumber(i,{format:"N"})},PivotEngine.prototype.removefilteredData=function(e,t){for(var i,a=ej2Base.extend([],t,null,!0),r=0;r<a.length;r++){if(e.isLevelFiltered&&e.axis===a[r].axis&&e.valueSort.levelName===a[r].valueSort.levelName&&e.actualText===a[r].actualText&&e.axis===a[r].axis&&e.level===a[r].level&&e.ordinal===a[r].ordinal){i=a[r],t.splice(r,1);break}t[r].hasChild&&t[r].members.length>0&&this.removefilteredData(e,t[r].members)}return i},PivotEngine.prototype.validateFilteredParentData=function(e,t,i,a,r,o){if(t.length>0)for(var n=0,s=t;n<s.length;n++){var l=s[n];if(l.level===a){if("row"===o)for(var d=0,p=h=e.index;d<p.length;d++){y=p[d];i.index.indexOf(y)>=0&&i.index.splice(i.index.indexOf(y),1),e.valueSort.levelName.toString().indexOf(l.valueSort.levelName.toString())>=0&&l.level!==r&&l.index.indexOf(y)>=0&&l.index.splice(l.index.indexOf(y),1)}else for(var h=e.indexObject,c=0,u=Object.keys(h);c<u.length;c++){y=u[c];h.hasOwnProperty(y)&&(delete i.indexObject[y],e.valueSort.levelName.toString().indexOf(l.valueSort.levelName.toString())>=0&&l.level!==r&&delete l.indexObject[y])}l&&l.members.length>0&&l.members[0].level===a+1&&l.members[0].level!==r&&this.validateFilteredParentData(e,l.members,i,a+1,r,o)}}else if("row"===o)for(var g=0,m=h=e.index;g<m.length;g++){y=m[g];i.index.indexOf(y)>=0&&i.index.splice(i.index.indexOf(y),1)}else for(var h=e.indexObject,v=0,f=Object.keys(h);v<f.length;v++){var y=f[v];h.hasOwnProperty(y)&&delete i.indexObject[y]}},PivotEngine.prototype.updateFramedHeaders=function(e,t,i,a,r){for(var o=0,n=e;o<n.length;o++){var s=n[o];this.isHeaderAvail=!1,(this.validateFilteredHeaders(s,i,r)||"grand sum"===s.type)&&("row"===r?this.rowCount+=this.rowValuesLength:this.columnCount+=this.colValuesLength,a.push(ej2Base.extend({},s,null,!0)),a[a.length-1].members=[],s.hasChild&&s.isDrilled&&s.members.length>0&&this.updateFramedHeaders(s.members,t,i,a[a.length-1].members,r))}return this.filterFramedHeaders},PivotEngine.prototype.validateFilteredHeaders=function(e,t,i){for(var a=0,r=t;a<r.length;a++){var o=r[a];if(!this.isHeaderAvail){if(e.actualText===o.actualText&&e.level===o.level&&e.valueSort.levelName===o.valueSort.levelName)return"row"===i?o.index.length>0?(this.isHeaderAvail=!0,e.index=o.index,!0):(this.isHeaderAvail=!1,e.index=o.index,!1):Object.keys(o.indexObject).length>0?(this.isHeaderAvail=!0,e.indexObject=o.indexObject,!0):(this.isHeaderAvail=!1,e.indexObject=o.indexObject,!1);o.hasChild&&o.members.length>0&&"grand sum"!==o.type&&this.validateFilteredHeaders(e,o.members,i)}}return this.isHeaderAvail},PivotEngine.prototype.isEmptyDataAvail=function(e,t){this.isEmptyData=!1,e.length>0&&"grand sum"===e[e.length-1].type&&0===e[e.length-1].index.length&&(this.isEmptyData=!0),t.length>0&&"grand sum"===t[t.length-1].type&&0===Object.keys(t[t.length-1].indexObject).length&&(this.isEmptyData=!0)},PivotEngine.prototype.updateGridData=function(e){this.indexMatrix=[];for(var t=0,i=this.fields;t<i.length;t++){var a=i[t];this.fieldList[a].members={},this.fieldList[a].formattedMembers={},this.fieldList[a].dateMember=[]}this.fillFieldMembers(e.data,this.indexMatrix),this.valueMatrix=this.generateValueMatrix(e.data),this.filterMembers=[],this.cMembers=[],this.rMembers=[],this.updateFilterMembers(e),this.isEditing=!0,this.isDrillThrough=!0,this.generateGridData(e),this.isEditing=!1},PivotEngine.prototype.generateGridData=function(e,t){this.fields;var i=e.columns?e.columns:[],a=e.data,r=e.rows?e.rows:[],o=e.filterSettings,n=e.values?e.values:[];this.removeCount=0,this.isExpandAll=e.expandAll,this.drilledMembers=e.drilledMembers?e.drilledMembers:[],this.isEmptyData=!1;var s=[],l=r[0]&&r[0].showNoDataItems||i[0]&&i[0].showNoDataItems,d=ej2Base.extend([],this.rows,null,!0);if(d=d.concat(this.columns,this.values,this.filters),l)for(p=0;p<this.indexMatrix.length;p++)s.push(p);for(var p=0;p<this.filterMembers.length;p++)this.filterPosObj[this.filterMembers[p]]=this.filterMembers[p];this.valueSortSettings.columnIndex=void 0;(new Date).getTime();this.isValueFilterEnabled&&!this.isEditing||t||(this.columnCount=0,this.rowCount=0,this.cMembers=[],this.rMembers=[],0!==r.length&&(this.rMembers=this.getIndexedHeaders(r,a,0,r[0].showNoDataItems?s:this.filterMembers,"row","")),0!==i.length&&(this.cMembers=this.getIndexedHeaders(i,a,0,i[0].showNoDataItems?s:this.filterMembers,"column","")),this.insertAllMembersCommon(),this.saveDataHeaders=this.isValueFiltersAvail&&e.allowValueFilter?{rowHeaders:ej2Base.extend([],this.rMembers,null,!0),columnHeaders:ej2Base.extend([],this.cMembers,null,!0)}:{}),this.pivotValues=[],this.headerContent=[],this.valueContent=[],this.valueFilteredData=[],this.filterFramedHeaders=[];var h=[],c=[],u=[],g=[],m=this.values.length;if(this.isValueFiltersAvail&&e.allowValueFilter&&!t){this.valueFilteredData=[];var v=this.saveDataHeaders.rowHeaders,f=this.saveDataHeaders.columnHeaders;if(o.length>0){for(var y={},S={},b=0,C=n;b<C.length;b++){var x=C[b];S[x.name]=x}for(var w=0,j=o;w<j.length;w++){var E=j[w];v=u.length>0?u:v,f=g.length>0?g:f,this.valueFilteredData=[];var T=E.properties?E.properties:E;if("Value"===T.type&&this.fieldList[E.name].isSelected){y[E.name]=E,T.items=[];for(var B=!1,D=r.length,_=i.length,L=0;L<D;L++)if(T.name===r[L].name&&S[T.measure]&&!B){B=!0,u=this.applyValueFiltering(r[L],L,v,f[f.length-1],y,this.valueFilteredData,"row");break}for(var O=0;O<_;O++)if(T.name===i[O].name&&S[T.measure]&&!B){B=!0,g=this.applyValueFiltering(i[O],O,f,v[v.length-1],y,this.valueFilteredData,"column");break}}}}u=u.length>0?u:v,g=g.length>0?g:f,this.isEmptyDataAvail(u,g);var P=ej2Base.extend({},this.fieldList,null,!0);this.indexMatrix=[];var M=e.data[0];this.getFieldList(M,this.enableSort,e.allowValueFilter),this.fillFieldMembers(e.data,this.indexMatrix),this.updateSortSettings(e.sortSettings,this.enableSort),this.valueMatrix=this.generateValueMatrix(e.data),this.filterMembers=[],this.updateFilterMembers(e),this.rMembers=0!==r.length?this.getIndexedHeaders(r,a,0,r[0].showNoDataItems?s:this.filterMembers,"row",""):[],this.cMembers=0!==i.length?this.getIndexedHeaders(i,a,0,i[0].showNoDataItems?s:this.filterMembers,"column",""):[],this.insertAllMembersCommon(),this.updateFieldList(P),this.rowCount=0,this.columnCount=0,this.rMembers=this.updateFramedHeaders(this.rMembers,this.rMembers,u,this.filterFramedHeaders,"row"),this.filterFramedHeaders=[],this.cMembers=this.updateFramedHeaders(this.cMembers,this.cMembers,g,this.filterFramedHeaders,"column"),this.isValueFilterEnabled=!0}t||this.applyValueSorting(),this.pageSettings&&(t?(this.rMembers=t.rowHeaders,this.cMembers=t.columnHeaders,this.rowCount=t.rowHeadersCount,this.columnCount=t.columnHeadersCount):(this.headerCollection.rowHeaders=this.rMembers,this.headerCollection.columnHeaders=this.cMembers,this.headerCollection.rowHeadersCount=this.rowCount,this.headerCollection.columnHeadersCount=this.columnCount),this.calculatePagingValues()),this.getAggregatedHeaders(r,i,this.rMembers,this.cMembers,n),this.getHeaderData(this.cMembers,c,this.pivotValues,0,this.valueAxis?1:m),0!==this.removeCount&&this.values.length>0&&(this.columnCount=this.columnCount-this.removeCount*(0===this.valueAxis?this.values.length:1)),this.showGrandTotals&&this.showColumnGrandTotals||!(this.columns.length>0)||(this.columnCount=this.columnCount-1*(0===this.valueAxis?this.values.length:1)),this.insertSubTotals(),this.getTableData(this.rMembers,h,c,0,this.pivotValues,m,this.rMembers[this.rMembers.length-1],this.cMembers[this.cMembers.length-1]),this.applyAdvancedAggregate(h,c,this.pivotValues),this.isEngineUpdated=!0;(new Date).getTime()},PivotEngine.prototype.onDrill=function(e){var t=this.getHeadersInfo(e.fieldName,e.axis);this.performDrillOperation(t.headers,e,t.fields,t.position,0),this.headerCollection.rowHeadersCount=this.rowCount,this.headerCollection.columnHeadersCount=this.columnCount,"row"===t.axis?this.headerCollection.rowHeaders=t.headers:this.headerCollection.columnHeaders=t.headers,this.updateEngine()},PivotEngine.prototype.onSort=function(e){var t=this.getHeadersInfo(e.name,"");this.fieldList[e.name].sort=e.order,this.performSortOperation(t.headers,e,t,0),this.updateEngine()},PivotEngine.prototype.onFilter=function(e,t){var i=this.getHeadersInfo(e.name,"");"Include"===e.type&&e.items.length===this.fieldList[e.name].dateMember.length?(this.fieldList[e.name].filter=[],this.fieldList[e.name].filterType=""):(this.fieldList[e.name].filter=e.items,this.fieldList[e.name].filterType=e.type);for(var a={},r=0,o=this.filterMembers;r<o.length;r++){var n=o[r];a[n]=n}this.filterMembers=[],this.fieldFilterMem={},this.updateFilterMembers(t);for(var s=this.filterMembers.filter(function(e){return void 0===a[e]}),l=0,d=e.items;l<d.length;l++)d[l];if(this.rows[0]&&this.rows[0].showNoDataItems||this.columns[0]&&this.columns[0].showNoDataItems){var p=[];this.filterPosObj={};for(h=0;h<s.length;h++)this.filterPosObj[s[h]]=s[h];for(var h=0;h<this.indexMatrix.length;h++)p.push(h);s=p}this.performFilterCommonUpdate(e,i,s),this.frameHeaderObjectsCollection=!1,this.headerObjectsCollection={},this.updateEngine()},PivotEngine.prototype.onAggregation=function(e){this.fieldList[e.name].aggregateType=e.type,this.rMembers=this.headerCollection.rowHeaders,this.cMembers=this.headerCollection.columnHeaders,this.updateEngine()},PivotEngine.prototype.onCalcOperation=function(e){this.rMembers=this.headerCollection.rowHeaders,this.cMembers=this.headerCollection.columnHeaders,this.getCalculatedField(this.fields),this.fieldList[e.name]?this.fieldList[e.name].formula=e.formula:(this.fieldList[e.name]={id:e.name,caption:e.name,type:"number",aggregateType:"CalculatedField",filterType:"",index:this.fields.length-1,filter:[],sort:this.enableSort?"Ascending":"None",isSelected:!0,isExcelFilter:!1,formula:e.formula},1===this.valueAxis?this.headerCollection.rowHeadersCount=this.rowCount=this.rowCount/(this.values.length-1)*this.values.length:this.headerCollection.columnHeadersCount=this.columnCount=this.columnCount/(this.values.length-1)*this.values.length),this.updateEngine()},PivotEngine.prototype.performDrillOperation=function(e,t,i,a,r){for(var o=0;o<e.length;){if(a===r){if(t.memberName===e[o].actualText){if("down"===t.action){e[o].isDrilled=!0,e[o].members=this.getIndexedHeaders(i,this.data,a+1,e[o].index,t.axis,t.memberName);var n=void 0;"row"===t.axis?(n=this.applyValueSorting(e[o].members,this.cMembers),e[o].members=n.rMembers):(n=this.applyValueSorting(this.rMembers,e[o].members),e[o].members=n.cMembers)}else e[o].isDrilled=!1,this.updateHeadersCount(e[o].members,t.axis,"minus"),e[o].members=[];break}}else e[o].members.length>0&&(e[o].members=this.performDrillOperation(e[o].members,t,i,a,r+1));o++}return e},PivotEngine.prototype.performSortOperation=function(e,t,i,a){for(var r=0;r<e.length;){if(i.position===a){e=this.getSortedHeaders(e,t.order.toString());break}e[r].members.length>0&&(e[r].members=this.performSortOperation(e[r].members,t,i,a+1)),r++}return e},PivotEngine.prototype.performFilterDeletion=function(e,t,i,a,r){for(var o=0,n=!0,s=this;o<e.length&&n;)!function(){if(i.position===r){var l=s;e=e.filter(function(e){return!l.fieldFilterMem[t.name].memberObj[e.formattedText]||"grand sum"===e.type}),n=!1}else e[o].members.length>0&&(e[o].members=s.performFilterDeletion(e[o].members,t,i,a,r+1));o++}();var l=this;return e.filter(function(e){return e.isDrilled?e.members.length>0:l.matchIndexes(e.indexObject,a)})},PivotEngine.prototype.matchIndexes=function(e,t){var i=Object.keys(e),a=i.length;if(0===a)return!0;for(;a>-1;){if(void 0!==t[e[i[a]]])return!0;a--}return!1},PivotEngine.prototype.performFilterAddition=function(e,t,i){for(var a=0,r=this;a<e.length;)!function(){var o=e[a].valueSort.levelName;if(r.headerObjectsCollection[o]){for(var n={},s=0,l=e[a].members;s<l.length;s++){var d=l[s];n[d.valueSort.levelName.toString()]=d.valueSort.levelName.toString()}var p=r.headerObjectsCollection[o].filter(function(e){return!n[e.valueSort.levelName.toString()]});e[a].members=e[a].members.concat(p),e[a].members=r.getSortedHeaders(e[a].members,r.fieldList[i.fields[e[a].members[0].level].name].sort),delete r.headerObjectsCollection[o]}e[a].members.length>0&&(e[a].members=r.performFilterAddition(e[a].members,t,i)),a++}();return e},PivotEngine.prototype.performFilterCommonUpdate=function(e,t,i){var a="row"===t.axis?this.rMembers:this.cMembers;"row"===t.axis?this.rowCount=0:this.columnCount=0;for(var r={},o=0,n=this.filterMembers;o<n.length;o++){var s=n[o];r[s]=s}if(this.fieldFilterMem[e.name]&&(a=this.performFilterDeletion(t.headers,e,t,r,0)),i.length>0){this.frameHeaderObjectsCollection=!0,t.fields.filter(function(e){return e.showNoDataItems}).length>0&&(i=this.data.map(function(e,t){return t})),this.headerObjectsCollection.parent=this.getIndexedHeaders(t.fields,this.data,0,i,t.axis,"");for(var l={},d=0,p=a=this.performFilterAddition(a,t.fields,t);d<p.length;d++){var h=p[d];l[h.valueSort.levelName.toString()]=h.valueSort.levelName.toString()}var c=this.headerObjectsCollection.parent.filter(function(e){return!l[e.valueSort.levelName.toString()]}),u=a.filter(function(e){return"grand sum"===e.type});a.pop(),a=this.getSortedHeaders(a.concat(c),this.fieldList[t.fields[0].name].sort).concat(u)}this.updateHeadersCount(a,t.axis,"plus"),"row"===t.axis?(t.position>0&&this.insertPosition(this.rows,this.data,0,this.filterMembers,"row","",a),this.insertTotalPosition(a),this.rMembers=this.headerCollection.rowHeaders=a,this.headerCollection.rowHeadersCount=this.rowCount):(t.position>0&&this.insertPosition(this.columns,this.data,0,this.filterMembers,"column","",a),this.insertTotalPosition(a),this.cMembers=this.headerCollection.columnHeaders=a,this.headerCollection.columnHeadersCount=this.columnCount),this.applyValueSorting()},PivotEngine.prototype.getHeadersInfo=function(e,t){this.rMembers=this.headerCollection.rowHeaders,this.cMembers=this.headerCollection.columnHeaders;for(var i="row"===(t=""===t?this.getAxisByFieldName(e):t)?this.rMembers:this.cMembers,a="row"===t?this.rows:this.columns,r=0,o=0,n=a;o<n.length&&n[o].name!==e;o++)r++;return{axis:t,fields:a,headers:i,position:r}},PivotEngine.prototype.updateEngine=function(){this.removeCount=0,this.calculatePagingValues(),this.pivotValues=[],this.headerContent=[],this.valueContent=[];var e=[],t=[],i=this.values.length;this.getAggregatedHeaders(this.rows,this.columns,this.rMembers,this.cMembers,this.values),this.getHeaderData(this.cMembers,t,this.pivotValues,0,this.valueAxis?1:i),this.insertSubTotals(),this.getTableData(this.rMembers,e,t,0,this.pivotValues,i,this.rMembers[this.rMembers.length-1],this.cMembers[this.cMembers.length-1]),this.applyAdvancedAggregate(e,t,this.pivotValues),this.isEngineUpdated=!0},PivotEngine.prototype.getAxisByFieldName=function(e){for(var t=0,i="";t<4&&""===i;){switch(t){case 0:i=this.getFieldByName(e,this.rows)?"row":"";break;case 1:i=this.getFieldByName(e,this.columns)?"column":""}t++}return i},PivotEngine.prototype.getFieldByName=function(e,t){return new ej2Data.DataManager({json:t}).executeLocal((new ej2Data.Query).where("name","equal",e))[0]},PivotEngine.prototype.updateHeadersCount=function(e,t,i){for(var a=0;a<e.length;)"row"===t?this.rowCount=this.rowCount-("plus"===i?-(1===this.valueAxis?this.values.length:1):1===this.valueAxis?this.values.length:1):this.columnCount=this.columnCount-("plus"===i?-(1===this.valueAxis?1:this.values.length):1===this.valueAxis?1:this.values.length),e[a].members.length>0&&this.updateHeadersCount(e[a].members,t,i),a++},PivotEngine.prototype.frameHeaderWithKeys=function(e){for(var t=Object.keys(e),i=0,a={};i<t.length;)a[t[i]]=e[t[i]],i++;return a},PivotEngine.prototype.getSortedHeaders=function(e,t){return this.enableSort?"Ascending"===t?e.sort(function(e,t){return e.actualText>t.actualText?1:t.actualText>e.actualText?-1:0}):"Descending"===t?e.sort(function(e,t){return e.actualText<t.actualText?1:t.actualText<e.actualText?-1:0}):e:e},PivotEngine.prototype.applyValueSorting=function(e,t){var i=!1;if(void 0!==e&&void 0!==t||(e=this.rMembers,t=this.cMembers,i=!0),this.valueSortSettings.headerText&&""!==this.valueSortSettings.headerText&&this.values.length>0){for(var a=this.valueSortSettings.headerText.split(this.valueSortSettings.headerDelimiter),r="",o=void 0,n=void 0,s=void 0,l=0;l<this.values.length;l++){if(this.values[l].caption===a[a.length-1]){s=this.values[l].name;break}s=a[a.length-1]}if((1===this.values.length&&0===this.columns.length||this.values.length>1)&&s&&this.fieldList[s]){for(l=0;l<a.length-1;l++)r=""===r?a[l]:r+this.valueSortSettings.headerDelimiter+a[l];o=this.fieldList[s].index,n=this.fieldList[s].aggregateType}else{if(this.alwaysShowValueHeader&&1!==a.length)for(l=0;l<a.length-1;l++)r=""===r?a[l]:r+this.valueSortSettings.headerDelimiter+a[l];else r=this.valueSortSettings.headerText;o=this.fieldList[this.values[0].name].index,n=this.fieldList[this.values[0].name].aggregateType}var d=void 0;0===this.valueAxis?(d=this.getMember(t,r))&&(e=this.sortByValueRow(e,d,this.valueSortSettings.sortOrder,o,n)):(d=this.getMember(e,r))&&(t=this.sortByValueRow(t,d,this.valueSortSettings.sortOrder,o,n)),i&&(this.rMembers=e,this.cMembers=t,this.pageSettings&&(this.headerCollection.rowHeaders=this.rMembers,this.headerCollection.columnHeaders=this.cMembers))}return{rMembers:e,cMembers:t}},PivotEngine.prototype.getMember=function(e,t){for(var i,a=e.length,r=0;r<a;r++){if(e[r].valueSort.levelName===t){i=e[r];break}if(e[r].members.length>0&&(i=this.getMember(e[r].members,t)),i)return i}return i},PivotEngine.prototype.sortByValueRow=function(e,t,i,a,r){for(var o=[],n=0,s=e;n<s.length;n++)"grand sum"===(p=s[n]).type?o.push({header:p}):o.push({header:p,value:this.getAggregateValue(p.index,t.indexObject,a,r)});o.sort(function(e,t){return"Descending"===i?t.value-e.value:e.value-t.value});for(var l=0,d=e=o.map(function(e){return e.header});l<d.length;l++){var p=d[l];p.members.length>0&&(p.members=this.sortByValueRow(p.members,t,i,a,r))}return e},PivotEngine.prototype.insertAllMembersCommon=function(){(!(!this.showGrandTotals||!this.showRowGrandTotals)||!(this.rows.length>0))&&this.insertAllMember(this.rMembers,this.filterMembers,"","row"),(!(!this.showGrandTotals||!this.showColumnGrandTotals)||!(this.columns.length>0))&&this.insertAllMember(this.cMembers,this.filterMembers,"","column")},PivotEngine.prototype.insertSubTotals=function(){for(var e=this.pivotValues.length,t=0;t<e;t++){var i=this.pivotValues[t];if(i)for(var a=void 0,r=1,o=void 0,n=i.length-1;n>0;n--){var s=i[n];if(s){a&&(a.colSpan=r,a.colIndex=a.colIndex-(r-1)),o={index:s.index,indexObject:s.indexObject},s.index=[],s.indexObject={},a=ej2Base.extend({},s,null,!0),s.index=o.index,s.indexObject=o.indexObject;for(var l=t+1;this.pivotValues[l]&&!this.pivotValues[l][n];){this.pivotValues[t][n].isDrilled||(this.pivotValues[t][n].rowSpan=l-t+1,a.rowSpan=l-t+1);var d="sum"===s.type||"grand sum"===s.type?s.type:"sum";this.pivotValues[l][n]=this.headerContent[l][n]={type:d,formattedText:"sum"===s.type||"grand sum"===s.type?s.formattedText:s.formattedText+" Total",axis:"column",level:-1,colIndex:n,rowIndex:l,valueSort:s.valueSort},s.valueSort&&s.valueSort[this.valueSortSettings.headerText]&&(this.valueSortSettings.columnIndex=n);var p=!1;"grand sum"===d?(this.pivotValues[t][n].rowSpan=l-t+1,a.rowSpan=l-t+1):"sum"!==this.pivotValues[t][n].type&&this.pivotValues[t][n].isDrilled?(this.pivotValues[t+1][n].rowSpan=l-t,p=!0):this.pivotValues[l][n].rowSpan=-1,l>t+1&&("sum"===this.pivotValues[t][n].type||p)&&(this.pivotValues[l][n].rowSpan=-1),l++}r=1}else i[n]=this.headerContent[t][n]=ej2Base.extend({},a,null,!0),i[n].index=this.headerContent[t][n].index=o.index,i[n].indexObject=this.headerContent[t][n].indexObject=o.indexObject,r++,i[n].colSpan=r,i[n].colIndex=i[n].colIndex-(r-1);1===n&&a&&(a.colSpan=r,a.colIndex=a.colIndex-(r-1))}}},PivotEngine.prototype.getIndexedHeaders=function(e,t,i,a,r,o){var n=[];if(e){var s=e.length,l={},d=e[i].name,p=e[i],h=this.fieldList[d],c=!1,u=this.formatFields[d]&&["date","dateTime","time"].indexOf(this.formatFields[d].type)>-1,g=a.length<1&&i>0||p.showNoDataItems,m={};if(g){for(var v=Object.keys(h.members),f=0,y=v.length;f<y;f++)m[v[f]]=v[f];a.length<1&&(c=!0,a.length=v.length)}for(var f=0,y=a.length;f<y;f++){var S={};ej2Base.isNullOrUndefined(e[i].showSubTotals)||e[i].showSubTotals||(S.showSubTotals=!1),S.hasChild=i<s-1,S.level=i,S.axis=r,S.colSpan=1;var b=c?h.members[Object.keys(m)[0]].ordinal:this.indexMatrix[a[f]][h.index],C=c?Object.keys(m)[0]:t[a[f]][d];if(!ej2Base.isNullOrUndefined(C)&&(delete m[C],!g||!this.fieldFilterMem[d]||this.fieldFilterMem[d].memberObj[C]!==C)){S.isDrilled=!!S.hasChild&&h.members[C].isDrilled;var x=u?this.getFormattedValue(C,d):{formattedText:C.toString(),actualText:C};S.actualText=x.actualText,S.formattedText=x.formattedText,u&&(S.dateText=x.dateText);var w=!g||void 0!==this.filterPosObj[a[f]]&&!c;l&&l[b]?w&&(l[b].index.push(a[f]),l[b].indexObject[a[f]]=a[f]):(l[b]={index:[],indexObject:{}},S.index=l[b].index,S.indexObject=l[b].indexObject,w&&(S.index=l[b].index=[a[f]],l[b].indexObject[a[f]]=a[f],S.indexObject=l[b].indexObject),S.ordinal=b,S.valueSort={},S.valueSort.axis=d,0!==i?(S.valueSort.levelName=o+this.valueSortSettings.headerDelimiter+S.formattedText,S.valueSort[o+this.valueSortSettings.headerDelimiter+S.formattedText]=1):(S.valueSort[S.formattedText]=1,S.valueSort.levelName=S.formattedText),S.members=[],n.push(S)),g&&!c&&i>0&&f+1===a.length&&Object.keys(m).length>0&&(c=!0,y=Object.keys(m).length,f=-1)}}for(var j=0,E=n.length;j<E;j++){this.frameHeaderObjectsCollection||("row"===r?this.rowCount+=this.rowValuesLength:this.columnCount+=this.colValuesLength);var T=null;if(n[j].valueSort&&n[j].valueSort.levelName&&(T=n[j].valueSort.levelName),o=T||n[j].formattedText,s-1>i&&n[j].isDrilled){var B=n[j].index;n[j].members=this.getIndexedHeaders(e,t,i+1,void 0===B?[]:B,r,o),this.frameHeaderObjectsCollection&&(this.headerObjectsCollection[o]=n[j].members)}}return this.enableSort?u?"Ascending"===h.sort?n.sort(function(e,t){return e.dateText>t.dateText?1:t.dateText>e.dateText?-1:0}):"Descending"===h.sort?n.sort(function(e,t){return e.dateText<t.dateText?1:t.dateText<e.dateText?-1:0}):n:"Ascending"===h.sort?n.sort(function(e,t){return e.actualText>t.actualText?1:t.actualText>e.actualText?-1:0}):"Descending"===h.sort?n.sort(function(e,t){return e.actualText<t.actualText?1:t.actualText<e.actualText?-1:0}):n:n}return n},PivotEngine.prototype.getOrderedIndex=function(e){for(var t={},i=0;i<e.length;i++)"grand sum"!==e[i].type&&(t[e[i].ordinal]=i);return t},PivotEngine.prototype.insertPosition=function(e,t,i,a,r,o,n){var s=[],l=this.getOrderedIndex(n);if(e){for(var d={},p=e[i].name,h=this.fieldList[p],c=0,u=a.length;c<u;c++){var g={},m=this.indexMatrix[a[c]][h.index],v=n[l[m]],f=this.formatFields[p]&&["date","dateTime","time"].indexOf(this.formatFields[p].type)>-1?this.getFormattedValue(t[a[c]][p],p):{formattedText:t[a[c]][p].toString(),actualText:t[a[c]][p].toString()};v&&v.formattedText===f.formattedText&&(d&&d[m]?(d[m].index.push(a[c]),d[m].indexObject[a[c]]=a[c]):(d[m]={index:[],indexObject:{}},v.index=d[m].index=[a[c]],d[m].indexObject[a[c]]=a[c],v.indexObject=d[m].indexObject,v.valueSort={},v.valueSort.axis=p,0!==i?(v.valueSort.levelName=o+this.valueSortSettings.headerDelimiter+v.formattedText,v.valueSort[o+this.valueSortSettings.headerDelimiter+v.formattedText]=1):(v.valueSort[v.formattedText]=1,v.valueSort.levelName=v.formattedText),g.members=[],s.push(g)))}for(var y=n.length-s.length;y>0;)s.push({members:[]}),y--;for(var S=0,b=s.length;S<b;S++)if(n[S].members.length>0){var C=null;n[S].valueSort&&n[S].valueSort.levelName&&(C=n[S].valueSort.levelName),o=C||n[S].formattedText,s[S].members=this.insertPosition(e,t,i+1,n[S].index,r,o,n[S].members)}return s}return s},PivotEngine.prototype.insertTotalPosition=function(e){var t=e[e.length-1];if(t&&"grand sum"===t.type){t.index=this.filterMembers;for(var i=0,a=this.filterMembers.length;i<a;i++)t.indexObject[this.filterMembers[i]]=this.filterMembers[i]}return e},PivotEngine.prototype.calculatePagingValues=function(){if(this.pageSettings){1===this.valueAxis?this.rowValuesLength=this.values.length:this.colValuesLength=this.values.length,this.memberCnt=-this.rowValuesLength,this.rowStartPos=(this.pageSettings.rowCurrentPage*this.pageSettings.rowSize-this.pageSettings.rowSize)*this.rowValuesLength;var e=this.rowStartPos+3*this.pageSettings.rowSize*this.rowValuesLength>this.rowCount?this.rowCount-3*this.pageSettings.rowSize*this.rowValuesLength:this.rowStartPos;e<0&&(e=this.rowStartPos=0,this.pageSettings.rowCurrentPage=1),this.rowFirstLvl=(this.rowStartPos-e)%this.pageSettings.rowSize,this.rowStartPos=e,this.endPos=this.rowStartPos+3*this.pageSettings.rowSize*this.rowValuesLength,this.endPos=this.endPos>this.rowCount?this.rowCount:this.endPos,this.rMembers=this.performSlicing(this.rMembers,[],this.rowStartPos,"row"),this.memberCnt=-this.colValuesLength,this.pageInLimit=!1,this.colHdrBufferCalculated=!1,this.colStartPos=(this.pageSettings.columnCurrentPage*this.pageSettings.columnSize-this.pageSettings.columnSize)*this.colValuesLength,(e=this.colStartPos+3*this.pageSettings.columnSize*this.colValuesLength>this.columnCount?this.columnCount-3*this.pageSettings.columnSize*this.colValuesLength:this.colStartPos)<0&&(e=this.colStartPos=0,this.pageSettings.columnCurrentPage=1),this.colFirstLvl=(this.colStartPos-e)%this.pageSettings.columnSize,this.colStartPos=e,this.endPos=this.colStartPos+3*this.pageSettings.columnSize*this.colValuesLength,this.endPos=this.endPos>this.columnCount?this.columnCount:this.endPos,this.cMembers=this.performSlicing(this.cMembers,[],this.colStartPos,"column"),this.memberCnt=-1,this.pageInLimit=!1}},PivotEngine.prototype.performSlicing=function(e,t,i,a){for(var r=0;e[r];){if(this.memberCnt+="column"===a?this.colValuesLength:this.rowValuesLength,i<=this.memberCnt&&this.endPos>=this.memberCnt&&!this.pageInLimit&&("column"===a?this.colFirstLvl=this.colFirstLvl+e[r].level:this.rowFirstLvl=this.rowFirstLvl+e[r].level,this.pageInLimit=!0),this.pageInLimit&&this.endPos<=this.memberCnt){if("column"!==a)break;if(0===e[r].members.length){if(this.colHdrBufferCalculated)break;this.colHdrBufferCalculated=!0,this.endPos+=e[r].level*this.colValuesLength}else if(this.colHdrBufferCalculated)break}if(t.push(e[r].members.length>0?this.removeChildMembers(e[r]):e[r]),e[r].members.length>0&&(t[t.length-1].members=this.performSlicing(e[r].members,[],i,a)),this.pageInLimit||t.pop(),0===e[r].level&&this.pageInLimit&&this.endPos<=this.memberCnt)break;r++}return t},PivotEngine.prototype.removeChildMembers=function(e){for(var t=Object.keys(e),i=0,a={};i<t.length;)a[t[i]]=e[t[i]],"members"===t[i]&&(a.members=[]),i++;return a},PivotEngine.prototype.insertAllMember=function(e,t,i,a){var r=e.length;i=" Total",e[r]={hasChild:!1,index:t,level:0,axis:a,isDrilled:!1,indexObject:{},members:[],formattedText:"Grand"+i,ordinal:r,type:"grand sum",valueSort:{}},e[r].valueSort[e[r].formattedText]=1,e[r].valueSort.levelName=e[r].formattedText;for(var o=0,n=t.length;o<n;o++)e[r].indexObject[t[o]]=t[o];"row"===a?this.rowCount+=this.rowValuesLength:this.columnCount+=this.colValuesLength},PivotEngine.prototype.getTableData=function(e,t,i,a,r,o,n,s){for(var l=e.length,d=0;d<l;d++){t[a=r.length]=e[d];var p=a-Number(Object.keys(t)[0]),h=!t[a].members.length;if(e[d].colIndex=0,e[d].rowIndex=a,r[a]?r[a][0]=this.valueContent[p][0]=this.frameHeaderWithKeys(e[d]):(r[a]=[],this.valueContent[p]={},r[a][0]=this.valueContent[p][0]=this.frameHeaderWithKeys(e[d])),this.valueAxis&&(this.isMutiMeasures||this.alwaysShowValueHeader)&&(!e[d].isDrilled||(ej2Base.isNullOrUndefined(e[d].showSubTotals)||e[d].showSubTotals)&&this.showSubTotals&&this.showRowSubTotals)){for(var c=a,u=p,g=0;g<o;g++){a++,p++;var m=this.values[g].caption?this.values[g].caption:this.values[g].name,v={axis:"row",actualText:this.values[g].name,formattedText:m,level:0,valueSort:{},colIndex:0,rowIndex:a,type:"value"};r[a]||(r[a]=[],this.valueContent[p]={},r[a][0]=this.valueContent[p][0]=v);var f=r[a][0].valueSort;f[r[a-g-1][0].valueSort.levelName+this.valueSortSettings.headerDelimiter+m]=1,f.levelName=r[a-g-1][0].valueSort.levelName+this.valueSortSettings.headerDelimiter+m;for(var y=0,S=1,b=i.length;y<b;++y)this.updateRowData(e,i,a,r,g,d,y,S,p,n,s),S=r[a].length,r[c][S-1]=this.valueContent[u][S-1]={axis:"value",actualText:"",colSpan:1,colIndex:S,formattedText:"",hasChild:!1}}this.recursiveRowData(e,t,i,a,r,o,h,d,o,n,s)}else{for(var y=0,S=1,b=i.length;y<b;++y)for(g=0;g<o;g++)this.updateRowData(e,i,a,r,g,d,y,S,p,n,s),S=r[a].length;this.recursiveRowData(e,t,i,a,r,o,h,d,0,n,s)}}},PivotEngine.prototype.getAggregatedHeaders=function(e,t,i,a,r){this.selectedHeaders={selectedHeader:[],values:[]};for(var o=r.length,n=0;n<o;n++)switch(r[n].type){case"DifferenceFrom":case"PercentageOfDifferenceFrom":var s=void 0,l=void 0;this.selectedHeaders.values.push(r[n].name),r[n].baseField&&r[n].baseItem?(s=r[n].baseField,l=r[n].baseItem):this.valueAxis&&(this.isMutiMeasures||this.alwaysShowValueHeader)&&t.length>0?(s=t[0].name,l=Object.keys(this.fieldList[t[0].name].members)[0]):e.length>0&&(s=e[0].name,l=Object.keys(this.fieldList[e[0].name].members)[0]);for(var d=!1,p=0,h=e;p<h.length;p++)if(h[p].name===s){this.getAggregatedHeaderData(i,r[n].name,l,!1,"row",r[n].type,this.selectedHeaders.selectedHeader,n),d=!0;break}if(!d)for(var c=0,u=t;c<u.length;c++)if(u[c].name===s){this.getAggregatedHeaderData(a,r[n].name,l,!1,"column",r[n].type,this.selectedHeaders.selectedHeader,n);break}break;case"PercentageOfParentRowTotal":case"PercentageOfParentColumnTotal":this.selectedHeaders.values.push(r[n].name),this.getAggregatedHeaderData("PercentageOfParentRowTotal"===r[n].type?i:a,r[n].name,void 0,!1,"PercentageOfParentRowTotal"===r[n].type?"row":"column",r[n].type,this.selectedHeaders.selectedHeader,n);break;case"RunningTotals":this.selectedHeaders.values.push(r[n].name),this.getAggregatedHeaderData(this.valueAxis&&(this.isMutiMeasures||this.alwaysShowValueHeader)?a:i,r[n].name,void 0,!1,this.valueAxis&&(this.isMutiMeasures||this.alwaysShowValueHeader)?"column":"row",r[n].type,this.selectedHeaders.selectedHeader,n);break;case"PercentageOfParentTotal":s=void 0;this.selectedHeaders.values.push(r[n].name),r[n].baseField?s=r[n].baseField:this.valueAxis&&(this.isMutiMeasures||this.alwaysShowValueHeader)&&t.length>0?s=t[0].name:e.length>0&&(s=e[0].name);for(var d=!1,g=e.length,m=0;m<g;m++)if(e[m].name===s){this.getAggregatedHeaderData(i,r[n].name,void 0,!1,"row",r[n].type,this.selectedHeaders.selectedHeader,n,m),d=!0;break}if(!d)for(var g=t.length,m=0;m<g;m++)if(t[m].name===s){this.getAggregatedHeaderData(a,r[n].name,void 0,!1,"column",r[n].type,this.selectedHeaders.selectedHeader,n,m);break}}},PivotEngine.prototype.getAggregatedHeaderData=function(e,t,i,a,r,o,n,s,l){for(var d=0,p=e;d<p.length;d++){var h=p[d];switch(o){case"DifferenceFrom":case"PercentageOfDifferenceFrom":-1!==h.valueSort.levelName.toString().split(".").indexOf(i)?(n.push(this.updateSelectedHeaders(i,h.level,r,a,t,o,h.valueSort.levelName,a?[h]:e,s+1)),h.members.length>0&&this.getAggregatedHeaderData(h.members,t,i,!0,r,o,n[n.length-1].childMembers,s)):h.members.length>0&&this.getAggregatedHeaderData(h.members,t,i,!1,r,o,n,s);break;case"RunningTotals":case"PercentageOfParentRowTotal":case"PercentageOfParentColumnTotal":"grand sum"===h.type?n.push(this.updateSelectedHeaders(void 0,h.level,r,!1,t,o,h.valueSort.levelName,e,s+1)):h.members.length>0&&(n.push(this.updateSelectedHeaders(void 0,h.level,r,!1,t,o,h.valueSort.levelName,h.members,s+1)),this.getAggregatedHeaderData(h.members,t,void 0,!1,r,o,n,s));break;case"PercentageOfParentTotal":if("grand sum"!==h.type)if(h.level===l)if(h.members.length>0){if(a)for(var c=n[n.length-1].aggregateHeaders,u=0,g=h.members;u<g.length;u++){var m=g[u];c.push(m)}else{var v=ej2Base.extend([],h.members,null,!0);n.push(this.updateSelectedHeaders(void 0,h.level,r,!1,t,o,h.valueSort.levelName,v,s+1)),(c=n[n.length-1].aggregateHeaders).push(h)}this.getAggregatedHeaderData(h.members,t,void 0,!0,r,o,n,s,l+1)}else a||n.push(this.updateSelectedHeaders(void 0,h.level,r,!1,t,o,h.valueSort.levelName,[h],s+1));else h.members.length>0&&this.getAggregatedHeaderData(h.members,t,void 0,!1,r,o,n,s,l)}}},PivotEngine.prototype.updateSelectedHeaders=function(e,t,i,a,r,o,n,s,l){return{name:e,level:t,axis:i,isChild:a,value:r,type:o,uniqueName:n,aggregateHeaders:s,childMembers:[],valueCount:l}},PivotEngine.prototype.applyAdvancedAggregate=function(e,t,i){if(this.selectedHeaders.values.length>0){for(var a={},r=[],o=!1,n=i.length,s=0;s<n;s++)if(void 0!==i[s]&&void 0!==i[s][0]){if(!o)for(var l=i[s].length,d=0;d<l;d++)"value"===i[s][d].axis&&-1!==this.selectedHeaders.values.indexOf(i[s][d].actualText)&&(r.push(d),o=!0);if(r.length>0&&"value"===i[s][r[0]].axis&&-1!==this.selectedHeaders.values.indexOf(i[s][r[0]].actualText))for(var p=0,h=r;p<h.length;p++)a[s+","+(g=h[p])]=[s,g]}this.updateAggregates(e,t,i,this.selectedHeaders.selectedHeader,r,a);for(var c=0,u=Object.keys(a);c<u.length;c++){var g=u[c];i[a[g][0]][a[g][1]].formattedText=this.selectedHeaders.selectedHeader.length>0?this.emptyCellTextContent:"#N/A"}}},PivotEngine.prototype.updateAggregates=function(e,t,i,a,r,o){for(var n=0,s=a;n<s.length;n++){var l=s[n],d=l.aggregateHeaders,p=l.value,h=this.valueAxis&&(this.isMutiMeasures||this.alwaysShowValueHeader)?l.valueCount:0,c=l.type,u=l.uniqueName,g="row"===l.axis,m=void 0,v=[],f=[],y=[],S=[],b=[],C=[];if(-1!==["DifferenceFrom","PercentageOfDifferenceFrom","PercentageOfParentRowTotal","PercentageOfParentColumnTotal","PercentageOfParentTotal","RunningTotals"].indexOf(l.type))if(g){if("RunningTotals"!==l.type)for(var x=e.length,w=0;w<x;w++)if(void 0!==e[w]&&e[w].valueSort[u]){m=e[w],b=i[w+h];break}}else{for(var j=i.length,E=0;E<j&&(void 0!==i[E]&&void 0===i[E][0]);E++)y.push(i[E]);for(var T=y.length;T--;){var B=(O=y[T][r[0]]).actualText;-1===this.selectedHeaders.values.indexOf(B)&&(f=y[T],T=0)}if("RunningTotals"!==l.type)for(var D=f.length,_=0;_<D;_++){de=!1;if(void 0!==f[_]&&f[_].valueSort[u]){m=f[_];for(var L=i.length,E=0;E<L;E++){var O=i[E];void 0!==O&&void 0!==O[0]&&"value"===O[_].axis&&-1!==this.selectedHeaders.values.indexOf(O[_].actualText)&&(de=!0,C[E]=O[_],S.push(E))}if(de)break}}}switch(l.type){case"DifferenceFrom":case"PercentageOfDifferenceFrom":var P=l.isChild;if(g){if(P){for(var M=u.split("."),x=e.length,A=0;A<x;A++)if(void 0!==e[A]&&-1!==($=e[A].valueSort.levelName.toString().split(".")).indexOf(M[M.length-1])&&e[A].level===m.level)for(var I=0,N=r;I<N.length;I++){fe=N[I];"value"===(we=i[A+h][fe]).axis&&we.actualText===p&&(v.push([A+h,fe]),o[A+h+","+fe]&&delete o[A+h+","+fe])}}else for(var R=0,F=d;R<F.length;R++)for(var k=F[R],x=e.length,w=0;w<x;w++)if(void 0!==e[w]&&e[w].valueSort[k.valueSort.levelName]&&e[w].level===m.level&&"grand sum"!==e[w].type)for(var V=0,q=r;V<q.length;V++){fe=q[V];"value"===(we=i[w+h][fe]).axis&&we.actualText===p&&(v.push([w+h,fe]),o[w+h+","+fe]&&delete o[w+h+","+fe])}for(var H=0,U=v;H<U.length;H++){ye=(we=i[(fe=U[H])[0]][fe[1]]).value-b[fe[1]].value;ye=isNaN(ye)?0:ye,"DifferenceFrom"===c?we.formattedText=0===ye?this.emptyCellTextContent:this.getFormattedValue(ye,p).formattedText:(ye=0===b[fe[1]].value?0:ye/b[fe[1]].value,we.formattedText=0!==ye?this.globalize.formatNumber(ye,{format:"P",maximumFractionDigits:2}):this.emptyCellTextContent)}}else{if(P)for(var M=u.split("."),D=f.length,G=0;G<D;G++){de=!1;if(void 0!==f[G]){var $=f[G].valueSort.levelName.toString().split(".");if(-1!==$.indexOf(M[M.length-1])&&f[G].level===m.level){for(var W=0,z=S;W<z.length;W++)"value"===(we=i[fe=z[W]][G]).axis&&we.actualText===p&&(de=!0,v.push([fe,G]),o[fe+","+G]&&delete o[fe+","+G]);if(de)break}}}else for(var X=0,Q=d;X<Q.length;X++)for(var k=Q[X],D=f.length,_=0;_<D;_++){de=!1;if(void 0!==f[_]&&f[_].valueSort[k.valueSort.levelName]&&f[_].level===m.level&&"grand sum"!==f[_].type){for(var Y=0,K=S;Y<K.length;Y++)"value"===(we=i[fe=K[Y]][_]).axis&&we.actualText===p&&(de=!0,v.push([fe,_]),o[fe+","+_]&&delete o[fe+","+_]);if(de)break}}for(var Z=0,J=v;Z<J.length;Z++){ye=(we=i[(fe=J[Z])[0]][fe[1]]).value-C[fe[0]].value;ye=isNaN(ye)?0:ye,"DifferenceFrom"===c?we.formattedText=0===ye?this.emptyCellTextContent:this.getFormattedValue(ye,p).formattedText:(ye=0===C[fe[0]].value?0:ye/C[fe[0]].value,we.formattedText=0!==ye?this.globalize.formatNumber(ye,{format:"P",maximumFractionDigits:2}):this.emptyCellTextContent)}}l.childMembers.length>0&&this.updateAggregates(e,t,i,l.childMembers,r,o);break;case"PercentageOfParentRowTotal":case"PercentageOfParentColumnTotal":case"PercentageOfParentTotal":if(g){for(var ee=0,te=d;ee<te.length;ee++)for(var k=te[ee],x=e.length,E=0;E<x;E++)if(void 0!==e[E]&&e[E].valueSort[k.valueSort.levelName]&&e[E].level===k.level)for(var ie=0,ae=r;ie<ae.length;ie++){fe=ae[ie];"value"===(we=i[E+h][fe]).axis&&we.actualText===p&&(v.push([E+h,fe]),o[E+h+","+fe]&&delete o[E+h+","+fe])}for(var re=0,oe=v;re<oe.length;re++){ye=(we=i[(E=oe[re])[0]][E[1]]).value/b[E[1]].value;ye=isNaN(ye)?0:ye,we.formattedText=0!==ye?this.globalize.formatNumber(ye,{format:"P",maximumFractionDigits:2}):this.emptyCellTextContent}}else{for(var ne=0,se=d;ne<se.length;ne++)for(var k=se[ne],D=f.length,le=0;le<D;le++){var de=!1;if(void 0!==f[le]&&f[le].valueSort[k.valueSort.levelName]){for(var pe=0,he=S;pe<he.length;pe++)"value"===(we=i[fe=he[pe]][le]).axis&&we.actualText===p&&(de=!0,v.push([fe,le]),o[fe+","+le]&&delete o[fe+","+le]);if(de)break}}for(var ce=0,ue=v;ce<ue.length;ce++){var ge=(we=i[(E=ue[ce])[0]][E[1]]).value/C[E[0]].value;ge=isNaN(ge)?0:ge,we.formattedText=0!==ge?this.globalize.formatNumber(ge,{format:"P",maximumFractionDigits:2}):this.emptyCellTextContent}}break;case"RunningTotals":if(g){for(var me=0,ve=r;me<ve.length;me++)for(var fe=ve[me],ye=0,Se=0,be=d;Se<be.length;Se++)for(var k=be[Se],x=e.length,A=0;A<x;A++)if(void 0!==e[A]){we=i[A+h][fe];if(void 0!==e[A]&&e[A].valueSort[k.valueSort.levelName]&&e[A].level===k.level&&"value"===we.axis&&we.actualText===p){"grand sum"!==e[A].type&&(ye+=we.value,we.formattedText=this.getFormattedValue(ye,p).formattedText),o[A+h+","+fe]&&delete o[A+h+","+fe];break}}}else for(var x=e.length,w=0;w<x;w++)if(void 0!==e[w])for(var ye=0,Ce=0,xe=d;Ce<xe.length;Ce++)for(var k=xe[Ce],D=f.length,_=0;_<D;_++){var we=i[w+h][_];if(void 0!==f[_]&&f[_].valueSort[k.valueSort.levelName]&&"value"===we.axis&&we.actualText===p){"grand sum"!==f[_].type&&(ye+=we.value,we.formattedText=this.getFormattedValue(ye,p).formattedText),o[w+h+","+_]&&delete o[w+h+","+_];break}}}}},PivotEngine.prototype.recursiveRowData=function(e,t,i,a,r,o,n,s,l,d,p){n||this.getTableData(t[a-l].members,t,i,a,r,o,d,p),this.pageSettings||(t[a-l].members=[])},PivotEngine.prototype.updateRowData=function(e,t,i,a,r,o,n,s,l,d,p){var h=this.fieldList[this.values[r].name].index,c=this.fieldList[this.values[r].name].aggregateType,u=this.values[r].name,g=[],m={},v=0;switch(c){case"Index":for(var f=["cVal","rTotalVal","cTotalVal","gTotalVal"],y=0,S=0,b=g=[[e[o],t[n]],[e[o],p],[d,t[n]],[d,p]];S<b.length;S++){w=b[S];m[f[y]]=this.getAggregateValue(w[0].index,w[1].indexObject,h,c),y++}j=m.cVal*m.gTotalVal/(m.rTotalVal*m.cTotalVal);v=!e[o].isDrilled||(ej2Base.isNullOrUndefined(e[o].showSubTotals)||e[o].showSubTotals)&&this.showSubTotals&&this.showRowSubTotals?isNaN(j)?0:j:void 0;break;case"PercentageOfGrandTotal":case"PercentageOfColumnTotal":case"PercentageOfRowTotal":(g=[[e[o],t[n]]]).push("PercentageOfGrandTotal"===c?[d,p]:"PercentageOfColumnTotal"===c?[d,t[n]]:[e[o],p]);for(var f=["cVal","gTotalVal"],y=0,C=0,x=g;C<x.length;C++){var w=x[C];m[f[y]]=this.getAggregateValue(w[0].index,w[1].indexObject,h,c),y++}var j=m.cVal/m.gTotalVal;v=!e[o].isDrilled||(ej2Base.isNullOrUndefined(e[o].showSubTotals)||e[o].showSubTotals)&&this.showSubTotals&&this.showRowSubTotals?isNaN(j)?0:j:void 0;break;default:v=!e[o].isDrilled||(ej2Base.isNullOrUndefined(e[o].showSubTotals)||e[o].showSubTotals)&&this.showSubTotals&&this.showRowSubTotals?this.getAggregateValue(e[o].index,t[n].indexObject,h,c):void 0}var E=e[o].hasChild||t[n].hasChild||"grand sum"===e[o].type||"grand sum"===t[n].type,T=e[o].isDrilled&&(!ej2Base.isNullOrUndefined(e[o].showSubTotals)&&!e[o].showSubTotals||!this.showSubTotals||!this.showRowSubTotals),B=T?"":void 0===v?this.emptyCellTextContent:"Count"===c?v.toLocaleString():this.getFormattedValue(v,u).formattedText;!isNaN(v)&&!ej2Base.isNullOrUndefined(v)&&["PercentageOfGrandTotal","PercentageOfColumnTotal","PercentageOfRowTotal"].indexOf(c)>=0?B=this.globalize.formatNumber(v,{format:"P",maximumFractionDigits:2}):T||!isNaN(v)||ej2Base.isNullOrUndefined(v)||-1===["PopulationStDev","SampleStDev","PopulationVar","SampleVar"].indexOf(c)||(B="#DIV/0!"),a[i][s]=this.valueContent[l][s]={axis:"value",actualText:u,indexObject:this.isDrillThrough?this.rawIndexObject:{},rowHeaders:"grand sum"===e[o].type?"":e[o].valueSort.levelName,columnHeaders:"grand sum"===t[n].type?"":t[n].valueSort.levelName,formattedText:B,value:ej2Base.isNullOrUndefined(v)?0:v,rowIndex:i,colIndex:s,isSum:E},this.rawIndexObject={}},PivotEngine.prototype.getHeaderData=function(e,t,i,a,r){for(var o=e.length,n=this.columns.length,s=this.valueSortSettings.headerText,l=0;l<o;l++){e[l].members.length&&this.getHeaderData(e[l].members,t,i,a,r),(ej2Base.isNullOrUndefined(e[l].showSubTotals)||e[l].showSubTotals)&&this.showSubTotals&&this.showColumnSubTotals?t[a=t.length]=this.frameHeaderWithKeys(e[l]):(e[l].isDrilled?this.removeCount++:t[t.length]=this.frameHeaderWithKeys(e[l]),a=t.length-1);var d=e[l].level;e[l].rowIndex=d,e[l].colIndex=a*r+r,i[d]?i[d][a*r+r]=this.headerContent[d][a*r+r]=this.frameHeaderWithKeys(e[l]):(i[d]=[],this.headerContent[d]={},i[d][a*r+r]=this.headerContent[d][a*r+r]=this.frameHeaderWithKeys(e[l]));var p=0===this.columns.length&&1===this.values.length;if((this.isMutiMeasures||this.alwaysShowValueHeader||p)&&!this.valueAxis)for(var h=0;h<r;h++){var c=this.values[h].caption?this.values[h].caption:this.values[h].name,u={axis:"column",actualText:this.values[h].name,formattedText:c,level:0,valueSort:{},colIndex:a*r+1+h,rowIndex:n};i[n]?i[n][a*r+1+h]=this.headerContent[n][a*r+1+h]=u:(i[n]=[],this.headerContent[n]={},i[n][a*r+1+h]=this.headerContent[n][a*r+1+h]=u);var g=i[n][a*r+1+h].valueSort;g[e[l].valueSort.levelName+this.valueSortSettings.headerDelimiter+c]=1,g.levelName=e[l].valueSort.levelName+this.valueSortSettings.headerDelimiter+c,g&&g[s]&&(this.valueSortSettings.columnIndex=a*r+1+h)}else e[l].valueSort&&e[l].valueSort[s]&&(this.valueSortSettings.columnIndex=a*r+1);this.pageSettings||(t[a].members=[])}},PivotEngine.prototype.getAggregateValue=function(rowIndex,columnIndex,value,type){var rlt=rowIndex.length,ri=0,cellValue=0,avgCnt=0,isInit=!0,isValueExist=!1;if(type&&"count"===type.toLowerCase())for(;void 0!==rowIndex[ri];)void 0!==columnIndex[rowIndex[ri]]&&(isValueExist=!0,this.rawIndexObject[rowIndex[ri]]=rowIndex[ri],cellValue+=void 0===this.valueMatrix[rowIndex[ri]][value]?0:1),ri++;else if(type&&"distinctcount"===type.toLowerCase())for(var duplicateValues=[];void 0!==rowIndex[ri];){if(void 0!==columnIndex[rowIndex[ri]]){isValueExist=!0,this.rawIndexObject[rowIndex[ri]]=rowIndex[ri];var currentVal=this.valueMatrix[rowIndex[ri]][value];void 0!==currentVal&&(0===duplicateValues.length||duplicateValues.length>0&&-1===duplicateValues.indexOf(currentVal))&&(cellValue+=1,duplicateValues.push(currentVal))}ri++}else if(type&&"product"===type.toLowerCase())for(;void 0!==rowIndex[ri];){if(void 0!==columnIndex[rowIndex[ri]]){this.rawIndexObject[rowIndex[ri]]=rowIndex[ri],isValueExist=!0;var currentVal=this.valueMatrix[rowIndex[ri]][value];void 0!==currentVal&&(cellValue=isInit?1:0===cellValue?1:cellValue,cellValue*=currentVal),isInit=!1}ri++}else if(type&&-1!==["populationstdev","samplestdev","populationvar","samplevar"].indexOf(type.toLowerCase())){for(var i=0,val=0,indexVal=[],avgVal=0,cVal=0,avgDifferenceVal=0;void 0!==rowIndex[ri];){if(void 0!==columnIndex[rowIndex[ri]]){isValueExist=!0,this.rawIndexObject[rowIndex[ri]]=rowIndex[ri];var currentVal=this.valueMatrix[rowIndex[ri]][value];void 0!==currentVal&&(val+=currentVal,indexVal.push(currentVal),i++)}ri++}if(i>0){avgVal=val/i;for(var _i=0,indexVal_1=indexVal;_i<indexVal_1.length;_i++){var index=indexVal_1[_i];avgDifferenceVal+=Math.pow(index-avgVal,2)}cVal=-1!==["populationstdev","samplestdev"].indexOf(type.toLowerCase())?Math.sqrt(avgDifferenceVal/("populationstdev"===type.toLowerCase()?i:i-1)):avgDifferenceVal/("populationvar"===type.toLowerCase()?i:i-1),cellValue=0===cVal?NaN:cVal}else cellValue=val}else if(type&&"min"===type.toLowerCase())for(var isFirst=!0;void 0!==rowIndex[ri];)void 0!==columnIndex[rowIndex[ri]]&&(isValueExist=!0,this.rawIndexObject[rowIndex[ri]]=rowIndex[ri],isFirst?(cellValue=this.valueMatrix[rowIndex[ri]][value],isFirst=!1):cellValue=this.valueMatrix[rowIndex[ri]][value]<cellValue?this.valueMatrix[rowIndex[ri]][value]:cellValue),ri++;else if(type&&"max"===type.toLowerCase())for(var isMaxFirst=!0;void 0!==rowIndex[ri];)void 0!==columnIndex[rowIndex[ri]]&&(isValueExist=!0,this.rawIndexObject[rowIndex[ri]]=rowIndex[ri],isMaxFirst?(cellValue=this.valueMatrix[rowIndex[ri]][value],isMaxFirst=!1):cellValue=this.valueMatrix[rowIndex[ri]][value]>cellValue?this.valueMatrix[rowIndex[ri]][value]:cellValue),ri++;else if(type&&"calculatedfield"===type.toLowerCase())for(;void 0!==rowIndex[ri];){if(void 0!==columnIndex[rowIndex[ri]]){isValueExist=!0,this.rawIndexObject[rowIndex[ri]]=rowIndex[ri];var calcField=this.calculatedFields[this.fields[value]],actualFormula=calcField.formula,aggregateField={};if(this.calculatedFormulas[calcField.name])for(var calculatedFormulas=this.calculatedFormulas[calcField.name],len=0,lmt=calculatedFormulas.length;len<lmt;len++){var aggregatedValue=calculatedFormulas[len],value_1=aggregateField[aggregatedValue.formula];if(void 0===value_1){var type_1=aggregatedValue.type;value_1=this.getAggregateValue(rowIndex,columnIndex,aggregatedValue.index,type_1),aggregateField[aggregatedValue.formula]=value_1}actualFormula=actualFormula.replace(aggregatedValue.formula,value_1.toString())}cellValue=eval(actualFormula),cellValue===1/0||JSON.parse(cellValue.toString())}ri++}else for(;void 0!==rowIndex[ri];){if(void 0!==columnIndex[rowIndex[ri]]){isValueExist=!0,this.rawIndexObject[rowIndex[ri]]=rowIndex[ri];var currentVal=this.valueMatrix[rowIndex[ri]][value];cellValue+=void 0===currentVal?0:currentVal,avgCnt++}ri++}return type&&"avg"===type.toLowerCase()&&0!==cellValue?cellValue/avgCnt:isValueExist?cellValue:void 0},PivotEngine.prototype.getFormattedValue=function(e,t){var i={formattedText:void 0!==e?null===e?"null":e.toString():void 0,actualText:void 0!==e?null===e?"null":e:void 0,dateText:void 0!==e?null===e?"null":e:void 0};if(this.formatFields[t]&&e){var a=this.formatFields[t].properties?this.formatFields[t].properties:this.formatFields[t],r=ej2Base.extend({},a,null,!0);delete r.name,!r.minimumSignificantDigits&&r.minimumSignificantDigits<1&&delete r.minimumSignificantDigits,!r.maximumSignificantDigits&&r.maximumSignificantDigits<1&&delete r.maximumSignificantDigits,r.type?i.formattedText=this.globalize.formatDate(new Date(e),r):i.formattedText=this.globalize.formatNumber(e,r),i.actualText=e,r.type&&["date","dateTime","time"].indexOf(this.formatFields[t].type)>-1&&(r.format="yyyy/MM/dd/HH/mm/ss",i.dateText=this.globalize.formatDate(new Date(e),r))}return i},PivotEngine.prototype.powerFunction=function(e){if(e.indexOf("^")>-1){for(var t=[];e.indexOf("(")>-1;)e=e.replace(/(\([^\(\)]*\))/g,function(e,i){return t.push(i),"~"+(t.length-1)});for(t.push(e),e="~"+(t.length-1);e.indexOf("~")>-1;)e=e.replace(new RegExp("~(\\d+)","g"),function(e,i){return t[i].replace(/(\w*)\^(\w*)/g,"Math.pow($1,$2)")})}return e},PivotEngine}(),load="load",enginePopulating="enginePopulating",enginePopulated="enginePopulated",onFieldDropped="onFieldDropped",beforePivotTableRender="beforePivotTableRender",afterPivotTableRender="afterPivotTableRender",beforeExport="beforeExport",excelHeaderQueryCellInfo="excelHeaderQueryCellInfo",pdfHeaderQueryCellInfo="pdfHeaderQueryCellInfo",excelQueryCellInfo="excelQueryCellInfo",pdfQueryCellInfo="pdfQueryCellInfo",onPdfCellRender="onPdfCellRender",dataBound="dataBound",queryCellInfo="queryCellInfo",headerCellInfo="headerCellInfo",hyperlinkCellClick="hyperlinkCellClick",resizing="resizing",resizeStop="resizeStop",cellClick="cellClick",drillThrough="drillThrough",beforeColumnsRender="beforeColumnsRender",selected="selected",cellSelected="cellSelected",cellDeselected="cellDeselected",rowSelected="rowSelected",rowDeselected="rowDeselected",beginDrillThrough="beginDrillThrough",saveReport="saveReport",fetchReport="fetchReport",loadReport="loadReport",renameReport="renameReport",removeReport="removeReport",newReport="newReport",toolbarRender="toolbarRender",toolbarClick="toolbarClick",chartTooltipRender="chartTooltipRender",chartLoaded="chartLoaded",chartLoad="chartLoad",chartResized="chartResized",chartAxisLabelRender="chartAxisLabelRender",chartSeriesCreated="chartSeriesCreated",aggregateCellInfo="aggregateCellInfo",contextMenuClick="contextMenuClick",contextMenuOpen="contextMenuOpen",initialLoad="initial-load",uiUpdate="ui-update",scroll="scroll",contentReady="content-ready",dataReady="data-ready",initSubComponent="init-groupingbar",treeViewUpdate="tree-view-update",pivotButtonUpdate="pivot-button-update",initCalculatedField="init-calculatedfield",click="click",initToolbar="init-toolbar",ROOT="e-pivotfieldlist",RTL="e-rtl",DEVICE="e-device",ICON="e-icons",ICON_DISABLE="e-disable",ICON_HIDDEN="e-hide",AXISFIELD_ICON_CLASS="e-dropdown-icon",WRAPPER_CLASS="e-pivotfieldlist-wrapper",CONTAINER_CLASS="e-field-list-container",TOGGLE_FIELD_LIST_CLASS="e-toggle-field-list",STATIC_FIELD_LIST_CLASS="e-static",TOGGLE_SELECT_CLASS="e-select-table",FIELD_TABLE_CLASS="e-field-table",FIELD_LIST_CLASS="e-field-list",FIELD_LIST_TREE_CLASS="e-field-list-tree",FIELD_HEADER_CLASS="e-field-header",FIELD_LIST_TITLE_CLASS="e-field-list-title",FIELD_LIST_TITLE_CONTENT_CLASS="e-title-content",FIELD_LIST_FOOTER_CLASS="e-field-list-footer",CALCULATED_FIELD_CLASS="e-calculated-field",FLAT_CLASS="e-flat e-primary",OUTLINE_CLASS="e-outline",AXIS_TABLE_CLASS="e-axis-table",LEFT_AXIS_PANEL_CLASS="e-left-axis-fields",RIGHT_AXIS_PANEL_CLASS="e-right-axis-fields",AXIS_HEADER_CLASS="e-axis-header",AXIS_CONTENT_CLASS="e-axis-content",AXIS_PROMPT_CLASS="e-draggable-prompt",PIVOT_BUTTON_WRAPPER_CLASS="e-pvt-btn-div",PIVOT_BUTTON_CLASS="e-pivot-button",PIVOT_BUTTON_CONTENT_CLASS="e-content",DRAG_CLONE_CLASS="e-button-drag-clone",SORT_CLASS="e-sort",SORT_DESCEND_CLASS="e-descend",FILTER_COMMON_CLASS="e-btn-filter",FILTER_CLASS="e-pv-filter",FILTERED_CLASS="e-pv-filtered",REMOVE_CLASS="e-remove",DRAG_CLASS="e-drag",DROP_INDICATOR_CLASS="e-drop-indicator",INDICATOR_HOVER_CLASS="e-drop-hover",MEMBER_EDITOR_DIALOG_CLASS="e-member-editor-dialog",EDITOR_TREE_WRAPPER_CLASS="e-member-editor-wrapper",EDITOR_TREE_CONTAINER_CLASS="e-member-editor-container",DRILLTHROUGH_GRID_CLASS="e-drillthrough-grid",DRILLTHROUGH_BODY_CLASS="e-drillthrough-body",DRILLTHROUGH_BODY_HEADER_CONTAINER_CLASS="e-drillthrough-body-header-container",DRILLTHROUGH_BODY_HEADER_CLASS="e-drillthrough-body-header",DRILLTHROUGH_BODY_HEADER_COMMON_CLASS="e-drillthrough-body-header-common",DRILLTHROUGH_BODY_HEADER_VALUE_CLASS="e-drillthrough-body-header-value",DRILLTHROUGH_DIALOG="e-drillthrough-dialog",EDITOR_LABEL_WRAPPER_CLASS="e-editor-label-wrapper",EDITOR_LABEL_CLASS="e-editor-label",CHECK_BOX_FRAME_CLASS="e-frame",NODE_CHECK_CLASS="e-check",NODE_STOP_CLASS="e-stop",OK_BUTTON_CLASS="e-ok-btn",CANCEL_BUTTON_CLASS="e-cancel-btn",ERROR_DIALOG_CLASS="e-pivot-error-dialog",DROPPABLE_CLASS="e-droppable",ROW_AXIS_CLASS="e-rows",COLUMN_AXIS_CLASS="e-columns",VALUE_AXIS_CLASS="e-values",FILTER_AXIS_CLASS="e-filters",GROUPING_BAR_CLASS="e-grouping-bar",GROUP_ROW_CLASS="e-group-rows",GROUP_COLUMN_CLASS="e-group-columns",GROUP_VALUE_CLASS="e-group-values",GROUP_FILTER_CLASS="e-group-filters",NO_DRAG_CLASS="e-drag-restrict",SELECTED_NODE_CLASS="e-list-selected",TITLE_HEADER_CLASS="e-title-header",TITLE_CONTENT_CLASS="e-title-content",TEXT_CONTENT_CLASS="e-text-content",FOOTER_CONTENT_CLASS="e-footer-content",ADAPTIVE_CONTAINER_CLASS="e-adaptive-container",ADAPTIVE_FIELD_LIST_BUTTON_CLASS="e-field-list-btn",ADAPTIVE_CALCULATED_FIELD_BUTTON_CLASS="e-calculated-field-btn",BUTTON_SMALL_CLASS="e-small",BUTTON_ROUND_CLASS="e-round",ADD_ICON_CLASS="e-add-icon",BUTTON_FLAT_CLASS="e-flat",STATIC_CENTER_DIV_CLASS="e-center-div",STATIC_CENTER_HEADER_CLASS="e-center-title",ADAPTIVE_FIELD_LIST_DIALOG_CLASS="e-adaptive-field-list-dialog",LIST_TEXT_CLASS="e-list-text",LIST_SELECT_CLASS="e-selected-node",SELECTED_OPTION_ICON_CLASS="e-selected-option-icon",FILTER_DIV_CONTENT_CLASS="e-filter-div-content",FILTER_TEXT_DIV_CLASS="e-filter-text-div",BETWEEN_TEXT_DIV_CLASS="e-between-text-div",SEPARATOR_DIV_CLASS="e-separator-div",FILTER_OPTION_WRAPPER_1_CLASS="e-filter-option-wrapper-1",FILTER_OPTION_WRAPPER_2_CLASS="e-filter-option-wrapper-2",FILTER_INPUT_DIV_1_CLASS="e-filter-input-div-1",FILTER_INPUT_DIV_2_CLASS="e-filter-input-div-2",VALUE_OPTIONS_CLASS="e-value-options",FILTER_OPERATOR_CLASS="e-filter-operator",COLLAPSE="e-collapse",EXPAND="e-expand",TABLE="e-table",COLUMNSHEADER="e-columnsheader",ROWSHEADER="e-rowsheader",VALUESCONTENT="e-valuescontent",SUMMARY="e-summary",CELLVALUE="e-cellvalue",PIVOTTOOLTIP="e-pivottooltip",TOOLTIP_HEADER="e-tooltipheader",TOOLTIP_CONTENT="e-tooltipcontent",NEXTSPAN="e-nextspan",LASTSPAN="e-lastspan",EDITOR_SEARCH_WRAPPER_CLASS="e-editor-search-wrapper",EDITOR_SEARCH_CLASS="e-editor-search",SELECT_ALL_WRAPPER_CLASS="e-select-all-wrapper",SELECT_ALL_CLASS="e-select-all",PIVOTCALC="e-pivot-calc",CALCDIALOG="e-pivot-calc-dialog-div",CALCRADIO="e-pivot-calc-radio",CALCCHECK="e-pivot-calc-check",CALCINPUT="e-pivot-calc-input",CALCINPUTDIV="e-pivot-calc-input-div",CALCOUTERDIV="e-pivot-calc-outer-div",FLAT="e-flat",FORMAT="e-format",FORMULA="e-pivot-formula",TREEVIEW="e-pivot-treeview",TREEVIEWOUTER="e-pivot-treeview-outer",CALCCANCELBTN="e-pivot-cancel-button",CALCADDBTN="e-pivot-add-button",CALCOKBTN="e-pivot-ok-button",CALCACCORD="e-pivot-accord",CALCBUTTONDIV="e-pivot-button-div",AXIS_ICON_CLASS="e-axis",AXIS_ROW_CLASS="e-axis-row",AXIS_COLUMN_CLASS="e-axis-column",AXIS_VALUE_CLASS="e-axis-value",AXIS_FILTER_CLASS="e-axis-filter",GRID_CLASS="e-grid",PIVOT_VIEW_CLASS="e-pivotview",PIVOT_ALL_FIELD_TITLE_CLASS="e-pivot-all-field-title",PIVOT_FORMULA_TITLE_CLASS="e-pivot-formula-title",PIVOT_CONTEXT_MENU_CLASS="e-pivot-context-menu",MENU_DISABLE="e-disabled",MENU_HIDE="e-menu-hide",EMPTY_MEMBER_CLASS="e-member-prompt",CALC_EDIT="e-edit",CALC_EDITED="e-edited",EMPTY_FIELD="e-empty-field",FORMAT_DIALOG="e-pivot-formatting-dialog",FORMAT_CONDITION_BUTTON="e-format-condition-button",FORMAT_NEW="e-new-format",FORMAT_OUTER="e-format-outer-div",FORMAT_INNER="e-format-inner-div",FORMAT_TABLE="e-format-table",FORMAT_VALUE_LABEL="e-format-value-label",FORMAT_LABEL="e-format-label",INPUT="e-input",FORMAT_VALUE1="e-format-value1",FORMAT_VALUE2="e-format-value2",FORMAT_VALUE_SPAN="e-format-value-span",FORMAT_FONT_COLOR="e-format-font-color",FORMAT_BACK_COLOR="e-format-back-color",FORMAT_VALUE_PREVIEW="e-format-value-preview",FORMAT_COLOR_PICKER="e-format-color-picker",FORMAT_DELETE_ICON="e-format-delete-icon",FORMAT_DELETE_BUTTON="e-format-delete-button",SELECTED_COLOR="e-selected-color",DIALOG_HEADER="e-dlg-header",FORMAT_APPLY_BUTTON="e-format-apply-button",FORMAT_CANCEL_BUTTON="e-format-cancel-button",FORMAT_ROUND_BUTTON="e-small e-round",VIRTUALTRACK_DIV="e-virtualtrack",MOVABLECONTENT_DIV="e-movablecontent",FROZENCONTENT_DIV="e-frozencontent",MOVABLEHEADER_DIV="e-movableheader",DEFER_APPLY_BUTTON="e-defer-apply-button",DEFER_CANCEL_BUTTON="e-defer-cancel-button",LAYOUT_FOOTER="e-layout-footer",CELL_SELECTED_BGCOLOR="e-cellselectionbackground",SELECTED_BGCOLOR="e-selectionbackground",BUTTON_LAYOUT="e-button-layout",CHECKBOX_LAYOUT="e-checkbox-layout",DEFER_UPDATE_BUTTON="e-defer-update-btn",HEADERCONTENT="e-headercontent",BACK_ICON="e-field-list-back-icon",TITLE_MOBILE_HEADER="e-title-mobile-header",TITLE_MOBILE_CONTENT="e-title-mobile-content",ROW_CELL_CLASS="e-rowcell",CELL_ACTIVE_BGCOLOR="e-active",SPAN_CLICKED="e-spanclicked",ROW_SELECT="e-rowselect",GRID_HEADER="e-gridheader",GRID_EXPORT="e-export",PIVOTVIEW_EXPORT="e-pivotview-export",PIVOTVIEW_GRID="e-pivotview-grid",PIVOTVIEW_EXPAND="e-pivotview-expand",PIVOTVIEW_COLLAPSE="e-pivotview-collapse",GRID_PDF_EXPORT="e-pivotview-pdf-export",GRID_EXCEL_EXPORT="e-pivotview-excel-export",GRID_CSV_EXPORT="e-pivotview-csv-export",GRID_LOAD="e-load-report",GRID_NEW="e-new-report",GRID_RENAME="e-rename-report",GRID_REMOVE="e-remove-report",GRID_SAVEAS="e-saveas-report",GRID_SAVE="e-save-report",GRID_SUB_TOTAL="e-sub-total",GRID_GRAND_TOTAL="e-grand-total",GRID_FORMATTING="e-toolbar-formatting",GRID_TOOLBAR="e-pivot-toolbar",GRID_REPORT_LABEL="e-pivotview-report-label",GRID_REPORT_INPUT="e-pivotview-report-input",GRID_REPORT_OUTER="e-report-outer",GRID_REPORT_DIALOG="e-pivotview-report-dialog",TOOLBAR_FIELDLIST="e-toolbar-fieldlist",TOOLBAR_GRID="e-toolbar-grid",TOOLBAR_CHART="e-toolbar-chart",REPORT_LIST_DROP="e-reportlist-drop",PIVOTCHART="e-pivotchart",GROUP_CHART_ROW="e-group-chart-rows",GROUP_CHART_COLUMN="e-group-chart-columns",GROUP_CHART_VALUE="e-group-chart-values",GROUP_CHART_MULTI_VALUE="e-group-chart-multi-values",GROUP_CHART_FILTER="e-group-chart-filters",GROUP_CHART_VALUE_DROPDOWN_DIV="e-group-chart-values-drodown-div",GROUP_CHART_VALUE_DROPDOWN="e-group-chart-values-drodown",CHART_GROUPING_BAR_CLASS="e-chart-grouping-bar",PIVOT_DISABLE_ICON="e-pivotview-disable-icon",PIVOT_SELECT_ICON="e-pivotview-select-icon",VALUESHEADER="e-valuesheader",ICON_ASC="e-icon-ascending",ICON_DESC="e-icon-descending",CONTEXT_EXPAND_ID="#expand",CONTEXT_COLLAPSE_ID="#collapse",CONTEXT_DRILLTHROUGH_ID="#drillthrough",CONTEXT_SORT_ASC_ID="#sortasc",CONTEXT_SORT_DESC_ID="#sortdesc",CONTEXT_CALC_ID="#CalculatedField",CONTEXT_PDF_ID="#pdf",CONTEXT_EXCEL_ID="#excel",CONTEXT_CSV_ID="#csv",CONTEXT_EXPORT_ID="#exporting",CONTEXT_AGGREGATE_ID="#aggregate",AggregateMenu=function(){function e(e){this.parent=e}return e.prototype.render=function(e,t){this.parentElement=t,this.openContextMenu(e)},e.prototype.openContextMenu=function(e){void 0===this.menuInfo&&this.createContextMenu(),this.currentMenu=e.currentTarget;var t=this.currentMenu.getBoundingClientRect();this.parent.enableRtl?this.menuInfo.open(t.top,t.left-105):this.menuInfo.open(t.top,t.left)},e.prototype.createContextMenu=function(){var e={items:[{text:"Sum",id:"Sum"},{text:"Count",id:"Count"},{text:"Distinct Count",id:"DistinctCount"},{text:"Product",id:"Product"},{text:"Avg",id:"Avg"},{text:"Min",id:"Min"},{text:"Max",id:"Max"},{text:"More...",id:"MoreOption"}],enableRtl:this.parent.enableRtl,beforeOpen:this.beforeMenuOpen.bind(this),select:this.selectOptionInContextMenu.bind(this)},t=document.getElementById(this.parent.element.id+"valueFieldContextMenu");null!==t&&(t.innerHTML="");var i=ej2Base.createElement("ul",{id:this.parent.element.id+"valueFieldContextMenu"});this.parent.element.appendChild(i),this.menuInfo=new ej2Navigations.ContextMenu(e),this.menuInfo.appendTo(i)},e.prototype.beforeMenuOpen=function(e){e.element.style.zIndex=(this.menuInfo.element.style.zIndex+3).toString(),e.element.style.display="inline"},e.prototype.createValueSettingsDialog=function(e,t){var i=this;this.parentElement=t;var a=ej2Base.createElement("div",{id:this.parentElement.id+"_ValueDialog",className:"e-value-field-settings",attrs:{"data-field":e.id}});this.parentElement.appendChild(a),this.valueDialog=new ej2Popups.Dialog({animationSettings:{effect:"Fade"},allowDragging:!0,header:this.parent.localeObj.getConstant("valueFieldSettings"),content:this.createFieldOptions(e),isModal:!0,visible:!0,showCloseIcon:!0,enableRtl:this.parent.enableRtl,width:"auto",height:"auto",position:{X:"center",Y:"center"},buttons:[{click:this.updateValueSettings.bind(this),buttonModel:{cssClass:"e-ok-btn",content:this.parent.localeObj.getConstant("ok"),isPrimary:!0}},{click:function(){i.valueDialog.hide()},buttonModel:{cssClass:"e-cancel-btn",content:this.parent.localeObj.getConstant("cancel")}}],closeOnEscape:!0,target:this.parentElement,overlayClick:function(){i.removeDialog()},close:this.removeDialog.bind(this)}),this.valueDialog.appendTo(a)},e.prototype.createFieldOptions=function(e){var t=e.getAttribute("data-caption"),i=e.getAttribute("data-type"),a=e.getAttribute("data-basefield"),r=e.getAttribute("data-baseitem");i="undefined"!==i.toString()?i:"Sum";for(var o=[{value:"Sum",text:"Sum"},{value:"Count",text:"Count"},{value:"DistinctCount",text:"Distinct Count"},{value:"Product",text:"Product"},{value:"Avg",text:"Avg"},{value:"Min",text:"Min"},{value:"Max",text:"Max"},{value:"Index",text:"Index"},{value:"SampleStDev",text:"Sample StDev"},{value:"PopulationStDev",text:"Population StDev"},{value:"SampleVar",text:"Sample Var"},{value:"PopulationVar",text:"Population Var"},{value:"RunningTotals",text:"Running Totals"},{value:"DifferenceFrom",text:"Difference From"},{value:"PercentageOfDifferenceFrom",text:"% of Difference From"},{value:"PercentageOfGrandTotal",text:"% of Grand Total"},{value:"PercentageOfColumnTotal",text:"% of Column Total"},{value:"PercentageOfRowTotal",text:"% of Row Total"},{value:"PercentageOfParentTotal",text:"% of Parent Total"},{value:"PercentageOfParentColumnTotal",text:"% of Parent Column Total"},{value:"PercentageOfParentRowTotal",text:"% of Parent Row Total"}],n=["DifferenceFrom","PercentageOfDifferenceFrom"],s=["DifferenceFrom","PercentageOfDifferenceFrom","PercentageOfParentTotal"],l=ej2Base.extend([],this.parent.dataSource.rows,null,!0),d=[],p=[],h=0,c=l=l.concat(this.parent.dataSource.columns);h<c.length;h++){var u=c[h],g=u.name,m=u.caption?u.caption:u.name;d.push({value:g,text:m})}a="undefined"!==a.toString()?a:d[0].value,p=Object.keys(this.parent.engineModule.fieldList["undefined"!==a.toString()?a:d[0].value].formattedMembers),r="undefined"!==r.toString()?r:p[0];var v=ej2Base.createElement("div",{className:"e-value-field-div-content",id:this.parentElement.id+"_field_div_content",attrs:{"data-type":i,"data-caption":t,"data-basefield":a,"data-baseitem":r}}),f=ej2Base.createElement("div",{className:"e-field-name-text-wrapper"}),y=ej2Base.createElement("div",{className:"e-field-option-wrapper"}),S=ej2Base.createElement("div",{className:"e-type-option-wrapper"}),b=ej2Base.createElement("div",{className:"e-base-field-option-wrapper"}),C=ej2Base.createElement("div",{className:"e-base-item-option-wrapper"}),x=ej2Base.createElement("div",{className:"e-field-name-title",innerHTML:this.parent.localeObj.getConstant("sourceName")+"&nbsp;"}),w=ej2Base.createElement("div",{className:"e-field-name-content",innerHTML:e.id.toString()}),j=ej2Base.createElement("div",{className:"e-type-option-text",innerHTML:this.parent.localeObj.getConstant("sourceCaption")}),E=ej2Base.createElement("div",{className:"e-base-field-option-text",innerHTML:this.parent.localeObj.getConstant("summarizeValuesBy")}),T=ej2Base.createElement("div",{className:"e-base-item-option-text",innerHTML:this.parent.localeObj.getConstant("baseField")}),B=ej2Base.createElement("div",{className:"e-type-option-text",innerHTML:this.parent.localeObj.getConstant("baseItem")}),D=ej2Base.createElement("div",{className:"e-caption-input-wrapper"}),_=ej2Base.createElement("div",{id:this.parentElement.id+"_type_option"}),L=ej2Base.createElement("div",{id:this.parentElement.id+"_base_field_option"}),O=ej2Base.createElement("div",{id:this.parentElement.id+"_base_item_option"}),P=ej2Base.createElement("input",{id:this.parentElement.id+"type_input_option",className:"e-caption-input-text",attrs:{type:"text"}});f.appendChild(x),f.appendChild(w),D.appendChild(j),D.appendChild(P),S.appendChild(E),b.appendChild(T),C.appendChild(B),S.appendChild(_),b.appendChild(L),C.appendChild(O),y.appendChild(f),y.appendChild(D),y.appendChild(S),y.appendChild(b),y.appendChild(C),v.appendChild(y);var M=this;new ej2Dropdowns.DropDownList({dataSource:o,fields:{value:"value",text:"text"},value:i,cssClass:"e-value-options",width:"100%",change:function(e){A.enabled=-1!==s.indexOf(e.value),I.enabled=-1!==n.indexOf(e.value),I.enabled&&1===I.dataSource.length&&(I.dataSource=p,I.dataBind())}}).appendTo(_);var A=new ej2Dropdowns.DropDownList({dataSource:d,enableRtl:this.parent.enableRtl,fields:{value:"value",text:"text"},value:a,enabled:-1!==s.indexOf(i),cssClass:"e-value-options",width:"100%",change:function(e){p=Object.keys(M.parent.engineModule.fieldList[e.value].formattedMembers),I.dataSource=p,I.value=p[0],I.filterBarPlaceholder=M.parent.localeObj.getConstant("example")+" "+p[0],I.dataBind()}});A.appendTo(L);var I=new ej2Dropdowns.DropDownList({dataSource:[p[0]],enableRtl:this.parent.enableRtl,value:r,allowFiltering:!0,filterBarPlaceholder:this.parent.localeObj.getConstant("example")+" "+p[0],enabled:-1!==n.indexOf(i),cssClass:"e-filter-operator",width:"100%"});return I.appendTo(O),new ej2Inputs.MaskedTextBox({placeholder:"Enter field caption",enableRtl:this.parent.enableRtl,value:t,width:"100%"}).appendTo(P),v},e.prototype.selectOptionInContextMenu=function(e){if(null!==e.item.text){var t=this.currentMenu.parentElement;if("MoreOption"===e.item.id)this.createValueSettingsDialog(t,this.parentElement);else{var i=t.getAttribute("data-uid"),a=this.parent.dataSource.values,r=t.querySelector(".e-content"),o=e.item.text+" of "+this.parent.engineModule.fieldList[i].caption;r.innerHTML=o,r.setAttribute("title",o),t.setAttribute("data-type",e.item.id);for(var n=0;n<this.parent.dataSource.values.length;n++)if(this.parent.dataSource.values[n].name===i){var s=a[n].properties?a[n].properties:a[n];s.type=e.item.id,this.parent.lastAggregationInfo=s}this.updateDataSource()}}},e.prototype.updateDataSource=function(e){this.parent.allowDeferLayoutUpdate&&"pivotview"!==this.parent.getModuleName()?"pivotfieldlist"===this.parent.getModuleName()&&"Popup"===this.parent.renderMode?(this.parent.pivotGridModule.setProperties({dataSource:this.parent.dataSource.properties},!0),this.parent.pivotGridModule.notify(uiUpdate,this),this.parent.pivotGridModule.engineModule=this.parent.engineModule):this.parent.triggerPopulateEvent():this.parent.updateDataSource(e)},e.prototype.updateValueSettings=function(){var e,t=this.valueDialog.element,i=ej2Base.getInstance("#"+this.parentElement.id+"type_input_option",ej2Inputs.MaskedTextBox),a=ej2Base.getInstance("#"+this.parentElement.id+"_type_option",ej2Dropdowns.DropDownList),r=ej2Base.getInstance("#"+this.parentElement.id+"_base_field_option",ej2Dropdowns.DropDownList),o=ej2Base.getInstance("#"+this.parentElement.id+"_base_item_option",ej2Dropdowns.DropDownList),n=t.getAttribute("data-field");if(this.parentElement.querySelector(".e-pivot-button")&&(e=this.parentElement.querySelector(".e-pivot-button#"+n)),e){var s=e.querySelector(".e-content"),l=this.parent.localeObj.getConstant(a.value)+" of "+i.value;s.innerHTML=l,s.setAttribute("title",l),e.setAttribute("data-type",a.value),e.setAttribute("data-caption",i.value),e.setAttribute("data-basefield",r.value),e.setAttribute("data-baseitem",o.value)}var d=this.parent.pivotCommon.eventBase.getFieldByName(n,this.parent.dataSource.values);(d=d.properties?d.properties:d).caption=i.value,d.type=a.value,d.baseField=r.value,d.baseItem=o.value,this.valueDialog.close(),this.parent.lastAggregationInfo=d,this.updateDataSource(!0)},e.prototype.removeDialog=function(){this.valueDialog&&!this.valueDialog.isDestroyed&&this.valueDialog.destroy(),document.getElementById(this.parentElement.id+"_ValueDialog")&&ej2Base.remove(document.getElementById(this.parentElement.id+"_ValueDialog"))},e.prototype.destroy=function(){this.parent.isDestroyed||this.menuInfo&&!this.menuInfo.isDestroyed&&this.menuInfo.destroy()},e}(),Render=function(){function e(e){this.colPos=0,this.lastSpan=0,this.parent=e,this.resColWidth=this.parent.showGroupingBar&&this.parent.groupingBarModule?this.parent.isAdaptive?180:249:this.parent.isAdaptive?140:200,this.engine=e.engineModule,this.gridSettings=e.gridSettings,this.formatList=this.getFormatList(),this.aggMenu=new AggregateMenu(this.parent)}return e.prototype.render=function(){this.parent.gridHeaderCellInfo=[];var e=this.parent,t=this.parent.engineModule;this.injectGridModules(e),this.rowStartPos=this.getRowStartPos(),this.parent.grid&&this.parent.grid.element&&this.parent.element.querySelector(".e-grid")?(t.isEngineUpdated?(this.parent.enableValueSorting&&(t.valueContent=this.frameDataSource("value")),t.isEngineUpdated=!1):(t.headerContent=this.frameDataSource("header"),t.valueContent=this.frameDataSource("value")),this.parent.grid.setProperties({columns:this.frameStackedHeaders(),dataSource:e.dataSource.values.length>0&&!this.engine.isEmptyData?t.valueContent:this.frameDataSource("value")},!0),this.parent.grid.notify("datasource-modified",{}),this.parent.grid.refreshColumns(),this.parent.element.querySelector(".e-movablecontent").querySelector("colGroup").innerHTML=this.parent.grid.getHeaderContent().querySelector(".e-movableheader").querySelector("colgroup").innerHTML,this.parent.grid.width=this.calculateGridWidth(),this.parent.height>this.engine.valueContent.length*this.gridSettings.rowHeight?this.parent.grid.height="auto":this.parent.grid.height=this.parent.height):(this.parent.element.innerHTML="",this.bindGrid(this.parent,!!this.engine.isEmptyData),this.parent.element.appendChild(ej2Base.createElement("div",{id:this.parent.element.id+"_grid"})),this.parent.grid.appendTo("#"+this.parent.element.id+"_grid")),this.parent.grid.on(ej2Grids.headerRefreshed,this.refreshHeader,this)},e.prototype.refreshHeader=function(){if(this.parent.enableVirtualization){var e=this.parent.element.querySelector(".e-movableheader"),t=this.parent.element.querySelector(".e-movablecontent"),i=t.querySelector(".e-virtualtrack");this.parent.virtualHeaderDiv=e.querySelector(".e-virtualtrack"),e.querySelector(".e-virtualtrack")?ej2Base.remove(e.querySelector(".e-virtualtrack")):this.parent.virtualHeaderDiv=ej2Base.createElement("div",{className:"e-virtualtrack"}),e.appendChild(this.parent.virtualHeaderDiv),i&&ej2Base.setStyleAttribute(this.parent.virtualHeaderDiv,{height:0,width:i.style.width}),ej2Base.setStyleAttribute(e.querySelector(".e-table"),{transform:t.querySelector(".e-table").style.transform.split(",")[0]+",0px)"}),e.scrollLeft=t.scrollLeft}},e.prototype.bindGrid=function(e,t){this.injectGridModules(e),this.parent.grid=new ej2Grids.Grid({frozenColumns:1,frozenRows:0,dataSource:t?this.frameEmptyData():this.frameDataSource("value"),columns:t?this.frameEmptyColumns():this.frameStackedHeaders(),height:this.engine&&e.height>this.engine.valueContent.length*this.gridSettings.rowHeight||t?"auto":e.height,width:t?this.parent.width:this.calculateGridWidth(),locale:e.locale,enableRtl:e.enableRtl,allowExcelExport:e.allowExcelExport,allowPdfExport:e.allowPdfExport,allowResizing:this.gridSettings.allowResizing,allowTextWrap:this.gridSettings.allowTextWrap,allowReordering:this.gridSettings.allowReordering,allowSelection:this.gridSettings.allowSelection,contextMenuItems:this.gridSettings.contextMenuItems,selectedRowIndex:this.gridSettings.selectedRowIndex,selectionSettings:this.gridSettings.selectionSettings,printMode:this.gridSettings.printMode,rowHeight:this.gridSettings.rowHeight,gridLines:this.gridSettings.gridLines,contextMenuClick:this.contextMenuClick.bind(this),contextMenuOpen:this.contextMenuOpen.bind(this),beforeCopy:this.gridSettings.beforeCopy?this.gridSettings.beforeCopy.bind(this.parent):void 0,beforePrint:this.gridSettings.beforePrint?this.gridSettings.beforePrint.bind(this.parent):void 0,printComplete:this.gridSettings.printComplete?this.gridSettings.printComplete.bind(this.parent):void 0,rowSelecting:this.gridSettings.rowSelecting?this.gridSettings.rowSelecting.bind(this.parent):void 0,rowSelected:this.rowSelected.bind(this),rowDeselecting:this.gridSettings.rowDeselecting?this.gridSettings.rowDeselecting.bind(this.parent):void 0,rowDeselected:this.rowDeselected.bind(this),cellSelecting:this.gridSettings.cellSelecting?this.gridSettings.cellSelecting.bind(this.parent):void 0,cellSelected:this.cellSelected.bind(this),cellDeselecting:this.gridSettings.cellDeselecting?this.gridSettings.cellDeselecting.bind(this.parent):void 0,cellDeselected:this.cellDeselected.bind(this),resizeStart:this.gridSettings.resizeStart?this.gridSettings.resizeStart.bind(this.parent):void 0,columnDragStart:this.gridSettings.columnDragStart?this.gridSettings.columnDragStart.bind(this):void 0,columnDrag:this.gridSettings.columnDrag?this.gridSettings.columnDrag.bind(this):void 0,columnDrop:this.gridSettings.columnDrop?this.gridSettings.columnDrop.bind(this):void 0,resizing:this.setGroupWidth.bind(this),resizeStop:this.onResizeStop.bind(this),queryCellInfo:this.queryCellInfo.bind(this),dataBound:this.dataBound.bind(this),headerCellInfo:this.headerCellInfo.bind(this),excelHeaderQueryCellInfo:this.excelHeaderQueryCellInfo.bind(this),pdfHeaderQueryCellInfo:this.pdfHeaderQueryCellInfo.bind(this),excelQueryCellInfo:this.excelQueryCellInfo.bind(this),pdfQueryCellInfo:this.pdfQueryCellInfo.bind(this)})},e.prototype.rowSelected=function(e){this.parent.renderModule.selected(),this.parent.trigger("rowSelected",e)},e.prototype.rowDeselected=function(e){this.parent.renderModule.selected(),this.parent.trigger("rowDeselected",e)},e.prototype.cellSelected=function(e){this.parent.rowRangeSelection.enable?(this.parent.grid.selectionModule.selectRowsByRange(this.parent.rowRangeSelection.startIndex,this.parent.rowRangeSelection.endIndex),this.parent.rowRangeSelection.enable=!1):(this.parent.renderModule.selected(),this.parent.trigger("selected",e))},e.prototype.cellDeselected=function(e){this.parent.renderModule.selected(),this.parent.trigger("cellDeselected",e)},e.prototype.queryCellInfo=function(e){this.parent.renderModule.rowCellBoundEvent(e)},e.prototype.headerCellInfo=function(e){this.parent.renderModule.columnCellBoundEvent(e)},e.prototype.excelHeaderQueryCellInfo=function(e){this.parent.renderModule.excelColumnEvent(e)},e.prototype.pdfQueryCellInfo=function(e){this.parent.renderModule.pdfRowEvent(e)},e.prototype.excelQueryCellInfo=function(e){this.parent.renderModule.excelRowEvent(e)},e.prototype.pdfHeaderQueryCellInfo=function(e){this.parent.renderModule.pdfColumnEvent(e)},e.prototype.dataBound=function(e){if(this.parent.cellTemplate){for(var t=0,i=this.parent.gridHeaderCellInfo;t<i.length;t++){var a=i[t];this.parent.cellTemplate&&ej2Base.append([].slice.call(this.parent.getCellTemplate()(a,this.parent,"cellTemplate")),a.targetCell)}this.parent.gridHeaderCellInfo=[]}this.parent.element.querySelector(".e-firstcell")&&(this.parent.enableRtl?this.parent.element.querySelector(".e-firstcell").style.borderRight="none":this.parent.element.querySelector(".e-firstcell").style.borderLeft="none"),this.parent.grid.widthService.setWidthToTable(),this.parent.notify(contentReady,{})},e.prototype.contextMenuOpen=function(e){for(var t=0,i=e.items;t<i.length;t++){var a=i[t],r=this.parent.lastCellClicked,o=null,n=void 0;r.classList.contains("e-stackedheadercelldiv")||r.classList.contains("e-cellvalue")||r.classList.contains("e-headercelldiv")||r.classList.contains("e-icons")||r.classList.contains("e-rhandler")?o=r.parentElement:r.classList.contains("e-headercell")||r.classList.contains("e-rowcell")||r.classList.contains("e-columnsheader")||r.classList.contains("e-rowsheader")||r.classList.contains("e-valuescontent")||r.classList.contains("e-valuesheader")?o=r:r.classList.contains("e-headertext")&&(o=r.parentElement.parentElement),(o.classList.contains("e-valuesheader")||o.classList.contains("e-stot"))&&(n=!0);var s=Number(o.getAttribute("index")),l=Number(o.getAttribute("aria-colindex"));this.parent.pivotValues[s][l];switch(a.id){case"expand":o.querySelectorAll("."+EXPAND).length>0?(e.element.querySelectorAll("#collapse")&&e.element.querySelector("#collapse").classList.add("e-disabled"),e.element.querySelector("#expand").classList.contains("e-disabled")&&e.element.querySelector("#expand").classList.remove("e-disabled"),e.element.querySelector("#expand").classList.contains(MENU_HIDE)&&(e.element.querySelector("#expand").classList.remove(MENU_HIDE),e.element.querySelector("#collapse").classList.remove(MENU_HIDE))):n?e.element.querySelector("#expand").classList.add(MENU_HIDE):e.element.querySelector("#expand").classList.add("e-disabled");break;case"collapse":o.querySelectorAll("."+COLLAPSE).length>0?(e.element.querySelector("#expand")&&e.element.querySelector("#expand").classList.add("e-disabled"),e.element.querySelector("#collapse").classList.contains("e-disabled")&&e.element.querySelector("#collapse").classList.remove("e-disabled"),e.element.querySelector("#collapse").classList.contains(MENU_HIDE)&&(e.element.querySelector("#collapse").classList.remove(MENU_HIDE),e.element.querySelector("#expand").classList.remove(MENU_HIDE))):n?e.element.querySelector("#collapse").classList.add(MENU_HIDE):e.element.querySelector("#collapse").classList.add("e-disabled");break;case"drillthrough":this.parent.allowDrillThrough?o.classList.contains("e-summary")?e.element.querySelector("#drillthrough").classList.contains("e-disabled")&&e.element.querySelector("#drillthrough").classList.remove("e-disabled"):""===o.innerText&&e.element.querySelector("#drillthrough")&&e.element.querySelector("#drillthrough").classList.add("e-disabled"):e.element.querySelector("#drillthrough")&&e.element.querySelector("#drillthrough").classList.add("e-disabled");break;case"sortasc":this.parent.enableValueSorting?o.querySelectorAll(".e-icon-descending").length>0?(e.element.querySelector("#sortdesc")?e.element.querySelector("#sortdesc").classList.add("e-disabled"):e.element.querySelector("#sortdesc").classList.remove("e-disabled"),e.element.querySelector("#sortasc").classList.contains("e-disabled")&&e.element.querySelector("#sortasc").classList.remove("e-disabled")):e.element.querySelector("#sortdesc").classList.contains("e-disabled")&&e.element.querySelector("#sortdesc").classList.remove("e-disabled"):e.element.querySelector("#sortasc")&&e.element.querySelector("#sortasc").classList.add("e-disabled");break;case"sortdesc":this.parent.enableValueSorting?o.querySelectorAll(".e-icon-ascending").length>0?(e.element.querySelector("#sortasc")?e.element.querySelector("#sortasc").classList.add("e-disabled"):e.element.querySelector("#sortasc").classList.remove("e-disabled"),e.element.querySelector("#sortdesc").classList.contains("e-disabled")&&e.element.querySelector("#sortdesc").classList.remove("e-disabled")):e.element.querySelector("#sortasc").classList.contains("e-disabled")&&e.element.querySelector("#sortasc").classList.remove("e-disabled"):e.element.querySelector("#sortdesc")&&e.element.querySelector("#sortdesc").classList.add("e-disabled");break;case"CalculatedField":this.parent.allowCalculatedField||e.element.querySelector("#CalculatedField").classList.add("e-disabled");break;case"pdf":this.parent.allowPdfExport||e.element.querySelector("#pdf").classList.add("e-disabled");break;case"excel":this.parent.allowExcelExport||e.element.querySelector("#excel").classList.add("e-disabled");break;case"csv":this.parent.allowExcelExport||e.element.querySelector("#csv").classList.add("e-disabled");break;case"exporting":this.parent.allowExcelExport||this.parent.allowPdfExport||e.element.querySelector("#exporting").classList.add("e-disabled");break;case"aggregate":""===o.innerText?e.element.querySelector("#aggregate")&&e.element.querySelector("#aggregate").classList.add("e-disabled"):e.element.querySelector("#aggregate").classList.contains("e-disabled")&&e.element.querySelector("#aggregate").classList.remove("e-disabled")}}this.parent.trigger("contextMenuOpen",e)},e.prototype.contextMenuClick=function(e){var t=this.parent.lastCellClicked,i=e.item.id,a=new MouseEvent("dblclick",{view:window,bubbles:!0,cancelable:!0}),r=null;t.classList.contains("e-stackedheadercelldiv")||t.classList.contains("e-cellvalue")||t.classList.contains("e-headercelldiv")||t.classList.contains("e-icons")||t.classList.contains("e-rhandler")?r=t.parentElement:t.classList.contains("e-headercell")||t.classList.contains("e-rowcell")?r=t:t.classList.contains("e-headertext")&&(r=t.parentElement.parentElement);var o=Number(r.getAttribute("index")),n=Number(r.getAttribute("aria-colindex")),s=this.parent.pivotValues[o][n];switch("AggSum"!==e.item.id&&"AggProduct"!==e.item.id&&"AggCount"!==e.item.id&&"AggDistinctCount"!==e.item.id&&"AggAvg"!==e.item.id&&"AggMin"!==e.item.id&&"AggMax"!==e.item.id&&"AggMoreOption"!==e.item.id||(this.field=this.parent.engineModule.fieldList[s.actualText.toString()].caption),i){case"pdf":this.parent.pdfExport();break;case"excel":this.parent.excelExport();break;case"csv":this.parent.csvExport();break;case"drillthrough":r.dispatchEvent(a);break;case"sortasc":this.parent.setProperties({dataSource:{valueSortSettings:{headerText:s.valueSort.levelName,headerDelimiter:this.parent.dataSource.valueSortSettings.headerDelimiter}}}),this.parent.dataSource.valueSortSettings.sortOrder="Ascending";break;case"sortdesc":this.parent.setProperties({dataSource:{valueSortSettings:{headerText:s.valueSort.levelName,headerDelimiter:this.parent.dataSource.valueSortSettings.headerDelimiter}}}),this.parent.dataSource.valueSortSettings.sortOrder="Descending";break;case"expand":if(r.querySelectorAll("."+EXPAND)){var l=r.querySelectorAll("."+EXPAND)[0];this.parent.onDrill(l)}break;case"collapse":if(r.querySelectorAll("."+COLLAPSE)){var d=r.querySelectorAll("."+COLLAPSE)[0];this.parent.onDrill(d)}break;case"CalculatedField":this.parent.calculatedFieldModule.createCalculatedFieldDialog();break;case"AggSum":this.updateAggregate("Sum");break;case"AggProduct":this.updateAggregate("Product");break;case"AggCount":this.updateAggregate("Count");break;case"AggDistinctCount":this.updateAggregate("DistinctCount");break;case"AggAvg":this.updateAggregate("Avg");break;case"AggMin":this.updateAggregate("Min");break;case"AggMax":this.updateAggregate("Max");break;case"AggMoreOption":r.setAttribute("id",this.field),r.setAttribute("data-caption",this.field),r.setAttribute("data-field",this.field),r.setAttribute("data-type",this.parent.engineModule.fieldList[s.actualText.toString()].aggregateType),r.setAttribute("data-basefield",this.parent.engineModule.fieldList[s.actualText.toString()].baseField),r.setAttribute("data-baseItem",this.parent.engineModule.fieldList[s.actualText.toString()].baseItem),this.aggMenu.createValueSettingsDialog(r,this.parent.element)}this.parent.trigger("contextMenuClick",e)},e.prototype.updateAggregate=function(e){for(var t=this.parent.dataSource.values,i=0;i<this.parent.dataSource.values.length;i++)this.parent.dataSource.values[i].name===this.field&&(t[i].type=e)},e.prototype.injectGridModules=function(e){ej2Grids.Grid.Inject(ej2Grids.Freeze),e.allowExcelExport&&ej2Grids.Grid.Inject(ej2Grids.ExcelExport),e.allowPdfExport&&ej2Grids.Grid.Inject(ej2Grids.PdfExport),this.gridSettings.allowSelection&&ej2Grids.Grid.Inject(ej2Grids.Selection),this.gridSettings.allowReordering&&ej2Grids.Grid.Inject(ej2Grids.Reorder),this.gridSettings.allowResizing&&ej2Grids.Grid.Inject(ej2Grids.Resize),this.gridSettings.contextMenuItems&&ej2Grids.Grid.Inject(ej2Grids.ContextMenu)},e.prototype.updateGridSettings=function(){this.injectGridModules(this.parent),this.parent.grid.allowResizing=this.gridSettings.allowResizing,this.parent.grid.allowTextWrap=this.gridSettings.allowTextWrap,this.parent.grid.allowReordering=this.gridSettings.allowReordering,this.parent.grid.allowSelection=this.gridSettings.allowSelection,this.parent.grid.contextMenuItems=this.gridSettings.contextMenuItems,this.parent.grid.selectedRowIndex=this.gridSettings.selectedRowIndex,this.parent.grid.selectionSettings=this.gridSettings.selectionSettings,this.parent.grid.printMode=this.gridSettings.printMode,this.parent.grid.rowHeight=this.gridSettings.rowHeight,this.parent.grid.gridLines=this.gridSettings.gridLines,this.clearColumnSelection()},e.prototype.clearColumnSelection=function(){this.parent.element.querySelectorAll(".e-active").forEach(function(e){e.classList.remove("e-active"),e.classList.remove(SELECTED_BGCOLOR)})},e.prototype.appendValueSortIcon=function(e,t,i,a){var r=this.parent.dataSource.valueSortSettings,o="grand sum"!==e.type||1!==this.parent.dataSource.values.length||this.parent.dataSource.alwaysShowValueHeader?this.parent.dataSource.values.length>1||this.parent.dataSource.alwaysShowValueHeader?this.parent.engineModule.headerContent.length-1:0===this.parent.dataSource.columns.length?0:this.parent.engineModule.headerContent.length-1:0,n=r&&r.headerText?e.valueSort.levelName===r.headerText:a===r.columnIndex;if(void 0!==r&&n&&i===o&&"column"===this.parent.dataSource.valueAxis&&(t.querySelector(".e-sortfilterdiv")?(t.querySelector(".e-sortfilterdiv").classList.add("Descending"===r.sortOrder?"e-descending":"e-ascending"),t.querySelector(".e-sortfilterdiv").classList.add("Descending"===r.sortOrder?"e-icon-descending":"e-icon-ascending")):t.appendChild(ej2Base.createElement("div",{className:"Descending"===r.sortOrder?"e-icon-descending e-icons e-descending e-sortfilterdiv":"e-icon-ascending e-icons e-ascending e-sortfilterdiv"})),!ej2Base.isNullOrUndefined(e.hasChild)&&"grand sum"!==e.type&&t.querySelector(".e-expand")&&(t.querySelector(".e-icon-descending")||t.querySelector(".e-icon-ascending")))){var s=t.querySelector(".e-icon-descending")||t.querySelector(".e-icon-ascending");ej2Base.setStyleAttribute(s,{"padding-top":"12px"})}return t},e.prototype.onResizeStop=function(e){var t="0.formattedText"===e.column.field?"0.formattedText":e.column.customAttributes.cell.valueSort.levelName;this.parent.resizeInfo[t]=Number(e.column.width.toString().split("px")[0]),this.setGroupWidth(e)},e.prototype.setGroupWidth=function(e){if(this.parent.showGroupingBar&&this.parent.groupingBarModule&&this.parent.element.querySelector(".e-grouping-bar")){if(this.parent.groupingBarModule.refreshUI(),this.parent.element.querySelector(".e-group-row").offsetWidth<245&&!this.parent.firstColWidth){e.cancel=!0;var t=this.parent.grid.columns;t&&t.length>0&&(t[0].width=this.resColWidth),this.parent.element.querySelector(".e-frozenheader").querySelector("col").style.width=this.resColWidth+"px",this.parent.element.querySelector(".e-frozencontent").querySelector("col").style.width=this.resColWidth+"px"}this.parent.element.querySelector(".e-group-values").style.width=this.parent.element.querySelector(".e-group-row").offsetWidth+"px",this.parent.element.querySelector(".e-group-row").style.height=this.parent.element.querySelector(".e-headercontent").offsetHeight+"px"}this.parent.trigger("touchend"===e.e.type||"mouseup"===e.e.type?"resizeStop":"resizing",e)},e.prototype.selected=function(){clearTimeout(this.timeOutObj),this.timeOutObj=setTimeout(this.onSelect.bind(this),300)},e.prototype.onSelect=function(){for(var e={selectedCellsInfo:[],pivotValues:this.parent.pivotValues},t=0,i=this.parent.element.querySelectorAll(".e-cellselectionbackground,."+SELECTED_BGCOLOR);t<i.length;t++){var a=i[t],r=Number(a.getAttribute("aria-colindex")),o=Number(a.getAttribute("index")),n=this.engine.pivotValues[o][r];n&&("value"===n.axis?e.selectedCellsInfo.push({currentCell:n,value:n.value,columnHeaders:n.columnHeaders,rowHeaders:n.rowHeaders,measure:n.actualText.toString()}):"column"===n.axis?e.selectedCellsInfo.push({currentCell:n,value:n.formattedText,columnHeaders:n.valueSort.levelName,rowHeaders:"",measure:""}):e.selectedCellsInfo.push({currentCell:n,value:n.formattedText,columnHeaders:"",rowHeaders:n.valueSort.levelName,measure:""}))}this.parent.trigger("cellSelected",e)},e.prototype.rowCellBoundEvent=function(e){var t=e.cell;if(t&&!this.parent.isEmptyGrid){var i=this.parent.hyperlinkSettings.cssClass;t.setAttribute("index",(Number(t.getAttribute("index"))+this.engine.headerContent.length).toString());var a=e.data[0];if("0"===t.getAttribute("aria-colindex")){var r=a.type&&"value"===a.type;t.innerText="";var o=a.level?a.level:r?this.lastSpan+1:0;do{o>0&&t.appendChild(ej2Base.createElement("span",{className:0===o?"":"e-nextspan"})),o--}while(o>-1);o=a.level?a.level:0,this.lastSpan=r?this.lastSpan:o,!a.hasChild&&o>0&&t.appendChild(ej2Base.createElement("span",{className:"e-lastspan"}));var n=void 0;this.parent.dataSource.rows.length>0&&(!a.valueSort||Object.keys(a.valueSort).length>0)&&(n=o>-1?this.parent.dataSource.rows[o].name:"",t.setAttribute("fieldname",n));var s=a.formattedText;a.type&&("grand sum"===a.type?(t.classList.add("e-gtot"),s=this.parent.localeObj.getConstant("grandTotal")):t.classList.add("e-stot")),t.classList.add("e-rowsheader"),!0===a.hasChild&&t.appendChild(ej2Base.createElement("div",{className:(!0===a.isDrilled?COLLAPSE:EXPAND)+" "+ICON,attrs:{title:!0===a.isDrilled?this.parent.localeObj.getConstant("collapse"):this.parent.localeObj.getConstant("expand")}})),t.appendChild(ej2Base.createElement("span",{className:"e-cellvalue",innerHTML:this.parent.isRowCellHyperlink||a.enableHyperlink?'<a  data-url="'+s+'" class="e-hyperlinkcell '+i+'">'+s+"</a>":s}));var l=this.parent.pivotView.dataSource.valueSortSettings;if(l&&l.headerText&&"row"===this.parent.dataSource.valueAxis&&this.parent.pivotValues[Number(t.getAttribute("index"))][0].valueSort.levelName&&this.parent.pivotValues[Number(t.getAttribute("index"))][0].valueSort.levelName===l.headerText){var d=t.querySelector(".e-expand")||t.querySelector(".e-collapse")?"padding-top: 18px":"padding-top: 12px";t.appendChild(ej2Base.createElement("div",{className:"Descending"===l.sortOrder?"e-icon-descending e-icons e-descending e-sortfilterdiv":"e-icon-ascending e-icons e-ascending e-sortfilterdiv",styles:d}))}}else{var p=t.innerText;t.innerText="",t.classList.add("e-valuescontent"),(a=e.data[Number(t.getAttribute("aria-colindex"))]).isSum&&t.classList.add("e-summary"),a.cssClass&&t.classList.add(a.cssClass),t.appendChild(ej2Base.createElement("span",{className:"e-cellvalue",innerHTML:-1!==t.className.indexOf("e-summary")&&this.parent.isSummaryCellHyperlink||-1===t.className.indexOf("e-summary")&&this.parent.isValueCellHyperlink||a.enableHyperlink?'<a data-url="'+p+'" class="e-hyperlinkcell '+i+'">'+p+"</a>":p}))}this.parent.cellTemplate&&ej2Base.append([].slice.call(this.parent.getCellTemplate()({targetCell:t},this.parent,"cellTemplate")),t),this.unWireEvents(t),this.wireEvents(t)}this.parent.trigger("queryCellInfo",e)},e.prototype.columnCellBoundEvent=function(e){if(e.cell.column&&e.cell.column.customAttributes){var t=e.cell.column.customAttributes.cell,i=e.node;if(t){var a=this.parent.hyperlinkSettings.cssClass,r=t.level?t.level:0;-1===t.level&&!t.rowSpan&&t.rowIndex!==this.engine.headerContent.length-1||-1===t.rowSpan?e.node.style.display="none":t.rowSpan>1&&(e.node.setAttribute("rowspan",t.rowSpan.toString()),e.node.setAttribute("aria-rowspan",t.rowSpan.toString()),t.rowIndex+t.rowSpan===this.engine.headerContent.length&&(e.node.style.borderBottomWidth="0px")),e.node.setAttribute("aria-colindex",t.colIndex.toString()),e.node.setAttribute("index",t.rowIndex.toString());var o=void 0;if(!(this.parent.dataSource.values&&"column"===this.parent.dataSource.valueAxis&&this.parent.dataSource.values.length>1&&t.rowIndex===this.engine.headerContent.length-1)&&this.parent.dataSource.columns&&this.parent.dataSource.columns.length>0&&(o=r>-1?this.parent.dataSource.columns[r].name:"",i.setAttribute("fieldname",o)),t.type){i.classList.add("grand sum"===t.type?"e-gtot":"e-stot");var n="grand sum"===t.type?this.parent.localeObj.getConstant("grandTotal"):t.formattedText.split("Total")[0]+this.parent.localeObj.getConstant("total");null!==i.querySelector(".e-headertext")?i.querySelector(".e-headertext").innerText=n:i.querySelector(".e-stackedheadercelldiv").innerText=n}if(i.classList.add("e-columnsheader"),this.parent.isColumnCellHyperlink||t.enableHyperlink)if(i.querySelector(".e-stackedheadercelldiv")){s=i.querySelector(".e-stackedheadercelldiv").innerText;i.querySelector(".e-stackedheadercelldiv").innerHTML='<a data-url="'+s+'" class="e-hyperlinkcell '+a+'">'+s+"</a>"}else if(i.querySelector(".e-headertext")){var s=i.querySelector(".e-headertext").innerText;i.querySelector(".e-headertext").innerHTML='<a data-url="'+s+'" class="e-hyperlinkcell '+a+'">'+s+"</a>"}if(!0===t.hasChild){var l=i.querySelector(".e-headercelldiv");l&&(l.style.height="auto",l.style.lineHeight="normal");var d=ej2Base.createElement("div",{className:(!0===t.isDrilled?COLLAPSE:EXPAND)+" "+ICON,attrs:{title:!0===t.isDrilled?this.parent.localeObj.getConstant("collapse"):this.parent.localeObj.getConstant("expand")}});i.children[0].classList.add("e-cellvalue"),window.navigator.userAgent.indexOf("Edge")>-1||window.navigator.userAgent.indexOf("Trident")>-1?i.children[0].style.display="table":i.children[0].style.display="block",i.insertBefore(d,i.children[0])}if(i=this.appendValueSortIcon(t,i,t.rowIndex,t.colIndex),this.parent.cellTemplate)try{this.parent.getCellTemplate()()&&(this.parent.gridHeaderCellInfo=[],ej2Base.append([].slice.call(this.parent.getCellTemplate()({targetCell:i},this.parent,"cellTemplate")),i))}catch(e){this.parent.gridHeaderCellInfo.push({targetCell:i})}for(var p=this.parent.dataSource.values.length,h=0;h<p;h++)this.parent.dataSource.values[h].name===t.actualText&&i.classList.add("e-valuesheader");this.unWireEvents(i),this.wireEvents(i)}}this.parent.trigger("headerCellInfo",e)},e.prototype.onHyperCellClick=function(e){var t=e.target.parentElement.parentElement,i={currentCell:t=t.className.indexOf("e-headercelldiv")>-1?t.parentElement:t,data:this.engine.pivotValues[Number(t.getAttribute("index"))][Number(t.getAttribute("aria-colindex"))],cancel:!0};this.parent.trigger("hyperlinkCellClick",i),i.cancel||window.open(e.target.getAttribute("data-url"))},e.prototype.getRowStartPos=function(){for(var e,t=this.parent.pivotValues,i=0;i<t.length;i++)if(t[i]&&t[i][0]&&"row"===t[i][0].axis){e=i;break}return e},e.prototype.frameDataSource=function(e){var t=[];if(this.parent.dataSource.values.length>0&&!this.engine.isEmptyData)if(this.parent.enableValueSorting||!this.engine.isEngineUpdated){for(var i=0,a=this.parent.pivotValues,r="value"===e?this.rowStartPos:0,o="value"===e?a.length:this.rowStartPos,n=r;n<o;n++)if(a[n]){t[i="header"===e?n:i]={};for(var s=0;s<a[n].length;s++)a[n][s]&&(t[i][s]=a[n][s]);i++}}else t="value"===e?this.engine.valueContent:this.engine.headerContent;else t=this.frameEmptyData();return t},e.prototype.frameEmptyData=function(){return[{0:{formattedText:this.parent.localeObj.getConstant("grandTotal")},1:{formattedText:this.parent.localeObj.getConstant("emptyData")}}]},e.prototype.calculateColWidth=function(e){var t=isNaN(this.parent.width)?this.parent.width.toString().indexOf("%")>-1?parseFloat(this.parent.width.toString())/100*this.parent.element.offsetWidth:this.parent.element.offsetWidth:Number(this.parent.width);return t-=this.gridSettings.columnWidth>this.resColWidth?this.gridSettings.columnWidth:this.resColWidth,(e-=1)*this.gridSettings.columnWidth+78<t?t/e:this.gridSettings.columnWidth},e.prototype.resizeColWidth=function(e){var t=isNaN(this.parent.width)?this.parent.width.toString().indexOf("%")>-1?parseFloat(this.parent.width.toString())/100*this.parent.element.offsetWidth:this.parent.element.offsetWidth:Number(this.parent.width);return e*this.gridSettings.columnWidth+78<t?t/e:this.gridSettings.columnWidth},e.prototype.calculateGridWidth=function(){var e=this.parent.width;return"auto"===this.parent.width&&this.parent.element.offsetWidth<this.parent.totColWidth&&(e=this.parent.element.offsetWidth),e},e.prototype.frameStackedHeaders=function(){var e=[];if(this.parent.dataSource.values.length>0&&!this.engine.isEmptyData){var t=this.engine.headerContent.length,i=[],a=[],r=this.calculateColWidth(this.engine.pivotValues[0].length);do{var o=[],n=0;t--;var s=this.engine.headerContent[t];if(s)for(var l=0;l<Object.keys(s).length+(s[0]?0:1);l++){var d=s[l]&&s[l].colSpan?s[l].colSpan:1,p=(s[l]&&s[l].rowSpan&&s[l].rowSpan,s[l]?"grand sum"===s[l].type?this.parent.localeObj.getConstant("grandTotal"):"sum"===s[l].type?s[l].formattedText.split("Total")[0]+this.parent.localeObj.getConstant("total"):s[l].formattedText:"");if(t===this.engine.headerContent.length-1)o[n]={field:l+".formattedText",headerText:p,customAttributes:{cell:s[l]},width:s[l]?this.setSavedWidth(s[l].valueSort.levelName,r):this.resColWidth,minWidth:30,format:0===l?"":this.formatList[(l-1)%this.parent.dataSource.values.length],allowReordering:this.parent.gridSettings.allowReordering,allowResizing:this.parent.gridSettings.allowResizing,visible:!0};else if(i[l]){for(var h=d,c=[],u=l;h>0;){if(o[n]){if(!e[a[u]])break;c.push(e[a[u]])}else o[n]={headerText:p,customAttributes:{cell:s[l]},width:s[l]?this.setSavedWidth(s[l].valueSort.levelName,r):this.resColWidth,minWidth:30,allowReordering:this.parent.gridSettings.allowReordering,allowResizing:this.parent.gridSettings.allowResizing,visible:!0},c=[e[a[u]]];h-=i[u],u+=i[u]}o[n].columns=c}o[n]&&(o[n].clipMode=this.gridSettings.clipMode),i[l]=d,a[l]=n,n++,l=l+d-1}e=o.length>0?o:e}while(t>0);e[0]={field:"0.formattedText",width:this.resColWidth,minWidth:30,headerText:"",allowReordering:!1,allowResizing:this.parent.gridSettings.allowResizing,visible:!0}}else e=this.frameEmptyColumns();return this.parent.triggerColumnRenderEvent(e),e},e.prototype.setSavedWidth=function(e,t){return t=this.parent.resizeInfo[e]?this.parent.resizeInfo[e]:t},e.prototype.frameEmptyColumns=function(){var e=[],t=this.calculateColWidth(2);return e.push({field:"0.formattedText",headerText:"",minWidth:30,width:this.resColWidth}),e.push({field:"1.formattedText",headerText:this.parent.localeObj.getConstant("grandTotal"),minWidth:30,width:t}),e},e.prototype.getFormatList=function(){for(var e=[],t=0;t<this.parent.dataSource.values.length;t++){var i=this.parent.dataSource.values[t];if(this.parent.dataSource.formatSettings.length>0){for(var a="",r=0;r<this.parent.dataSource.formatSettings.length;r++){var o=this.parent.dataSource.formatSettings[r];if(i.name===o.name){a=o.format;break}}e.push(a)}else e.push("N")}return e},e.prototype.excelColumnEvent=function(e){e=this.exportHeaderEvent(e),this.parent.trigger("excelHeaderQueryCellInfo",e)},e.prototype.pdfColumnEvent=function(e){e=this.exportHeaderEvent(e),this.parent.trigger("pdfHeaderQueryCellInfo",e)},e.prototype.excelRowEvent=function(e){if("0.formattedText"===e.column.field){var t="value"===e.data[0].type,i=t?this.lastSpan+1:e.data[0].level;this.colPos=0,e.style={hAlign:"Left",indent:2*i},this.lastSpan=t?this.lastSpan:i}else this.colPos++,e.value=e.data[this.colPos].value||e.data[this.colPos].formattedText;e=this.exportContentEvent(e),this.parent.trigger("excelQueryCellInfo",e)},e.prototype.pdfRowEvent=function(e){if("0.formattedText"===(e=this.exportContentEvent(e)).column.field){var t="value"===e.data[0].type,i=t?this.lastSpan+1:e.data[0].level;e.style={paragraphIndent:10*i},this.lastSpan=t?this.lastSpan:i}this.parent.trigger("pdfQueryCellInfo",e)},e.prototype.exportHeaderEvent=function(e){var t=1;if(e.gridCell.column.customAttributes){var i=e.gridCell.column.customAttributes.cell;t=i.rowSpan?i.rowSpan:1}else t=Object.keys(this.engine.headerContent).length;return e.cell.rowSpan&&e.cell.rowSpan!==t&&t>-1&&(e.cell.rowSpan=t),e},e.prototype.exportContentEvent=function(e){return e.value="grand sum"===e.data[Number(e.column.field.split(".formattedText")[0])].type?this.parent.localeObj.getConstant("grandTotal"):e.value,e},e.prototype.unWireEvents=function(e){e.querySelector(".e-hyperlinkcell")&&ej2Base.EventHandler.remove(e.querySelector(".e-hyperlinkcell"),this.parent.isAdaptive?"touchend":"click",this.onHyperCellClick)},e.prototype.wireEvents=function(e){e.querySelector(".e-hyperlinkcell")&&ej2Base.EventHandler.add(e.querySelector(".e-hyperlinkcell"),this.parent.isAdaptive?"touchend":"click",this.onHyperCellClick,this)},e}(),__extends$1=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function a(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),__decorate$1=function(e,t,i,a){var r,o=arguments.length,n=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,a);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n},FieldOptions=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$1(t,e),__decorate$1([ej2Base.Property()],t.prototype,"name",void 0),__decorate$1([ej2Base.Property()],t.prototype,"caption",void 0),__decorate$1([ej2Base.Property("Sum")],t.prototype,"type",void 0),__decorate$1([ej2Base.Property()],t.prototype,"axis",void 0),__decorate$1([ej2Base.Property(!1)],t.prototype,"showNoDataItems",void 0),__decorate$1([ej2Base.Property()],t.prototype,"baseField",void 0),__decorate$1([ej2Base.Property()],t.prototype,"baseItem",void 0),__decorate$1([ej2Base.Property(!0)],t.prototype,"showSubTotals",void 0),t}(ej2Base.ChildProperty),FieldListFieldOptions=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$1(t,e),t}(FieldOptions),Style=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$1(t,e),__decorate$1([ej2Base.Property()],t.prototype,"backgroundColor",void 0),__decorate$1([ej2Base.Property()],t.prototype,"color",void 0),__decorate$1([ej2Base.Property()],t.prototype,"fontFamily",void 0),__decorate$1([ej2Base.Property()],t.prototype,"fontSize",void 0),t}(ej2Base.ChildProperty),Filter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$1(t,e),__decorate$1([ej2Base.Property()],t.prototype,"name",void 0),__decorate$1([ej2Base.Property("Include")],t.prototype,"type",void 0),__decorate$1([ej2Base.Property()],t.prototype,"items",void 0),__decorate$1([ej2Base.Property("DoesNotEquals")],t.prototype,"condition",void 0),__decorate$1([ej2Base.Property()],t.prototype,"value1",void 0),__decorate$1([ej2Base.Property()],t.prototype,"value2",void 0),__decorate$1([ej2Base.Property()],t.prototype,"measure",void 0),t}(ej2Base.ChildProperty),ConditionalFormatSettings=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$1(t,e),__decorate$1([ej2Base.Property()],t.prototype,"measure",void 0),__decorate$1([ej2Base.Property()],t.prototype,"label",void 0),__decorate$1([ej2Base.Property()],t.prototype,"conditions",void 0),__decorate$1([ej2Base.Property()],t.prototype,"value1",void 0),__decorate$1([ej2Base.Property()],t.prototype,"value2",void 0),__decorate$1([ej2Base.Property()],t.prototype,"style",void 0),t}(ej2Base.ChildProperty),Sort=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$1(t,e),__decorate$1([ej2Base.Property()],t.prototype,"name",void 0),__decorate$1([ej2Base.Property("Ascending")],t.prototype,"order",void 0),t}(ej2Base.ChildProperty),FormatSettings=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$1(t,e),__decorate$1([ej2Base.Property()],t.prototype,"name",void 0),__decorate$1([ej2Base.Property()],t.prototype,"minimumFractionDigits",void 0),__decorate$1([ej2Base.Property()],t.prototype,"maximumFractionDigits",void 0),__decorate$1([ej2Base.Property()],t.prototype,"minimumSignificantDigits",void 0),__decorate$1([ej2Base.Property()],t.prototype,"maximumSignificantDigits",void 0),__decorate$1([ej2Base.Property(!0)],t.prototype,"useGrouping",void 0),__decorate$1([ej2Base.Property()],t.prototype,"skeleton",void 0),__decorate$1([ej2Base.Property()],t.prototype,"type",void 0),__decorate$1([ej2Base.Property()],t.prototype,"currency",void 0),__decorate$1([ej2Base.Property()],t.prototype,"minimumIntegerDigits",void 0),__decorate$1([ej2Base.Property()],t.prototype,"format",void 0),t}(ej2Base.ChildProperty),GroupSettings=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$1(t,e),__decorate$1([ej2Base.Property()],t.prototype,"name",void 0),__decorate$1([ej2Base.Property()],t.prototype,"groupInterval",void 0),__decorate$1([ej2Base.Property()],t.prototype,"startingAt",void 0),__decorate$1([ej2Base.Property()],t.prototype,"endingAt",void 0),__decorate$1([ej2Base.Property("Date")],t.prototype,"type",void 0),__decorate$1([ej2Base.Property()],t.prototype,"rangeInterval",void 0),t}(ej2Base.ChildProperty),CalculatedFieldSettings=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$1(t,e),__decorate$1([ej2Base.Property()],t.prototype,"name",void 0),__decorate$1([ej2Base.Property()],t.prototype,"formula",void 0),t}(ej2Base.ChildProperty),DrillOptions=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$1(t,e),__decorate$1([ej2Base.Property()],t.prototype,"name",void 0),__decorate$1([ej2Base.Property()],t.prototype,"items",void 0),t}(ej2Base.ChildProperty),ValueSortSettings=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$1(t,e),__decorate$1([ej2Base.Property()],t.prototype,"headerText",void 0),__decorate$1([ej2Base.Property(".")],t.prototype,"headerDelimiter",void 0),__decorate$1([ej2Base.Property("None")],t.prototype,"sortOrder",void 0),t}(ej2Base.ChildProperty),DataSource=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$1(t,e),__decorate$1([ej2Base.Property()],t.prototype,"data",void 0),__decorate$1([ej2Base.Collection([],FieldOptions)],t.prototype,"rows",void 0),__decorate$1([ej2Base.Collection([],FieldOptions)],t.prototype,"columns",void 0),__decorate$1([ej2Base.Collection([],FieldOptions)],t.prototype,"values",void 0),__decorate$1([ej2Base.Collection([],FieldOptions)],t.prototype,"filters",void 0),__decorate$1([ej2Base.Property(!1)],t.prototype,"expandAll",void 0),__decorate$1([ej2Base.Property("column")],t.prototype,"valueAxis",void 0),__decorate$1([ej2Base.Collection([],Filter)],t.prototype,"filterSettings",void 0),__decorate$1([ej2Base.Collection([],Sort)],t.prototype,"sortSettings",void 0),__decorate$1([ej2Base.Property(!0)],t.prototype,"enableSorting",void 0),__decorate$1([ej2Base.Property(!1)],t.prototype,"allowLabelFilter",void 0),__decorate$1([ej2Base.Property(!1)],t.prototype,"allowValueFilter",void 0),__decorate$1([ej2Base.Property(!0)],t.prototype,"showSubTotals",void 0),__decorate$1([ej2Base.Property(!0)],t.prototype,"showRowSubTotals",void 0),__decorate$1([ej2Base.Property(!0)],t.prototype,"showColumnSubTotals",void 0),__decorate$1([ej2Base.Property(!0)],t.prototype,"showGrandTotals",void 0),__decorate$1([ej2Base.Property(!0)],t.prototype,"showRowGrandTotals",void 0),__decorate$1([ej2Base.Property(!0)],t.prototype,"showColumnGrandTotals",void 0),__decorate$1([ej2Base.Property(!1)],t.prototype,"alwaysShowValueHeader",void 0),__decorate$1([ej2Base.Property(!0)],t.prototype,"showAggregationOnValueField",void 0),__decorate$1([ej2Base.Collection([],FormatSettings)],t.prototype,"formatSettings",void 0),__decorate$1([ej2Base.Collection([],DrillOptions)],t.prototype,"drilledMembers",void 0),__decorate$1([ej2Base.Complex({},ValueSortSettings)],t.prototype,"valueSortSettings",void 0),__decorate$1([ej2Base.Collection([],CalculatedFieldSettings)],t.prototype,"calculatedFieldSettings",void 0),__decorate$1([ej2Base.Collection([],ConditionalFormatSettings)],t.prototype,"conditionalFormatSettings",void 0),__decorate$1([ej2Base.Property()],t.prototype,"emptyCellsTextContent",void 0),__decorate$1([ej2Base.Collection([],GroupSettings)],t.prototype,"groupSettings",void 0),t}(ej2Base.ChildProperty),__extends$2=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function a(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),__decorate$2=function(e,t,i,a){var r,o=arguments.length,n=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,a);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n},GridSettings=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$2(t,e),__decorate$2([ej2Base.Property("Both")],t.prototype,"gridLines",void 0),__decorate$2([ej2Base.Property(!1)],t.prototype,"allowTextWrap",void 0),__decorate$2([ej2Base.Property(!1)],t.prototype,"allowReordering",void 0),__decorate$2([ej2Base.Property(!0)],t.prototype,"allowResizing",void 0),__decorate$2([ej2Base.Property(null)],t.prototype,"rowHeight",void 0),__decorate$2([ej2Base.Property(110)],t.prototype,"columnWidth",void 0),__decorate$2([ej2Base.Property("Ellipsis")],t.prototype,"clipMode",void 0),__decorate$2([ej2Base.Property(!1)],t.prototype,"allowSelection",void 0),__decorate$2([ej2Base.Property(-1)],t.prototype,"selectedRowIndex",void 0),__decorate$2([ej2Base.Property({mode:"Row",cellSelectionMode:"Flow",type:"Single"})],t.prototype,"selectionSettings",void 0),__decorate$2([ej2Base.Property("AllPages")],t.prototype,"printMode",void 0),__decorate$2([ej2Base.Property()],t.prototype,"contextMenuItems",void 0),__decorate$2([ej2Base.Event()],t.prototype,"beforeCopy",void 0),__decorate$2([ej2Base.Event()],t.prototype,"printComplete",void 0),__decorate$2([ej2Base.Event()],t.prototype,"beforePrint",void 0),__decorate$2([ej2Base.Event()],t.prototype,"contextMenuOpen",void 0),__decorate$2([ej2Base.Event()],t.prototype,"contextMenuClick",void 0),__decorate$2([ej2Base.Event()],t.prototype,"queryCellInfo",void 0),__decorate$2([ej2Base.Event()],t.prototype,"headerCellInfo",void 0),__decorate$2([ej2Base.Event()],t.prototype,"rowSelecting",void 0),__decorate$2([ej2Base.Event()],t.prototype,"rowSelected",void 0),__decorate$2([ej2Base.Event()],t.prototype,"rowDeselecting",void 0),__decorate$2([ej2Base.Event()],t.prototype,"rowDeselected",void 0),__decorate$2([ej2Base.Event()],t.prototype,"cellSelecting",void 0),__decorate$2([ej2Base.Event()],t.prototype,"cellSelected",void 0),__decorate$2([ej2Base.Event()],t.prototype,"cellDeselecting",void 0),__decorate$2([ej2Base.Event()],t.prototype,"cellDeselected",void 0),__decorate$2([ej2Base.Event()],t.prototype,"resizeStart",void 0),__decorate$2([ej2Base.Event()],t.prototype,"resizing",void 0),__decorate$2([ej2Base.Event()],t.prototype,"resizeStop",void 0),__decorate$2([ej2Base.Event()],t.prototype,"pdfHeaderQueryCellInfo",void 0),__decorate$2([ej2Base.Event()],t.prototype,"pdfQueryCellInfo",void 0),__decorate$2([ej2Base.Event()],t.prototype,"excelHeaderQueryCellInfo",void 0),__decorate$2([ej2Base.Event()],t.prototype,"excelQueryCellInfo",void 0),__decorate$2([ej2Base.Event()],t.prototype,"columnDragStart",void 0),__decorate$2([ej2Base.Event()],t.prototype,"columnDrag",void 0),__decorate$2([ej2Base.Event()],t.prototype,"columnDrop",void 0),__decorate$2([ej2Base.Event()],t.prototype,"columnRender",void 0),t}(ej2Base.ChildProperty),ExcelExport$1=function(){function e(e){this.parent=e}return e.prototype.getModuleName=function(){return"excelExport"},e.prototype.exportToExcel=function(e){if(this.parent.enableVirtualization){var t=this.parent.engineModule.pageSettings;this.parent.engineModule.pageSettings=null,this.parent.engineModule.generateGridData(this.parent.dataSource),this.parent.engineModule.pageSettings=t}var i={fileName:"default",header:"",footer:"",dataCollections:[this.parent.engineModule.pivotValues]};this.parent.trigger("beforeExport",i);for(var a=i.fileName,r=i.dataCollections,o=[],n=0;n<r.length;n++){for(var s=r[n],l=0,d=s.length,p=0,h=this.parent.renderModule.getFormatList(),c=[],u=0,g=0;g<d;g++)if(s[g]){p++,l=s[g].length;for(var m=[],v=0;v<l;v++)if(s[g][v]){var f=s[g][v];if(-1!==f.level||f.rowSpan){var y="value"===f.axis?f.value:f.formattedText;y="grand sum"===f.type?this.parent.localeObj.getConstant("grandTotal"):"sum"===f.type?y.toString().replace("Total",this.parent.localeObj.getConstant("total")):y,(-1!==f.level||f.rowSpan)&&(m.push({index:v+1,value:y,colSpan:f.colSpan,rowSpan:f.rowSpan}),"value"===f.axis?(m[m.length-1].style={numberFormat:h[(v-1)%this.parent.dataSource.values.length],bold:!1,wrapText:!0},f.style&&(m[m.length-1].style.backColor=f.style.backgroundColor,m[m.length-1].style.fontColor=f.style.color,m[m.length-1].style.fontName=f.style.fontFamily,m[m.length-1].style.fontSize=Number(f.style.fontSize.split("px")[0]))):(m[m.length-1].style={bold:!0,vAlign:"Center",wrapText:!0,indent:1===v?10*f.level:0},"row"===f.axis&&0===v&&(m[m.length-1].style.hAlign="Left",m[m.length-1].style.indent=2*f.level,u=f.level>u?f.level:u)),m[m.length-1].style.borders={color:"#000000",lineStyle:"Thin"})}v+=f.colSpan?f.colSpan-1:0}else m.push({index:v+1,value:"",colSpan:1,rowSpan:1});c.push({index:p,cells:m})}for(var S=[],v=0;v<l;v++)S.push({index:v+1,width:100});u>0&&(S[0].width=100+20*u),o.push({columns:S,rows:c})}new ej2ExcelExport.Workbook({worksheets:o},"Excel"===e?"xlsx":"csv").save(a+("Excel"===e?".xlsx":".csv"))},e.prototype.destroy=function(){},e}(),PDFExport=function(){function e(e){this.parent=e}return e.prototype.getModuleName=function(){return"pdfExport"},e.prototype.addPage=function(e){var t=e.document.pages.add(),i=e.args.header,a=e.args.footer,r=new ej2PdfExport.PdfStandardFont(ej2PdfExport.PdfFontFamily.TimesRoman,15,ej2PdfExport.PdfFontStyle.Regular),o=new ej2PdfExport.PdfSolidBrush(new ej2PdfExport.PdfColor(0,0,0)),n=new ej2PdfExport.PdfPen(new ej2PdfExport.PdfColor(0,0,0),.5),s=new ej2PdfExport.PdfPageTemplateElement(new ej2PdfExport.RectangleF(0,0,t.graphics.clientSize.width,20));s.graphics.drawString(i,r,n,o,0,0,new ej2PdfExport.PdfStringFormat(ej2PdfExport.PdfTextAlignment.Center)),e.document.template.top=s;var l=new ej2PdfExport.PdfPageTemplateElement(new ej2PdfExport.RectangleF(0,0,t.graphics.clientSize.width,20));return l.graphics.drawString(a,r,n,o,0,0,new ej2PdfExport.PdfStringFormat(ej2PdfExport.PdfTextAlignment.Center)),e.document.template.bottom=l,t},e.prototype.hexDecToRgb=function(e){if(null===e||""===e||7!==e.length)throw new Error("please set valid hex value for color..");e=e.substring(1);var t=parseInt(e,16);return{r:t>>16&255,g:t>>8&255,b:255&t}},e.prototype.getFontStyle=function(e){var t=ej2PdfExport.PdfFontStyle.Regular;return!ej2Base.isNullOrUndefined(e)&&e.bold&&(t|=ej2PdfExport.PdfFontStyle.Bold),!ej2Base.isNullOrUndefined(e)&&e.italic&&(t|=ej2PdfExport.PdfFontStyle.Italic),!ej2Base.isNullOrUndefined(e)&&e.underline&&(t|=ej2PdfExport.PdfFontStyle.Underline),!ej2Base.isNullOrUndefined(e)&&e.strikeout&&(t|=ej2PdfExport.PdfFontStyle.Strikeout),t},e.prototype.getBorderStyle=function(e){var t=new ej2PdfExport.PdfBorders;if(ej2Base.isNullOrUndefined(e)){var i=new ej2PdfExport.PdfColor(234,234,234);t.all=new ej2PdfExport.PdfPen(i)}else{var a=e.width,r=ej2Base.isNullOrUndefined(a)||"number"!=typeof a?void 0:.75*a,o=new ej2PdfExport.PdfColor(196,196,196);if(!ej2Base.isNullOrUndefined(e.color)){var n=this.hexDecToRgb(e.color);o=new ej2PdfExport.PdfColor(n.r,n.g,n.b)}var s=new ej2PdfExport.PdfPen(o,r);ej2Base.isNullOrUndefined(e.dashStyle)||(s.dashStyle=this.getDashStyle(e.dashStyle)),t.all=s}return t},e.prototype.getDashStyle=function(e){switch(e){case"Dash":return 1;case"Dot":return 2;case"DashDot":return 3;case"DashDotDot":return 4;default:return 0}},e.prototype.getStyle=function(){var e=new ej2PdfExport.PdfBorders;if(ej2Base.isNullOrUndefined(this.gridStyle))return{brush:new ej2PdfExport.PdfSolidBrush(new ej2PdfExport.PdfColor),border:e,font:void 0};var t=ej2Base.isNullOrUndefined(this.gridStyle.header.fontName)?ej2PdfExport.PdfFontFamily.Helvetica:this.getFontFamily(this.gridStyle.header.fontName),i=this.getFontStyle(this.gridStyle.header),a=ej2Base.isNullOrUndefined(this.gridStyle.header.fontSize)?10.5:this.gridStyle.header.fontSize,r=new ej2PdfExport.PdfColor;if(!ej2Base.isNullOrUndefined(this.gridStyle.header.fontColor)){var o=this.hexDecToRgb(this.gridStyle.header.fontColor);r=new ej2PdfExport.PdfColor(o.r,o.g,o.b)}var n=new ej2PdfExport.PdfStandardFont(t,a,i);return ej2Base.isNullOrUndefined(this.gridStyle.header.font)||(n=this.gridStyle.header.font),{border:this.getBorderStyle(this.gridStyle.header.border),font:n,brush:new ej2PdfExport.PdfSolidBrush(r)}},e.prototype.setRecordThemeStyle=function(e,t){if(!ej2Base.isNullOrUndefined(this.gridStyle)&&!ej2Base.isNullOrUndefined(this.gridStyle.record)){var i=ej2Base.isNullOrUndefined(this.gridStyle.record.fontName)?ej2PdfExport.PdfFontFamily.Helvetica:this.getFontFamily(this.gridStyle.record.fontName),a=ej2Base.isNullOrUndefined(this.gridStyle.record.fontSize)?9.75:this.gridStyle.record.fontSize,r=this.getFontStyle(this.gridStyle.record),o=new ej2PdfExport.PdfStandardFont(i,a,r);ej2Base.isNullOrUndefined(this.gridStyle.record.font)||(o=this.gridStyle.record.font),e.style.setFont(o);var n=new ej2PdfExport.PdfColor;if(!ej2Base.isNullOrUndefined(this.gridStyle.record.fontColor)){var s=this.hexDecToRgb(this.gridStyle.record.fontColor);n=new ej2PdfExport.PdfColor(s.r,s.g,s.b)}e.style.setTextBrush(new ej2PdfExport.PdfSolidBrush(n))}var l=this.gridStyle&&this.gridStyle.record&&this.gridStyle.record.border?this.getBorderStyle(this.gridStyle.record.border):t;return e.style.setBorder(l),e},e.prototype.exportToPDF=function(){for(var e=this.applyEvent(),t=this.getStyle(),i=0,a=e.args.dataCollections[i],r=0;e.args.allowRepeatHeader&&r<a.length;r++)for(var o=6;a[r]&&o<a[r].length;o+=6)a[r].splice(o,0,a[r][0]);var n=a&&a.length>0?a[0].length:0,s=0;do{var l=this.addPage(e),d=new ej2PdfExport.PdfGrid;if(a&&a.length>0){d.columns.add(a[0].length-s>=6?6:a[0].length-s);for(var p=a.length,h=0,c=0,u=0;u<p;u++)if(a[u]){var g=!(a[u][0]&&"row"===a[u][0].axis),m=a[u].length>s+6?s+6:a[u].length;g&&d.headers.add(1);var v=g?d.headers.getHeader(h):d.rows.addRow();g?(v.style.setBorder(t.border),t.font&&v.style.setFont(t.font),v.style.setTextBrush(t.brush)):this.setRecordThemeStyle(v,t.border);for(var f=0,y=!0,S=s;S<m;S++){var b=!1;if(a[u][S]){var C=a[u][S];if(-1!==C.level||C.rowSpan){var x=C.formattedText;x="grand sum"===C.type?this.parent.localeObj.getConstant("grandTotal"):"sum"===C.type?x.toString().replace("Total",this.parent.localeObj.getConstant("total")):x,(-1!==C.level||C.rowSpan)&&(v.cells.getCell(f).columnSpan=C.colSpan?6-f<C.colSpan?6-f:C.colSpan:1,g&&C.rowSpan&&C.rowSpan>1&&(v.cells.getCell(f).rowSpan=C.rowSpan?C.rowSpan:1),v.cells.getCell(f).value=x?x.toString():""),""!==x&&(y=!1)}c=C.level>c?C.level:c,b="value"===C.axis,S+=v.cells.getCell(f).columnSpan?v.cells.getCell(f).columnSpan-1:0,f+=v.cells.getCell(f).columnSpan?v.cells.getCell(f).columnSpan-1:0,C.style&&(v=this.applyStyle(v,C,f));w={style:C&&C.isSum?{bold:!0}:void 0,pivotCell:C,cell:v.cells.getCell(f)};this.parent.trigger("onPdfCellRender",w),w.style&&this.processCellStyle(v.cells.getCell(f),w)}else{var w={style:void 0,pivotCell:void 0,cell:v.cells.getCell(f)};this.parent.trigger("onPdfCellRender",w),w.style&&this.processCellStyle(v.cells.getCell(f),w),v.cells.getCell(f).value="",0===S&&g&&this.parent.dataSource.columns&&this.parent.dataSource.columns.length>0?d.headers.getHeader(0).cells.getCell(0).rowSpan++:0!==S&&g&&this.parent.dataSource.columns&&this.parent.dataSource.columns.length>0&&d.headers.getHeader(0).cells.getCell(0).rowSpan<Object.keys(this.parent.engineModule.headerContent).length&&d.headers.getHeader(0).cells.getCell(0).rowSpan++}var j=new ej2PdfExport.PdfStringFormat;j.paragraphIndent=!g&&0===f&&a[u][S]?15*a[u][S].level:0,j.alignment=b?ej2PdfExport.PdfTextAlignment.Right:ej2PdfExport.PdfTextAlignment.Left,j.lineAlignment=ej2PdfExport.PdfVerticalAlignment.Middle,v.cells.getCell(f).style.stringFormat=j,f++}y&&(v.height=16),h++}d.columns.getColumn(0).width=100+20*c}0===s&&this.parent.dataSource.columns&&this.parent.dataSource.columns.length>0&&d.headers.getHeader(0).cells.getCell(0).rowSpan--,d.draw(l,new ej2PdfExport.PointF(10,20)),(s+=6)>=n&&e.args.dataCollections.length>i+1&&(i++,n=(a=e.args.dataCollections[i])&&a.length>0?a[0].length:0,s=0)}while(s<n);e.document.save(e.args.fileName+".pdf"),e.document.destroy()},e.prototype.applyStyle=function(e,t,i){var a=this.parent.conditionalFormattingModule.hexToRgb(t.style.backgroundColor),r=new ej2PdfExport.PdfSolidBrush(new ej2PdfExport.PdfColor(a.r,a.g,a.b));e.cells.getCell(i).style.backgroundBrush=r;var o=Number(t.style.fontSize.split("px")[0]),n=new ej2PdfExport.PdfStandardFont(ej2PdfExport.PdfFontFamily.TimesRoman,o,ej2PdfExport.PdfFontStyle.Regular);return e.cells.getCell(i).style.font=n,a=this.parent.conditionalFormattingModule.hexToRgb(t.style.color),r=new ej2PdfExport.PdfSolidBrush(new ej2PdfExport.PdfColor(a.r,a.g,a.b)),e.cells.getCell(i).style.textBrush=r,e},e.prototype.getFontFamily=function(e){switch(e){case"TimesRoman":return 2;case"Courier":return 1;case"Symbol":return 3;case"ZapfDingbats":return 4;default:return 0}},e.prototype.getFont=function(e){if(e.style.font)return e.style.font;var t=ej2Base.isNullOrUndefined(e.style.fontSize)?9.75:.75*e.style.fontSize,i=ej2Base.isNullOrUndefined(e.style.fontFamily)?ej2PdfExport.PdfFontFamily.TimesRoman:this.getFontFamily(e.style.fontFamily),a=ej2PdfExport.PdfFontStyle.Regular;return!ej2Base.isNullOrUndefined(e.style.bold)&&e.style.bold&&(a|=ej2PdfExport.PdfFontStyle.Bold),!ej2Base.isNullOrUndefined(e.style.italic)&&e.style.italic&&(a|=ej2PdfExport.PdfFontStyle.Italic),!ej2Base.isNullOrUndefined(e.style.underline)&&e.style.underline&&(a|=ej2PdfExport.PdfFontStyle.Underline),!ej2Base.isNullOrUndefined(e.style.strikeout)&&e.style.strikeout&&(a|=ej2PdfExport.PdfFontStyle.Strikeout),new ej2PdfExport.PdfStandardFont(i,t,a)},e.prototype.processCellStyle=function(e,t){if(!ej2Base.isNullOrUndefined(t.style.backgroundColor)){var i=this.hexDecToRgb(t.style.backgroundColor);e.style.backgroundBrush=new ej2PdfExport.PdfSolidBrush(new ej2PdfExport.PdfColor(i.r,i.g,i.b))}if(!ej2Base.isNullOrUndefined(t.style.textBrushColor)){var a=this.hexDecToRgb(t.style.textBrushColor);e.style.textBrush=new ej2PdfExport.PdfSolidBrush(new ej2PdfExport.PdfColor(a.r,a.g,a.b))}if(!ej2Base.isNullOrUndefined(t.style.textPenColor)){var r=this.hexDecToRgb(t.style.textPenColor);e.style.textPen=new ej2PdfExport.PdfPen(new ej2PdfExport.PdfColor(r.r,r.g,r.b))}if(ej2Base.isNullOrUndefined(t.style.fontFamily)&&ej2Base.isNullOrUndefined(t.style.fontSize)&&ej2Base.isNullOrUndefined(t.style.bold)&&ej2Base.isNullOrUndefined(t.style.italic)&&ej2Base.isNullOrUndefined(t.style.underline)&&ej2Base.isNullOrUndefined(t.style.strikeout)||(e.style.font=this.getFont(t)),!ej2Base.isNullOrUndefined(t.style.border)){var o=new ej2PdfExport.PdfBorders,n=t.style.border.width,s=ej2Base.isNullOrUndefined(n)||"number"!=typeof n?void 0:.75*n,l=new ej2PdfExport.PdfColor(196,196,196);if(!ej2Base.isNullOrUndefined(t.style.border.color)){var d=this.hexDecToRgb(t.style.border.color);l=new ej2PdfExport.PdfColor(d.r,d.g,d.b)}var p=new ej2PdfExport.PdfPen(l,s);ej2Base.isNullOrUndefined(t.style.border.dashStyle)||(p.dashStyle=this.getDashStyle(t.style.border.dashStyle)),o.all=p,e.style.borders=o}},e.prototype.applyEvent=function(){if(this.parent.enableVirtualization){var e=this.parent.engineModule.pageSettings;this.parent.engineModule.pageSettings=null,this.parent.engineModule.generateGridData(this.parent.dataSource),this.parent.engineModule.pageSettings=e}var t={fileName:"default",header:"",footer:"",dataCollections:[JSON.parse(JSON.stringify(this.parent.engineModule.pivotValues))],allowRepeatHeader:!0,style:void 0};return this.parent.trigger("beforeExport",t),this.gridStyle=t.style,{document:new ej2PdfExport.PdfDocument,args:t}},e.prototype.destroy=function(){},e}(),KeyboardInteraction=function(){function e(e){this.keyConfigs={tab:"tab",enter:"enter",shiftUp:"shift+upArrow",shiftDown:"shift+downArrow",shiftLeft:"shift+leftArrow",shiftRight:"shift+rightArrow",upArrow:"upArrow",downArrow:"downArrow",leftArrow:"leftArrow",rightArrow:"rightArrow",escape:"escape"},this.parent=e,this.parent.element.tabIndex=-1===this.parent.element.tabIndex?0:this.parent.element.tabIndex,this.pivotViewKeyboardModule=new ej2Base.KeyboardEvents(this.parent.element,{keyAction:this.keyActionHandler.bind(this),keyConfigs:this.keyConfigs,eventName:"keydown"})}return e.prototype.keyActionHandler=function(e){switch(e.action){case"tab":this.processTab(e);break;case"enter":this.processEnter(e);break;case"shiftUp":case"shiftDown":case"shiftLeft":case"shiftRight":case"upArrow":case"downArrow":case"leftArrow":case"rightArrow":this.processSelection(e);break;case"escape":this.clearSelection()}},e.prototype.getNextButton=function(e){var t=[].slice.call(this.parent.element.querySelectorAll(".e-pivot-button")),i=e;if(this.parent.grid.element.querySelector(".e-pivot-button"))for(var a=t.length,r=0;r<a;r++)if(t[r].getAttribute("data-uid")===e.getAttribute("data-uid")){i=t[r+1]?t[r+1]:i;break}return i},e.prototype.processTab=function(e){var t=e.target;if(t&&ej2Base.closest(t,".e-pivot-button")){var i=this.parent.grid.serviceLocator.getService("focus"),a=this.getNextButton(t);if(a.getAttribute("data-uid")!==t.getAttribute("data-uid"))i.currentInfo.skipAction=!0,a.focus();else{i.focus();n=i.getFocusedElement();ej2Base.addClass([n],["e-focused","e-focus"]),n.setAttribute("tabindex","0")}return void e.preventDefault()}if(!this.parent.showGroupingBar&&this.parent.showFieldList){if(t&&ej2Base.closest(t,".e-toggle-field-list")){(i=this.parent.grid.serviceLocator.getService("focus")).focus();n=i.getFocusedElement();ej2Base.addClass([n],["e-focused","e-focus"]),n.setAttribute("tabindex","0")}}else if(!this.parent.showGroupingBar&&!this.parent.showFieldList&&t&&ej2Base.closest(t,".e-pivotview")){var r=ej2Base.closest(t,".e-pivotview"),i=this.parent.grid.serviceLocator.getService("focus"),o=[].slice.call(r.getElementsByTagName("tr"));if(t.innerHTML===o[o.length-1].lastChild.innerHTML)i.currentInfo.skipAction=!0;else{i.focus();var n=i.getFocusedElement();ej2Base.addClass([n],["e-focused","e-focus"]),n.setAttribute("tabindex","0")}}},e.prototype.processEnter=function(e){var t=e.target;if(t&&ej2Base.closest(t,".e-grid"))return t.querySelector("."+ICON)?t.querySelector("."+ICON).click():t.classList.contains("e-valuescontent")&&t.dispatchEvent(new MouseEvent("dblclick",{view:window,bubbles:!0,cancelable:!0})),void e.preventDefault()},e.prototype.clearSelection=function(){var e=this.parent;[].slice.call(e.element.querySelectorAll(".e-cellselectionbackground,."+SELECTED_BGCOLOR)).forEach(function(e){e.classList.remove(SELECTED_BGCOLOR),e.classList.remove("e-cellselectionbackground"),e.classList.remove("e-active")}),this.parent.renderModule.selected()},e.prototype.processSelection=function(e){if(this.parent.gridSettings.allowSelection&&"Row"!==this.parent.gridSettings.selectionSettings.mode){var t=e.target,i=this.parent,a=Number(e.target.getAttribute("aria-colIndex")),r=Number(e.target.getAttribute("index")),o=void 0;if("TH"!==t.nodeName&&"TD"!==t.nodeName||(o="shiftUp"===e.action||"upArrow"===e.action?0===r||0===a||"TH"!==t.nodeName&&i.renderModule.rowStartPos!==r?null:this.getParentElement(i,o,a,r-1):"shiftDown"===e.action||"downArrow"===e.action?i.element.querySelector('th[aria-colindex="'+a+'"][index="'+(r+1)+'"]'):"shiftLeft"===e.action||"leftArrow"===e.action?e.target.previousSibling:e.target.nextSibling),ej2Base.isNullOrUndefined(o))"upArrow"===e.action?(o=i.element.querySelector('[aria-colindex="'+a+'"][index="'+(r-1)+'"]'),r--):"downArrow"===e.action&&(o=i.element.querySelector('[aria-colindex="'+a+'"][index="'+(r+1)+'"]'),r++),ej2Base.isNullOrUndefined(o)||i.clearSelection(o,e,a,r);else if("Both"===i.gridSettings.selectionSettings.mode&&o.classList.contains("e-rowcell"))i.clearSelection(o,e,a,r);else{a=Number(o.getAttribute("aria-colindex")),r=Number(o.getAttribute("index"));var n=Number(o.getAttribute("aria-colspan"));i.clearSelection(o,e,a,r),i.applyColumnSelection(e,o,a,a+(n>0?n-1:0),r)}}},e.prototype.getParentElement=function(e,t,i,a){for(;!t;)t=e.element.querySelector('[aria-colindex="'+i+'"][index="'+a+'"]'),i--;return t},e.prototype.destroy=function(){this.pivotViewKeyboardModule&&this.pivotViewKeyboardModule.destroy()},e}(),PivotContextMenu=function(){function e(e){this.parent=e,this.parent.contextMenuModule=this}return e.prototype.render=function(){this.renderContextMenu()},e.prototype.renderContextMenu=function(){var e={cssClass:"e-pivot-context-menu",items:[{text:this.parent.localeObj.getConstant("addToFilter"),id:"Context_Filters"},{text:this.parent.localeObj.getConstant("addToRow"),id:"Context_Rows"},{text:this.parent.localeObj.getConstant("addToColumn"),id:"Context_Columns"},{text:this.parent.localeObj.getConstant("addToValue"),id:"Context_Values"}],enableRtl:this.parent.enableRtl,beforeOpen:this.onBeforeMenuOpen.bind(this),select:this.onSelectContextMenu.bind(this)},t=ej2Base.createElement("ul",{id:this.parent.element.id+"_PivotContextMenu"});this.parent.element.appendChild(t),this.menuObj=new ej2Navigations.ContextMenu(e),this.menuObj.appendTo(t)},e.prototype.onBeforeMenuOpen=function(e){var t=[].slice.call(e.element.querySelectorAll("li")),i=this.fieldElement.querySelector(".e-content").getAttribute("data-type");if(ej2Base.removeClass(t,"e-disabled"),"CalculatedField"===i)for(var a=0,r=t;a<r.length;a++){var o=r[a];o.textContent!==this.parent.localeObj.getConstant("addToValue")&&ej2Base.addClass([o],"e-disabled")}},e.prototype.onSelectContextMenu=function(e){if(null!==e.element.textContent){var t=this.fieldElement.getAttribute("data-uid"),i=e.item.id.replace("Context_","").toLowerCase();this.parent.pivotCommon.dataSourceUpdate.updateDataSource(t,i,-1),this.parent.updateDataSource(!0),this.fieldElement=void 0}},e.prototype.destroy=function(){this.parent.isDestroyed&&this.menuObj&&!this.menuObj.isDestroyed&&this.menuObj.destroy()},e}(),VirtualScroll$1=function(){function e(e){this.previousValues={top:0,left:0},this.frozenPreviousValues={top:0,left:0},this.eventType="",this.parent=e,this.addInternalEvents()}return e.prototype.getModuleName=function(){return"virtualscroll"},e.prototype.addInternalEvents=function(){this.parent.on(contentReady,this.wireEvents,this)},e.prototype.wireEvents=function(){var e=this.parent.element.querySelector(".e-movablecontent"),t=this.parent.element.querySelector(".e-frozencontent"),i=this.parent.element.querySelector(".e-movableheader");ej2Base.EventHandler.clearEvents(e),ej2Base.EventHandler.clearEvents(t),this.parent.engineModule&&(ej2Base.EventHandler.add(e,"scroll touchmove pointermove",this.onHorizondalScroll(i,e,t),this),ej2Base.EventHandler.add(e,"scroll wheel touchmove pointermove",this.onVerticalScroll(t,e),this),ej2Base.EventHandler.add(e,"mouseup touchend",this.common(i,e,t),this),ej2Base.EventHandler.add(t,"wheel",this.onWheelScroll(e,t),this),ej2Base.EventHandler.add(t,"touchstart pointerdown",this.setPageXY(),this),ej2Base.EventHandler.add(t,"touchmove pointermove",this.onTouchScroll(i,e,t),this),ej2Base.EventHandler.add(i,"touchstart pointerdown",this.setPageXY(),this),ej2Base.EventHandler.add(i,"touchmove pointermove",this.onTouchScroll(i,e,t),this)),this.parent.grid.isPreventScrollEvent=!0},e.prototype.onWheelScroll=function(e,t){var i=this,a=e;return function(e){var r=a.scrollTop+(1===e.deltaMode?30*e.deltaY:e.deltaY);i.frozenPreviousValues.top!==r&&(e.preventDefault(),t.scrollTop=r,a.scrollTop=r,i.frozenPreviousValues.top=r,i.eventType=e.type)}},e.prototype.getPointXY=function(e){var t={x:0,y:0};return e.touches&&e.touches.length?(t.x=e.touches[0].pageX,t.y=e.touches[0].pageY):(t.x=e.pageX,t.y=e.pageY),t},e.prototype.onTouchScroll=function(e,t,i){var a=this,r=t;return function(t){if("mouse"!==t.pointerType){var o=a.getPointXY(t),n=r.scrollTop+(a.pageXY.y-o.y),s=r.scrollLeft+(a.pageXY.x-o.x);if(a.parent.element.querySelector(".e-headercontent").contains(t.target)){if(a.frozenPreviousValues.left===s||s<0)return;e.scrollLeft=s,r.scrollLeft=s,a.pageXY.x=o.x,a.frozenPreviousValues.left=s}else{if(a.frozenPreviousValues.top===n||n<0)return;i.scrollTop=n,r.scrollTop=n,a.pageXY.y=o.y,a.frozenPreviousValues.top=n}a.eventType=t.type}}},e.prototype.update=function(e,t,i,a,r){if("vertical"===this.direction){var o="row"===this.parent.dataSource.valueAxis?this.parent.dataSource.values.length:1,n=this.parent.pageSettings.rowSize*o*this.parent.gridSettings.rowHeight,s=Math.ceil(i/n);if(this.parent.scrollPosObject.vertical===s)return void ej2Popups.hideSpinner(this.parent.element);ej2Popups.showSpinner(this.parent.element),this.parent.scrollPosObject.vertical=s,this.parent.engineModule.pageSettings.rowCurrentPage=s>1?s:1,this.parent.engineModule.generateGridData(this.parent.dataSource,this.parent.engineModule.headerCollection),this.parent.pivotValues=this.parent.engineModule.pivotValues;p=n*(d=Math.ceil(this.parent.engineModule.rowStartPos/(this.parent.pageSettings.rowSize*o)))-this.parent.engineModule.rowFirstLvl*o*this.parent.gridSettings.rowHeight;this.parent.scrollPosObject.verticalSection=p}else{var l="column"===this.parent.dataSource.valueAxis?this.parent.dataSource.values.length:1,n=this.parent.pageSettings.columnSize*l*this.parent.gridSettings.columnWidth,s=Math.ceil(a/n);if(this.parent.scrollPosObject.horizontal===s)return void ej2Popups.hideSpinner(this.parent.element);ej2Popups.showSpinner(this.parent.element),this.parent.scrollPosObject.horizontal=s,this.parent.engineModule.pageSettings.columnCurrentPage=s>1?s:1,this.parent.engineModule.generateGridData(this.parent.dataSource,this.parent.engineModule.headerCollection),this.parent.pivotValues=this.parent.engineModule.pivotValues;var d=Math.ceil(this.parent.engineModule.colStartPos/(this.parent.pageSettings.columnSize*l)),p=n*d-this.parent.engineModule.colFirstLvl*l*this.parent.gridSettings.columnWidth;this.parent.scrollPosObject.horizontalSection=p}},e.prototype.setPageXY=function(){var e=this;return function(t){"mouse"!==t.pointerType&&(e.pageXY=e.getPointXY(t))}},e.prototype.common=function(e,t,i){var a=this;return function(i){a.update(e,t,t.scrollTop*a.parent.verticalScrollScale,t.scrollLeft*a.parent.horizontalScrollScale,i)}},e.prototype.onHorizondalScroll=function(e,t,i){var a,r=this;return function(o){var n=t.scrollLeft*r.parent.horizontalScrollScale;if("wheel"!==o.type&&"touchmove"!==o.type&&"wheel"!==r.eventType&&"touchmove"!==r.eventType||(clearTimeout(a),a=setTimeout(function(){n="touchmove"===o.type?t.scrollLeft:n,r.update(e,t,t.scrollTop*r.parent.verticalScrollScale,n,o)},300)),r.previousValues.left===n)return void(i.scrollTop=t.scrollTop);r.direction="horizondal";var s=-(n-r.parent.scrollPosObject.horizontalSection-t.scrollLeft),l=t.querySelector(".e-table").style.transform.split(",")[1].trim();t.scrollLeft<r.parent.scrollerBrowserLimit&&(ej2Base.setStyleAttribute(t.querySelector(".e-table"),{transform:"translate("+s+"px,"+l}),ej2Base.setStyleAttribute(e.querySelector(".e-table"),{transform:"translate("+s+"px,0px)"}));var d=r.parent.scrollPosObject.horizontalSection>n?-(r.parent.scrollPosObject.horizontalSection-n):n+e.offsetWidth-(r.parent.scrollPosObject.horizontalSection+t.querySelector(".e-table").offsetWidth),p=Math.ceil(r.parent.scrollPosObject.horizontalSection/r.parent.horizontalScrollScale)<r.parent.scrollerBrowserLimit;if(r.parent.scrollPosObject.horizontalSection>n||d>1&&p){n>e.clientWidth?(r.parent.scrollPosObject.left<1&&(r.parent.scrollPosObject.left=e.clientWidth),r.parent.scrollPosObject.left=r.parent.scrollPosObject.left-50,d=r.parent.scrollPosObject.horizontalSection>n?d-r.parent.scrollPosObject.left:d+r.parent.scrollPosObject.left):d=-r.parent.scrollPosObject.horizontalSection,s=-(n-(r.parent.scrollPosObject.horizontalSection+d)-t.scrollLeft);var h=r.parent.gridSettings.columnWidth*r.parent.engineModule.columnCount-r.parent.grid.columns[0].width;h>r.parent.scrollerBrowserLimit&&(r.parent.horizontalScrollScale=h/r.parent.scrollerBrowserLimit,h=r.parent.scrollerBrowserLimit),s>h&&s>n&&(s=n,d=0),ej2Base.setStyleAttribute(t.querySelector(".e-table"),{transform:"translate("+s+"px,"+l}),ej2Base.setStyleAttribute(e.querySelector(".e-table"),{transform:"translate("+s+"px,0px)"}),r.parent.scrollPosObject.horizontalSection=r.parent.scrollPosObject.horizontalSection+d}r.previousValues.left=n,r.frozenPreviousValues.left=n,r.eventType="",e.scrollLeft=t.scrollLeft}},e.prototype.onVerticalScroll=function(e,t){var i,a=this;return function(r){var o=t.scrollTop*a.parent.verticalScrollScale;if("wheel"!==r.type&&"touchmove"!==r.type&&"wheel"!==a.eventType&&"touchmove"!==a.eventType||(clearTimeout(i),i=setTimeout(function(){a.update(null,t,t.scrollTop*a.parent.verticalScrollScale,t.scrollLeft*a.parent.horizontalScrollScale,r)},300)),a.previousValues.top!==o){a.direction="vertical";var n=-(o-a.parent.scrollPosObject.verticalSection-t.scrollTop),s=t.querySelector(".e-table").style.transform.split(",")[0].trim();t.scrollTop<a.parent.scrollerBrowserLimit&&(ej2Base.setStyleAttribute(e.querySelector(".e-table"),{transform:"translate(0px,"+n+"px)"}),ej2Base.setStyleAttribute(t.querySelector(".e-table"),{transform:s+","+n+"px)"}));var l=a.parent.scrollPosObject.verticalSection>o?-(a.parent.scrollPosObject.verticalSection-o):o+e.clientHeight-(a.parent.scrollPosObject.verticalSection+e.querySelector(".e-table").offsetHeight),d=Math.ceil(a.parent.scrollPosObject.verticalSection/a.parent.verticalScrollScale)<a.parent.scrollerBrowserLimit;if(a.parent.scrollPosObject.verticalSection>o||l>1&&d){o>e.clientHeight?(a.parent.scrollPosObject.top<1&&(a.parent.scrollPosObject.top=e.clientHeight),a.parent.scrollPosObject.top=a.parent.scrollPosObject.top-50,l=a.parent.scrollPosObject.verticalSection>o?l-a.parent.scrollPosObject.top:l+a.parent.scrollPosObject.top):l=-a.parent.scrollPosObject.verticalSection;var p=a.parent.element.querySelector(".e-movablecontent").querySelector(".e-table");n=-(o-(a.parent.scrollPosObject.verticalSection+l)-t.scrollTop);var h=a.parent.gridSettings.rowHeight*a.parent.engineModule.rowCount+.1-p.clientHeight;h>a.parent.scrollerBrowserLimit&&(a.parent.verticalScrollScale=h/a.parent.scrollerBrowserLimit,h=a.parent.scrollerBrowserLimit),n>h&&n>o&&(n=o,l=0),ej2Base.setStyleAttribute(e.querySelector(".e-table"),{transform:"translate(0px,"+n+"px)"}),ej2Base.setStyleAttribute(t.querySelector(".e-table"),{transform:s+","+n+"px)"}),a.parent.scrollPosObject.verticalSection=a.parent.scrollPosObject.verticalSection+l}a.previousValues.top=o,a.frozenPreviousValues.top=o,a.eventType="",e.scrollTop=t.scrollTop,t.scrollTop=e.scrollTop}}},e.prototype.removeInternalEvents=function(){this.parent.isDestroyed||this.parent.off(contentReady,this.wireEvents)},e.prototype.destroy=function(){this.removeInternalEvents()},e}(),DrillThroughDialog=function(){function e(e){this.isUpdated=!1,this.gridIndexObjects={},this.parent=e}return e.prototype.showDrillThroughDialog=function(e){var t=this;this.removeDrillThroughDialog();var i=ej2Base.createElement("div",{id:this.parent.element.id+"_drillthrough",className:"e-drillthrough-dialog",styles:"visibility:hidden;"});this.parent.element.appendChild(i),this.dialogPopUp=new ej2Popups.Dialog({animationSettings:{effect:"Fade"},allowDragging:!1,header:this.parent.localeObj.getConstant("details"),content:this.createDrillThroughGrid(e),beforeOpen:function(){t.drillThroughGrid.setProperties({dataSource:t.parent.editSettings.allowEditing?t.dataWithPrimarykey(e):e.rawData,height:300},!0),t.drillThroughGrid.enableVirtualization=!t.parent.editSettings.allowEditing},beforeClose:function(){if(t.parent.editSettings.allowEditing&&t.isUpdated){for(var e=Object.keys(t.gridIndexObjects).length,i=[],a=0,r=t.drillThroughGrid.dataSource;a<r.length;a++){var o=r[a];if(ej2Base.isNullOrUndefined(o.__index)||""===o.__index){for(var n=0,s=t.parent.engineModule.fields;n<s.length;n++){var l=s[n];ej2Base.isNullOrUndefined(o[l])&&delete o[l]}delete o.__index,i.push(o)}else e>0&&(delete t.gridIndexObjects[o.__index.toString()],e--)}e=0;for(var d=[],p=0,h=t.parent.dataSource.data;p<h.length;p++)delete(o=h[p]).__index,void 0===t.gridIndexObjects[e.toString()]&&d.push(o),e++;d=d.concat(i),t.parent.setProperties({dataSource:{data:d}},!0),t.parent.engineModule.updateGridData(t.parent.dataSource),t.parent.pivotValues=t.parent.engineModule.pivotValues}t.isUpdated=!1,t.gridIndexObjects={}},isModal:!0,visible:!0,showCloseIcon:!0,locale:this.parent.locale,enableRtl:this.parent.enableRtl,width:this.parent.isAdaptive?"100%":"60%",position:{X:"center",Y:"center"},closeOnEscape:!0,target:document.body,close:this.removeDrillThroughDialog.bind(this)}),this.dialogPopUp.appendTo(i),ej2Base.setStyleAttribute(this.dialogPopUp.element,{visibility:"visible"})},e.prototype.removeDrillThroughDialog=function(){this.dialogPopUp&&!this.dialogPopUp.isDestroyed&&this.dialogPopUp.destroy();var e=document.getElementById(this.parent.element.id+"_drillthrough");e&&ej2Base.remove(e),document.getElementById(this.parent.element.id+"_drillthroughgrid_ccdlg")&&ej2Base.remove(document.getElementById(this.parent.element.id+"_drillthroughgrid_ccdlg"))},e.prototype.createDrillThroughGrid=function(e){var t=ej2Base.createElement("div",{id:this.parent.element.id+"_drillthroughbody",className:"e-drillthrough-body"}),i=ej2Base.createElement("div",{id:this.parent.element.id+"_drillthroughbodyheader",className:"e-drillthrough-body-header-container"});if(""!==e.rowHeaders&&(i.innerHTML="<span class=e-drillthrough-body-header-common><span class=e-drillthrough-body-header>"+this.parent.localeObj.getConstant("row")+"</span> :<span class=e-drillthrough-body-header-value>"+e.rowHeaders+"</span></span>"),""!==e.columnHeaders&&(i.innerHTML=i.innerHTML+"<span class=e-drillthrough-body-header-common><span class=e-drillthrough-body-header>"+this.parent.localeObj.getConstant("column")+"</span> :<span class=e-drillthrough-body-header-value>"+e.columnHeaders+"</span></span>"),""!==e.value){var a=e.value.split("(")[0],r=e.value.split("(")[1].split(")")[0];"0"!==r&&(i.innerHTML=i.innerHTML+"<span class=e-drillthrough-body-header-common><span class=e-drillthrough-body-header>"+a+"</span> :<span class=e-drillthrough-body-header-value>"+r+"</span></span>")}var o=["ColumnChooser"];this.parent.editSettings.allowEditing&&(o=this.parent.editSettings.allowCommandColumns?["ColumnChooser","Add"]:"Batch"===this.parent.editSettings.mode?["ColumnChooser","Add","Delete","Update","Cancel"]:"Dialog"===this.parent.editSettings.mode?["ColumnChooser","Add","Edit","Delete"]:["ColumnChooser","Add","Edit","Delete","Update","Cancel"]);var n=ej2Base.createElement("div",{id:this.parent.element.id+"_drillthroughgrid",className:"e-drillthrough-grid"});ej2Grids.Grid.Inject(ej2Grids.Selection,ej2Grids.Reorder,ej2Grids.Resize,ej2Grids.Toolbar,ej2Grids.ColumnChooser),this.drillThroughGrid=new ej2Grids.Grid({gridLines:"Default",allowResizing:!0,allowReordering:!0,showColumnChooser:!0,toolbar:o,columns:this.frameGridColumns(),locale:this.parent.locale,enableRtl:this.parent.enableRtl,enableVirtualization:this.parent.editSettings.allowEditing,allowPaging:this.parent.editSettings.allowEditing});var s=this;return this.parent.trigger("beginDrillThrough",{cellInfo:e,gridObj:this.drillThroughGrid,type:"editing"}),this.parent.editSettings.allowEditing?(ej2Grids.Grid.Inject(ej2Grids.Edit,ej2Grids.Page),this.drillThroughGrid.editSettings=this.parent.editSettings,this.parent.editSettings.allowCommandColumns?(this.drillThroughGrid.editSettings.mode="Normal",this.drillThroughGrid.editSettings.allowEditOnDblClick=!1,ej2Grids.Grid.Inject(ej2Grids.CommandColumn),this.drillThroughGrid.columns.push({headerText:this.parent.localeObj.getConstant("manageRecords"),width:160,showInColumnChooser:!1,commands:[{type:"Edit",buttonOption:{iconCss:" e-icons e-edit",cssClass:"e-flat"}},{type:"Delete",buttonOption:{iconCss:"e-icons e-delete",cssClass:"e-flat"}},{type:"Save",buttonOption:{iconCss:"e-icons e-update",cssClass:"e-flat"}},{type:"Cancel",buttonOption:{iconCss:"e-icons e-cancel-icon",cssClass:"e-flat"}}]})):this.drillThroughGrid.editSettings.allowEditOnDblClick=this.parent.editSettings.allowEditOnDblClick,this.drillThroughGrid.columns.push({field:"__index",visible:!1,isPrimaryKey:!0,type:"string",showInColumnChooser:!1}),this.drillThroughGrid.actionComplete=function(e){"batchsave"!==e.requestType&&"save"!==e.requestType&&"delete"!==e.requestType||(s.isUpdated=!0),("Normal"===s.drillThroughGrid.editSettings.mode&&"save"===e.requestType&&s.drillThroughGrid.element.querySelectorAll(".e-tbar-btn:hover").length>0&&!s.parent.editSettings.allowCommandColumns||"batchsave"===e.requestType)&&s.dialogPopUp.hide()},this.drillThroughGrid.beforeBatchSave=function(){s.isUpdated=!0}):ej2Grids.Grid.Inject(ej2Grids.VirtualScroll),document.body.appendChild(n),this.drillThroughGrid.appendTo(n),t.appendChild(i),t.appendChild(n),t},e.prototype.frameGridColumns=function(){for(var e=[],t=0,i=Object.keys(this.parent.engineModule.fieldList);t<i.length;t++){var a=i[t];if("CalculatedField"!==this.parent.engineModule.fieldList[a].aggregateType){var r="";r="number"===this.parent.engineModule.fieldList[a].type?"numericedit":"date"===this.parent.engineModule.fieldList[a].type?"datepickeredit":"",e.push({field:a,headerText:this.parent.engineModule.fieldList[a].caption,width:120,visible:this.parent.engineModule.fieldList[a].isSelected,validationRules:{required:!0},editType:r,type:"string"})}}return e},e.prototype.dataWithPrimarykey=function(e){for(var t=Object.keys(e.currentCell.indexObject),i=e.rawData,a=0,r=0,o=i;r<o.length;r++)o[r].__index=t[a],this.gridIndexObjects[t[a].toString()]=Number(t[a]),a++;return i},e}(),DrillThrough=function(){function e(e){this.parent=e,this.drillThroughDialog=new DrillThroughDialog(this.parent),this.addInternalEvents()}return e.prototype.getModuleName=function(){return"drillthrough"},e.prototype.addInternalEvents=function(){this.parent.on(contentReady,this.wireEvents,this)},e.prototype.wireEvents=function(){this.unWireEvents(),ej2Base.EventHandler.add(this.parent.element,"dblclick",this.mouseClickHandler,this)},e.prototype.unWireEvents=function(){ej2Base.EventHandler.remove(this.parent.element,"dblclick",this.mouseClickHandler)},e.prototype.mouseClickHandler=function(e){var t=e.target,i=null;t.classList.contains("e-stackedheadercelldiv")||t.classList.contains("e-cellvalue")||t.classList.contains("e-headercelldiv")?i=t.parentElement:t.classList.contains("e-headercell")||t.classList.contains("e-rowcell")?i=t:t.classList.contains("e-headertext")&&(i=t.parentElement.parentElement),i&&(this.parent.allowDrillThrough&&i.classList.contains("e-valuescontent")||this.parent.editSettings.allowEditing)&&this.executeDrillThrough(i)},e.prototype.executeDrillThrough=function(e){var t=Number(e.getAttribute("aria-colindex")),i=Number(e.getAttribute("index")),a=this.parent.pivotValues[i][t],r=this.parent.engineModule.fieldList[a.actualText.toString()]?this.parent.engineModule.fieldList[a.actualText.toString()].caption:a.actualText.toString(),o=[];if(void 0!==a.rowHeaders&&void 0!==a.columnHeaders&&void 0!==a.value){for(var n=0,s=Object.keys(a.indexObject);n<s.length;n++){var l=s[n];o.push(this.parent.dataSource.data[Number(l)])}var d=this.parent.engineModule.fieldList[a.actualText].aggregateType,p="CalculatedField"===d?r.toString():d+" of "+r,h={currentTarget:e,currentCell:a,rawData:o,rowHeaders:""===a.rowHeaders?"":a.rowHeaders.toString().split(".").join(" - "),columnHeaders:""===a.columnHeaders?"":a.columnHeaders.toString().split(".").join(" - "),value:p+"("+a.formattedText+")"};this.parent.trigger("drillThrough",h),this.drillThroughDialog.showDrillThroughDialog(h)}},e}(),PivotChart=function(){function e(){this.headerColl={},this.maxLevel=0,this.columnGroupObject={}}return e.prototype.getModuleName=function(){return"pivotchart"},e.prototype.loadChart=function(e,t){if(this.parent=e,this.engineModule=this.parent.engineModule,this.dataSource=this.parent.dataSource,this.chartSettings=t,!(this.dataSource.values.length>0))return this.parent.chart?(this.parent.chart.series=[],this.parent.chart.primaryXAxis.title="",this.parent.chart.primaryYAxis.title="",this.parent.chart.axes.length>0&&(this.parent.chart.axes[0].title=""),this.parent.chart.primaryXAxis.zoomFactor=1,void this.parent.chart.refresh()):void this.parent.notify(contentReady,{});this.chartSettings.enableMultiAxis?this.measureList=this.dataSource.values.map(function(e){return e.name}):this.measureList=[""===t.value?this.dataSource.values[0].name:t.value],this.columnGroupObject={};var i=this.parent.engineModule.pivotValues;this.currentMeasure=t.enableMultiAxis?this.measureList[0]:(""===t.value||0===this.dataSource.values.filter(function(e){return e.name===t.value}).length)&&this.dataSource.values.length>0?this.dataSource.values[0].name:t.value;var a,r=this.getColumnTotalIndex(i),o=Object.keys(i),n=-.5;this.headerColl={};for(var s=0,l=o;s<l.length;s++){var d=l[s],p=Number(d);if(i[p][0]&&"row"===i[p][0].axis&&(0===this.dataSource.rows.length||"grand sum"!==i[p][0].type)){var h=i[p][0];this.maxLevel=h.level>this.maxLevel?h.level:this.maxLevel,void 0===a||a<h.level||n++,a=h.level;var c=h.actualText?h.actualText.toString():h.formattedText.toString(),u={name:c,text:h.hasChild?(h.isDrilled?" - ":" + ")+c:c,levelName:h.valueSort.levelName.toString(),level:h.level,fieldName:h.valueSort.axis?h.valueSort.axis.toString():""};this.headerColl[n]?this.headerColl[n][h.level]=u:(this.headerColl[n]={},this.headerColl[n][h.level]=u);for(var g=i[p],m=0,v=Object.keys(g);m<v.length;m++){var f=v[m],y=Number(f),S=i[p][y];if(!r[S.colIndex]&&"value"===S.axis&&(t.enableMultiAxis||S.actualText===this.currentMeasure)){if(h.isDrilled)break;var b=S.columnHeaders.toString().split(".").join(" - ")+" | "+S.actualText;this.columnGroupObject[b]?this.columnGroupObject[b].push({x:0===this.dataSource.rows.length?h.formattedText:S.rowHeaders.toString().split(".").join(" - "),y:Number(S.value)}):this.columnGroupObject[b]=[{x:0===this.dataSource.rows.length?h.formattedText:S.rowHeaders.toString().split(".").join(" - "),y:Number(S.value)}]}}}}this.refreshChart()},e.prototype.refreshChart=function(){this.chartSeries=[];var e=Object.keys(this.columnGroupObject);this.persistSettings=JSON.parse(this.parent.getPersistData()).chartSettings;for(var t=0,i=e;t<i.length;t++){var a=i[t],r={};(r=this.persistSettings.chartSeries?this.frameObjectWithKeys(this.persistSettings.chartSeries):r).dataSource=this.columnGroupObject[a],r.xName="x",r.yName="y",r.name=this.chartSettings.enableMultiAxis?a:a.split(" | ")[0],"Polar"!==this.chartSettings.chartSeries.type&&"Radar"!==this.chartSettings.chartSeries.type&&(r.yAxisName=a.split(" | ")[1]),this.chartSeries=this.chartSeries.concat(r)}var o={series:this.chartSeries,cancel:!1};this.parent.trigger("chartSeriesCreated",o),o.cancel?(this.element&&ej2Base.remove(this.element),this.parent.notify(contentReady,{})):this.bindChart()},e.prototype.frameObjectWithKeys=function(e){for(var t=Object.keys(e),i=0,a={};i<t.length;)a[t[i]]=e[t[i]],i++;return a},e.prototype.bindChart=function(){var e=this.configXAxis(),t=this.configTooltipSettings(),i=this.configLegendSettings(),a=this.configZoomSettings(),r=this.frameAxesWithRows(),o=this.chartSettings.chartSeries.type;"Both"===this.parent.displayOption.view?this.element="Chart"===this.parent.displayOption.primary?this.parent.element.insertBefore(this.element?this.element:ej2Base.createElement("div",{className:"e-pivotchart",id:this.parent.element.id+"_chart"}),this.parent.element.querySelector(".e-grid")):this.parent.element.appendChild(this.element?this.element:ej2Base.createElement("div",{className:"e-pivotchart",id:this.parent.element.id+"_chart"})):this.element||(this.element=this.parent.element.appendChild(ej2Base.createElement("div",{className:"e-pivotchart",id:this.parent.element.id+"_chart"}))),this.parent.chart?(this.parent.chart.series=this.chartSeries,this.parent.chart.primaryXAxis=e,"Polar"===o||"Radar"===o?(this.parent.chart.primaryYAxis.visible=!0,this.parent.chart.primaryYAxis=r.axes[0],this.parent.chart.axes=[],this.parent.chart.rows=[{}]):(this.parent.chart.primaryYAxis.visible=!1,this.parent.chart.axes=r.axes,this.parent.chart.rows=r.rows),this.parent.chart.refresh()):(this.parent.showGroupingBar?this.element.style.minWidth="400px !important":this.element.style.minWidth="310px !important",ej2Charts.Chart.Inject(ej2Charts.ColumnSeries,ej2Charts.StackingColumnSeries,ej2Charts.RangeColumnSeries,ej2Charts.BarSeries,ej2Charts.StackingBarSeries,ej2Charts.ScatterSeries,ej2Charts.BubbleSeries,ej2Charts.LineSeries,ej2Charts.StepLineSeries,ej2Charts.SplineSeries,ej2Charts.SplineAreaSeries,ej2Charts.MultiColoredLineSeries,ej2Charts.PolarSeries,ej2Charts.RadarSeries,ej2Charts.AreaSeries,ej2Charts.RangeAreaSeries,ej2Charts.StackingAreaSeries,ej2Charts.StepAreaSeries,ej2Charts.MultiColoredAreaSeries,ej2Charts.ParetoSeries,ej2Charts.Legend,ej2Charts.Tooltip,ej2Charts.Category,ej2Charts.MultiLevelLabel,ej2Charts.ScrollBar,ej2Charts.Zoom,ej2Charts.Export,ej2Charts.Crosshair),this.parent.chart=new ej2Charts.Chart({series:this.chartSeries,legendSettings:i,tooltip:t,zoomSettings:a,axes:"Polar"===o||"Radar"===o?[]:r.axes,rows:"Polar"===o||"Radar"===o?[{}]:r.rows,primaryYAxis:"Polar"===o||"Radar"===o?r.axes[0]:{visible:!1},primaryXAxis:e,width:this.parent.width.toString(),height:this.parent.height.toString(),title:this.chartSettings.title,titleStyle:this.chartSettings.titleStyle,subTitle:this.chartSettings.subTitle,subTitleStyle:this.chartSettings.subTitleStyle,margin:this.chartSettings.margin,border:this.chartSettings.border,background:this.chartSettings.background,chartArea:this.chartSettings.chartArea,palettes:this.chartSettings.palettes,theme:this.chartSettings.theme,crosshair:this.chartSettings.crosshair,selectionMode:this.chartSettings.selectionMode,isMultiSelect:this.chartSettings.isMultiSelect,enableExport:this.chartSettings.enableExport,selectedDataIndexes:this.chartSettings.selectedDataIndexes,isTransposed:this.chartSettings.isTransposed,enableAnimation:this.chartSettings.enableAnimation,description:this.chartSettings.description,tabIndex:this.chartSettings.tabIndex,locale:this.parent.locale,enableSideBySidePlacement:this.chartSettings.enableSideBySidePlacement,beforePrint:this.chartSettings.beforePrint?this.chartSettings.beforePrint.bind(this):void 0,animationComplete:this.chartSettings.animationComplete?this.chartSettings.animationComplete.bind(this):void 0,legendRender:this.chartSettings.legendRender?this.chartSettings.legendRender.bind(this):void 0,textRender:this.chartSettings.textRender?this.chartSettings.textRender.bind(this):void 0,pointRender:this.chartSettings.pointRender?this.chartSettings.pointRender.bind(this):void 0,seriesRender:this.chartSettings.seriesRender?this.chartSettings.seriesRender.bind(this):void 0,chartMouseMove:this.chartSettings.chartMouseMove?this.chartSettings.chartMouseMove.bind(this):void 0,chartMouseClick:this.chartSettings.chartMouseClick?this.chartSettings.chartMouseClick.bind(this):void 0,pointMove:this.chartSettings.pointMove?this.chartSettings.pointMove.bind(this):void 0,pointClick:this.chartSettings.pointClick?this.chartSettings.pointClick.bind(this):void 0,chartMouseLeave:this.chartSettings.chartMouseLeave?this.chartSettings.chartMouseLeave.bind(this):void 0,chartMouseDown:this.chartSettings.chartMouseDown?this.chartSettings.chartMouseDown.bind(this):void 0,chartMouseUp:this.chartSettings.chartMouseUp?this.chartSettings.chartMouseUp.bind(this):void 0,dragComplete:this.chartSettings.dragComplete?this.chartSettings.dragComplete.bind(this):void 0,zoomComplete:this.chartSettings.zoomComplete?this.chartSettings.zoomComplete.bind(this):void 0,scrollStart:this.chartSettings.scrollStart?this.chartSettings.scrollStart.bind(this):void 0,scrollEnd:this.chartSettings.scrollEnd?this.chartSettings.scrollEnd.bind(this):void 0,scrollChanged:this.chartSettings.scrollChanged?this.chartSettings.scrollChanged.bind(this):void 0,tooltipRender:this.tooltipRender.bind(this),loaded:this.loaded.bind(this),load:this.load.bind(this),resized:this.resized.bind(this),axisLabelRender:this.axisLabelRender.bind(this)},"#"+this.parent.element.id+"_chart"))},e.prototype.frameAxesWithRows=function(){var e=this,t=[],i=[],a=this.persistSettings.chartSeries&&("StackingColumn100"===this.persistSettings.chartSeries.type||"StackingBar100"===this.persistSettings.chartSeries.type||"StackingArea100"===this.persistSettings.chartSeries.type);if(this.chartSettings.enableMultiAxis)for(var r=0,o=100/this.dataSource.values.length+"%",n=this,s=0,l=this.dataSource.values;s<l.length;s++)!function(e){var s=n.engineModule.fieldList[e.name],l=n.parent.localeObj.getConstant(s.aggregateType)+" of "+s.caption,d=n.dataSource.formatSettings.filter(function(t){return t.name===e.name})[0],p="Polar"===n.chartSettings.chartSeries.type||"Radar"===n.chartSettings.chartSeries.type,h={};(h=n.persistSettings.primaryYAxis?n.frameObjectWithKeys(n.persistSettings.primaryYAxis):h).labelFormat=h.labelFormat?h.labelFormat:a?"":d&&!p?d.format:"N",h.title=h.title?h.title:l,h.plotOffset=h.plotOffset?h.plotOffset:r%2!=0?30:0,h.rowIndex=r,p||(h.name=e.name),t=t.concat(h),i.push({height:o}),r++}(l[s]);else{var d=this.engineModule.fieldList[this.currentMeasure],p=this.parent.localeObj.getConstant(d.aggregateType)+" of "+d.caption,h=this.dataSource.formatSettings.filter(function(t){return t.name===e.currentMeasure})[0],c={};(c=this.persistSettings.primaryYAxis?this.frameObjectWithKeys(this.persistSettings.primaryYAxis):c).rowIndex=0,"Polar"!==this.chartSettings.chartSeries.type&&"Radar"!==this.chartSettings.chartSeries.type&&(c.name=this.currentMeasure),c.labelFormat=c.labelFormat?c.labelFormat:a?"":h?h.format:"N",c.title=c.title?c.title:p,t=t.concat(c),i.push({height:"100%"})}return{axes:t,rows:i}},e.prototype.getColumnTotalIndex=function(e){for(var t={},i=0,a=Object.keys(e);i<a.length;i++)for(var r=a[i],o=e[Number(r)],n=0,s=Object.keys(o);n<s.length;n++){var l=s[n],d=o[Number(l)];if("column"!==d.axis)return t;("sum"===d.type||0!==this.dataSource.columns.length&&"grand sum"===d.type)&&-1!==d.rowSpan&&(t[d.colIndex]=d.colIndex)}return t},e.prototype.getZoomFactor=function(){isNaN(Number(this.parent.width))?this.parent.width.indexOf("%")>-1?this.calculatedWidth=this.parent.element.clientWidth*(parseFloat(this.parent.width)/100):this.parent.width.indexOf("px")>-1?this.calculatedWidth=Number(this.parent.width.toString().split("px")[0]):this.calculatedWidth=this.parent.element.clientWidth:this.calculatedWidth=Number(this.parent.width);var e=10*this.chartSeries.length>120?10*this.chartSeries.length:120,t=this.chartSeries.length>0?this.calculatedWidth/(Object.keys(this.chartSeries[0].dataSource).length*e):1;return t=t<1&&t>0?t:1},e.prototype.configTooltipSettings=function(){var e=this.chartSettings.tooltip;return e.enable=void 0===e.enable||e.enable,e.header=e.header?e.header:"",e.enableMarker=void 0===e.enableMarker||e.enableMarker,e},e.prototype.configLegendSettings=function(){var e={};return e=this.chartSettings.legendSettings?this.chartSettings.legendSettings:e,e.padding=e.padding?e.padding:25,e.shapePadding=e.shapePadding?e.shapePadding:10,e},e.prototype.configXAxis=function(){var e={};return e=this.persistSettings.primaryXAxis?this.frameObjectWithKeys(this.persistSettings.primaryXAxis):e,e.valueType="Category",e.labelIntersectAction=e.labelIntersectAction?e.labelIntersectAction:"Rotate45",e.title=e.title?e.title:this.dataSource.rows.map(function(e){return e.caption||e.name}).join(" / "),e.zoomFactor=this.getZoomFactor(),e},e.prototype.configZoomSettings=function(){var e=this.chartSettings.zoomSettings;return e.enableSelectionZooming=void 0===e.enableSelectionZooming||e.enableSelectionZooming,e.enableScrollbar=void 0===e.enableScrollbar||e.enableScrollbar,e},e.prototype.tooltipRender=function(e){var t=this.engineModule.fieldList[e.series.yAxisName?e.series.yAxisName.split("_CumulativeAxis")[0]:this.chartSettings.enableMultiAxis?e.series.name.split(" | ")[1]:this.currentMeasure],i=this.parent.localeObj.getConstant(t.aggregateType)+" of "+t.caption;e.text=i+": "+this.parent.engineModule.getFormattedValue(e.point.y,t.id).formattedText+" <br/>"+(0===this.dataSource.columns.length?"":this.parent.localeObj.getConstant("column")+": "+e.series.name.split(" | ")[0]+" <br/>")+(0===this.dataSource.rows.length?"":this.parent.localeObj.getConstant("row")+": "+e.point.x),this.parent.trigger("chartTooltipRender",e)},e.prototype.loaded=function(e){this.parent.isChartLoaded=!0,this.parent.chart&&this.parent.showGroupingBar&&this.parent.groupingBarModule&&this.parent.showFieldList&&"Chart"===this.parent.currentView&&this.parent.groupingBarModule.alignIcon(),this.parent.notify(contentReady,{}),this.parent.trigger("chartLoaded",e)},e.prototype.axisLabelRender=function(e){this.parent.trigger("chartAxisLabelRender",e)},e.prototype.load=function(e){e.chart.zoomModule&&(e.chart.zoomModule.isZoomed=!0),this.parent.trigger("chartLoad",e)},e.prototype.resized=function(e){e.chart.primaryXAxis.zoomFactor=this.getZoomFactor(),this.parent.trigger("chartResized",e)},e.prototype.destroy=function(){},e}(),__extends$3=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function a(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),__decorate$3=function(e,t,i,a){var r,o=arguments.length,n=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,a);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n},PivotSeries=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$3(t,e),__decorate$3([ej2Base.Property(null)],t.prototype,"fill",void 0),__decorate$3([ej2Base.Complex(null,ej2Charts.Animation)],t.prototype,"animation",void 0),__decorate$3([ej2Base.Property("0")],t.prototype,"dashArray",void 0),__decorate$3([ej2Base.Property(1)],t.prototype,"width",void 0),__decorate$3([ej2Base.Property("X")],t.prototype,"segmentAxis",void 0),__decorate$3([ej2Base.Property("Line")],t.prototype,"drawType",void 0),__decorate$3([ej2Base.Property(!0)],t.prototype,"isClosed",void 0),__decorate$3([ej2Base.Collection([],ej2Charts.ChartSegment)],t.prototype,"segments",void 0),__decorate$3([ej2Base.Property("")],t.prototype,"stackingGroup",void 0),__decorate$3([ej2Base.Complex({color:"transparent",width:0},ej2Charts.Border)],t.prototype,"border",void 0),__decorate$3([ej2Base.Property(!0)],t.prototype,"visible",void 0),__decorate$3([ej2Base.Property(1)],t.prototype,"opacity",void 0),__decorate$3([ej2Base.Property("Line")],t.prototype,"type",void 0),__decorate$3([ej2Base.Complex(null,ej2Charts.MarkerSettings)],t.prototype,"marker",void 0),__decorate$3([ej2Base.Complex(null,ej2Charts.ErrorBarSettings)],t.prototype,"errorBar",void 0),__decorate$3([ej2Base.Property(!0)],t.prototype,"enableTooltip",void 0),__decorate$3([ej2Base.Collection([],ej2Charts.Trendline)],t.prototype,"trendlines",void 0),__decorate$3([ej2Base.Property("")],t.prototype,"tooltipMappingName",void 0),__decorate$3([ej2Base.Property("SeriesType")],t.prototype,"legendShape",void 0),__decorate$3([ej2Base.Property(1)],t.prototype,"minRadius",void 0),__decorate$3([ej2Base.Property(null)],t.prototype,"selectionStyle",void 0),__decorate$3([ej2Base.Property("Natural")],t.prototype,"splineType",void 0),__decorate$3([ej2Base.Property(3)],t.prototype,"maxRadius",void 0),__decorate$3([ej2Base.Property(.5)],t.prototype,"cardinalSplineTension",void 0),__decorate$3([ej2Base.Property(null)],t.prototype,"columnWidth",void 0),__decorate$3([ej2Base.Complex(null,ej2Charts.EmptyPointSettings)],t.prototype,"emptyPointSettings",void 0),__decorate$3([ej2Base.Complex(null,ej2Charts.CornerRadius)],t.prototype,"cornerRadius",void 0),__decorate$3([ej2Base.Property(0)],t.prototype,"columnSpacing",void 0),t}(ej2Base.ChildProperty),PivotAxis=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$3(t,e),__decorate$3([ej2Base.Property("Rotate45")],t.prototype,"labelIntersectAction",void 0),__decorate$3([ej2Base.Complex(ej2Charts.Theme.axisLabelFont,ej2Charts.Font)],t.prototype,"labelStyle",void 0),__decorate$3([ej2Base.Property("")],t.prototype,"title",void 0),__decorate$3([ej2Base.Complex({},ej2Charts.CrosshairTooltip)],t.prototype,"crosshairTooltip",void 0),__decorate$3([ej2Base.Property("")],t.prototype,"labelFormat",void 0),__decorate$3([ej2Base.Complex(ej2Charts.Theme.axisTitleFont,ej2Charts.Font)],t.prototype,"titleStyle",void 0),__decorate$3([ej2Base.Property(!1)],t.prototype,"isIndexed",void 0),__decorate$3([ej2Base.Property(0)],t.prototype,"plotOffset",void 0),__decorate$3([ej2Base.Property("None")],t.prototype,"edgeLabelPlacement",void 0),__decorate$3([ej2Base.Property("BetweenTicks")],t.prototype,"labelPlacement",void 0),__decorate$3([ej2Base.Property("Outside")],t.prototype,"tickPosition",void 0),__decorate$3([ej2Base.Property(!1)],t.prototype,"opposedPosition",void 0),__decorate$3([ej2Base.Property(!0)],t.prototype,"visible",void 0),__decorate$3([ej2Base.Property("Outside")],t.prototype,"labelPosition",void 0),__decorate$3([ej2Base.Property(0)],t.prototype,"labelRotation",void 0),__decorate$3([ej2Base.Property(0)],t.prototype,"minorTicksPerInterval",void 0),__decorate$3([ej2Base.Property(null)],t.prototype,"maximum",void 0),__decorate$3([ej2Base.Property(null)],t.prototype,"minimum",void 0),__decorate$3([ej2Base.Property(34)],t.prototype,"maximumLabelWidth",void 0),__decorate$3([ej2Base.Property(null)],t.prototype,"interval",void 0),__decorate$3([ej2Base.Complex({},ej2Charts.MajorTickLines)],t.prototype,"majorTickLines",void 0),__decorate$3([ej2Base.Property(!1)],t.prototype,"enableTrim",void 0),__decorate$3([ej2Base.Complex({},ej2Charts.MajorGridLines)],t.prototype,"majorGridLines",void 0),__decorate$3([ej2Base.Complex({},ej2Charts.MinorTickLines)],t.prototype,"minorTickLines",void 0),__decorate$3([ej2Base.Complex({},ej2Charts.AxisLine)],t.prototype,"lineStyle",void 0),__decorate$3([ej2Base.Complex({},ej2Charts.MinorGridLines)],t.prototype,"minorGridLines",void 0),__decorate$3([ej2Base.Property(!1)],t.prototype,"isInversed",void 0),__decorate$3([ej2Base.Property(null)],t.prototype,"description",void 0),__decorate$3([ej2Base.Property(0)],t.prototype,"startAngle",void 0),__decorate$3([ej2Base.Property(100)],t.prototype,"coefficient",void 0),__decorate$3([ej2Base.Collection([],ej2Charts.StripLineSettings)],t.prototype,"stripLines",void 0),__decorate$3([ej2Base.Property(2)],t.prototype,"tabIndex",void 0),__decorate$3([ej2Base.Complex({color:null,width:0,type:"Rectangle"},ej2Charts.LabelBorder)],t.prototype,"border",void 0),t}(ej2Base.ChildProperty),PivotTooltipSettings=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$3(t,e),__decorate$3([ej2Base.Property(!1)],t.prototype,"enableMarker",void 0),__decorate$3([ej2Base.Property(!0)],t.prototype,"enable",void 0),__decorate$3([ej2Base.Property(null)],t.prototype,"fill",void 0),__decorate$3([ej2Base.Property(!1)],t.prototype,"shared",void 0),__decorate$3([ej2Base.Property(.75)],t.prototype,"opacity",void 0),__decorate$3([ej2Base.Property(null)],t.prototype,"header",void 0),__decorate$3([ej2Base.Property(null)],t.prototype,"format",void 0),__decorate$3([ej2Base.Complex(ej2Charts.Theme.tooltipLabelFont,ej2Charts.Font)],t.prototype,"textStyle",void 0),__decorate$3([ej2Base.Property(null)],t.prototype,"template",void 0),__decorate$3([ej2Base.Complex({color:"#cccccc",width:.5},ej2Charts.Border)],t.prototype,"border",void 0),__decorate$3([ej2Base.Property(!0)],t.prototype,"enableAnimation",void 0),t}(ej2Base.ChildProperty),PivotZoomSettings=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$3(t,e),__decorate$3([ej2Base.Property(!1)],t.prototype,"enablePinchZooming",void 0),__decorate$3([ej2Base.Property(!0)],t.prototype,"enableSelectionZooming",void 0),__decorate$3([ej2Base.Property(!1)],t.prototype,"enableDeferredZooming",void 0),__decorate$3([ej2Base.Property(!1)],t.prototype,"enableMouseWheelZooming",void 0),__decorate$3([ej2Base.Property("XY")],t.prototype,"mode",void 0),__decorate$3([ej2Base.Property(["Zoom","ZoomIn","ZoomOut","Pan","Reset"])],t.prototype,"toolbarItems",void 0),__decorate$3([ej2Base.Property(!0)],t.prototype,"enableScrollbar",void 0),__decorate$3([ej2Base.Property(!1)],t.prototype,"enablePan",void 0),t}(ej2Base.ChildProperty),ChartSettings=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$3(t,e),__decorate$3([ej2Base.Complex({},PivotSeries)],t.prototype,"chartSeries",void 0),__decorate$3([ej2Base.Complex({},PivotAxis)],t.prototype,"primaryXAxis",void 0),__decorate$3([ej2Base.Complex({},PivotAxis)],t.prototype,"primaryYAxis",void 0),__decorate$3([ej2Base.Property("")],t.prototype,"value",void 0),__decorate$3([ej2Base.Property(!1)],t.prototype,"enableMultiAxis",void 0),__decorate$3([ej2Base.Complex(ej2Charts.Theme.chartTitleFont,ej2Charts.Font)],t.prototype,"titleStyle",void 0),__decorate$3([ej2Base.Property("")],t.prototype,"title",void 0),__decorate$3([ej2Base.Complex(ej2Charts.Theme.chartSubTitleFont,ej2Charts.Font)],t.prototype,"subTitleStyle",void 0),__decorate$3([ej2Base.Property("")],t.prototype,"subTitle",void 0),__decorate$3([ej2Base.Complex({color:"#DDDDDD",width:0},ej2Charts.Border)],t.prototype,"border",void 0),__decorate$3([ej2Base.Complex({},ej2Charts.Margin)],t.prototype,"margin",void 0),__decorate$3([ej2Base.Complex({border:{color:null,width:.5},background:"transparent"},ej2Charts.ChartArea)],t.prototype,"chartArea",void 0),__decorate$3([ej2Base.Property(null)],t.prototype,"background",void 0),__decorate$3([ej2Base.Property("Material")],t.prototype,"theme",void 0),__decorate$3([ej2Base.Property([])],t.prototype,"palettes",void 0),__decorate$3([ej2Base.Complex({},ej2Charts.CrosshairSettings)],t.prototype,"crosshair",void 0),__decorate$3([ej2Base.Complex({},PivotTooltipSettings)],t.prototype,"tooltip",void 0),__decorate$3([ej2Base.Complex({},PivotZoomSettings)],t.prototype,"zoomSettings",void 0),__decorate$3([ej2Base.Property()],t.prototype,"legendSettings",void 0),__decorate$3([ej2Base.Property("None")],t.prototype,"selectionMode",void 0),__decorate$3([ej2Base.Property(!0)],t.prototype,"enableExport",void 0),__decorate$3([ej2Base.Property(!1)],t.prototype,"isMultiSelect",void 0),__decorate$3([ej2Base.Collection([],ej2Charts.Indexes)],t.prototype,"selectedDataIndexes",void 0),__decorate$3([ej2Base.Property(!0)],t.prototype,"enableAnimation",void 0),__decorate$3([ej2Base.Property(!1)],t.prototype,"isTransposed",void 0),__decorate$3([ej2Base.Property(1)],t.prototype,"tabIndex",void 0),__decorate$3([ej2Base.Property(null)],t.prototype,"description",void 0),__decorate$3([ej2Base.Event()],t.prototype,"resized",void 0),__decorate$3([ej2Base.Property(!0)],t.prototype,"enableSideBySidePlacement",void 0),__decorate$3([ej2Base.Event()],t.prototype,"loaded",void 0),__decorate$3([ej2Base.Event()],t.prototype,"beforePrint",void 0),__decorate$3([ej2Base.Event()],t.prototype,"animationComplete",void 0),__decorate$3([ej2Base.Event()],t.prototype,"load",void 0),__decorate$3([ej2Base.Event()],t.prototype,"textRender",void 0),__decorate$3([ej2Base.Event()],t.prototype,"legendRender",void 0),__decorate$3([ej2Base.Event()],t.prototype,"seriesRender",void 0),__decorate$3([ej2Base.Event()],t.prototype,"pointRender",void 0),__decorate$3([ej2Base.Event()],t.prototype,"tooltipRender",void 0),__decorate$3([ej2Base.Event()],t.prototype,"axisLabelRender",void 0),__decorate$3([ej2Base.Event()],t.prototype,"chartMouseClick",void 0),__decorate$3([ej2Base.Event()],t.prototype,"chartMouseMove",void 0),__decorate$3([ej2Base.Event()],t.prototype,"pointMove",void 0),__decorate$3([ej2Base.Event()],t.prototype,"pointClick",void 0),__decorate$3([ej2Base.Event()],t.prototype,"chartMouseDown",void 0),__decorate$3([ej2Base.Event()],t.prototype,"chartMouseLeave",void 0),__decorate$3([ej2Base.Event()],t.prototype,"dragComplete",void 0),__decorate$3([ej2Base.Event()],t.prototype,"chartMouseUp",void 0),__decorate$3([ej2Base.Event()],t.prototype,"scrollStart",void 0),__decorate$3([ej2Base.Event()],t.prototype,"zoomComplete",void 0),__decorate$3([ej2Base.Event()],t.prototype,"scrollChanged",void 0),__decorate$3([ej2Base.Event()],t.prototype,"scrollEnd",void 0),t}(ej2Base.ChildProperty),__extends=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function a(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),__decorate=function(e,t,i,a){var r,o=arguments.length,n=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,a);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n},GroupingBarSettings=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),__decorate([ej2Base.Property(!0)],t.prototype,"showFilterIcon",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"showSortIcon",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"showRemoveIcon",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"showValueTypeIcon",void 0),__decorate([ej2Base.Property("Both")],t.prototype,"displayMode",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"allowDragAndDrop",void 0),t}(ej2Base.ChildProperty),CellEditSettings=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),__decorate([ej2Base.Property(!1)],t.prototype,"allowAdding",void 0),__decorate([ej2Base.Property(!1)],t.prototype,"allowEditing",void 0),__decorate([ej2Base.Property(!1)],t.prototype,"allowDeleting",void 0),__decorate([ej2Base.Property(!1)],t.prototype,"allowCommandColumns",void 0),__decorate([ej2Base.Property("Normal")],t.prototype,"mode",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"allowEditOnDblClick",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"showConfirmDialog",void 0),__decorate([ej2Base.Property(!1)],t.prototype,"showDeleteConfirmDialog",void 0),t}(ej2Base.ChildProperty),ConditionalSettings=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),__decorate([ej2Base.Property()],t.prototype,"measure",void 0),__decorate([ej2Base.Property()],t.prototype,"label",void 0),__decorate([ej2Base.Property("NotEquals")],t.prototype,"conditions",void 0),__decorate([ej2Base.Property()],t.prototype,"value1",void 0),__decorate([ej2Base.Property()],t.prototype,"value2",void 0),t}(ej2Base.ChildProperty),HyperlinkSettings=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),__decorate([ej2Base.Property(!1)],t.prototype,"showHyperlink",void 0),__decorate([ej2Base.Property(!1)],t.prototype,"showRowHeaderHyperlink",void 0),__decorate([ej2Base.Property(!1)],t.prototype,"showColumnHeaderHyperlink",void 0),__decorate([ej2Base.Property(!1)],t.prototype,"showValueCellHyperlink",void 0),__decorate([ej2Base.Property(!1)],t.prototype,"showSummaryCellHyperlink",void 0),__decorate([ej2Base.Collection([],ConditionalSettings)],t.prototype,"conditionalSettings",void 0),__decorate([ej2Base.Property()],t.prototype,"headerText",void 0),__decorate([ej2Base.Property("")],t.prototype,"cssClass",void 0),t}(ej2Base.ChildProperty),DisplayOption=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),__decorate([ej2Base.Property("Table")],t.prototype,"view",void 0),__decorate([ej2Base.Property("Table")],t.prototype,"primary",void 0),t}(ej2Base.ChildProperty),PivotView=function(e){function t(t,i){var a=e.call(this,t,i)||this;return a.verticalScrollScale=1,a.horizontalScrollScale=1,a.scrollerBrowserLimit=5e5,a.lastSortInfo={},a.lastFilterInfo={},a.lastAggregationInfo={},a.lastCalcFieldInfo={},a.shiftLockedPos=[],a.savedSelectedCellsPos=[],a.isPopupClicked=!1,a.isMouseDown=!1,a.isMouseUp=!1,a.defaultItems={},a.isCellBoxMultiSelection=!1,a.gridHeaderCellInfo=[],a.rowRangeSelection={enable:!1,startIndex:0,endIndex:0},a.resizeInfo={},a.scrollPosObject={vertical:0,horizontal:0,verticalSection:0,horizontalSection:0,top:0,left:0,scrollDirection:{direction:"",position:0}},a.pivotColumns=[],a.totColWidth=0,a.posCount=0,a.isModified=!1,a.needsID=!0,a.pivotView=a,a.engineModule=new PivotEngine,a}__extends(t,e),i=t,t.prototype.requiredModules=function(){var e,t=[];return this.allowConditionalFormatting&&t.push({args:[this],member:"conditionalformatting"}),this.allowCalculatedField&&(e=!0,t.push({args:[this],member:"calculatedfield"})),this.showGroupingBar&&(e=!0,t.push({args:[this],member:"grouping"})),this.showToolbar&&this.toolbar.length>0&&(e=!0,t.push({args:[this],member:"toolbar"})),this.showFieldList&&(e=!0,t.push({args:[this],member:"fieldlist"})),this.allowExcelExport&&t.push({args:[this],member:"excelExport"}),this.allowPdfExport&&t.push({args:[this],member:"pdfExport"}),this.enableVirtualization&&t.push({args:[this],member:"virtualscroll"}),this.gridSettings&&this.gridSettings.contextMenuItems&&(e=!0),e&&t.push({args:[this],member:"common"}),t},t.prototype.preRender=function(){this.initProperties(),this.isAdaptive=ej2Base.Browser.isDevice,this.renderToolTip(),this.renderContextMenu(),this.keyboardModule=new KeyboardInteraction(this),this.contextMenuModule=new PivotContextMenu(this),this.globalize=new ej2Base.Internationalization(this.locale),this.defaultLocale={grandTotal:"Grand Total",total:"Total",value:"Value",noValue:"No value",row:"Row",column:"Column",collapse:"Collapse",expand:"Expand",rowAxisPrompt:"Drop row here",columnAxisPrompt:"Drop column here",valueAxisPrompt:"Drop value here",filterAxisPrompt:"Drop filter here",filter:"Filter",filtered:"Filtered",sort:"Sort",filters:"Filters",rows:"Rows",columns:"Columns",values:"Values",close:"Close",cancel:"Cancel",delete:"Delete",calculatedField:"Calculated Field",createCalculatedField:"Create Calculated Field",fieldName:"Enter the field name",error:"Error",invalidFormula:"Invalid formula.",dropText:'Example: ("Sum(Order_Count)" + "Sum(In_Stock)") * 250',dropTextMobile:"Add fields and edit formula here.",dropAction:"Calculated field cannot be place in any other region except value axis.",alert:"Alert",warning:"Warning",ok:"OK",search:"Search",drag:"Drag",remove:"Remove",sum:"Sum",average:"Average",count:"Count",min:"Min",max:"Max",allFields:"All Fields",formula:"Formula",addToRow:"Add to Row",addToColumn:"Add to Column",addToValue:"Add to Value",addToFilter:"Add to Filter",emptyData:"No records to display",fieldExist:"A field already exists in this name. Please enter a different name.",confirmText:"A calculation field already exists in this name. Do you want to replace it?",noMatches:"No matches",format:"Summaries values by",edit:"Edit",clear:"Clear",formulaField:"Drag and drop fields to formula",dragField:"Drag field to formula",clearFilter:"Clear",by:"by",all:"All",multipleItems:"Multiple items",member:"Member",label:"Label",date:"Date",enterValue:"Enter value",chooseDate:"Enter date",Before:"Before",BeforeOrEqualTo:"Before Or Equal To",After:"After",AfterOrEqualTo:"After Or Equal To",labelTextContent:"Show the items for which the label",dateTextContent:"Show the items for which the date",valueTextContent:"Show the items for which",Equals:"Equals",DoesNotEquals:"Does Not Equal",BeginWith:"Begins With",DoesNotBeginWith:"Does Not Begin With",EndsWith:"Ends With",DoesNotEndsWith:"Does Not End With",Contains:"Contains",DoesNotContains:"Does Not Contain",GreaterThan:"Greater Than",GreaterThanOrEqualTo:"Greater Than Or Equal To",LessThan:"Less Than",LessThanOrEqualTo:"Less Than Or Equal To",Between:"Between",NotBetween:"Not Between",And:"and",Sum:"Sum",Count:"Count",DistinctCount:"Distinct Count",Product:"Product",Avg:"Avg",Min:"Min",SampleVar:"Sample Var",PopulationVar:"Population Var",RunningTotals:"Running Totals",Max:"Max",Index:"Index",SampleStDev:"Sample StDev",PopulationStDev:"Population StDev",PercentageOfRowTotal:"% of Row Total",PercentageOfParentTotal:"% of Parent Total",PercentageOfParentColumnTotal:"% of Parent Column Total",PercentageOfParentRowTotal:"% of Parent Row Total",DifferenceFrom:"Difference From",PercentageOfDifferenceFrom:"% of Difference From",PercentageOfGrandTotal:"% of Grand Total",PercentageOfColumnTotal:"% of Column Total",NotEquals:"Not Equals",AllValues:"All Values",conditionalFormating:"Conditional Formatting",apply:"APPLY",condition:"Add Condition",formatLabel:"Format",valueFieldSettings:"Value field settings",baseField:"Base field :",baseItem:"Base item :",summarizeValuesBy:"Summarize values by :",sourceName:"Field name :",sourceCaption:"Field caption :",example:"e.g:",editorDataLimitMsg:" more items. Search to refine further.",details:"Details",manageRecords:"Manage Records",Years:"Years",Quarters:"Quarters",Months:"Months",Days:"Days",Hours:"Hours",Minutes:"Minutes",Seconds:"Seconds",save:"Save a report",new:"Create a new report",load:"Load",saveAs:"Save as current report",rename:"Rename a current report",deleteReport:"Delete a current report",export:"Export",subTotals:"Sub totals",grandTotals:"Grand totals",reportName:"Report Name :",pdf:"PDF",excel:"Excel",csv:"CSV",showSubTotals:"Show sub totals",doNotShowSubTotals:"Do not show sub totals",showSubTotalsRowsOnly:"Show sub totals rows only",showSubTotalsColumnsOnly:"Show sub totals columns only",showGrandTotals:"Show grand totals",doNotShowGrandTotals:"Do not show grand totals",showGrandTotalsRowsOnly:"Show grand totals rows only",showGrandTotalsColumnsOnly:"Show grand totals columns only",fieldList:"Show fieldlist",grid:"Show table",toolbarFormatting:"Conditional formatting",chart:"Chart",reportMsg:"Please enter vaild report name!!!",reportList:"Report list",removeConfirm:"Are you sure want to delete this report?",emptyReport:"No reports found!!",bar:"Bar",line:"Line",area:"Area",scatter:"Scatter",polar:"Polar",of:"of",emptyFormat:"No format found!!!",emptyInput:"Enter a value",newReportConfirm:"Want to save changes to report?",emptyReportName:"Enter a report name"},this.localeObj=new ej2Base.L10n(this.getModuleName(),this.defaultLocale,this.locale),this.isDragging=!1,this.addInternalEvents(),ej2Base.setCurrencyCode(this.currencyCode)},t.prototype.onBeforeTooltipOpen=function(e){e.element.classList.add("e-pivottooltipwrap")},t.prototype.renderToolTip=function(){this.showTooltip?(this.tooltip=new ej2Popups.Tooltip({target:"td.e-valuescontent",showTipPointer:!1,enableRtl:this.enableRtl,beforeRender:this.setToolTip.bind(this),beforeOpen:this.onBeforeTooltipOpen}),this.tooltip.appendTo(this.element)):this.tooltip&&this.tooltip.destroy()},t.prototype.renderContextMenu=function(){if(this.gridSettings.contextMenuItems){for(var e=[],t=[],i=[],a=[],r=[],o=[],n=0,s=this.gridSettings.contextMenuItems;n<s.length;n++){var l=s[n];"string"==typeof l&&-1!==this.getDefaultItems().indexOf(l)?-1!==l.toString().toLowerCase().indexOf("aggregate")?o=[{text:"Sum",id:"AggSum"},{text:"Distinct Count",id:"AggDistinctCount"},{text:"Count",id:"AggCount"},{text:"Product",id:"AggProduct"},{text:"Avg",id:"AggAvg"},{text:"Max",id:"AggMax"},{text:"Min",id:"AggMin"},{text:"More...",id:"AggMoreOption"}]:-1!==l.toString().toLowerCase().indexOf("export")?i.push(this.buildDefaultItems(l)):e.push(this.buildDefaultItems(l)):"string"!=typeof l&&t.push(l)}if(o.length>0){var d=this.buildDefaultItems("Aggregate");d.items=o,a.push(d)}if(i.length>0){var p=this.buildDefaultItems("export");p.items=i,r.push(p)}this.gridSettings.contextMenuItems=[],Array.prototype.push.apply(this.gridSettings.contextMenuItems,a),Array.prototype.push.apply(this.gridSettings.contextMenuItems,e),Array.prototype.push.apply(this.gridSettings.contextMenuItems,r),Array.prototype.push.apply(this.gridSettings.contextMenuItems,t)}},t.prototype.getDefaultItems=function(){return["Drillthrough","Expand","Collapse","Pdf Export","Excel Export","Csv Export","Sort Ascending","Sort Descending","Aggregate","CalculatedField"]},t.prototype.buildDefaultItems=function(e){var t;switch(e){case"Aggregate":t={text:"Aggregate",target:"th.e-valuesheader,td.e-valuescontent,.e-stot",id:"aggregate"};break;case"CalculatedField":t={text:"Calculated Field",target:"td.e-valuescontent",id:"CalculatedField"};break;case"Drillthrough":t={text:"Drill Through",target:"td.e-valuescontent",id:"drillthrough",iconCss:"e-pivotview-grid "+ICON};break;case"export":t={text:"Export",target:"td.e-valuescontent",id:"exporting",iconCss:"e-pivotview-export "+ICON};break;case"Pdf Export":t={text:"PDF",id:"pdf",iconCss:"e-pivotview-pdf-export "+ICON};break;case"Excel Export":t={text:"Excel",id:"excel",iconCss:"e-pivotview-excel-export "+ICON};break;case"Csv Export":t={text:"CSV",id:"csv",iconCss:"e-pivotview-csv-export "+ICON};break;case"Expand":t={text:"Expand",target:"td.e-rowsheader,.e-columnsheader",id:"expand",iconCss:"e-pivotview-expand "+ICON};break;case"Collapse":t={text:"Collapse",target:"td.e-rowsheader,.e-columnsheader",id:"collapse",iconCss:"e-pivotview-collapse "+ICON};break;case"Sort Ascending":t={text:"Ascending",target:"th.e-valuesheader,.e-stot",id:"sortasc",iconCss:"e-icon-ascending "+ICON};break;case"Sort Descending":t={text:"Descending",target:"th.e-valuesheader,.e-stot",id:"sortdesc",iconCss:"e-icon-descending "+ICON}}return this.defaultItems[e]={text:t.text,id:t.id,target:t.target,iconCss:t.iconCss},this.defaultItems[e]},t.prototype.initProperties=function(){if(this.setProperties({pivotValues:[]},!0),this.queryCellInfo=this.gridSettings.queryCellInfo?this.gridSettings.queryCellInfo.bind(this):void 0,this.headerCellInfo=this.gridSettings.headerCellInfo?this.gridSettings.headerCellInfo.bind(this):void 0,this.resizing=this.gridSettings.resizing?this.gridSettings.resizing.bind(this):void 0,this.resizeStop=this.gridSettings.resizeStop?this.gridSettings.resizeStop.bind(this):void 0,this.pdfHeaderQueryCellInfo=this.gridSettings.pdfHeaderQueryCellInfo?this.gridSettings.pdfHeaderQueryCellInfo.bind(this):void 0,this.pdfQueryCellInfo=this.gridSettings.pdfQueryCellInfo?this.gridSettings.pdfQueryCellInfo.bind(this):void 0,this.excelHeaderQueryCellInfo=this.gridSettings.excelHeaderQueryCellInfo?this.gridSettings.excelHeaderQueryCellInfo.bind(this):void 0,this.excelQueryCellInfo=this.gridSettings.excelQueryCellInfo?this.gridSettings.excelQueryCellInfo.bind(this):void 0,this.columnDragStart=this.gridSettings.columnDragStart?this.gridSettings.columnDragStart.bind(this):void 0,this.columnDrag=this.gridSettings.columnDrag?this.gridSettings.columnDrag.bind(this):void 0,this.columnDrop=this.gridSettings.columnDrop?this.gridSettings.columnDrop.bind(this):void 0,this.beforeColumnsRender=this.gridSettings.columnRender?this.gridSettings.columnRender:void 0,this.selected=this.gridSettings.cellSelected?this.gridSettings.cellSelected:void 0,this.cellDeselected=this.gridSettings.cellDeselected?this.gridSettings.cellDeselected:void 0,this.rowSelected=this.gridSettings.rowSelected?this.gridSettings.rowSelected:void 0,this.rowDeselected=this.gridSettings.rowDeselected?this.gridSettings.rowDeselected:void 0,this.chartTooltipRender=this.chartSettings.tooltipRender?this.chartSettings.tooltipRender:void 0,this.chartLoaded=this.chartSettings.loaded?this.chartSettings.loaded:void 0,this.chartLoad=this.chartSettings.load?this.chartSettings.load:void 0,this.chartResized=this.chartSettings.resized?this.chartSettings.resized:void 0,this.chartAxisLabelRender=this.chartSettings.axisLabelRender?this.chartSettings.axisLabelRender:void 0,this.contextMenuClick=this.gridSettings.contextMenuClick?this.gridSettings.contextMenuClick:void 0,this.contextMenuOpen=this.gridSettings.contextMenuOpen?this.gridSettings.contextMenuOpen:void 0,null===this.gridSettings.rowHeight&&this.setProperties({gridSettings:{rowHeight:this.isAdaptive?48:36}},!0),this.enableVirtualization&&(this.height="string"==typeof this.height&&-1===this.height.indexOf("%")?Number(this.height.split("px")[0]):this.height,this.width="string"==typeof this.width&&-1===this.width.indexOf("%")?Number(this.width.split("px")[0]):this.width,this.height=isNaN(this.height)?300:this.height,this.width=isNaN(this.width)?800:this.width),this.enableVirtualization){var e=1,t=1;"row"===this.dataSource.valueAxis?t=this.dataSource.values.length:e=this.dataSource.values.length,this.pageSettings={columnCurrentPage:1,rowCurrentPage:1,columnSize:Math.ceil((Math.floor(this.width/this.gridSettings.columnWidth)-1)/e),rowSize:Math.ceil(Math.floor(this.height/this.gridSettings.rowHeight)/t)},this.allowExcelExport&&i.Inject(ExcelExport$1),this.allowPdfExport&&i.Inject(PDFExport),this.editSettings.allowEditing&&i.Inject(DrillThrough)}this.isCellBoxMultiSelection=this.gridSettings.allowSelection&&"Box"===this.gridSettings.selectionSettings.cellSelectionMode&&"Cell"===this.gridSettings.selectionSettings.mode&&"Multiple"===this.gridSettings.selectionSettings.type,"Table"!==this.displayOption.view&&(this.chartModule=new PivotChart),this.currentView=this.currentView?this.currentView:"Both"===this.displayOption.view?this.displayOption.primary:this.displayOption.view},t.prototype.render=function(){this.cellTemplateFn=this.templateParser(this.cellTemplate),ej2Popups.createSpinner({target:this.element},this.createElement),this.trigger("load",{dataSource:this.dataSource}),this.updateClass(),this.notify("init-groupingbar",{}),this.notify("initial-load",{}),this.isAdaptive&&this.contextMenuModule.render(),this.notify("init-toolbar",{})},t.prototype.addInternalEvents=function(){this.on("initial-load",this.generateData,this),this.on(dataReady,this.renderPivotGrid,this),this.on(contentReady,this.onContentReady,this)},t.prototype.removeInternalEvents=function(){this.off("initial-load",this.generateData),this.off(dataReady,this.renderPivotGrid),this.off(contentReady,this.onContentReady)},t.prototype.getPersistData=function(){var e=["dataSource","pivotValues","gridSettings","chartSettings"];return this.addOnPersist(e)},t.prototype.getModuleName=function(){return"pivotview"},t.prototype.copy=function(e){this.grid.copy(e)},t.prototype.onPropertyChanged=function(t,i){for(var a=0,r=Object.keys(t);a<r.length;a++)switch(r[a]){case"dataSource":case"hyperlinkSettings":case"allowDrillThrough":case"editSettings":if(t.dataSource&&t.dataSource.groupSettings&&t.dataSource.groupSettings.length>0){var o=ej2Base.extend([],this.dataSource.groupSettings,null,!0),n=PivotUtil.getClonedData(this.clonedDataSet),s=ej2Base.extend({},this.clonedReport,null,!0);s.data=n,s.groupSettings=o,this.setProperties({dataSource:s},!0)}this.notify("initial-load",{});break;case"pivotValues":case"displayOption":this.notify(dataReady,{});break;case"gridSettings":this.renderModule.updateGridSettings(),this.isCellBoxMultiSelection=this.gridSettings.allowSelection&&"Box"===this.gridSettings.selectionSettings.cellSelectionMode&&"Cell"===this.gridSettings.selectionSettings.mode&&"Multiple"===this.gridSettings.selectionSettings.type;break;case"chartSettings":this.chartModule.loadChart(this,this.chartSettings);break;case"locale":case"currencyCode":this.tooltip&&this.tooltip.destroy(),e.prototype.refresh.call(this);break;case"enableRtl":this.notify(dataReady,{}),this.updateClass();break;case"groupingBarSettings":this.axisFieldModule.render();break;case"showTooltip":this.renderToolTip();break;case"toolbar":this.toolbarModule&&this.toolbarModule.refreshToolbar()}},t.prototype.templateParser=function(e){if(e)try{if(document.querySelectorAll(e).length)return ej2Base.compile(document.querySelector(e).innerHTML.trim())}catch(t){return ej2Base.compile(e)}},t.prototype.getCellTemplate=function(){return this.cellTemplateFn},t.prototype.renderPivotGrid=function(){this.chartModule&&(this.chartModule.engineModule=this.engineModule,this.chartModule.loadChart(this,this.chartSettings)),this.enableVirtualization&&(this.virtualscrollModule=new VirtualScroll$1(this)),"Chart"!==this.displayOption.view?(this.hyperlinkSettings&&(this.isRowCellHyperlink=!!this.hyperlinkSettings.showRowHeaderHyperlink||!!this.hyperlinkSettings.showHyperlink,this.isColumnCellHyperlink=!!this.hyperlinkSettings.showColumnHeaderHyperlink||!!this.hyperlinkSettings.showHyperlink,this.isValueCellHyperlink=!!this.hyperlinkSettings.showValueCellHyperlink||!!this.hyperlinkSettings.showHyperlink,this.isSummaryCellHyperlink=!!this.hyperlinkSettings.showSummaryCellHyperlink||!!this.hyperlinkSettings.showHyperlink,this.applyHyperlinkSettings()),(this.allowDrillThrough||this.editSettings.allowEditing)&&(this.drillThroughModule=new DrillThrough(this)),this.renderModule=new Render(this),this.renderModule.render()):this.grid&&ej2Base.remove(this.grid.element),(this.showFieldList||this.showGroupingBar)&&(this.notify(uiUpdate,this),this.pivotFieldListModule&&this.allowDeferLayoutUpdate&&(this.pivotFieldListModule.clonedDataSource=ej2Base.extend({},this.dataSource,null,!0)),this.showToolbar&&this.showGroupingBar&&this.notify("init-toolbar",this)),this.trigger("dataBound"),this.allowConditionalFormatting&&this.applyFormatting(),this.showToolbar&&"Both"===this.displayOption.view&&this.chart&&this.grid&&("Table"===this.currentView?(this.grid.element.style.display="",this.chart.element.style.display="none"):(this.grid.element.style.display="none",this.chart.element.style.display="")),this.toolbarModule&&(this.toolbarModule&&"New"!==this.toolbarModule.action&&"Load"!==this.toolbarModule.action&&"Remove"!==this.toolbarModule.action?this.isModified=!0:this.toolbarModule.action="")},t.prototype.updateDataSource=function(e){ej2Popups.showSpinner(this.element);var t={mode:"",savedFieldList:this.engineModule.fieldList,pageSettings:this.pageSettings,enableValueSorting:this.enableValueSorting,isDrillThrough:this.allowDrillThrough||this.editSettings.allowEditing},i=Object.keys(this.lastSortInfo).length>0,a=Object.keys(this.lastFilterInfo).length>0,r=Object.keys(this.lastAggregationInfo).length>0,o=Object.keys(this.lastCalcFieldInfo).length>0;this.enableVirtualization&&(i||a||r||o)?(i&&(this.setProperties({dataSource:{valueSortSettings:{headerText:""}}},!0),this.engineModule.onSort(this.lastSortInfo),this.lastSortInfo={}),a&&(this.engineModule.onFilter(this.lastFilterInfo,this.dataSource),this.lastFilterInfo={}),r&&(this.engineModule.onAggregation(this.lastAggregationInfo),this.lastAggregationInfo={}),o&&(this.engineModule.onCalcOperation(this.lastCalcFieldInfo),this.lastCalcFieldInfo={})):this.engineModule.renderEngine(this.dataSource,t);var n={dataSource:this.dataSource,pivotValues:this.engineModule.pivotValues};this.trigger("enginePopulated",n),this.pivotCommon.engineModule=this.engineModule,this.pivotCommon.dataSource=this.dataSource,this.setProperties({pivotValues:this.engineModule.pivotValues},!0),this.renderPivotGrid()},t.prototype.destroy=function(){this.removeInternalEvents(),this.showGroupingBar&&this.groupingBarModule&&this.groupingBarModule.destroy(),this.showToolbar&&this.toolbarModule&&this.toolbarModule.destroy(),this.enableVirtualization&&this.virtualscrollModule&&this.virtualscrollModule.destroy(),this.allowConditionalFormatting&&this.conditionalFormattingModule&&this.conditionalFormattingModule.destroy(),this.isAdaptive&&this.contextMenuModule&&this.contextMenuModule.destroy(),this.keyboardModule&&this.keyboardModule.destroy(),this.chart&&this.chart.destroy(),this.unwireEvents(),ej2Base.removeClass([this.element],ROOT),ej2Base.removeClass([this.element],RTL),ej2Base.removeClass([this.element],DEVICE),this.element.innerHTML="",e.prototype.destroy.call(this)},t.prototype.excelExport=function(e,t,i,a){this.enableVirtualization?this.excelExportModule.exportToExcel("Excel"):this.grid.excelExport(e,t,i,a)},t.prototype.csvExport=function(e,t,i,a){this.enableVirtualization?this.excelExportModule.exportToExcel("CSV"):this.grid.csvExport(e,t,i,a)},t.prototype.pdfExport=function(e,t,i,a){this.enableVirtualization?this.pdfExportModule.exportToPDF():this.grid.pdfExport(e,t,i,a)},t.prototype.chartExport=function(e,t,i,a,r){this.chart&&this.chart.enableExport&&this.chart.exportModule.export(e,t,i,null,a,r)},t.prototype.printChart=function(){this.chart&&this.chart.print()},t.prototype.onDrill=function(e){var t=e.parentElement.getAttribute("fieldname"),i=this.engineModule.pivotValues[Number(e.parentElement.getAttribute("index"))][Number(e.parentElement.getAttribute("aria-colindex"))].actualText;this.engineModule.fieldList[t].members[i].isDrilled=!e.classList.contains(COLLAPSE);var a=!1;if(0===this.dataSource.drilledMembers.length)this.setProperties({dataSource:{drilledMembers:[{name:t,items:[i]}]}},!0);else{for(var r=0;r<this.dataSource.drilledMembers.length;r++){var o=this.dataSource.drilledMembers[r];if(o.name===t){a=!0;var n=o.items.indexOf(i);n>-1?o.items.splice(n,1):o.items.push(i)}}a||this.dataSource.drilledMembers.push({name:t,items:[i]})}ej2Popups.showSpinner(this.element);var s={fieldName:t,memberName:i,axis:e.parentElement.classList.contains("e-rowsheader")?"row":"column",action:e.classList.contains(COLLAPSE)?"up":"down"};this.enableVirtualization?this.engineModule.onDrill(s):this.engineModule.generateGridData(this.dataSource),this.setProperties({pivotValues:this.engineModule.pivotValues},!0),this.renderPivotGrid()},t.prototype.onContentReady=function(){if(this.isPopupClicked=!1,this.showFieldList?ej2Popups.hideSpinner(this.pivotFieldListModule.fieldListSpinnerElement):this.fieldListSpinnerElement&&ej2Popups.hideSpinner(this.fieldListSpinnerElement),this.isEmptyGrid?this.isEmptyGrid=!1:(ej2Popups.hideSpinner(this.element),this.trigger("dataBound")),this.grid){if(this.enableVirtualization&&this.engineModule){this.element.querySelector(".e-movablecontent")&&!this.element.querySelector(".e-movablecontent").querySelector(".e-virtualtrack")&&(this.virtualDiv=ej2Base.createElement("div",{className:"e-virtualtrack"}),this.element.querySelector(".e-movablecontent").appendChild(this.virtualDiv)),this.element.querySelector(".e-movableheader")&&!this.element.querySelector(".e-movableheader").querySelector(".e-virtualtrack")?(this.virtualHeaderDiv=ej2Base.createElement("div",{className:"e-virtualtrack"}),this.element.querySelector(".e-movableheader").appendChild(this.virtualHeaderDiv)):this.virtualHeaderDiv=this.element.querySelector(".e-movableheader").querySelector(".e-virtualtrack");var e=this.element.querySelector(".e-movablecontent").querySelector(".e-table"),t=this.gridSettings.rowHeight*this.engineModule.rowCount+.1-e.clientHeight;t>this.scrollerBrowserLimit&&(this.verticalScrollScale=t/this.scrollerBrowserLimit,t=this.scrollerBrowserLimit);var i=this.gridSettings.columnWidth*this.engineModule.columnCount-this.grid.columns[0].width;i>this.scrollerBrowserLimit&&(this.horizontalScrollScale=i/this.scrollerBrowserLimit,i=this.scrollerBrowserLimit),ej2Base.setStyleAttribute(this.virtualDiv,{height:(t>.1?t:.1)+"px",width:(i>.1?i:.1)+"px"}),ej2Base.setStyleAttribute(this.virtualHeaderDiv,{height:0,width:(i>.1?i:.1)+"px"});var a=this.element.querySelector(".e-movablecontent"),r=this.element.querySelector(".e-frozencontent"),o=this.element.querySelector(".e-movableheader"),n=a.scrollTop>this.scrollerBrowserLimit?a.querySelector(".e-table").style.transform.split(",")[1].trim():-(a.scrollTop*this.verticalScrollScale-this.scrollPosObject.verticalSection-a.scrollTop)+"px)",s=a.scrollLeft>this.scrollerBrowserLimit?a.querySelector(".e-table").style.transform.split(",")[0].trim()+",":"translate("+-(a.scrollLeft*this.horizontalScrollScale-this.scrollPosObject.horizontalSection-a.scrollLeft)+"px,";ej2Base.setStyleAttribute(r.querySelector(".e-table"),{transform:"translate(0px,"+n}),ej2Base.setStyleAttribute(a.querySelector(".e-table"),{transform:s+n}),ej2Base.setStyleAttribute(o.querySelector(".e-table"),{transform:s+0+"px)"})}this.showGroupingBar?(this.element.style.minWidth="400px",this.grid.element.style.minWidth="400px"):(this.element.style.minWidth="310px",this.grid.element.style.minWidth="310px"),this.unwireEvents(),this.wireEvents()}this.isChartLoaded=!1},t.prototype.setToolTip=function(e){var t=Number(e.target.getAttribute("aria-colindex")),i=Number(e.target.getAttribute("index")),a=this.pivotValues[i][t];this.tooltip.content="",a?this.tooltip.content="<div class=e-pivottooltip><p class=e-tooltipheader>"+this.localeObj.getConstant("row")+":</p><p class=e-tooltipcontent>"+this.getRowText(i,0)+"</p></br><p class=e-tooltipheader>"+this.localeObj.getConstant("column")+":</p><p class=e-tooltipcontent>"+this.getColText(0,t,i)+"</p></br>"+(""!==a.actualText?"<p class=e-tooltipheader>"+this.engineModule.fieldList[a.actualText].aggregateType+" "+this.localeObj.getConstant("of")+" "+this.engineModule.fieldList[a.actualText].caption+":</p><p class=e-tooltipcontent>"+("0"===a.formattedText||""===a.formattedText?this.localeObj.getConstant("noValue"):a.formattedText)+"</p></div>":""):e.cancel=!0},t.prototype.getRowText=function(e,t){for(var i=this.pivotValues[e][t],a=i.level,r="grand sum"===i.type?this.localeObj.getConstant("grandTotal"):i.formattedText;a>0||void 0===i.index;)e--,void 0!==(i=this.pivotValues[e][t]).index&&a>i.level&&(r=r+" - "+i.formattedText,a-=1);return r.split(" - ").reverse().join(" - ")},t.prototype.getColText=function(e,t,i){for(var a=this.pivotValues[0][t],r=a.axis,o="grand sum"===a.type?this.localeObj.getConstant("grandTotal"):a.formattedText;"value"!==r&&i>e;)e++,this.pivotValues[e]&&(r=(a=this.pivotValues[e][t]).axis,"sum"!==a.type&&"grand sum"!==a.type&&"value"!==r&&(o=o+" - "+a.formattedText));return o},t.prototype.updateClass=function(){this.enableRtl?ej2Base.addClass([this.element],RTL):ej2Base.removeClass([this.element],RTL),this.isAdaptive?ej2Base.addClass([this.element],DEVICE):ej2Base.removeClass([this.element],DEVICE)},t.prototype.wireEvents=function(){"Chart"!==this.displayOption.view&&(ej2Base.EventHandler.add(this.element,this.isAdaptive?"touchend":"click",this.mouseClickHandler,this),ej2Base.EventHandler.add(this.element,"mousedown",this.mouseDownHandler,this),ej2Base.EventHandler.add(this.element.querySelector(".e-gridheader"),"mousemove",this.mouseMoveHandler,this),ej2Base.EventHandler.add(this.element,"mouseup",this.mouseUpHandler,this),ej2Base.EventHandler.add(this.element,this.isAdaptive?"touchend":"contextmenu",this.mouseRclickHandler,this),window.addEventListener("resize",this.onWindowResize.bind(this),!0))},t.prototype.mouseRclickHandler=function(e){3===e.which?this.lastCellClicked=e.target:0===e.which&&(this.lastCellClicked=e.target),this.lastCellClicked=e.target},t.prototype.mouseDownHandler=function(e){if(3===e.which&&(this.lastCellClicked=e.target),this.isCellBoxMultiSelection){this.isMouseDown=!0,this.isMouseUp=!1;var t=this.parentAt(e.target,"TH");this.clearSelection(t,e,Number(t.getAttribute("aria-colindex")),Number(t.getAttribute("index"))),this.lastSelectedElement=void 0}},t.prototype.mouseMoveHandler=function(e){if(this.isCellBoxMultiSelection&&(e.preventDefault(),this.isMouseDown&&e.target)){var t=e.target,i=this.parentAt(t,"TH");this.lastSelectedElement&&this.lastSelectedElement!==i&&i.classList.contains(SELECTED_BGCOLOR)?(this.lastSelectedElement.classList.remove("e-active"),this.lastSelectedElement.classList.remove(SELECTED_BGCOLOR),this.lastSelectedElement=i):(this.lastSelectedElement=i,i.classList.add("e-active"),i.classList.add(SELECTED_BGCOLOR)),this.renderModule.selected()}},t.prototype.mouseUpHandler=function(e){this.isCellBoxMultiSelection&&(this.isMouseDown=!1,this.isMouseUp=!0)},t.prototype.parentAt=function(e,t){for(;e.tagName!==t&&e.parentElement;)e=e.parentElement;return e},t.prototype.mouseClickHandler=function(e){3===e.which?this.lastCellClicked=e.target:0===e.which&&(this.lastCellClicked=e.target);var t=e.target;if((t.classList.contains("e-headercell")||t.classList.contains("e-headercelldiv")||t.classList.contains("e-rowsheader")||t.classList.contains("e-rowcell")||t.classList.contains("e-stackedheadercelldiv")||t.classList.contains("e-headertext")||t.classList.contains("e-ascending")||t.classList.contains("e-descending"))&&this.enableValueSorting){var i=null;if(t.classList.contains("e-headercell")||t.classList.contains("e-rowsheader")||t.classList.contains("e-rowcell")?i=t:t.classList.contains("e-stackedheadercelldiv")||t.classList.contains("e-headercelldiv")||t.classList.contains("e-ascending")||t.classList.contains("e-descending")?i=t.parentElement:t.classList.contains("e-headertext")&&(i=t.parentElement.parentElement),this.CellClicked(t,e),i.parentElement.parentElement.parentElement.parentElement.classList.contains("e-movableheader")&&"column"===this.dataSource.valueAxis||i.parentElement.classList.contains("e-row")&&"row"===this.dataSource.valueAxis&&(i.parentElement.classList.contains("e-rowsheader")||i.classList.contains("e-stot"))){var a=Number(i.getAttribute("aria-colindex")),r=Number(i.getAttribute("index"));if("row"===this.dataSource.valueAxis&&(this.dataSource.values.length>1||this.dataSource.alwaysShowValueHeader)?r="value"===this.pivotValues[r][a].type?r:r+1:"column"===this.dataSource.valueAxis&&(this.dataSource.values.length>1||this.dataSource.alwaysShowValueHeader)&&(a=Number(i.getAttribute("aria-colindex"))+Number(i.getAttribute("aria-colspan"))-1,r=this.engineModule.headerContent.length-1),this.setProperties({dataSource:{valueSortSettings:{columnIndex:Number(i.getAttribute("aria-colindex"))+Number(i.getAttribute("aria-colspan"))-1,sortOrder:"Descending"===this.dataSource.valueSortSettings.sortOrder?"Ascending":"Descending",headerText:this.pivotValues[r][a].valueSort.levelName,headerDelimiter:this.dataSource.valueSortSettings.headerDelimiter?this.dataSource.valueSortSettings.headerDelimiter:"."}}},!0),ej2Popups.showSpinner(this.element),this.engineModule.enableValueSorting=!0,this.enableVirtualization){if(this.dataSource.enableSorting){for(var o=0,n=Object.keys(this.engineModule.fieldList);o<n.length;o++){var s=n[o];this.engineModule.fieldList[s].sort="Ascending"}this.setProperties({dataSource:{sortSettings:[]}},!0)}this.engineModule.rMembers=this.engineModule.headerCollection.rowHeaders,this.engineModule.cMembers=this.engineModule.headerCollection.columnHeaders,this.engineModule.applyValueSorting(),this.engineModule.updateEngine()}else this.engineModule.generateGridData(this.dataSource);this.setProperties({pivotValues:this.engineModule.pivotValues},!0),this.renderPivotGrid()}}else{if(!t.classList.contains(COLLAPSE)&&!t.classList.contains(EXPAND))return void this.CellClicked(t,e);this.onDrill(t)}},t.prototype.framePivotColumns=function(e){for(var t=0,i=e;t<i.length;t++){var a=i[t];if(a.columns&&a.columns.length>0)this.framePivotColumns(a.columns);else{var r="0.formattedText"===a.field?"":a.customAttributes?a.customAttributes.cell.valueSort.levelName:"",o=this.renderModule.setSavedWidth("0.formattedText"===a.field?a.field:r,Number(a.width));this.pivotColumns.push({allowReordering:a.allowReordering,allowResizing:a.allowResizing,headerText:r,width:o}),this.totColWidth=this.totColWidth+Number(o)}}},t.prototype.setGridColumns=function(e){if(this.element.offsetWidth<this.totColWidth){for(var t=0,i=e;t<i.length;t++){var a=i[t];if(a.columns&&a.columns.length>0)this.setGridColumns(a.columns);else{var r="0.formattedText"===a.field?"":a.customAttributes?a.customAttributes.cell.valueSort.levelName:"";a.allowReordering=this.pivotColumns[this.posCount].allowReordering,a.allowResizing=this.pivotColumns[this.posCount].allowResizing,a.width=this.renderModule.setSavedWidth("0.formattedText"===a.field?a.field:r,Number(this.pivotColumns[this.posCount].width)),this.posCount++,a.allowReordering&&(this.gridSettings.allowReordering=!0),a.allowResizing&&(this.gridSettings.allowResizing=!0)}}this.gridSettings.allowReordering&&ej2Grids.Grid.Inject(ej2Grids.Reorder),this.gridSettings.allowResizing&&ej2Grids.Grid.Inject(ej2Grids.Resize)}},t.prototype.triggerColumnRenderEvent=function(e){this.pivotColumns=[],this.totColWidth=0,this.framePivotColumns(e);var t=this.pivotColumns[0].width,i={columns:this.pivotColumns,dataSource:this.dataSource};this.trigger("beforeColumnsRender",i),t!==this.pivotColumns[0].width&&this.element.offsetWidth<this.totColWidth&&(this.firstColWidth=this.pivotColumns[0].width),this.posCount=0,this.setGridColumns(e)},t.prototype.setCommonColumnsWidth=function(e,t){for(var i=0,a=e;i<a.length;i++){var r=a[i];"0.formattedText"!==r.field?r.columns?this.setCommonColumnsWidth(r.columns,t):r.width=t:r.width=t<this.firstColWidth?this.firstColWidth:t}},t.prototype.onWindowResize=function(){clearTimeout(this.timeOutObj),this.timeOutObj=setTimeout(this.windowResize.bind(this),500)},t.prototype.windowResize=function(){if(this.element&&this.element.classList.contains("e-pivotview")&&this.engineModule&&this.engineModule.pivotValues){var e=this.renderModule.resizeColWidth(this.dataSource.values.length>0?this.engineModule.pivotValues[0].length:2);this.grid.width=this.renderModule.calculateGridWidth(),this.setCommonColumnsWidth(this.grid.columns,e),this.posCount=0,this.showGroupingBar||this.setGridColumns(this.grid.columns),this.grid.headerModule.refreshUI(),this.showGroupingBar&&this.groupingBarModule&&this.element.querySelector(".e-grouping-bar")&&this.groupingBarModule.setGridRowWidth()}},t.prototype.CellClicked=function(e,t){var i=null;if(e.classList.contains("e-headercell")||e.classList.contains("e-rowcell")?i=e:e.classList.contains("e-stackedheadercelldiv")||e.classList.contains("e-cellvalue")||e.classList.contains("e-headercelldiv")?i=e.parentElement:e.classList.contains("e-headertext")?i=e.parentElement.parentElement:e.classList.contains("e-rowselect")&&(e.classList.contains("e-spanclicked")?this.isPopupClicked=!1:this.isPopupClicked=!0),i){var a=Number(i.getAttribute("aria-colindex")),r=Number(i.getAttribute("index")),o=Number(i.getAttribute("aria-colspan"));this.cellClick&&this.trigger("cellClick",{currentCell:i,data:this.pivotValues[r][a]}),this.gridSettings.allowSelection&&(("Both"===this.gridSettings.selectionSettings.mode?i.classList.contains("e-rowcell"):"Row"===this.gridSettings.selectionSettings.mode)?this.clearSelection(i,t,a,r):(this.clearSelection(i,t,a,r),this.applyColumnSelection(t,i,a,a+(o>0?o-1:0),r)),"Multiple"!==this.gridSettings.selectionSettings.type||"Row"!==this.gridSettings.selectionSettings.mode&&"Both"!==this.gridSettings.selectionSettings.mode||this.applyRowSelection(0,r))}},t.prototype.clearSelection=function(e,t,i,a){(t.shiftKey||t.ctrlKey)&&"Single"!==this.gridSettings.selectionSettings.type||("Cell"===this.gridSettings.selectionSettings.mode?e.classList.contains("e-columnsheader")?[].slice.call(this.element.querySelectorAll(".e-rowcell.e-cellselectionbackground")).forEach(function(e){e.classList.remove("e-cellselectionbackground")}):[].slice.call(this.element.querySelectorAll(".e-columnsheader.e-active")).forEach(function(e){e.classList.remove("e-active"),e.classList.remove(SELECTED_BGCOLOR)}):"Both"===this.gridSettings.selectionSettings.mode&&(e.classList.contains("e-rowcell")?[].slice.call(this.element.querySelectorAll("."+SELECTED_BGCOLOR)).forEach(function(e){Number(e.getAttribute("index"))!==a&&(e.classList.remove("e-active"),e.classList.remove(SELECTED_BGCOLOR))}):[].slice.call(this.element.querySelectorAll(".e-cellselectionbackground")).forEach(function(e){e.classList.remove("e-cellselectionbackground")})))},t.prototype.applyRowSelection=function(e,t){var i=this.engineModule.pivotValues[t][e];if(i&&i.isDrilled){var a=i.level,r=t;do{r++,i=this.engineModule.pivotValues[r][e]}while(i&&a<i.level);var o=this;this.isAdaptive?this.rowRangeSelection={enable:!0,startIndex:t-o.renderModule.rowStartPos,endIndex:r-(1+o.renderModule.rowStartPos)}:o.grid.selectionModule.selectRowsByRange(t-o.renderModule.rowStartPos,r-(1+o.renderModule.rowStartPos))}},t.prototype.applyColumnSelection=function(e,t,i,a,r){if(!t.classList.contains("e-rowsheader")&&("Cell"!==this.gridSettings.selectionSettings.mode||t.classList.contains("e-columnsheader"))){var o=e.ctrlKey;this.isAdaptive&&"Multiple"===this.gridSettings.selectionSettings.type&&(this.grid.selectionModule.showPopup(e),this.isPopupClicked?(this.element.querySelector(".e-rowselect").classList.add("e-spanclicked"),o=!0):(this.element.querySelector(".e-rowselect").classList.remove("e-spanclicked"),o=!1));for(var n=[],s=this.gridSettings.selectionSettings.type,l=t.classList.contains("e-active"),d=[],p={},h=i;h<=a;h++)d.push(h.toString());o&&"Single"!==s?l=!1:([].slice.call(this.element.querySelectorAll(".e-active")).forEach(function(e){e.classList.remove("e-active"),e.classList.remove(SELECTED_BGCOLOR),-1===d.indexOf(e.getAttribute("aria-colindex"))&&(l=!1);var t=Number(e.getAttribute("aria-colindex"));p[t]=t}),d=Object.keys(p).length>0?Object.keys(p).sort(function(e,t){return e-t}):d),"Multiple"===s&&e.shiftKey?(this.shiftLockedPos=0===this.shiftLockedPos.length?d:this.shiftLockedPos,Number(this.shiftLockedPos[0])<=i?i=Number(this.shiftLockedPos[0]):a=a<Number(this.shiftLockedPos[this.shiftLockedPos.length-1])?Number(this.shiftLockedPos[this.shiftLockedPos.length-1]):a):this.shiftLockedPos=[];var c=[];e.ctrlKey&&"Both"===this.gridSettings.selectionSettings.mode&&"Multiple"===s&&!t.classList.contains("e-rowsheader")&&[].slice.call(this.element.querySelectorAll(".e-rowsheader.e-cellselectionbackground")).forEach(function(e){c.push(e.getAttribute("index"))});for(var u=i;u<=a;)n.push('[aria-colindex="'+u+'"]'+("Cell"===this.gridSettings.selectionSettings.mode?'[index="'+r+'"]':"")),u++;if(!l){r=t.classList.contains("e-headercell")?r:this.renderModule.rowStartPos-1;var g=t.classList.contains("e-active");[].slice.call(this.element.querySelectorAll(n.toString())).forEach(function(e){Number(e.getAttribute("index"))>=r&&(g&&o&&-1===c.indexOf(e.getAttribute("index"))?(e.classList.remove("e-active"),e.classList.remove(SELECTED_BGCOLOR)):(e.classList.add("e-active"),e.classList.add(SELECTED_BGCOLOR)))})}this.renderModule.selected()}},t.prototype.getSelectedCellsPos=function(){var e=this;e.savedSelectedCellsPos=[],[].slice.call(this.element.querySelectorAll("."+SELECTED_BGCOLOR)).forEach(function(t){e.savedSelectedCellsPos.push({rowIndex:t.getAttribute("index"),colIndex:t.getAttribute("aria-colindex")})})},t.prototype.setSavedSelectedCells=function(){var e=this;[].slice.call(this.savedSelectedCellsPos).forEach(function(t){var i='[aria-colindex="'+t.colIndex+'"][index="'+t.rowIndex+'"]';e.element.querySelector(i).classList.add("e-active"),e.element.querySelector(i).classList.add(SELECTED_BGCOLOR)})},t.prototype.unwireEvents=function(){"Chart"!==this.displayOption.view&&(ej2Base.EventHandler.remove(this.element,this.isAdaptive?"touchend":"click",this.mouseClickHandler),ej2Base.EventHandler.remove(this.element,"mousedown",this.mouseDownHandler),this.element.querySelector(".e-gridheader")&&ej2Base.EventHandler.remove(this.element.querySelector(".e-gridheader"),"mousemove",this.mouseMoveHandler),ej2Base.EventHandler.remove(this.element,"mouseup",this.mouseUpHandler),ej2Base.EventHandler.remove(this.element,this.isAdaptive?"touchend":"contextmenu",this.mouseRclickHandler),window.removeEventListener("resize",this.onWindowResize.bind(this),!0))},t.prototype.renderEmptyGrid=function(){this.isEmptyGrid=!0,this.renderModule=new Render(this),this.grid?(this.grid.setProperties({columns:this.renderModule.frameEmptyColumns(),dataSource:this.renderModule.frameEmptyData()},!0),this.grid.notify("datasource-modified",{}),this.grid.refreshColumns()):(this.element.querySelector(".e-grid")&&ej2Base.remove(this.element.querySelector(".e-grid")),this.renderModule.bindGrid(this,!0),this.grid.showSpinner=function(){},this.grid.hideSpinner=function(){},this.element.appendChild(ej2Base.createElement("div",{id:this.element.id+"_grid"})),this.grid.appendTo("#"+this.element.id+"_grid"))},t.prototype.initEngine=function(){if(this.trigger("enginePopulating",{dataSource:this.dataSource}),this.dataSource.groupSettings){var e=this.dataSource.data;this.clonedDataSet=this.clonedDataSet?this.clonedDataSet:PivotUtil.getClonedData(e),this.setProperties({dataSource:{data:[]}},!0),this.clonedReport=this.clonedReport?this.clonedReport:ej2Base.extend({},this.dataSource,null,!0),this.setProperties({dataSource:{data:e}},!0)}var t={mode:"",savedFieldList:void 0,pageSettings:this.pageSettings,enableValueSorting:this.enableValueSorting,isDrillThrough:this.allowDrillThrough||this.editSettings.allowEditing,localeObj:this.localeObj};this.engineModule.renderEngine(this.dataSource,t),this.setProperties({pivotValues:this.engineModule.pivotValues},!0),this.trigger("enginePopulated",{pivotValues:this.pivotValues}),this.notify(dataReady,{}),this.isEmptyGrid=!1},t.prototype.generateData=function(){"Chart"!==this.displayOption.view&&this.renderEmptyGrid(),ej2Popups.showSpinner(this.element),this.dataSource&&this.dataSource.data?this.dataSource.data instanceof ej2Data.DataManager?setTimeout(this.getData.bind(this),100):this.dataSource.data.length>0?this.initEngine():ej2Popups.hideSpinner(this.element):ej2Popups.hideSpinner(this.element)},t.prototype.getData=function(){this.dataSource.data.executeQuery(new ej2Data.Query).then(this.executeQuery.bind(this))},t.prototype.executeQuery=function(e){this.element.querySelector(".e-spinner-pane")||ej2Popups.showSpinner(this.element),this.setProperties({dataSource:{data:e.result}},!0),this.initEngine()},t.prototype.applyFormatting=function(){if(this.pivotValues){for(var e=[],t=this.pivotValues.length,i=0;i<t;i++)void 0!==this.pivotValues[i]&&void 0===this.pivotValues[i][0]&&e.push(i);for(i=0;i<this.pivotValues.length;i++)for(var a=1;this.pivotValues[i]&&a<this.pivotValues[i].length;a++)if("value"===this.pivotValues[i][a].axis){this.pivotValues[i][a].style=void 0,this.pivotValues[i][a].cssClass=void 0;for(var r=this.dataSource.conditionalFormatSettings,o=0;o<r.length;o++)if(this.checkCondition(this.pivotValues[i][a].value,r[o].conditions,r[o].value1,r[o].value2)){var n="row"===this.dataSource.valueAxis?i:this.engineModule.headerContent.length-1,s="row"===this.dataSource.valueAxis?0:a;(!r[o].measure||1===this.dataSource.values.length||this.pivotValues[n][s].valueSort&&this.pivotValues[n][s].valueSort.levelName.indexOf(r[o].measure)>-1)&&(!r[o].label||this.pivotValues[e[r[o].label.split(".").length-1]]&&this.pivotValues[e[r[o].label.split(".").length-1]][a]&&this.pivotValues[e[r[o].label.split(".").length-1]][a].valueSort&&this.pivotValues[e[r[o].label.split(".").length-1]][a].valueSort[r[o].label]||this.pivotValues[i][0].valueSort.levelName.indexOf(r[o].label)>-1)&&(r[o].style&&r[o].style.backgroundColor&&(r[o].style.backgroundColor=this.conditionalFormattingModule.isHex(r[o].style.backgroundColor.substr(1))?r[o].style.backgroundColor:this.conditionalFormattingModule.colourNameToHex(r[o].style.backgroundColor)),r[o].style&&r[o].style.color&&(r[o].style.color=this.conditionalFormattingModule.isHex(r[o].style.color.substr(1))?r[o].style.color:this.conditionalFormattingModule.colourNameToHex(r[o].style.color)),this.pivotValues[i][a].style=r[o].style,this.pivotValues[i][a].cssClass="format"+this.element.id+o)}}for(var l=this.dataSource.conditionalFormatSettings,o=0;o<l.length;o++){var d=this.createStyleSheet.bind(this)(),p="color: "+l[o].style.color+"!important;background-color: "+l[o].style.backgroundColor+"!important;font-size: "+l[o].style.fontSize+"!important;font-family: "+l[o].style.fontFamily+" !important;";d.insertRule(".format"+this.element.id+o+"{"+p+"}",0)}}},t.prototype.createStyleSheet=function(){var e=document.createElement("style");return e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet},t.prototype.applyHyperlinkSettings=function(){if(this.pivotValues){for(var e=this.pivotValues,t=[],i=e.length,a=0;a<i;a++)void 0!==e[a]&&void 0===e[a][0]&&t.push(a);if(this.hyperlinkSettings.conditionalSettings.length>0)for(a=0;a<e.length;a++)for(l=1;e[a]&&l<e[a].length;l++)if("value"===e[a][l].axis){e[a][l].enableHyperlink=!1;for(var r=this.hyperlinkSettings.conditionalSettings,o=0;o<r.length;o++)if(this.checkCondition(e[a][l].value,r[o].conditions,r[o].value1,r[o].value2)){var n="row"===this.dataSource.valueAxis?a:this.engineModule.headerContent.length-1,s="row"===this.dataSource.valueAxis?0:l;(!r[o].measure||1===this.dataSource.values.length||e[n][s].valueSort&&e[n][s].valueSort.levelName.indexOf(r[o].measure)>-1)&&(!r[o].label||e[t[r[o].label.split(".").length-1]]&&e[t[r[o].label.split(".").length-1]][l]&&e[t[r[o].label.split(".").length-1]][l].valueSort&&e[t[r[o].label.split(".").length-1]][l].valueSort[r[o].label]||e[a][0].valueSort.levelName.indexOf(r[o].label)>-1)&&(e[a][l].enableHyperlink=!0)}}if(ej2Base.isNullOrUndefined(this.hyperlinkSettings.headerText))return;for(a=0;a<e.length;a++)for(var l=1;e[a]&&l<e[a].length;l++)if("value"===e[a][l].axis){var d=this.hyperlinkSettings.headerText,n="row"===this.dataSource.valueAxis?a:this.engineModule.headerContent.length-1,s="row"===this.dataSource.valueAxis?0:l;if(e[t[d.split(".").length-1]]&&e[t[d.split(".").length-1]][l]&&e[t[d.split(".").length-1]][l].valueSort&&e[t[d.split(".").length-1]][l].valueSort[d]){for(var p=0,h=t;p<h.length;p++){var c=h[p];e[c][l]&&"column"===e[c][l].axis&&e[c][l].valueSort.levelName.indexOf(d)>-1&&(e[c][l].enableHyperlink=!0)}e[a][l].enableHyperlink=!0}else e[a][0].valueSort.levelName.indexOf(d)>-1&&(e[a][0].enableHyperlink=!0,e[a][l].enableHyperlink=!0)}}},t.prototype.checkCondition=function(e,t,i,a){switch(t){case"LessThan":return e<i;case"LessThanOrEqualTo":return e<=i;case"GreaterThan":return e>i;case"GreaterThanOrEqualTo":return e>=i;case"Equals":return e===i;case"NotEquals":return e!==i;case"Between":return i<a&&e>=i&&e<=a||i>a&&e<=i&&e>=a;case"NotBetween":return!(i<a&&e>=i&&e<=a||i>a&&e<=i&&e>=a);default:return!1}};var i;return __decorate([ej2Base.Property("USD")],t.prototype,"currencyCode",void 0),__decorate([ej2Base.Property(!1)],t.prototype,"showFieldList",void 0),__decorate([ej2Base.Complex({},GridSettings)],t.prototype,"gridSettings",void 0),__decorate([ej2Base.Complex({},ChartSettings)],t.prototype,"chartSettings",void 0),__decorate([ej2Base.Complex({},GroupingBarSettings)],t.prototype,"groupingBarSettings",void 0),__decorate([ej2Base.Complex({},HyperlinkSettings)],t.prototype,"hyperlinkSettings",void 0),__decorate([ej2Base.Complex({},DataSource)],t.prototype,"dataSource",void 0),__decorate([ej2Base.Complex({},CellEditSettings)],t.prototype,"editSettings",void 0),__decorate([ej2Base.Complex({},DisplayOption)],t.prototype,"displayOption",void 0),__decorate([ej2Base.Property()],t.prototype,"pivotValues",void 0),__decorate([ej2Base.Property(!1)],t.prototype,"showGroupingBar",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"showTooltip",void 0),__decorate([ej2Base.Property(!1)],t.prototype,"showToolbar",void 0),__decorate([ej2Base.Property([])],t.prototype,"toolbar",void 0),__decorate([ej2Base.Property(!1)],t.prototype,"showValuesButton",void 0),__decorate([ej2Base.Property(!1)],t.prototype,"allowCalculatedField",void 0),__decorate([ej2Base.Property(!1)],t.prototype,"enableValueSorting",void 0),__decorate([ej2Base.Property(!1)],t.prototype,"allowConditionalFormatting",void 0),__decorate([ej2Base.Property("auto")],t.prototype,"height",void 0),__decorate([ej2Base.Property("auto")],t.prototype,"width",void 0),__decorate([ej2Base.Property(!1)],t.prototype,"allowExcelExport",void 0),__decorate([ej2Base.Property(!1)],t.prototype,"enableVirtualization",void 0),__decorate([ej2Base.Property(!1)],t.prototype,"allowDrillThrough",void 0),__decorate([ej2Base.Property(!1)],t.prototype,"allowPdfExport",void 0),__decorate([ej2Base.Property(!1)],t.prototype,"allowDeferLayoutUpdate",void 0),__decorate([ej2Base.Property(1e3)],t.prototype,"maxNodeLimitInMemberEditor",void 0),__decorate([ej2Base.Property()],t.prototype,"cellTemplate",void 0),__decorate([ej2Base.Event()],t.prototype,"queryCellInfo",void 0),__decorate([ej2Base.Event()],t.prototype,"headerCellInfo",void 0),__decorate([ej2Base.Event()],t.prototype,"resizing",void 0),__decorate([ej2Base.Event()],t.prototype,"resizeStop",void 0),__decorate([ej2Base.Event()],t.prototype,"pdfHeaderQueryCellInfo",void 0),__decorate([ej2Base.Event()],t.prototype,"pdfQueryCellInfo",void 0),__decorate([ej2Base.Event()],t.prototype,"excelHeaderQueryCellInfo",void 0),__decorate([ej2Base.Event()],t.prototype,"excelQueryCellInfo",void 0),__decorate([ej2Base.Event()],t.prototype,"columnDragStart",void 0),__decorate([ej2Base.Event()],t.prototype,"columnDrag",void 0),__decorate([ej2Base.Event()],t.prototype,"columnDrop",void 0),__decorate([ej2Base.Event()],t.prototype,"beforeColumnsRender",void 0),__decorate([ej2Base.Event()],t.prototype,"selected",void 0),__decorate([ej2Base.Event()],t.prototype,"cellDeselected",void 0),__decorate([ej2Base.Event()],t.prototype,"rowSelected",void 0),__decorate([ej2Base.Event()],t.prototype,"rowDeselected",void 0),__decorate([ej2Base.Event()],t.prototype,"chartTooltipRender",void 0),__decorate([ej2Base.Event()],t.prototype,"chartLoaded",void 0),__decorate([ej2Base.Event()],t.prototype,"chartLoad",void 0),__decorate([ej2Base.Event()],t.prototype,"chartResized",void 0),__decorate([ej2Base.Event()],t.prototype,"chartAxisLabelRender",void 0),__decorate([ej2Base.Event()],t.prototype,"contextMenuClick",void 0),__decorate([ej2Base.Event()],t.prototype,"contextMenuOpen",void 0),__decorate([ej2Base.Event()],t.prototype,"onPdfCellRender",void 0),__decorate([ej2Base.Event()],t.prototype,"saveReport",void 0),__decorate([ej2Base.Event()],t.prototype,"fetchReport",void 0),__decorate([ej2Base.Event()],t.prototype,"loadReport",void 0),__decorate([ej2Base.Event()],t.prototype,"renameReport",void 0),__decorate([ej2Base.Event()],t.prototype,"removeReport",void 0),__decorate([ej2Base.Event()],t.prototype,"newReport",void 0),__decorate([ej2Base.Event()],t.prototype,"toolbarRender",void 0),__decorate([ej2Base.Event()],t.prototype,"toolbarClick",void 0),__decorate([ej2Base.Event()],t.prototype,"load",void 0),__decorate([ej2Base.Event()],t.prototype,"enginePopulating",void 0),__decorate([ej2Base.Event()],t.prototype,"enginePopulated",void 0),__decorate([ej2Base.Event()],t.prototype,"onFieldDropped",void 0),__decorate([ej2Base.Event()],t.prototype,"dataBound",void 0),__decorate([ej2Base.Event()],t.prototype,"created",void 0),__decorate([ej2Base.Event()],t.prototype,"destroyed",void 0),__decorate([ej2Base.Event()],t.prototype,"beforeExport",void 0),__decorate([ej2Base.Event()],t.prototype,"cellClick",void 0),__decorate([ej2Base.Event()],t.prototype,"drillThrough",void 0),__decorate([ej2Base.Event()],t.prototype,"beginDrillThrough",void 0),__decorate([ej2Base.Event()],t.prototype,"hyperlinkCellClick",void 0),__decorate([ej2Base.Event()],t.prototype,"cellSelected",void 0),__decorate([ej2Base.Event()],t.prototype,"chartSeriesCreated",void 0),t=i=__decorate([ej2Base.NotifyPropertyChanges],t)}(ej2Base.Component),CommonKeyboardInteraction=function(){function e(e){this.keyConfigs={shiftF:"shift+F",shiftS:"shift+S",delete:"delete",enter:"enter"},this.parent=e,this.parent.element.tabIndex=-1===this.parent.element.tabIndex?0:this.parent.element.tabIndex,this.keyboardModule=new ej2Base.KeyboardEvents(this.parent.element,{keyAction:this.keyActionHandler.bind(this),keyConfigs:this.keyConfigs,eventName:"keydown"})}return e.prototype.keyActionHandler=function(e){switch(e.action){case"shiftF":this.processFilter(e);break;case"shiftS":this.processSort(e);break;case"delete":this.processDelete(e);break;case"enter":this.processOpenContextMenu(e)}},e.prototype.processOpenContextMenu=function(e){var t=e.target;if(t&&ej2Base.closest(t,".e-pivot-button")&&ej2Base.closest(t,".e-values"))return t.querySelector(".e-dropdown-icon").click(),void e.preventDefault()},e.prototype.processSort=function(e){var t=e.target;if(t&&ej2Base.closest(t,".e-pivot-button")&&!ej2Base.closest(t,".e-values")&&!ej2Base.closest(t,".e-axis-filter"))return t.querySelector(".e-sort").click(),void e.preventDefault()},e.prototype.processFilter=function(e){var t=e.target;if(t&&ej2Base.closest(t,".e-pivot-button")&&!ej2Base.closest(t,".e-values"))return t.querySelector(".e-btn-filter").click(),void e.preventDefault()},e.prototype.processDelete=function(e){var t=e.target;if(t&&ej2Base.closest(t,".e-pivot-button"))return t.querySelector(".e-remove").click(),void e.preventDefault()},e.prototype.destroy=function(){this.keyboardModule&&this.keyboardModule.destroy()},e}(),EventBase=function(){function e(e){this.parent=e}return e.prototype.updateSorting=function(e){this.parent.filterDialog.dialogPopUp&&this.parent.filterDialog.dialogPopUp.close();var t=e.target,i=t.parentElement.id,a=t.classList.contains("e-descend"),r=this.getSortItemByName(i);if(ej2Base.isNullOrUndefined(r)){n={name:i,order:a?"Ascending":"Descending"};this.parent.dataSource.sortSettings.push(n)}else{for(var o=0;o<this.parent.dataSource.sortSettings.length;o++)if(this.parent.dataSource.sortSettings[o].name===i){this.parent.dataSource.sortSettings.splice(o,1);break}var n={name:i,order:a?"Ascending":"Descending"};this.parent.dataSource.sortSettings.push(n)}this.parent.control.lastSortInfo=this.parent.dataSource.sortSettings[this.parent.dataSource.sortSettings.length-1],a?ej2Base.removeClass([t],"e-descend"):ej2Base.addClass([t],"e-descend")},e.prototype.updateFiltering=function(e){var t=e.target,i=t.parentElement.id,a=t.parentElement.textContent,r=!1,o=[];this.parent.engineModule.fieldList[i].dateMember="Ascending"===this.parent.engineModule.fieldList[i].sort?this.parent.engineModule.fieldList[i].dateMember.sort(function(e,t){return e.actualText>t.actualText?1:t.actualText>e.actualText?-1:0}):"Descending"===this.parent.engineModule.fieldList[i].sort?this.parent.engineModule.fieldList[i].dateMember.sort(function(e,t){return e.actualText<t.actualText?1:t.actualText<e.actualText?-1:0}):this.parent.engineModule.fieldList[i].dateMember;var n=this.getFilterItemByName(i);ej2Base.isNullOrUndefined(n)||(r="Include"===n.type,o=n.items?n.items:[]);var s=this.getTreeData(r,this.parent.engineModule.fieldList[i].dateMember,o,i);this.parent.filterDialog.dialogPopUp&&this.parent.filterDialog.dialogPopUp.close();var l;l=l="pivotfieldlist"!==this.parent.moduleName?this.parent.element:document.getElementById(this.parent.parentID+"_Wrapper"),this.parent.filterDialog.createFilterDialog(s,i,a,l)},e.prototype.getSortItemByName=function(e){var t=this.parent.dataSource.sortSettings;return new ej2Data.DataManager({json:t}).executeLocal((new ej2Data.Query).where("name","equal",e))[0]},e.prototype.getFilterItemByName=function(e){var t=this.parent.dataSource.filterSettings;return new ej2Data.DataManager({json:t}).executeLocal((new ej2Data.Query).where("name","equal",e))[0]},e.prototype.getFieldByName=function(e,t){return new ej2Data.DataManager({json:t}).executeLocal((new ej2Data.Query).where("name","equal",e))[0]},e.prototype.getFormatItemByName=function(e){var t=this.parent.dataSource.formatSettings;return new ej2Data.DataManager({json:t}).executeLocal((new ej2Data.Query).where("name","equal",e))[0]},e.prototype.searchTreeNodes=function(e,t,i){if(i){for(var a=[],r=[],o=0,n=[].slice.call(t.element.querySelectorAll("li"));o<n.length;o++){var s=n[o];s.querySelector(".e-list-text").textContent.toLowerCase().indexOf(e.value.toLowerCase())>-1?a.push(s):r.push(s)}t.enableNodes(a),t.disableNodes(r)}else{a=[];this.parent.searchTreeItems=[];var l=0;l=1;for(var d=0,p=this.parent.currentTreeItems;d<p.length;d++){var h=p[d];h.name.toLowerCase().indexOf(e.value.toLowerCase())>-1&&(this.parent.searchTreeItems.push(h),l<=this.parent.control.maxNodeLimitInMemberEditor&&a.push(h),l++)}--l>this.parent.control.maxNodeLimitInMemberEditor?(this.parent.editorLabelElement.innerText=l-this.parent.control.maxNodeLimitInMemberEditor+this.parent.control.localeObj.getConstant("editorDataLimitMsg"),this.parent.filterDialog.dialogPopUp.height=this.parent.filterDialog.allowExcelLikeFilter?"440px":"400px",this.parent.isDataOverflow=!0):(this.parent.editorLabelElement.innerText="",this.parent.filterDialog.dialogPopUp.height=this.parent.filterDialog.allowExcelLikeFilter?"400px":"350px",this.parent.isDataOverflow=!1),this.parent.isDataOverflow=l>this.parent.control.maxNodeLimitInMemberEditor,this.parent.editorLabelElement.parentElement.style.display=this.parent.isDataOverflow?"inline-block":"none",t.fields={dataSource:a,id:"id",text:"name",isChecked:"checkedStatus"},t.dataBind()}},e.prototype.getTreeData=function(e,t,i,a){this.parent.currentTreeItems=[],this.parent.searchTreeItems=[],this.parent.currentTreeItemsPos={},this.parent.savedTreeFilterPos={},this.parent.isDateField=this.parent.engineModule.formatFields[a]&&["date","dateTime","time"].indexOf(this.parent.engineModule.formatFields[a].type)>-1;for(var r=[],o=1,n={},s=0,l=i;s<l.length;s++){var d=l[s];n[d]=d}for(var p=0,h=t;p<h.length;p++){var c=h[p],u=this.parent.isDateField?c.formattedText:c.actualText.toString(),g={id:c.actualText.toString(),name:u,checkedStatus:!e};void 0!==n[u]&&(g.checkedStatus=!!e),o<=this.parent.control.maxNodeLimitInMemberEditor&&r.push(g),g.checkedStatus||(this.parent.savedTreeFilterPos[o-1]=u),this.parent.currentTreeItems.push(g),this.parent.searchTreeItems.push(g),this.parent.currentTreeItemsPos[c.actualText]=o-1,o++}return this.parent.isDataOverflow=o-1>this.parent.control.maxNodeLimitInMemberEditor,r},e}(),NodeStateModified=function(){function e(e){this.parent=e}return e.prototype.onStateModified=function(e,t){var i="",a=!0,r=ej2Base.closest(e.target,".e-droppable"),o=-1;if(this.parent.dataSourceUpdate.btnElement=e.element?e.element.parentElement:void 0,r&&(i="e-rows"===r.classList[1]?"rows":"e-columns"===r.classList[1]?"columns":"e-values"===r.classList[1]?"values":"e-filters"===r.classList[1]?"filters":""),e.cancel&&""===i||this.parent.dataSourceUpdate.btnElement&&"true"===this.parent.dataSourceUpdate.btnElement.getAttribute("isValue")&&("filters"===i||"values"===i||i.indexOf(this.parent.dataSource.valueAxis)>-1))return a=!1;if(""!==i){if(this.parent.engineModule.fieldList[t]&&"CalculatedField"===this.parent.engineModule.fieldList[t].aggregateType&&"values"!==i){var n=this.parent.localeObj.getConstant("warning"),s=this.parent.localeObj.getConstant("dropAction");return this.parent.errorDialog.createErrorDialog(n,s),a=!1}o=this.getButtonPosition(e.target,i)}else this.parent.engineModule.fieldList[t]&&(this.parent.engineModule.fieldList[t].isSelected=!1);return this.parent.dataSourceUpdate.updateDataSource(t,i,o),a},e.prototype.getButtonPosition=function(e,t){var i=-1,a=ej2Base.closest(e,".e-pvt-btn-div");if(!ej2Base.isNullOrUndefined(a)){a=a.querySelector(".e-pivot-button");for(var r=this.parent.element.querySelector(".e-"+t),o=[].slice.call(r.querySelectorAll(".e-pivot-button")),n=0,s=o.length;n<s;n++)if(o[n].id===a.id){i=n;break}}return i},e}(),DataSourceUpdate=function(){function e(e){this.parent=e}return e.prototype.updateDataSource=function(e,t,i){var a;if(this.control&&this.btnElement&&"true"===this.btnElement.getAttribute("isvalue"))switch(t){case"":this.control.setProperties({dataSource:{values:[]}},!0);break;case"rows":this.control.setProperties({dataSource:{valueAxis:"row"}},!0);break;case"columns":this.control.setProperties({dataSource:{valueAxis:"column"}},!0)}else"CalculatedField"===(a=(a=this.removeFieldFromReport(e.toString()))||this.getNewField(e.toString())).type&&""!==t&&(t="values");if(this.control){var r={droppedField:a,dataSource:this.parent.dataSource,droppedAxis:t};this.control.trigger("onFieldDropped",r)}if(a)switch(t){case"filters":-1!==i?this.parent.dataSource.filters.splice(i,0,a):this.parent.dataSource.filters.push(a);break;case"rows":-1!==i?this.parent.dataSource.rows.splice(i,0,a):this.parent.dataSource.rows.push(a);break;case"columns":-1!==i?this.parent.dataSource.columns.splice(i,0,a):this.parent.dataSource.columns.push(a);break;case"values":-1!==i?this.parent.dataSource.values.splice(i,0,a):this.parent.dataSource.values.push(a)}},e.prototype.removeFieldFromReport=function(e){for(var t,i=!1,a=[this.parent.dataSource.rows,this.parent.dataSource.columns,this.parent.dataSource.values,this.parent.dataSource.filters],r=this.parent.engineModule.fieldList[e],o=0,n=a.length;o<n;o++)if(!i&&a[o])for(var s=0,l=a[o].length;s<l;s++)if(a[o][s].name===e){(t=a[o][s].properties?a[o][s].properties:a[o][s]).type="number"===r.type?t.type:"Count",a[o].splice(s,1),i=!0;break}return t},e.prototype.getNewField=function(e){var t=this.parent.engineModule.fieldList[e];return{name:e,caption:t.caption,type:void 0===t.aggregateType?"number"===t.type?"Sum":"Count":t.aggregateType,showNoDataItems:t.showNoDataItems,baseField:t.baseField,baseItem:t.baseItem}},e}(),ErrorDialog=function(){function e(e){this.parent=e}return e.prototype.createErrorDialog=function(e,t){var i=ej2Base.createElement("div",{id:this.parent.parentID+"_ErrorDialog",className:"e-pivot-error-dialog"});this.parent.element.appendChild(i),this.errorPopUp=new ej2Popups.Dialog({animationSettings:{effect:"Fade"},allowDragging:!1,header:e,content:t,isModal:!0,visible:!0,showCloseIcon:!0,enableRtl:this.parent.enableRtl,width:"auto",height:"auto",zIndex:1000001,position:{X:"center",Y:"center"},buttons:[{click:this.closeErrorDialog.bind(this),buttonModel:{cssClass:"e-ok-btn",content:this.parent.localeObj.getConstant("ok"),isPrimary:!0}}],closeOnEscape:!0,target:document.body,close:this.removeErrorDialog.bind(this)}),this.errorPopUp.appendTo(i)},e.prototype.closeErrorDialog=function(){this.errorPopUp.close()},e.prototype.removeErrorDialog=function(){this.errorPopUp&&!this.errorPopUp.isDestroyed&&this.errorPopUp.destroy(),document.getElementById(this.parent.parentID+"_ErrorDialog")&&ej2Base.remove(document.getElementById(this.parent.parentID+"_ErrorDialog"))},e}(),FilterDialog=function(){function e(e){this.parent=e}return e.prototype.createFilterDialog=function(e,t,i,a){var r=ej2Base.createElement("div",{id:this.parent.parentID+"_EditorTreeView",className:"e-member-editor-dialog",attrs:{"data-fieldName":t,"aria-label":i},styles:"visibility:hidden;"}),o=this.parent.engineModule.fieldList[t].caption,n=this.parent.localeObj.getConstant("filter")+' "'+i+'" '+this.parent.localeObj.getConstant("by");this.filterObject=this.getFilterObject(t),this.allowExcelLikeFilter=this.isExcelFilter(t),this.parent.element.appendChild(r),this.dialogPopUp=new ej2Popups.Dialog({animationSettings:{effect:this.allowExcelLikeFilter?"None":"Fade"},allowDragging:!1,header:this.allowExcelLikeFilter?n:o,content:this.allowExcelLikeFilter?"":this.createTreeView(e,i,t),isModal:"Popup"===this.parent.renderMode||!!this.parent.isAdaptive,visible:!0,showCloseIcon:!!this.allowExcelLikeFilter,enableRtl:this.parent.enableRtl,width:"auto",height:this.parent.isDataOverflow?this.allowExcelLikeFilter?"440px":"400px":this.allowExcelLikeFilter?"400px":"350px",position:{X:"center",Y:"center"},buttons:[{buttonModel:{cssClass:"e-ok-btn",content:this.parent.localeObj.getConstant("ok"),isPrimary:!0}},{buttonModel:{cssClass:"e-clear-filter-button"+(this.allowExcelLikeFilter?"":" e-disable"),iconCss:"e-icons e-clear-filter-icon",enableRtl:this.parent.enableRtl,content:this.parent.localeObj.getConstant("clearFilter"),disabled:!this.filterObject}},{click:this.closeFilterDialog.bind(this),buttonModel:{cssClass:"e-cancel-btn",content:this.parent.localeObj.getConstant("cancel")}}],closeOnEscape:!0,target:a,close:this.removeFilterDialog.bind(this),open:this.dialogOpen.bind(this)}),this.dialogPopUp.appendTo(r),this.allowExcelLikeFilter?(this.createTabMenu(e,i,t),ej2Base.addClass([this.dialogPopUp.element],"e-excel-filter"),this.updateCheckedState(i)):this.updateCheckedState(i),ej2Base.setStyleAttribute(this.dialogPopUp.element,{visibility:"visible"}),this.allowExcelLikeFilter&&this.dialogPopUp.element.querySelector(".e-dlg-closeicon-btn").focus()},e.prototype.dialogOpen=function(e){e.element.querySelector(".e-editor-label-wrapper")&&(e.element.querySelector(".e-editor-label-wrapper").style.width=e.element.offsetWidth+"px")},e.prototype.createTreeView=function(e,t,i){var a=this,r=ej2Base.createElement("div",{id:this.parent.parentID+"EditorDiv",className:"e-member-editor-wrapper"+(this.allowExcelLikeFilter?" e-excelfilter":"")}),o=ej2Base.createElement("div",{id:this.parent.parentID+"_SearchDiv",attrs:{tabindex:"-1"},className:"e-editor-search-wrapper"}),n=this.parent.engineModule.fieldList[i].caption,s=ej2Base.createElement("input",{attrs:{type:"text"}}),l=ej2Base.createElement("div",{id:this.parent.parentID+"_LabelDiv",attrs:{tabindex:"-1"},className:"e-editor-label-wrapper"});this.parent.editorLabelElement=ej2Base.createElement("label",{className:"e-editor-label"}),this.parent.editorLabelElement.innerText=this.parent.isDataOverflow?this.parent.currentTreeItems.length-this.parent.control.maxNodeLimitInMemberEditor+this.parent.control.localeObj.getConstant("editorDataLimitMsg"):"",l.style.display=this.parent.isDataOverflow?"inline-block":"none",l.appendChild(this.parent.editorLabelElement),o.appendChild(s);var d=ej2Base.createElement("div",{id:this.parent.parentID+"_AllDiv",attrs:{tabindex:"-1"},className:"e-select-all-wrapper"}),p=ej2Base.createElement("div",{className:"e-select-all"}),h=ej2Base.createElement("div",{className:"e-member-editor-container"}),c=ej2Base.createElement("div",{className:"e-member-prompt e-disable",innerHTML:this.parent.localeObj.getConstant("noMatches")});d.appendChild(p),r.appendChild(o),r.appendChild(d),r.appendChild(c),this.editorSearch=new ej2Inputs.MaskedTextBox({placeholder:this.parent.localeObj.getConstant("search")+' "'+n+'"',enableRtl:this.parent.enableRtl,cssClass:"e-editor-search",showClearButton:!0,change:function(e){a.parent.eventBase.searchTreeNodes(e,a.memberTreeView,!1);var i=a.dialogPopUp.element;0===[].slice.call(a.memberTreeView.element.querySelectorAll("li")).length?(a.allMemberSelect.disableNodes([a.allMemberSelect.element.querySelector("li")]),i.querySelector(".e-ok-btn").setAttribute("disabled","disabled"),ej2Base.removeClass([c],"e-disable")):(a.allMemberSelect.enableNodes([a.allMemberSelect.element.querySelector("li")]),i.querySelector(".e-ok-btn").removeAttribute("disabled"),ej2Base.addClass([c],"e-disable")),a.updateCheckedState(t)}}),this.editorSearch.appendTo(s);var u=[{id:"all",name:"All",checkedStatus:!0}];return this.allMemberSelect=new ej2Navigations.TreeView({fields:{dataSource:u,id:"id",text:"name",isChecked:"checkedStatus"},showCheckBox:!0,enableRtl:this.parent.enableRtl}),this.allMemberSelect.appendTo(p),r.appendChild(h),this.memberTreeView=new ej2Navigations.TreeView({fields:{dataSource:e,id:"id",text:"name",isChecked:"checkedStatus"},showCheckBox:!0,enableRtl:this.parent.enableRtl,nodeChecking:this.validateTreeNode.bind(this)}),this.memberTreeView.appendTo(h),r.appendChild(l),r},e.prototype.createTabMenu=function(e,t,i){var a=ej2Base.createElement("div",{className:"e-filter-tab-wrapper"});this.dialogPopUp.content=a,this.dialogPopUp.dataBind();for(var r=["Label","Value","Include","Exclude"],o="((-|\\+)?[0-9]+(\\.[0-9]+)?)+",n=Object.keys(this.parent.engineModule.fieldList[i].members)[0],s=this.parent.engineModule.fieldList[i].type,l=this.parent.eventBase.getFormatItemByName(i),d=[{header:{text:this.parent.localeObj.getConstant("member"),iconCss:this.filterObject&&r.indexOf(this.filterObject.type)>1?"e-selected-option-icon":""},content:this.createTreeView(e,t,i)}],p=0,h=r;p<h.length;p++){var c=h[p];if("Label"===c&&this.parent.dataSource.allowLabelFilter||"Value"===c&&this.parent.dataSource.allowValueFilter){var u="Label"===c&&n.match(o)&&n.match(o)[0].length===n.length&&"number"===s?"Number":"Label"===c&&"Invalid Date"!==new Date(n).toString()&&(l&&l.type||this.filterObject&&"Date"===this.filterObject.type)?"Date":c,g={header:{text:"Number"===u?this.parent.localeObj.getConstant("label"):this.parent.localeObj.getConstant(u.toLowerCase()),iconCss:this.filterObject&&this.filterObject.type===u?"e-selected-option-icon":""},content:this.createCustomFilter(i,this.filterObject&&this.filterObject.type===u?this.filterObject:void 0,u.toLowerCase())};d.push(g)}}var m=this.filterObject?["Label","Date","Number"].indexOf(this.filterObject.type)>=0?1:"Value"===this.filterObject.type?this.parent.dataSource.allowLabelFilter&&this.parent.dataSource.allowValueFilter?2:1:0:0;this.tabObj=new ej2Navigations.Tab({heightAdjustMode:"Auto",items:d,height:"100%",selectedItem:m,enableRtl:this.parent.enableRtl}),this.tabObj.appendTo(a),m>0&&ej2Base.addClass([this.dialogPopUp.element.querySelector(".e-filter-div-content."+(1===m&&this.parent.dataSource.allowLabelFilter?"e-label-filter":"e-value-filter"))],"e-selected-tab")},e.prototype.createCustomFilter=function(e,t,i){for(var a=[],r=[],o=this.parent.dataSource.values,n="DoesNotEquals",s=0,l={label:["Equals","DoesNotEquals","BeginWith","DoesNotBeginWith","EndsWith","DoesNotEndsWith","Contains","DoesNotContains","GreaterThan","GreaterThanOrEqualTo","LessThan","LessThanOrEqualTo","Between","NotBetween"],date:["Equals","DoesNotEquals","Before","BeforeOrEqualTo","After","AfterOrEqualTo","Between","NotBetween"],value:["Equals","DoesNotEquals","GreaterThan","GreaterThanOrEqualTo","LessThan","LessThanOrEqualTo","Between","NotBetween"]},d=["Between","NotBetween"],p="label"===i?l.label:"date"===i?l.date:l.value,h=0,c=p;h<c.length;h++){var u=c[h];n=t&&u===t.condition?p.indexOf(t.condition)>=0?t.condition:p[0]:n,a.push({value:u,text:this.parent.localeObj.getConstant(u)})}for(var g=o.length;g--;)r.unshift({value:o[g].name,text:o[g].caption?o[g].caption:o[g].name}),s=t&&"Value"===t.type&&t.measure===o[g].name&&t.condition===n?g:s;var m=ej2Base.createElement("div",{className:"e-filter-div-content e-"+(["date","number"].indexOf(i)>=0?"label":i)+"-filter",id:this.parent.parentID+"_"+i+"_filter_div_content",attrs:{"data-type":i,"data-fieldName":e,"data-operator":n,"data-measure":this.parent.dataSource.values.length>0?this.parent.dataSource.values[s].name:"","data-value1":t&&n===t.condition?t.value1.toString():"","data-value2":t&&n===t.condition?t.value1.toString():""}}),v=ej2Base.createElement("div",{className:"e-filter-text-div",innerHTML:this.parent.localeObj.getConstant(i+"TextContent")}),f=ej2Base.createElement("div",{className:"e-between-text-div "+(-1===d.indexOf(n)?"e-disable":""),innerHTML:this.parent.localeObj.getConstant("And")}),y=ej2Base.createElement("div",{className:"e-separator-div"}),S=ej2Base.createElement("div",{className:"e-filter-option-wrapper-1"}),b=ej2Base.createElement("div",{className:"e-measure-option-wrapper "+(["label","date","number"].indexOf(i)>=0?"e-disable":"")}),C=ej2Base.createElement("div",{className:"e-condition-option-wrapper"}),x=ej2Base.createElement("div",{className:"e-filter-option-wrapper-2"}),w=ej2Base.createElement("div",{id:this.parent.parentID+"_"+i+"_measure_option_wrapper"}),j=ej2Base.createElement("div",{id:this.parent.parentID+"_"+i+"_contition_option_wrapper"}),E=ej2Base.createElement("div",{className:"e-filter-input-div-1"}),T=ej2Base.createElement("div",{className:"e-filter-input-div-2 "+(-1===d.indexOf(n)?"e-disable":"")}),B=ej2Base.createElement("input",{id:this.parent.parentID+"_"+i+"_input_option_1",attrs:{type:"text"}}),D=ej2Base.createElement("input",{id:this.parent.parentID+"_"+i+"_input_option_2",attrs:{type:"text"}});return E.appendChild(B),T.appendChild(D),b.appendChild(w),b.appendChild(y),C.appendChild(j),S.appendChild(b),S.appendChild(C),x.appendChild(E),x.appendChild(f),x.appendChild(T),this.createElements(t,d,w,j,B,D,r,a,s,n,i),m.appendChild(v),m.appendChild(S),m.appendChild(x),m},e.prototype.createElements=function(e,t,i,a,r,o,n,s,l,d,p){var h=this;if(new ej2Dropdowns.DropDownList({dataSource:n,enableRtl:this.parent.enableRtl,fields:{value:"value",text:"text"},index:l,cssClass:"e-value-options",width:"100%",change:function(e){var t=h.dialogPopUp.element.querySelector(".e-selected-tab");ej2Base.isNullOrUndefined(t)||(h.updateInputValues(t,p,r,o),ej2Grids.setStyleAndAttributes(t,{"data-measure":e.value}))}}).appendTo(i),new ej2Dropdowns.DropDownList({dataSource:s,enableRtl:this.parent.enableRtl,fields:{value:"value",text:"text"},value:d,cssClass:"e-filter-operator",width:"100%",change:function(e){var i=h.dialogPopUp.element.querySelector(".e-selected-tab");if(!ej2Base.isNullOrUndefined(i)){h.updateInputValues(i,p,r,o);for(var a=0,n=["e-between-text-div","e-filter-input-div-2"];a<n.length;a++){var s=n[a];t.indexOf(e.value)>=0?ej2Base.removeClass([i.querySelector("."+s)],"e-disable"):ej2Base.addClass([i.querySelector("."+s)],"e-disable")}ej2Grids.setStyleAndAttributes(i,{"data-operator":e.value})}}}).appendTo(a),"date"===p){var c=new ej2Calendars.DateTimePicker({placeholder:this.parent.localeObj.getConstant("chooseDate"),enableRtl:this.parent.enableRtl,format:"dd/MM/yyyy hh:mm:ss a",showClearButton:!0,value:e&&d===e.condition?e.value1:null,change:function(e){var t=h.dialogPopUp.element.querySelector(".e-selected-tab");ej2Base.isNullOrUndefined(t)||ej2Grids.setStyleAndAttributes(t,{"data-value1":e.value,"data-value2":u.value})},width:"100%"}),u=new ej2Calendars.DateTimePicker({placeholder:this.parent.localeObj.getConstant("chooseDate"),enableRtl:this.parent.enableRtl,format:"dd/MM/yyyy hh:mm:ss a",showClearButton:!0,value:e&&d===e.condition?e.value2:null,change:function(e){var t=h.dialogPopUp.element.querySelector(".e-selected-tab");ej2Base.isNullOrUndefined(t)||ej2Grids.setStyleAndAttributes(t,{"data-value1":c.value,"data-value2":e.value})},width:"100%"});c.appendTo(r),u.appendTo(o)}else if("value"===p){var g=new ej2Inputs.NumericTextBox({placeholder:this.parent.localeObj.getConstant("enterValue"),enableRtl:this.parent.enableRtl,showClearButton:!0,format:"###.##",value:e&&d===e.condition?parseInt(e.value1,10):void 0,change:function(e){var t=h.dialogPopUp.element.querySelector(".e-selected-tab");ej2Base.isNullOrUndefined(t)||ej2Grids.setStyleAndAttributes(t,{"data-value1":e.value?e.value.toString():"0","data-value2":m.value?m.value.toString():"0"})},width:"100%"}),m=new ej2Inputs.NumericTextBox({placeholder:this.parent.localeObj.getConstant("enterValue"),enableRtl:this.parent.enableRtl,showClearButton:!0,format:"###.##",value:e&&d===e.condition?parseInt(e.value2,10):void 0,change:function(e){var t=h.dialogPopUp.element.querySelector(".e-selected-tab");ej2Base.isNullOrUndefined(t)||ej2Grids.setStyleAndAttributes(t,{"data-value1":g.value?g.value.toString():"0","data-value2":e.value?e.value.toString():"0"})},width:"100%"});g.appendTo(r),m.appendTo(o)}else{var v=new ej2Inputs.MaskedTextBox({placeholder:this.parent.localeObj.getConstant("enterValue"),enableRtl:this.parent.enableRtl,showClearButton:!0,value:e&&d===e.condition?e.value1:"",change:function(e){var t=h.dialogPopUp.element.querySelector(".e-selected-tab");ej2Base.isNullOrUndefined(t)||ej2Grids.setStyleAndAttributes(t,{"data-value1":e.value,"data-value2":f.value})},width:"100%"}),f=new ej2Inputs.MaskedTextBox({placeholder:this.parent.localeObj.getConstant("enterValue"),enableRtl:this.parent.enableRtl,showClearButton:!0,value:e&&d===e.condition?e.value2:"",change:function(e){var t=h.dialogPopUp.element.querySelector(".e-selected-tab");ej2Base.isNullOrUndefined(t)||ej2Grids.setStyleAndAttributes(t,{"data-value1":v.value,"data-value2":e.value})},width:"100%"});v.appendTo(r),f.appendTo(o)}},e.prototype.updateInputValues=function(e,t,i,a){var r,o;if("date"===t){var n=i.ej2_instances[0],s=a.ej2_instances[0];r=ej2Base.isNullOrUndefined(n.value)?"":n.value.toString(),o=ej2Base.isNullOrUndefined(s.value)?"":s.value.toString()}else{var n=i.ej2_instances[0],s=a.ej2_instances[0];r=n.value,o=s.value}ej2Grids.setStyleAndAttributes(e,{"data-value1":r,"data-value2":o})},e.prototype.validateTreeNode=function(e){e.node.classList.contains("e-disable")&&(e.cancel=!0)},e.prototype.updateCheckedState=function(e){var t=this.dialogPopUp.element;ej2Grids.setStyleAndAttributes(t,{role:"menu","aria-haspopup":"true"});var i=[].slice.call(this.memberTreeView.element.querySelectorAll("li")),a=this.getUnCheckedNodes(),r=this.getCheckedNodes(),o=this.allMemberSelect.element.querySelector("li").querySelector("span.e-frame");i.length>0?r.length>0?(a.length>0?(ej2Base.removeClass([o],"e-check"),ej2Base.addClass([o],"e-stop")):0===a.length&&(ej2Base.removeClass([o],"e-stop"),ej2Base.addClass([o],"e-check")),this.dialogPopUp.buttons[0].buttonModel.disabled=!1,t.querySelector(".e-ok-btn").removeAttribute("disabled")):a.length>0&&0===r.length&&(ej2Base.removeClass([o],["e-check","e-stop"]),this.getCheckedNodes().length===r.length&&(this.dialogPopUp.buttons[0].buttonModel.disabled=!0,t.querySelector(".e-ok-btn").setAttribute("disabled","disabled"))):(this.dialogPopUp.buttons[0].buttonModel.disabled=!0,t.querySelector(".e-ok-btn").setAttribute("disabled","disabled"))},e.prototype.getCheckedNodes=function(){return this.parent.searchTreeItems.filter(function(e){return e.checkedStatus})},e.prototype.getUnCheckedNodes=function(){return this.parent.searchTreeItems.filter(function(e){return!e.checkedStatus})},e.prototype.isExcelFilter=function(e){for(var t=!1,i=0,a=this.parent.dataSource.filters;i<a.length;i++)if(a[i].name===e){t=!0;break}return!(t||!this.parent.dataSource.allowLabelFilter&&!this.parent.dataSource.allowValueFilter)},e.prototype.getFilterObject=function(e){var t=this.parent.eventBase.getFilterItemByName(e);if(t&&(["Label","Date","Number"].indexOf(t.type)>=0&&this.parent.dataSource.allowLabelFilter||"Value"===t.type&&this.parent.dataSource.allowValueFilter||["Include","Exclude"].indexOf(t.type)>=0))return t},e.prototype.closeFilterDialog=function(){this.allowExcelLikeFilter&&this.tabObj&&!this.tabObj.isDestroyed&&this.tabObj.destroy(),this.dialogPopUp.close()},e.prototype.removeFilterDialog=function(){this.dialogPopUp&&!this.dialogPopUp.isDestroyed&&this.dialogPopUp.destroy(),document.getElementById(this.parent.parentID+"_EditorTreeView")&&ej2Base.remove(document.getElementById(this.parent.parentID+"_EditorTreeView"))},e}(),PivotCommon=function(){function e(e){return this.currentTreeItems=[],this.savedTreeFilterPos={},this.currentTreeItemsPos={},this.searchTreeItems=[],this.isDataOverflow=!1,this.isDateField=!1,this.element=e.element,this.moduleName=e.moduleName,this.dataSource=e.dataSource,this.engineModule=e.pivotEngine,this.enableRtl=e.enableRtl,this.isAdaptive=e.isAdaptive,this.renderMode=e.renderMode,this.parentID=e.id,this.localeObj=e.localeObj,this.nodeStateModified=new NodeStateModified(this),this.dataSourceUpdate=new DataSourceUpdate(this),this.eventBase=new EventBase(this),this.filterDialog=new FilterDialog(this),this.errorDialog=new ErrorDialog(this),this.keyboardModule=new CommonKeyboardInteraction(this),this}return e.prototype.destroy=function(){this.keyboardModule&&this.keyboardModule.destroy()},e}(),DialogRenderer=function(){function e(e){this.parent=e}return e.prototype.render=function(){var e=ej2Base.createElement("div",{id:this.parent.element.id+"_Wrapper",className:WRAPPER_CLASS,styles:"width:"+this.parent.element.style.width});this.parent.isAdaptive?ej2Base.addClass([e],DEVICE):ej2Base.removeClass([e],DEVICE),this.parent.enableRtl?ej2Base.addClass([e],RTL):ej2Base.removeClass([e],RTL),this.parent.cssClass&&ej2Base.addClass([e],this.parent.cssClass),this.parentElement=ej2Base.createElement("div",{className:"e-field-list-container"}),this.parent.element.appendChild(e),this.parent.isAdaptive&&(e.removeAttribute("style"),this.parentElement=ej2Base.createElement("div",{className:"e-adaptive-container"}),this.renderAdaptiveLayout(e)),"Popup"===this.parent.renderMode?(this.renderFieldListDialog(e),this.unWireDialogEvent(this.parent.element.querySelector(".e-toggle-field-list")),this.wireDialogEvent(this.parent.element.querySelector(".e-toggle-field-list"))):this.renderStaticLayout(e)},e.prototype.renderStaticLayout=function(e){if(!this.parent.isAdaptive){var t=ej2Base.createElement("div",{className:"e-field-list-title"}),i=ej2Base.createElement("div",{className:"e-title-content",innerHTML:this.parent.localeObj.getConstant("staticFieldList")});t.appendChild(i),t.appendChild(this.createCalculatedButton()),ej2Base.addClass([e],"e-static"),e.appendChild(t),e.appendChild(this.parentElement),ej2Base.addClass([e],"e-static"),this.parent.allowDeferLayoutUpdate&&(e.appendChild(this.createDeferUpdateButtons()),this.renderDeferUpdateButtons())}},e.prototype.renderDeferUpdateButtons=function(){this.parent.allowDeferLayoutUpdate&&(this.deferUpdateCheckBox=new ej2Buttons.CheckBox({label:this.parent.localeObj.getConstant("deferLayoutUpdate"),checked:!0,enableRtl:this.parent.enableRtl,change:this.onCheckChange.bind(this)}),this.deferUpdateCheckBox.appendTo("#"+this.parent.element.id+"DeferUpdateCheckBox"),this.deferUpdateApplyButton=new ej2Buttons.Button({cssClass:"e-defer-apply-button e-defer-update-btn"+("Popup"===this.parent.renderMode?" e-flat":""),content:this.parent.localeObj.getConstant("apply"),enableRtl:this.parent.enableRtl,isPrimary:!0}),this.deferUpdateApplyButton.appendTo("#"+this.parent.element.id+"_DeferUpdateButton1"),this.deferUpdateApplyButton.element.onclick="Fixed"===this.parent.renderMode?this.applyButtonClick.bind(this):this.onDeferUpdateClick.bind(this)),this.deferUpdateCancelButton=new ej2Buttons.Button({cssClass:"e-defer-cancel-button e-cancel-btn"+("Popup"===this.parent.renderMode?" e-flat":""),content:this.parent.allowDeferLayoutUpdate?this.parent.localeObj.getConstant("cancel"):this.parent.localeObj.getConstant("close"),enableRtl:this.parent.enableRtl,isPrimary:!this.parent.allowDeferLayoutUpdate}),this.deferUpdateCancelButton.appendTo("#"+this.parent.element.id+"_DeferUpdateButton2"),this.deferUpdateCancelButton.element.onclick="Fixed"===this.parent.renderMode?this.cancelButtonClick.bind(this):this.onCloseFieldList.bind(this)},e.prototype.createDeferUpdateButtons=function(){var e=ej2Base.createElement("div",{className:"e-layout-footer"});if(this.parent.allowDeferLayoutUpdate){var t=ej2Base.createElement("div",{className:"e-checkbox-layout"}),i=ej2Base.createElement("input",{id:this.parent.element.id+"DeferUpdateCheckBox"});t.appendChild(i),e.appendChild(t)}var a=ej2Base.createElement("div",{className:"e-button-layout"});if(this.parent.allowDeferLayoutUpdate){var r=ej2Base.createElement("button",{id:this.parent.element.id+"_DeferUpdateButton1"});a.appendChild(r)}var o=ej2Base.createElement("button",{id:this.parent.element.id+"_DeferUpdateButton2"});return a.appendChild(o),e.appendChild(a),e},e.prototype.onCheckChange=function(e){e.checked&&(this.parent.clonedDataSource=ej2Base.extend({},this.parent.dataSource,null,!0),this.parent.clonedFieldList=ej2Base.extend({},this.parent.pivotFieldList,null,!0)),this.parent.allowDeferLayoutUpdate=!this.parent.allowDeferLayoutUpdate,"Fixed"===this.parent.renderMode?(this.deferUpdateApplyButton.setProperties({disabled:!this.parent.allowDeferLayoutUpdate}),this.deferUpdateCancelButton.setProperties({disabled:!this.parent.allowDeferLayoutUpdate})):this.parent.allowDeferLayoutUpdate?(this.deferUpdateApplyButton.element.style.display="",this.deferUpdateCancelButton.setProperties({content:this.parent.localeObj.getConstant("cancel")}),this.deferUpdateCancelButton.isPrimary=!1):(this.deferUpdateApplyButton.element.style.display="none",this.deferUpdateCancelButton.setProperties({content:this.parent.localeObj.getConstant("close")}),this.deferUpdateCancelButton.isPrimary=!0),this.cancelButtonClick()},e.prototype.applyButtonClick=function(){this.parent.updateDataSource(!1),this.parent.axisFieldModule.render(),this.parent.clonedDataSource=ej2Base.extend({},this.parent.dataSource,null,!0),this.parent.clonedFieldList=ej2Base.extend({},this.parent.pivotFieldList,null,!0)},e.prototype.cancelButtonClick=function(){this.parent.setProperties({dataSource:this.parent.clonedDataSource.properties},!0),this.parent.engineModule.fieldList=ej2Base.extend({},this.parent.clonedFieldList,null,!0),this.parent.updateDataSource(!1,!0)},e.prototype.renderFieldListDialog=function(e){var t=ej2Base.createElement("div",{className:"e-toggle-field-list e-icons e-select-table",attrs:{tabindex:"0",title:this.parent.localeObj.getConstant("fieldList"),"aria-disabled":"false","aria-label":this.parent.localeObj.getConstant("fieldList")}});if(this.parent.element.appendChild(t),this.parent.isAdaptive){var i='<div class=e-title-mobile-header><span class="e-icons e-field-list-back-icon"></span><div class=e-title-mobile-content>'+this.parent.localeObj.getConstant("fieldList")+"</div></div>",a=[{click:this.showFieldListDialog.bind(this),buttonModel:{cssClass:"e-field-list-btn e-small e-round",iconCss:ICON+" e-add-icon",isPrimary:!0}},{click:this.showCalculatedField.bind(this),buttonModel:{cssClass:"e-calculated-field-btn e-small e-round e-disable",iconCss:ICON+" e-add-icon",enableRtl:this.parent.enableRtl,isPrimary:!0}}];this.fieldListDialog=new ej2Popups.Dialog({animationSettings:{effect:this.parent.enableRtl?"SlideRight":"SlideLeft"},header:i,content:this.parentElement,isModal:!0,showCloseIcon:!1,visible:!1,allowDragging:!1,closeOnEscape:!1,enableRtl:this.parent.enableRtl,width:"100%",height:"100%",position:{X:"center",Y:"center"},buttons:a,target:document.body,close:this.removeFieldListIcon.bind(this)}),this.fieldListDialog.appendTo(e),ej2Base.setStyleAttribute(e.querySelector("#"+e.id+"_dialog-content"),{padding:"0"});var r=e.querySelector(".e-footer-content");ej2Base.addClass([r],"e-field-list-footer"),ej2Base.removeClass([r.querySelector(".e-calculated-field-btn")],"e-flat"),ej2Base.removeClass([r.querySelector(".e-field-list-btn")],"e-flat"),this.fieldListDialog.element.querySelector(".e-field-list-back-icon").onclick=this.parent.allowDeferLayoutUpdate?this.onDeferUpdateClick.bind(this):this.onCloseFieldList.bind(this)}else{var o=this.createDeferUpdateButtons().outerHTML,i="<div class=e-title-header><div class=e-title-content>"+this.parent.localeObj.getConstant("fieldList")+"</div></div>";this.fieldListDialog=new ej2Popups.Dialog({animationSettings:{effect:"Zoom"},header:i,content:this.parentElement,isModal:!1,showCloseIcon:!1,visible:!1,allowDragging:!0,enableRtl:this.parent.enableRtl,width:this.parent.element.style.width,position:{X:"center",Y:this.parent.element.offsetTop},footerTemplate:o,closeOnEscape:!0,target:ej2Base.isNullOrUndefined(this.parent.target)?document.body:"string"==typeof this.parent.target?document.querySelector(this.parent.target):this.parent.target,close:this.removeFieldListIcon.bind(this)}),this.fieldListDialog.appendTo(e),this.renderDeferUpdateButtons(),ej2Base.setStyleAttribute(e.querySelector("#"+e.id+"_title"),{width:"100%"}),e.querySelector(".e-title-header").appendChild(this.createCalculatedButton())}},e.prototype.updateDataSource=function(e){for(var t=["filters","columns","rows","values"],i=0,a=e;i<a.length;i++){var r=a[i],o=t[this.adaptiveElement.selectedItem];this.parent.pivotCommon.dataSourceUpdate.control="pivotview"===this.parent.getModuleName()?this.parent:this.parent.pivotGridModule?this.parent.pivotGridModule:this.parent,this.parent.pivotCommon.dataSourceUpdate.updateDataSource(r,o,-1)}this.parent.axisFieldModule.render(),this.parent.allowDeferLayoutUpdate?this.parent.triggerPopulateEvent():this.parent.updateDataSource(!0)},e.prototype.onDeferUpdateClick=function(){this.parent.updateDataSource(),this.parent.dialogRenderer.fieldListDialog.hide()},e.prototype.renderAdaptiveLayout=function(e){var t=ej2Base.createElement("div",{className:"e-field-list-footer"});e.appendChild(this.parentElement);var i=[{header:{text:this.parent.localeObj.getConstant("filters")},content:this.createAxisTable("filters")},{header:{text:this.parent.localeObj.getConstant("columns")},content:this.createAxisTable("columns")},{header:{text:this.parent.localeObj.getConstant("rows")},content:this.createAxisTable("rows")},{header:{text:this.parent.localeObj.getConstant("values")},content:this.createAxisTable("values")},{header:{text:this.parent.localeObj.getConstant("createCalculatedField")},content:"Calculated Field Related UI"}];this.parent.allowCalculatedField||i.pop(),this.adaptiveElement=new ej2Navigations.Tab({heightAdjustMode:"Auto",items:i,height:"100%",enableRtl:this.parent.enableRtl,selected:this.tabSelect.bind(this)}),"Fixed"===this.parent.renderMode?(t.appendChild(this.createAddButton()),ej2Base.addClass([e],"e-static"),this.adaptiveElement.appendTo(this.parentElement),this.parentElement.appendChild(t)):this.adaptiveElement.appendTo(this.parentElement)},e.prototype.tabSelect=function(e){this.parentElement.querySelector("."+WRAPPER_CLASS+" .e-field-list-btn")&&(4!==e.selectedIndex?(ej2Base.addClass([this.parentElement.querySelector("."+WRAPPER_CLASS+" .e-calculated-field-btn")],"e-disable"),ej2Base.removeClass([this.parentElement.querySelector("."+WRAPPER_CLASS+" .e-field-list-btn")],"e-disable")):(ej2Base.removeClass([this.parentElement.querySelector("."+WRAPPER_CLASS+" .e-calculated-field-btn")],"e-disable"),ej2Base.addClass([this.parentElement.querySelector("."+WRAPPER_CLASS+" .e-field-list-btn")],"e-disable"))),4===e.selectedIndex?(this.adaptiveElement.items[4].content="",this.adaptiveElement.dataBind(),this.parent.notify("init-calculatedfield",{})):this.parent.axisFieldModule.render()},e.prototype.createCalculatedButton=function(){var e=ej2Base.createElement("div",{id:this.parent.element.id+"_CalculatedField"}),t=new ej2Buttons.Button({cssClass:"e-calculated-field e-disable",content:this.parent.localeObj.getConstant("calculatedField"),enableRtl:this.parent.enableRtl});return t.appendTo(e),this.parent.calculatedFieldModule&&ej2Base.removeClass([e],"e-disable"),t.element.onclick=this.showCalculatedField.bind(this),e},e.prototype.createAddButton=function(){var e=ej2Base.createElement("div",{className:"e-field-list-footer-content"}),t=ej2Base.createElement("div",{}),i=ej2Base.createElement("div",{}),a=new ej2Buttons.Button({cssClass:"e-calculated-field-btn e-small e-round e-disable",iconCss:ICON+" e-add-icon",enableRtl:this.parent.enableRtl}),r=new ej2Buttons.Button({cssClass:"e-field-list-btn e-small e-round",iconCss:ICON+" e-add-icon",enableRtl:this.parent.enableRtl});return r.appendTo(t),a.appendTo(i),e.appendChild(t),e.appendChild(i),a.element.onclick=this.showCalculatedField.bind(this),r.element.onclick=this.showFieldListDialog.bind(this),e},e.prototype.createAxisTable=function(e){var t=ej2Base.createElement("div",{className:"e-field-list-"+e}),i=ej2Base.createElement("div",{className:"e-axis-content e-"+e}),a=ej2Base.createElement("span",{className:"e-draggable-prompt",innerHTML:this.parent.localeObj.getConstant("addPrompt")});return t.appendChild(i),t.appendChild(a),t},e.prototype.showCalculatedField=function(e){this.parent.isAdaptive||this.parent.dialogRenderer.fieldListDialog&&(this.parent.dialogRenderer.fieldListDialog.hide(),ej2Base.addClass([this.parent.element.querySelector(".e-toggle-field-list")],"e-hide")),this.parent.notify("init-calculatedfield",{})},e.prototype.showFieldListDialog=function(e){var t=this.adaptiveElement.selectedItem;this.parent.treeViewModule.render(t)},e.prototype.onShowFieldList=function(){this.parent.allowDeferLayoutUpdate&&(this.parent.isAdaptive&&this.parent.axisFieldModule.render(),this.parent.clonedDataSource=ej2Base.extend({},this.parent.dataSource,null,!0),this.parent.clonedFieldList=ej2Base.extend({},this.parent.pivotFieldList,null,!0)),ej2Base.addClass([this.parent.element.querySelector(".e-toggle-field-list")],"e-hide"),this.parent.dialogRenderer.fieldListDialog.show(),this.parent.dialogRenderer.fieldListDialog.element.style.top=parseInt(this.parent.dialogRenderer.fieldListDialog.element.style.top,10)<0?"0px":this.parent.dialogRenderer.fieldListDialog.element.style.top},e.prototype.onCloseFieldList=function(){this.parent.allowDeferLayoutUpdate&&(this.parent.dataSource=ej2Base.extend({},this.parent.clonedDataSource.properties,null,!0),this.parent.pivotGridModule.engineModule=this.parent.engineModule,this.parent.pivotGridModule.setProperties({dataSource:this.parent.clonedDataSource.properties},!0),this.parent.engineModule.fieldList=ej2Base.extend({},this.parent.clonedFieldList,null,!0),this.parent.pivotGridModule.notify(uiUpdate,this),this.parent.pivotGridModule.notify(contentReady,this)),this.parent.dialogRenderer.fieldListDialog.hide()},e.prototype.removeFieldListIcon=function(){document.getElementById(this.parent.element.id+"calculateddialog")||ej2Base.removeClass([this.parent.element.querySelector(".e-toggle-field-list")],"e-hide")},e.prototype.keyPress=function(e){e.target;if(13===e.keyCode&&e.target)return e.target.click(),void e.preventDefault()},e.prototype.wireDialogEvent=function(e){ej2Base.EventHandler.add(e,"keydown",this.keyPress,this),ej2Base.EventHandler.add(e,"click",this.onShowFieldList,this)},e.prototype.unWireDialogEvent=function(e){ej2Base.EventHandler.remove(e,"keydown",this.keyPress),ej2Base.EventHandler.remove(e,"click",this.onShowFieldList)},e}(),TreeViewRenderer=function(){function e(e){this.selectedNodes=[],this.parent=e,this.addEventListener()}return e.prototype.render=function(e){if(this.parentElement=this.parent.dialogRenderer.parentElement,this.parent.isAdaptive)this.renderTreeDialog(e);else{var t=ej2Base.createElement("div",{className:"e-field-table"}),i=ej2Base.createElement("div",{className:"e-field-header",innerHTML:this.parent.localeObj.getConstant("allFields")});if(this.treeViewElement=ej2Base.createElement("div",{id:this.parent.element.id+"_TreeView",className:"e-field-list"}),t.appendChild(i),t.appendChild(this.treeViewElement),this.parentElement.appendChild(t),"Fixed"===this.parent.renderMode){var a=ej2Base.createElement("div",{className:"e-center-div"}),r=ej2Base.createElement("div",{className:"e-center-title",innerHTML:this.parent.localeObj.getConstant("centerHeader")});this.parentElement.appendChild(a),this.parentElement.appendChild(r)}this.renderTreeView()}},e.prototype.renderTreeView=function(){this.fieldTable=new ej2Navigations.TreeView({fields:{dataSource:this.getTreeData(),id:"id",text:"caption",isChecked:"isSelected"},nodeChecked:this.nodeStateChange.bind(this),cssClass:"e-field-list-tree",showCheckBox:!0,allowDragAndDrop:!0,sortOrder:"Ascending",enableRtl:this.parent.enableRtl,nodeDragStart:this.dragStart.bind(this),nodeDragStop:this.dragStop.bind(this)}),this.treeViewElement.innerHTML="",this.fieldTable.appendTo(this.treeViewElement),this.getTreeUpdate()},e.prototype.renderTreeDialog=function(e){var t=ej2Base.createElement("div",{id:this.parent.element.id+"_FieldListTreeView",className:"e-adaptive-field-list-dialog"});this.parentElement.appendChild(t),this.fieldDialog=new ej2Popups.Dialog({animationSettings:{effect:"Fade"},allowDragging:!1,header:this.parent.localeObj.getConstant("adaptiveFieldHeader"),content:this.createTreeView(this.getTreeData(e)),isModal:!0,visible:!0,showCloseIcon:!1,enableRtl:this.parent.enableRtl,width:"auto",height:"350px",position:{X:"center",Y:"center"},buttons:[{click:this.closeTreeDialog.bind(this),buttonModel:{cssClass:"e-cancel-btn",content:this.parent.localeObj.getConstant("cancel")}},{click:this.onFieldAdd.bind(this),buttonModel:{cssClass:"e-ok-btn",content:this.parent.localeObj.getConstant("add"),isPrimary:!0}}],closeOnEscape:!0,target:this.parentElement.parentElement,close:this.dialogClose.bind(this)}),this.fieldDialog.appendTo(t)},e.prototype.dialogClose=function(){document.getElementById(this.parent.element.id+"_FieldListTreeView")&&ej2Base.remove(document.getElementById(this.parent.element.id+"_FieldListTreeView"))},e.prototype.createTreeView=function(e){var t=ej2Base.createElement("div",{id:this.parent.element.id+"EditorDiv",className:"e-member-editor-wrapper"}),i=ej2Base.createElement("div",{id:this.parent.element.id+"_SearchDiv",attrs:{tabindex:"-1"},className:"e-editor-search-wrapper"}),a=ej2Base.createElement("input",{attrs:{type:"text"}});i.appendChild(a);var r=ej2Base.createElement("div",{className:"e-member-editor-container"});return t.appendChild(i),this.editorSearch=new ej2Inputs.MaskedTextBox({placeholder:this.parent.localeObj.getConstant("search"),enableRtl:this.parent.enableRtl,cssClass:"e-editor-search",change:this.textChange.bind(this)}),this.editorSearch.appendTo(a),t.appendChild(r),this.fieldTable=new ej2Navigations.TreeView({fields:{dataSource:e,id:"id",text:"caption",isChecked:"isSelected"},showCheckBox:!0,sortOrder:"Ascending",enableRtl:this.parent.enableRtl,nodeChecked:this.addNode.bind(this)}),this.fieldTable.appendTo(r),t},e.prototype.textChange=function(e){this.parent.pivotCommon.eventBase.searchTreeNodes(e,this.fieldTable,!0)},e.prototype.dragStart=function(e){if(e.event.target.classList.contains("e-drag")){this.parent.isDragging=!0,ej2Base.addClass([e.draggedNode.querySelector(".e-list-text")],"e-list-selected");var t=this.parent.engineModule.fieldList[e.draggedNode.getAttribute("data-uid")],i=["e-rows","e-columns","e-filters"];if(t&&"CalculatedField"===t.aggregateType)for(var a=0,r=i;a<r.length;a++){var o=r[a];ej2Base.addClass([this.parentElement.querySelector("."+o)],"e-drag-restrict")}}else e.cancel=!0},e.prototype.dragStop=function(e){e.cancel=!0,this.parent.isDragging=!1;for(var t=0,i=["e-rows","e-columns","e-filters"];t<i.length;t++){var a=i[t];ej2Base.removeClass([this.parentElement.querySelector("."+a)],"e-drag-restrict")}ej2Base.removeClass([e.draggedNode.querySelector(".e-list-text")],"e-list-selected"),this.parent.pivotCommon.filterDialog.dialogPopUp&&this.parent.pivotCommon.filterDialog.dialogPopUp.close();var r=e.draggedNodeData.id.toString();this.isNodeDropped(e,r)&&(this.parent.pivotCommon.dataSourceUpdate.control="pivotview"===this.parent.getModuleName()?this.parent:this.parent.pivotGridModule?this.parent.pivotGridModule:this.parent,this.parent.pivotCommon.nodeStateModified.onStateModified(e,r)&&(this.parent.allowDeferLayoutUpdate?this.updateDataSource():this.parent.updateDataSource(),this.parent.axisFieldModule.render()))},e.prototype.isNodeDropped=function(e,t){var i=!0;if("true"===e.draggedNodeData.isChecked){var a=this.getButton(t),r=ej2Base.closest(a,".e-droppable"),o=ej2Base.closest(e.target,".e-droppable");if(a&&r===o){for(var n=[].slice.call(r.querySelectorAll(".e-pivot-button")),s=ej2Base.closest(e.target,".e-pvt-btn-div"),l=void 0,d=-1,p=0,h=n.length;p<h;p++)if(n[p].id===a.id&&(l=p),s){var c=s.querySelector(".e-pivot-button");n[p].id===c.id&&(d=p)}if(l===d||l===n.length-1&&-1===d){var u=document.getElementById(this.parent.element.id+"_Wrapper");ej2Base.removeClass([].slice.call(u.querySelectorAll(".e-drop-indicator")),"e-drop-hover"),i=!1}}}return i},e.prototype.getButton=function(e){for(var t,i=document.getElementById(this.parent.element.id+"_Wrapper"),a=[].slice.call(i.querySelectorAll(".e-pivot-button")),r=0,o=a.length;r<o;r++)if(a[r].id===e){t=a[r];break}return t},e.prototype.nodeStateChange=function(e){this.parent.pivotCommon.filterDialog.dialogPopUp&&this.parent.pivotCommon.filterDialog.dialogPopUp.close();var t=ej2Base.closest(e.node,".e-text-content"),i=this.parent.pivotFieldList[e.data[0].id.toString()];if("check"===e.action){ej2Base.addClass([t.querySelector(".e-list-text")],"e-selected-node");var a=this.parent.pivotCommon.dataSourceUpdate.getNewField(e.data[0].id.toString());"number"===i.type?this.parent.dataSource.values.push(a):this.parent.dataSource.rows.push(a)}else ej2Base.removeClass([t.querySelector(".e-list-text")],"e-selected-node"),this.parent.pivotCommon.dataSourceUpdate.removeFieldFromReport(e.data[0].id.toString());this.parent.allowDeferLayoutUpdate?("check"===e.action?i.isSelected=!0:i.isSelected=!1,this.updateDataSource()):this.parent.updateDataSource(!0),this.parent.axisFieldModule.render()},e.prototype.updateDataSource=function(){"pivotfieldlist"===this.parent.getModuleName()&&"Popup"===this.parent.renderMode?(this.parent.pivotGridModule.engineModule=this.parent.engineModule,this.parent.pivotGridModule.setProperties({dataSource:this.parent.dataSource.properties},!0),this.parent.pivotGridModule.notify(uiUpdate,this)):this.parent.triggerPopulateEvent()},e.prototype.addNode=function(e){var t=this.parent.pivotFieldList[e.data[0].id.toString()];if("check"===e.action)this.selectedNodes.push(t.id.toString());else for(var i=this.selectedNodes.length;i--;)if(this.selectedNodes[i]===t.id.toString()){this.selectedNodes.splice(i,1);break}},e.prototype.getTreeUpdate=function(){for(var e=0,t=[].slice.call(this.treeViewElement.querySelectorAll(".e-text-content"));e<t.length;e++){var i=t[e],a=ej2Base.createElement("span",{attrs:{tabindex:"-1",title:this.parent.localeObj.getConstant("drag"),"aria-disabled":"false"},className:ICON+" e-drag"});ej2Base.prepend([a],i),i.querySelector(".e-check")&&ej2Base.addClass([i.querySelector(".e-list-text")],"e-selected-node")}},e.prototype.refreshTreeView=function(){this.fieldTable&&(this.fieldTable.fields={dataSource:this.getTreeData(),id:"id",text:"caption",isChecked:"isSelected"},this.fieldTable.dataBind(),this.getTreeUpdate())},e.prototype.getTreeData=function(e){for(var t=[],i=Object.keys(this.parent.pivotFieldList),a={},r=0,o=i;r<o.length;r++){var n=o[r],s=this.parent.pivotFieldList[n];a[n]={id:s.id,caption:s.caption,isSelected:s.isSelected}}if(this.parent.isAdaptive){for(var l=[this.parent.dataSource.filters,this.parent.dataSource.columns,this.parent.dataSource.rows,this.parent.dataSource.values][e],d=i.length;d--;)a[i[d]].isSelected=!1;for(var p=0,h=l;p<h.length;p++)a[h[p].name].isSelected=!0}for(var c=a,u=0,g=i;u<g.length;u++){var m=c[s=g[u]];t.push(m)}return t},e.prototype.onFieldAdd=function(e){this.parent.dialogRenderer.updateDataSource(this.selectedNodes),this.closeTreeDialog()},e.prototype.closeTreeDialog=function(){this.selectedNodes=[],this.fieldDialog.hide()},e.prototype.addEventListener=function(){this.parent.on("tree-view-update",this.refreshTreeView,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("tree-view-update",this.refreshTreeView)},e.prototype.destroy=function(){this.removeEventListener()},e}(),AxisTableRenderer=function(){function e(e){this.parent=e}return e.prototype.render=function(){if(!this.parent.isAdaptive){var e=ej2Base.createElement("div",{className:"e-axis-table"});this.leftAxisPanel=ej2Base.createElement("div",{className:"e-left-axis-fields"}),this.rightAxisPanel=ej2Base.createElement("div",{className:"e-right-axis-fields"}),this.parent.dialogRenderer.parentElement.appendChild(e),e.appendChild(this.leftAxisPanel),e.appendChild(this.rightAxisPanel),this.axisTable=e,this.renderAxisTable()}this.parent.axisFieldModule.render()},e.prototype.renderAxisTable=function(){for(var e=["filters","rows","columns","values"],t=0,i=e.length;t<i;t++){var a=ej2Base.createElement("div",{className:"e-field-list-"+e[t]}),r=ej2Base.createElement("div",{className:"e-axis-wrapper"}),o=ej2Base.createElement("div",{className:"e-axis-header",innerHTML:this.parent.localeObj.getConstant(e[t])});r.appendChild(this.getIconupdate(e[t])),r.appendChild(o);var n=ej2Base.createElement("div",{className:"e-axis-content e-"+e[t]}),s=void 0;s="rows"===e[t]?this.parent.localeObj.getConstant("dropRowPrompt"):"columns"===e[t]?this.parent.localeObj.getConstant("dropColPrompt"):"values"===e[t]?this.parent.localeObj.getConstant("dropValPrompt"):this.parent.localeObj.getConstant("dropFilterPrompt");var l=ej2Base.createElement("span",{className:"e-draggable-prompt",innerHTML:s});new ej2Base.Droppable(n,{});a.appendChild(r),a.appendChild(n),a.appendChild(l),t<=1?this.leftAxisPanel.appendChild(a):this.rightAxisPanel.appendChild(a),this.unWireEvent(n),this.wireEvent(n)}},e.prototype.getIconupdate=function(e){var t=ej2Base.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false"},className:"e-axis-icon-wrapper"}),i=ej2Base.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false"},className:ICON+" e-axis-"+e});return t.appendChild(i),t},e.prototype.wireEvent=function(e){ej2Base.EventHandler.add(e,"mouseover",this.updateDropIndicator,this),ej2Base.EventHandler.add(e,"mouseleave",this.updateDropIndicator,this)},e.prototype.unWireEvent=function(e){ej2Base.EventHandler.remove(e,"mouseover",this.updateDropIndicator),ej2Base.EventHandler.remove(e,"mouseleave",this.updateDropIndicator)},e.prototype.updateDropIndicator=function(e){var t=this.parent.dialogRenderer.parentElement;if(this.parent.isDragging&&e.target.classList.contains("e-axis-content")&&"mouseover"===e.type){ej2Base.removeClass([].slice.call(t.querySelectorAll(".e-drop-indicator")),"e-drop-hover"),ej2Base.removeClass([].slice.call(t.querySelectorAll(".e-drop-indicator-last")),"e-drop-hover");var i=[].slice.call(e.target.querySelectorAll(".e-pvt-btn-div"));i.length>0&&ej2Base.addClass([i[i.length-1].querySelector(".e-drop-indicator-last")],"e-drop-hover")}else"mouseleave"===e.type&&(ej2Base.removeClass([].slice.call(t.querySelectorAll(".e-drop-indicator")),"e-drop-hover"),ej2Base.removeClass([].slice.call(t.querySelectorAll(".e-drop-indicator-last")),"e-drop-hover"))},e}(),PivotButton=function(){function e(e){this.parent=e,this.menuOption=new AggregateMenu(this.parent),this.parent.pivotButtonModule=this,this.addEventListener(),this.parent instanceof PivotFieldList&&(this.axisField=new AxisFieldRenderer(this.parent))}return e.prototype.renderPivotButton=function(e){var t,i=ej2Base.extend([],e.field,null,!0),a=e.axis,r=-1,o="pivotfieldlist"==this.parent.getModuleName()&&this.parent.pivotGridModule?this.parent.pivotGridModule.showValuesButton:this.parent.showValuesButton;if(("row"===this.parent.dataSource.valueAxis&&"rows"===e.axis||"column"===this.parent.dataSource.valueAxis&&"columns"===e.axis)&&o&&this.parent.dataSource.values.length>1&&(r=i.length,i.push({name:this.parent.localeObj.getConstant("values"),caption:this.parent.localeObj.getConstant("values"),axis:e.axis})),this.parentElement="pivotview"===this.parent.getModuleName()?this.parent.element:document.getElementById(this.parent.element.id+"_Wrapper"),"pivotfieldlist"===this.parent.getModuleName()){if(this.parentElement=document.getElementById(this.parent.element.id+"_Wrapper"),!this.parentElement.querySelector(".e-field-list-"+a))return;l=this.parentElement.querySelector(".e-field-list-"+a).querySelector(".e-draggable-prompt");0===i.length?ej2Base.removeClass([l],"e-disable"):ej2Base.addClass([l],"e-disable"),t=this.parentElement.querySelector(".e-field-list-"+a).querySelector(".e-axis-content")}else this.parentElement=this.parent.element,t=this.parentElement.querySelector(".e-group-"+a);if(t)if("pivotview"===this.parent.getModuleName()&&0===i.length){for(var n=0,s=this.parentElement.querySelectorAll(".e-group-"+a);n<s.length;n++)if(!(w=s[n]).classList.contains("e-group-chart-values")){var l=ej2Base.createElement("span",{className:"e-draggable-prompt",innerHTML:this.parent.groupingBarSettings.allowDragAndDrop?"rows"===a?this.parent.localeObj.getConstant("rowAxisPrompt"):"columns"===a?this.parent.localeObj.getConstant("columnAxisPrompt"):"values"===a?this.parent.localeObj.getConstant("valueAxisPrompt"):this.parent.localeObj.getConstant("filterAxisPrompt"):""});w.appendChild(l)}}else{for(var d=0,p=i.length;d<p;d++)for(var h=0,c="pivotfieldlist"===this.parent.getModuleName()?[t]:this.parentElement.querySelectorAll(".e-group-"+a);h<c.length;h++)if(!(w=w=c[h]).classList.contains("e-group-chart-values")){var u=ej2Base.createElement("div",{className:"e-pvt-btn-div"+(0===d?" e-first-btn":""),attrs:{"data-tag":a+":"+i[d].name}}),g=ej2Base.createElement("div",{id:i[d].name,className:"e-pivot-button",attrs:{"data-uid":i[d].name,tabindex:"0",isvalue:d===r?"true":"false","aria-disabled":"false","aria-label":i[d].caption?i[d].caption:i[d].name,"data-type":i[d].type,"data-caption":i[d].caption?i[d].caption:i[d].name,"data-basefield":i[d].baseField,"data-baseitem":i[d].baseItem}}),m=ej2Base.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false"},className:"e-drop-indicator"}),v=ej2Base.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false"},className:"e-drop-indicator-last"}),f=this.createButtonDragIcon(g),y=this.createButtonText(i,d,a,r);g.appendChild(y),-1===["filters","values"].indexOf(a)&&r!==d&&this.createSortOption(g,i[d].name),"values"!==a&&r!==d&&this.createFilterOption(g,i[d].name),"values"===a&&this.getTypeStatus(i,d,g);var S=ej2Base.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false"},className:ICON+" e-remove"});"pivotview"===this.parent.getModuleName()&&(this.parent.groupingBarSettings.showRemoveIcon?ej2Base.removeClass([S],"e-disable"):ej2Base.addClass([S],"e-disable")),g.appendChild(S),u.appendChild(m),u.appendChild(g),u.appendChild(v),w.appendChild(u),new ej2Buttons.Button({enableRtl:this.parent.enableRtl}).appendTo(g),this.unWireEvent(u,d===r?"values":a),this.wireEvent(u,d===r?"values":a),("pivotview"===this.parent.getModuleName()&&!this.parent.isAdaptive||"pivotfieldlist"===this.parent.getModuleName())&&this.createDraggable("pivotview"===this.parent.getModuleName()?y:f)}if("values"===a)for(var b=this,C=0,x=this.parentElement.querySelectorAll(".e-group-"+a);C<x.length;C++){var w=x[C];!function(e){if(e.classList.contains("e-group-chart-values")){var t=i.map(function(e){return{text:e.caption?e.caption:e.name,value:e.name}}),a=b.parent;if(b.valueFiedDropDownList&&e.querySelector(".e-group-chart-values-drodown-div"))b.valueFiedDropDownList.dataSource=t,b.valueFiedDropDownList.value=a.chartSettings.enableMultiAxis?t[0].value:a.chartModule.currentMeasure;else{var r=ej2Base.createElement("div",{className:"e-group-chart-values-drodown-div"});e.appendChild(r),b.valueFiedDropDownList=new ej2Dropdowns.DropDownList({dataSource:t,enableRtl:b.parent.enableRtl,value:a.chartSettings.enableMultiAxis?t[0].value:a.chartModule.currentMeasure,width:200,fields:{value:"value",text:"text"},cssClass:"e-group-chart-values-drodown",change:function(e){e.e&&null!==e.e&&(a.chartSettings.value=e.value)}}),b.valueFiedDropDownList.appendTo(r)}}}(w)}}},e.prototype.createButtonText=function(e,t,i,a){var r,o;"filters"===i&&(o=this.updateButtontext(e[t].name)),void 0!==this.parent.engineModule.fieldList[e[t].name]&&(void 0!==(r=this.parent.engineModule.fieldList[e[t].name].aggregateType)||"string"!==this.parent.engineModule.fieldList[e[t].name].type&&"include"!==this.parent.engineModule.fieldList[e[t].name].type&&"exclude"!==this.parent.engineModule.fieldList[e[t].name].type?void 0===r&&(r=void 0!==this.parent.engineModule.fieldList[e[t].name].aggregateType?this.parent.engineModule.fieldList[e[t].name].aggregateType:"Sum"):r="Count");var n=e[t].caption?e[t].caption:e[t].name;return ej2Base.createElement("span",{attrs:{title:"filters"===i?n+" ("+o+")":this.parent.dataSource.showAggregationOnValueField&&"values"===i&&"CalculatedField"!==r?this.parent.localeObj.getConstant(r)+" of "+n:n,tabindex:"-1","aria-disabled":"false",oncontextmenu:"return false;","data-type":a===t?"":r},className:"e-content "+("pivotview"!==this.parent.getModuleName()||this.parent.groupingBarSettings.allowDragAndDrop?"":"e-disable-drag"),innerHTML:"filters"===i?n+" ("+o+")":this.parent.dataSource.showAggregationOnValueField&&"values"===i&&"CalculatedField"!==r?this.parent.localeObj.getConstant(r)+" of "+n:n})},e.prototype.getTypeStatus=function(e,t,i){var a=this.parent.engineModule.fieldList[e[t].name];"CalculatedField"!==a.aggregateType&&"number"===a.type&&this.createSummaryType(i,e[t].name)},e.prototype.createSummaryType=function(e,t){var i=ej2Base.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false"},className:ICON+" e-dropdown-icon"});return"pivotview"===this.parent.getModuleName()&&(this.parent.groupingBarSettings.showValueTypeIcon?ej2Base.removeClass([i],"e-disable"):ej2Base.addClass([i],"e-disable")),e.appendChild(i),i},e.prototype.createMenuOption=function(e){this.menuOption.render(e,this.parentElement),this.parent.pivotButtonModule=this},e.prototype.createDraggable=function(e){this.draggable=new ej2Base.Draggable(e,{clone:!0,enableTailMode:!0,enableAutoScroll:!0,helper:this.createDragClone.bind(this),dragStart:this.onDragStart.bind(this),drag:this.onDragging.bind(this),dragStop:this.onDragStop.bind(this),abort:"pivotview"!==this.parent.getModuleName()||this.parent.groupingBarSettings.allowDragAndDrop?"":".e-pivot-button"})},e.prototype.createButtonDragIcon=function(e){var t=ej2Base.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false"}}),i=ej2Base.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false"},className:ICON+" e-drag"});return t.appendChild(i),e.appendChild(t),t},e.prototype.createSortOption=function(e,t){var i;if(this.parent.allowDeferLayoutUpdate){i="";for(var a=0;a<this.parent.dataSource.sortSettings.length;a++)this.parent.dataSource.sortSettings[a].name===t&&(i="Descending"===this.parent.dataSource.sortSettings[a].order?"e-descend":"")}else i="Descending"===this.parent.engineModule.fieldList[t].sort?"e-descend":"";var r=ej2Base.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false"},className:ICON+" e-sort "+i});return this.parent.dataSource.enableSorting?ej2Base.removeClass([r],"e-disable"):ej2Base.addClass([r],"e-disable"),"pivotview"===this.parent.getModuleName()&&(this.parent.groupingBarSettings.showSortIcon?ej2Base.removeClass([r],"e-disable"):ej2Base.addClass([r],"e-disable")),e.appendChild(r),r},e.prototype.createFilterOption=function(e,t){var i;if(this.parent.allowDeferLayoutUpdate){i="e-pv-filter";for(var a=0;a<this.parent.dataSource.filterSettings.length;a++)this.parent.dataSource.filterSettings[a].name===t&&(i="e-pv-filtered")}else i=0===this.parent.engineModule.fieldList[t].filter.length?this.parent.engineModule.fieldList[t].isExcelFilter?"e-pv-filtered":"e-pv-filter":"e-pv-filtered";var r=ej2Base.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false"},className:"e-btn-filter e-icons "+i});return"pivotview"===this.parent.getModuleName()&&(this.parent.groupingBarSettings.showFilterIcon?ej2Base.removeClass([r],"e-disable"):ej2Base.addClass([r],"e-disable")),e.appendChild(r),r},e.prototype.createDragClone=function(e){var t=ej2Base.closest(e.element,".e-pivot-button"),i=ej2Base.createElement("div",{id:this.parent.element.id+"_DragClone",className:"e-button-drag-clone"}),a=ej2Base.createElement("span",{className:"e-text-content",innerHTML:t.textContent});return i.appendChild(a),document.body.appendChild(i),i},e.prototype.onDragStart=function(e){this.parent.isDragging=!0;var t=ej2Base.closest(e.element,".e-pivot-button"),i=this.parent.engineModule.fieldList[t.getAttribute("data-uid")],a=["e-rows","e-columns","e-filters"];if(ej2Base.addClass([t],"e-list-selected"),i&&"CalculatedField"===i.aggregateType)for(var r=0,o=a;r<o.length;r++){var n=o[r];ej2Base.addClass([this.parentElement.querySelector("."+n)],"e-drag-restrict")}},e.prototype.onDragging=function(e){this.draggable.setProperties({cursorAt:{top:!ej2Base.isNullOrUndefined(e.event.targetTouches)||ej2Base.Browser.isDevice?60:-20}})},e.prototype.onDragStop=function(e){this.parent.isDragging=!1,e.target.classList&&(e.target.classList.contains("e-group-chart-values")||e.target.classList.contains("e-group-chart-values-drodown"))&&(e.target=this.parent.element.querySelector(".e-group-chart-rows"));var t=ej2Base.closest(e.element,".e-pivot-button");ej2Base.removeClass([].slice.call(this.parentElement.querySelectorAll(".e-pivot-button")),"e-list-selected"),ej2Base.removeClass([].slice.call(this.parentElement.querySelectorAll(".e-drop-indicator")),"e-drop-hover");for(var i=0,a=["e-rows","e-columns","e-filters"];i<a.length;i++){var r=a[i];ej2Base.removeClass([this.parentElement.querySelector("."+r)],"e-drag-restrict")}this.parent.pivotCommon.filterDialog.dialogPopUp&&this.parent.pivotCommon.filterDialog.dialogPopUp.close(),document.getElementById(this.parent.element.id+"_DragClone")&&ej2Base.remove(document.getElementById(this.parent.element.id+"_DragClone")),document.body.style.cursor="auto",this.isButtonDropped(e.target,t)&&(this.parent.pivotCommon.dataSourceUpdate.control="pivotview"===this.parent.getModuleName()?this.parent:this.parent.pivotGridModule?this.parent.pivotGridModule:this.parent,this.parent.pivotCommon.nodeStateModified.onStateModified(e,t.id)&&(this.updateDataSource(),this.parent.axisFieldModule.render()))},e.prototype.isButtonDropped=function(e,t){var i=ej2Base.closest(t,".e-droppable"),a=!0;if(i===ej2Base.closest(e,".e-droppable")){for(var r=[].slice.call(i.querySelectorAll(".e-pivot-button")),o=ej2Base.closest(e,".e-pvt-btn-div"),n=void 0,s=-1,l=0,d=r.length;l<d;l++)if(r[l].id===t.id&&(n=l),o){var p=o.querySelector(".e-pivot-button");r[l].id===p.id&&(s=l)}(n===s||n===r.length-1&&-1===s)&&(ej2Base.removeClass([].slice.call(this.parentElement.querySelectorAll(".e-drop-indicator")),"e-drop-hover"),a=!1)}return a},e.prototype.updateSorting=function(e){("pivotview"===this.parent.getModuleName()&&this.parent.enableValueSorting||"pivotfieldlist"===this.parent.getModuleName()&&void 0!==this.parent.pivotGridModule&&this.parent.pivotGridModule.enableValueSorting)&&"rows"===e.target.parentElement.parentElement.getAttribute("data-tag").split(":")[0]&&this.parent.setProperties({dataSource:{valueSortSettings:{headerText:""}}},!0),this.parent.pivotCommon.eventBase.updateSorting(e),this.updateDataSource(!0)},e.prototype.updateDataSource=function(e){this.parent.allowDeferLayoutUpdate&&"pivotview"!==this.parent.getModuleName()?"pivotfieldlist"===this.parent.getModuleName()&&"Popup"===this.parent.renderMode?(this.parent.pivotGridModule.engineModule=this.parent.engineModule,this.parent.pivotGridModule.notify(uiUpdate,this),this.parent.pivotGridModule.setProperties({dataSource:this.parent.dataSource.properties},!0)):this.parent.triggerPopulateEvent():this.parent.updateDataSource(e)},e.prototype.updateFiltering=function(e){this.parent.pivotCommon.eventBase.updateFiltering(e);var t=e.target;this.fieldName=t.parentElement.id,this.dialogPopUp=this.parent.pivotCommon.filterDialog.dialogPopUp,this.memberTreeView=this.parent.pivotCommon.filterDialog.memberTreeView,this.parent.pivotCommon.filterDialog.memberTreeView.nodeChecked=this.nodeStateModified.bind(this),this.parent.pivotCommon.filterDialog.allMemberSelect.nodeChecked=this.nodeStateModified.bind(this),this.bindDialogEvents()},e.prototype.bindDialogEvents=function(){this.parent.pivotCommon.filterDialog.allowExcelLikeFilter&&this.parent.pivotCommon.filterDialog.tabObj?(this.updateDialogButtonEvents(this.parent.pivotCommon.filterDialog.tabObj.selectedItem),this.dialogPopUp.buttons[1].click=this.ClearFilter.bind(this),this.parent.pivotCommon.filterDialog.tabObj.selected=this.tabSelect.bind(this)):this.updateDialogButtonEvents(0)},e.prototype.tabSelect=function(e){this.updateDialogButtonEvents(e.selectedIndex),ej2Base.removeClass([].slice.call(this.dialogPopUp.element.querySelectorAll(".e-selected-tab")),"e-selected-tab"),e.selectedIndex>0&&ej2Base.addClass([this.dialogPopUp.element.querySelector(".e-filter-div-content."+(1===e.selectedIndex&&this.parent.dataSource.allowLabelFilter?"e-label-filter":"e-value-filter"))],"e-selected-tab"),0===e.selectedIndex?this.parent.pivotCommon.filterDialog.updateCheckedState():(this.dialogPopUp.buttons[0].buttonModel.disabled=!1,this.dialogPopUp.element.querySelector(".e-ok-btn").removeAttribute("disabled"))},e.prototype.updateDialogButtonEvents=function(e){this.dialogPopUp.buttons[0].click=0===e?this.updateFilterState.bind(this,this.fieldName):this.updateCustomFilter.bind(this)},e.prototype.updateCustomFilter=function(e){var t=this.dialogPopUp.element.querySelector(".e-selected-tab"),i=t.getAttribute("data-fieldname"),a=t.getAttribute("data-type"),r=t.getAttribute("data-measure"),o=t.getAttribute("data-operator"),n=t.getAttribute("data-value1"),s=t.getAttribute("data-value2"),l="value"===a?"Value":"date"===a?"Date":"number"===a?"Number":"Label",d={name:i,type:l,measure:r,condition:o,value1:"date"===a?new Date(n):n,value2:"date"===a?new Date(s):s};if(ej2Base.isNullOrUndefined(n)||""===n||["Between","NotBetween"].indexOf(o)>-1&&(ej2Base.isNullOrUndefined(s)||""===s)){var p=l.toLowerCase()+(ej2Base.isNullOrUndefined(n)||""===n?"_input_option_1":"_input_option_2"),h=t.querySelector("#"+this.parent.element.id+"_"+p);return ej2Base.addClass([h],"e-empty-field"),void h.focus()}var c=this.parent.pivotCommon.eventBase.getFilterItemByName(i);c?((c=c.properties?c.properties:c).type=l,c.measure=r,c.condition=o,c.value1="date"===a?new Date(n):n,c.value2="date"===a?new Date(s):s):this.parent.dataSource.filterSettings.push(d),"Value"!==l&&(this.parent.lastFilterInfo=this.parent.pivotCommon.eventBase.getFilterItemByName(i)),this.dialogPopUp.close(),this.refreshPivotButtonState(i,!0),this.updateDataSource(!0)},e.prototype.ClearFilter=function(e){var t=this.dialogPopUp.element.getAttribute("data-fieldname");this.dialogPopUp.close(),this.removeDataSourceSettings(t),this.refreshPivotButtonState(t,!1),this.updateDataSource(!0)},e.prototype.removeButton=function(e){var t=e.target,i=t.parentElement.id;"true"===t.parentElement.getAttribute("isvalue")?this.parent.setProperties({dataSource:{values:[]}},!0):this.parent.pivotCommon.dataSourceUpdate.removeFieldFromReport(i),"pivotfieldlist"===this.parent.getModuleName()&&this.parent.axisFieldModule.render(),this.updateDataSource()},e.prototype.nodeStateModified=function(e){if("all"===e.node.parentElement.parentElement.getAttribute("data-uid"))this.memberTreeView.nodeChecked=null,"check"===e.action?this.memberTreeView.checkAll():this.memberTreeView.uncheckAll(),this.checkedStateAll(e.action),this.memberTreeView.nodeChecked=this.nodeStateModified.bind(this);else{var t=this.parent.pivotCommon.currentTreeItemsPos[e.data[0].id];"check"===e.action?this.parent.pivotCommon.currentTreeItems[t].checkedStatus=!0:this.parent.pivotCommon.currentTreeItems[t].checkedStatus=!1}this.parent.pivotCommon.filterDialog.updateCheckedState()},e.prototype.checkedStateAll=function(e){for(var t={},i=0,a=this.parent.pivotCommon.searchTreeItems;i<a.length;i++)(n=a[i]).checkedStatus="check"===e,t[n.id]=n.id;for(var r=0,o=this.parent.pivotCommon.currentTreeItems;r<o.length;r++){var n=o[r];void 0!==t[n.id]&&(n.checkedStatus="check"===e)}},e.prototype.updateFilterState=function(e,t){for(var i=!1,a={items:[],name:e,type:"Include"},r=0,o=this.parent.pivotCommon.searchTreeItems;r<o.length;r++){var n=o[r];n.checkedStatus&&(this.parent.pivotCommon.isDateField?a.items.push(n.name):a.items.push(n.id))}if(i=a.items.length!==this.parent.pivotCommon.currentTreeItems.length,this.parent.pivotCommon.eventBase.getFilterItemByName(e)){for(var s=0;s<this.parent.dataSource.filterSettings.length;s++)if(this.parent.dataSource.filterSettings[s].name===e){this.parent.dataSource.filterSettings.splice(s,1);break}this.parent.dataSource.filterSettings.push(a)}else this.parent.dataSource.filterSettings.push(a);this.dialogPopUp.close(),this.refreshPivotButtonState(e,i),i||this.removeDataSourceSettings(e),this.parent.lastFilterInfo=a,this.updateDataSource(!0),this.parent instanceof PivotFieldList&&this.axisField.render()},e.prototype.refreshPivotButtonState=function(e,t){for(var i,a=0,r=[].slice.call(this.parentElement.querySelectorAll(".e-pivot-button"));a<r.length;a++){var o=r[a];if(o.getAttribute("data-uid")===e){i=o.querySelector(".e-btn-filter");break}}t?(ej2Base.removeClass([i],"e-pv-filter"),ej2Base.addClass([i],"e-pv-filtered")):(ej2Base.removeClass([i],"e-pv-filtered"),ej2Base.addClass([i],"e-pv-filter"))},e.prototype.removeDataSourceSettings=function(e){for(var t=this.parent.dataSource.filterSettings,i=0,a=t.length;i<a;i++)if(t[i].name===e){t.splice(i,1);break}},e.prototype.updateDropIndicator=function(e){if(this.parent.isDragging){ej2Base.removeClass([].slice.call(this.parentElement.querySelectorAll(".e-drop-indicator-last")),"e-drop-hover"),ej2Base.removeClass([].slice.call(this.parentElement.querySelectorAll(".e-drop-indicator")),"e-drop-hover");var t=ej2Base.closest(e.target,".e-pvt-btn-div");ej2Base.addClass([t.querySelector(".e-drop-indicator")],"e-drop-hover")}},e.prototype.wireEvent=function(e,t){ej2Base.EventHandler.add(e,"mouseover",this.updateDropIndicator,this),-1===["filters","values"].indexOf(t)&&ej2Base.EventHandler.add(e.querySelector(".e-sort"),"click",this.updateSorting,this),"values"!==t&&ej2Base.EventHandler.add(e.querySelector(".e-btn-filter"),"click",this.updateFiltering,this),"values"===t&&null!==e.querySelector(".e-dropdown-icon")&&ej2Base.EventHandler.add(e.querySelector(".e-dropdown-icon"),"click",this.createMenuOption,this),ej2Base.EventHandler.add(e.querySelector(".e-remove"),"click",this.removeButton,this)},e.prototype.unWireEvent=function(e,t){ej2Base.EventHandler.remove(e,"mouseover",this.updateDropIndicator),-1===["filters","values"].indexOf(t)&&ej2Base.EventHandler.remove(e.querySelector(".e-sort"),"click",this.updateSorting),"values"!==t&&ej2Base.EventHandler.remove(e.querySelector(".e-btn-filter"),"click",this.updateFiltering),"values"===t&&null!==e.querySelector(".e-dropdown-icon")&&ej2Base.EventHandler.remove(e.querySelector(".e-dropdown-icon"),"click",this.createMenuOption),ej2Base.EventHandler.remove(e.querySelector(".e-remove"),"click",this.removeButton)},e.prototype.addEventListener=function(){this.handlers={load:this.renderPivotButton},this.parent.isDestroyed||this.parent.on("pivot-button-update",this.handlers.load,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("pivot-button-update",this.handlers.load)},e.prototype.destroy=function(){this.menuOption.destroy(),this.removeEventListener()},e.prototype.updateButtontext=function(e){var t,i=this.parent.engineModule.fieldList[e].filter.length,a=this.parent.engineModule.fieldList[e].filterType,r=this.parent.engineModule.fieldList[e].dateMember.length,o=this.parent.engineModule.fieldList[e].filter[0];if("include"===a)1===i?t=o:i>1&&(t=i===r?this.parent.localeObj.getConstant("all"):this.parent.localeObj.getConstant("multipleItems"));else if("exclude"===a){if(1===i)t=2===r?o!==this.parent.engineModule.fieldList[e].dateMember[0].actualText?o:this.parent.engineModule.fieldList[e].dateMember[0].actualText:this.parent.localeObj.getConstant("multipleItems");else if(i>1){var n=void 0,s=Object.keys(this.parent.engineModule.fieldList[e].members),l=this.parent.engineModule.fieldList[e].filter;if(i===s.length-1)e:for(n=0;n<s.length;n++){var d=s[n];if(-1===l.indexOf(d)){t=s[n];break e}}else t=this.parent.localeObj.getConstant("multipleItems")}}else t=this.parent.localeObj.getConstant("all");return t},e}(),AxisFieldRenderer=function(){function e(e){this.parent=e}return e.prototype.render=function(){this.pivotButton=new PivotButton(this.parent),this.createPivotButtons()},e.prototype.createPivotButtons=function(){var e=[this.parent.dataSource.rows,this.parent.dataSource.columns,this.parent.dataSource.values,this.parent.dataSource.filters],t=this.parent.dialogRenderer.parentElement;t.querySelector(".e-field-list-filters")&&(t.querySelector(".e-field-list-filters").querySelector(".e-axis-content").innerHTML=""),t.querySelector(".e-field-list-rows")&&(t.querySelector(".e-field-list-rows").querySelector(".e-axis-content").innerHTML=""),t.querySelector(".e-field-list-columns")&&(t.querySelector(".e-field-list-columns").querySelector(".e-axis-content").innerHTML=""),t.querySelector(".e-field-list-values")&&(t.querySelector(".e-field-list-values").querySelector(".e-axis-content").innerHTML="");for(var i=["rows","columns","values","filters"],a=0,r=e.length;a<r;a++)if(e[a]){var o={field:e[a],axis:i[a].toString()};this.parent.notify("pivot-button-update",o)}},e}(),Render$1=function(){function e(e){this.parent=e,this.parent.dialogRenderer=new DialogRenderer(this.parent),this.parent.treeViewModule=new TreeViewRenderer(this.parent),this.parent.axisTableModule=new AxisTableRenderer(this.parent),this.parent.axisFieldModule=new AxisFieldRenderer(this.parent)}return e.prototype.render=function(){this.parent.dialogRenderer.render(),this.parent.isAdaptive||this.parent.treeViewModule.render(),this.parent.axisTableModule.render()},e}(),__extends$4=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function a(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),__decorate$4=function(e,t,i,a){var r,o=arguments.length,n=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,a);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n},PivotFieldList=function(e){function t(t,i){var a=e.call(this,t,i)||this;return a.isRequiredUpdate=!0,a.lastSortInfo={},a.lastFilterInfo={},a.lastAggregationInfo={},a.lastCalcFieldInfo={},a.engineModule=new PivotEngine,a}return __extends$4(t,e),t.prototype.requiredModules=function(){var e=[];return this.allowCalculatedField&&e.push({args:[this],member:"calculatedfield"}),e},t.prototype.preRender=function(){this.isAdaptive=ej2Base.Browser.isDevice,this.globalize=new ej2Base.Internationalization(this.locale),this.renderModule=new Render$1(this),this.defaultLocale={staticFieldList:"Pivot Field List",fieldList:"Field List",dropFilterPrompt:"Drop filter here",dropColPrompt:"Drop column here",dropRowPrompt:"Drop row here",dropValPrompt:"Drop value here",addPrompt:"Add field here",adaptiveFieldHeader:"Choose field",centerHeader:"Drag fields between axes below:",add:"add",drag:"Drag",filter:"Filter",filtered:"Filtered",sort:"Sort",remove:"Remove",filters:"Filters",rows:"Rows",columns:"Columns",values:"Values",calculatedField:"Calculated Field",createCalculatedField:"Create Calculated Field",fieldName:"Enter the field name",error:"Error",invalidFormula:"Invalid formula.",dropText:'Example: ("Sum(Order_Count)" + "Sum(In_Stock)") * 250',dropTextMobile:"Add fields and edit formula here.",dropAction:"Calculated field cannot be place in any other region except value axis.",search:"Search",close:"Close",cancel:"Cancel",delete:"Delete",alert:"Alert",warning:"Warning",ok:"OK",sum:"Sum",average:"Average",count:"Count",min:"Min",max:"Max",allFields:"All Fields",formula:"Formula",fieldExist:"A field already exists in this name. Please enter a different name.",confirmText:"A calculation field already exists in this name. Do you want to replace it?",noMatches:"No matches",format:"Summaries values by",edit:"Edit",clear:"Clear",formulaField:"Drag and drop fields to formula",dragField:"Drag field to formula",clearFilter:"Clear",by:"by",enterValue:"Enter value",chooseDate:"Enter date",all:"All",multipleItems:"Multiple items",Equals:"Equals",DoesNotEquals:"Does Not Equal",BeginWith:"Begins With",DoesNotBeginWith:"Does Not Begin With",EndsWith:"Ends With",DoesNotEndsWith:"Does Not End With",Contains:"Contains",DoesNotContains:"Does Not Contain",GreaterThan:"Greater Than",GreaterThanOrEqualTo:"Greater Than Or Equal To",LessThan:"Less Than",LessThanOrEqualTo:"Less Than Or Equal To",Between:"Between",NotBetween:"Not Between",Before:"Before",BeforeOrEqualTo:"Before Or Equal To",After:"After",AfterOrEqualTo:"After Or Equal To",member:"Member",label:"Label",date:"Date",value:"Value",labelTextContent:"Show the items for which the label",dateTextContent:"Show the items for which the date",valueTextContent:"Show the items for which",And:"and",Sum:"Sum",Count:"Count",DistinctCount:"Distinct Count",Product:"Product",Avg:"Avg",Min:"Min",Max:"Max",Index:"Index",SampleStDev:"Sample StDev",PopulationStDev:"Population StDev",SampleVar:"Sample Var",PopulationVar:"Population Var",RunningTotals:"Running Totals",DifferenceFrom:"Difference From",PercentageOfDifferenceFrom:"% of Difference From",PercentageOfGrandTotal:"% of Grand Total",PercentageOfColumnTotal:"% of Column Total",PercentageOfRowTotal:"% of Row Total",PercentageOfParentTotal:"% of Parent Total",PercentageOfParentColumnTotal:"% of Parent Column Total",PercentageOfParentRowTotal:"% of Parent Row Total",Years:"Years",Quarters:"Quarters",Months:"Months",Days:"Days",Hours:"Hours",Minutes:"Minutes",Seconds:"Seconds",apply:"APPLY",valueFieldSettings:"Value field settings",sourceName:"Field name :",sourceCaption:"Field caption :",summarizeValuesBy:"Summarize values by :",baseField:"Base field :",baseItem:"Base item :",example:"e.g:",editorDataLimitMsg:" more items. Search to refine further.",deferLayoutUpdate:"Defer Layout Update"},this.localeObj=new ej2Base.L10n(this.getModuleName(),this.defaultLocale,this.locale),this.isDragging=!1,this.captionData=[],this.wireEvent()},t.prototype.frameCustomProperties=function(){var e=this.pivotGridModule?this.pivotGridModule.pageSettings:void 0,t=!this.pivotGridModule||(this.pivotGridModule.allowDrillThrough||this.pivotGridModule.editSettings.allowEditing);return{mode:"",savedFieldList:void 0,pageSettings:e,enableValueSorting:this.pivotGridModule?this.pivotGridModule.enableValueSorting:void 0,isDrillThrough:t,localeObj:this.localeObj}},t.prototype.render=function(){this.trigger("load",{dataSource:this.dataSource}),ej2Base.addClass([this.element],ROOT),this.enableRtl?ej2Base.addClass([this.element],RTL):ej2Base.removeClass([this.element],RTL),this.isAdaptive?ej2Base.addClass([this.element],DEVICE):ej2Base.removeClass([this.element],DEVICE),this.cssClass&&ej2Base.addClass([this.element],this.cssClass),this.notify("initial-load",{})},t.prototype.wireEvent=function(){this.on("initial-load",this.generateData,this),this.on(dataReady,this.fieldListRender,this)},t.prototype.unWireEvent=function(){this.pivotGridModule&&this.pivotGridModule.isDestroyed||(this.off("initial-load",this.generateData),this.off(dataReady,this.fieldListRender))},t.prototype.getPersistData=function(){var e=["dataSource"];return this.addOnPersist(e)},t.prototype.getModuleName=function(){return"pivotfieldlist"},t.prototype.onPropertyChanged=function(e,t){for(var i=!1,a=0,r=Object.keys(e);a<r.length;a++){switch(r[a]){case"locale":this.refresh();break;case"enableRtl":this.enableRtl?ej2Base.addClass([this.element],RTL):ej2Base.removeClass([this.element],RTL),i=!0}i&&this.fieldListRender()}},t.prototype.generateData=function(){if(this.pivotFieldList={},this.dataSource&&this.dataSource.data){if(this.trigger("enginePopulating",{dataSource:this.dataSource}),this.dataSource.groupSettings){var e=this.dataSource.data;this.clonedDataSet=this.clonedDataSet?this.clonedDataSet:PivotUtil.getClonedData(e),this.setProperties({dataSource:{data:[]}},!0),this.clonedReport=this.clonedReport?this.clonedReport:ej2Base.extend({},this.dataSource,null,!0),this.setProperties({dataSource:{data:e}},!0)}this.engineModule.renderEngine(this.dataSource,this.frameCustomProperties()),this.pivotFieldList=this.engineModule.fieldList;var t={pivotFieldList:this.pivotFieldList,pivotValues:this.engineModule.pivotValues};this.trigger("enginePopulated",t)}this.notify(dataReady,{}),this.trigger("dataBound")},t.prototype.fieldListRender=function(){this.element.innerHTML="","Popup"===this.renderMode&&this.dialogRenderer.fieldListDialog&&!this.dialogRenderer.fieldListDialog.isDestroyed&&(this.dialogRenderer.fieldListDialog.destroy(),ej2Base.remove(document.getElementById(this.element.id+"_Wrapper"))),this.renderModule.render(),this.fieldListSpinnerElement="Popup"===this.renderMode?this.dialogRenderer.fieldListDialog.element:this.element.querySelector(".e-pivotfieldlist-wrapper"),ej2Popups.createSpinner({target:this.fieldListSpinnerElement},this.createElement);var e={pivotEngine:this.engineModule,dataSource:this.dataSource,id:this.element.id,element:document.getElementById(this.element.id+"_Wrapper"),moduleName:this.getModuleName(),enableRtl:this.enableRtl,isAdaptive:this.isAdaptive,renderMode:this.renderMode,localeObj:this.localeObj};this.pivotCommon=new PivotCommon(e),this.pivotCommon.control=this,this.allowDeferLayoutUpdate&&(this.clonedDataSource=ej2Base.extend({},this.dataSource,null,!0),this.clonedFieldList=ej2Base.extend({},this.pivotFieldList,null,!0))},t.prototype.getFieldCaption=function(e){if(this.getFields(e),this.captionData.length>0)for(var t=this.captionData.length;t--;)if(this.captionData[t])for(var i=0,a=this.captionData[t];i<a.length;i++){var r=a[i];r&&(this.engineModule.fieldList[r.name]&&r.caption?this.engineModule.fieldList[r.name].caption=r.caption:this.engineModule.fieldList[r.name].caption=r.name)}},t.prototype.getFields=function(e){this.captionData=[e.rows,e.columns,e.values,e.filters]},t.prototype.updateDataSource=function(e,t){if(this.pivotGridModule&&ej2Popups.showSpinner(this.pivotGridModule.element),ej2Popups.showSpinner(this.fieldListSpinnerElement),ej2Base.isNullOrUndefined(t)){var i=this.pivotGridModule?this.pivotGridModule.pageSettings:void 0,a=this.frameCustomProperties();a.savedFieldList=this.pivotFieldList;var r=this.pivotGridModule?this.pivotGridModule.lastSortInfo:this.lastSortInfo;this.pivotGridModule&&(this.pivotGridModule.lastSortInfo={}),this.lastSortInfo={};var o=Object.keys(this.lastAggregationInfo).length>0,n=Object.keys(this.lastCalcFieldInfo).length>0,s=Object.keys(r).length>0,l=Object.keys(this.lastFilterInfo).length>0;i&&(s||l||o||n)?(s&&(this.pivotGridModule.setProperties({dataSource:{valueSortSettings:{headerText:""}}},!0),this.engineModule.onSort(r)),l&&(this.engineModule.onFilter(this.lastFilterInfo,this.dataSource),this.lastFilterInfo={}),o&&(this.engineModule.onAggregation(this.lastAggregationInfo),this.lastAggregationInfo={}),n&&(this.engineModule.onCalcOperation(this.lastCalcFieldInfo),this.lastCalcFieldInfo={})):this.engineModule.renderEngine(this.dataSource,a),this.getFieldCaption(this.dataSource)}else this.axisFieldModule.render(),this.isRequiredUpdate=!1;var d={dataSource:this.dataSource,pivotFieldList:this.pivotFieldList,pivotValues:this.engineModule.pivotValues};this.trigger("enginePopulated",d),this.pivotCommon.engineModule=this.engineModule,this.pivotCommon.dataSource=this.dataSource,this.pivotFieldList=this.engineModule.fieldList,e||!this.treeViewModule.fieldTable||this.isAdaptive||this.notify("tree-view-update",{}),this.isRequiredUpdate?(this.allowDeferLayoutUpdate&&(this.clonedDataSource=ej2Base.extend({},this.dataSource,null,!0),this.clonedFieldList=ej2Base.extend({},this.pivotFieldList,null,!0)),this.updateView(this.pivotGridModule)):"Popup"===this.renderMode&&this.allowDeferLayoutUpdate&&(this.pivotGridModule.engineModule=this.engineModule,this.pivotGridModule.setProperties({dataSource:this.dataSource.properties},!0),this.pivotGridModule.notify(uiUpdate,this),ej2Popups.hideSpinner(this.fieldListSpinnerElement)),this.isRequiredUpdate=!0,this.pivotGridModule?this.pivotGridModule.fieldListSpinnerElement=this.fieldListSpinnerElement:ej2Popups.hideSpinner(this.fieldListSpinnerElement)},t.prototype.update=function(e){e&&(this.clonedDataSet=e.clonedDataSet,this.setProperties({dataSource:e.dataSource},!0),this.engineModule=e.engineModule,this.pivotFieldList=e.engineModule.fieldList,"Popup"===this.renderMode&&(this.pivotGridModule=e),this.getFieldCaption(e.dataSource),this.pivotCommon.engineModule=this.engineModule,this.pivotCommon.dataSource=this.dataSource,this.pivotCommon.control=e,this.treeViewModule.fieldTable&&!this.isAdaptive&&this.notify("tree-view-update",{}),this.axisFieldModule.render(),"Fixed"===this.renderMode&&this.allowDeferLayoutUpdate&&(this.clonedDataSource=ej2Base.extend({},this.dataSource,null,!0),this.clonedFieldList=ej2Base.extend({},this.pivotFieldList,null,!0)))},t.prototype.updateView=function(e){e&&(e.clonedDataSet=this.clonedDataSet,e.setProperties({dataSource:this.dataSource},!0),e.engineModule=this.engineModule,e.pivotValues=this.engineModule.pivotValues,e.dataBind())},t.prototype.triggerPopulateEvent=function(){var e={dataSource:this.dataSource,pivotFieldList:this.pivotFieldList,pivotValues:this.engineModule.pivotValues};this.trigger("enginePopulated",e)},t.prototype.destroy=function(){this.unWireEvent(),this.treeViewModule&&this.treeViewModule.destroy(),this.pivotButtonModule&&this.pivotButtonModule.destroy(),this.allowDeferLayoutUpdate&&this.dialogRenderer&&this.dialogRenderer.deferUpdateCheckBox&&!this.dialogRenderer.deferUpdateCheckBox.isDestroyed&&this.dialogRenderer.deferUpdateCheckBox.destroy(),e.prototype.destroy.call(this),this.element.innerHTML="",ej2Base.removeClass([this.element],ROOT),ej2Base.removeClass([this.element],RTL),ej2Base.removeClass([this.element],DEVICE),"Popup"===this.renderMode&&(this.dialogRenderer.fieldListDialog&&!this.dialogRenderer.fieldListDialog.isDestroyed&&this.dialogRenderer.fieldListDialog.destroy(),document.getElementById(this.element.id+"_Wrapper")&&ej2Base.remove(document.getElementById(this.element.id+"_Wrapper")))},__decorate$4([ej2Base.Complex({},DataSource)],t.prototype,"dataSource",void 0),__decorate$4([ej2Base.Property("Popup")],t.prototype,"renderMode",void 0),__decorate$4([ej2Base.Property()],t.prototype,"target",void 0),__decorate$4([ej2Base.Property("")],t.prototype,"cssClass",void 0),__decorate$4([ej2Base.Property(!1)],t.prototype,"allowCalculatedField",void 0),__decorate$4([ej2Base.Property(!1)],t.prototype,"showValuesButton",void 0),__decorate$4([ej2Base.Property(!1)],t.prototype,"allowDeferLayoutUpdate",void 0),__decorate$4([ej2Base.Property(1e3)],t.prototype,"maxNodeLimitInMemberEditor",void 0),__decorate$4([ej2Base.Event()],t.prototype,"load",void 0),__decorate$4([ej2Base.Event()],t.prototype,"enginePopulating",void 0),__decorate$4([ej2Base.Event()],t.prototype,"enginePopulated",void 0),__decorate$4([ej2Base.Event()],t.prototype,"onFieldDropped",void 0),__decorate$4([ej2Base.Event()],t.prototype,"dataBound",void 0),__decorate$4([ej2Base.Event()],t.prototype,"created",void 0),__decorate$4([ej2Base.Event()],t.prototype,"destroyed",void 0),t=__decorate$4([ej2Base.NotifyPropertyChanges],t)}(ej2Base.Component),COUNT="Count",AVG="Avg",MIN="Min",MAX="Max",SUM="Sum",DISTINCTCOUNT="DistinctCount",PRODUCT="Product",STDEV="SampleStDev",STDEVP="PopulationStDev",VAR="SampleVar",VARP="PopulationVar",CALC="CalculatedField",AGRTYPE="AggregateType",CalculatedField=function(){function e(e){this.parent=e,this.existingReport=null,this.parent.calculatedFieldModule=this,this.removeEventListener(),this.addEventListener(),this.parentID=this.parent.element.id,this.dialog=null,this.inputObj=null,this.treeObj=null,this.droppable=null,this.menuObj=null,this.newFields=null,this.isFieldExist=!0,this.formulaText=null,this.fieldText=null,this.isEdit=!1,this.currentFieldName=null,this.confirmPopUp=null}return e.prototype.getModuleName=function(){return"calculatedfield"},e.prototype.keyActionHandler=function(e){var t=e.currentTarget.querySelector(".e-hover.e-node-focus");if(t)switch(e.action){case"moveRight":this.displayMenu(t.previousSibling);break;case"enter":var i=t.getAttribute("data-field"),a=t.getAttribute("data-type"),r=this.dialog.element.querySelector("#"+this.parentID+"droppable");""===r.value?r.value=a===CALC?t.getAttribute("data-uid"):'"'+a+"("+i+')"':""!==r.value&&(r.value=a===CALC?r.value+t.getAttribute("data-uid"):r.value+'"'+a+"("+i+')"')}},e.prototype.fieldClickHandler=function(e){var t=e.event.target.parentElement;(e.event.target.classList.contains(FORMAT)||e.event.target.classList.contains("e-edit")||e.event.target.classList.contains("e-edited"))&&this.displayMenu(t.parentElement)},e.prototype.displayMenu=function(e){null===document.querySelector("."+this.parentID+"calculatedmenu")||!e.querySelector(".e-list-icon").classList.contains(ICON)||e.querySelector(".e-list-icon").classList.contains("e-edited")||e.querySelector(".e-list-icon").classList.contains("e-edit")||"LI"!==e.tagName?e.querySelector(".e-list-icon").classList.contains("e-edit")&&"LI"===e.tagName?(ej2Base.addClass([e.querySelector(".e-list-icon")],"e-edited"),ej2Base.removeClass([e.querySelector(".e-list-icon")],"e-edit"),e.querySelector(".e-edited").setAttribute("title",this.parent.localeObj.getConstant("clear")),this.isEdit=!0,this.currentFieldName=e.getAttribute("data-field"),this.inputObj.value=e.getAttribute("data-caption"),this.dialog.element.querySelector("."+CALCINPUT).value=e.getAttribute("data-caption"),document.querySelector("#"+this.parentID+"droppable").value=e.getAttribute("data-uid")):e.querySelector(".e-list-icon").classList.contains("e-edited")&&"LI"===e.tagName&&(ej2Base.addClass([e.querySelector(".e-list-icon")],"e-edit"),ej2Base.removeClass([e.querySelector(".e-list-icon")],"e-edited"),e.querySelector(".e-edit").setAttribute("title",this.parent.localeObj.getConstant("edit")),this.isEdit=!1,this.inputObj.value="",this.dialog.element.querySelector("."+CALCINPUT).value="",document.querySelector("#"+this.parentID+"droppable").value=""):(this.menuObj.close(),this.curMenu=e.querySelector(".e-list-text"),this.openContextMenu())},e.prototype.openContextMenu=function(){var e=this.curMenu.getBoundingClientRect();this.parent.enableRtl?this.menuObj.open(e.top+30,e.left-100):this.menuObj.open(e.top+30,e.left+150)},e.prototype.selectContextMenu=function(e){if(null!==e.element.textContent){var t=ej2Base.closest(this.curMenu,".e-list-item").getAttribute("data-caption");ej2Base.closest(this.curMenu,".e-list-item").setAttribute("data-type",e.element.textContent),this.curMenu.textContent=t+" ("+e.element.textContent+")",ej2Base.addClass([this.curMenu.parentElement.parentElement],["e-node-focus","e-hover"]),this.curMenu.parentElement.parentElement.setAttribute("tabindex","-1"),this.curMenu.parentElement.parentElement.focus()}},e.prototype.createMenu=function(){var e=[{text:"Count"},{text:"Avg"},{text:"Min"},{text:"Max"},{text:"Sum"},{text:"DistinctCount"},{text:"Product"},{text:STDEV},{text:STDEVP},{text:VAR},{text:VARP}],t={cssClass:this.parentID+"calculatedmenu",items:e,enableRtl:this.parent.enableRtl,beforeOpen:this.beforeMenuOpen.bind(this),select:this.selectContextMenu.bind(this)},i=ej2Base.createElement("ul",{id:this.parentID+"contextmenu"});this.parent.element.appendChild(i),this.menuObj=new ej2Navigations.ContextMenu(t),this.menuObj.appendTo(i)},e.prototype.applyFormula=function(){var e=this,t=!1;if(ej2Base.removeClass([document.getElementById(this.parentID+"ddlelement")],"e-empty-field"),Object.keys(e.parent.engineModule.fieldList).forEach(function(i,a){e.inputObj.value&&e.inputObj.value===i&&"CalculatedField"!==e.parent.engineModule.fieldList[i].aggregateType&&(t=!0)}),t)return void e.parent.pivotCommon.errorDialog.createErrorDialog(e.parent.localeObj.getConstant("error"),e.parent.localeObj.getConstant("fieldExist"));this.newFields=ej2Base.extend([],this.parent.dataSource.calculatedFieldSettings,null,!0),this.existingReport=ej2Base.extend({},this.parent.dataSource,null,!0);var i=this.parent.dataSource,a=document.querySelector("#"+this.parentID+"droppable");if(null!==this.inputObj.value&&""!==this.inputObj.value&&""!==a.value){var r={name:this.inputObj.value,type:"CalculatedField"},o={name:this.inputObj.value,formula:a.value};if(this.isFieldExist=!0,this.isEdit){for(n=0;n<i.values.length;n++)if(i.values[n].type===CALC&&null!==this.currentFieldName&&i.values[n].name===this.currentFieldName&&this.isEdit)for(s=0;s<i.calculatedFieldSettings.length;s++)i.calculatedFieldSettings[s].name===this.currentFieldName&&(i.values[n].caption=this.inputObj.value,i.calculatedFieldSettings[s].formula=a.value,this.parent.engineModule.fieldList[this.currentFieldName].caption=this.inputObj.value,this.isFieldExist=!1)}else for(var n=0;n<i.values.length;n++)if(i.values[n].type===CALC&&i.values[n].name===r.name){for(var s=0;s<i.calculatedFieldSettings.length;s++)if(i.calculatedFieldSettings[s].name===r.name)return void this.createConfirmDialog(e.parent.localeObj.getConstant("alert"),e.parent.localeObj.getConstant("confirmText"));this.isFieldExist=!1}this.isFieldExist&&(i.values.push(r),i.calculatedFieldSettings.push(o)),this.parent.lastCalcFieldInfo=o,this.addFormula(i,r.name)}else null===this.inputObj.value||""===this.inputObj.value?(ej2Base.addClass([document.getElementById(this.parentID+"ddlelement")],"e-empty-field"),document.getElementById(this.parentID+"ddlelement").focus()):this.parent.pivotCommon.errorDialog.createErrorDialog(this.parent.localeObj.getConstant("error"),this.parent.localeObj.getConstant("invalidFormula"))},e.prototype.addFormula=function(e,t){try{this.parent.setProperties({dataSource:e},!0),"pivotfieldlist"===this.parent.getModuleName()&&this.parent.allowDeferLayoutUpdate&&(this.parent.isRequiredUpdate=!1),this.parent.updateDataSource(!1),this.isEdit=!1,this.dialog?this.dialog.close():(this.inputObj.value="",this.formulaText=null,this.fieldText=null,this.parent.dialogRenderer.parentElement.querySelector("."+CALCINPUT).value="",this.parent.dialogRenderer.parentElement.querySelector("#"+this.parentID+"droppable").value="")}catch(e){this.parent.engineModule.fieldList[t]&&delete this.parent.engineModule.fieldList[t],this.parent.pivotCommon.errorDialog.createErrorDialog(this.parent.localeObj.getConstant("error"),this.parent.localeObj.getConstant("invalidFormula")),this.parent.setProperties({dataSource:this.existingReport},!0),this.parent.lastCalcFieldInfo={},this.parent.updateDataSource(!1)}},e.prototype.getFieldListData=function(e){var t=[];return Object.keys(e.engineModule.fieldList).forEach(function(i){var a=null;a="string"===e.engineModule.fieldList[i].type||"include"===e.engineModule.fieldList[i].type||"exclude"===e.engineModule.fieldList[i].type?"Count":void 0!==e.engineModule.fieldList[i].aggregateType?e.engineModule.fieldList[i].aggregateType:"Sum",t.push({index:e.engineModule.fieldList[i].index,name:e.engineModule.fieldList[i].caption+" ("+a+")",type:a,icon:FORMAT+" "+ICON,formula:e.engineModule.fieldList[i].formula,field:i,caption:e.engineModule.fieldList[i].caption?e.engineModule.fieldList[i].caption:i})}),t},e.prototype.beforeMenuOpen=function(e){e.element.style.zIndex=(this.dialog.zIndex+1).toString(),e.element.style.display="inline"},e.prototype.fieldDropped=function(e){e.cancel=!0;var t=e.draggedNode.getAttribute("data-field"),i=e.draggedNode.getAttribute("data-type"),a=this.dialog.element.querySelector("#"+this.parentID+"droppable");if(e.target.id===this.parentID+"droppable"&&""===a.value)a.value=i===CALC?e.draggedNodeData.id.toString():'"'+i+"("+t+')"',a.focus();else if(e.target.id===this.parentID+"droppable"&&""!==a.value){var r=void 0,o=a.selectionStart,n=a.value,s=n.substring(0,o),l=n.substring(o,n.length);i===CALC?(r=s+e.draggedNodeData.id.toString(),a.value=s+e.draggedNodeData.id.toString()+l):(r=s+'"'+i+"("+t+')"',a.value=s+'"'+i+"("+t+')"'+l),a.focus(),a.setSelectionRange(r.length,r.length)}else e.cancel=!0},e.prototype.createDialog=function(){null!==document.querySelector("#"+this.parentID+"calculateddialog")&&ej2Base.remove(document.querySelector("#"+this.parentID+"calculateddialog")),this.parent.element.appendChild(ej2Base.createElement("div",{id:this.parentID+"calculateddialog",className:"e-pivot-calc-dialog-div"})),this.dialog=new ej2Popups.Dialog({allowDragging:!0,position:{X:"center",Y:"center"},buttons:[{click:this.applyFormula.bind(this),buttonModel:{content:this.parent.localeObj.getConstant("ok"),isPrimary:!0}},{click:this.cancelClick.bind(this),buttonModel:{content:this.parent.localeObj.getConstant("cancel")}}],close:this.closeDialog.bind(this),beforeOpen:this.beforeOpen.bind(this),animationSettings:{effect:"Zoom"},width:"25%",isModal:!1,closeOnEscape:!0,enableRtl:this.parent.enableRtl,showCloseIcon:!0,header:this.parent.localeObj.getConstant("createCalculatedField"),target:document.body}),this.dialog.appendTo("#"+this.parentID+"calculateddialog")},e.prototype.cancelClick=function(){this.dialog.close(),this.isEdit=!1},e.prototype.beforeOpen=function(e){this.dialog.element.querySelector(".e-dlg-header").setAttribute("title",this.parent.localeObj.getConstant("createCalculatedField"))},e.prototype.closeDialog=function(e){"pivotfieldlist"===this.parent.getModuleName()&&(this.parent.axisFieldModule.render(),"Fixed"!==this.parent.renderMode&&(ej2Base.addClass([this.parent.element.querySelector(".e-toggle-field-list")],"e-hide"),this.parent.dialogRenderer.fieldListDialog.show())),this.treeObj.destroy(),this.dialog.destroy(),this.newFields=null,ej2Base.remove(document.getElementById(this.parentID+"calculateddialog")),ej2Base.remove(document.querySelector("."+this.parentID+"calculatedmenu"))},e.prototype.renderDialogElements=function(){var e=ej2Base.createElement("div",{id:this.parentID+"outerDiv",className:"e-pivot-calc-outer-div"});if("pivotfieldlist"===this.parent.getModuleName()&&null!==this.parent.dialogRenderer.parentElement.querySelector("."+FORMULA)&&this.parent.isAdaptive){var t=ej2Base.createElement("div",{id:this.parentID+"accordDiv",className:"e-pivot-accord"});e.appendChild(t);var i=ej2Base.createElement("div",{id:this.parentID+"buttonDiv",className:"e-pivot-button-div"}),a=ej2Base.createElement("button",{id:this.parentID+"addBtn",innerHTML:this.parent.localeObj.getConstant("add"),className:"e-pivot-add-button"}),r=ej2Base.createElement("button",{id:this.parentID+"cancelBtn",innerHTML:this.parent.localeObj.getConstant("cancel"),className:"e-pivot-cancel-button"});i.appendChild(r),i.appendChild(a),e.appendChild(i)}else{var o=ej2Base.createElement("div",{id:this.parentID+"outerDiv",className:"e-pivot-calc-input-div"}),n=ej2Base.createElement("input",{id:this.parentID+"ddlelement",attrs:{type:"text",tabindex:"1"},className:CALCINPUT});if(o.appendChild(n),e.appendChild(o),!this.parent.isAdaptive){var s=ej2Base.createElement("div",{className:"e-pivot-all-field-title",innerHTML:this.parent.localeObj.getConstant("formulaField")});e.appendChild(s)}var l=ej2Base.createElement("div",{id:this.parentID+"control_wrapper",className:"e-pivot-treeview-outer"});if(l.appendChild(ej2Base.createElement("div",{id:this.parentID+"tree",className:"e-pivot-treeview"})),e.appendChild(l),!this.parent.isAdaptive){var d=ej2Base.createElement("div",{className:"e-pivot-formula-title",innerHTML:this.parent.localeObj.getConstant("formula")});e.appendChild(d)}var p=ej2Base.createElement("textarea",{id:this.parentID+"droppable",className:FORMULA,attrs:{placeholder:this.parent.isAdaptive?this.parent.localeObj.getConstant("dropTextMobile"):this.parent.localeObj.getConstant("dropText")}});if(e.appendChild(p),this.parent.isAdaptive){var i=ej2Base.createElement("div",{id:this.parentID+"buttonDiv",className:"e-pivot-button-div"}),h=ej2Base.createElement("button",{id:this.parentID+"okBtn",innerHTML:this.parent.localeObj.getConstant("apply"),className:"e-pivot-ok-button"});i.appendChild(h),e.appendChild(i)}}return e},e.prototype.renderAdaptiveLayout=function(){document.querySelector("#"+this.parentID+"droppable")&&(this.formulaText=document.querySelector("#"+this.parentID+"droppable").value,this.fieldText=this.inputObj.value),this.renderMobileLayout(this.parent.dialogRenderer.adaptiveElement)},e.prototype.createTreeView=function(){this.treeObj=new ej2Navigations.TreeView({fields:{dataSource:this.getFieldListData(this.parent),id:"formula",text:"name",iconCss:"icon"},allowDragAndDrop:!0,enableRtl:this.parent.enableRtl,nodeCollapsing:this.nodeCollapsing.bind(this),nodeDragStart:this.dragStart.bind(this),nodeClicked:this.fieldClickHandler.bind(this),nodeDragStop:this.fieldDropped.bind(this),drawNode:this.drawTreeNode.bind(this),sortOrder:"Ascending"}),this.treeObj.appendTo("#"+this.parentID+"tree")},e.prototype.nodeCollapsing=function(e){e.cancel=!0},e.prototype.dragStart=function(e){if(e.event.target.classList.contains("e-drag")){var t=document.querySelector(".e-drag-item.e-treeview");ej2Base.addClass([t],"e-pivot-calc"),t.style.zIndex=(this.dialog.zIndex+1).toString(),t.style.display="inline"}else e.cancel=!0},e.prototype.drawTreeNode=function(e){var t=e.nodeData.field;e.node.setAttribute("data-field",t),e.node.setAttribute("data-caption",e.nodeData.caption),e.node.setAttribute("data-type",e.nodeData.type);var i=ej2Base.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false",title:this.parent.localeObj.getConstant("dragField")},className:ICON+" e-drag"});ej2Base.prepend([i],e.node.querySelector(".e-text-content")),ej2Base.append([e.node.querySelector("."+FORMAT)],e.node.querySelector(".e-text-content")),"number"!==this.parent.engineModule.fieldList[t].type&&this.parent.engineModule.fieldList[t].aggregateType!==CALC?ej2Base.removeClass([e.node.querySelector("."+FORMAT)],ICON):e.node.querySelector("."+FORMAT).setAttribute("title",this.parent.localeObj.getConstant("format")),this.parent.engineModule.fieldList[t].aggregateType===CALC&&(e.node.querySelector("."+FORMAT).setAttribute("title",this.parent.localeObj.getConstant("edit")),ej2Base.addClass([e.node.querySelector("."+FORMAT)],"e-edit"),ej2Base.removeClass([e.node.querySelector("."+FORMAT)],FORMAT))},e.prototype.createTypeContainer=function(e){for(var t=ej2Base.createElement("div",{id:this.parentID+"control_wrapper",className:"e-pivot-treeview-outer"}),i=["Sum","Count","Avg","Min","Max","DistinctCount","Product",STDEV,STDEVP,VAR,VARP],a=0;a<i.length;a++){var r=ej2Base.createElement("input",{id:this.parentID+"radio"+e+i[a],attrs:{type:"radio","data-ftxt":e},className:"e-pivot-calc-radio"});t.appendChild(r)}return t},e.prototype.getAccordionData=function(e){var t=this,i=[];return Object.keys(e.engineModule.fieldList).forEach(function(a,r){i.push({header:"<input id="+t.parentID+"_"+r+' class=e-pivot-calc-check type="checkbox" data-field='+a+" data-caption="+t.parent.engineModule.fieldList[a].caption+" data-type="+t.parent.engineModule.fieldList[a].type+"/>",content:e.engineModule.fieldList[a].aggregateType===CALC||"number"!==t.parent.engineModule.fieldList[a].type?"":t.createTypeContainer(a).outerHTML})}),i},e.prototype.renderMobileLayout=function(e){e.items[4].content=this.renderDialogElements().outerHTML,e.dataBind();var t=new ej2Buttons.Button({cssClass:FLAT,isPrimary:!0});if(t.appendTo("#"+this.parentID+"cancelBtn"),t.element&&(t.element.onclick=this.cancelBtnClick.bind(this)),null!==this.parent.dialogRenderer.parentElement.querySelector("."+FORMULA)&&this.parent.isAdaptive){var i=new ej2Buttons.Button({cssClass:FLAT+" e-outline",isPrimary:!0});i.appendTo("#"+this.parentID+"okBtn"),this.inputObj=new ej2Inputs.MaskedTextBox({placeholder:this.parent.localeObj.getConstant("fieldName")}),this.inputObj.appendTo("#"+this.parentID+"ddlelement"),null!==this.formulaText&&null!==this.parent.dialogRenderer.parentElement.querySelector("#"+this.parentID+"droppable")&&(this.parent.dialogRenderer.parentElement.querySelector("#"+this.parentID+"droppable").value=this.formulaText),null!==this.fieldText&&null!==this.parent.dialogRenderer.parentElement.querySelector("."+CALCINPUT)&&(this.parent.dialogRenderer.parentElement.querySelector("."+CALCINPUT).value=this.fieldText,this.inputObj.value=this.fieldText),i.element&&(i.element.onclick=this.applyFormula.bind(this))}else if(this.parent.isAdaptive){var a=new ej2Navigations.Accordion({items:this.getAccordionData(this.parent),enableRtl:this.parent.enableRtl,expanding:this.accordionExpand.bind(this)}),r=new ej2Buttons.Button({cssClass:FLAT,isPrimary:!0});r.appendTo("#"+this.parentID+"addBtn"),a.appendTo("#"+this.parentID+"accordDiv"),Object.keys(this.parent.engineModule.fieldList).forEach(this.updateType.bind(this)),r.element&&(r.element.onclick=this.addBtnClick.bind(this))}},e.prototype.accordionExpand=function(e){var t=this;0===e.element.querySelectorAll(".e-radio-wrapper").length&&Object.keys(this.parent.engineModule.fieldList).forEach(function(i){var a=["Sum","Count","Avg","Min","Max","DistinctCount","Product",STDEV,STDEVP,VAR,VARP];if(i===e.element.querySelector("[data-field").getAttribute("data-field"))for(var r=0;r<a.length;r++)new ej2Buttons.RadioButton({label:a[r],name:"AggregateType"+i,change:t.onChange.bind(t)}).appendTo("#"+t.parentID+"radio"+i+a[r])})},e.prototype.onChange=function(e){var t=e.event.target.parentElement.querySelector(".e-label").innerText,i=e.event.target.closest(".e-acrdn-item").querySelector("[data-field").getAttribute("data-caption");e.event.target.closest(".e-acrdn-item").querySelector(".e-label").innerText=i+" ("+t+")",e.event.target.closest(".e-acrdn-item").querySelector("[data-type").setAttribute("data-type",t)},e.prototype.updateType=function(e,t){var i=null;i="string"===this.parent.engineModule.fieldList[e].type||"include"===this.parent.engineModule.fieldList[e].type||"exclude"===this.parent.engineModule.fieldList[e].type?"Count":void 0!==this.parent.engineModule.fieldList[e].aggregateType?this.parent.engineModule.fieldList[e].aggregateType:"Sum",new ej2Buttons.CheckBox({label:this.parent.engineModule.fieldList[e].caption+" ("+i+")"}).appendTo("#"+this.parentID+"_"+t),document.querySelector("#"+this.parentID+"_"+t).setAttribute("data-field",e),document.querySelector("#"+this.parentID+"_"+t).setAttribute("data-type",i)},e.prototype.cancelBtnClick=function(){this.renderMobileLayout(this.parent.dialogRenderer.adaptiveElement)},e.prototype.addBtnClick=function(){for(var e=document.querySelectorAll(".e-accordion .e-check"),t="",i=null,a=null,r=0;r<e.length;r++)if(i=e[r].parentElement.querySelector("[data-field]").getAttribute("data-field"),-1===(a=e[r].parentElement.querySelector("[data-field]").getAttribute("data-type")).indexOf(CALC))t=t+'"'+a+"("+i+')"';else for(var o=0;o<this.parent.dataSource.calculatedFieldSettings.length;o++)if(this.parent.dataSource.calculatedFieldSettings[o].name===i){t+=this.parent.dataSource.calculatedFieldSettings[o].formula;break}this.formulaText=null!==this.formulaText?this.formulaText+t:t,this.renderMobileLayout(this.parent.dialogRenderer.adaptiveElement)},e.prototype.createCalculatedFieldDialog=function(){this.parent.isAdaptive&&"pivotfieldlist"===this.parent.getModuleName()?this.renderAdaptiveLayout():this.parent.isAdaptive||(this.renderDialogLayout(),this.dialog.element.style.top=parseInt(this.dialog.element.style.top,10)<0?"0px":this.dialog.element.style.top)},e.prototype.renderDialogLayout=function(){this.newFields=ej2Base.extend([],this.parent.dataSource.calculatedFieldSettings,null,!0),this.createDialog(),this.dialog.content=this.renderDialogElements(),this.dialog.refresh(),this.inputObj=new ej2Inputs.MaskedTextBox({placeholder:this.parent.localeObj.getConstant("fieldName")}),this.inputObj.appendTo("#"+this.parentID+"ddlelement"),this.createTreeView(),this.createMenu(),this.droppable=new ej2Base.Droppable(this.dialog.element.querySelector("#"+this.parentID+"droppable")),this.keyboardEvents=new ej2Base.KeyboardEvents(this.parent.calculatedFieldModule.dialog.element,{keyAction:this.keyActionHandler.bind(this),keyConfigs:{moveRight:"rightarrow",enter:"enter"},eventName:"keydown"})},e.prototype.createConfirmDialog=function(e,t){var i=ej2Base.createElement("div",{id:this.parentID+"_ErrorDialog",className:"e-pivot-error-dialog"});this.parent.element.appendChild(i),this.confirmPopUp=new ej2Popups.Dialog({animationSettings:{effect:"Fade"},allowDragging:!1,showCloseIcon:!0,enableRtl:this.parent.enableRtl,width:"auto",height:"auto",position:{X:"center",Y:"center"},buttons:[{click:this.replaceFormula.bind(this),buttonModel:{cssClass:"e-ok-btn e-outline",content:this.parent.localeObj.getConstant("ok"),isPrimary:!0}},{click:this.removeErrorDialog.bind(this),buttonModel:{cssClass:"e-cancel-btn",content:this.parent.localeObj.getConstant("cancel"),isPrimary:!0}}],header:e,content:t,isModal:!0,visible:!0,closeOnEscape:!0,target:document.body,close:this.removeErrorDialog.bind(this)}),this.confirmPopUp.appendTo(i)},e.prototype.replaceFormula=function(){for(var e=this.parent.dataSource,t=document.querySelector("#"+this.parentID+"droppable"),i=0;i<e.values.length;i++)if(e.values[i].type===CALC&&e.values[i].name===this.inputObj.value)for(var a=0;a<e.calculatedFieldSettings.length;a++)e.calculatedFieldSettings[a].name===this.inputObj.value&&(e.calculatedFieldSettings[a].formula=t.value,this.parent.lastCalcFieldInfo=e.calculatedFieldSettings[a]);this.addFormula(e,this.inputObj.value),this.removeErrorDialog()},e.prototype.removeErrorDialog=function(){document.getElementById(this.parentID+"_ErrorDialog")&&ej2Base.remove(document.getElementById(this.parentID+"_ErrorDialog").parentElement)},e.prototype.addEventListener=function(){this.parent.isDestroyed||this.parent.on("init-calculatedfield",this.createCalculatedFieldDialog,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("init-calculatedfield",this.createCalculatedFieldDialog)},e.prototype.destroy=function(){this.removeEventListener()},e}();PivotFieldList.Inject(CalculatedField);var FieldList=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.getModuleName=function(){return"fieldlist"},e.prototype.initiateModule=function(){this.element=ej2Base.createElement("div",{id:this.parent.element.id+"_PivotFieldList",styles:"position:"+(this.parent.enableRtl?"static":"absolute")+";height:0;width:"+this.parent.element.style.width}),this.parent.element.parentElement.setAttribute("id","ContainerWrapper"),this.parent.element.parentElement.appendChild(this.element),this.parent.element.parentElement.appendChild(this.parent.element),this.parent.pivotFieldListModule=new PivotFieldList({dataSource:{rows:[],columns:[],values:[],filters:[]},allowDeferLayoutUpdate:this.parent.allowDeferLayoutUpdate,renderMode:"Popup",allowCalculatedField:this.parent.allowCalculatedField,enableRtl:this.parent.enableRtl,locale:this.parent.locale,target:this.parent.element.parentElement}),this.parent.pivotFieldListModule.appendTo("#"+this.element.id)},e.prototype.updateControl=function(){this.element&&(ej2Base.prepend([this.element],this.parent.element),this.parent.showGroupingBar&&this.parent.groupingBarModule?(clearTimeout(this.timeOutObj),this.timeOutObj=setTimeout(this.update.bind(this))):this.parent.enableRtl?ej2Base.removeClass([this.element.querySelector(".e-toggle-field-list")],"e-fieldlist-left"):ej2Base.addClass([this.element.querySelector(".e-toggle-field-list")],"e-fieldlist-left"),ej2Base.setStyleAttribute(this.element,{width:ej2Base.formatUnit(this.parent.element.offsetWidth)})),this.parent.pivotFieldListModule.update(this.parent)},e.prototype.update=function(){var e;if(e="Table"!==this.parent.currentView?this.parent.chart?this.parent.chartModule.calculatedWidth:e:this.parent.grid?this.parent.grid.element.offsetWidth:e){var t=e<400?400:e;ej2Base.setStyleAttribute(this.element.querySelector(".e-toggle-field-list"),{left:ej2Base.formatUnit(this.parent.enableRtl?-Math.abs(t-this.element.querySelector(".e-toggle-field-list").offsetWidth):t-this.element.querySelector(".e-toggle-field-list").offsetWidth)}),this.parent.enableRtl?ej2Base.addClass([this.element.querySelector(".e-toggle-field-list")],"e-fieldlist-left"):ej2Base.removeClass([this.element.querySelector(".e-toggle-field-list")],"e-fieldlist-left")}},e.prototype.addEventListener=function(){this.handlers={load:this.initiateModule,update:this.updateControl},this.parent.isDestroyed||(this.parent.on("init-groupingbar",this.handlers.load,this),this.parent.on(uiUpdate,this.handlers.update,this))},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("init-groupingbar",this.handlers.load),this.parent.off(uiUpdate,this.handlers.update))},e.prototype.destroy=function(){this.removeEventListener(),this.parent.pivotFieldListModule&&this.parent.pivotFieldListModule.destroy()},e}(),Common=function(){function e(e){this.parent=e,this.parent.commonModule=this,this.addEventListener()}return e.prototype.getModuleName=function(){return"common"},e.prototype.initiateCommonModule=function(){if(this.parent.pivotCommon)this.parent.pivotCommon.element=this.parent.element,this.parent.pivotCommon.engineModule=this.parent.engineModule,this.parent.pivotCommon.parentID=this.parent.element.id,this.parent.pivotCommon.dataSource=this.parent.dataSource.properties?this.parent.dataSource.properties:this.parent.dataSource,this.parent.pivotCommon.moduleName=this.parent.getModuleName(),this.parent.pivotCommon.enableRtl=this.parent.enableRtl,this.parent.pivotCommon.isAdaptive=ej2Base.Browser.isDevice,this.parent.pivotCommon.renderMode="Popup",this.parent.pivotCommon.localeObj=this.parent.localeObj;else{var e={pivotEngine:this.parent.engineModule,dataSource:this.parent.dataSource.properties?this.parent.dataSource.properties:this.parent.dataSource,id:this.parent.element.id,element:this.parent.element,moduleName:this.parent.getModuleName(),enableRtl:this.parent.enableRtl,isAdaptive:ej2Base.Browser.isDevice,renderMode:"Popup",localeObj:this.parent.localeObj};this.parent.pivotCommon=new PivotCommon(e)}this.parent.pivotCommon.control=this.parent},e.prototype.addEventListener=function(){this.handlers={load:this.initiateCommonModule},this.parent.isDestroyed||(this.parent.gridSettings.contextMenuItems&&(this.parent.showFieldList&&this.parent.showGroupingBar||this.parent.on("initial-load",this.handlers.load,this)),this.parent.on(uiUpdate,this.handlers.load,this))},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(uiUpdate,this.handlers.load)},e.prototype.destroy=function(){this.removeEventListener(),this.parent.pivotCommon&&this.parent.pivotCommon.destroy()},e}(),AxisFields=function(){function e(e){this.parent=e}return e.prototype.render=function(){this.pivotButton=new PivotButton(this.parent),this.createPivotButtons();for(var e=[],t=0,i=this.parent.element.querySelectorAll(".e-group-rows");t<i.length;t++){var a=i[t];a.classList.contains("e-group-chart-rows")||(e=e.concat([].slice.call(a.querySelectorAll(".e-pvt-btn-div"))))}for(var r=e.length,o=0;o<r;o++){var n=ej2Base.createElement("span",{className:"e-indent-div",styles:"width:"+24*o+"px"});ej2Base.prepend([n],e[o])}},e.prototype.createPivotButtons=function(){for(var e=[this.parent.dataSource.rows,this.parent.dataSource.columns,this.parent.dataSource.values,this.parent.dataSource.filters],t=0,i=this.parent.element.querySelectorAll(".e-group-rows,.e-group-columns,.e-group-values,.e-group-filters");t<i.length;t++){var a=i[t];this.parent.dataSource.values.length>0&&a.classList.contains("e-group-chart-values")||(a.innerHTML="")}for(var r=["rows","columns","values","filters"],o=0,n=e.length;o<n;o++)if(e[o]){var s={field:e[o],axis:r[o].toString()};this.parent.notify("pivot-button-update",s)}},e}();PivotView.Inject(Common);var GroupingBar=function(){function e(e){this.parent=e,this.parent.groupingBarModule=this,this.resColWidth=this.parent.isAdaptive?180:249,this.addEventListener(),this.parent.axisFieldModule=new AxisFields(this.parent),this.touchObj=new ej2Base.Touch(this.parent.element,{tapHold:this.tapHoldHandler.bind(this)})}return e.prototype.getModuleName=function(){return"grouping"},e.prototype.renderLayout=function(){this.groupingTable=ej2Base.createElement("div",{className:"e-grouping-bar"}),this.leftAxisPanel=ej2Base.createElement("div",{className:"e-left-axis-fields"}),this.rightAxisPanel=ej2Base.createElement("div",{className:"e-right-axis-fields"});var e=ej2Base.createElement("div",{className:"e-axis-row e-axiswrapper"}),t=ej2Base.createElement("div",{className:"e-axis-column e-axiswrapper"}),i=ej2Base.createElement("div",{className:"e-axis-value e-axiswrapper"}),a=ej2Base.createElement("div",{className:"e-axis-filter e-axiswrapper"});this.rowPanel=ej2Base.createElement("div",{className:"e-group-rows e-rows"}),this.columnPanel=ej2Base.createElement("div",{className:"e-group-columns e-columns"}),this.valuePanel=ej2Base.createElement("div",{className:"e-group-values e-values"}),this.filterPanel=ej2Base.createElement("div",{className:"e-group-filters e-filters"}),e.appendChild(this.rowPanel),t.appendChild(this.columnPanel),i.appendChild(this.valuePanel),a.appendChild(this.filterPanel),this.rowAxisPanel=e,this.columnAxisPanel=t,this.valueAxisPanel=i,this.filterAxisPanel=a,this.leftAxisPanel.appendChild(i),this.leftAxisPanel.appendChild(e),this.rightAxisPanel.appendChild(a),this.rightAxisPanel.appendChild(t),this.groupingTable.appendChild(this.leftAxisPanel),this.groupingTable.appendChild(this.rightAxisPanel);for(var r=0,o=[this.rowPanel,this.columnPanel,this.valuePanel,this.filterPanel];r<o.length;r++){var n=o[r];this.parent.groupingBarSettings.allowDragAndDrop&&new ej2Base.Droppable(n,{}),this.unWireEvent(n),this.wireEvent(n)}"Table"!==this.parent.displayOption.view&&"Table"!==this.parent.groupingBarSettings.displayMode?(this.groupingChartTable=this.groupingTable.cloneNode(!0),this.groupingChartTable.classList.add("e-chart-grouping-bar"),this.groupingChartTable.querySelector(".e-group-rows").classList.add("e-group-chart-rows"),this.groupingChartTable.querySelector(".e-group-columns").classList.add("e-group-chart-columns"),this.parent.chartSettings.enableMultiAxis?this.groupingChartTable.querySelector(".e-group-values").classList.add("e-group-chart-multi-values"):(this.groupingChartTable.querySelector(".e-group-values").classList.add("e-group-chart-values"),this.groupingChartTable.querySelector(".e-group-values").classList.remove("e-droppable")),this.groupingChartTable.querySelector(".e-group-filters").classList.add("e-group-chart-filters")):this.groupingChartTable=void 0,"Chart"!==this.parent.displayOption.view&&"Chart"!==this.parent.groupingBarSettings.displayMode||(this.groupingTable=void 0)},e.prototype.appendToElement=function(){if(this.parent.element.querySelector(".e-grouping-bar"))for(var e=0,t=this.parent.element.querySelectorAll(".e-grouping-bar");e<t.length;e++){h=t[e];ej2Base.remove(h)}if(this.groupingChartTable&&(this.parent.element.querySelector("#"+this.parent.element.id+"_chart")?(ej2Base.setStyleAttribute(this.groupingChartTable,{width:ej2Base.formatUnit(this.parent.chart.width)}),this.parent.element.insertBefore(this.groupingChartTable,this.parent.element.querySelector("#"+this.parent.element.id+"_chart"))):this.groupingChartTable=void 0),"Chart"!==this.parent.displayOption.view&&this.groupingTable){if(this.parent.isAdaptive&&(this.leftAxisPanel.style.minWidth="180px",this.valuePanel.style.minWidth="180px"),this.parent.firstColWidth&&(this.leftAxisPanel.style.minWidth="auto",this.valuePanel.style.minWidth="auto"),this.filterPanel.removeAttribute("style"),this.columnPanel.removeAttribute("style"),this.rowPanel.removeAttribute("style"),this.filterPanel.removeAttribute("style"),Object.keys(this.parent.engineModule.headerContent).length){var i=this.parent.element.querySelector(".e-frozenheader").querySelector(".e-columnheader");ej2Base.addClass([i],"e-row"),i.removeAttribute("style"),ej2Base.addClass([i.querySelector(".e-headercell")],"e-group-row"),i.querySelector(".e-group-row").appendChild(this.rowAxisPanel),i.querySelector(".e-group-row").querySelector(".e-headercelldiv").style.display="none",i.querySelector(".e-group-row").querySelector(".e-sortfilterdiv").style.display="none"}this.parent.element.insertBefore(this.groupingTable,this.parent.element.querySelector(".e-grid")),ej2Base.setStyleAttribute(this.groupingTable,{width:ej2Base.formatUnit(this.parent.grid.width)}),this.groupingTable.style.minWidth="400px",this.parent.axisFieldModule.render(),this.setGridRowWidth();var a=this.parent.element.querySelector(".e-frozenheader").querySelector("colgroup").children[0],r=ej2Base.formatUnit(this.groupingTable.offsetWidth-parseInt(a.style.width,10));ej2Base.setStyleAttribute(this.valuePanel,{width:a.style.width}),ej2Base.setStyleAttribute(this.rightAxisPanel,{width:r});var o=this.valuePanel.offsetHeight/2;o>this.columnPanel.offsetHeight&&(ej2Base.setStyleAttribute(this.filterPanel,{height:ej2Base.formatUnit(o)}),ej2Base.setStyleAttribute(this.columnPanel,{height:ej2Base.formatUnit(o+1)}));var n=this.parent.element.querySelector(".e-headercontent").offsetHeight;ej2Base.setStyleAttribute(this.rowPanel,{height:n+"px"}),this.parent.element.querySelector(".e-frozenheader").querySelector(".e-rhandler")&&(this.parent.element.querySelector(".e-frozenheader").querySelector(".e-rhandler").style.height=n+"px");for(var s=[].slice.call(this.parent.element.querySelector(".e-movableheader").querySelector("thead").querySelectorAll("tr")).filter(function(e){return e.childNodes.length>0}),l=n/s.length,d=0,p=s;d<p.length;d++){var h=p[d];ej2Base.setStyleAttribute(h,{height:l+"px"});for(var c=0,u=[].slice.call(h.querySelectorAll(".e-rhandler"));c<u.length;c++){var g=u[c];ej2Base.setStyleAttribute(g,{height:l+"px"})}}}else this.parent.axisFieldModule.render()},e.prototype.refreshUI=function(){ej2Base.setStyleAttribute(this.groupingTable,{width:ej2Base.formatUnit(this.parent.grid.width)}),this.groupingTable.style.minWidth="400px";var e=this.parent.element.querySelector(".e-frozenheader").querySelector("colgroup").children[0],t=ej2Base.formatUnit(this.groupingTable.offsetWidth-parseInt(e.style.width,10));if(ej2Base.setStyleAttribute(this.valuePanel,{width:e.style.width}),ej2Base.setStyleAttribute(this.rightAxisPanel,{width:t}),this.parent.showFieldList&&this.parent.pivotFieldListModule&&this.parent.pivotFieldListModule.element&&(clearTimeout(this.timeOutObj),this.timeOutObj=setTimeout(this.alignIcon.bind(this))),!this.parent.grid.element.querySelector(".e-group-row")){var i=this.parent.element.querySelector(".e-frozenheader").querySelector(".e-columnheader");ej2Base.addClass([i],"e-row"),ej2Base.addClass([i.querySelector(".e-headercell")],"e-group-row"),i.querySelector(".e-group-row").appendChild(this.rowAxisPanel),ej2Base.setStyleAttribute(i.querySelector(".e-group-row").querySelector(".e-headercelldiv"),{display:"none"}),ej2Base.setStyleAttribute(i.querySelector(".e-group-row").querySelector(".e-sortfilterdiv"),{display:"none"});var a=this.parent.element.querySelector(".e-headercontent").offsetHeight;ej2Base.setStyleAttribute(this.rowPanel,{height:a+"px"}),this.parent.element.querySelector(".e-frozenheader").querySelector(".e-rhandler")&&(this.parent.element.querySelector(".e-frozenheader").querySelector(".e-rhandler").style.height=a+"px");for(var r=[].slice.call(this.parent.element.querySelector(".e-movableheader").querySelector("thead").querySelectorAll("tr")).filter(function(e){return e.childNodes.length>0}),o=a/r.length,n=0,s=r;n<s.length;n++){var l=s[n];ej2Base.setStyleAttribute(l,{height:o+"px"});for(var d=0,p=[].slice.call(l.querySelectorAll(".e-rhandler"));d<p.length;d++){var h=p[d];ej2Base.setStyleAttribute(h,{height:o+"px"})}}}},e.prototype.alignIcon=function(){var e,t=this.parent.pivotFieldListModule.element;if(e="Table"===this.parent.currentView?this.parent.grid?this.parent.grid.element.offsetWidth:e:this.parent.chart?this.parent.chartModule.calculatedWidth:e){var i=e<400?400:e;ej2Base.setStyleAttribute(t.querySelector(".e-toggle-field-list"),{left:ej2Base.formatUnit(this.parent.enableRtl?-Math.abs(i-t.querySelector(".e-toggle-field-list").offsetWidth):i-t.querySelector(".e-toggle-field-list").offsetWidth)})}},e.prototype.setGridRowWidth=function(){var e=this.parent.element.querySelector(".e-frozenheader").querySelector("colgroup").children[0];if(this.rowPanel.querySelector(".e-pivot-button"))if(this.parent.isAdaptive){if(!this.parent.firstColWidth){var t=this.parent.grid.columns;t&&t.length>0&&(t[0].width=this.resColWidth),this.parent.posCount=0,this.parent.grid.headerModule.refreshUI()}}else{var i=[].slice.call(this.rowPanel.querySelectorAll(".e-pvt-btn-div")),a=i[i.length-1],r=a.querySelector(".e-pivot-button").offsetWidth+a.querySelector(".e-indent-div").offsetWidth+20,o=ej2Base.formatUnit(r<this.resColWidth?this.resColWidth:r),n=this.parent.element.querySelector(".e-frozenheader").querySelector("table"),s=this.parent.element.querySelector(".e-frozencontent").querySelector("table"),l=this.parent.element.querySelector(".e-frozencontent").querySelector("colgroup").children[0],d=parseInt(o,10);(t=this.parent.grid.columns)&&t.length>0&&(t[0].width=(t[0].width,this.resColWidth,d>this.resColWidth?d:this.resColWidth));for(var p=this.parent.renderModule.calculateColWidth(this.parent.dataSource.values.length>0?this.parent.engineModule.pivotValues[0].length:2),h=0;h<t.length;h++)0!==h&&(t[h].columns?this.setColWidth(t[h].columns,p):t[h].width=p);this.parent.posCount=0,this.parent.setGridColumns(this.parent.grid.columns),this.parent.grid.headerModule.refreshUI(),this.parent.firstColWidth||(e.style.width=o,l.style.width=o,n.style.width=o,s.style.width=o,ej2Base.setStyleAttribute(n,{width:o}),ej2Base.setStyleAttribute(s,{width:o}))}else this.parent.grid.columns&&this.parent.grid.columns.length>0&&(this.parent.grid.columns[0].width=this.parent.grid.columns[0].width>this.resColWidth?this.parent.grid.columns[0].width:this.resColWidth),this.parent.grid.headerModule.refreshUI();this.groupingTable&&this.refreshUI()},e.prototype.setColWidth=function(e,t){for(var i=0;i<e.length;i++)e[i].columns?this.setColWidth(e[i].columns,t):e[i].width=t},e.prototype.wireEvent=function(e){ej2Base.EventHandler.add(e,"mouseover",this.dropIndicatorUpdate,this),ej2Base.EventHandler.add(e,"mouseleave",this.dropIndicatorUpdate,this)},e.prototype.unWireEvent=function(e){ej2Base.EventHandler.remove(e,"mouseover",this.dropIndicatorUpdate),ej2Base.EventHandler.remove(e,"mouseleave",this.dropIndicatorUpdate)},e.prototype.dropIndicatorUpdate=function(e){(this.parent.isDragging&&e.target.classList.contains("e-droppable")&&"mouseover"===e.type||"mouseleave"===e.type)&&(ej2Base.removeClass([].slice.call(this.parent.element.querySelectorAll(".e-drop-indicator")),"e-drop-hover"),ej2Base.removeClass([].slice.call(this.parent.element.querySelectorAll(".e-drop-indicator-last")),"e-drop-hover"))},e.prototype.tapHoldHandler=function(e){var t=ej2Base.closest(e.originalEvent.target,".e-pivot-button");if(!ej2Base.isNullOrUndefined(t)&&this.parent.isAdaptive){var i=t.getBoundingClientRect();return this.parent.contextMenuModule.fieldElement=t,void this.parent.contextMenuModule.menuObj.open(i.top,i.left)}},e.prototype.addEventListener=function(){this.handlers={load:this.renderLayout,end:this.appendToElement},this.parent.isDestroyed||(this.parent.on("init-groupingbar",this.handlers.load,this),this.parent.on(uiUpdate,this.handlers.end,this))},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("init-groupingbar",this.handlers.end),this.parent.off(uiUpdate,this.handlers.load))},e.prototype.destroy=function(){this.removeEventListener(),this.parent.pivotButtonModule&&(this.parent.pivotButtonModule.destroy(),this.touchObj&&!this.touchObj.isDestroyed&&this.touchObj.destroy())},e}(),ConditionalFormatting=function(){function e(e){this.parent=e,this.parent.conditionalFormattingModule=this,this.parentID=this.parent.element.id,this.dialog=null,this.fieldsDropDown=[],this.conditionsDropDown=[],this.fontNameDropDown=[],this.fontSizeDropDown=[],this.fontColor=[],this.backgroundColor=[],this.newFormat=[]}return e.prototype.getModuleName=function(){return"conditionalformatting"},e.prototype.createDialog=function(){null!==document.querySelector("#"+this.parentID+"conditionalformatting")&&ej2Base.remove(document.querySelector("#"+this.parentID+"conditionalformatting")),this.parent.element.appendChild(ej2Base.createElement("div",{id:this.parentID+"conditionalformatting"}));var e=[{click:this.addButtonClick.bind(this),buttonModel:{cssClass:this.parent.isAdaptive?"e-small e-round e-format-condition-button":"e-format-condition-button",iconCss:ICON+" e-add-icon",content:this.parent.isAdaptive?"":this.parent.localeObj.getConstant("condition")}},{click:this.applyButtonClick.bind(this),buttonModel:{cssClass:"e-flat e-primary e-format-apply-button",content:this.parent.localeObj.getConstant("apply")}},{click:this.cancelButtonClick.bind(this),buttonModel:{cssClass:"e-flat e-primary e-format-cancel-button",content:this.parent.localeObj.getConstant("cancel")}}];this.parent.isAdaptive?this.dialog=new ej2Popups.Dialog({animationSettings:{effect:"Zoom"},isModal:!0,width:"100%",height:"100%",showCloseIcon:!1,closeOnEscape:!1,enableRtl:this.parent.enableRtl,position:{X:"center",Y:"center"},allowDragging:!0,buttons:e,beforeOpen:this.beforeOpen.bind(this),cssClass:"e-pivot-formatting-dialog",header:this.parent.localeObj.getConstant("conditionalFormating"),target:document.body}):this.dialog=new ej2Popups.Dialog({allowDragging:!0,position:{X:"center",Y:this.parent.element.offsetTop},buttons:e,beforeOpen:this.beforeOpen.bind(this),cssClass:"e-pivot-formatting-dialog",isModal:!1,closeOnEscape:!0,enableRtl:this.parent.enableRtl,showCloseIcon:!0,header:this.parent.localeObj.getConstant("conditionalFormating"),target:this.parent.element}),this.dialog.appendTo("#"+this.parentID+"conditionalformatting")},e.prototype.beforeOpen=function(e){this.dialog.element.querySelector(".e-dlg-header").setAttribute("title",this.parent.localeObj.getConstant("conditionalFormating"))},e.prototype.addButtonClick=function(){var e={conditions:"LessThan",value1:0,style:{backgroundColor:"white",color:"black",fontFamily:"Arial",fontSize:"12px"}};this.refreshConditionValues(),this.newFormat.push(e),this.addFormat()},e.prototype.applyButtonClick=function(){this.refreshConditionValues()&&(this.parent.setProperties({dataSource:{conditionalFormatSettings:this.newFormat}},!0),this.parent.renderPivotGrid(),this.destroy())},e.prototype.cancelButtonClick=function(){this.destroy(),this.newFormat=[]},e.prototype.refreshConditionValues=function(){for(var e=0;e<this.newFormat.length;e++){if(""===document.querySelector("#"+this.parentID+"conditionvalue1"+e).value||""===document.querySelector("#"+this.parentID+"conditionvalue2"+e).value)return""===document.querySelector("#"+this.parentID+"conditionvalue1"+e).value?document.querySelector("#"+this.parentID+"conditionvalue1"+e).focus():document.querySelector("#"+this.parentID+"conditionvalue2"+e).focus(),!1;this.newFormat[e].value1=Number(document.querySelector("#"+this.parentID+"conditionvalue1"+e).value),this.newFormat[e].value2=Number(document.querySelector("#"+this.parentID+"conditionvalue2"+e).value)}return!0},e.prototype.addFormat=function(){for(var e=ej2Base.createElement("div",{id:this.parentID+"formatDiv",className:"e-new-format"}),t=0;t<this.newFormat.length;t++)e.appendChild(this.createDialogElements(t));if(0===this.newFormat.length){var i=this.createDialogElements(),a=ej2Base.createElement("p",{id:this.parentID+"emptyFormat",innerHTML:this.parent.localeObj.getConstant("emptyFormat"),styles:"margin: 10px"});i.appendChild(a),e.appendChild(i)}this.dialog.setProperties({content:e},!1);for(t=0;t<this.newFormat.length;t++)this.renderDropDowns(t),this.renderColorPicker(t)},e.prototype.createDialogElements=function(e){var t=ej2Base.createElement("div",{id:this.parentID+"outerDiv"+e,className:"e-format-outer-div"});if(void 0!==e){var i=this.newFormat[e],a=ej2Base.createElement("button",{id:this.parentID+"removeButton"+e,className:"e-format-delete-button",attrs:{title:this.parent.localeObj.getConstant("delete")}});t.appendChild(a);var r=ej2Base.createElement("div",{id:this.parentID+"innerDiv",className:"e-format-inner-div"}),o=ej2Base.createElement("table",{id:this.parentID+"cftable",className:"e-format-table"}),n=ej2Base.createElement("tr"),s=ej2Base.createElement("td"),l=ej2Base.createElement("span",{id:this.parentID+"valuelabel"+e,className:"e-format-value-label",innerHTML:this.parent.localeObj.getConstant("value")});s.appendChild(l),n.appendChild(s),o.appendChild(n),n=ej2Base.createElement("tr"),s=ej2Base.createElement("td");var d=ej2Base.createElement("div",{id:this.parentID+"measure"+e}),p=ej2Base.createElement("input",{id:this.parentID+"measureinput"+e,attrs:{type:"text",tabindex:"1"}});d.appendChild(p),s.appendChild(d),n.appendChild(s),s=ej2Base.createElement("td");var h=ej2Base.createElement("div",{id:this.parentID+"condition"}),c=ej2Base.createElement("input",{id:this.parentID+"conditioninput"+e,attrs:{type:"text",tabindex:"1"}});h.appendChild(c),s.appendChild(h),n.appendChild(s),s=ej2Base.createElement("td");var u="Between"!==i.conditions&&"NotBetween"!==i.conditions?"display:none; width:10px":"",g=ej2Base.createElement("input",{id:this.parentID+"conditionvalue1"+e,attrs:{type:"text",tabindex:"1",value:ej2Base.isNullOrUndefined(i.value1)?"0":i.value1.toString(),placeholder:this.parent.localeObj.getConstant("emptyInput")},styles:this.parent.isAdaptive?""===u?"width: 35%":"width: 100%":""===u?"width: 45px":"width: 120px",className:"e-input e-format-value1"});s.appendChild(g);var m=ej2Base.createElement("span",{id:this.parentID+"valuespan"+e,className:"e-format-value-span",innerHTML:"&",styles:u});s.appendChild(m);var v=ej2Base.createElement("input",{id:this.parentID+"conditionvalue2"+e,attrs:{type:"text",tabindex:"1",value:ej2Base.isNullOrUndefined(i.value2)?"0":i.value2.toString(),placeholder:this.parent.localeObj.getConstant("emptyInput")},styles:this.parent.isAdaptive&&""===u?"width: 35%":""===u?"width: 45px":u,className:"e-input e-format-value2"});s.appendChild(v),n.appendChild(s),o.appendChild(n),this.parent.isAdaptive&&(r.appendChild(o),o=ej2Base.createElement("table",{id:this.parentID+"cftable",className:"e-format-table"})),n=ej2Base.createElement("tr"),s=ej2Base.createElement("td");var f=ej2Base.createElement("span",{id:this.parentID+"formatlabel"+e,className:"e-format-label",innerHTML:this.parent.localeObj.getConstant("formatLabel")});s.appendChild(f),n.appendChild(s),o.appendChild(n),n=ej2Base.createElement("tr"),s=ej2Base.createElement("td");var y=ej2Base.createElement("div",{id:this.parentID+"fontname"}),S=ej2Base.createElement("input",{id:this.parentID+"fontnameinput"+e,attrs:{type:"text",tabindex:"1"}});y.appendChild(S),s.appendChild(y),n.appendChild(s),s=ej2Base.createElement("td");var b=ej2Base.createElement("div",{id:this.parentID+"fontsize"}),C=ej2Base.createElement("input",{id:this.parentID+"fontsizeinput"+e,attrs:{type:"text",tabindex:"1"}});b.appendChild(C),s.appendChild(b),n.appendChild(s),this.parent.isAdaptive&&(o.appendChild(n),n=ej2Base.createElement("tr"),o.appendChild(n),n=ej2Base.createElement("tr")),s=ej2Base.createElement("td");var x=ej2Base.createElement("input",{id:this.parentID+"fontcolor"+e,attrs:{type:"color",tabindex:"1"},className:"e-format-font-color"});s.appendChild(x);var w=ej2Base.createElement("input",{id:this.parentID+"backgroundcolor"+e,attrs:{type:"color",tabindex:"1"},className:"e-format-back-color"});s.appendChild(w),n.appendChild(s),s=ej2Base.createElement("td");var j=ej2Base.createElement("div",{id:this.parentID+"valuepreview"+e,className:"e-input e-format-value-preview",innerHTML:"123.45"});s.appendChild(j),n.appendChild(s),o.appendChild(n),r.appendChild(o),t.appendChild(r)}return t},e.prototype.renderDropDowns=function(e){var t=this.newFormat[e],i=[];i.push({index:0,name:this.parent.localeObj.getConstant("AllValues"),field:this.parent.localeObj.getConstant("AllValues")});for(var a=0;a<this.parent.dataSource.values.length;a++)i.push({index:a+1,name:this.parent.dataSource.values[a].caption||this.parent.dataSource.values[a].name,field:this.parent.dataSource.values[a].name});var r=ej2Base.isNullOrUndefined(t.measure)?this.parent.localeObj.getConstant("AllValues"):t.measure;this.fieldsDropDown[e]=new ej2Dropdowns.DropDownList({dataSource:i,fields:{text:"name"},value:r,width:this.parent.isAdaptive?"100%":"120px",popupHeight:"200px",popupWidth:"auto",change:this.measureChange.bind(this,e)}),this.fieldsDropDown[e].appendTo("#"+this.parentID+"measureinput"+e);var o=[{value:"LessThan",name:this.parent.localeObj.getConstant("LessThan")},{value:"LessThanOrEqualTo",name:this.parent.localeObj.getConstant("LessThanOrEqualTo")},{value:"GreaterThan",name:this.parent.localeObj.getConstant("GreaterThan")},{value:"GreaterThanOrEqualTo",name:this.parent.localeObj.getConstant("GreaterThanOrEqualTo")},{value:"Equals",name:this.parent.localeObj.getConstant("Equals")},{value:"NotEquals",name:this.parent.localeObj.getConstant("NotEquals")},{value:"Between",name:this.parent.localeObj.getConstant("Between")},{value:"NotBetween",name:this.parent.localeObj.getConstant("NotBetween")}];r=ej2Base.isNullOrUndefined(t.conditions)?"LessThan":t.conditions,this.conditionsDropDown[e]=new ej2Dropdowns.DropDownList({dataSource:o,fields:{value:"value",text:"name"},value:r,width:this.parent.isAdaptive?"100%":"120px",popupHeight:"200px",popupWidth:"auto",change:this.conditionChange.bind(this,e)}),this.conditionsDropDown[e].appendTo("#"+this.parentID+"conditioninput"+e);var n=[{index:0,name:"Arial"},{index:1,name:"San Serif"},{index:2,name:"Impact"},{index:3,name:"Trebuchet MS"},{index:4,name:"Serif"},{index:5,name:"Verdana"},{index:6,name:"Courier New"},{index:7,name:"Times New Roman"},{index:8,name:"Tahoma"},{index:9,name:"Gerogia"}];r=ej2Base.isNullOrUndefined(t.style.fontFamily)?"Arial":t.style.fontFamily,this.fontNameDropDown[e]=new ej2Dropdowns.DropDownList({dataSource:n,fields:{text:"name"},value:r,width:this.parent.isAdaptive?"100%":"120px",popupWidth:"150px",popupHeight:"200px",change:this.fontNameChange.bind(this,e)}),this.fontNameDropDown[e].appendTo("#"+this.parentID+"fontnameinput"+e);var s=[{index:0,name:"9px"},{index:1,name:"10px"},{index:2,name:"11px"},{index:3,name:"12px"},{index:4,name:"13px"},{index:5,name:"14px"},{index:6,name:"15px"},{index:6,name:"16px"}];r=ej2Base.isNullOrUndefined(t.style.fontSize)?"12px":t.style.fontSize,this.fontSizeDropDown[e]=new ej2Dropdowns.DropDownList({dataSource:s,fields:{text:"name"},popupHeight:"200px",value:r,width:this.parent.isAdaptive?"100%":"120px",change:this.fontSizeChange.bind(this,e)}),this.fontSizeDropDown[e].appendTo("#"+this.parentID+"fontsizeinput"+e)},e.prototype.conditionChange=function(e,t){this.newFormat[e].conditions=t.value,"Between"===t.value||"NotBetween"===t.value?(document.querySelector("#"+this.parentID+"valuespan"+e).style.display="inline-block",document.querySelector("#"+this.parentID+"valuespan"+e).style.width=this.parent.isAdaptive?"10%":"10px",document.querySelector("#"+this.parentID+"conditionvalue2"+e).style.display="inline-block",document.querySelector("#"+this.parentID+"conditionvalue2"+e).style.width=this.parent.isAdaptive?"35%":"45px",document.querySelector("#"+this.parentID+"conditionvalue1"+e).style.width=this.parent.isAdaptive?"35%":"45px"):(document.querySelector("#"+this.parentID+"valuespan"+e).style.display="none",document.querySelector("#"+this.parentID+"conditionvalue2"+e).style.display="none",document.querySelector("#"+this.parentID+"conditionvalue1"+e).style.width=this.parent.isAdaptive?"100%":"120px")},e.prototype.fontNameChange=function(e,t){this.newFormat[e].style.fontFamily=t.value.toString(),document.querySelector("#"+this.parentID+"valuepreview"+e).style.fontFamily=t.value},e.prototype.fontSizeChange=function(e,t){this.newFormat[e].style.fontSize=t.value.toString(),document.querySelector("#"+this.parentID+"valuepreview"+e).style.fontSize=t.value},e.prototype.measureChange=function(e,t){this.newFormat[e].measure=t.value.toString()===this.parent.localeObj.getConstant("AllValues")?void 0:t.value.toString()},e.prototype.renderColorPicker=function(e){var t=this.newFormat[e],i=ej2Base.isNullOrUndefined(t.style.color)?"black":t.style.color,a=this.isHex(i.substr(1))?i:this.colourNameToHex(i);document.querySelector("#"+this.parentID+"valuepreview"+e).style.color=a,this.fontColor[e]=new ej2Inputs.ColorPicker({cssClass:"e-format-color-picker",value:a,mode:"Palette",change:this.fontColorChange.bind(this,e)}),this.fontColor[e].appendTo("#"+this.parentID+"fontcolor"+e),ej2Base.addClass([this.fontColor[e].element.nextElementSibling.querySelector(".e-selected-color")],ICON),i=ej2Base.isNullOrUndefined(t.style.backgroundColor)?"white":t.style.backgroundColor,a=this.isHex(i.substr(1))?i:this.colourNameToHex(i),document.querySelector("#"+this.parentID+"valuepreview"+e).style.backgroundColor=a,document.querySelector("#"+this.parentID+"valuepreview"+e).style.fontFamily=t.style.fontFamily,document.querySelector("#"+this.parentID+"valuepreview"+e).style.fontSize=t.style.fontSize,this.backgroundColor[e]=new ej2Inputs.ColorPicker({cssClass:"e-format-color-picker",value:a,mode:"Palette",change:this.backColorChange.bind(this,e)}),this.backgroundColor[e].appendTo("#"+this.parentID+"backgroundcolor"+e),ej2Base.addClass([this.backgroundColor[e].element.nextElementSibling.querySelector(".e-selected-color")],ICON);var r=new ej2Buttons.Button({iconCss:ICON+" e-format-delete-icon",cssClass:FLAT});r.appendTo("#"+this.parentID+"removeButton"+e),r.element.onclick=this.toggleButtonClick.bind(this,e)},e.prototype.backColorChange=function(e,t){this.newFormat[e].style.backgroundColor=t.currentValue.hex,document.querySelector("#"+this.parentID+"valuepreview"+e).style.backgroundColor=t.currentValue.hex},e.prototype.fontColorChange=function(e,t){this.newFormat[e].style.color=t.currentValue.hex,document.querySelector("#"+this.parentID+"valuepreview"+e).style.color=t.currentValue.hex},e.prototype.toggleButtonClick=function(e){this.newFormat.splice(e,1),this.addFormat()},e.prototype.isHex=function(e){for(var t=parseInt(e,16);"0"===e.charAt(0);)e=e.substr(1);return t.toString(16)===e.toLowerCase()||0===t&&""===e},e.prototype.hexToRgb=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},e.prototype.colourNameToHex=function(e){var t={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return void 0!==t[e.toLowerCase()]?t[e.toLowerCase()]:"#d5d5d5"},e.prototype.showConditionalFormattingDialog=function(){this.newFormat=[];for(var e=0;e<this.parent.dataSource.conditionalFormatSettings.length;e++)this.newFormat.push(ej2Base.extend({},this.parent.dataSource.conditionalFormatSettings[e].properties,null,!0));this.createDialog(),this.dialog.refresh(),this.addFormat()},e.prototype.destroy=function(){if(this.dialog&&!this.dialog.isDestroyed){this.dialog.hide();for(var e=0;e<this.newFormat.length;e++)this.fontColor[e]&&!this.fontColor[e].isDestroyed&&this.fontColor[e].destroy(),this.backgroundColor[e]&&!this.backgroundColor[e].isDestroyed&&this.backgroundColor[e].destroy();this.dialog.destroy()}},e}();PivotView.Inject(Common);var Toolbar$2=function(){function e(e){this.currentReport="",this.parent=e,this.parent.toolbarModule=this,this.addEventListener()}return e.prototype.getModuleName=function(){return"toolbar"},e.prototype.createToolbar=function(){this.parent.isModified=!1,this.renderDialog(),null!==document.querySelector("#"+this.parent.element.id+"pivot-toolbar")&&ej2Base.remove(document.querySelector("#"+this.parent.element.id+"pivot-toolbar")),this.parent.element.insertBefore(ej2Base.createElement("div",{id:this.parent.element.id+"pivot-toolbar",className:"e-pivot-toolbar"}),this.parent.element.querySelector("#"+this.parent.element.id+"_PivotFieldList")),this.toolbar=new ej2Navigations.Toolbar({created:this.create.bind(this),enableRtl:this.parent.enableRtl,width:this.parent.width?Number(this.parent.width)-2:Number(this.parent.element.offsetWidth)-2,items:this.getItems()}),this.toolbar.appendTo("#"+this.parent.element.id+"pivot-toolbar")},e.prototype.fetchReports=function(){var e={reportName:[]};return this.parent.trigger("fetchReport",e),e},e.prototype.getItems=function(){for(var e=[],t=0,i=this.parent.toolbar.filter(function(e,t,i){return i.indexOf(e)===t});t<i.length;t++)switch(i[t]){case"New":e.push({prefixIcon:"e-new-report "+ICON,tooltipText:this.parent.localeObj.getConstant("new"),click:this.actionClick.bind(this),id:this.parent.element.id+"new"});break;case"Save":e.push({prefixIcon:"e-save-report "+ICON,tooltipText:this.parent.localeObj.getConstant("save"),click:this.actionClick.bind(this),id:this.parent.element.id+"save"});break;case"SaveAs":e.push({prefixIcon:"e-saveas-report "+ICON,tooltipText:this.parent.localeObj.getConstant("saveAs"),click:this.actionClick.bind(this),id:this.parent.element.id+"saveas"});break;case"Rename":e.push({prefixIcon:"e-rename-report "+ICON,tooltipText:this.parent.localeObj.getConstant("rename"),click:this.actionClick.bind(this),id:this.parent.element.id+"rename"});break;case"Remove":e.push({prefixIcon:"e-remove-report "+ICON,tooltipText:this.parent.localeObj.getConstant("deleteReport"),click:this.actionClick.bind(this),id:this.parent.element.id+"remove"});break;case"Load":e.push({template:"<div><input class=e-load-report id="+this.parent.element.id+"_reportlist></input></div>",click:this.actionClick.bind(this),id:this.parent.element.id+"load"});break;case"Grid":var a="Chart"===this.parent.displayOption.view;e.push({prefixIcon:"e-toolbar-grid "+ICON,tooltipText:this.parent.localeObj.getConstant("grid"),id:this.parent.element.id+"grid",cssClass:a?"e-disabled":"",click:this.gridClick.bind(this)});break;case"Chart":e.push({template:'<ul id="'+this.parent.element.id+'_chart"></ul>',id:this.parent.element.id+"chart"});break;case"Export":e.push({template:'<ul id="'+this.parent.element.id+'_menu"></ul>',id:this.parent.element.id+"export"});break;case"SubTotal":e.push({template:'<ul id="'+this.parent.element.id+'_summary"></ul>',id:this.parent.element.id+"sub-total"});break;case"GrandTotal":e.push({template:'<ul id="'+this.parent.element.id+'_grandtotal"></ul>',id:this.parent.element.id+"grand-total"});break;case"ConditionalFormatting":e.push({prefixIcon:"e-toolbar-formatting "+ICON,id:this.parent.element.id+"formatting",click:this.actionClick.bind(this),tooltipText:this.parent.localeObj.getConstant("toolbarFormatting")});break;case"FieldList":e.push({prefixIcon:"e-toolbar-fieldlist "+ICON,tooltipText:this.parent.localeObj.getConstant("fieldList"),click:this.actionClick.bind(this),align:"Right",id:this.parent.element.id+"fieldlist"}),this.parent.element.querySelector(".e-toggle-field-list")&&(this.parent.element.querySelector(".e-toggle-field-list").style.display="none")}var r={customToolbar:e};return this.parent.trigger("toolbarRender",r),e},e.prototype.reportChange=function(e){this.dropArgs=e,this.parent.isModified&&""!==this.currentReport?this.createConfirmDialog(this.parent.localeObj.getConstant("alert"),this.parent.localeObj.getConstant("newReportConfirm")):this.reportLoad(e)},e.prototype.reportLoad=function(e){if("Save"!==this.action&&"Rename"!==this.action&&"New"!==this.action){var t={reportName:e.itemData.value};this.parent.trigger("loadReport",t),this.currentReport=t.reportName,this.parent.isModified=!1}},e.prototype.saveReport=function(e){if(this.currentReport&&""!==this.currentReport&&e.item.id===this.parent.element.id+"save"){var t={report:this.parent.getPersistData(),reportName:this.currentReport};this.parent.trigger("saveReport",t),this.parent.isModified=!1}else this.dialogShow(e,"saveAs")},e.prototype.dialogShow=function(e,t){this.dialog.header=e.item.tooltipText;var i=ej2Base.createElement("div",{className:"e-report-outer"}),a=ej2Base.createElement("div",{className:"e-pivotview-report-label",innerHTML:this.parent.localeObj.getConstant("reportName")}),r=ej2Base.createElement("input",{className:"e-pivotview-report-input e-input",innerHTML:t&&"rename"===t?this.currentReport:"",attrs:{placeholder:this.parent.localeObj.getConstant("emptyReportName"),value:t&&"rename"===t?this.currentReport:""}});r.setSelectionRange(r.textContent.length,r.textContent.length),i.appendChild(a),i.appendChild(r),this.dialog.content=i,this.dialog.refresh(),this.dialog.show()},e.prototype.renameReport=function(e){if(this.parent.trigger("toolbarClick",e),!this.currentReport||""===this.currentReport)return void this.parent.pivotCommon.errorDialog.createErrorDialog(this.parent.localeObj.getConstant("error"),this.parent.localeObj.getConstant("emptyReport"));this.dialogShow(e,"rename")},e.prototype.actionClick=function(e){switch(e.item.id){case this.parent.element.id+"save":case this.parent.element.id+"saveas":this.saveReport(e);break;case this.parent.element.id+"remove":return this.action="Remove",void(this.currentReport&&""!==this.currentReport?this.createConfirmDialog(this.parent.localeObj.getConstant("alert"),this.parent.localeObj.getConstant("removeConfirm")):this.parent.pivotCommon.errorDialog.createErrorDialog(this.parent.localeObj.getConstant("error"),this.parent.localeObj.getConstant("emptyReport")));case this.parent.element.id+"rename":this.renameReport(e);break;case this.parent.element.id+"new":this.action="New",this.parent.isModified?this.createConfirmDialog(this.parent.localeObj.getConstant("alert"),this.parent.localeObj.getConstant("newReportConfirm")):this.createNewReport();break;case this.parent.element.id+"load":this.action="Load";break;case this.parent.element.id+"fieldlist":this.parent.pivotFieldListModule&&this.parent.pivotFieldListModule.dialogRenderer&&this.parent.pivotFieldListModule.dialogRenderer.fieldListDialog.show();break;case this.parent.element.id+"formatting":this.parent.conditionalFormattingModule&&this.parent.conditionalFormattingModule.showConditionalFormattingDialog()}},e.prototype.renderDialog=function(){null!==document.querySelector("#"+this.parent.element.id+"report-dialog")&&ej2Base.remove(document.querySelector("#"+this.parent.element.id+"report-dialog")),this.parent.element.appendChild(ej2Base.createElement("div",{id:this.parent.element.id+"report-dialog",className:"e-pivotview-report-dialog"})),this.dialog=new ej2Popups.Dialog({animationSettings:{effect:"Fade"},allowDragging:!1,position:{X:"center",Y:"center"},buttons:[{click:this.okBtnClick.bind(this),buttonModel:{content:this.parent.localeObj.getConstant("ok"),isPrimary:!0}},{click:this.cancelBtnClick.bind(this),buttonModel:{content:this.parent.localeObj.getConstant("cancel")}}],isModal:!0,visible:!1,showCloseIcon:!0,enableRtl:this.parent.enableRtl,width:"auto",height:"auto",zIndex:1000001,closeOnEscape:!0,target:document.body}),this.dialog.appendTo("#"+this.parent.element.id+"report-dialog")},e.prototype.okBtnClick=function(){var e=this.dialog.element.querySelector(".e-pivotview-report-input");if(e&&""===e.value)return void e.focus();var t=!1;if(this.dialog.header!==this.parent.localeObj.getConstant("save")&&this.dialog.header!==this.parent.localeObj.getConstant("saveAs")||!e.value||""===e.value){if(this.dialog.header===this.parent.localeObj.getConstant("rename")&&e.value&&""!==e.value){this.action="Rename";var i={reportName:this.currentReport,rename:e.value};this.parent.trigger("renameReport",i),this.currentReport=e.value}}else{"New"===this.action?t=!0:this.action="Save",this.currentReport=e.value;var a={report:this.parent.getPersistData(),reportName:e.value};this.parent.trigger("saveReport",a),this.parent.isModified=!1}this.updateReportList(),this.dialog.hide(),t&&this.createNewReport()},e.prototype.createNewReport=function(){this.currentReport="",this.reportList.value="",this.reportList.text="",this.reportList.refresh(),this.parent.trigger("newReport"),this.parent.isModified=!1},e.prototype.cancelBtnClick=function(){this.dialog.hide()},e.prototype.createConfirmDialog=function(e,t){document.getElementById(this.parent.element.id+"_ConfirmDialog")&&ej2Base.remove(document.getElementById(this.parent.element.id+"_ConfirmDialog").parentElement);var i=ej2Base.createElement("div",{id:this.parent.element.id+"_ConfirmDialog",className:"e-pivot-error-dialog"});this.parent.element.appendChild(i),this.confirmPopUp=new ej2Popups.Dialog({animationSettings:{effect:"Fade"},allowDragging:!1,showCloseIcon:!0,enableRtl:this.parent.enableRtl,header:e,content:t,isModal:!0,visible:!0,closeOnEscape:!0,target:document.body,width:"auto",height:"auto",position:{X:"center",Y:"center"},buttons:[{buttonModel:{content:this.parent.localeObj.getConstant("ok"),isPrimary:!0,cssClass:"e-ok-btn"},click:this.okButtonClick.bind(this)},{buttonModel:{content:this.parent.localeObj.getConstant("cancel"),cssClass:"e-cancel-btn"},click:this.cancelButtonClick.bind(this)}]}),this.confirmPopUp.appendTo(i)},e.prototype.okButtonClick=function(){if("Remove"===this.action){var e={reportName:this.currentReport};this.parent.trigger("removeReport",e),this.currentReport="",this.parent.isModified=!1,this.action="",this.updateReportList()}else if("New"===this.action||"Save"!==this.action&&"Rename"!==this.action&&"New"!==this.action)if(this.currentReport&&""!==this.currentReport){var t={report:this.parent.getPersistData(),reportName:this.currentReport};this.parent.trigger("saveReport",t),this.parent.isModified=!1,"New"===this.action?this.createNewReport():this.reportLoad(this.dropArgs)}else this.dialogShow({item:{tooltipText:this.parent.localeObj.getConstant("save")}});this.confirmPopUp.hide()},e.prototype.cancelButtonClick=function(){"New"===this.action?this.createNewReport():this.reportLoad(this.dropArgs),this.confirmPopUp.hide()},e.prototype.create=function(){var e="Table"===this.parent.displayOption.view,t=[{iconCss:"e-toolbar-chart "+ICON,items:e?[]:[{text:this.parent.localeObj.getConstant("column"),id:"Column"},{text:this.parent.localeObj.getConstant("bar"),id:"Bar"},{text:this.parent.localeObj.getConstant("line"),id:"Line"},{text:this.parent.localeObj.getConstant("area"),id:"Area"},{text:this.parent.localeObj.getConstant("scatter"),id:"Scatter"},{text:this.parent.localeObj.getConstant("polar"),id:"Polar"}]}];new ej2Navigations.Menu({items:t,cssClass:e?"e-disabled":"",enableRtl:this.parent.enableRtl,select:this.chartClick.bind(this)},"#"+this.parent.element.id+"_chart");var i=[{iconCss:"e-export "+ICON,items:[{text:this.parent.localeObj.getConstant("pdf"),iconCss:"e-pivotview-pdf-export "+ICON,id:this.parent.element.id+"pdf"},{text:this.parent.localeObj.getConstant("excel"),iconCss:"e-pivotview-excel-export "+ICON,id:this.parent.element.id+"excel"},{text:this.parent.localeObj.getConstant("csv"),iconCss:"e-pivotview-csv-export "+ICON,id:this.parent.element.id+"csv"}]}];this.exportMenu=new ej2Navigations.Menu({items:i,enableRtl:this.parent.enableRtl,select:this.export.bind(this)},"#"+this.parent.element.id+"_menu");var a=[{iconCss:"e-sub-total "+ICON,items:[{text:this.parent.localeObj.getConstant("showSubTotals"),id:this.parent.element.id+"subtotal",iconCss:PIVOT_SELECT_ICON+" "+ICON},{text:this.parent.localeObj.getConstant("doNotShowSubTotals"),id:this.parent.element.id+"notsubtotal",iconCss:PIVOT_SELECT_ICON+" "+ICON},{text:this.parent.localeObj.getConstant("showSubTotalsRowsOnly"),id:this.parent.element.id+"subtotalrow",iconCss:PIVOT_SELECT_ICON+" "+ICON},{text:this.parent.localeObj.getConstant("showSubTotalsColumnsOnly"),id:this.parent.element.id+"subtotalcolumn",iconCss:PIVOT_SELECT_ICON+" "+ICON}]}];this.subTotalMenu=new ej2Navigations.Menu({items:a,enableRtl:this.parent.enableRtl,select:this.subTotalClick.bind(this),beforeOpen:this.updateSubtotalSelection.bind(this)},"#"+this.parent.element.id+"_summary");var r=[{iconCss:"e-grand-total "+ICON,items:[{text:this.parent.localeObj.getConstant("showGrandTotals"),id:this.parent.element.id+"grandtotal",iconCss:PIVOT_SELECT_ICON+" "+ICON},{text:this.parent.localeObj.getConstant("doNotShowGrandTotals"),id:this.parent.element.id+"notgrandtotal",iconCss:PIVOT_SELECT_ICON+" "+ICON},{text:this.parent.localeObj.getConstant("showGrandTotalsRowsOnly"),id:this.parent.element.id+"grandtotalrow",iconCss:PIVOT_SELECT_ICON+" "+ICON},{text:this.parent.localeObj.getConstant("showGrandTotalsColumnsOnly"),id:this.parent.element.id+"grandtotalcolumn",iconCss:PIVOT_SELECT_ICON+" "+ICON}]}];this.grandTotalMenu=new ej2Navigations.Menu({items:r,enableRtl:this.parent.enableRtl,select:this.grandTotalClick.bind(this),beforeOpen:this.updateGrandtotalSelection.bind(this)},"#"+this.parent.element.id+"_grandtotal");var o=this.fetchReports();this.reportList=new ej2Dropdowns.DropDownList({dataSource:o.reportName,width:"150px",popupHeight:"200px",placeholder:""===this.currentReport?this.parent.localeObj.getConstant("reportList"):"",enableRtl:this.parent.enableRtl,cssClass:"e-reportlist-drop",select:this.reportChange.bind(this),value:this.currentReport}),this.reportList.appendTo("#"+this.parent.element.id+"_reportlist")},e.prototype.updateSubtotalSelection=function(e){e.element.querySelector("#"+this.parent.element.id+"subtotal ."+PIVOT_SELECT_ICON).classList.contains(PIVOT_DISABLE_ICON)||e.element.querySelector("#"+this.parent.element.id+"subtotal ."+PIVOT_SELECT_ICON).classList.add(PIVOT_DISABLE_ICON),e.element.querySelector("#"+this.parent.element.id+"notsubtotal ."+PIVOT_SELECT_ICON).classList.contains(PIVOT_DISABLE_ICON)||e.element.querySelector("#"+this.parent.element.id+"notsubtotal ."+PIVOT_SELECT_ICON).classList.add(PIVOT_DISABLE_ICON),e.element.querySelector("#"+this.parent.element.id+"subtotalrow ."+PIVOT_SELECT_ICON).classList.contains(PIVOT_DISABLE_ICON)||e.element.querySelector("#"+this.parent.element.id+"subtotalrow ."+PIVOT_SELECT_ICON).classList.add(PIVOT_DISABLE_ICON),e.element.querySelector("#"+this.parent.element.id+"subtotalcolumn ."+PIVOT_SELECT_ICON).classList.contains(PIVOT_DISABLE_ICON)||e.element.querySelector("#"+this.parent.element.id+"subtotalcolumn ."+PIVOT_SELECT_ICON).classList.add(PIVOT_DISABLE_ICON),this.parent.dataSource.showSubTotals&&this.parent.dataSource.showRowSubTotals&&!this.parent.dataSource.showColumnSubTotals?e.element.querySelector("#"+this.parent.element.id+"subtotalrow ."+PIVOT_SELECT_ICON).classList.remove(PIVOT_DISABLE_ICON):this.parent.dataSource.showSubTotals&&!this.parent.dataSource.showRowSubTotals&&this.parent.dataSource.showColumnSubTotals?e.element.querySelector("#"+this.parent.element.id+"subtotalcolumn ."+PIVOT_SELECT_ICON).classList.remove(PIVOT_DISABLE_ICON):this.parent.dataSource.showSubTotals&&this.parent.dataSource.showRowSubTotals&&this.parent.dataSource.showColumnSubTotals?e.element.querySelector("#"+this.parent.element.id+"subtotal ."+PIVOT_SELECT_ICON).classList.remove(PIVOT_DISABLE_ICON):this.parent.dataSource.showSubTotals||this.parent.dataSource.showRowSubTotals||this.parent.dataSource.showColumnSubTotals||e.element.querySelector("#"+this.parent.element.id+"notsubtotal ."+PIVOT_SELECT_ICON).classList.remove(PIVOT_DISABLE_ICON)},e.prototype.updateGrandtotalSelection=function(e){e.element.querySelector("#"+this.parent.element.id+"grandtotal ."+PIVOT_SELECT_ICON).classList.contains(PIVOT_DISABLE_ICON)||e.element.querySelector("#"+this.parent.element.id+"grandtotal ."+PIVOT_SELECT_ICON).classList.add(PIVOT_DISABLE_ICON),e.element.querySelector("#"+this.parent.element.id+"notgrandtotal ."+PIVOT_SELECT_ICON).classList.contains(PIVOT_DISABLE_ICON)||e.element.querySelector("#"+this.parent.element.id+"notgrandtotal ."+PIVOT_SELECT_ICON).classList.add(PIVOT_DISABLE_ICON),e.element.querySelector("#"+this.parent.element.id+"grandtotalrow ."+PIVOT_SELECT_ICON).classList.contains(PIVOT_DISABLE_ICON)||e.element.querySelector("#"+this.parent.element.id+"grandtotalrow ."+PIVOT_SELECT_ICON).classList.add(PIVOT_DISABLE_ICON),e.element.querySelector("#"+this.parent.element.id+"grandtotalcolumn ."+PIVOT_SELECT_ICON).classList.contains(PIVOT_DISABLE_ICON)||e.element.querySelector("#"+this.parent.element.id+"grandtotalcolumn ."+PIVOT_SELECT_ICON).classList.add(PIVOT_DISABLE_ICON),this.parent.dataSource.showGrandTotals&&this.parent.dataSource.showRowGrandTotals&&!this.parent.dataSource.showColumnGrandTotals?e.element.querySelector("#"+this.parent.element.id+"grandtotalrow ."+PIVOT_SELECT_ICON).classList.remove(PIVOT_DISABLE_ICON):this.parent.dataSource.showGrandTotals&&!this.parent.dataSource.showRowGrandTotals&&this.parent.dataSource.showColumnGrandTotals?e.element.querySelector("#"+this.parent.element.id+"grandtotalcolumn ."+PIVOT_SELECT_ICON).classList.remove(PIVOT_DISABLE_ICON):this.parent.dataSource.showGrandTotals&&this.parent.dataSource.showRowGrandTotals&&this.parent.dataSource.showColumnGrandTotals?e.element.querySelector("#"+this.parent.element.id+"grandtotal ."+PIVOT_SELECT_ICON).classList.remove(PIVOT_DISABLE_ICON):this.parent.dataSource.showGrandTotals||this.parent.dataSource.showRowGrandTotals||this.parent.dataSource.showColumnGrandTotals||e.element.querySelector("#"+this.parent.element.id+"notgrandtotal ."+PIVOT_SELECT_ICON).classList.remove(PIVOT_DISABLE_ICON)},e.prototype.updateReportList=function(){var e=this.fetchReports();this.reportList.dataSource=e.reportName,""===this.currentReport&&this.reportList.dataSource.length>0?(this.reportList.value=this.reportList.dataSource[this.reportList.dataSource.length-1],this.reportList.text=this.reportList.dataSource[this.reportList.dataSource.length-1],this.currentReport=this.reportList.dataSource[this.reportList.dataSource.length-1]):(this.reportList.value=this.currentReport,this.reportList.text=this.currentReport)},e.prototype.grandTotalClick=function(e){switch(e.item.id){case this.parent.element.id+"notgrandtotal":this.parent.dataSource.showGrandTotals=!1,this.parent.dataSource.showColumnGrandTotals=!1,this.parent.dataSource.showRowGrandTotals=!1;break;case this.parent.element.id+"grandtotalrow":this.parent.dataSource.showGrandTotals=!0,this.parent.dataSource.showColumnGrandTotals=!1,this.parent.dataSource.showRowGrandTotals=!0;break;case this.parent.element.id+"grandtotalcolumn":this.parent.dataSource.showGrandTotals=!0,this.parent.dataSource.showColumnGrandTotals=!0,this.parent.dataSource.showRowGrandTotals=!1;break;case this.parent.element.id+"grandtotal":this.parent.dataSource.showGrandTotals=!0,this.parent.dataSource.showColumnGrandTotals=!0,this.parent.dataSource.showRowGrandTotals=!0}},e.prototype.subTotalClick=function(e){switch(e.item.id){case this.parent.element.id+"notsubtotal":this.parent.dataSource.showSubTotals=!1,this.parent.dataSource.showColumnSubTotals=!1,this.parent.dataSource.showRowSubTotals=!1;break;case this.parent.element.id+"subtotalrow":this.parent.dataSource.showSubTotals=!0,this.parent.dataSource.showColumnSubTotals=!1,this.parent.dataSource.showRowSubTotals=!0;break;case this.parent.element.id+"subtotalcolumn":this.parent.dataSource.showSubTotals=!0,this.parent.dataSource.showColumnSubTotals=!0,this.parent.dataSource.showRowSubTotals=!1;break;case this.parent.element.id+"subtotal":this.parent.dataSource.showSubTotals=!0,this.parent.dataSource.showColumnSubTotals=!0,this.parent.dataSource.showRowSubTotals=!0}},e.prototype.gridClick=function(e){this.parent.grid&&this.parent.chart&&(this.parent.grid.element.style.display="",this.parent.chart.element.style.display="none",this.parent.currentView="Table")},e.prototype.chartClick=function(e){e.item&&e.item.text&&(this.parent.chartSettings.chartSeries.type=e.item.id,this.parent.grid&&this.parent.chart&&(this.parent.grid.element.style.display="none",this.parent.chart.element.style.display="",this.parent.currentView="Chart"))},e.prototype.export=function(e){switch(e.item.id){case this.parent.element.id+"pdf":this.parent.pdfExportModule?this.parent.pdfExportModule.exportToPDF():this.parent.pdfExport();break;case this.parent.element.id+"excel":this.parent.excelExportModule?this.parent.excelExportModule.exportToExcel("Excel"):this.parent.excelExport();break;case this.parent.element.id+"csv":this.parent.excelExportModule?this.parent.excelExportModule.exportToExcel("csv"):this.parent.csvExport()}},e.prototype.addEventListener=function(){this.parent.isDestroyed||this.parent.on("init-toolbar",this.createToolbar,this)},e.prototype.refreshToolbar=function(){this.createToolbar()},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("init-toolbar",this.createToolbar)},e.prototype.destroy=function(){this.removeEventListener(),this.confirmPopUp&&!this.confirmPopUp.isDestroyed&&this.confirmPopUp.destroy(),this.dialog&&!this.dialog.isDestroyed&&this.dialog.destroy(),this.exportMenu&&!this.exportMenu.isDestroyed&&this.exportMenu.destroy(),this.subTotalMenu&&!this.subTotalMenu.isDestroyed&&this.subTotalMenu.destroy(),this.grandTotalMenu&&!this.grandTotalMenu.isDestroyed&&this.grandTotalMenu.destroy(),this.reportList&&!this.reportList.isDestroyed&&this.reportList.destroy(),this.toolbar&&!this.toolbar.isDestroyed&&this.toolbar.destroy()},e}();return exports.GroupingBarSettings=GroupingBarSettings,exports.CellEditSettings=CellEditSettings,exports.ConditionalSettings=ConditionalSettings,exports.HyperlinkSettings=HyperlinkSettings,exports.DisplayOption=DisplayOption,exports.PivotView=PivotView,exports.Render=Render,exports.ExcelExport=ExcelExport$1,exports.PDFExport=PDFExport,exports.KeyboardInteraction=KeyboardInteraction,exports.VirtualScroll=VirtualScroll$1,exports.DrillThrough=DrillThrough,exports.PivotChart=PivotChart,exports.PivotFieldList=PivotFieldList,exports.TreeViewRenderer=TreeViewRenderer,exports.AxisFieldRenderer=AxisFieldRenderer,exports.AxisTableRenderer=AxisTableRenderer,exports.DialogRenderer=DialogRenderer,exports.EventBase=EventBase,exports.NodeStateModified=NodeStateModified,exports.DataSourceUpdate=DataSourceUpdate,exports.FieldList=FieldList,exports.CommonKeyboardInteraction=CommonKeyboardInteraction,exports.GroupingBar=GroupingBar,exports.CalculatedField=CalculatedField,exports.ConditionalFormatting=ConditionalFormatting,exports.PivotCommon=PivotCommon,exports.load="load",exports.enginePopulating="enginePopulating",exports.enginePopulated="enginePopulated",exports.onFieldDropped="onFieldDropped",exports.beforePivotTableRender="beforePivotTableRender",exports.afterPivotTableRender="afterPivotTableRender",exports.beforeExport="beforeExport",exports.excelHeaderQueryCellInfo="excelHeaderQueryCellInfo",exports.pdfHeaderQueryCellInfo="pdfHeaderQueryCellInfo",exports.excelQueryCellInfo="excelQueryCellInfo",exports.pdfQueryCellInfo="pdfQueryCellInfo",exports.onPdfCellRender="onPdfCellRender",exports.dataBound="dataBound",exports.queryCellInfo="queryCellInfo",exports.headerCellInfo="headerCellInfo",exports.hyperlinkCellClick="hyperlinkCellClick",exports.resizing="resizing",exports.resizeStop="resizeStop",exports.cellClick="cellClick",exports.drillThrough="drillThrough",exports.beforeColumnsRender="beforeColumnsRender",exports.selected="selected",exports.cellSelected="cellSelected",exports.cellDeselected="cellDeselected",exports.rowSelected="rowSelected",exports.rowDeselected="rowDeselected",exports.beginDrillThrough="beginDrillThrough",exports.saveReport="saveReport",exports.fetchReport="fetchReport",exports.loadReport="loadReport",exports.renameReport="renameReport",exports.removeReport="removeReport",exports.newReport="newReport",exports.toolbarRender="toolbarRender",exports.toolbarClick="toolbarClick",exports.chartTooltipRender="chartTooltipRender",exports.chartLoaded="chartLoaded",exports.chartLoad="chartLoad",exports.chartResized="chartResized",exports.chartAxisLabelRender="chartAxisLabelRender",exports.chartSeriesCreated="chartSeriesCreated",exports.aggregateCellInfo="aggregateCellInfo",exports.contextMenuClick="contextMenuClick",exports.contextMenuOpen="contextMenuOpen",exports.initialLoad="initial-load",exports.uiUpdate=uiUpdate,exports.scroll="scroll",exports.contentReady=contentReady,exports.dataReady=dataReady,exports.initSubComponent="init-groupingbar",exports.treeViewUpdate="tree-view-update",exports.pivotButtonUpdate="pivot-button-update",exports.initCalculatedField="init-calculatedfield",exports.click="click",exports.initToolbar="init-toolbar",exports.ErrorDialog=ErrorDialog,exports.FilterDialog=FilterDialog,exports.PivotContextMenu=PivotContextMenu,exports.AggregateMenu=AggregateMenu,exports.Toolbar=Toolbar$2,exports.PivotEngine=PivotEngine,exports.PivotUtil=PivotUtil,exports}({},ej2Base,ej2Data,ej2Popups,ej2Grids,ej2Navigations,ej2Inputs,ej2Dropdowns,ej2ExcelExport,ej2PdfExport,ej2Charts,ej2Calendars,ej2Buttons),this.ejs=ej;
//# sourceMappingURL=ej2-pivotview.min.js.map
