!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@syncfusion/ej2-base"),require("@syncfusion/ej2-popups"),require("@syncfusion/ej2-data"),require("@syncfusion/ej2-navigations")):"function"==typeof define&&define.amd?define(["exports","@syncfusion/ej2-base","@syncfusion/ej2-popups","@syncfusion/ej2-data","@syncfusion/ej2-navigations"],e):e(t.ej={},t.ej2Base,t.ej2Popups,t.ej2Data,t.ej2Navigations)}(this,function(t,e,i,r,o){"use strict";function n(t){var e,i=[],r=a(t);if(r.length>0)for(var o=0;o<r.length;o++){var n=r[o],s="";switch((s=n[0]).toLowerCase()){case"m":for(e=1;e<n.length;e++)i.push({command:s,x:n[e],y:n[e+1]}),e+=1,"m"===s?s="l":"M"===s&&(s="L");break;case"l":case"t":for(e=1;e<n.length;e++)i.push({command:s,x:n[e],y:n[e+1]}),e+=1;break;case"h":for(e=1;e<n.length;e++)i.push({command:s,x:n[e]});break;case"v":for(e=1;e<n.length;e++)i.push({command:s,y:n[e]});break;case"z":i.push({command:s});break;case"c":for(e=1;e<n.length;e++)i.push({command:s,x1:n[e],y1:n[e+1],x2:n[e+2],y2:n[e+3],x:n[e+4],y:n[e+5]}),e+=5;break;case"s":for(e=1;e<n.length;e++)i.push({command:s,x2:n[e],y2:n[e+1],x:n[e+2],y:n[e+3]}),e+=3;break;case"q":for(e=1;e<n.length;e++)i.push({command:s,x1:n[e],y1:n[e+1],x:n[e+2],y:n[e+3]}),e+=3;break;case"a":for(e=1;e<n.length;e++)i.push({command:s,r1:n[e],r2:n[e+1],angle:n[e+2],largeArc:n[e+3],sweep:n[e+4],x:n[e+5],y:n[e+6]}),e+=6}}return i}function a(t){var e=/([a-z]+)|([+-]?(?:\d+\.?\d*|\.\d+))/gi,i=[],r=[],o={};e.lastIndex=0;var n=!1;for(o=e.exec(t);o;)"e"===o[1]?n=!0:o[1]?("zm"===o[1].toLowerCase()?(i.length&&r.push(i),r.push(["Z"]),i=[o[1].substring(1,2)]):(i.length&&r.push(i),i=[o[1]]),n=!1):(i.length||(i=[]),n||i.push(Number(o[2])),n=!1),o=e.exec(t);return i.length&&r.push(i),r}function s(t,e,i){var r,o,n="",a=[{x:0+t,y:0},{x:0+i-t,y:0},{x:0+i,y:0+t},{x:0+i,y:0+e-t},{x:0+i-t,y:0+e},{x:0+t,y:0+e},{x:0,y:0+e-t},{x:0,y:0+t}],s=[{x:0+i,y:0},{x:0+i,y:0+e},{x:0,y:0+e},{x:0,y:0}],h=0;n="M"+a[0].x+" "+a[0].y;var d;for(d=0;d<a.length;d+=2)n+="L"+(r=a[d+1]).x+" "+r.y,o=a[d+2]||a[0],n+="Q"+s[h].x+" "+s[h].y+" "+o.x+" "+o.y,h++;return n}function h(t){var e,i="";i="M"+t[0].x+" "+t[0].y;var r;for(r=1;r<t.length;r++)i+="L"+(e=t[r]).x+" "+e.y;return i+="Z"}function d(t){var e,i,r,o,n,a,s,h,d,l,c=[];for(s=0,h=0,l=0,d=t.length;l<d;++l){var p=t[l],g="";g=p.command,"y1"in p&&(o=p.y1),"y2"in p&&(a=p.y2),"x1"in p&&(r=p.x1),"x2"in p&&(n=p.x2),"x"in p&&(s=p.x),"y"in p&&(h=p.y);var u=c[c.length-1];switch(g){case"M":c.push({command:"M",x:s,y:h});break;case"L":c.push({command:"L",x0:e,y0:i,x:s,y:h});break;case"H":c.push({command:"L",x0:e,y0:i,x:s,y:i});break;case"V":c.push({command:"L",x0:e,y0:i,x:e,y:h});break;case"C":c.push({command:"C",x0:e,y0:i,x1:r,y1:o,x2:n,y2:a,x:s,y:h});break;case"S":if(u){var f=void 0,m={x:2*e-(f="C"===u.command||"S"===u.command?{x:u.x2,y:u.y2}:{x:e,y:i}).x,y:2*i-f.y};c.push({command:"C",x0:e,y0:i,x1:m.x,y1:m.y,x2:n,y2:a,x:s,y:h})}break;case"Q":c.push({command:"Q",x0:e,y0:i,x1:r,y1:o,x:s,y:h});break;case"T":if(u){f=void 0,m={x:2*e-(f="Q"===u.command?{x:u.x1,y:u.y1}:{x:e,y:i}).x,y:2*i-f.y};c.push({command:"Q",x0:e,y0:i,x1:m.x,y1:m.y,x:s,y:h})}break;case"A":var y=p;y.command="A",c.push(y);break;case"Z":case"z":c.push({command:"Z"}),s=e,h=i}e=s,i=h}return c}function l(t,e,i,r,o,n,a,s){var h,d,l,g,f,m,y,v,b;for(f=0,m=0,v=0,y=t.length;v<y;++v){var w=t[v],x=w.command;"x"in w&&(f=w.x),"y"in w&&(m=w.y),"y1"in w&&(d=w.y1),"y2"in w&&(g=w.y2),"x1"in w&&(h=w.x1),"x2"in w&&(l=w.x2),r?(void 0!==f&&(f=p(f,e,o,a)),void 0!==m&&(m=p(m,i,n,s)),void 0!==h&&(h=p(h,e,o,a)),void 0!==d&&(d=p(d,i,n,s)),void 0!==l&&(l=p(l,e,o,a)),void 0!==g&&(g=p(g,i,n,s))):(void 0!==f&&(f=Number((f+e).toFixed(2))),void 0!==m&&(m=Number((m+i).toFixed(2))),void 0!==h&&(h=Number((h+e).toFixed(2))),void 0!==d&&(d=Number((d+i).toFixed(2))),void 0!==l&&(l=Number((l+e).toFixed(2))),void 0!==g&&(g=Number((g+i).toFixed(2))));(b=c(w,x,{x:f,y:m,x1:h,y1:d,x2:l,y2:g,r1:w.r1,r2:w.r2},r,e,i))&&(t[v]=b)}return u(t)}function c(t,e,i,r,o,n){switch(e){case"M":case"L":t.x=i.x,t.y=i.y;break;case"H":t.x=i.x;break;case"V":t.y=i.y;break;case"C":t.x=i.x,t.y=i.y,t.x1=i.x1,t.y1=i.y1,t.x2=i.x2,t.y2=i.y2;break;case"S":t.x=i.x,t.y=i.y,t.x2=i.x2,t.y2=i.y2;break;case"Q":t.x=i.x,t.y=i.y,t.x1=i.x1,t.y1=i.y1;break;case"T":t.x=i.x,t.y=i.y;break;case"A":var a=i.r1,s=i.r2;r&&(i.r1=a*=o,i.r2=s*=n),t.x=i.x,t.y=i.y,t.r1=i.r1,t.r2=i.r2;break;case"z":case"Z":t={command:"Z"}}return t}function p(t,e,i,r){return t!==i?t=r!==i?t*e-(Number(i)*e-Number(i))+(r-Number(i)):Number(t)*e-(Number(i)*e-Number(i)):r!==i&&(t=r),Number(t.toFixed(2))}function g(t){var e,i,r,o,n,a,s,h,d,l;for(s=0,h=0,l=0,d=t.length;l<d;++l){var c=t[l],p=c.command;if(/[MLHVCSQTA]/.test(p))"x"in c&&(c.x=s=c.x),"y"in c&&(c.y=h=c.y);else{"x1"in c&&(c.x1=r=s+c.x1),"x2"in c&&(c.x2=n=s+c.x2),"y1"in c&&(c.y1=o=h+c.y1),"y2"in c&&(c.y2=a=h+c.y2),"x"in c&&(c.x=s+=c.x),"y"in c&&(c.y=h+=c.y);var g=void 0;switch(p){case"m":case"M":g={command:"M",x:s,y:h};break;case"l":case"L":g={command:"L",x:s,y:h};break;case"h":case"H":g={command:"H",x:s};break;case"v":case"V":g={command:"V",y:h};break;case"c":case"C":g={command:"C",x:s,y:h,x1:r,y1:o,x2:n,y2:a};break;case"s":case"S":g={command:"S",x:s,y:h,x2:n,y2:a};break;case"q":case"Q":g={command:"Q",x:s,y:h,x1:r,y1:o};break;case"t":case"T":g={command:"T",x:s,y:h};break;case"a":case"A":(g={command:"A",x:s,y:h}).r1=c.r1,g.r2=c.r2,g.angle=c.angle,g.largeArc=c.largeArc,g.sweep=c.sweep;break;case"z":case"Z":g={command:"Z"},s=e,h=i,g=t[l]}g&&(t[l]=g)}"M"!==p&&"m"!==p||(e=s,i=h)}return t}function u(t){var e,i="";for(e=0;e<t.length;e++)i+=0===e?f(t[e]):" "+f(t[e]);return i}function f(t){var e="";switch(t.command){case"Z":case"z":e=t.command;break;case"M":case"m":case"L":case"l":e=t.command+" "+t.x+" "+t.y;break;case"C":case"c":e=t.command+" "+t.x1+" "+t.y1+" "+t.x2+" "+t.y2+" "+t.x+" "+t.y;break;case"Q":case"q":e=t.command+" "+t.x1+" "+t.y1+" "+t.x+" "+t.y;break;case"A":case"a":var i=t.command,r=t.angle,o=t.largeArc?"1":"0",n=t.sweep?"1":"0";e=i+" "+t.r1+" "+t.r2+" "+r+" "+o+" "+n+" "+t.x+" "+t.y;break;case"H":case"h":e=t.command+" "+t.x;break;case"V":case"v":e=t.command+" "+t.y;break;case"S":case"s":e=t.command+" "+t.x2+" "+t.y2+" "+t.x+" "+t.y;break;case"T":case"t":e=t.command+" "+t.x+" "+t.y}return e}function m(){return new Sr(1,0,0,1,0,0,t.MatrixTypes.Identity)}function y(e,i){var r=function(e,i,r){switch(e.type){case t.MatrixTypes.Identity:break;case t.MatrixTypes.Translation:i+=e.offsetX,r+=e.offsetY;break;case t.MatrixTypes.Scaling:i*=e.m11,r*=e.m22;break;case t.MatrixTypes.Translation|t.MatrixTypes.Scaling:i*=e.m11,i+=e.offsetX,r*=e.m22,r+=e.offsetY;break;default:var o=r*e.m21+e.offsetX,n=i*e.m12+e.offsetY;i*=e.m11,i+=o,r*=e.m22,r+=n}return{x:i,y:r}}(e,i.x,i.y);return{x:Math.round(100*r.x)/100,y:Math.round(100*r.y)/100}}function v(t,e){for(var i=[],r=0,o=e;r<o.length;r++){var n=o[r];i.push(y(t,n))}return i}function b(e,i,r,o){S(e,function(e,i,r){var o=m(),n=Math.sin(e),a=Math.cos(e),s=i*(1-a)+r*n,h=r*(1-a)-i*n;return o.type=t.MatrixTypes.Unknown,P(o,a,n,-n,a,s,h),o}(.017453292519943295*(i%=360),r||0,o||0))}function w(e,i,r,o,n){void 0===o&&(o=0),void 0===n&&(n=0),S(e,function(e,i,r,o){var n=m();return n.type=r||o?t.MatrixTypes.Scaling|t.MatrixTypes.Translation:t.MatrixTypes.Scaling,P(n,e,0,0,i,r-e*r,o-i*o),n}(i,r,o,n))}function x(e,i,r){return e.type&t.MatrixTypes.Identity?(e.type=t.MatrixTypes.Translation,void P(e,1,0,0,1,i,r)):e.type&t.MatrixTypes.Unknown?(e.offsetX+=i,void(e.offsetY+=r)):(e.offsetX+=i,e.offsetY+=r,void(e.type|=t.MatrixTypes.Translation))}function S(e,i){var r=e.type,o=i.type;if(o!==t.MatrixTypes.Identity){if(r===t.MatrixTypes.Identity)return C(e,i),void(e.type=i.type);if(o===t.MatrixTypes.Translation)return e.offsetX+=i.offsetX,e.offsetY+=i.offsetY,void(r!==t.MatrixTypes.Unknown&&(e.type|=t.MatrixTypes.Translation));if(r!==t.MatrixTypes.Translation){var n=r<<4|o;switch(n){case 34:return e.m11*=i.m11,void(e.m22*=i.m22);case 35:return e.m11*=i.m11,e.m22*=i.m22,e.offsetX=i.offsetX,e.offsetY=i.offsetY,void(e.type=t.MatrixTypes.Translation|t.MatrixTypes.Scaling);case 36:break;default:switch(n){case 50:return e.m11*=i.m11,e.m22*=i.m22,e.offsetX*=i.m11,void(e.offsetY*=i.m22);case 51:return e.m11*=i.m11,e.m22*=i.m22,e.offsetX=i.m11*e.offsetX+i.offsetX,void(e.offsetY=i.m22*e.offsetY+i.offsetY);case 52:break;default:switch(n){case 66:case 67:case 68:break;default:return}}}var a=m();return P(a,e.m11*i.m11+e.m12*i.m21,e.m11*i.m12+e.m12*i.m22,e.m21*i.m11+e.m22*i.m21,e.m21*i.m12+e.m22*i.m22,e.offsetX*i.m11+e.offsetY*i.m21+i.offsetX,e.offsetX*i.m12+e.offsetY*i.m22+i.offsetY),a.m21||a.m12?a.type=t.MatrixTypes.Unknown:((a.m11&&1!==a.m11||a.m22&&1!==a.m22)&&(a.type=t.MatrixTypes.Scaling),(a.offsetX||a.offsetY)&&(a.type|=t.MatrixTypes.Translation),(a.type&(t.MatrixTypes.Translation|t.MatrixTypes.Scaling))===t.MatrixTypes.Identity&&(a.type=t.MatrixTypes.Identity),a.type=t.MatrixTypes.Scaling|t.MatrixTypes.Translation),C(e,a),void(e.type=a.type)}var s=e.offsetX,h=e.offsetY;e.offsetX=s*i.m11+h*i.m21+i.offsetX,e.offsetY=s*i.m12+h*i.m22+i.offsetY,o!==t.MatrixTypes.Unknown?e.type=t.MatrixTypes.Translation|t.MatrixTypes.Scaling:e.type=t.MatrixTypes.Unknown}}function P(t,e,i,r,o,n,a){t.m11=e,t.m12=i,t.m21=r,t.m22=o,t.offsetX=n,t.offsetY=a}function C(t,e){t.m11=e.m11,t.m12=e.m12,t.m21=e.m21,t.m22=e.m22,t.offsetX=e.offsetX,t.offsetY=e.offsetY,t.type=e.type}function T(t){return Jr[t.toString()]}function A(t){return lo[t.toString()]}function M(t,e){return"Custom"===t?e.pathData:co[t]}function L(t){var e;switch(t.shape){case"Minus":e="M0,50 L100,50";break;case"Plus":e="M0,-50 L0,50 M-50,0 L50,0";break;case"ArrowUp":e="M0,100 L50,0 L100,100 Z";break;case"ArrowDown":e="M0,0 L50,100 L100,0 Z";break;case"Path":e=t.pathData}return e}function O(t){return po[t.toString()]}function I(t){var e=new i.Tooltip;e=k(t.tooltip,e);var r=new i.Tooltip(e);return r.beforeCollision=z,r.beforeOpen=E,r.cssClass="e-diagram-tooltip",r.opensOn="custom",r.appendTo("#"+t.element.id),r.close(),r}function E(t){""!==this.content&&void 0!==this.content||(t.element.style.display="none")}function z(t){t.collidedPosition&&t.collidedPosition!==this.position&&(t.element.style.display="none")}function D(t,e){var i,r=t.tooltipObject;return i=e?e.tooltip:t.tooltip,k(i,r),r}function k(t,e){return t.content?(e.content=t.content,e.position=t.position,e.showTipPointer=t.showTipPointer,e.width=t.width,e.height=t.height,t.animation?e.animation=t.animation:e.animation={close:{effect:"None"}}):e.close(),e}function R(e,i){var r,o;return o="Straight"!==e.type&&e.sourceWrapper?e.sourceWrapper.corners.center:function(t){var e;if(t.sourcePortWrapper){var i=t.sourcePortWrapper,r=t.sourceWrapper,o={x:i.offsetX,y:i.offsetY};gt(o,Wi(r),r.bounds,!1);e=o}else if(t.sourceID&&t.sourceWrapper)if(t.targetWrapper){var n=t.sourceWrapper.corners.center,a=t.targetWrapper.corners.center;e=it(t,t.sourceWrapper,n,a,!1)}else e=t.sourcePoint;else e=t.sourcePoint;return e}(e),r=function(e,i,r,o){var n,a,s=e.sourceWrapper,h=e.targetWrapper,d=e.sourcePortWrapper,l=e.targetPortWrapper,c=[],p={corners:void 0,point:i,direction:void 0,margin:{left:5,right:5,bottom:5,top:5}},g={corners:void 0,point:r,direction:void 0,margin:{left:5,right:5,bottom:5,top:5}};void 0!==s&&void 0!==h&&(n=Wi(s),a=Wi(h),p.corners=s.corners,g.corners=h.corners);if(void 0!==d){var u={x:d.offsetX,y:d.offsetY};p.direction=gt(u,n,s.bounds,!1)}if(void 0!==l){var f={x:l.offsetX,y:l.offsetY};g.direction=gt(f,a,h.bounds,!1)}if(void 0!==s&&void 0!==h)return void 0!==p.direction&&void 0!==g.direction||(o?function(t,e,i){"LeftToRight"===i?(t.direction=t.direction?t.direction:"Right",e.direction=e.direction?e.direction:"Left"):"RightToLeft"===i?(t.direction=t.direction?t.direction:"Left",e.direction=e.direction?e.direction:"Right"):"TopToBottom"===i?(t.direction=t.direction?t.direction:"Bottom",e.direction=e.direction?e.direction:"Top"):"BottomToTop"===i&&(t.direction=t.direction?t.direction:"Top",e.direction=e.direction?e.direction:"Bottom")}(p,g,o):p.corners.top>g.corners.bottom&&Math.abs(p.corners.top-g.corners.bottom)>p.margin.top+p.margin.bottom?(p.direction=p.direction?p.direction:"Top",g.direction=g.direction?g.direction:"Bottom"):p.corners.bottom<g.corners.top&&Math.abs(p.corners.bottom-g.corners.top)>p.margin.bottom+p.margin.top?(p.direction=p.direction?p.direction:"Bottom",g.direction=g.direction?g.direction:"Top"):p.corners.right<g.corners.left&&Math.abs(p.corners.right-g.corners.left)>p.margin.right+p.margin.left||p.corners.right+13<g.corners.left||g.corners.right>=p.corners.left-13&&p.corners.left>g.corners.left?(p.direction=p.direction?p.direction:"Right",g.direction=g.direction?g.direction:"Left"):p.corners.left>g.corners.right&&Math.abs(p.corners.left-g.corners.right)>p.margin.left+p.margin.right||g.corners.right+13<p.corners.left||p.corners.right>=g.corners.left-13&&p.corners.left<g.corners.left?(p.direction=p.direction?p.direction:"Left",g.direction=g.direction?g.direction:"Right"):s.id!==h.id&&!n.equals(n,a)&&a.containsPoint(n.topCenter,p.margin.top)?(p.direction=p.direction?p.direction:"Bottom",g.direction=g.direction?g.direction:"Top"):(p.direction=p.direction?p.direction:"Top",g.direction=g.direction?g.direction:"Bottom")),function(e,i,r,o,n){var a,s=e.sourceWrapper,h=e.targetWrapper,d=e.sourcePortWrapper,l=e.targetPortWrapper,c=[],p=s.corners,g=h.corners,u=(g.center,{corners:p,point:o,direction:i,margin:{left:5,right:5,bottom:5,top:5}}),f={corners:g,point:n,direction:r,margin:{left:5,right:5,bottom:5,top:5}},m=V(s,p,e.sourceWrapper.bounds),y=V(h,g,e.targetWrapper.bounds),v=!1;e.sourceWrapper&&e.targetWrapper&&(v=function(t,e){for(var i=Y(t),r=Y(e),o=0;o<i.length-1;o++)for(var n=i[o],a=0;a<r.length-1;a++){var s=r[a];if(Le(n,s).enabled)return!0}return!1}(e.sourceWrapper,e.targetWrapper));if(void 0!==d)switch(u.point={x:d.offsetX,y:d.offsetY},u.direction){case"Bottom":case"Top":u.point.y=u.point.y;break;case"Left":case"Right":u.point.x=u.point.x}else"Orthogonal"===e.type?(e.segments&&e.segments.length>0&&e.segments[0].direction&&(u.direction=e.segments[0].direction),u.point=tt(m,u.direction),a=tt(m,ft(u.direction)),u.point=it(e,s,u.point,a,!1)):u.point=s.corners.center;if(void 0!==l)switch(f.point={x:l.offsetX,y:l.offsetY},f.direction){case"Bottom":case"Top":f.point.y=f.point.y;break;case"Left":case"Right":f.point.x=f.point.x}else"Orthogonal"===e.type?(f.point=tt(y,f.direction),a=tt(y,ft(f.direction)),f.point=it(e,h,f.point,a,!0)):f.point=h.corners.center;if("Orthogonal"!==e.type){var b=void 0,w=void 0;if(G(e),void 0===e.sourcePortWrapper){u.point=u.corners.center,e.segments&&e.segments.length>0&&(w=e.segments[0],b=wr.isEmptyPoint(w.point)?void 0:w);var x=void 0!==b?b.point:f.point;if("Bezier"===e.type&&e.segments.length>0&&e.segments[0].vector1.angle&&e.segments[0].vector1.distance){var S=Math.max(u.corners.width,u.corners.height);x=wr.transform(u.point,e.segments[0].vector1.angle,S/2)}u.point=v?e.sourceWrapper.bounds.center:it(e,s,u.point,x,!1)}if(void 0===e.targetPortWrapper){f.point=f.corners.center,e.segments&&e.segments.length>1&&(w=e.segments[e.segments.length-2],b=wr.isEmptyPoint(w.point)?void 0:w);var P=b?b.point:u.point;if("Bezier"===e.type&&e.segments.length>0&&e.segments[e.segments.length-1].vector2.angle&&e.segments[e.segments.length-1].vector2.distance){var S=Math.max(u.corners.width,u.corners.height);P=wr.transform(f.point,e.segments[0].vector2.angle,S/2)}f.point=v?e.targetWrapper.bounds.center:it(e,h,P,f.point,!0)}c=U(e,u,f)}else if("Orthogonal"===e.type&&e.segments&&e.segments.length>0&&null!==e.segments[0].direction)c=function(t,e,i,r,o,n,a){var s,h,d,l;G(t);for(var c=0;c<t.segments.length;c++){if(h=t.segments[c],r&&e.direction===ft(h.direction)&&(h.direction=e.direction),c>0&&t.segments[c-1].direction===h.direction)c=Z(t,c,e);else if(h.direction)e.point=N(e,t.segments[c]);else{var p=t.segments[c-1];e.point=p.points[p.points.length-1]}if(c===t.segments.length-1)if(K(t,e),s=void 0===o?q(t,e,i):W(t,e,i),X(s,t,e),h.points=[],s.length>=2)for(d=0;d<s.length;d++)h.points.push(s[d]);else l=c;if(void 0!==l&&(l===t.segments.length-1&&(t.segments[l-1].direction=null,t.segments[l-1].length=null),t.segments.splice(l,1)),r&&0===c){var g=_(t,r,n);g&&(e.point=g)}}return Q(t,[])}(e,u,f,d,l,s);else{if(!e.segments[0]){var b=new No(e,"segments",{type:"Orthogonal"},!0);e.segments.push(b)}e.segments[0].points=c=function(e,i,r,o){var n,a=!1;(a=function(t,e){var i=!1;switch(t){case"Left":switch(e){case"Right":case"Bottom":i=!0}break;case"Top":switch(e){case"Left":case"Right":case"Bottom":i=!0}break;case"Bottom":switch(e){case"Right":i=!0}}return i}(i.direction,r.direction))&&pt(i,r);"Right"===i.direction&&"Left"===r.direction?n=function(e,i,r,o){var n,a=e.sourcePortWrapper,s=(e.targetPortWrapper,Math.round(Math.abs(i.point.y-r.point.y))),h=(Math.round(Math.abs(i.point.x-r.point.x)),{x:Math.max(i.point.x,i.corners.right),y:i.point.y}),d={x:Math.min(r.point.x,r.corners.left),y:r.point.y},l=10;if(o){var c=void 0;c=d,d=h,h=c}i.corners.bottom+l<r.corners.top-l||i.corners.top-l>r.corners.bottom+l||(l=0);i.margin={left:l,right:l,top:l,bottom:l},r.margin={left:l,right:l,top:l,bottom:l},n=0===s&&(i.corners.right<r.corners.left||o&&i.corners.right<r.corners.left)?t.NoOfSegments.One:i.point.x+i.margin.right<r.point.x-r.margin.left?t.NoOfSegments.Three:e.sourceWrapper!==e.targetWrapper&&(Wi(e.sourceWrapper).containsPoint(d)||Wi(e.targetWrapper).containsPoint(h))?t.NoOfSegments.Three:i.corners.bottom<=r.corners.top?t.NoOfSegments.Five:i.corners.top>=r.corners.top?t.NoOfSegments.Five:void 0!==a&&a.offsetY<=r.corners.top||void 0===a&&i.corners.right<=r.corners.top?t.NoOfSegments.Five:(void 0!==a&&a.offsetY>=r.corners.bottom||void 0===a&&(i.corners.right,r.corners.bottom),t.NoOfSegments.Five);return n}(e,i,r,a):"Right"===i.direction&&"Right"===r.direction?n=function(e,i,r){var o,n=e.sourcePortWrapper,a=e.targetPortWrapper,s=i.point.x-r.point.x,h=i.point.y-r.point.y;r.margin={left:10,right:10,top:10,bottom:10},i.margin={left:10,right:10,top:10,bottom:10},o=i.corners.right>=r.corners.right?void 0!==n&&(n.offsetY<r.corners.top||n.offsetY>r.corners.bottom)||void 0===n&&i.corners.middleRight.y<r.corners.top?t.NoOfSegments.Three:void 0!==n&&n.offsetY>r.corners.bottom+r.margin.bottom&&i.corners.top>r.corners.bottom||void 0===n&&i.corners.middleRight.y>r.corners.bottom?t.NoOfSegments.Three:void 0!==n&&n.offsetY<r.corners.top&&i.corners.bottom>r.corners.top||void 0===n&&i.corners.middleRight.y>r.corners.bottom?t.NoOfSegments.Three:i.corners.right<r.corners.left||r.corners.right<i.corners.left?t.NoOfSegments.Five:0===s||0===h?t.NoOfSegments.One:t.NoOfSegments.Three:void 0!==a&&i.corners.bottom<a.offsetY||void 0===a&&i.corners.bottom<r.corners.middleRight.y?t.NoOfSegments.Three:void 0!==a&&i.corners.top>a.offsetY||void 0===a&&i.corners.top>r.corners.middleRight.y?t.NoOfSegments.Three:void 0!==a&&(void 0!==n&&n.offsetX<r.corners.left&&n.offsetX!==a.offsetX&&n.offsetY!==a.offsetY&&Math.abs(i.corners.right-r.corners.left)<=20||void 0===n&&i.corners.right<r.corners.left&&i.corners.center.x!==r.corners.center.x&&i.corners.center.y!==r.corners.center.y)?t.NoOfSegments.Three:i.corners.right<r.corners.left?t.NoOfSegments.Five:0===s||0===h?t.NoOfSegments.One:t.NoOfSegments.Three;return o}(e,i,r):"Right"===i.direction&&"Top"===r.direction?n=function(e,i,r,o){var n,a=e.targetPortWrapper,s=e.sourcePortWrapper,h={x:Math.max(i.point.x,i.corners.right),y:i.point.y},d={x:r.point.x,y:Math.min(r.point.y,r.corners.top)};if(r.margin={left:5,right:5,top:5,bottom:5},i.margin={top:5,bottom:5,left:5,right:5},o){var l=void 0;l=s,s=a,a=l}n=void 0!==s&&s.offsetY<r.corners.top-r.margin.top||void 0===s&&i.corners.bottom<r.corners.top-r.margin.top?i.corners.bottom<r.corners.top?void 0!==a&&i.corners.right+i.margin.right<a.offsetX||void 0===a&&i.corners.right+i.margin.right<r.corners.topCenter.x?t.NoOfSegments.Two:t.NoOfSegments.Four:void 0!==a&&i.corners.left>a.offsetX||void 0===a&&i.corners.left>r.corners.topCenter.x?t.NoOfSegments.Four:t.NoOfSegments.Two:void 0!==s&&Math.abs(i.corners.right-r.corners.left)<=25&&Math.abs(s.offsetY-r.corners.top)<=25?t.NoOfSegments.Two:void 0!==a&&Math.abs(a.offsetX-i.corners.topCenter.x)>=25&&i.corners.middleRight.y<a.offsetY?t.NoOfSegments.Two:i.corners.right<r.corners.left?t.NoOfSegments.Four:e.sourceWrapper!==e.targetWrapper&&(Wi(e.sourceWrapper).containsPoint(d)||Wi(e.targetWrapper).containsPoint(h))?t.NoOfSegments.Two:t.NoOfSegments.Four;return n}(e,i,r,a):"Right"===i.direction&&"Bottom"===r.direction?n=function(e,i,r,o){i.margin={left:10,right:10,top:10,bottom:10},r.margin={left:10,right:10,top:10,bottom:10};var n,a=e.sourcePortWrapper,s=e.targetPortWrapper;Math.max(i.point.x,i.corners.right),i.point.y,r.point.x,Math.max(r.point.y,r.corners.bottom);if(o){var h=void 0;h=a,a=s,s=h}n=void 0!==a&&a.offsetY>r.corners.bottom+r.margin.bottom||void 0===a&&i.corners.middleRight.y>r.corners.bottom+r.margin.bottom?i.corners.top>r.corners.bottom?void 0!==s&&i.corners.right+i.margin.right<s.offsetX||void 0===s&&i.corners.right+i.margin.right<r.corners.bottomCenter.x?t.NoOfSegments.Two:t.NoOfSegments.Four:void 0!==s&&i.corners.left>s.offsetX||void 0===s&&i.corners.left>r.corners.bottomCenter.x?t.NoOfSegments.Four:t.NoOfSegments.Two:void 0!==a&&Math.abs(i.corners.right-r.corners.left)<=25&&Math.abs(a.offsetY-r.corners.bottom)<=25?t.NoOfSegments.Two:(i.corners.right,r.corners.left,t.NoOfSegments.Four);return n}(e,i,r,a):"Bottom"===i.direction&&"Top"===r.direction?n=function(e,i){var r,o=e.point.x-i.point.x,n=(e.point.y,i.point.y,e.point.x,Math.max(e.point.y,e.corners.bottom),i.point.x,Math.min(i.point.y,i.corners.top),10);e.corners.right+n<i.corners.left-n||e.corners.left-n>i.corners.right+n||(n=0);e.margin={left:n,right:n,top:n,bottom:n},i.margin={left:n,right:n,top:n,bottom:n},r=0===o&&e.corners.bottom<i.corners.top?t.NoOfSegments.One:e.corners.bottom+e.margin.bottom<i.corners.top-i.margin.top?t.NoOfSegments.Three:e.corners.right+e.margin.right<i.corners.left-i.margin.left?t.NoOfSegments.Five:(e.corners.left,e.margin.left,i.corners.right,i.margin.right,t.NoOfSegments.Five);return r}(i,r):"Bottom"===i.direction&&"Bottom"===r.direction?(i.margin={left:10,right:10,top:10,bottom:10},r.margin={left:10,right:10,top:10,bottom:10},n=function(e,i,r){var o,n=e.sourcePortWrapper,a=e.targetPortWrapper,s=Math.round(Math.abs(i.point.x-r.point.x)),h=Math.round(Math.abs(r.point.y-r.point.y));o=i.corners.bottom<r.corners.bottom?void 0!==n&&n.offsetX<r.corners.left-r.margin.left||void 0===n&&i.corners.bottomCenter.x<r.corners.left-r.margin.left?t.NoOfSegments.Three:void 0!==n&&n.offsetX>r.corners.right+r.margin.right||void 0===n&&i.corners.bottomCenter.x>r.corners.right+r.margin.right?t.NoOfSegments.Three:i.corners.bottom<r.corners.top?t.NoOfSegments.Five:0===s||0===h?t.NoOfSegments.One:t.NoOfSegments.Three:void 0!==a&&i.corners.left>a.offsetX||void 0===a&&i.corners.left>r.corners.left?t.NoOfSegments.Three:void 0!==a&&i.corners.right<a.offsetX||void 0===a&&i.corners.right<r.corners.right?t.NoOfSegments.Three:i.corners.top>r.corners.bottom?t.NoOfSegments.Five:0===s||0===h?t.NoOfSegments.One:t.NoOfSegments.Three;return o}(e,i,r)):"Bottom"===i.direction&&"Left"===r.direction?n=function(e,i,r,o){var n,a=e.sourcePortWrapper,s=e.targetPortWrapper;i.point.x,Math.max(i.point.y,i.corners.bottom),Math.min(r.point.x,r.corners.left),r.point.y;if(o){var h=void 0;h=a,a=s,s=h}n=void 0!==a&&a.offsetX<r.corners.left-r.margin.left||void 0===a&&i.corners.bottomCenter.x<r.corners.bottomLeft.x-r.margin.left?i.corners.right<r.corners.left?void 0!==s&&i.corners.bottom+i.margin.bottom<s.offsetY||void 0===s&&i.corners.bottom+i.margin.bottom<r.corners.middleLeft.y?t.NoOfSegments.Two:t.NoOfSegments.Four:void 0!==s&&i.corners.top>s.offsetY||void 0===s&&i.corners.top>r.corners.middleLeft.y?t.NoOfSegments.Four:t.NoOfSegments.Two:void 0!==s&&Math.abs(i.corners.right-r.corners.left)<=25&&Math.abs(s.offsetY-i.corners.bottom)<=25?t.NoOfSegments.Two:t.NoOfSegments.Four;return n}(e,i,r,a):"Left"===i.direction&&"Left"===r.direction?n=function(e,i,r){var o=e.sourcePortWrapper,n=e.targetPortWrapper;i.margin={left:10,right:10,top:10,bottom:10},r.margin={left:10,right:10,top:10,bottom:10};var a,s=Math.round(Math.abs(i.point.x-r.point.x)),h=Math.round(Math.abs(i.point.y-r.point.y));a=i.corners.left<r.corners.left?void 0!==n&&i.corners.bottom+i.margin.bottom<n.offsetY||void 0===n&&i.corners.bottom+i.margin.bottom<r.corners.middleLeft.y?t.NoOfSegments.Three:void 0!==n&&i.corners.top-i.margin.top>n.offsetY||void 0===n&&i.corners.top-i.margin.top>r.corners.middleLeft.y?t.NoOfSegments.Three:i.corners.right<r.corners.left||r.corners.right<i.corners.left?t.NoOfSegments.Five:0===s||0===h?t.NoOfSegments.One:t.NoOfSegments.Three:void 0!==o&&o.offsetY<r.corners.top-r.margin.top||void 0===o&&i.corners.middleLeft.y<r.corners.top?t.NoOfSegments.Three:void 0!==o&&o.offsetY>r.corners.bottom+r.margin.bottom||void 0===o&&i.corners.middleLeft.y>r.corners.bottom+r.margin.bottom?t.NoOfSegments.Three:i.corners.left>r.corners.right?t.NoOfSegments.Five:0===s||0===h?t.NoOfSegments.One:t.NoOfSegments.Three;return a}(e,i,r):"Left"===i.direction&&"Top"===r.direction?n=function(e,i,r,o){var n,a=e.sourcePortWrapper,s=e.targetPortWrapper,h={x:Math.min(i.point.x,i.corners.left),y:i.point.y},d={x:r.point.x,y:Math.min(r.point.y,r.corners.top)};if(o){var l=void 0;l=a,a=s,s=l}n=void 0!==a&&a.offsetY<r.corners.top-r.margin.top||void 0===a&&(i.corners.bottom<r.corners.top-r.margin.top||i.corners.middleLeft.y<r.corners.top-r.margin.top)?i.corners.bottom<r.corners.top?void 0!==s&&i.corners.left-i.margin.left>s.offsetX||void 0===s&&i.corners.left-i.margin.left>r.corners.topCenter.x?t.NoOfSegments.Two:t.NoOfSegments.Four:void 0!==s&&i.corners.right<s.offsetX||void 0===s&&i.corners.right<r.corners.topCenter.x?t.NoOfSegments.Four:t.NoOfSegments.Two:void 0!==a&&Math.abs(i.corners.left-r.corners.right)<=25&&Math.abs(a.offsetY-r.corners.top)<=25?t.NoOfSegments.Two:e.sourceWrapper!==e.targetWrapper&&(Wi(e.sourceWrapper).containsPoint(d)||Wi(e.targetWrapper).containsPoint(h))?t.NoOfSegments.Two:(i.corners.left,r.corners.right,t.NoOfSegments.Four);return n}(e,i,r,a):"Top"===i.direction&&"Top"===r.direction&&(n=function(e,i,r){var o=e.sourcePortWrapper,n=e.targetPortWrapper,a=Math.round(Math.abs(i.point.x-r.point.x)),s=Math.round(Math.abs(i.point.y-r.point.y));i.margin={left:10,right:10,top:10,bottom:10};var h;r.margin={left:10,right:10,top:10,bottom:10},h=i.corners.top<r.corners.top?void 0!==n&&i.corners.left>n.offsetX||void 0===n&&i.corners.left>r.corners.left?t.NoOfSegments.Three:void 0!==n&&i.corners.right<n.offsetX||void 0===n&&i.corners.right<r.corners.right?t.NoOfSegments.Three:i.corners.bottom<r.corners.top?t.NoOfSegments.Five:0===a||0===s?t.NoOfSegments.One:t.NoOfSegments.Three:void 0!==o&&o.offsetX>r.corners.right||void 0===o&&i.corners.left>r.corners.right?t.NoOfSegments.Three:void 0!==o&&o.offsetX<r.corners.left||void 0===o&&i.corners.bottomRight.x<r.corners.left?t.NoOfSegments.Three:i.corners.top>r.corners.bottom?t.NoOfSegments.Five:0===a||0===s?t.NoOfSegments.One:t.NoOfSegments.Three;return h}(e,i,r));a&&pt(i,r);return function(e,i,r,o,n){var a,s=e.sourceWrapper,h=e.targetWrapper,d=(e.targetPortWrapper,s.corners),l=h.corners,c=20;if(!(r.direction===o.direction&&i!==t.NoOfSegments.Five||r.direction!==ft(o.direction)&&i!==t.NoOfSegments.Three))switch(r.direction){case"Left":d.middleLeft.x>l.middleRight.x&&(c=Math.min(c,(d.middleLeft.x-l.middleRight.x)/2));break;case"Right":d.middleRight.x<l.middleLeft.x&&(c=Math.min(c,(l.middleLeft.x-d.middleRight.x)/2));break;case"Top":d.topCenter.y>l.bottomCenter.y&&(c=Math.min(c,(d.topCenter.y-l.bottomCenter.y)/2));break;case"Bottom":d.bottomCenter.y<l.topCenter.y&&(c=Math.min(c,(l.topCenter.y-d.bottomCenter.y)/2))}if(c=st(d,r,c),n&&(c=Math.max(c,n)),i===t.NoOfSegments.One&&(a=[r.point,o.point]),i===t.NoOfSegments.Two&&(a=ht(r,o)),i===t.NoOfSegments.Three&&(a=dt(e,r,o,c)),i===t.NoOfSegments.Four){var p=void 0;a=lt(r,o,p,a,c)}return i===t.NoOfSegments.Five&&(a=function(t,e,i){void 0===i&&(i=20);var r,o,n=i,a=t.corners.left-t.margin.left,s=t.corners.right+t.margin.right,h=t.corners.bottom+t.margin.bottom,d=t.corners.top-t.margin.top,l=e.corners.left-e.margin.left,c=e.corners.right+e.margin.right,p=e.corners.bottom+e.margin.bottom,g=e.corners.top-e.margin.top;switch(t.direction){case"Left":(d>g&&d<p||h<p&&h>g)&&a>l&&a<=c&&i>=20&&(n=t.point.x-e.corners.left+n),o=et(t.point,n,180);break;case"Top":(a>l&&a<c||s<c&&s>l)&&d>g&&d<=p&&i>=20&&(n=t.point.y-e.corners.top+n),o=et(t.point,n,270);break;case"Right":(d>g&&d<p||h<p&&h>g)&&s<c&&s>=l&&i>=20&&(n=e.corners.right-t.point.x+n),o=et(t.point,n,0);break;case"Bottom":(a>l&&a<c||s<c&&s>l)&&h<p&&h>=g&&i>=20&&(n=e.corners.bottom-t.point.y+n),o=et(t.point,n,90)}if(r=[t.point,o],"Top"===t.direction||"Bottom"===t.direction){var u=t.direction;t.direction=o.x>e.point.x?"Left":"Right",t.point=o,r=lt(t,e,u,r)}else{var u=t.direction;t.direction=o.y>e.point.y?"Top":"Bottom",t.point=o,r=lt(t,e,u,r)}return r}(r,o,c)),a}(e,n,i,r,o)}(e,u,f)}return c}(e,p.direction,g.direction,p.point,g.point);G(e),(e.sourceWrapper||e.targetWrapper)&&function(t,e,i){var r,o=t.sourcePortWrapper,n=t.targetPortWrapper,a=t.sourceWrapper,s=e.point,h={left:0,right:0,top:0,bottom:0},d={x:0,y:0},l="Top";a?(s=i.point,h=e.margin):(a=t.targetWrapper,h=i.margin);if("Orthogonal"===t.type)if(t.segments&&t.segments.length>0&&t.sourceWrapper&&t.segments[0].direction)e.direction=t.segments[0].direction,d=tt(a.corners,e.direction),r=tt(a.corners,ft(e.direction)),d=it(t,a,d,r,!1);else{var c={corners:null,direction:null,point:s,margin:h},p={corners:null,direction:null,point:null,margin:null};J(a,c,p,t),d=p.point,l=p.direction}else{var g=void 0;t.segments&&t.segments.length>1&&(g=a===t.sourceWrapper?t.segments[0].point:t.segments[t.segments.length-2].point),d=it(t,a,a.bounds.center,t.segments&&t.segments.length>1?g:s,a===t.targetWrapper)}a===t.sourceWrapper?(e.direction=e.direction||l,e.point=d,t.sourcePortWrapper&&(e.point={x:o.offsetX,y:o.offsetY})):(i.direction=i.direction||l,i.point=d,t.targetPortWrapper&&(i.point={x:n.offsetX,y:n.offsetY}))}(e,p,g);if("Straight"===e.type||"Bezier"===e.type)c=U(e,p,g);else if("Orthogonal"===e.type&&e.segments&&e.segments.length>0&&null!==e.segments[0].length&&null!==e.segments[0].direction)c=function(t,e,i,r,o,n,a){var s,h,d,l,c=[];G(t);var p;if(t.segments.length>0){for(var g=0;g<t.segments.length;g++){var u=t.segments[g];if(0===g&&void 0!==t.sourcePortWrapper&&(l={x:n.offsetX,y:n.offsetY},d=gt(l,Wi(r),r.bounds,!1),u.direction===ft(d)&&(u.direction=d)),g>0&&t.segments[g-1].direction===u.direction)g=Z(t,g,e);else{var f=t.segments[g-1];e.point=u.direction?N(e,u):f.points[f.points.length-1]}if(g===t.segments.length-1)if(a||o?t.targetWrapper&&void 0===t.targetPortWrapper?(K(t,e),h=j(t,e,i)):h=W(t,e,i):h=B(t,e,i),X(h,t,e),u.points=[],h.length>=2)for(s=0;s<h.length;s++)u.points.push(h[s]);else p=g;if(n&&0===g){var m=_(t,n,r);m&&(e.point=m)}}void 0!==p&&(p===t.segments.length-1&&(t.segments[p-1].direction=null,t.segments[p-1].length=null),t.segments.splice(p,1)),c=Q(t,c)}return c}(e,p,g,s,h,d,l);else{var m=void 0;p.direction?m=st(s.bounds,p,20):p.direction=g.direction?void 0!==e.targetPortWrapper?g.direction:ft(g.direction):wr.direction(p.point,g.point),e.segments[0].points=c=dt(e,p,g,m)}return c}(e,o,e.targetPoint,i),rt(e,r[0],!1),rt(e,r[r.length-1],!0),r}function N(t,e){var i,r,o;return t.direction=e.direction,e.points=[],e.points.push(t.point),o="Left"===e.direction||"Top"===e.direction?-e.length:e.length,r="Left"===e.direction||"Right"===e.direction?0:90,i=et(t.point,o,r),e.points.push(i),i}function B(t,e,i){var r,o,n;if(e.corners=t.sourceWrapper?t.sourceWrapper.corners:void 0,t.sourcePortWrapper){n=gt({x:t.sourcePortWrapper.offsetX,y:t.sourcePortWrapper.offsetY},Wi(t.sourceWrapper),t.sourceWrapper.bounds,!1),!e.corners||"Bottom"!==e.direction&&"Top"!==e.direction?!e.corners||"Left"!==e.direction&&"Right"!==e.direction||i.point.y>e.corners.top&&i.point.y<e.corners.bottom&&(o=e.point.x>i.point.x?"Left":"Right"):i.point.x>e.corners.left&&i.point.x<e.corners.right&&(o=e.point.y>i.point.y?"Top":"Bottom")}if(t.sourcePortWrapper&&n===ft(o)){var a;("Left"===n||"Right"===n)&&e.point.y>=e.corners.top&&e.point.y<=e.corners.center.y&&i.point.y>=e.corners.top&&i.point.y<=e.corners.center.y?(e.direction="Top",a=e.point.y-e.corners.top+20):("Left"===n||"Right"===n)&&e.point.y>e.corners.center.y&&e.point.y<=e.corners.bottom&&i.point.y>e.corners.center.y&&i.point.y<=e.corners.bottom?(e.direction="Bottom",a=e.corners.bottom-e.point.y+20):("Top"===n||"Bottom"===n)&&e.point.x>=e.corners.left&&e.point.x<=e.corners.center.x&&i.point.x>=e.corners.left&&i.point.x<=e.corners.center.x?(e.direction="Left",a=e.point.x-e.corners.left+20):("Top"===n||"Bottom"===n)&&e.point.x<=e.corners.right&&e.point.x>e.corners.center.x&&i.point.x<=e.corners.right&&i.point.x<e.corners.center.x&&(e.direction="Right",a=e.corners.right-e.point.x+20),e.direction&&a&&(r=dt(t,e,i,a,!0))}else e.direction=o||F(e.direction,e.point,i.point),r=ht(e,i);return r}function j(t,e,i){var r;i.corners=t.targetWrapper.corners,J(t.targetWrapper,e,i,t);var o=F(i.direction,e.point,i.point);if(e.direction!==i.direction||"Left"!==e.direction&&"Right"!==e.direction)e.direction=o,r=ht(e,i);else{e.direction=o,r=dt(t,e,i,t.targetWrapper.width/2+20);e.point=r[1],J(t.targetWrapper,e,i,t),r=dt(t,e,i)}return r}function H(t,e,i){var r;i.corners=t.targetWrapper.corners;var o,n;"Left"!==e.direction&&"Right"!==e.direction?i.corners.center.y!==e.point.y||i.corners.left<=e.point.x&&e.point.x<=i.corners.right?i.corners.center.y===e.point.y&&"Bottom"===t.segments[t.segments.length-2].direction||i.corners.center.y>e.point.y&&e.point.y>=i.corners.top?(o="Top",n=e.point.y-i.corners.top+20):i.corners.center.y===e.point.y&&"Top"===t.segments[t.segments.length-2].direction||i.corners.center.y<e.point.y&&e.point.y<=i.corners.bottom?(o="Bottom",n=i.corners.bottom-e.point.y+20):void 0!==t.sourcePortWrapper&&void 0!==t.targetPortWrapper&&e.corners.top<=e.point.y&&e.point.y<=e.corners.bottom&&(o=e.direction,n=e.point.y>i.point.y?e.point.y-e.corners.top+20:e.corners.bottom-e.point.y+20):(o="Top",n=i.corners.height/2+20):i.corners.center.x!==e.point.x||i.corners.top<e.point.y&&e.point.y<=i.corners.bottom?i.corners.center.x===e.point.x&&"Right"===t.segments[t.segments.length-2].direction||i.corners.center.x>e.point.x&&e.point.x>=i.corners.left?(o="Left",n=e.point.x-i.corners.left+20):i.corners.center.x===e.point.x&&"Left"===t.segments[t.segments.length-2].direction||i.corners.center.x<=e.point.x&&e.point.x<=i.corners.right?(o="Right",n=i.corners.right-e.point.x+20):void 0!==t.sourcePortWrapper&&void 0!==t.targetPortWrapper&&e.corners.left<=e.point.x&&e.point.x<=e.corners.right&&(o=e.direction,n=e.point.x>i.point.x?e.point.x-e.corners.left+20:e.corners.right-e.point.x+20):(o="Left",n=i.corners.width/2+20);var a="Left"===o||"Top"===o?-n:n,s="Left"===o||"Right"===o?0:90;r=e.point,e.point=et(e.point,a,s),e.direction=wr.direction(e.point,i.point),void 0===t.sourcePortWrapper||void 0===t.targetPortWrapper||e.corners.center.x!==i.corners.center.x&&e.corners.center.y!==i.corners.center.y||(e.direction=i.direction);var h=dt(t,e,i);return h.splice(0,0,r),h}function W(t,e,i){var r;i.corners=t.targetWrapper.corners;var o;if(void 0!==t.sourcePortWrapper){o=gt({x:t.sourcePortWrapper.offsetX,y:t.sourcePortWrapper.offsetY},Wi(t.sourceWrapper),t.sourceWrapper.bounds,!1)}var n=function(t,e,i,r){var o=!1;switch(i.direction){case"Left":void 0!==t.sourcePortWrapper&&void 0!==t.targetPortWrapper&&"Right"===r&&e.point.x>i.point.x&&e.point.y>=e.corners.top&&e.point.y<=e.corners.bottom||("Bottom"===r&&e.point.y>i.point.y||"Top"===r&&e.point.y<i.point.y)&&e.point.x>=e.corners.left&&e.point.x<=e.corners.right?(e.direction="Right"===r?e.point.y>i.point.y?"Top":"Bottom":e.point.x<i.point.x?"Right":"Left",o=!0):e.point.x>i.point.x&&(e.point.y>i.point.y||e.point.y<i.point.y)&&!(i.corners.top>e.point.y&&i.corners.bottom<e.point.y)?e.direction="Left":e.point.x<i.point.x&&e.point.y>i.point.y||e.point.x>i.point.x&&e.point.y<=i.point.y&&i.corners.top<e.point.y&&i.corners.center.y>=e.point.y?e.direction="Top":e.point.x<i.point.x&&e.point.y<i.point.y||e.point.x>i.point.x&&e.point.y>i.point.y&&i.corners.bottom<e.point.y&&i.corners.center.y>e.point.y?e.direction="Bottom":e.point.y===i.point.y&&e.point.x<i.point.x&&(e.direction="Right");break;case"Right":void 0!==t.sourcePortWrapper&&void 0!==t.targetPortWrapper&&("Bottom"===r&&e.point.y>i.point.y||"Top"===r&&e.point.y<i.point.y)&&e.point.x>i.point.x&&e.point.x>=e.corners.left&&e.point.x<=e.corners.right?(e.direction=e.point.x>i.point.x?"Left":"Right",o=!0):void 0!==t.sourcePortWrapper&&void 0!==t.targetPortWrapper&&"Left"===r&&e.point.x<i.point.x&&e.point.y>=e.corners.top&&e.point.y<=e.corners.bottom?(e.direction=e.point.y>i.point.y?"Top":"Bottom",o=!0):e.point.x<i.point.x&&i.corners.top<=e.point.y&&i.corners.bottom>=e.point.y&&e.point.y===i.point.y?e.direction="Top":e.point.y>i.point.y&&e.point.x>i.point.x?e.direction="Top":e.point.y<i.point.y&&e.point.x>i.point.x?e.direction="Bottom":e.point.x<i.point.x&&(e.point.y>i.point.y||e.point.y<i.point.y)?e.direction="Right":e.point.y===i.point.y&&e.point.x>i.point.x&&(e.direction="Left");break;case"Top":void 0!==t.sourcePortWrapper&&void 0!==t.targetPortWrapper&&"Bottom"===r&&e.point.y>i.point.y&&e.point.x>=e.corners.left&&e.point.x<=e.corners.right||("Right"===r&&e.point.x>i.point.x||"Left"===r&&i.point.y>e.point.y&&i.point.x>e.point.x)&&e.point.y>=e.corners.top&&e.point.y<=e.corners.bottom?(e.direction="Bottom"===r?e.point.x>i.point.x?"Left":"Right":e.point.y<i.point.y?"Bottom":"Top",o=!0):e.point.x===i.point.x&&e.point.y<i.point.y?e.direction="Bottom":e.point.y>i.point.y&&e.point.x>i.corners.left&&e.point.x<i.corners.right?e.direction="Left":e.point.y>=i.point.y?e.direction="Top":e.point.y<i.point.y&&e.point.x>i.point.x?e.direction="Left":e.point.y<i.point.y&&e.point.x<i.point.x&&(e.direction="Right");break;case"Bottom":void 0!==t.sourcePortWrapper&&void 0!==t.targetPortWrapper&&(("Right"===r||"Left"===r&&i.point.x>e.point.x)&&e.point.y>i.point.y&&e.point.y>=e.corners.top&&e.point.y<=e.corners.bottom||"Top"===r&&e.point.y<i.point.y&&e.point.x>=e.corners.left&&e.point.x<=e.corners.right)?(e.direction="Right"===r||"Left"===r?e.point.y>i.point.y?"Top":"Bottom":e.point.x>i.point.x?"Left":"Right",o=!0):e.point.y<i.point.y&&e.point.x>i.corners.left&&i.corners.right>e.point.x?e.point.y<i.point.y&&e.point.x>i.corners.left&&i.corners.center.x>=e.point.x?e.direction="Left":e.point.y<i.point.y&&e.point.x<i.corners.right&&i.corners.center.x<e.point.x&&(e.direction="Right"):e.point.y>i.point.y&&e.point.x>i.point.x?e.direction="Left":e.point.y>i.point.y&&e.point.x<i.point.x?e.direction="Right":e.point.y<=i.point.y&&(e.point.x>i.point.x||i.point.x>e.point.x)&&(e.direction="Bottom")}return o}(t,e,i,o);return void 0!==t.sourcePortWrapper&&void 0!==t.targetPortWrapper&&i.direction===ft(o)&&(("Left"===i.direction&&e.point.x>i.point.x||"Right"===i.direction&&e.point.x<i.point.x)&&e.point.y>=e.corners.top&&e.point.y<=e.corners.bottom||"Bottom"===i.direction&&e.point.y<i.point.y&&e.point.x>=e.corners.left&&e.point.x<=e.corners.right)?r=H(t,e,i):e.direction===i.direction?r=dt(t,e,i):("Left"===i.direction&&e.point.x>i.point.x||"Right"===i.direction&&e.point.x<i.point.x)&&("Top"===e.direction||"Bottom"===e.direction)&&e.point.y<=i.point.y&&i.corners.top<=e.point.y&&i.corners.bottom>=e.point.y||"Top"===i.direction&&e.point.y>i.point.y||"Bottom"===i.direction&&e.point.y<i.point.y&&i.corners.left<=e.point.x&&i.corners.right>=e.point.x?r=H(t,e,i):void 0!==t.sourceWrapper&&void 0!==t.targetWrapper&&void 0!==t.targetPortWrapper&&("Left"===e.direction||"Right"===e.direction)&&e.point.y>=e.corners.top&&e.point.y<=e.corners.bottom&&("Top"===i.direction||"Bottom"===i.direction)&&i.corners.center.x===e.corners.center.x?(e.direction="Top"===i.direction?"Bottom":"Top",r=dt(t,e,i,"Top"===i.direction?e.corners.bottom-e.point.y+20:e.point.y-e.corners.top+20)):void 0!==t.sourceWrapper&&void 0!==t.targetWrapper&&void 0!==t.targetPortWrapper&&("Top"===e.direction||"Bottom"===e.direction)&&e.point.x>=e.corners.left&&e.point.x<=e.corners.right&&("Left"===i.direction||"Right"===i.direction)&&i.corners.center.y===e.corners.center.y?(e.direction="Left"===i.direction?"Right":"Left",r=dt(t,e,i,"Left"===i.direction?e.corners.right-e.point.x+20:e.point.x-e.corners.left+20)):r=n?dt(t,e,i,"Left"===e.direction||"Right"===e.direction?"Left"===e.direction?e.point.x-e.corners.left+20:e.corners.right-e.point.x+20:"Top"===e.direction?e.point.y-e.corners.top+20:e.corners.bottom-e.point.y+20):ht(e,i),r}function _(t,e,i){var r,o={x:e.offsetX,y:e.offsetY},n=Wi(i),a=gt(o,n,i.bounds,!1),s=t.segments[0];return s.direction!==a&&(!function(t,e,i,r,o,n){var a,s,h=[];h.push(r);r.y===o.y&&("Left"===e&&o.x<r.x||"Right"===e&&o.x>r.x)||r.x===o.x&&("Top"===e&&o.y<r.y||"Bottom"===e&&o.y>r.y)||("Top"===e||"Bottom"===e?"Top"===e&&o.y<r.y&&o.y>r.y-13||"Bottom"===e&&o.y>r.y&&o.y<r.y+13?(s="Top"===e?i.top-13:i.bottom+13,h.push({x:r.x,y:s}),h.push({x:r.x+(o.x-r.x)/2,y:s}),h.push({x:r.x+(o.x-r.x)/2,y:o.y})):Math.abs(r.x-o.x)>13&&("Top"===e&&o.y<r.y||"Bottom"===e&&o.y>r.y)?h.push({x:r.x,y:o.y}):(s="Top"===e?i.top-13:i.bottom+13,a=o.x<r.x?i.left-13:i.right+13,h.push({x:r.x,y:s}),h.push({x:o.x,y:s})):"Left"===e&&o.x<r.x&&o.x>r.x-13||"right"===e&&o.x>r.x&&o.x<r.x+13?(a="Left"===e?i.left-13:i.right+13,h.push({x:a,y:r.y}),h.push({x:a,y:r.y+(o.y-r.y)/2}),h.push({x:o.x,y:r.y+(o.y-r.y)/2})):Math.abs(r.y-o.y)>13&&("Left"===e&&o.x<r.x||"Right"===e&&o.x>r.x)?h.push({x:o.x,y:r.y}):(a="Left"===e?i.left-13:i.right+13,h.push({x:a,y:r.y}),h.push({x:a,y:o.y})),n&&(h.push(t.points[0]),h.reverse()),t.points=h)}(s,a,n,s.points[0],s.points[s.points.length-1],!1),r=s.points[s.points.length-1],s.direction=wr.direction(s.points[s.points.length-2],s.points[s.points.length-1])),r}function X(t,e,i){var r,o=e.segments[e.segments.length-2],n=o.points[o.points.length-1];("Top"!==o.direction&&"Bottom"!==o.direction||n.x!==t[1].x)&&("Left"!==o.direction&&"Right"!==o.direction||n.y!==t[1].y)||(o.points[o.points.length-1]=t[1],r=wr.direction(o.points[0],o.points[o.points.length-1]),void 0!==e.sourceWrapper&&void 0===e.sourcePortWrapper&&r===ft(o.direction)&&("Left"===o.direction||"Right"===o.direction?o.points[0].x="Right"===o.direction?o.points[0].x-e.sourceWrapper.corners.width:o.points[0].x+e.sourceWrapper.corners.width:o.points[0].y="Bottom"===o.direction?o.points[0].y-e.sourceWrapper.corners.height:o.points[0].y+e.sourceWrapper.corners.height),o.direction=r,o.length=wr.distancePoints(o.points[0],o.points[o.points.length-1]),t.splice(0,1))}function Y(t){var e=[],i=Ee(t,t.corners);i.push(i[0]);for(var r=0;r<i.length-1;r++)e.push(function(t,e){return{x1:t.x,y1:t.y,x2:e.x,y2:e.y}}(i[r],i[r+1]));return e}function V(t,e,i){var r,o=t.rotateAngle+t.parentTransform;if(o){if(o<45)return e;if(o<=135)r={width:e.width,height:e.height,topLeft:e.bottomLeft,topCenter:e.middleLeft,topRight:e.topLeft,middleLeft:e.bottomCenter,center:i.center,middleRight:e.topCenter,bottomLeft:e.bottomRight,bottomCenter:e.middleRight,bottomRight:e.topRight,left:i.left,right:i.right,top:i.top,bottom:i.bottom};else if(o<=225)r={width:e.width,height:e.height,topLeft:e.bottomLeft,topCenter:e.bottomCenter,topRight:e.bottomRight,middleLeft:e.middleRight,center:i.center,middleRight:e.middleLeft,bottomLeft:e.topLeft,bottomCenter:e.topCenter,bottomRight:e.topRight,left:i.left,right:i.right,top:i.top,bottom:i.bottom};else{if(!(o<=315))return e;r={width:e.width,height:e.height,topLeft:e.topRight,topCenter:e.middleRight,topRight:e.bottomRight,middleLeft:e.topCenter,center:i.center,middleRight:e.bottomCenter,bottomLeft:e.topLeft,bottomCenter:e.middleLeft,bottomRight:e.bottomLeft,left:i.left,right:i.right,top:i.top,bottom:i.bottom}}return r}return e}function U(t,e,i){var r=[];if(t.segments&&t.segments.length>0){var o=void 0,n=[],a=e.point;for(o=0;o<t.segments.length;o++){var s=t.segments[o];if((n=[]).push(a),o!==t.segments.length-1?(n.push(s.point),a=s.point):n.push(i.point),t.segments[o].points=n,t.segments.length>1&&wr.equals(s.points[0],s.points[1])&&t.segments.splice(o,1),s)for(var h=0;h<s.points.length;h++)(h>0||0===o)&&r.push(s.points[h])}}return r}function F(t,e,i){return"Top"===t||"Bottom"===t?i.x>e.x?"Right":"Left":i.y>e.y?"Bottom":"Top"}function G(t){if("Straight"===t.type||"Bezier"===t.type){if(0===t.segments.length||t.segments.length>0&&!wr.isEmptyPoint(t.segments[t.segments.length-1].point)){var e=void 0;e="Bezier"===t.type?new Ro(t,"segments",{type:"Bezier"},!0):new ko(t,"segments",{type:"Straight"},!0),t.segments.push(e)}}else if(0===t.segments.length||t.segments[t.segments.length-1].direction){e=new No(t,"segments",{type:"Orthogonal"},!0);t.segments.push(e)}}function Z(t,e,i){var r=t.segments[e],o="Left"===r.direction||"Top"===r.direction?-r.length:r.length,n="Left"===r.direction||"Right"===r.direction?0:90,a=et(i.point,o,n);return t.segments[e-1].length+=r.length,t.segments[e-1].points[1]=i.point=a,t.segments.splice(e,1),--e}function q(t,e,i){var r,o;if(t.sourcePortWrapper){o=gt({x:t.sourcePortWrapper.offsetX,y:t.sourcePortWrapper.offsetY},Wi(t.sourceWrapper),t.sourceWrapper.bounds,!1)}J(t.targetWrapper,e,i,t);var n=F(i.direction,e.point,i.point);if(void 0===t.sourcePortWrapper||e.direction!==i.direction||("Top"!==e.direction&&"Bottom"!==e.direction||e.corners.center.x!==i.corners.center.x)&&("Left"!==e.direction&&"Right"!==e.direction||e.corners.center.y!==i.corners.center.y))if(i.point.x>=e.corners.left&&i.point.x<=e.corners.right&&e.point.y>=e.corners.top&&e.point.y<=e.corners.bottom){e.direction=i.point.y>e.point.y?"Bottom":"Top";r=dt(t,e,i,"Top"===e.direction?e.point.y-e.corners.top+20:e.corners.bottom-e.point.y+20)}else if(t.sourcePortWrapper&&o===ft(n)){var a;("Left"===o||"Right"===o)&&e.point.y>=e.corners.top&&e.point.y<=e.corners.bottom?(e.direction=i.point.y>e.point.y?"Bottom":"Top",a=e.corners.height/2+20):("Top"===o||"Bottom"===o)&&e.point.x>=e.corners.left&&e.point.x<=e.corners.right&&(e.direction=i.point.x>e.point.x?"Right":"Left",a=e.corners.width/2+20),e.direction&&a?r=dt(t,e,i,a,!0):(e.direction=n,r=ht(e,i))}else if(!t.sourcePortWrapper||o!==i.direction||"Top"!==o&&"Bottom"!==o||e.corners.center.x!==i.corners.center.x)e.direction=n,r=ht(e,i);else{e.direction=i.point.y>e.point.y?"Bottom":"Top";r=dt(t,e,i,"Bottom"===e.direction?e.corners.bottom-e.point.y+20:e.point.y-e.corners.top+20)}else{e.direction=n,r=dt(t,e,i,"Top"===n||"Bottom"===n?t.sourceWrapper.height/2+20:t.sourceWrapper.width/2+20);e.point=r[1],"Left"===n||"Right"===n?(i.direction=n,i.point="Left"===n?i.corners.middleLeft:i.corners.middleRight):J(t.targetWrapper,e,i,t),r=dt(t,e,i)}return r}function K(t,e){if(void 0!==t.targetWrapper&&void 0===t.targetPortWrapper&&Wi(t.targetWrapper).containsPoint(e.point)){var i=t.targetWrapper,r=t.segments[t.segments.length-2],o=r.points[r.points.length-1],n=ft(r.direction);"Bottom"===n?o.y<i.corners.bottom&&(r.points[r.points.length-1].y=i.corners.bottom+20,r.length=wr.distancePoints(r.points[0],r.points[r.points.length-1])):"Top"===n?o.y>i.corners.top&&(r.points[r.points.length-1].y=i.corners.top-20,r.length=wr.distancePoints(r.points[0],r.points[r.points.length-1])):"Left"===n?o.x>i.corners.left&&(r.points[r.points.length-1].x=i.corners.left-20,r.length=wr.distancePoints(r.points[0],r.points[r.points.length-1])):"Right"===n&&o.x<i.corners.right&&(r.points[r.points.length-1].x=i.corners.right+20,r.length=wr.distancePoints(r.points[0],r.points[r.points.length-1])),e.point=r.points[r.points.length-1]}}function Q(t,e){for(var i=0;i<t.segments.length;i++)for(var r=t.segments[i],o=0;o<r.points.length;o++)(o>0||0===i)&&e.push(r.points[o]);return e}function J(t,e,i,r){var o,n={x:0,y:0},a=V(t,t.corners,t.bounds),s=e.margin,h=e.point;if(a.bottomCenter.y+s.bottom<h.y)o="Bottom",n=a.bottomCenter;else if(a.topCenter.y-s.top>h.y)o="Top",n=a.topCenter;else if(a.middleLeft.x-s.left>h.x)o="Left",n=a.middleLeft;else if(a.middleRight.x+s.right<h.x)o="Right",n=a.middleRight;else{var d=Math.abs(h.y-a.topCenter.y),l=Math.abs(h.x-a.middleRight.x),c=Math.abs(h.y-a.bottomCenter.y),p=Math.abs(h.x-a.middleLeft.x),g=Number.MAX_VALUE;g=d,o="Top",n=a.topCenter,g>l&&(g=l,o="Right",n=a.middleRight),g>c&&(g=c,o="Bottom",n=a.bottomCenter),g>p&&(o="Left",n=a.middleLeft)}i.point=n,i.direction=o;var u=tt(a,ft(i.direction));i.point=it(r,t,i.point,u,t===r.targetWrapper)}function $(t,e){var i={x:e.x,y:t.y},r=(wr.findLength(t,i),wr.findLength(i,e)),o=wr.findLength(e,t),n=Math.asin(r/o);return n=180*n/Math.PI,t.x<e.x?t.y>e.y&&(n=360-n):n=t.y<e.y?180-n:180+n,n}function tt(t,e){var i;switch(e){case"Left":i=t.middleLeft;break;case"Top":i=t.topCenter;break;case"Right":i=t.middleRight;break;case"Bottom":i=t.bottomCenter}return i}function et(t,e,i){return wr.transform(t,i,e)}function it(t,e,i,r,o){i={x:i.x,y:i.y},r={x:r.x,y:r.y};var n,a,s=wr.findAngle(r,i),h=o?t.targetWrapper:t.sourceWrapper,d=o||"Orthogonal"===t.type?i:r;wr.transform(i,s,Math.max(h.actualSize.height/2,h.actualSize.width/2));n=h;var l=tr(-h.parentTransform,h.offsetX,h.offsetY,i),c=tr(-h.parentTransform,h.offsetX,h.offsetY,r);if("Orthogonal"===t.type){l.x===c.x&&(l.y<c.y?l.y-=5:l.y+=5),l.y===c.y&&(l.x<c.x?l.x-=5:l.x+=5),i=tr(h.parentTransform,h.offsetX,h.offsetY,l)}else{o?wr.findAngle(i,r):wr.findAngle(r,i);if(o){var p=wr.findAngle(i,r);r=wr.transform({x:r.x,y:r.y},p,Math.max(h.actualSize.width,h.actualSize.height))}else{var g=wr.findAngle(r,i);i=wr.transform({x:i.x,y:i.y},g,Math.max(h.actualSize.width,h.actualSize.height))}}h instanceof Yr&&h.data?(a=n.getPoints(),n.data.split("m").length-1+(n.data.split("M").length-1)==1&&(a[a.length]=a[0])):(a=Ee(h,h.corners))[a.length]=a[0];a.length;return ot({x1:i.x,y1:i.y,x2:r.x,y2:r.y},a,!0,d)||i}function rt(t,e,i){return e.x=Math.round(100*e.x)/100,e.y=Math.round(100*e.y)/100,i?t.targetPoint=e:t.sourcePoint=e,e}function ot(t,e,i,r){var o,n=e.length,a={x1:e[0].x,y1:e[0].y,x2:e[1].x,y2:e[1].y},s=nt(t,a);if(s&&(o=wr.distancePoints(s,r)),isNaN(o)||o>0)for(var h=1;h<n-1;h++){var d=nt(t,a={x1:e[h].x,y1:e[h].y,x2:e[h+1].x,y2:e[h+1].y});if(d){var l=wr.distancePoints(d,r);if((isNaN(o)||o>l)&&(o=l,s=d),o>=0&&o<=1)break}}return s}function nt(t,e){var i,r,o,n,a,s,h,d,l,c,p,g,u,f,m,y=t.x1,v=t.y1,b=t.x2,w=t.y2,x=e.x1,S=e.y1,P=e.x2,C=e.y2;return i=w-v,o=y-b,a=b*v-y*w,p=i*x+o*S+a,g=i*P+o*C+a,0!==p&&0!==g&&at(p,g)?null:(r=C-S,n=x-P,s=P*S-x*C,l=r*y+n*v+s,c=r*b+n*w+s,0!==l&&0!==c&&at(l,c)?null:0==(u=i*n-r*o)?null:(f=u<0?-u/2:u/2,f=0,m=o*s-n*a,h=m<0?(m-f)/u:(m+f)/u,m=r*a-i*s,d=m<0?(m-f)/u:(m+f)/u,{x:h,y:d}))}function at(t,e){return t*e>=0}function st(t,e,i){switch(e.direction){case"Left":e.point.x>t.left&&(i=e.point.x-t.left>i?e.point.x-t.left+i:i);break;case"Right":e.point.x<t.right&&(i=t.right-e.point.x>i?t.right-e.point.x+i:i);break;case"Top":e.point.y>t.top&&(i=e.point.y-t.top>i?e.point.y-t.top+i:i);break;case"Bottom":e.point.y<t.bottom&&(i=t.bottom-e.point.y>i?t.bottom-e.point.y+i:i)}return i}function ht(t,e){var i;switch(t.direction){case"Left":case"Right":var r={x:e.point.x,y:t.point.y};i=wr.equals(t.point,r)||wr.equals(e.point,r)?[t.point,e.point]:[t.point,r,e.point];break;case"Top":case"Bottom":var o={x:t.point.x,y:e.point.y};i=wr.equals(t.point,o)||wr.equals(e.point,o)?[t.point,e.point]:[t.point,o,e.point]}return i}function dt(t,e,i,r,o){r||(r=20);var n,a,s,h=t.sourcePortWrapper,d=i.point.x-e.point.x,l=i.point.y-e.point.y;if(!o&&(Math.abs(d)<.001||Math.abs(l)<.001)&&void 0===i.direction)return[e.point,i.point];if(void 0===t.targetWrapper&&Math.abs(d)<=31&&Math.abs(l)<=31){if("Left"===e.direction||"Right"===e.direction?Math.abs(l)<12&&(e.direction=e.point.y>i.point.y?"Top":"Bottom"):Math.abs(d)<12&&(e.direction=e.point.x>i.point.x?"Left":"Right"),Math.abs(d)>12||Math.abs(l)>12)return ht(e,i);r+=5}return"Left"===e.direction||"Right"===e.direction?("Right"===e.direction?(void 0!==i.direction&&"Right"===i.direction&&(r=Math.max(e.point.x,i.point.x)-e.point.x+r),e.point.x>i.point.x&&void 0===h&&(r=-r)):(void 0!==i.direction&&"Left"===i.direction&&(r=e.point.x-Math.min(e.point.x,i.point.x)+r),(e.point.x>i.point.x||void 0!==h||"Left"===e.direction)&&(r=-r)),s=i.point.y-e.point.y,n=et(e.point,r,0),0!==(s=i.point.y-n.y)&&(a=et(n,i.point.y-n.y,90))):"Top"!==e.direction&&"Bottom"!==e.direction||("Bottom"===e.direction?void 0!==i.direction&&"Bottom"===i.direction&&(r=Math.max(e.point.y,i.point.y)-e.point.y+r):(void 0!==i.direction&&"Top"===i.direction&&(r=e.point.y-Math.min(e.point.y,i.point.y)+r),(e.point.y>i.point.y||void 0!==h||"Top"===e.direction)&&(r=-r)),s=i.point.x-e.point.x,n=(e.direction,et(e.point,r,90)),0!==(s=i.point.x-n.x)&&(a=et(n,i.point.x-n.x,0))),0===s?[e.point,i.point]:[e.point,n,a,i.point]}function lt(t,e,i,r,o){void 0===o&&(o=20);var n;switch(void 0===i?(t.margin={left:2,right:2,top:2,bottom:2},e.margin={left:0,right:5,top:0,bottom:5}):"Bottom"===t.direction?e.corners.top>t.corners.bottom&&e.corners.top-t.corners.bottom<20&&(o=(e.corners.top-t.corners.bottom)/2):"Top"===t.direction?e.corners.bottom<t.corners.top&&t.corners.top-e.corners.bottom<20&&(o=(t.corners.top-e.corners.bottom)/2):"Right"===t.direction?e.corners.left>t.corners.right&&e.corners.left-t.corners.right<20&&(o=(e.corners.left-t.corners.right)/2):"Left"===t.direction&&e.corners.right<t.corners.left&&t.corners.left-e.corners.right<20&&(o=(t.corners.left-e.corners.right)/2),t.direction){case"Left":o=function(t,e,i,r){t.corners.left-t.margin.left>e.corners.left-e.margin.left&&t.corners.left-t.margin.left<=e.corners.right+e.margin.right?("Bottom"===e.direction&&t.point.y<e.point.y?r+=t.corners.left-e.corners.left:"Top"===e.direction&&t.point.y>e.point.y&&(r+=t.corners.left-e.corners.left),r+=t.point.x-t.corners.left):void 0!==i&&"Top"!==i&&"Bottom"===e.direction&&t.point.y<e.point.y?r+=Math.abs(t.point.x-e.corners.right):void 0!==i&&"Bottom"!==i&&"Top"===e.direction&&e.point.y<t.point.y?r+=Math.abs(t.point.x-e.corners.right):r+=t.point.x-t.corners.left;return r}(t,e,i,o),n=et(t.point,o,180);break;case"Right":o=function(t,e,i,r){t.corners.right+t.margin.right<e.corners.right+e.margin.right&&t.corners.right+t.margin.right>=e.corners.left-e.margin.left?("Bottom"===e.direction&&t.point.y<e.point.y?i+=e.corners.right-t.corners.right:"Top"===e.direction&&t.point.y>e.point.y&&(i+=e.corners.right-t.corners.right),i+=t.corners.right-t.point.x):void 0!==r&&"Top"!==r&&"Bottom"===e.direction&&t.point.y<e.point.y?i+=Math.abs(t.point.x-e.corners.right):void 0!==r&&"Bottom"!==r&&"Top"===e.direction&&e.point.y<t.point.y?i+=Math.abs(t.point.x-e.corners.right):i+=t.corners.right-t.point.x;return i}(t,e,o,i),n=et(t.point,o,0);break;case"Top":o=function(t,e,i,r){t.corners.top-t.margin.top>e.corners.top+e.margin.top&&t.corners.top-t.margin.top<=e.corners.bottom+e.margin.bottom?("Right"===e.direction&&t.point.x<e.point.x?r+=t.corners.top-e.corners.top:"Left"===e.direction&&t.point.x>e.point.x&&(r+=t.corners.top-e.corners.top),r+=t.point.y-t.corners.top):void 0!==i&&"Left"!==i&&"Right"===e.direction&&t.point.x<e.point.x?r+=Math.abs(t.point.y-e.corners.bottom):void 0!==i&&"Right"!==i&&"Left"===e.direction&&e.point.x<t.point.x?r+=Math.abs(t.point.y-e.corners.bottom):r+=t.point.y-t.corners.top;return r}(t,e,i,o),n=et(t.point,o,270);break;case"Bottom":o=function(t,e,i,r){t.corners.bottom+t.margin.bottom<e.corners.bottom+e.margin.bottom&&t.corners.bottom+t.margin.bottom>=e.corners.top-e.margin.top?("Right"===e.direction&&t.point.x<e.point.x?i+=e.corners.bottom-t.corners.bottom:"Left"===e.direction&&t.point.x>e.point.x&&(i+=e.corners.bottom-t.corners.bottom),i+=t.corners.bottom-t.point.y):void 0!==r&&"Left"!==r&&"Right"===e.direction&&t.point.x<e.point.x?i+=Math.abs(t.point.y-e.corners.bottom):void 0!==r&&"Right"!==r&&"Left"===e.direction&&e.point.x<t.point.x?i+=Math.abs(t.point.y-e.corners.bottom):i+=t.corners.bottom-t.point.y;return i}(t,e,o,i),n=et(t.point,o,90)}return void 0!==r?r.push(n):r=[t.point,n],"Top"===t.direction||"Bottom"===t.direction?ct(n,"horizontal",t,e,r):"Right"!==t.direction&&"Left"!==t.direction||ct(n,"vertical",t,e,r),r}function ct(t,e,i,r,o){var n,a,s;"horizontal"===e?(i.margin={left:0,right:10,top:0,bottom:10},r.margin={left:0,right:10,top:0,bottom:10}):"vertical"===e&&(i.margin={left:10,right:0,top:10,bottom:0},r.margin={left:10,right:0,top:10,bottom:0});var h=20;if("horizontal"===e){switch(r.direction){case"Left":if(i.corners.right+i.margin.right<r.corners.left-r.margin.left&&(r.corners.left-i.corners.right>h||i.corners.top-i.margin.top<=r.point.y&&i.corners.bottom+i.margin.bottom>=r.point.y)){var d=Math.min(Math.abs(r.corners.left-i.corners.right)/2,20);h=i.corners.right-t.x+d}else h="Top"===i.direction&&t.y>r.point.y||"Bottom"===i.direction&&t.y<r.point.y?Math.min(r.corners.left,t.x)-t.x-20:t.x>=i.corners.left-i.margin.left&&t.x<=i.corners.right+i.margin.right?Math.min(r.corners.left,i.corners.left)-t.x-20:r.corners.left-t.x-20;break;case"Right":if(i.corners.left-i.margin.left>r.corners.right+r.margin.right&&(i.corners.left-r.corners.right>h||i.corners.top-i.margin.top<=r.point.y&&i.corners.bottom+i.margin.bottom>=r.point.y)){d=Math.min(Math.abs(i.corners.left-r.corners.right)/2,20);h=i.corners.left-t.x-d}else h="Top"===i.direction&&t.y>r.point.y||"Bottom"===i.direction&&t.y<r.point.y?Math.max(r.corners.right,t.x)-t.x+20:t.x>=i.corners.left-i.margin.left&&t.x<=i.corners.right+i.margin.right?Math.max(r.corners.right,i.corners.right)-t.x+20:r.corners.right-t.x+20}a=et(n=et(t,h,0),r.point.y-t.y,90),s=r.point}else if("vertical"===e){switch(r.direction){case"Top":if(i.corners.bottom+i.margin.bottom<r.corners.top-r.margin.top&&(r.corners.top-i.corners.bottom>h||i.corners.left-i.margin.left<=r.point.x&&i.corners.right+i.margin.right>=r.point.x)){d=Math.min(Math.abs(r.corners.top-i.corners.bottom)/2,20);h=i.corners.bottom-t.y+d}else h="Left"===i.direction&&t.x>r.point.x||"Right"===i.direction&&t.x<r.point.x?Math.min(r.corners.top,t.y)-t.y-20:t.y>=i.corners.top-i.margin.top&&t.y<=i.corners.bottom+i.margin.bottom?Math.min(r.corners.top,i.corners.top)-t.y-20:r.corners.top-t.y-20;break;case"Bottom":if(i.corners.top-i.margin.top>r.corners.bottom+r.margin.bottom&&(i.corners.top-r.corners.bottom>h||i.corners.left-i.margin.left<=r.point.x&&i.corners.right+i.margin.right>=r.point.x)){d=Math.min(Math.abs(i.corners.top-r.corners.bottom)/2,20);h=i.corners.top-t.y-d}else h="Left"===i.direction&&t.x>r.point.x||"Right"===i.direction&&t.x<r.point.x?Math.max(r.corners.bottom,t.y)-t.y+20:t.y>=i.corners.top-i.margin.top&&t.y<=i.corners.bottom+i.margin.bottom?Math.max(r.corners.bottom,i.corners.bottom)-t.y+20:r.corners.bottom-t.y+20}a=et(n=et(t,h,90),r.point.x-t.x,0),s=r.point}o.push(n),o.push(a),o.push(s)}function pt(t,e){var i=t.direction;t.direction=e.direction,e.direction=i;var r=t.point;t.point=e.point,e.point=r;var o=t.corners;t.corners=e.corners,e.corners=o}function gt(t,e,i,r){var o=void 0===e?i:e,n=o.topLeft,a=o.topRight,s=o.bottomRight,h=o.bottomLeft,d=o.center,l=$(d,t),c=$(d,s),p=$(d,h),g=$(d,n),u=$(d,a);return l>g&&l<u?"Top":l>=c&&l<p?"Bottom":l>=p&&l<=g?"Left":"Right"}function ut(t){var e;return e=t.wrapper.children[0].bounds,"None"!==t.sourceDecorator.shape&&e.uniteRect(t.wrapper.children[1].bounds),"None"!==t.targetDecorator.shape&&e.uniteRect(t.wrapper.children[2].bounds),e}function ft(t){switch(t){case"Top":return"Bottom";case"Bottom":return"Top";case"Left":return"Right";case"Right":return"Left"}return"auto"}function mt(t,e,i){var r=t.center,o=i?45:180/(2+2/(t.height/t.width)),n=o,a=180-o,s=a+2*o,h=360-o,d=$(e,r);return d>n&&d<a?"top":d>a&&d<s?"right":d>s&&d<h?"bottom":"left"}function yt(t){return!t.distance&&!t.angle}function vt(t,e,i){var r=60,o={x:0,y:0};switch(i||(i=Math.abs(e.x-t.x)>Math.abs(e.y-t.y)?t.x<e.x?"right":"left":t.y<e.y?"bottom":"top"),i){case"bottom":case"top":r=Math.min(.45*Math.abs(t.y-e.y),r),o={x:t.x,y:t.y+("bottom"===i?r:-r)};break;case"right":case"left":r=Math.min(.45*Math.abs(t.x-e.x),r),o={x:t.x+("right"===i?r:-r),y:t.y}}return o}function bt(t,e,i,r,o){var n=0,a=0,s=0,h=0,d=Number((o.distance(e,t)+o.distance(i,e)+o.distance(r,i))/3);if(0!==d)for(var l=0;l<=d;l++){var c=l/d,p=(1-c)*(1-c)*(1-c)*t.x+3*c*(1-c)*(1-c)*e.x+3*c*c*(1-c)*i.x+c*c*c*r.x,g=(1-c)*(1-c)*(1-c)*t.y+3*c*(1-c)*(1-c)*e.y+3*c*c*(1-c)*i.y+c*c*c*r.y;0===l?(n=s=p,a=h=g):(n=Math.min(p,n),a=Math.min(g,a),s=Math.max(p,s),h=Math.max(g,h))}return{x:n,y:a,width:s-n,height:h-a,left:n,top:a,right:n+(s-n),bottom:a+(h-a),center:{x:(n+(s-n))/2,y:(a+(h-a))/2}}}function wt(t,e,i,r,o,n,a){var s={x:0,y:0},h=n/a,d=(1-h)*(1-h)*(1-h)*e.x+3*h*(1-h)*(1-h)*i.x+3*h*h*(1-h)*r.x+h*h*h*o.x;s.x=d;var l=(1-h)*(1-h)*(1-h)*e.y+3*h*(1-h)*(1-h)*i.y+3*h*h*(1-h)*r.y+h*h*h*o.y;return s.y=l,s}function xt(e){if(e){return e instanceof so||e instanceof ho?e.constraints&t.AnnotationConstraints.Select:e instanceof Wo?e.constraints&t.ConnectorConstraints.Select:e.constraints&t.NodeConstraints.Select}return 1}function St(e){if(e){return e instanceof so||e instanceof ho?e.constraints&t.AnnotationConstraints.Drag:e instanceof Wo?e.constraints&t.ConnectorConstraints.Drag:e instanceof Vo?1:e.constraints&t.NodeConstraints.Drag}return 1}function Pt(e,i){return e instanceof Wo?e.constraints&t.ConnectorConstraints.PointerEvents:e.constraints&t.NodeConstraints.PointerEvents}function Ct(e){return e.constraints&t.ConnectorConstraints.DragSourceEnd}function Tt(e){return e.constraints&t.ConnectorConstraints.DragTargetEnd}function At(e){return e.constraints&t.ConnectorConstraints.DragSegmentThumb}function Mt(e){return e instanceof so||e instanceof ho?e.constraints&t.AnnotationConstraints.Rotate:e.constraints&t.NodeConstraints.Rotate}function Lt(e){return e.constraints&t.NodeConstraints.Shadow}function Ot(e){return e instanceof En&&e.constraints&t.NodeConstraints.InConnect?e.constraints&t.NodeConstraints.InConnect:0}function It(e){return e&&e.constraints&t.PortConstraints.InConnect?e.constraints&t.PortConstraints.InConnect:0}function Et(e){return e instanceof En&&e.constraints&t.NodeConstraints.OutConnect?e.constraints&t.NodeConstraints.OutConnect:0}function zt(e){return e&&e.constraints&t.PortConstraints.OutConnect?e.constraints&t.PortConstraints.OutConnect:0}function Dt(e,i){var r=0;return e instanceof so||e instanceof ho?r=e.constraints&t.AnnotationConstraints.Resize:e&&("SouthEast"===i?r=e.constraints&t.NodeConstraints.ResizeSouthEast:"East"===i?r=e.constraints&t.NodeConstraints.ResizeEast:"NorthEast"===i?r=e.constraints&t.NodeConstraints.ResizeNorthEast:"South"===i?r=e.constraints&t.NodeConstraints.ResizeSouth:"North"===i?r=e.constraints&t.NodeConstraints.ResizeNorth:"SouthWest"===i?r=e.constraints&t.NodeConstraints.ResizeSouthWest:"West"===i?r=e.constraints&t.NodeConstraints.ResizeWest:"NorthWest"===i&&(r=e.constraints&t.NodeConstraints.ResizeNorthWest)),r}function kt(e){return e instanceof Wo?e.constraints&t.ConnectorConstraints.AllowDrop:e.constraints&t.NodeConstraints.AllowDrop}function Rt(e){return e.constraints&t.DiagramConstraints.Virtualization}function Nt(e){return e.tool&t.DiagramTools.SingleSelect}function Bt(e){return e.tool&t.DiagramTools.ZoomPan}function jt(e){return e.tool&t.DiagramTools.ContinuousDraw}function Ht(e){return e.tool&t.DiagramTools.DrawOnce}function Wt(e){return e.tool&t.DiagramTools.SingleSelect||e.tool&t.DiagramTools.MultipleSelect}function _t(e){return e.constraints&t.DiagramConstraints.UserInteraction}function Xt(e){return e.constraints&t.DiagramConstraints.ZoomTextEdit}function Yt(e){return function(e){return e.constraints&t.DiagramConstraints.ApiUpdate}(e)||e.diagramActions&t.DiagramAction.ToolAction}function Vt(e,i){return e.constraints&t.PortConstraints.Draw}function Ut(e,i){return e.constraints&t.PortConstraints.Drag}function Ft(e,i,r){var o,n="NoWrap";"Class"===i.shape.classifier?o=i.shape.class:"Enumeration"===i.shape.classifier?o=i.shape.enumeration:"Interface"===i.shape.classifier&&(o=i.shape.interface),i.container={type:"Stack",orientation:"Vertical"},i.constraints=(t.NodeConstraints.Default|t.NodeConstraints.HideThumbs)&~(t.NodeConstraints.Rotate|t.NodeConstraints.Resize),i.style={fill:i.style.fill,strokeColor:"black",strokeWidth:1.5},i.children=[],i.maxWidth&&(n="Wrap");var a=new En(r,"nodes",{id:i.id+"_umlClass_header",annotations:[{id:"name",content:o.name,offset:{x:.5,y:.65},margin:{left:10,right:10},style:{bold:!0,fontSize:14,color:o.style.color,fill:o.style.fill,textWrapping:n}},{content:"<<"+i.shape.classifier+">>",margin:{left:10,right:10},id:"class",style:{fontSize:o.style.fontSize,color:o.style.color,fill:o.style.fill,textWrapping:n},offset:{x:.5,y:.3},constraints:t.AnnotationConstraints.ReadOnly}],constraints:(t.NodeConstraints.Default|t.NodeConstraints.HideThumbs)&~(t.NodeConstraints.Rotate|t.NodeConstraints.Drag|t.NodeConstraints.Resize),verticalAlignment:"Stretch",horizontalAlignment:"Stretch",style:{fill:i.style.fill,strokeColor:"#ffffff00"}},!0);return r.initObject(a),r.nodes.push(a),i.children.push(a.id),function(e,i,r,o){if("Enumeration"===e.shape.classifier){var n=r.members;if(n&&n.length){Gt(e,i);for(var a="",s=0;s<n.length;s++){var h=n[s];if(""!==h.name&&(a+=h.name),s!==n.length){var d=Zt(e,h),l=new En(i,"nodes",{id:Hi()+"_umlMember",annotations:[{id:"name",content:a,offset:{x:0,y:.5},style:{bold:!0,fontSize:d.fontSize,color:d.color,fill:d.fill,textWrapping:o},margin:{left:14,right:5},horizontalAlignment:"Left"}],verticalAlignment:"Stretch",horizontalAlignment:"Stretch",style:{fill:e.style.fill,strokeColor:"#ffffff00",textWrapping:o},constraints:(t.NodeConstraints.Default|t.NodeConstraints.HideThumbs)&~(t.NodeConstraints.Rotate|t.NodeConstraints.Drag|t.NodeConstraints.Resize),maxHeight:25,minHeight:25},!0);i.initObject(l),i.nodes.push(l),e.children.push(l.id),a="",h.isSeparator&&s!==n.length-1&&Gt(e,i)}}}}else{var c=r.attributes;if(c.length){var p="";Gt(e,i);for(var s=0;s<c.length;s++){var g=void 0,u=c[s];if(g=u.scope&&"Public"===u.scope?" +":u.scope&&"Private"===u.scope?"-":u.scope&&"Protected"===u.scope?"#":"~",""!==u.name&&g&&(p+=g+" "+u.name+" : "+u.type),s!==c.length){var d=Zt(e,u),l=new En(i,"nodes",{id:Hi()+"_umlProperty",style:{fill:e.style.fill,strokeColor:"#ffffff00"},annotations:[{id:"name",content:p,offset:{x:0,y:.5},style:{bold:!0,fontSize:d.fontSize,color:d.color,fill:d.fill,textWrapping:o},margin:{left:14,right:5},horizontalAlignment:"Left"}],verticalAlignment:"Stretch",horizontalAlignment:"Stretch",constraints:(t.NodeConstraints.Default|t.NodeConstraints.HideThumbs)&~(t.NodeConstraints.Rotate|t.NodeConstraints.Drag|t.NodeConstraints.Resize),maxHeight:25,minHeight:25},!0);i.initObject(l),i.nodes.push(l),e.children.push(l.id),p="",u.isSeparator&&s!==c.length-1&&Gt(e,i)}}}}}(i,r,o,n),function(e,i,r,o){if(r.methods&&r.methods.length){var n=r.methods;Gt(e,i);for(var a="",s="",h=void 0,d=0;d<n.length;d++){var l=n[d];if(h=l.scope&&"Public"===l.scope?" +":l.scope&&"Private"===l.scope?"-":l.scope&&"Protected"===l.scope?"#":"~",l.parameters)for(var c=0;c<l.parameters.length;c++)l.parameters[c].type?a+=l.parameters[c].name+":"+l.parameters[c].type:a+=l.parameters[c].name,c!==l.parameters.length-1&&(a+=",");if(""!==l.name&&h&&(s+=h+" "+l.name+"("+a+") : "+l.type),d!==n.length){var p=Zt(e,l),g=new En(i,"nodes",{id:Hi()+"_umlMethods",verticalAlignment:"Stretch",horizontalAlignment:"Stretch",annotations:[{id:"name",content:s,offset:{x:0,y:.5},style:{bold:!0,fontSize:p.fontSize,color:p.color,fill:p.fill,textWrapping:o},margin:{left:14,right:5},horizontalAlignment:"Left"}],style:{fill:e.style.fill,strokeColor:"#ffffff00"},maxHeight:25,minHeight:25,constraints:(t.NodeConstraints.Default|t.NodeConstraints.HideThumbs)&~(t.NodeConstraints.Rotate|t.NodeConstraints.Drag|t.NodeConstraints.Resize)},!0);i.initObject(g),i.nodes.push(g),e.children.push(g.id),s="",l.isSeparator&&d!==n.length-1&&Gt(e,i)}}}}(i,r,o,n),i.offsetX=i.offsetX,i.offsetY=i.offsetY,i.style.fill=i.style.fill,i.borderColor=i.borderColor,r.initObject(i),e}function Gt(e,i){var r=new En(i,"nodes",{id:Hi()+"_path",height:1,constraints:t.NodeConstraints.Default&~t.NodeConstraints.Select,verticalAlignment:"Stretch",horizontalAlignment:"Stretch"},!0);i.initObject(r),i.nodes.push(r),e.children.push(r.id)}function Zt(t,e){var i={},r=e.style;return i.fill="transparent"!==r.fill?r.fill:t.style.fill,i.color=r.color,i.fontSize=12!==r.fontSize?r.fontSize:t.style.fontSize,i.strokeColor="black"!==r.strokeColor?r.strokeColor:t.style.strokeColor,i.strokeWidth=1!==r.strokeWidth?r.strokeWidth:t.style.strokeWidth,i}function qt(t,e,i,r){var o;if($t(t,e,!0)){var n=(o=t.nameTable[e.parentId]).wrapper;if(o&&"Canvas"===o.container.type){if(r||n.bounds.x<=i.x&&n.bounds.right>=i.x&&n.bounds.y<=i.y&&n.bounds.bottom>=i.y){if(n.actualSize.width<n.outerBounds.width&&!(n.bounds.x>n.outerBounds.x))if(void 0!==o.rowIndex){var a=t.nameTable[o.parentId];if(a.columns.length-1===o.columnIndex){var s=n.bounds.x,h=n.bounds.y;n.maxWidth=n.outerBounds.width,a.wrapper.updateColumnWidth(o.columnIndex,n.outerBounds.width),t.drag(a,s-n.bounds.x,h-n.bounds.y),t.updateDiagramObject(a)}}else t.scale(o,1+(n.outerBounds.width-n.actualSize.width)/n.actualSize.width,1,n.outerBounds.x<n.bounds.x?{x:1,y:.5}:{x:0,y:.5});if(n.actualSize.height<n.outerBounds.height&&!(n.bounds.y>n.outerBounds.y))if(void 0!==o.rowIndex){var d=t.nameTable[o.parentId];s=n.bounds.x,h=n.bounds.y;n.maxHeight=n.outerBounds.height,d.wrapper.updateRowHeight(o.rowIndex,n.outerBounds.height),t.drag(d,s-n.bounds.x,h-n.bounds.y)}else t.scale(o,1,1+(n.outerBounds.height-n.actualSize.height)/n.actualSize.height,n.outerBounds.y<n.bounds.y?{x:.5,y:1}:{x:.5,y:0})}else if("Canvas"===o.container.type){var l=Xi(e);t.clearSelection(),t.deleteChild(e),e.parentId="";var c={type:"ChildCollectionChanged",category:"Internal",undoObject:l,redoObject:Xi(e)};t.addHistoryEntry(c)}t.select([e])}}}function Kt(t,e,i){for(var r=new xr,o="SwimLane"===t.shape.type?t.wrapper.children[0].rows:t.wrapper.rows,n=i?1:0;n<o.length;n++)r.uniteRect(o[n].cells[e].bounds);return r}function Qt(t,e){for(var i,r={},o=0,n=Object.keys(e);o<n.length;o++){var a=n[o];r[a]=e[a]}return _n(e)===En&&((i=new En(t,"nodes",r,!0)).id=e.id,t.initObject(i)),t.updateDiagramObject(i),i}function Jt(t,e){var i,r;if(t.selectedObject.helperObject)r=t.selectedObject.helperObject;else{i=e instanceof Vo&&e.nodes.length+e.connectors.length===1?e.nodes.length>0?e.nodes[0]:e.connectors[0]:e,t.selectedObject.actualObject=i;var o=t.selectedItems.wrapper.children[0];if($t(t,i)){r=Qt(t,{id:"helper",rotateAngle:o.rotateAngle,offsetX:o.offsetX,offsetY:o.offsetY,minWidth:o.minWidth,minHeight:o.minHeight,maxWidth:o.maxWidth,maxHeight:o.maxHeight,width:o.actualSize.width,height:o.actualSize.height,style:{strokeDashArray:"2 2",fill:"transparent",strokeColor:"red"}}),t.selectedObject.helperObject=r}}return r}function $t(t,e,i){var r=i?t.nameTable[e.parentId]:t.nameTable[e.parentId]||e;return!(!r||!r.container)}function te(t,e){var i=t.nameTable[e.parentId];"Canvas"===i.container.type&&(e.margin.left=e.offsetX-i.wrapper.bounds.x-e.width/2,e.margin.top=e.offsetY-i.wrapper.bounds.y-e.height/2),t.nodePropertyChange(e,{},{width:e.width,height:e.height,offsetX:e.offsetX,offsetY:e.offsetY,margin:{left:e.margin.left,right:e.margin.right,top:e.margin.top,bottom:e.margin.bottom},rotateAngle:e.rotateAngle}),i.wrapper.measure(new yr),i.wrapper.arrange(i.wrapper.desiredSize)}function ee(t,e,i){if(!t.currentSymbol){var r=-1!==t.nodes.indexOf(i)?i.id:i;if("Canvas"===e.container.type){var o=i.wrapper.offsetX-i.wrapper.actualSize.width/2-(e.wrapper.offsetX-e.wrapper.actualSize.width/2),n=i.wrapper.offsetY-i.wrapper.actualSize.height/2-(e.wrapper.offsetY-e.wrapper.actualSize.height/2);i.margin.left=o,i.margin.top=n}var a=t.nameTable[e.id];if(a.children||(a.children=[]),-1===a.children.indexOf(i.id)){""!==i.parentId&&t.deleteChild(i);var s=Xi(i);t.addChild(a,r);var h={type:"ChildCollectionChanged",category:"Internal",undoObject:s,redoObject:Xi(i)};t.addHistoryEntry(h),t.updateDiagramObject(a)}}}function ie(t,e,i,r,o){var n=xi(r.element.id);r.diagramRenderer.renderStackHighlighter(t,n,r.scroller.transform,e,i,o)}function re(t,e,i,r){var o=t,n=i.nameTable[o.parentId],a=i.nameTable[o.parentId];if(e&&a&&a.container&&"Stack"===a.container.type&&e.container&&"Stack"===e.container.type&&a.id!==e.parentId){var s=a.wrapper.children.indexOf(o.wrapper);s>-1&&(i.nameTable[o.id].parentId=e.id,a.wrapper.children.splice(s,1))}if(e&&e.parentId&&o.parentId&&"Drag"===r){var h=n.wrapper.children.indexOf(e.wrapper),d=n.wrapper.children.indexOf(o.wrapper),l={targetIndex:h,target:e,sourceIndex:d,source:t};n.wrapper.children.splice(d,1),n.wrapper.children.splice(h,0,o.wrapper);var c={type:"StackChildPositionChanged",redoObject:{targetIndex:d,target:e,sourceIndex:h,source:t},undoObject:l,category:"Internal"};i.commandHandler.addHistoryEntry(c)}}function oe(t,e,i){var r=[],o=[],n="Horizontal"===i.shape.orientation;i.shape.header&&de(r,i.shape.header.height),ce(r,n,i),pe(o,n,i),t.setDefinitions(r,o);var a=0;if(i.shape.header&&(ae(t,e,i),a++),i.shape.phases.length>0&&(se(t,e,i,a,n),a++),i.shape.lanes.length>0)for(var s=0;s<i.shape.lanes.length;s++)he(t,e,i,a,s,n),a++}function ne(t,e,i,r,o){var n=new En(i,"nodes",r);if(n.parentId=e.id,o&&(n.isHeader=!0),t.initObject(n),n.wrapper.children.length>0)for(var a=0;a<n.wrapper.children.length;a++){var s=n.wrapper.children[a];s instanceof Ar&&(s.isCalculateDesiredSize=!1)}return n.wrapper}function ae(t,e,i){var r=ne(e,t,i,{annotations:[{content:i.shape.header.content.content}],style:i.shape.header.style,rowIndex:0,columnIndex:0,container:{type:"Canvas",orientation:"Horizontal"}},!0);t.addObject(r,0,0,1,t.columnDefinitions().length)}function se(t,e,i,r,o){for(var n=0,a=0,s=0;s<i.shape.phases.length;s++){o?(a=s,n=r):n=i.shape.header?s+1:s;var h=ne(e,t,i,{annotations:[{content:i.shape.phases[s].header.content.content,rotateAngle:o?0:270}],style:i.shape.phases[s].style,rowIndex:n,columnIndex:a,container:{type:"Canvas",orientation:o?"Horizontal":"Vertical"}});t.addObject(h,n,a)}}function he(e,i,r,o,n,a){for(var s=r.shape.phases.length||1,h=0,d=a?o:1,l=r.shape.phases.length>0?1:0,c=0;c<s;c++){h=a?c:n+l;var p=ne(i,e,r,{id:r.shape.lanes[n].id+c,rowIndex:d,columnIndex:h,style:r.shape.lanes[n].style,constraints:t.NodeConstraints.Default|t.NodeConstraints.AllowDrop,container:{type:"Canvas",orientation:a?"Horizontal":"Vertical"}});if(p.children[0].isCalculateDesiredSize=!1,0===c){var g=void 0;g={id:r.shape.lanes[n].id+"_header",style:r.shape.lanes[n].header.style,annotations:[{content:r.shape.lanes[n].header.content.content,rotateAngle:a?270:0}],rowIndex:d,columnIndex:h,container:{type:"Canvas",orientation:a?"Horizontal":"Vertical"}},a?g.width=r.shape.lanes[n].header.width:g.height=r.shape.lanes[n].header.width;var u=ne(i,e,r,g);p.children.push(u)}e.addObject(p,d,h),a||d++,h=a?c:n+1}}function de(t,e){var i=new qo;i.height=e,t.push(i)}function le(t){var e=new Ko;return e.width=t,e}function ce(t,e,i){var r,o=0;if(t.length>0)for(var n=0;n<t.length;n++)o+=t[n].height;if(e){if(i.shape.phases.length>0&&(o+=i.shape.phases[0].height,de(t,i.shape.phases[0].height)),i.shape.lanes.length>0)for(n=0;n<i.shape.lanes.length;n++)o+=r=i.shape.lanes[n].height,n===i.shape.lanes.length-1&&o<i.height&&(r+=i.height-o),de(t,r)}else if(i.shape.phases.length>0)for(n=0;n<i.shape.phases.length;n++)o+=r=i.shape.phases[n].offset,n===i.shape.phases.length-1&&o<i.height&&(r+=i.height-o),de(t,r);else de(t,i.height)}function pe(t,e,i){var r=0;if(i.shape.phases.length>0&&"Horizontal"===i.shape.orientation)for(var o=0;o<i.shape.phases.length;o++){r+=i.shape.phases[o].offset;var n=le(i.shape.phases[o].offset);o===i.shape.phases.length-1&&r<i.width&&(n.width+=i.width-r),t.push(n)}else if(e){n=le(i.width);t.push(n)}else{var a=i.shape.phases.length>0?i.shape.lanes.length+1:i.shape.lanes.length;for(o=0;o<a;o++)if(0===o&&i.shape.phases.length>0){r+=i.shape.phases[0].height;var n=le(i.shape.phases[0].height);t.push(n)}else{r+=i.shape.lanes[0].height;n=le(i.shape.lanes[0].height);o===i.shape.lanes.length&&r<i.width&&(n.width+=i.width-r),t.push(n)}}}function ge(t,e){var i=document.getElementById(t.element.id+(e?"_hRuler":"_vRuler")),r=me(t),o=ye(t),n=e?"margin-left:"+r.width+"px;":"margin-top:"+r.height+"px;";if(!i){var a="height:"+(e?r.height:o.height+100)+"px;overflow:hidden;width:"+(e?o.width+100:r.width)+"px;position:absolute;font-size:11px;"+n;i=Oi("div",{id:t.element.id+(e?"_hRuler":"_vRuler"),style:a})}t.element.insertBefore(i,t.element.firstChild);var s=e?t.rulerSettings.horizontalRuler:t.rulerSettings.verticalRuler,h=new Hn(s);h.orientation=e?"Horizontal":"Vertical",h.length=(e?o.width:o.height)+s.segmentWidth,h.appendTo("#"+t.element.id+(e?"_hRuler":"_vRuler")),e?t.hRuler=h:t.vRuler=h;var d=document.getElementById(t.element.id+(e?"_hRuler":"_vRuler"));e?t.hRuler.element=d:t.vRuler.element=d}function ue(t){var e=-t.scroller.horizontalOffset,i=-t.scroller.verticalOffset;t&&t.rulerSettings.showRulers?(t.hRuler.length=0,t.vRuler.length=0,void 0!==e&&t.hRuler.element&&ve(t,t.hRuler,e,!0),void 0!==i&&t.vRuler.element&&ve(t,t.vRuler,i,!1)):fe(t)}function fe(t){ki(t.element.id+"_hRuler"),ki(t.element.id+"_vRuler"),ki(t.element.id+"_overlapRuler")}function me(t){var e=0,i=0;return t.rulerSettings.showRulers&&(e=t.rulerSettings.horizontalRuler.thickness,i=t.rulerSettings.verticalRuler.thickness),new yr(i,e)}function ye(t){var e=me(t),i=t.scroller.viewPortHeight,r=t.scroller.viewPortWidth;return r<t.element.clientWidth-e.width&&(r=t.element.clientWidth-e.width),i<t.element.clientHeight-e.height&&(i=t.element.clientHeight-e.height),t.hRuler&&t.hRuler.length&&(r=t.hRuler.length),t.vRuler&&t.vRuler.length&&(i=t.vRuler.length),new yr(r,i)}function ve(t,e,i,r){var o=me(t),n=ye(t),a=r?t.rulerSettings.horizontalRuler:t.rulerSettings.verticalRuler;!function(t,e,i){var r=document.getElementById(t.element.id+(i?"_hRuler":"_vRuler")),o=i?t.hRuler:t.vRuler;r&&t&&e&&(r.style.width=(i?e.width+o.segmentWidth:o.thickness)+"px",r.style.height=(i?o.thickness:e.height+o.segmentWidth)+"px",(r=document.getElementById(t.element.id+"_overlapRuler"))&&(i?r.style.height=o.thickness+"px":r.style.width=o.thickness+"px"))}(t,n,r),function(t,e,i){var r=document.getElementById(t.element.id+(i?"_hRuler_ruler_space":"_vRuler_ruler_space")),o=i?t.hRuler:t.vRuler;r&&t&&e&&(r.style.width=(i?e.width+2*o.segmentWidth:o.thickness)+"px",r.style.height=(i?o.thickness:e.height+2*o.segmentWidth)+"px")}(t,n,r),e.offset=i,e.scale=t.scroller.currentZoom,e.length=n.width+100,e.arrangeTick=ir(a.arrangeTick),e.dataBind();var s=r?t.hRuler.element:t.vRuler.element;r?s.style.marginLeft=o.width-e.hRulerOffset+"px":s.style.marginTop=o.height-e.vRulerOffset+"px"}function be(t){return Wn[t.toString()]}function we(t,e){for(var i=[],r=0;r<e.length;r++){var o=e[r];t.containsRect(o.wrapper.bounds)&&i.push(o)}return i}function xe(t,e){for(var i=0;i<t.length;i++)if(t[i].id===e)return!0;return!1}function Se(t){var e;return t&&(t.type?e="Connector":t.shape&&!t.type&&(e="Node")),e}function Pe(t,e){if(e instanceof En)switch(t.shape.shape){case"JoinNode":t.width||(e.width=20),t.height||(e.height=90),t.style&&t.style.fill||(e.style.fill="black");break;case"ForkNode":t.width||(e.width=90),t.height||(e.height=20),t.style&&t.style.fill||(e.style.fill="black");break;case"InitialNode":case"FinalNode":t.style&&t.style.fill||(e.style.fill="black")}else switch(t.shape.flow){case"Object":t.style&&t.style.strokeDashArray||(e.style.strokeDashArray="8 4"),t.style&&t.style.strokeWidth||(e.style.strokeWidth=2),t.targetDecorator&&t.targetDecorator.shape||(e.targetDecorator.shape="OpenArrow");break;case"Control":t.style&&t.style.strokeWidth||(e.style.strokeWidth=2),t.targetDecorator&&t.targetDecorator.shape||(e.targetDecorator.shape="OpenArrow"),t.sourceDecorator&&t.sourceDecorator.shape||(e.sourceDecorator.shape="None")}}function Ce(t,e,i){var r;r=wr.findLength(e,t)>wr.findLength(i,t)?i:e;var o=wr.findAngle(e,i),n=wr.findAngle(r,t),a=wr.findLength(r,t),s=n+2*(o-n);return{x:r.x+a*Math.cos(s*Math.PI/180),y:r.y+a*Math.sin(s*Math.PI/180)}}function Te(t){var e=t.parentElement;do{if(zi(e,"e-diagram"))return!0;e=e.parentElement}while(e);return!1}function Ae(t,e,i){if(t&&t.children&&t.children.length>0)for(var r=void 0,o=0;o<t.children.length;o++)return(r=i[t.children[o]]).shape.type===e||Ae(r,e,i);return!1}function Me(t,e){var i;i="Bezier"===t.type?function(t){var e=[];if("Bezier"===t.type)for(var i=0,r=0;r<t.segments.length;r++)for(var o=t.segments[r],n=wr.isEmptyPoint(o.point1)?o.bezierPoint1:o.point1,a=wr.isEmptyPoint(o.point2)?o.bezierPoint2:o.point2,s=Number((t.distance(n,o.points[0])+t.distance(a,n)+t.distance(o.points[1],a))/1.5),h=0;h<s-1;h+=10)e[i]=wt(0,o.points[0],wr.isEmptyPoint(o.point1)?o.bezierPoint1:o.point1,wr.isEmptyPoint(o.point2)?o.bezierPoint2:o.point2,o.points[1],h,s),i++;return e}(t):t.intermediatePoints;for(var r=0;r<i.length-1;r++){var o=i[r],n=i[r+1],a=xr.toBounds([o,n]);if(a.Inflate(t.hitPadding),a.containsPoint(e)){var s=Ce(e,o,n),h=Le({x1:o.x,x2:n.x,y1:o.y,y2:n.y},{x1:e.x,x2:s.x,y1:e.y,y2:s.y});if(h.enabled){var d=wr.findLength(e,h.intersectPt);if(Math.abs(d)<t.hitPadding)return!0}else{var l=xr.toBounds([e,e]);if(l.Inflate(3),l.containsPoint(o)||l.containsPoint(n))return!0}if(wr.equals(e,s))return!0}}if(t.annotations.length>0){var c=t.wrapper.children;for(r=3;r<c.length;r++){if(c[r].bounds.containsPoint(e))return!0}}return!1}function Le(t,e){var i={x:0,y:0},r=t,o=e,n=(o.y2-o.y1)*(r.x2-r.x1)-(o.x2-o.x1)*(r.y2-r.y1),a=(o.x2-o.x1)*(r.y1-o.y1)-(o.y2-o.y1)*(r.x1-o.x1),s=(r.x2-r.x1)*(r.y1-o.y1)-(r.y2-r.y1)*(r.x1-o.x1);if(0===n)return{enabled:!1,intersectPt:i};var h=a/n,d=s/n;return h>=0&&h<=1&&d>=0&&d<=1?(i.x=r.x1+h*(r.x2-r.x1),i.y=r.y1+h*(r.y2-r.y1),{enabled:!0,intersectPt:i}):{enabled:!1,intersectPt:i}}function Oe(t,e,i,r){var o=Le(Ie(t.x,t.y,e.x,e.y),Ie(i.x,i.y,r.x,r.y));return o.enabled?o.intersectPt:{x:0,y:0}}function Ie(t,e,i,r){return{x1:Number(t)||0,y1:Number(e)||0,x2:Number(i)||0,y2:Number(r)||0}}function Ee(t,e){var i=[];return i.push(e.topLeft),i.push(e.topRight),i.push(e.bottomRight),i.push(e.bottomLeft),i}function ze(e,i,r){var o,n=r instanceof En?r.constraints&t.NodeConstraints.InheritTooltip:r.constraints&t.ConnectorConstraints.InheritTooltip,a=r instanceof En?r.constraints&t.NodeConstraints.Tooltip:r.constraints&t.ConnectorConstraints.Tooltip;o=function(t,e,i,r){var o={},n=(i.scroller.transform.scale,document.getElementById(i.element.id)),a=t.wrapper.bounds,s=n.getBoundingClientRect();i.scroller.horizontalOffset,i.scroller.verticalOffset;switch(i.tooltipObject.position){case"BottomCenter":o=De(e,a.bottomCenter,i,r,s.width/2,s.height);break;case"BottomLeft":case"LeftBottom":o=De(e,a.bottomLeft,i,r,0,s.height);break;case"BottomRight":case"RightBottom":o=De(e,a.bottomRight,i,r,s.width,s.height);break;case"LeftCenter":o=De(e,a.middleLeft,i,r,0,s.height/2);break;case"LeftTop":case"TopLeft":o=De(e,a.topLeft,i,r,0,0);break;case"RightCenter":o=De(e,a.middleRight,i,r,s.width,s.height/2);break;case"RightTop":case"TopRight":o=De(e,a.topRight,i,r,s.width,0);break;case"TopCenter":o=De(e,a.topCenter,i,r,s.width/2,0)}return o}(r,i,e,"Mouse"===(!n&&a?r.tooltip.relativeMode:e.tooltip.relativeMode));var s=me(e);return{x:o.x+s.width,y:o.y+s.height}}function De(t,e,i,r,o,n){var a={},s=i.scroller.transform.scale,h=i.scroller.horizontalOffset,d=i.scroller.verticalOffset;return a.x=(r?t.x:e.x)*s+h-o,a.y=(r?t.y:e.y)*s+d-n,a}function ke(t){var e,i=0,r=0;for(i=0;i<t.length;i++){var o=_i(t[i].wrapper);for(r=i;r<t.length;r++){var n=_i(t[r].wrapper);o.center.x>n.center.x&&(e=t[i],t[i]=t[r],t[r]=e)}}return t}function Re(t,e,i){var r,o,n;o=Ne(t,e,i),r=wr.findAngle(t[o.index],t[o.index+1]);var a=Be(e);return n=wr.transform(o.point,r+45,a),o.point=n,o.angle=r,o}function Ne(t,e,i){for(var r,o,n,a,s,h=0,d=e.offset,l=[],c=0;c<t.length-1;c++)h+=wr.distancePoints(t[c],t[c+1]),l.push(h);n=d*h;for(var p=0;p<l.length;p++){if(l[p]>=n)return o=wr.findAngle(t[p],t[p+1]),r=wr.transform(t[p],o,n-(a||0)),s=p,{point:r,index:s};a=l[p]}return{point:r,index:s}}function Be(t){var e=void 0===t.content?10:0,i=0;switch(t.alignment){case"Center":i=0;break;case"Before":i=-(0+e);break;case"After":i=0+e}return i}function je(t,e,i){e%=360;var r,o;switch(t.alignment){case"Before":e>=45&&e<=135?(o="right",r=.5===t.offset?"center":"top"):e>=225&&e<=315?(o="left",r=.5===t.offset?"center":"bottom"):e>45&&e<225?(r="top",o=.5===t.offset?"center":"right"):(r="bottom",o=.5===t.offset?"center":"left");break;case"After":e>=45&&e<=135?(o="left",r=.5===t.offset?"center":"top"):e>=225&&e<=315?(o="right",r=.5===t.offset?"center":"bottom"):e>45&&e<225?(r="bottom",o=.5===t.offset?"center":"right"):(r="top",o=.5===t.offset?"center":"left");break;case"Center":o="center",r="center"}if(0===t.offset||1===t.offset){switch(He(i[0],i[1])){case"left":o=0===t.offset?"right":"left";break;case"right":o=0===t.offset?"left":"right";break;case"bottom":r=0===t.offset?"top":"bottom";break;case"top":r=0===t.offset?"bottom":"top"}}return{hAlign:o,vAlign:r}}function He(t,e){return Math.abs(e.x-t.x)>Math.abs(e.y-t.y)?t.x<e.x?"right":"left":t.y<e.y?"bottom":"top"}function We(t){var e=Xi(t,t.getCustomProperty);return e.selectedItems.nodes=[],e.selectedItems.connectors=[],e.selectedItems.wrapper=null,JSON.stringify(e)}function _e(t,e){e.clear(),e.protectPropertyChange(!0);for(var i=e.dataSourceSettings.doBinding,r=e.setNodeTemplate,o=e.getDescription,n=e.getCustomProperty,a={},s=0,h=e.commandManager.commands;s<h.length;s++){var d=h[s];a[d.name]={execute:d.execute,canExecute:d.canExecute}}var l=e.rulerSettings.horizontalRuler.arrangeTick,c=e.rulerSettings.verticalRuler.arrangeTick,p=e.layout.getLayoutInfo,g=e.layout.getBranch,u=e.getNodeDefaults,f=e.getConnectorDefaults,m=JSON.parse(t);e.contextMenuSettings=m.contextMenuSettings,e.constraints=m.constraints,e.tool=m.tool,e.bridgeDirection=m.bridgeDirection,e.pageSettings=m.pageSettings,e.drawingObject=m.drawingObject,e.tooltip=m.tooltip,e.addInfo=m.addInfo,e.getDescription=o,e.scrollSettings=m.scrollSettings,e.commandManager=m.commandManager,e.layers=m.layers,e.rulerSettings.horizontalRuler.arrangeTick=l,e.rulerSettings.verticalRuler.arrangeTick=c;for(var y=0,v=e.commandManager.commands;y<v.length;y++){var b=v[y];a[b.name]&&(b.execute=a[b.name].execute,b.canExecute=a[b.name].canExecute)}e.backgroundColor=m.backgroundColor,e.basicElements=m.basicElements,e.connectors=m.connectors,e.dataSourceSettings=m.dataSourceSettings,e.dataSourceSettings.doBinding=i,e.height=m.height,e.setNodeTemplate=r,e.getConnectorDefaults=f,e.getNodeDefaults=u,e.getCustomProperty=n,e.mode=m.mode,e.nodes=m.nodes,e.rulerSettings=m.rulerSettings,e.snapSettings=m.snapSettings,e.width=m.width,e.layout=m.layout,e.layout.getLayoutInfo=ir(p),e.layout.getBranch=ir(g),e.diagramActions=0,e.isLoading=!0,e.protectPropertyChange(!1);for(var w,x=0;x<e.views.length;x++)(w=e.views[e.views[x]]).refresh(),w instanceof Qa&&e.element.classList.add("e-diagram");return m.selectedItems.nodes=[],m.selectedItems.connectors=[],e.selectedItems=m.selectedItems,m}function Xe(t,e){for(var i=e.style,r=e,o=0,n=Object.keys(t);o<n.length;o++){switch(n[o]){case"fill":i.fill=t.fill,i instanceof jr&&(i.fill="transparent");break;case"textOverflow":i.textOverflow=t.textOverflow;break;case"opacity":i.opacity=t.opacity;break;case"strokeColor":i.strokeColor=t.strokeColor;break;case"strokeDashArray":i.strokeDashArray=t.strokeDashArray;break;case"strokeWidth":i.strokeWidth=t.strokeWidth;break;case"bold":i.bold=t.bold;break;case"color":i.color=t.color;break;case"textWrapping":i.textWrapping=t.textWrapping;break;case"fontFamily":i.fontFamily=t.fontFamily;break;case"fontSize":i.fontSize=t.fontSize;break;case"italic":i.italic=t.italic;break;case"textAlign":i.textAlign=t.textAlign;break;case"whiteSpace":i.whiteSpace=t.whiteSpace;break;case"textDecoration":i.textDecoration=t.textDecoration;break;case"gradient":i.gradient=t.gradient}}e instanceof Gr&&r.refreshTextElement()}function Ye(t,e,i){for(var r=e,o=r.hyperlink,n=0,a=Object.keys(t);n<a.length;n++){switch(a[n]){case"color":r.style.color=o.color=t.color;break;case"content":r.content=o.content=t.content||o.link;break;case"link":var s=i.style;r.style.color=t.link?o.color:s.color,r.style.textDecoration=t.link?o.textDecoration:i.style.textDecoration,r.content=t.link?o.content||t.link:i.content,o.link=t.link;break;case"textDecoration":r.style.textDecoration=o.textDecoration=t.textDecoration}}}function Ve(t,e,i){t.width=e.width,t.height=e.height,t.minHeight=e.minHeight,t.maxHeight=e.maxHeight,t.minWidth=e.minWidth,t.maxWidth=e.maxWidth,t.horizontalAlignment=e.wrapper.children[0].horizontalAlignment,t.verticalAlignment=e.wrapper.children[0].verticalAlignment,t.relativeMode=e.wrapper.children[0].relativeMode,t.visible=e.wrapper.children[0].visible,e.shape instanceof Text&&(t.margin=e.shape.margin),t.id=e.wrapper.children[0].id,t.style=e.style;for(var r=0,o=i.views;r<o.length;r++){var n=o[r];ki(e.id+"_groupElement",n),ki(e.id+"_content_groupElement",n),ki(e.id+"_content_html_element",n)}e.wrapper.children.splice(0,1),e.wrapper.children.splice(0,0,t)}function Ue(t,e,i,r){var o=new Ar;switch(t.shape.type){case"Path":var n=new Yr;n.data=e.shape.data,Ve(o=n,e,r);break;case"Image":var a=new qr;a.source=e.shape.source,a.imageAlign=e.shape.align,a.imageScale=e.shape.scale,Ve(o=a,e,r);break;case"Text":Ve(o=new Gr,e,r);break;case"Basic":var s=void 0;s="Rectangle"===e.shape.shape?new Ar:new Yr,"Polygon"===e.shape.shape?s.data=h(e.shape.points):s.data=T(e.shape.shape),Ve(o,e,r),"Rectangle"===e.shape.shape&&(s.cornerRadius=e.shape.cornerRadius),o=s;break;case"Flow":var d=new Yr;d.data=O(e.shape.shape),Ve(o=d,e,r);break;case"Native":var l=new Ur(t.id,r.element.id);l.content=e.shape.content,l.scale=e.shape.scale,Ve(o=l,e,r);break;case"HTML":var c=new Po(t.id,r.element.id);c.content=e.shape.content,Ve(o=c,e,r)}void 0===t.shape.type||t.shape.type===i.shape.type?Fe(t,e,r):(o.width=e.wrapper.children[0].width,o.height=e.wrapper.children[0].height,e.shape instanceof Text&&(o.margin=e.shape.margin),o.style=e.style,e.wrapper.children[0]=o)}function Fe(t,e,i){if(Object.keys(t.shape).length>0)if("Path"===e.shape.type&&void 0!==t.shape.data)e.wrapper.children[0].data=t.shape.data;else if("Text"===e.shape.type&&void 0!==t.shape.content)e.wrapper.children[0].content=t.shape.content;else if("Image"===e.shape.type&&void 0!==t.shape.source)e.wrapper.children[0].source=t.shape.source;else if("Native"===e.shape.type){for(var r=void 0,o=0;o<i.views.length;o++)r=wi(e.wrapper.children[0].id+"_groupElement",i.views[o]),void 0!==t.shape.content&&r&&(r.removeChild(r.children[0]),e.wrapper.children[0].content=t.shape.content,r.appendChild(Ri(e.wrapper.children[0],!1)));e.wrapper.children[0].scale=t.shape.scale?t.shape.scale:e.wrapper.children[0].scale}else if("HTML"===e.shape.type){var n=void 0;for(o=0;o<i.views.length;o++)(n=wi(e.wrapper.children[0].id+"_html_element",i.views[o]))&&(n.removeChild(n.children[0]),e.wrapper.children[0].content=t.shape.content,n.appendChild(Ri(e.wrapper.children[0],!0)))}else if("Flow"===e.shape.type&&void 0!==t.shape.shape){e.shape.shape=t.shape.shape;var a=O(e.shape.shape.toString());e.wrapper.children[0].data=a}else if("UmlActivity"===e.shape.type&&void 0!==t.shape.shape)Ge(e,t);else if(void 0!==t.shape.cornerRadius)e.wrapper.children[0].cornerRadius=t.shape.cornerRadius;else if(void 0!==t.shape.shape){e.shape.shape=t.shape.shape;var s=T(e.shape.shape.toString());e.wrapper.children[0].data=s}}function Ge(t,e){t.shape.shape=e.shape.shape;var i=be(t.shape.shape.toString());"InitialNode"===t.shape.shape?t.wrapper.children[0].style.fill="black":"ForkNode"===t.shape.shape||"JoinNode"===t.shape.shape?t.wrapper.children[0].style.fill="black":"FinalNode"===t.shape.shape&&(t instanceof En&&(t.wrapper=Ze(t)),t.wrapper.children[0].data=i)}function Ze(t){var e=new Qr;e.style.fill="transparent";var i="M 25 50 C 11.21 50 0 38.79 0 25 C 0 11.21 11.21 0 25 0 C 38.78 0 50 11.21 50 25 C 50 38.79 38.78 50 25 50",r=new Yr;r.data=i,r.id=t.id+"_0_finalNode",r.horizontalAlignment="Center",r.verticalAlignment="Center",r.relativeMode="Object",r.style.strokeColor=t.style.strokeColor,r.style.strokeWidth=t.style.strokeWidth;var o=new Yr;return o.data=i,o.id=t.id+"_1_finalNode",o.horizontalAlignment="Center",o.verticalAlignment="Center",o.relativeMode="Object",o.style.fill=t.style.fill,o.style.strokeColor=t.style.strokeColor,o.style.strokeWidth=t.style.strokeWidth,e.children=[r,o],e.children[0].width=t.width,e.children[0].height=t.height,e.children[1].height=t.height/1.5,e.children[1].width=t.width/1.5,e.style.strokeWidth=0,e.style.strokeColor="transparent",e}function qe(t,e,i){var r=be(i.shape.shape);switch(t.data=r,e=t,i.shape.shape){case"StructuredNode":if(i.annotations)for(var o=0;o<i.annotations.length;o++)i.annotations[o].content="<<"+i.annotations[o].content+">>";e=t;break;case"FinalNode":e=Ze(i)}return e}function Ke(t,e){var i=t.indexOf(e);i>=0&&t.splice(i,1)}function Qe(t,e){var i,r,o;if(t.intermediatePoints=e,t.updateSegmentElement(t,e,t.wrapper.children[0]),t.sourcePoint,r=t.sourceDecorator,"Bezier"===t.type){var n=t.segments[0],a=t.segments[t.segments.length-1];i=[wr.isEmptyPoint(a.point2)?a.bezierPoint2:a.point2,wr.isEmptyPoint(n.point1)?n.bezierPoint1:n.point1]}else i=t.intermediatePoints;e=t.clipDecorators(t,e);var s=t.wrapper.children[0];s.canMeasurePath=!0,s=t.wrapper.children[1],t.updateDecoratorElement(s,e[0],i[1],r),t.targetPoint,o=t.targetDecorator,s=t.wrapper.children[2],t.updateDecoratorElement(s,e[e.length-1],i[i.length-2],o),t.updateShapeElement(t)}function Je(t,e,i){var r,o=t.wrapper,n=o.bounds,a=e.offset,s=e.size/i.scale,h=e.margin,d=o.offsetX-o.actualSize.width*o.pivot.x,l=o.offsetY-o.actualSize.height*o.pivot.y;if(r={x:0,y:0},t.nodes.length>0){switch(e.side){case"Top":r.x+=d+n.width*a,r.y+=l-s;break;case"Bottom":r.x+=d+a*n.width,r.y+=l+o.actualSize.height+s;break;case"Left":r.x+=d-s,r.y+=l+a*n.height;break;case"Right":r.x+=d+o.actualSize.width+s,r.y+=l+a*n.height}r.x+=h.left-h.right+s/2*("Center"===e.horizontalAlignment?0:"Right"===e.horizontalAlignment?-1:1),r.y+=h.top-h.bottom+s/2*("Center"===e.verticalAlignment?0:"Top"===e.verticalAlignment?-1:1)}else if(t.connectors.length>0){var c=t.connectors[0],p={offset:a},g=Ne(c.intermediatePoints,p),u=g.index;r=g.point;var f=Re(c.intermediatePoints,p,n),v=(c.intermediatePoints,f.angle);b(w=m(),-v,c.intermediatePoints[u].x,c.intermediatePoints[u].y),(r=y(w,r)).x+=h.left-h.right+s/2*("Center"===e.horizontalAlignment?0:"Right"===e.horizontalAlignment?-1:1),r.y+=h.top-h.bottom+s/2*("Center"===e.verticalAlignment?0:"Top"===e.verticalAlignment?-1:1),b(w=m(),v,c.intermediatePoints[u].x,c.intermediatePoints[u].y),r=y(w,r)}if(0!==o.rotateAngle||0!==o.parentTransform){var w;b(w=m(),o.rotateAngle+o.parentTransform,o.offsetX,o.offsetY),r=y(w,r)}return r}function $e(e,i,r,o){if(o.annotation){if(Dt(o.annotation))return!0}else if(t.SelectorConstraints[i]&e&&t.ThumbsConstraints[i]&r)return!0;return!1}function ti(e,i){return!!(t.SelectorConstraints[i]&e)}function ei(t,e){return t.visibility&e}function ii(t,e){var i;if("Text"===t.shape.type)i=t.shape;else{var r=e.split("_");e=r[r.length-1];for(var o=0;o<t.annotations.length;o++)e===t.annotations[o].id&&(i=t.annotations[o])}return i}function ri(t,e){var i=e.split("_");e=i[i.length-1];for(var r=0;r<t.ports.length;r++)if(e===t.ports[r].id)return t.ports[r]}function oi(e,i){var r={},o=0;if(e.ports){var n=e.ports;for(o=0;o<n.length;o++)i?n[o].constraints&t.PortConstraints.InConnect&&(r=n[o]):n[o].constraints&t.PortConstraints.OutConnect&&(r=n[o])}return r}function ni(t,e,i){for(var r=i?t.annotations:t.ports,o=0;o<r.length;o++)if(r[o].id===e)return o.toString();return null}function ai(t,e){var i;for(i=0;i<t.length;i++)if(e===t[i].id)return!0;return!1}function si(t,e,i,r){if(void 0!==t.width&&void 0!==t.height&&(t.width*=e,t.height*=i),t instanceof _r){var o=m(),n=r.width||r.actualSize.width,a=r.height||r.actualSize.height;if(void 0!==n&&void 0!==a){var s=r.offsetX-n*r.pivot.x,h=r.offsetY-a*r.pivot.y,d={x:s+n*r.pivot.x,y:h+a*r.pivot.y};d=tr(r.rotateAngle,r.offsetX,r.offsetY,d),b(o,-r.rotateAngle,d.x,d.y),w(o,e,i,d.x,d.y),b(o,r.rotateAngle,d.x,d.y);for(var l=0,c=t.children;l<c.length;l++){var p=c[l];if(void 0!==p.width&&void 0!==p.height){var g=y(o,{x:p.offsetX,y:p.offsetY});p.offsetX=g.x,p.offsetY=g.y,si(p,e,i,r)}}}}}function hi(t,e,i,r,o,n){for(var a,s=t.children,h=0;h<s.length;h++)if(a=r[s[h]])if(a.children)this.arrangeChild(a,e,i,r,o,n);else if(a.offsetX-=e,a.offsetY-=i,!o){var d=void 0,l=void 0;r[a.id]=a,(l=a.initContainer()).children||(l.children=[]),d=a.init(n),l.children.push(d),l.measure(new yr(a.width,a.height)),l.arrange(l.desiredSize)}}function di(t,e,i){if(0===i.length)i.push(t);else if(1===i.length)i[0][e]>t[e]?i.splice(0,0,t):i.push(t);else if(i.length>1){for(var r=0,o=i.length-1,n=Math.floor((r+o)/2);n!==r;)i[n][e]<t[e]?(r=n,n=Math.floor((r+o)/2)):i[n][e]>t[e]&&(o=n,n=Math.floor((r+o)/2));i[o][e]<t[e]?i.push(t):i[r][e]>t[e]?i.splice(r,0,t):i[r][e]<t[e]&&i[o][e]>t[e]&&i.splice(o,0,t)}}function li(t){var e=document.getElementById(t.diagramId),i="ej2_instances",r=e[i][0].nodes;void 0===r&&(r=function(t){for(var e=[],i=0;i<t.palettes.length;i++)for(var r=t.palettes[i].symbols,o=0;o<r.length;o++)r[o]instanceof En&&e.push(r[o]);return e}(e[i][0]));for(var o=0;r&&o<r.length;o++)if(r[o].id===t.nodeId)return ci(r[o],t);var n=e[i][0].connectors;for(o=0;n&&o<n.length;o++)if(n[o].id===t.nodeId)return ci(n[o],t);var a=e[i][0].enterObject;return a&&(a.id===t.nodeId||a.children)?a.children&&Ae(a,"HTML",e[i][0].enterTable)?e[i][0].enterTable[t.nodeId]:a:null}function ci(t,e){var i,r=t.annotations;for(i=0;r&&i<r.length;i++)if(e.annotationId&&r[i].id===e.annotationId)return r[i];return t}function pi(t,e,i,r,o,n,a,s){var h={x:0,y:0},d=m();switch(b(d,o,n,a),s.x){case 0:switch(s.y){case 0:h=y(d,{x:t,y:e});break;case.5:h=y(d,{x:t,y:e+r/2});break;case 1:h=y(d,{x:t,y:e+r})}break;case.5:switch(s.y){case 0:h=y(d,{x:t+i/2,y:e});break;case.5:h=y(d,{x:t+i/2,y:e+r/2});break;case 1:h=y(d,{x:t+i/2,y:e+r})}break;case 1:switch(s.y){case 0:h=y(d,{x:t+i,y:e});break;case.5:h=y(d,{x:t+i,y:e+r/2});break;case 1:h=y(d,{x:t+i,y:e+r})}}return{x:h.x,y:h.y}}function gi(t){var e,i,r=[],o="measureElement";window[o].style.visibility="visible";var a=ui(window[o].children[2])[0];a.setAttributeNS(null,"d",t.data);var s=function(t,e,i){var r,o=0,a=0,s=!1,h="",d=[];0===(r=e).x&&0===r.y||(o=0-Number(r.x),a=0-Number(r.y));t.actualSize.width===r.width&&t.actualSize.height===r.height||(o=t.actualSize.width/Number(r.width?r.width:1),a=t.actualSize.height/Number(r.height?r.height:1),s=!0);return d=n(t.data),d=g(d),h=l(d,o,a,s,r.x,r.y,0,0),s=!1,h}(t,t.absoluteBounds);a.setAttributeNS(null,"d",s);var h=a.getTotalLength();for(i=0;i<=h;i+=10)e=a.getPointAtLength(i),r.push({x:e.x,y:e.y});return window[o].style.visibility="hidden",r}function ui(t){var i,r=[];if("msie"===e.Browser.info.name||"edge"===e.Browser.info.name)for(var o=0;o<t.childNodes.length;o++)1===(i=t.childNodes[o]).nodeType&&r.push(i);else r=t.children;return r}function fi(t){if(t){var e="measureElement";window[e].style.visibility="visible";var i=ui(window[e].children[2])[0];i.setAttribute("d",t);var r=i.getBBox(),o=new xr(r.x,r.y,r.width,r.height);return window[e].style.visibility="hidden",o}return new xr(0,0,0,0)}function mi(t,e){var i,r,o=[],n=0,a=e||t.content;if("nowrap"!==t.whiteSpace&&"pre"!==t.whiteSpace)if("breakall"===t.breakWord)for(i="",i+=a[0],n=0;n<a.length;n++)if((r=qi(i,t))>=t.width&&i.length>0)o[o.length]={text:i,x:0,dy:0,width:r},i="";else{(i+=a[n+1]||"").indexOf("\n")>-1&&(i=i.replace("\n",""));var s=qi(i,t);Math.ceil(s)+2>=t.width&&i.length>0&&(o[o.length]={text:i,x:0,dy:0,width:s},i=""),n===a.length-1&&i.length>0&&(o[o.length]={text:i,x:0,dy:0,width:s},i="")}else o=function(t,e){var i,r,o,n,a=[],s="",h=0,d=0,l="nowrap"!==t.whiteSpace,c=(e||t.content).split("\n");for(h=0;h<c.length;h++)for(i="NoWrap"!==t.textWrapping?c[h].split(" "):c,d=0;d<i.length;d++){s+=((0!==d||1===i.length)&&l&&s.length>0?" ":"")+i[d];var p=qi(r=s+(i[d+1]||""),t);Math.floor(p)>t.width-2&&s.length>0?(a[a.length]={text:s,x:0,dy:0,width:r===s?p:s===n?o:qi(s,t)},s=""):d===i.length-1&&(a[a.length]={text:s,x:0,dy:0,width:p},s=""),n=r,o=p}return a}(t,e);else o[o.length]={text:a,x:0,dy:0,width:qi(a,t)};return o}function yi(t,e,i,r,o){var n=new yr,a=Oi("span",{style:"display:inline-block; line-height: normal"});return t.bold&&(a.style.fontWeight="bold"),t.italic&&(a.style.fontStyle="italic"),void 0!==i&&(a.style.width=i.toString()+"px"),void 0!==r&&(a.style.height=r.toString()+"px"),void 0!==o&&(a.style.maxWidth=o.toString()+"px"),a.style.fontFamily=t.fontFamily,a.style.fontSize=t.fontSize+"px",a.style.color=t.color,a.textContent=e,a.style.whiteSpace=Ji(t.whiteSpace,t.textWrapping),a.style.wordBreak=void 0!==o?"break-word":Zi(t.textWrapping),document.body.appendChild(a),n.width=a.offsetWidth,n.height=a.offsetHeight,document.body.removeChild(a),n}function vi(t,e,i,r,o){var n,a,s=new yr(0,0),h=function(t,e){var i={fill:t.style.fill,stroke:t.style.strokeColor,angle:t.rotateAngle+t.parentTransform,pivotX:t.pivot.x,pivotY:t.pivot.y,strokeWidth:t.style.strokeWidth,dashArray:t.style.strokeDashArray,opacity:t.style.opacity,shadow:t.shadow,gradient:t.style.gradient,visible:t.visible,id:t.id,description:t.description,width:e||t.actualSize.width,height:t.actualSize.height,x:t.offsetX-t.actualSize.width*t.pivot.x+.5,y:t.offsetY-t.actualSize.height*t.pivot.y+.5};return i.fontSize=t.style.fontSize,i.fontFamily=t.style.fontFamily,i.textOverflow=t.style.textOverflow,i.textDecoration=t.style.textDecoration,i.doWrap=t.doWrap,i.whiteSpace=Ji(t.style.whiteSpace,t.style.textWrapping),i.content=t.content,i.textWrapping=t.style.textWrapping,i.breakWord=Zi(t.style.textWrapping),i.textAlign=Gi(t.style.textAlign),i.color=t.style.color,i.italic=t.style.italic,i.bold=t.style.bold,i.dashArray="",i.strokeWidth=0,i.fill="",i}(t,r);return t.childNodes=n=mi(h,o),t.wrapBounds=a=function(t,e){var i,r,o={x:0,width:0},n=0;for(n=0;n<e.length;n++)r=i=e[n].width,i="left"===t.textAlign?0:"center"===t.textAlign?i>t.width&&("Ellipsis"===t.textOverflow||"Clip"===t.textOverflow)?0:-i/2:"right"===t.textAlign?-i:e.length>1?0:-i/2,e[n].dy=1.2*t.fontSize,e[n].x=i,o?(o.x=Math.min(o.x,i),o.width=Math.max(o.width,r)):o={x:i,width:r};return o}(h,n),s.width=a.width,s.height=n.length*t.style.fontSize*1.2,s}function bi(t){var e;return e=wi(t).getElementsByClassName("e-diagram-layer"),e[0]}function wi(t,e){var i;return e&&(i=document.getElementById(e)),i?i.querySelector("#"+t):document.getElementById(t)}function xi(t){var e;return e=wi(t).getElementsByClassName("e-adorner-layer"),e[0]}function Si(t){return xi(t).getElementById(t+"_SelectorElement")}function Pi(t){return xi(t).getElementById(t+"_diagramAdorner")}function Ci(t){var e;return e=wi(t).getElementsByClassName("e-native-layer"),e[0]}function Ti(t){var e;return e=wi(t).getElementsByClassName("e-grid-layer"),e[0]}function Ai(t){return wi(t).getElementsByClassName("e-background-layer")[0].parentNode}function Mi(t){var e;return e=wi(t).getElementsByClassName("e-background-layer"),e[0]}function Li(t){var e;return e=wi(t).getElementsByClassName("e-html-layer"),e[0]}function Oi(t,i){var r=e.createElement(t);return Bi(r,i),r}function Ii(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg",t);return Ni(i,e),i}function Ei(t,e,i){for(var r=t;r&&(i?r.id!==e:!zi(r,e));)r=r.parentNode;return r}function zi(t,e){return(" "+("object"==typeof t.className?t.className.animVal:t.className)+" ").indexOf(" "+e+" ")>-1}function Di(t,e,i){t=[];for(var r=0,o=i.length;r<o;r++)t.push({pageX:i[r].clientX,pageY:i[r].clientY,pointerId:null});return t}function ki(t,e){var i=wi(t,e);i&&i.parentNode.removeChild(i)}function Ri(t,i){var r;if(i){r=Oi("div",{style:"height: 100%; width: 100%"})}else r=document.createElementNS("http://www.w3.org/2000/svg","g");var o,n=li(t);if("string"==typeof t.content)for(var a=0,s=e.compile(t.content)(n);a<s.length;a++)o=s[a],r.appendChild(o);else r.appendChild(t.content);return r.cloneNode(!0)}function Ni(t,e){for(var i=Object.keys(e),r=0;r<i.length;r++)t.setAttribute(i[r],e[i[r]])}function Bi(t,e){for(var i=Object.keys(e),r=0;r<i.length;r++)t.setAttribute(i[r],e[i[r]])}function ji(){var t="measureElement";if(window[t])window[t].usageCount+=1;else{var e=Oi("div",{id:"measureElement",style:"visibility:hidden ; height: 0px ; width: 0px; overflow: hidden;"}),i=Oi("span",{style:"display:inline-block ; line-height: normal"});e.appendChild(i);var r=void 0;r=Oi("img",{}),e.appendChild(r);var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("xlink","http://www.w3.org/1999/xlink"),e.appendChild(o);var n=document.createElementNS("http://www.w3.org/2000/svg","path");o.appendChild(n);document.createTextNode("");var a=document.createElementNS("http://www.w3.org/2000/svg","text");a.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),o.appendChild(a),window[t]=e,window[t].usageCount=1,document.body.appendChild(e)}}function Hi(){for(var t,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",i="",r=0;r<5;r++){if("crypto"in window&&"getRandomValues"in crypto){var o=new Uint16Array(1);t=(window.msCrypto||window.crypto).getRandomValues(o)[0]%(e.length-1)}else t=Math.floor(Math.random()*e.length);0===r&&t<10?r--:i+=e.substring(t,t+1)}return i}function Wi(t){new xr;var e=t.offsetY-t.actualSize.height*t.pivot.y,i=t.offsetY+t.actualSize.height*(1-t.pivot.y),r=t.offsetX-t.actualSize.width*t.pivot.x,o=t.offsetX+t.actualSize.width*(1-t.pivot.x),n={x:r,y:e},a={x:o,y:e},s={x:r,y:i},h={x:o,y:i};return xr.toBounds([n,a,s,h])}function _i(t){var e,i=new xr,r=(e=Wi(t)).middleLeft,o=e.topCenter,n=e.bottomCenter,a=e.middleRight,s=e.topLeft,h=e.topRight,d=e.bottomLeft,l=e.bottomRight;if(t.corners={topLeft:s,topCenter:o,topRight:h,middleLeft:r,middleRight:a,bottomLeft:d,bottomCenter:n,bottomRight:l},0!==t.rotateAngle||0!==t.parentTransform){var c=m();b(c,t.rotateAngle+t.parentTransform,t.offsetX,t.offsetY),t.corners.topLeft=s=y(c,s),t.corners.topCenter=o=y(c,o),t.corners.topRight=h=y(c,h),t.corners.middleLeft=r=y(c,r),t.corners.middleRight=a=y(c,a),t.corners.bottomLeft=d=y(c,d),t.corners.bottomCenter=n=y(c,n),t.corners.bottomRight=l=y(c,l)}return i=xr.toBounds([s,h,d,l]),t.corners.left=i.left,t.corners.right=i.right,t.corners.top=i.top,t.corners.bottom=i.bottom,t.corners.center=i.center,t.corners.width=i.width,t.corners.height=i.height,i}function Xi(t,e,i){var r={},o="properties";if(t){i=t.propName;var n=t[o]||t,a=[];a=a.concat(Object.keys(n));var s=[];if(i){var h=ir(e);s=h?h(i):[],a=a.concat(s)}for(var d=Yi(i),l=0,c=a=a.concat(d);l<c.length;l++){var p=c[l];if("wrapper"!==p){!(!t[p]||!t.hasOwnProperty("observers"))||(t[p]instanceof Array?r[p]=Vi(-1===d.indexOf(p)&&t[o]?t[o][p]:t[p],e,p):t[p]instanceof Array==!1&&t[p]instanceof HTMLElement?r[p]=t[p].cloneNode(!0).innerHtml:t[p]instanceof Array==!1&&t[p]instanceof Object?r[p]=Xi(-1===d.indexOf(p)&&t[o]?t[o][p]:t[p]):r[p]=t[p])}else t[p]&&(r[p]={actualSize:{width:t[p].actualSize.width,height:t[p].actualSize.height},offsetX:t[p].offsetX,offsetY:t[p].offsetY})}}return r}function Yi(t){switch(t){case"nodes":return["inEdges","outEdges","parentId","processId","nodeId","umlIndex"];case"connectors":return["parentId"];case"annotation":case"annotations":return["nodeId"]}return[]}function Vi(t,e,i){var r;if(t){r=[];for(var o=0;o<t.length;o++)t[o]instanceof Array?r.push(t[o]):t[o]instanceof Object?r.push(Xi(t[o],e,i)):r.push(t[o])}return r}function Ui(t,e){var i="properties";if(t){e||(e={properties:{}});for(var r=0,o=Object.keys(t);r<o.length;r++){var n=o[r];if(t[n]instanceof Array){var a=Fi(t[n],e[i][n]);e[i][n]&&e[i][n].length||(e[n]=a)}else if(t[n]instanceof Array==!1&&t[n]instanceof HTMLElement)e[n]=t[n].cloneNode(!0).innerHtml;else if(t[n]instanceof Array==!1&&t[n]instanceof Object){var s=Ui(t[n],e[i][n]);s[i]&&!Object.keys(s[i]).length&&delete s[i],e[n]=s}else e[n]=void 0!==e[i][n]?e[n]:t[n]}}return e}function Fi(t,e){var i=[],r=!1;e||(e=[]),e.length||(r=!0);for(var o=0;o<t.length;o++)if(t[o]instanceof Array){Fi(t[o],e[o]);r&&i.push(Fi)}else if(t[o]instanceof Object){var n=Ui(t[o],e[o]);r&&i.push(n)}else i.push(t[o]);return i}function Gi(t){var e="";switch(t){case"Center":e="center";break;case"Left":e="left";break;case"Right":e="right"}return e}function Zi(t){var e="";switch(t){case"Wrap":e="breakall";break;case"NoWrap":e="keepall";break;case"WrapWithOverflow":e="normal";break;case"LineThrough":e="line-through"}return e}function qi(t,e){var i="measureElement";window[i].style.visibility="visible";var r=ui(window[i].children[2])[1];r.textContent=t,r.setAttribute("style","font-size:"+e.fontSize+"px; font-family:"+e.fontFamily+";font-weight:"+(e.bold?"bold":"normal"));var o=r.getBBox().width;return window[i].style.visibility="hidden",o}function Ki(t,e){return(t+e)/2}function Qi(t,e){var i=0,r=0,o=0,n=0,a="";r=t.length;var s=0;do{n>0&&(i=o),o=Math.floor(Ki(i,r)),n=qi(a+=t.substr(i,o),e)}while(n<=e.width);for(a=a.substr(0,i),s=i;s<r;s++)if(a+=t[s],(n=qi(a,e))>=e.width){t=t.substr(0,a.length-1);break}return"Ellipsis"===e.textOverflow?(t=t.substr(0,t.length-3),t+="..."):t=t.substr(0,t.length),t}function Ji(t,e){if("NoWrap"===e&&"PreserveAll"===t)return"pre";var i="";switch(t){case"CollapseAll":i="nowrap";break;case"CollapseSpace":i="pre-line";break;case"PreserveAll":i="pre-wrap"}return i}function $i(t,e){var i=m();b(i,e,0,0);var r=y(i,{x:0,y:0}),o=y(i,{x:t.width,y:0}),n=y(i,{x:0,y:t.height}),a=y(i,{x:t.width,y:t.height}),s=Math.min(r.x,o.x,n.x,a.x),h=Math.min(r.y,o.y,n.y,a.y),d=Math.max(r.x,o.x,n.x,a.x),l=Math.max(r.y,o.y,n.y,a.y);return new yr(d-s,l-h)}function tr(t,e,i,r){if(0!==t){var o=m();return b(o,t,e,i),y(o,r)}return r}function er(t,e){return{x:t.x+e.desiredSize.width*e.pivot.x,y:t.y+e.desiredSize.height*e.pivot.y}}function ir(t){return void 0!==t&&"string"==typeof t&&(t=e.getValue(t,window)),t}function rr(e,i,r,o,n,a,s){o.selectedItems.connectors[0];if(a&&a.length>1&&n&&n.length>1)return"PinchZoom";if(o.currentSymbol)return"Drag";if("PortDraw"===o.eventHandler.action&&(o.tool&=~t.DiagramTools.DrawOnce),(Ht(o)||jt(o))&&o.drawingObject)return"Draw";if(ar(o)){if((g=o.selectedItems).wrapper&&ti(g.constraints,"UserHandle"))for(var h=0,d=g.userHandles;h<d.length;h++){var l=d[h];if(l.visible){if(nr(r,u=Je(g,l,o.scroller.transform),l.size/2))return l.name}}}if(Bt(o)&&!e)return"Pan";if(ar(o)){var c=o.selectedItems.annotation?o.selectedItems.wrapper.children[0]:o.selectedItems.wrapper,p=c.bounds,g=o.selectedItems,u=new xr(p.x,p.y,p.width,p.height);if(sr(o)&&!o.selectedItems.annotation){var f=o.selectedItems.connectors[0],v=10/o.scrollSettings.currentZoom,w=10/o.scrollSettings.currentZoom;if(ti(g.constraints,"ResizeAll")){if(ti(g.constraints,"ConnectorSourceThumb")&&Ct(f)&&nr(r,f.sourcePoint,v))return"ConnectorSourceEnd";if(ti(g.constraints,"ConnectorTargetThumb")&&Tt(f)&&nr(r,f.targetPoint,w))return"ConnectorTargetEnd";if(L=function(t,e,i,r){var o=10/r.scrollSettings.currentZoom,n=10/r.scrollSettings.currentZoom;if("Bezier"===t.type)for(var a=0;a<t.segments.length;a++){var s=t.segments[a];if(nr(i,wr.isEmptyPoint(s.point1)?s.bezierPoint1:s.point1,n))return"BezierSourceThumb";if(nr(i,wr.isEmptyPoint(s.point2)?s.bezierPoint2:s.point2,o))return"BezierTargetThumb"}if(r.connectorEditingToolModule&&At(t))if("Straight"===t.type||"Bezier"===t.type)for(var a=0;a<t.segments.length;a++){var s=void 0;if(s=t.segments[a],nr(i,s.point,10))return"SegmentEnd"}else for(var a=0;a<t.segments.length;a++){var s=void 0,h={x:0,y:0};s=t.segments[a];for(var d=0;d<s.points.length-1;d++){var l=wr.distancePoints(s.points[d],s.points[d+1]);if(l>=50&&(h.x=(s.points[d].x+s.points[d+1].x)/2,h.y=(s.points[d].y+s.points[d+1].y)/2,nr(i,h,30)))return"OrthoThumb"}}return null}(f,0,r,o))return L}}else{var x=10/o.scroller.currentZoom,S=m();b(S,c.rotateAngle+c.parentTransform,c.offsetX,c.offsetY);var P=c.offsetX-c.pivot.x*c.actualSize.width,C=c.offsetY-c.pivot.y*c.actualSize.height,T={x:P+(.5===c.pivot.x?2*c.pivot.x:c.pivot.x)*c.actualSize.width/2,y:C-30/o.scroller.currentZoom};T=y(S,T);var A=!!o.selectedItems.annotation,M=!(!A||!Mt(o.selectedItems.annotation));if(ti(g.constraints,"Rotate")&&nr(r,T,x)&&o.selectedItems.thumbsConstraints&t.ThumbsConstraints.Rotate){if(A&&M)return"LabelRotate";if(!A)return"Rotate"}if(u.Inflate(x),u.containsPoint(r)){if(L=function(t,e,i,r,o,n){var a;1===t.selectedItems.nodes.length&&0===t.selectedItems.connectors.length&&t.selectedItems.nodes[0].container&&(a=function(t,e,i,r,o){var n=10/t.scroller.currentZoom,a=40/t.scroller.currentZoom,s=t.selectedItems,h=e.actualSize.width,d=e.actualSize.height,l=new xr(r,o+20,e.style.strokeWidth,d-40),c=new xr(r+h,o+20,e.style.strokeWidth,d-40),p=new xr(r+20,o,h-40,e.style.strokeWidth),g=new xr(r+20,o+d,h-40,e.style.strokeWidth),u=$t(t,t.selectedItems.nodes[0],!0)?t.nameTable[t.selectedItems.nodes[0].parentId]:t.selectedItems.nodes[0];if(h>=a&&d>=a){if($e(s.constraints,"ResizeEast",s.thumbsConstraints,s)&&c.containsPoint(i,n))return"ResizeEast";if($e(s.constraints,"ResizeSouth",s.thumbsConstraints,s)&&g.containsPoint(i,n))return"ResizeSouth";if("Grid"!==u.container.type){if($e(s.constraints,"ResizeWest",s.thumbsConstraints,s)&&l.containsPoint(i,n))return"ResizeWest";if($e(s.constraints,"ResizeNorth",s.thumbsConstraints,s)&&p.containsPoint(i,n))return"ResizeNorth"}}return null}(t,e,i,o,n));a||(a=function(t,e,i,r,o,n){var a=40/t.scroller.currentZoom,s=10/t.scroller.currentZoom,h=t.selectedItems,d=!!h.annotation;if(e.actualSize.width>=a&&e.actualSize.height>=a){if($e(h.constraints,"ResizeSouthEast",h.thumbsConstraints,h)&&nr(i,y(r,{x:o+e.actualSize.width,y:n+e.actualSize.height}),s))return d?"LabelResizeSouthEast":"ResizeSouthEast";if($e(h.constraints,"ResizeSouthWest",h.thumbsConstraints,h)&&nr(i,y(r,{x:o,y:n+e.actualSize.height}),s))return d?"LabelResizeSouthWest":"ResizeSouthWest";if($e(h.constraints,"ResizeNorthEast",h.thumbsConstraints,h)&&nr(i,y(r,{x:o+e.actualSize.width,y:n}),s))return d?"LabelResizeNorthEast":"ResizeNorthEast";if($e(h.constraints,"ResizeNorthWest",h.thumbsConstraints,h)&&nr(i,y(r,{x:o,y:n}),s))return d?"LabelResizeNorthWest":"ResizeNorthWest"}if($e(h.constraints,"ResizeEast",h.thumbsConstraints,h)&&nr(i,y(r,{x:o+e.actualSize.width,y:n+e.actualSize.height/2}),s))return d?"LabelResizeEast":"ResizeEast";if($e(h.constraints,"ResizeWest",h.thumbsConstraints,h)&&nr(i,y(r,{x:o,y:n+e.actualSize.height/2}),s))return d?"LabelResizeWest":"ResizeWest";if($e(h.constraints,"ResizeSouth",h.thumbsConstraints,h)&&nr(i,y(r,{x:o+e.actualSize.width/2,y:n+e.actualSize.height}),s))return d?"LabelResizeSouth":"ResizeSouth";if($e(h.constraints,"ResizeNorth",h.thumbsConstraints,h)&&nr(i,y(r,{x:o+e.actualSize.width/2,y:n}),s))return d?"LabelResizeNorth":"ResizeNorth";return null}(t,e,i,r,o,n));if(a)return a;return null}(o,c,r,S,P,C))return L}}}if(s instanceof io&&!Bt(o)){var L;if("None"!==(L=or(o,s)))return L}if((s instanceof so||s instanceof ho)&&!Bt(o)&&xt(s))return hr(o,s,void 0,i)&&St(s)?"LabelDrag":"LabelSelect";if(null!==e){if(!(e instanceof En||e instanceof Wo))return"Select";if(i&&i.id){var O=i.id.split(e.id)[1];if(O&&O.match("^_icon"))return"LayoutAnimation"}if(St(e)&&i instanceof Gr&&i.hyperlink.link)return"Hyperlink";if(!St(e)||!hr(o,e,!1)||void 0!==o.selectedItems.annotation)return e&&Bt(o)&&!Wt(o)?"Pan":"Select";if(e instanceof Wo&&!nr(r,e.sourcePoint,e.hitPadding)&&!nr(r,e.targetPoint,e.hitPadding)||!(e instanceof Wo))return"Drag"}return"Select"}function or(e,i,r,o){if(Ut(i)&&(ei(i,t.PortVisibility.Hover)||ei(i,t.PortVisibility.Visible))){if(i.constraints&t.PortConstraints.Drag)return"PortDrag"}else if(Vt(i)&&(ei(i,t.PortVisibility.Hover)||ei(i,t.PortVisibility.Visible))&&i.constraints&t.PortConstraints.Draw){e.drawingObject={};var n={type:"Orthogonal",sourcePortID:i.id};return e.drawingObject=n,e.tool|=t.DiagramTools.DrawOnce,e.currentDrawingObject=n,"PortDraw"}return"None"}function nr(t,e,i){return t.x>=e.x-i&&t.x<=e.x+i&&t.y>=e.y-i&&t.y<=e.y+i}function ar(t){return t.selectedItems.nodes.length>0||t.selectedItems.connectors.length>0}function sr(t){return 1===t.selectedItems.connectors.length&&!t.selectedItems.nodes.length}function hr(t,e,i,r){if(void 0===i&&(i=!0),e instanceof Vo)return!0;if(e instanceof En)for(;e;){if(-1!==t.selectedItems.nodes.indexOf(e)&&void 0===t.selectedItems.annotation)return!0;if(i)break;e=t.nameTable[e.parentId]}else if(e instanceof Wo){if(-1!==t.selectedItems.connectors.indexOf(e)&&void 0===t.selectedItems.annotation)return!0}else if((e instanceof so||e instanceof ho)&&t.selectedItems.annotation&&t.selectedItems.wrapper.children[0].id===r.id)return!0;return!1}function dr(t,e){if(e+=360,e%=360,-1===t.indexOf("Resize"))return ga[t];var i=ga[t];return e>=0&&e<25||e>=160&&e<=205||e>=340&&e<=360?i:e>=25&&e<=70||e>=205&&e<=250?"n-resize"===i||"s-resize"===i?"ne-resize":"nw-resize"===i||"se-resize"===i?"n-resize":"e-resize"===i||"w-resize"===i?"nw-resize":"e-resize":e>=70&&e<=115||e>=250&&e<=295?"n-resize"===i||"s-resize"===i?"e-resize":"nw-resize"===i||"se-resize"===i?"ne-resize":"e-resize"===i||"w-resize"===i?"n-resize":"nw-resize":e>=115&&e<=155||e>=295&&e<=340?"n-resize"===i||"s-resize"===i?"nw-resize":"nw-resize"===i||"se-resize"===i?"e-resize":"e-resize"===i||"w-resize"===i?"ne-resize":ga[t]:"n-resize"}function lr(t){return rs[t.toString()]}function cr(t){return os[t.toString()]}function pr(t){return ns[t.toString()]}function gr(t){return as[t.toString()]}function ur(t){return ss[t.toString()]}function fr(t){var e=t.offsetX-t.actualSize.width*t.pivot.x,i=t.offsetY-t.actualSize.height*t.pivot.y;return new xr(e,i,t.actualSize.width,t.actualSize.height)}function mr(t,e){for(var i=0;i<e.length;i++)if(e[i].id===t)return!0;return!1}var yr=function(){function t(t,e){this.width=t,this.height=e}return t.prototype.isEmpty=function(){return 0===this.height&&0===this.width},t.prototype.clone=function(){return new t(this.width,this.height)},t}(),vr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),br=function(t,e,i,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},wr=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return vr(i,t),i.equals=function(t,e){return t===e||!(!t||!e)&&(!t||!e||t.x===e.x&&t.y===e.y)},i.isEmptyPoint=function(t){return!t.x||!t.y},i.transform=function(t,e,i){var r={x:0,y:0};return r.x=Math.round(100*(t.x+i*Math.cos(e*Math.PI/180)))/100,r.y=Math.round(100*(t.y+i*Math.sin(e*Math.PI/180)))/100,r},i.findLength=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},i.findAngle=function(t,e){var i=Math.atan2(e.y-t.y,e.x-t.x);return i=180*i/Math.PI,(i%=360)<0&&(i+=360),i},i.distancePoints=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},i.getLengthFromListOfPoints=function(t){for(var e=0,i=0;i<t.length-1;i++)e+=this.distancePoints(t[i],t[i+1]);return e},i.adjustPoint=function(t,e,i,r){var o,n=i?{x:t.x,y:t.y}:{x:e.x,y:e.y};return t.x===e.x?t.y<e.y&&i||t.y>e.y&&!i?n.y+=r:n.y-=r:t.y===e.y?t.x<e.x&&i||t.x>e.x&&!i?n.x+=r:n.x-=r:i?(o=this.findAngle(t,e),n=this.transform(t,o,r)):(o=this.findAngle(e,t),n=this.transform(e,o,r)),n},i.direction=function(t,e){return Math.abs(e.x-t.x)>Math.abs(e.y-t.y)?t.x<e.x?"Right":"Left":t.y<e.y?"Bottom":"Top"},br([e.Property(0)],i.prototype,"x",void 0),br([e.Property(0)],i.prototype,"y",void 0),i}(e.ChildProperty),xr=function(){function t(t,e,i,r){this.x=Number.MAX_VALUE,this.y=Number.MAX_VALUE,this.width=0,this.height=0,void 0===t||void 0===e?(t=e=Number.MAX_VALUE,i=r=0):(void 0===i&&(i=0),void 0===r&&(r=0)),this.x=t,this.y=e,this.width=i,this.height=r}return Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeft",{get:function(){return{x:this.left,y:this.top}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topRight",{get:function(){return{x:this.right,y:this.top}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeft",{get:function(){return{x:this.left,y:this.bottom}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomRight",{get:function(){return{x:this.right,y:this.bottom}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"middleLeft",{get:function(){return{x:this.left,y:this.y+this.height/2}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"middleRight",{get:function(){return{x:this.right,y:this.y+this.height/2}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topCenter",{get:function(){return{x:this.x+this.width/2,y:this.top}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomCenter",{get:function(){return{x:this.x+this.width/2,y:this.bottom}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"center",{get:function(){return{x:this.x+this.width/2,y:this.y+this.height/2}},enumerable:!0,configurable:!0}),t.prototype.equals=function(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},t.prototype.uniteRect=function(t){var e=Math.max(Number.NaN===this.right||this.x===Number.MAX_VALUE?t.right:this.right,t.right),i=Math.max(Number.NaN===this.bottom||this.y===Number.MAX_VALUE?t.bottom:this.bottom,t.bottom);return this.x=Math.min(this.left,t.left),this.y=Math.min(this.top,t.top),this.width=e-this.x,this.height=i-this.y,this},t.prototype.unitePoint=function(t){if(this.x===Number.MAX_VALUE)return this.x=t.x,void(this.y=t.y);var e=Math.min(this.left,t.x),i=Math.min(this.top,t.y),r=Math.max(this.right,t.x),o=Math.max(this.bottom,t.y);this.x=e,this.y=i,this.width=r-this.x,this.height=o-this.y},t.prototype.Inflate=function(t){return this.x-=t,this.y-=t,this.width+=2*t,this.height+=2*t,this},t.prototype.intersects=function(t){return!(this.right<t.left||this.left>t.right||this.top>t.bottom||this.bottom<t.top)},t.prototype.containsRect=function(t){return this.left<=t.left&&this.right>=t.right&&this.top<=t.top&&this.bottom>=t.bottom},t.prototype.containsPoint=function(t,e){return void 0===e&&(e=0),this.left-e<=t.x&&this.right+e>=t.x&&this.top-e<=t.y&&this.bottom+e>=t.y},t.toBounds=function(e){for(var i=new t,r=0,o=e;r<o.length;r++){var n=o[r];i.unitePoint(n)}return i},t.empty=new t(Number.MAX_VALUE,Number.MIN_VALUE,0,0),t}();!function(t){t[t.Identity=0]="Identity",t[t.Translation=1]="Translation",t[t.Scaling=2]="Scaling",t[t.Unknown=4]="Unknown"}(t.MatrixTypes||(t.MatrixTypes={}));var Sr=function(){return function(t,e,i,r,o,n,a){this.m11=t,this.m12=e,this.m21=i,this.m22=r,this.offsetX=o,this.offsetY=n,this.type=a}}();!function(t){t[t.Visible=1]="Visible",t[t.Hidden=2]="Hidden",t[t.Hover=4]="Hover",t[t.Connect=8]="Connect"}(t.PortVisibility||(t.PortVisibility={})),function(t){t[t.None=0]="None",t[t.ShowHorizontalLines=1]="ShowHorizontalLines",t[t.ShowVerticalLines=2]="ShowVerticalLines",t[t.ShowLines=3]="ShowLines",t[t.SnapToHorizontalLines=4]="SnapToHorizontalLines",t[t.SnapToVerticalLines=8]="SnapToVerticalLines",t[t.SnapToLines=12]="SnapToLines",t[t.SnapToObject=16]="SnapToObject",t[t.All=31]="All"}(t.SnapConstraints||(t.SnapConstraints={})),function(t){t[t.None=1]="None",t[t.ConnectorSourceThumb=2]="ConnectorSourceThumb",t[t.ConnectorTargetThumb=4]="ConnectorTargetThumb",t[t.ResizeSouthEast=8]="ResizeSouthEast",t[t.ResizeSouthWest=16]="ResizeSouthWest",t[t.ResizeNorthEast=32]="ResizeNorthEast",t[t.ResizeNorthWest=64]="ResizeNorthWest",t[t.ResizeEast=128]="ResizeEast",t[t.ResizeWest=256]="ResizeWest",t[t.ResizeSouth=512]="ResizeSouth",t[t.ResizeNorth=1024]="ResizeNorth",t[t.Rotate=2048]="Rotate",t[t.UserHandle=4096]="UserHandle",t[t.ToolTip=8192]="ToolTip",t[t.ResizeAll=2046]="ResizeAll",t[t.All=16382]="All"}(t.SelectorConstraints||(t.SelectorConstraints={})),function(t){t[t.None=1]="None",t[t.Select=2]="Select",t[t.Delete=4]="Delete",t[t.Drag=8]="Drag",t[t.DragSourceEnd=16]="DragSourceEnd",t[t.DragTargetEnd=32]="DragTargetEnd",t[t.DragSegmentThumb=64]="DragSegmentThumb",t[t.AllowDrop=128]="AllowDrop",t[t.Bridging=256]="Bridging",t[t.BridgeObstacle=512]="BridgeObstacle",t[t.InheritBridging=1024]="InheritBridging",t[t.PointerEvents=2048]="PointerEvents",t[t.Tooltip=4096]="Tooltip",t[t.InheritTooltip=8192]="InheritTooltip",t[t.Interaction=4218]="Interaction",t[t.ReadOnly=16384]="ReadOnly",t[t.Default=11838]="Default"}(t.ConnectorConstraints||(t.ConnectorConstraints={})),function(t){t[t.ReadOnly=2]="ReadOnly",t[t.InheritReadOnly=4]="InheritReadOnly",t[t.Select=8]="Select",t[t.Drag=16]="Drag",t[t.Resize=32]="Resize",t[t.Rotate=64]="Rotate",t[t.Interaction=120]="Interaction",t[t.None=0]="None"}(t.AnnotationConstraints||(t.AnnotationConstraints={})),function(t){t[t.None=0]="None",t[t.Select=2]="Select",t[t.Drag=4]="Drag",t[t.Rotate=8]="Rotate",t[t.Shadow=16]="Shadow",t[t.PointerEvents=32]="PointerEvents",t[t.Delete=64]="Delete",t[t.InConnect=128]="InConnect",t[t.OutConnect=256]="OutConnect",t[t.Individual=512]="Individual",t[t.Expandable=1024]="Expandable",t[t.AllowDrop=2048]="AllowDrop",t[t.Inherit=78]="Inherit",t[t.ResizeNorthEast=4096]="ResizeNorthEast",t[t.ResizeEast=8192]="ResizeEast",t[t.ResizeSouthEast=16384]="ResizeSouthEast",t[t.ResizeSouth=32768]="ResizeSouth",t[t.ResizeSouthWest=65536]="ResizeSouthWest",t[t.ResizeWest=131072]="ResizeWest",t[t.ResizeNorthWest=262144]="ResizeNorthWest",t[t.ResizeNorth=524288]="ResizeNorth",t[t.Resize=1044480]="Resize",t[t.AspectRatio=1048576]="AspectRatio",t[t.HideThumbs=16777216]="HideThumbs",t[t.Tooltip=2097152]="Tooltip",t[t.InheritTooltip=4194304]="InheritTooltip",t[t.ReadOnly=8388608]="ReadOnly",t[t.Default=5240814]="Default"}(t.NodeConstraints||(t.NodeConstraints={})),function(t){t[t.Rotate=2]="Rotate",t[t.ConnectorSource=4]="ConnectorSource",t[t.ConnectorTarget=8]="ConnectorTarget",t[t.ResizeNorthEast=16]="ResizeNorthEast",t[t.ResizeEast=32]="ResizeEast",t[t.ResizeSouthEast=64]="ResizeSouthEast",t[t.ResizeSouth=128]="ResizeSouth",t[t.ResizeSouthWest=256]="ResizeSouthWest",t[t.ResizeWest=512]="ResizeWest",t[t.ResizeNorthWest=1024]="ResizeNorthWest",t[t.ResizeNorth=2048]="ResizeNorth",t[t.Default=4094]="Default"}(t.ThumbsConstraints||(t.ThumbsConstraints={})),function(t){t[t.None=1]="None",t[t.Bridging=2]="Bridging",t[t.UndoRedo=4]="UndoRedo",t[t.Tooltip=8]="Tooltip",t[t.UserInteraction=16]="UserInteraction",t[t.ApiUpdate=32]="ApiUpdate",t[t.PageEditable=48]="PageEditable",t[t.Zoom=64]="Zoom",t[t.PanX=128]="PanX",t[t.PanY=256]="PanY",t[t.Pan=384]="Pan",t[t.ZoomTextEdit=512]="ZoomTextEdit",t[t.Virtualization=1024]="Virtualization",t[t.Default=500]="Default"}(t.DiagramConstraints||(t.DiagramConstraints={})),function(t){t[t.None=0]="None",t[t.SingleSelect=1]="SingleSelect",t[t.MultipleSelect=2]="MultipleSelect",t[t.ZoomPan=4]="ZoomPan",t[t.DrawOnce=8]="DrawOnce",t[t.ContinuousDraw=16]="ContinuousDraw",t[t.Default=3]="Default"}(t.DiagramTools||(t.DiagramTools={})),function(t){t[t.Self=1]="Self",t[t.Parent=2]="Parent"}(t.Transform||(t.Transform={})),function(t){t[t.Canvas=0]="Canvas",t[t.Svg=1]="Svg"}(t.RenderMode||(t.RenderMode={})),function(t){t[t.None=0]="None",t[t.Control=1]="Control",t[t.Meta=1]="Meta",t[t.Alt=2]="Alt",t[t.Shift=4]="Shift"}(t.KeyModifiers||(t.KeyModifiers={})),function(t){t[t.None=null]="None",t[t.Number0=0]="Number0",t[t.Number1=1]="Number1",t[t.Number2=2]="Number2",t[t.Number3=3]="Number3",t[t.Number4=4]="Number4",t[t.Number5=5]="Number5",t[t.Number6=6]="Number6",t[t.Number7=7]="Number7",t[t.Number8=8]="Number8",t[t.Number9=9]="Number9",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.Left=37]="Left",t[t.Up=38]="Up",t[t.Right=39]="Right",t[t.Down=40]="Down",t[t.Escape=27]="Escape",t[t.Space=32]="Space",t[t.PageUp=33]="PageUp",t[t.PageDown=34]="PageDown",t[t.End=35]="End",t[t.Home=36]="Home",t[t.Delete=46]="Delete",t[t.Tab=9]="Tab",t[t.Enter=13]="Enter",t[t.BackSpace=8]="BackSpace",t[t.F1=112]="F1",t[t.F2=113]="F2",t[t.F3=114]="F3",t[t.F4=115]="F4",t[t.F5=116]="F5",t[t.F6=117]="F6",t[t.F7=118]="F7",t[t.F8=119]="F8",t[t.F9=120]="F9",t[t.F10=121]="F10",t[t.F11=122]="F11",t[t.F12=123]="F12",t[t.Star=56]="Star",t[t.Plus=187]="Plus",t[t.Minus=189]="Minus"}(t.Keys||(t.Keys={})),function(t){t[t.Render=2]="Render",t[t.PublicMethod=4]="PublicMethod",t[t.ToolAction=8]="ToolAction",t[t.UndoRedo=16]="UndoRedo",t[t.TextEdit=32]="TextEdit",t[t.Group=64]="Group",t[t.Clear=128]="Clear"}(t.DiagramAction||(t.DiagramAction={})),function(t){t[t.None=0]="None",t[t.PreventDrag=2]="PreventDrag",t[t.PreventScale=4]="PreventScale",t[t.PreventDataInit=8]="PreventDataInit",t[t.hScrollbarMoved=16]="hScrollbarMoved",t[t.vScrollbarMoved=32]="vScrollbarMoved"}(t.RealAction||(t.RealAction={})),function(t){t[t.Zero=0]="Zero",t[t.One=1]="One",t[t.Two=2]="Two",t[t.Three=3]="Three",t[t.Four=4]="Four",t[t.Five=5]="Five"}(t.NoOfSegments||(t.NoOfSegments={})),function(t){t[t.collectionChange=0]="collectionChange",t[t.rotateChange=1]="rotateChange",t[t.positionChange=2]="positionChange",t[t.propertyChange=3]="propertyChange",t[t.selectionChange=4]="selectionChange",t[t.sizeChange=5]="sizeChange",t[t.drop=6]="drop",t[t.sourcePointChange=7]="sourcePointChange",t[t.targetPointChange=8]="targetPointChange",t[t.connectionChange=9]="connectionChange",t[t.animationComplete=10]="animationComplete",t[t.click=11]="click",t[t.doubleClick=12]="doubleClick",t[t.scrollChange=13]="scrollChange",t[t.dragEnter=14]="dragEnter",t[t.dragLeave=15]="dragLeave",t[t.dragOver=16]="dragOver",t[t.textEdit=17]="textEdit",t[t.paletteSelectionChange=18]="paletteSelectionChange",t[t.historyChange=19]="historyChange",t[t.mouseEnter=20]="mouseEnter",t[t.mouseLeave=21]="mouseLeave",t[t.mouseOver=22]="mouseOver"}(t.DiagramEvent||(t.DiagramEvent={})),function(t){t[t.None=1]="None",t[t.Drag=2]="Drag",t[t.Draw=4]="Draw",t[t.InConnect=8]="InConnect",t[t.OutConnect=16]="OutConnect"}(t.PortConstraints||(t.PortConstraints={}));var Pr="contextMenuClick",Cr="contextMenuOpen",Tr="contextMenuBeforeItemRender",Ar=function(){function e(){this.pivot={x:.5,y:.5},this.isDirt=!0,this.visible=!0,this.offsetX=0,this.offsetY=0,this.cornerRadius=0,this.minHeight=void 0,this.minWidth=void 0,this.maxWidth=void 0,this.maxHeight=void 0,this.width=void 0,this.height=void 0,this.rotateAngle=0,this.margin={left:0,right:0,top:0,bottom:0},this.horizontalAlignment="Auto",this.verticalAlignment="Auto",this.relativeMode="Point",this.transform=t.Transform.Self|t.Transform.Parent,this.style={fill:"white",strokeColor:"black",opacity:1,strokeWidth:1},this.desiredSize=new yr,this.actualSize=new yr,this.parentTransform=0,this.preventContainer=!1,this.isSvgRender=!1,this.bounds=new xr(0,0,0,0),this.shadow=null,this.description="",this.staticSize=!1,this.isRectElement=!1,this.isCalculateDesiredSize=!0,this.position=void 0,this.unitMode=void 0,this.float=!1,this.floatingBounds=void 0}return e.prototype.setOffsetWithRespectToBounds=function(t,e,i){this.unitMode=i,this.position={x:t,y:e}},e.prototype.getAbsolutePosition=function(t){if(void 0!==this.position)return"Absolute"===this.unitMode?this.position:{x:this.position.x*t.width,y:this.position.y*t.height}},Object.defineProperty(e.prototype,"outerBounds",{get:function(){return this.floatingBounds||this.bounds},set:function(t){this.floatingBounds=t},enumerable:!0,configurable:!0}),e.prototype.measure=function(t){var e=void 0!==this.width?this.width:(t.width||0)-this.margin.left-this.margin.right,i=void 0!==this.height?this.height:(t.height||0)-this.margin.top-this.margin.bottom;return this.desiredSize=new yr(e,i),this.isCalculateDesiredSize&&(this.desiredSize=this.validateDesiredSize(this.desiredSize,t)),this.desiredSize},e.prototype.arrange=function(t){return this.actualSize=t,this.updateBounds(),this.actualSize},e.prototype.updateBounds=function(){this.bounds=_i(this)},e.prototype.validateDesiredSize=function(t,e){return!this.isRectElement||this.width||this.minWidth||this.maxWidth||(t.width=50),!this.isRectElement||this.height||this.minHeight||this.maxHeight||(t.height=50),(void 0===t||void 0!==this.width&&void 0!==this.height)&&((t=t||new yr).width=void 0===this.width?(e.width||0)-this.margin.left-this.margin.right:this.width,t.height=void 0===this.height?(e.height||0)-this.margin.top-this.margin.bottom:this.height),void 0!==this.minWidth&&(t.width=Math.max(t.width,this.minWidth)),void 0!==this.minHeight&&(t.height=Math.max(t.height,this.minHeight)),void 0!==this.maxWidth&&(t.width=Math.min(t.width,this.maxWidth)),void 0!==this.maxHeight&&(t.height=Math.min(t.height,this.maxHeight)),t},e}(),Mr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Lr=function(t,e,i,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},Or=function(t){switch(t.type){case"Linear":return Rr;case"Radial":return Nr;default:return Rr}},Ir=function(){return function(t,e,i,r){this.left=t,this.right=e,this.top=i,this.bottom=r}}(),Er=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Mr(i,t),Lr([e.Property(0)],i.prototype,"left",void 0),Lr([e.Property(0)],i.prototype,"right",void 0),Lr([e.Property(0)],i.prototype,"top",void 0),Lr([e.Property(0)],i.prototype,"bottom",void 0),i}(e.ChildProperty),zr=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Mr(i,t),Lr([e.Property(45)],i.prototype,"angle",void 0),Lr([e.Property(5)],i.prototype,"distance",void 0),Lr([e.Property(.7)],i.prototype,"opacity",void 0),Lr([e.Property("lightgrey")],i.prototype,"color",void 0),i}(e.ChildProperty),Dr=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Mr(i,t),Lr([e.Property("")],i.prototype,"color",void 0),Lr([e.Property(0)],i.prototype,"offset",void 0),Lr([e.Property(1)],i.prototype,"opacity",void 0),i}(e.ChildProperty),kr=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Mr(i,t),Lr([e.Collection([],Dr)],i.prototype,"stops",void 0),Lr([e.Property("None")],i.prototype,"type",void 0),Lr([e.Property("")],i.prototype,"id",void 0),i}(e.ChildProperty),Rr=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Mr(i,t),Lr([e.Property(0)],i.prototype,"x1",void 0),Lr([e.Property(0)],i.prototype,"x2",void 0),Lr([e.Property(0)],i.prototype,"y1",void 0),Lr([e.Property(0)],i.prototype,"y2",void 0),i}(kr),Nr=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Mr(i,t),Lr([e.Property(0)],i.prototype,"cx",void 0),Lr([e.Property(0)],i.prototype,"cy",void 0),Lr([e.Property(0)],i.prototype,"fx",void 0),Lr([e.Property(0)],i.prototype,"fy",void 0),Lr([e.Property(50)],i.prototype,"r",void 0),i}(kr),Br=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Mr(i,t),Lr([e.Property("transparent")],i.prototype,"fill",void 0),Lr([e.Property("black")],i.prototype,"strokeColor",void 0),Lr([e.Property("")],i.prototype,"strokeDashArray",void 0),Lr([e.Property(1)],i.prototype,"strokeWidth",void 0),Lr([e.Property(1)],i.prototype,"opacity",void 0),Lr([e.ComplexFactory(Or)],i.prototype,"gradient",void 0),i}(e.ChildProperty),jr=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Mr(i,t),Lr([e.Property("transparent")],i.prototype,"fill",void 0),i}(Br),Hr=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Mr(i,t),Lr([e.Property("black")],i.prototype,"color",void 0),Lr([e.Property("Arial")],i.prototype,"fontFamily",void 0),Lr([e.Property(12)],i.prototype,"fontSize",void 0),Lr([e.Property(!1)],i.prototype,"italic",void 0),Lr([e.Property(!1)],i.prototype,"bold",void 0),Lr([e.Property("CollapseSpace")],i.prototype,"whiteSpace",void 0),Lr([e.Property("WrapWithOverflow")],i.prototype,"textWrapping",void 0),Lr([e.Property("Center")],i.prototype,"textAlign",void 0),Lr([e.Property("None")],i.prototype,"textDecoration",void 0),Lr([e.Property("Wrap")],i.prototype,"textOverflow",void 0),i}(Br),Wr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),_r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.padding=new Ir(0,0,0,0),e.desiredBounds=void 0,e.measureChildren=!0,e.prevRotateAngle=0,e}return Wr(e,t),e.prototype.hasChildren=function(){return void 0!==this.children&&this.children.length>0},e.prototype.measure=function(t){this.desiredBounds=void 0;var i,r,o=void 0;if(this.hasChildren()){for(var n=0;n<this.children.length;n++){"Stretch"!==(i=this.children[n]).horizontalAlignment||t.width||(t.width=i.bounds.width),"Stretch"!==i.verticalAlignment||t.height||(t.height=i.bounds.height);var a="Stretch"===i.horizontalAlignment||"Stretch"===i.verticalAlignment;(this.measureChildren||a||i instanceof e&&void 0!==i.measureChildren)&&i.measure(t),r=this.GetChildrenBounds(i),"Stretch"!==i.horizontalAlignment&&"Stretch"!==i.verticalAlignment?void 0===this.desiredBounds?this.desiredBounds=r:this.desiredBounds.uniteRect(r):!this.actualSize||this.actualSize.width||this.actualSize.height||i.preventContainer||"Stretch"!==i.horizontalAlignment||"Stretch"!==i.verticalAlignment||(void 0===this.desiredBounds?this.desiredBounds=i.bounds:this.desiredBounds.uniteRect(i.bounds))}if(void 0!==this.desiredBounds&&0!==this.rotateAngle){var s={x:this.desiredBounds.x+this.desiredBounds.width*this.pivot.x,y:this.desiredBounds.y+this.desiredBounds.height*this.pivot.y},h=tr(this.rotateAngle,void 0,void 0,s);this.desiredBounds.x=h.x-this.desiredBounds.width*this.pivot.x,this.desiredBounds.y=h.y-this.desiredBounds.height*this.pivot.y}this.desiredBounds&&(o=new yr(this.desiredBounds.width,this.desiredBounds.height))}return o=this.validateDesiredSize(o,t),this.stretchChildren(o),this.desiredSize=o,o},e.prototype.arrange=function(t){var i,r=this.desiredBounds;if(r){this.offsetX,this.offsetY;if(this.offsetX=r.x+r.width*this.pivot.x,this.offsetY=r.y+r.height*this.pivot.y,this.hasChildren())for(var o=0;o<this.children.length;o++){var n=!1;"Stretch"===(i=this.children[o]).horizontalAlignment&&(i.offsetX=this.offsetX,i.parentTransform=this.parentTransform+this.rotateAngle,n=!0),"Stretch"===i.verticalAlignment&&(i.offsetY=this.offsetY,i.parentTransform=this.parentTransform+this.rotateAngle,n=!0),(n||this.measureChildren||i instanceof e&&void 0!==i.measureChildren)&&i.arrange(i.desiredSize)}}return this.actualSize=t,this.updateBounds(),this.prevRotateAngle=this.rotateAngle,t},e.prototype.stretchChildren=function(t){if(this.hasChildren())for(var i=0,r=this.children;i<r.length;i++){var o=r[i];"Stretch"!==o.horizontalAlignment&&void 0!==o.desiredSize.width||(o.desiredSize.width=t.width-o.margin.left-o.margin.right),"Stretch"!==o.verticalAlignment&&void 0!==o.desiredSize.height||(o.desiredSize.height=t.height-o.margin.top-o.margin.bottom),o instanceof e&&o.stretchChildren(o.desiredSize)}},e.prototype.applyPadding=function(t){t.width+=this.padding.left+this.padding.right,t.height+=this.padding.top+this.padding.bottom},e.prototype.findChildOffsetFromCenter=function(t,e){var i=er({x:e.x-t.desiredSize.width/2,y:e.y-t.desiredSize.height/2},t);i=tr(t.rotateAngle,e.x,e.y,i),i=tr(this.rotateAngle+this.parentTransform,this.offsetX,this.offsetY,i),t.offsetX=i.x,t.offsetY=i.y},e.prototype.GetChildrenBounds=function(t){var e;e=t.desiredSize.clone();t.rotateAngle,this.rotateAngle;var i=t.offsetX,r=t.offsetY,o=i-e.width*t.pivot.x,n=r-e.height*t.pivot.y,a=o+e.width,s=n+e.height,h={x:o,y:n},d={x:a,y:n},l={x:o,y:s},c={x:a,y:s};return h=tr(t.rotateAngle,t.offsetX,t.offsetY,h),d=tr(t.rotateAngle,t.offsetX,t.offsetY,d),l=tr(t.rotateAngle,t.offsetX,t.offsetY,l),c=tr(t.rotateAngle,t.offsetX,t.offsetY,c),0!==this.rotateAngle&&(h=tr(-this.rotateAngle,void 0,void 0,h),d=tr(-this.rotateAngle,void 0,void 0,d),l=tr(-this.rotateAngle,void 0,void 0,l),c=tr(-this.rotateAngle,void 0,void 0,c)),xr.toBounds([h,d,l,c])},e}(Ar),Xr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Yr=function(t){function e(){var e=t.call(this)||this;return e.pathData="",e.transformPath=!0,e.absolutePath="",e.canMeasurePath=!1,e.absoluteBounds=new xr,e}return Xr(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this.pathData},set:function(t){this.pathData!==t&&(this.pathData=t,this.isDirt=!0)},enumerable:!0,configurable:!0}),e.prototype.getPoints=function(){var t=this;return this.pointTimer||(this.pointTimer=setTimeout(function(){t.points=null,t.pointTimer=null},200)),this.points=this.points||gi(this),function(t,e){for(var i=[],r=0,o=e;r<o.length;r++){var n=o[r],a={x:t.offsetX-t.actualSize.width*t.pivot.x+n.x,y:t.offsetY-t.actualSize.height*t.pivot.y+n.y},s=void 0,h=t.rotateAngle+t.parentTransform;h&&b(s=m(),h,t.offsetX,t.offsetY),s&&(a=y(s,a)),i.push(a)}return i}(this,this.points)},e.prototype.measure=function(t){return this.staticSize&&void 0!==this.width&&void 0!==this.height?this.absoluteBounds=new xr(this.offsetX-this.width*this.pivot.x,this.offsetY-this.height*this.pivot.y,this.width,this.height):(!this.isDirt||!this.transformPath&&void 0!==this.width&&void 0!==this.height||this.absoluteBounds&&0!==this.absoluteBounds.height)&&!this.canMeasurePath||(this.absoluteBounds=fi(this.data?this.data:"")),void 0===this.width?this.desiredSize=new yr(this.absoluteBounds.width,this.height||this.absoluteBounds.height):void 0===this.height?this.desiredSize=new yr(this.width||this.absoluteBounds.width,this.absoluteBounds.height):this.desiredSize=new yr(this.width,this.height),this.desiredSize=this.validateDesiredSize(this.desiredSize,t),this.canMeasurePath=!1,this.desiredSize},e.prototype.arrange=function(t){return(this.isDirt||this.actualSize.width!==t.width||this.actualSize.height!==t.height)&&(this.isDirt=!0,this.absolutePath=this.updatePath(this.data,this.absoluteBounds,t),this.staticSize||(this.points=null)),this.actualSize=this.desiredSize,this.updateBounds(),this.isDirt=!1,this.actualSize},e.prototype.updatePath=function(t,e,i){var r=!1,o="",a=-e.x,s=-e.y,h=[];return i.width===e.width&&i.height===e.height||(a=i.width/Number(e.width?e.width:1),s=i.height/Number(e.height?e.height:1),r=!0),h=n(t),h=g(h),o=(r||this.isDirt)&&this.transformPath?l(h,a,s,r,e.x,e.y,0,0):u(h),r=!1,o},e}(Ar),Vr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Ur=function(t){function e(e,i){var r=t.call(this)||this;return r.data="",r.nodeId="",r.diagramId="",r.scale="Stretch",r.diagramId=i,r.nodeId=e,r}return Vr(e,t),Object.defineProperty(e.prototype,"content",{get:function(){return this.data},set:function(t){this.data=t,this.template=Ri(this,!1),this.isDirt=!0},enumerable:!0,configurable:!0}),e.prototype.measure=function(t){if(this.isDirt){var e=function(t){var e="measureElement";window[e].style.visibility="visible";var i=window[e].children[2];i.appendChild(t);var r=t.getBoundingClientRect(),o=i.getBoundingClientRect(),n=r;return n.x=r.left-o.left,n.y=r.top-o.top,i.removeChild(t),window[e].style.visibility="hidden",n}(this.template);this.contentSize=new yr,this.contentSize.width=e.width,this.contentSize.height=e.height;var i=e.x,r=e.y;this.templatePosition={x:i,y:r},this.isDirt=!1}if(void 0===this.width||void 0===this.height){var o=function(t){var e="measureElement";window[e].style.visibility="visible";var i=window[e].children[2];i.appendChild(t);var r=i.getBoundingClientRect();return i.removeChild(t),window[e].style.visibility="hidden",r}(this.template);this.desiredSize=new yr(o.width,o.height)}else this.desiredSize=new yr(this.width,this.height);return this.desiredSize=this.validateDesiredSize(this.desiredSize,t),this.desiredSize},e.prototype.arrange=function(t){return this.actualSize=new yr(this.desiredSize.width,this.desiredSize.height),this.updateBounds(),this.actualSize},e}(Ar),Fr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Gr=function(t){function e(){var e=t.call(this)||this;return e.textContent="",e.canMeasure=!0,e.hyperlink={color:"blue"},e.doWrap=!0,e.textNodes=[],e.style={color:"black",fill:"transparent",strokeColor:"black",strokeWidth:1,fontFamily:"Arial",fontSize:12,whiteSpace:"CollapseSpace",textWrapping:"WrapWithOverflow",textAlign:"Center",italic:!1,bold:!1,textDecoration:"None",strokeDashArray:"",opacity:5,gradient:null,textOverflow:"Wrap"},e.style.fill="transparent",e.style.strokeColor="transparent",e}return Fr(e,t),Object.defineProperty(e.prototype,"content",{get:function(){return this.textContent},set:function(t){this.textContent!==t&&(this.textContent=t,this.isDirt=!0,this.doWrap=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"childNodes",{get:function(){return this.textNodes},set:function(t){this.textNodes=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wrapBounds",{get:function(){return this.textWrapBounds},set:function(t){this.textWrapBounds=t},enumerable:!0,configurable:!0}),e.prototype.refreshTextElement=function(){this.isDirt=!0},e.prototype.measure=function(t){var e;return e=this.isDirt&&this.canMeasure?vi(this,this.style,this.content,this.width):this.desiredSize,void 0===this.width||void 0===this.height?this.desiredSize=new yr(e.width,e.height):this.desiredSize=new yr(this.width,this.height),this.desiredSize=this.validateDesiredSize(this.desiredSize,t),this.desiredSize},e.prototype.arrange=function(t){return(t.width!==this.actualSize.width||t.height!==this.actualSize.height||this.isDirt)&&(this.doWrap=!0),this.actualSize=t,this.updateBounds(),this.isDirt=!1,this.actualSize},e}(Ar),Zr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),qr=function(t){function e(){var e=t.call(this)||this;return e.imageSource="",e.imageScale="None",e.imageAlign="None",e.stretch="Stretch",e}return Zr(e,t),Object.defineProperty(e.prototype,"source",{get:function(){return this.imageSource},set:function(t){this.imageSource=t,this.isDirt=!0},enumerable:!0,configurable:!0}),e.prototype.measure=function(t){return this.isDirt&&("Stretch"!==this.stretch||void 0===this.width&&void 0===this.height)&&(this.contentSize=function(t,e){var i="measureElement";window[i].style.visibility="visible";var r=window[i].children[1];r.setAttribute("src",t);var o=r.getBoundingClientRect(),n=o.width,a=o.height;return e=new yr(n,a),window[i].style.visibility="hidden",e}(this.source,this.contentSize),this.isDirt=!1),void 0!==this.width&&void 0!==this.height?(this.desiredSize=new yr(this.width,this.height),this.contentSize=this.desiredSize):this.desiredSize=this.contentSize,this.desiredSize=this.validateDesiredSize(this.desiredSize,t),this.desiredSize},e.prototype.arrange=function(t){return this.actualSize=new yr(this.desiredSize.width,this.desiredSize.height),this.updateBounds(),this.actualSize},e}(Ar),Kr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Qr=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.measureChildren=void 0,t}return Kr(i,e),i.prototype.measure=function(t){var i=void 0,r=void 0;if(this.hasChildren()){for(var o=0,n=this.children;o<n.length;o++){var a=n[o];if(a instanceof Gr){if(!a.canMeasure)break;a.measure(t)}else a instanceof Gr||a.measure(t);var s=a.desiredSize.clone();0!==a.rotateAngle&&(s=$i(s,a.rotateAngle));var h=s.width+a.margin.right,d=s.height+a.margin.bottom,l=new xr(a.margin.left,a.margin.top,h,d);if(a.float){if(void 0!==a.getAbsolutePosition(s))continue}void 0===r?r=l:r.uniteRect(l)}if(r){var c=0,p=0;c=Math.max(r.left,0),p=Math.max(r.top,0),i=new yr(r.width+c,r.height+p)}}return i=e.prototype.validateDesiredSize.call(this,i,t),e.prototype.stretchChildren.call(this,i),i.width+=this.padding.left+this.padding.right,i.height+=this.padding.top+this.padding.bottom,this.desiredSize=i,i},i.prototype.arrange=function(i,r){if(this.outerBounds=new xr,this.hasChildren()){var o=void 0,n=void 0;o=this.offsetY-i.height*this.pivot.y+this.padding.top,n=this.offsetX-i.width*this.pivot.x+this.padding.left;for(var a=0,s=this.children;a<s.length;a++){var h=s[a];if(0!=(h.transform&t.Transform.Parent)){h.parentTransform=this.parentTransform+this.rotateAngle;var d=h.desiredSize.clone(),l=void 0,c={x:0,y:0},p=n,g=o;if("Point"===h.relativeMode){var u=h.getAbsolutePosition(i);void 0!==u&&(p+=u.x,g+=u.y)}c={x:(l="Object"===h.relativeMode?this.alignChildBasedOnParent(h,d,i,p,g):this.alignChildBasedOnaPoint(h,p,g)).x+d.width/2,y:l.y+d.height/2},e.prototype.findChildOffsetFromCenter.call(this,h,c)}!r||"Stretch"!==h.horizontalAlignment&&"Stretch"!==h.verticalAlignment?h instanceof Gr&&h.canMeasure?(h.arrange(h.desiredSize),this.outerBounds.uniteRect(h.outerBounds)):h instanceof Gr||(h.arrange(h.desiredSize),this.outerBounds.uniteRect(h.outerBounds)):h.arrange(i)}}return this.actualSize=i,this.updateBounds(),this.outerBounds.uniteRect(this.bounds),i},i.prototype.alignChildBasedOnParent=function(t,e,i,r,o){switch(t.horizontalAlignment){case"Auto":case"Left":r+=t.margin.left;break;case"Right":r+=i.width-e.width-t.margin.right;break;case"Stretch":case"Center":r+=i.width/2-e.width/2}switch(t.verticalAlignment){case"Auto":case"Top":o+=t.margin.top;break;case"Bottom":o+=i.height-e.height-t.margin.bottom;break;case"Stretch":case"Center":o+=i.height/2-e.height/2}return{x:r,y:o}},i.prototype.alignChildBasedOnaPoint=function(t,e,i){switch(e+=t.margin.left-t.margin.right,i+=t.margin.top-t.margin.bottom,t.horizontalAlignment){case"Auto":case"Left":e=e;break;case"Stretch":case"Center":e-=t.desiredSize.width*t.pivot.x;break;case"Right":e-=t.desiredSize.width}switch(t.verticalAlignment){case"Auto":case"Top":i=i;break;case"Stretch":case"Center":i-=t.desiredSize.height*t.pivot.y;break;case"Bottom":i-=t.desiredSize.height}return{x:e,y:i}},i}(_r),Jr={Rectangle:"M0,0 L50,0 L50,50 L0,50 z",Ellipse:"M80.5,12.5 C80.5,19.127417 62.59139,24.5 40.5,24.5 C18.40861,24.5 0.5,19.127417 0.5,12.5C0.5,5.872583 18.40861,0.5 40.5,0.5 C62.59139,0.5 80.5,5.872583 80.5,12.5 z",Hexagon:"M30,0 L60,0 L90,30 L60,60 L30,60 L0,30 L30,0 z",Parallelogram:"M30,0 L60,0 L45,30 L15,30 z",Triangle:"M45,0 L90,45 L0,45 L45,0 z",Plus:"M696.6084,158.2656 L674.8074,158.2656 L674.8074,136.4656 L658.4084,136.4656 L658.4084,158.2656 L636.6084,158.2656L636.6084,174.6646 L658.4084,174.6646 L658.4084,196.4656 L674.8074,196.4656 L674.8074,174.6646 L696.6084,174.6646L696.6084,158.2656 z",Star:"M540.3643,137.9336 L546.7973,159.7016 L570.3633,159.7296 L550.7723,171.9366 L558.9053,194.9966 L540.3643,179.4996L521.8223,194.9966 L529.9553,171.9366 L510.3633,159.7296 L533.9313,159.7016 L540.3643,137.9336 z",Pentagon:"M30,0 L60,30 L50,70 L10,70 L0,30 L30,0 z",Heptagon:"M223.7783,195.7134 L207.1303,174.8364 L213.0713,148.8034 L237.1303,137.2174 L261.1883,148.8034 L267.1303,174.8364L250.4813,195.7134 L223.7783,195.7134 z",Octagon:"M98.7319,196.4653 L81.1579,178.8923 L81.1579,154.0393 L98.7319,136.4653 L123.5849,136.4653L141.1579,154.0393 L141.1579,178.8923 L123.5849,196.4653 L98.7319,196.4653 z",Trapezoid:"M127.2842,291.4492 L95.0322,291.4492 L81.1582,256.3152 L141.1582,256.3152 L127.2842,291.4492 z",Decagon:"M657.3379,302.4141 L642.3369,291.5161 L636.6089,273.8821 L642.3369,256.2481 L657.3379,245.3511 L675.8789,245.3511L690.8789,256.2481 L696.6089,273.8821L690.8789,291.5161 L675.8789,302.4141 L657.3379,302.4141 z",RightTriangle:"M836.293,292.9238 L776.293,292.9238 L776.293,254.8408 L836.293,292.9238 z",Cylinder:"M 542.802,362.009C 542.802,368.452 525.341,373.676 503.802,373.676C 482.263,373.676 464.802,368.452 464.802,362.009L 464.802,466.484C 464.802,472.928 482.263,478.151 503.802,478.151C 525.341,478.151 542.802,472.928 542.802,466.484L 542.802,362.016C 542.802,368.459 525.341,373.534 503.802,373.534C 482.263,373.534 464.802,368.31 464.802,361.867L 464.802,362.016C 464.802,355.572 482.263,350.349 503.802,350.349C 525.341,350.349 542.802,355.572 542.802,362.016",Diamond:"M397.784,287.875 L369.5,316.159 L341.216,287.875 L369.5,259.591 L397.784,287.875 z"},$r=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),to=function(t,e,i,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},eo=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return $r(r,i),to([e.Property("")],r.prototype,"id",void 0),to([e.Property("Center")],r.prototype,"horizontalAlignment",void 0),to([e.Property("Center")],r.prototype,"verticalAlignment",void 0),to([e.Complex({},Er)],r.prototype,"margin",void 0),to([e.Property(12)],r.prototype,"width",void 0),to([e.Property(12)],r.prototype,"height",void 0),to([e.Complex({},Br)],r.prototype,"style",void 0),to([e.Property("Square")],r.prototype,"shape",void 0),to([e.Property(t.PortVisibility.Connect)],r.prototype,"visibility",void 0),to([e.Property("")],r.prototype,"pathData",void 0),to([e.Property(t.PortConstraints.None)],r.prototype,"constraints",void 0),to([e.Property()],r.prototype,"addInfo",void 0),r}(e.ChildProperty),io=function(t){function i(e,i,r,o){return t.call(this,e,i,r,o)||this}return $r(i,t),to([e.Complex({x:.5,y:.5},wr)],i.prototype,"offset",void 0),i}(eo),ro=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),oo=function(t,e,i,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},no=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return ro(i,t),oo([e.Property("blue")],i.prototype,"color",void 0),oo([e.Property("")],i.prototype,"content",void 0),oo([e.Property("")],i.prototype,"link",void 0),oo([e.Property("None")],i.prototype,"textDecoration",void 0),i}(e.ChildProperty),ao=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return ro(r,i),oo([e.Property("")],r.prototype,"content",void 0),oo([e.Property(void 0)],r.prototype,"template",void 0),oo([e.Property(!0)],r.prototype,"visibility",void 0),oo([e.Property(t.AnnotationConstraints.InheritReadOnly)],r.prototype,"constraints",void 0),oo([e.Complex(void 0,no)],r.prototype,"hyperlink",void 0),oo([e.Property("")],r.prototype,"id",void 0),oo([e.Property()],r.prototype,"width",void 0),oo([e.Property()],r.prototype,"height",void 0),oo([e.Property(0)],r.prototype,"rotateAngle",void 0),oo([e.Complex({strokeWidth:0,strokeColor:"transparent",fill:"transparent"},Hr)],r.prototype,"style",void 0),oo([e.Property("Center")],r.prototype,"horizontalAlignment",void 0),oo([e.Property("Center")],r.prototype,"verticalAlignment",void 0),oo([e.Complex({},Er)],r.prototype,"margin",void 0),oo([e.Complex({top:void 0,bottom:void 0,left:void 0,right:void 0},Er)],r.prototype,"dragLimit",void 0),oo([e.Property("Shape")],r.prototype,"type",void 0),oo([e.Property()],r.prototype,"addInfo",void 0),r}(e.ChildProperty),so=function(t){function i(e,i,r,o){return t.call(this,e,i,r,o)||this}return ro(i,t),oo([e.Complex({x:.5,y:.5},wr)],i.prototype,"offset",void 0),i}(ao),ho=function(t){function i(e,i,r,o){return t.call(this,e,i,r,o)||this}return ro(i,t),oo([e.Property(.5)],i.prototype,"offset",void 0),oo([e.Complex({x:0,y:0},wr)],i.prototype,"displacement",void 0),oo([e.Property("Center")],i.prototype,"alignment",void 0),oo([e.Property(!1)],i.prototype,"segmentAngle",void 0),i}(ao),lo={X:"M14,14 L106,106 M106,14 L14,106",Circle:"M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50 Z",Square:"M0,0 L10,0 L10,10 L0,10 z"},co={OpenArrow:"M15.9,23 L5,16 L15.9,9 L17,10.7 L8.7,16 L17,21.3Z",Square:"M0,0 L10,0 L10,10 L0,10 z",Fletch:"M14.8,10c0,0-3.5,6,0.2,12c0,0-2.5-6-10.9-6C4.1,16,11.3,16,14.8,10z",OpenFetch:"M6,17c-0.6,0-1-0.4-1-1s0.4-1,1-1c10.9,0,11-5,11-5c0-0.6,0.4-1,1-1s1,0.4,1,1C19,10.3,18.9,17,6,17C6,17,6,17,6,17z M18,23c-0.5,0-1-0.4-1-1c0-0.2-0.3-5-11-5c-0.6,0-1-0.5-1-1s0.4-1,1-1c0,0,0,0,0,0c12.9,0,13,6.7,13,7    C19,22.6,18.6,23,18,23z",IndentedArrow:"M17,10c0,0-4.5,5.5,0,12L5,16L17,10z",OutdentedArrow:"M14.6,10c0,0,5.4,6,0,12L5,16L14.6,10z",DoubleArrow:"M19,10 L19,22 L13,16Z M12,10 L12,22 L6,16Z",Arrow:"M15,10 L15,22 L5,16Z",Diamond:"M12,23l-7-7l7-7l6.9,7L12,23z",Circle:"M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50 Z"},po={Process:"M419.511,76.687L359.511,76.687L359.511,43.086L419.511,43.086z",Decision:"M 253.005,115.687L 200.567,146.071L 148.097,115.687L 200.534,85.304L 253.005,115.687 Z",Document:"M 60 31.9 c 0 0 -11 -7.7 -30 0 s -30 0 -30 0 V 0 h 60 V 31.9 Z",PreDefinedProcess:"M 0,0 L 50,0 L 50,50 L 0,50 Z  M 8.334,0 L 8.334,50 M 41.667,0 L 41.667,50",Terminator:"M 269.711,29.33C 269.71,44.061 257.77,56 243.04,56L 158.058,56C 143.33,56 131.39,44.061 131.39,29.33L 131.39,29.33C 131.391,14.6057 143.33,2.669 158.058,2.669L 243.044,2.669C 257.772,2.669 269.711,14.6057 269.711,29.333 Z",PaperTap:"M0.0009,17.2042 L0.0009,47.165 C0.001,47.165 14.403,53.5455 25.00,47.165 C35.599,40.7852 44.403,43.5087 50.00,47.165L50.001,17.2042 M50.001,32.7987 L50.001,2.8405 C50.001,2.8405 35.599,-3.5427 25.001,2.8405C14.403,9.2237 5.599,6.494 0.0009,2.8405 L0.0009,32.7987",DirectData:"M 132.62 0 L 17.38 0 C 7.78 0 0 13.43 0 30 C 0 46.57 7.78 60 17.38 60 L 132.62 60 M 132.62 0C 123.02 0 115.24 13.43 115.24 30 C 115.24 46.57 123.02 60 132.62 60 C 142.22 60 150 46.57 150 30 C 150 13.43 142.22 0 132.62 0 z ",SequentialData:"M0.0029,24.999 C0.0029,11.1922 10.433,0.0021 23.295,0.0021 C36.159,0.00216 46.585,11.1922 46.585,24.999C46.585,38.8057 36.159,49.9979 23.295,49.9979 C10.433,49.9979 0.0029,38.8057 0.0029,24.999 z M23.294,49.999 L50.002,49.999",Sort:"M50.001,24.9971 L25.001,49.9971 L0.00097,24.9971 L25.001,-0.00286865 L50.001,24.9971 z M0.000976562,24.9971 L50.001,24.9971",MultiDocument:"M43.6826,40 C44.8746,40.6183 45.8586,41.3502 46.8366,42.1122 L46.8366,4.74487 L3.09857,4.74487 L3.09857,10.9544 M46.837,35.143 C48.027,35.765 49.025,36.604 50.003,37.369 L50.003,0.002 L6.264,0.002 L6.264,4.744 M43.682,47.113 L43.682,10.765 L0.0025,10.7652 L0.0025,47.1132 C0.0025,47.1132 12.5846,53.6101 21.8426,47.1132 C31.1006,40.6163 38.792,43.393 43.6826,47.1132 z",Collate:"M50.001,0.0028 L25.001,25.0029 L0.00097,0.0028 L50.001,0.002 z M0.0009,50.002 L25.001,25.002L50.001,50.002 L0.0009,50.0029 z",SummingJunction:"M7.3252,42.6768 L42.6772,7.3247 M42.6768,42.6768 L7.3248,7.3247 M0.0009,25.001 C0.0009,11.193 11.197,0.0009 25.001,0.0009 C38.809,0.0009 50.001,11.193 50.001,25.001 C50.001,38.809 38.809,50.001 25.001,50.001 C11.197,50.00 0.0009,38.809 0.0009,25.00 z",Or:"M 0 50 L 100 50 M 50 100 L 50 0.0 M 0 50 C 0 22.384 22.392 0 50 0 C 77.616 0 100 22.384 100 50 C 100 77.616 77.616 100 50 100 C 22.392 100 0 77.616 0 50 Z",InternalStorage:"M 0 3.81946A 2.5,3.81946 0 0,1 2.5,0L 47.5 0A 2.5,3.81946 0 0,1 50,3.81946L 50 45.836A 2.5,3.819446 0 0,1 47.5,49.652778L 2.5 49.652778A 2.5,3.819446 0 0,1 0,45.8336L 0 3.819446ZM 0 11.45834L 50 11.4583334M 12.5 0L 12.5 49.652778",Extract:"M0,35 L30,0 L60,35 Z",ManualOperation:"M46.4,28.8 L14.8,28.8 L0,0 L60,0 Z",Merge:"M60,0 L30,35 L0,0 Z",OffPageReference:"M60,33.3 L30.1,39 L0,33.3 L0,0 L60,0 Z",SequentialAccessStorage:"M 60 30 C 60 13.4 46.6 0 30 0 S 0 13.4 0 30 s 13.4 30 30 30 h 28.6 v -6.5 h -9.9C 55.5 48 60 39.5 60 30 Z",Annotation:"M49.9984,50.0029 L-0.00271199,50.0029 L-0.00271199,0.00286865 L49.9984,0.00286865",Annotation2:"M49.9977,50.0029 L25.416,50.0029 L25.416,0.00286865 L49.9977,0.00286865 M25.4166,25.0029 L-0.00227869,25.0029",Data:"M 10 0 L 40 0 L 30 40 L 0 40 Z",Card:"M275,60 L400,60 L400,110 L260,110 L260,75 Z",Delay:"M0,0 L12.029,0 C14.212999,0 16,1.7869979 16,3.9709952 C16,6.1549926 14.212999,7.9409904 12.029,7.9409904 L0,7.9409904 z",Preparation:"M 1048.17 572 C 1051.06 568.86 1055.17 567.05 1059.5 567 L 1094.51 567 C 1098.84 567.05 1102.95 568.86 1105.84 572 L 1126.43 595 C 1127.01 596.28 1127.01 597.72 1126.43 599 L 1105.84 622 C 1102.95 625.14 1098.84 626.95 1094.51 627 L 1059.5 627 C 1055.17 626.95 1051.06 625.14 1048.17 622 L 1027.58 599 C 1027 597.72 1027 596.28 1027.58 595 L 1048.17 572 Z",Display:"M47.8809,19.2914 L32.7968,-0.00594145 L11.3902,-0.00594145 C7.93166,-0.00594145 0.00124586,11.187 0.00124586,24.9968C0.00124586,38.8032 7.93166,49.9962 11.3902,49.9962 L32.7968,49.99 L47.615,31.038 C47.615,31.0388 52.798,24.9968 47.880,19.2914 z",ManualInput:"M 912 732 L 1006.85 707 C 1008.2 707 1009.5 707.53 1010.46 708.46 C 1011.41 709.4 1011.95 710.67 1011.95 712 L 1011.95 762C 1012 764.41 1010.28 766.52 1007.87 767 L 917.1 767 C 915.75 767 914.45 766.47 913.49 765.54 C 912.54 764.6 912 763.33 912 762 L 912 732 Z",LoopLimit:"M 8 9 L 27 9 L 33 15 L 33 26 C 33 27 33 27 32 27 L 4 27 C 3 27 2 27 2 26 L 2 15 L 8 9 Z",StoredData:"M 5.55 0L 50 0A 1.5,30 0 0,1 50,0A 5.555,25 0 0,0 50,50A 1.5,30 0 0,1 50,50L 5.555 50A 5.55,25 0 0,1 5.555,0Z"},go=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),uo=function(t,e,i,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},fo=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return go(i,t),uo([e.Property("None")],i.prototype,"shape",void 0),uo([e.Property("white")],i.prototype,"fill",void 0),uo([e.Property("Auto")],i.prototype,"horizontalAlignment",void 0),uo([e.Property("Auto")],i.prototype,"verticalAlignment",void 0),uo([e.Property(10)],i.prototype,"width",void 0),uo([e.Property(10)],i.prototype,"height",void 0),uo([e.Complex({x:.5,y:1},wr)],i.prototype,"offset",void 0),uo([e.Property("#1a1a1a")],i.prototype,"borderColor",void 0),uo([e.Property(1)],i.prototype,"borderWidth",void 0),uo([e.Complex({},Er)],i.prototype,"margin",void 0),uo([e.Property("")],i.prototype,"pathData",void 0),uo([e.Property("")],i.prototype,"content",void 0),uo([e.Property(0)],i.prototype,"cornerRadius",void 0),uo([e.Complex({left:2,right:2,top:2,bottom:2},Er)],i.prototype,"padding",void 0),i}(e.ChildProperty),mo=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),yo=function(t,e,i,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},vo=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return mo(i,t),yo([e.Property("")],i.prototype,"content",void 0),yo([e.Property("TopLeft")],i.prototype,"position",void 0),yo([e.Property("Mouse")],i.prototype,"relativeMode",void 0),yo([e.Property(!0)],i.prototype,"showTipPointer",void 0),yo([e.Property("auto")],i.prototype,"width",void 0),yo([e.Property("auto")],i.prototype,"height",void 0),yo([e.Property()],i.prototype,"animation",void 0),i}(e.ChildProperty),bo=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),wo=function(t,e,i,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},xo=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return bo(i,t),wo([e.Property("")],i.prototype,"id",void 0),wo([e.Property(-1)],i.prototype,"zIndex",void 0),wo([e.Complex({},Er)],i.prototype,"margin",void 0),wo([e.Property(!0)],i.prototype,"visible",void 0),wo([e.Collection([],io)],i.prototype,"ports",void 0),wo([e.Property(!0)],i.prototype,"isExpanded",void 0),wo([e.Complex({},vo)],i.prototype,"tooltip",void 0),wo([e.Complex({},fo)],i.prototype,"expandIcon",void 0),wo([e.Complex({},fo)],i.prototype,"collapseIcon",void 0),wo([e.Property(!1)],i.prototype,"excludeFromLayout",void 0),wo([e.Property()],i.prototype,"addInfo",void 0),i}(e.ChildProperty),So=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Po=function(t){function e(e,i,r){var o=t.call(this)||this;return o.data="",o.nodeId="",o.annotationId="",o.diagramId="",o.diagramId=i,o.nodeId=e,o.annotationId=r,o}return So(e,t),Object.defineProperty(e.prototype,"content",{get:function(){return this.data},set:function(t){this.data=t,this.template=Ri(this,!0),this.isDirt=!0},enumerable:!0,configurable:!0}),e}(Ar),Co=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),To=function(t,e,i,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},Ao=function(t){switch(t.type){case"Bpmn":return zo;case"UmlActivity":return Eo;case"UmlClassifier":return Ho;default:return Io}},Mo=function(t){switch(t.type){case"Straight":return ko;case"Bezier":return Ro;case"Orthogonal":return No;default:return ko}},Lo=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Co(i,t),To([e.Property(10)],i.prototype,"width",void 0),To([e.Property(10)],i.prototype,"height",void 0),To([e.Property("Arrow")],i.prototype,"shape",void 0),To([e.Complex({fill:"black",strokeColor:"black",strokeWidth:1},Br)],i.prototype,"style",void 0),To([e.Complex({x:0,y:.5},wr)],i.prototype,"pivot",void 0),To([e.Property("")],i.prototype,"pathData",void 0),i}(e.ChildProperty),Oo=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Co(i,t),To([e.Property(0)],i.prototype,"angle",void 0),To([e.Property(0)],i.prototype,"distance",void 0),i}(e.ChildProperty),Io=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Co(i,t),To([e.Property("None")],i.prototype,"type",void 0),i}(e.ChildProperty),Eo=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Co(i,t),To([e.Property("Object")],i.prototype,"flow",void 0),To([e.Property(30)],i.prototype,"exceptionFlowHeight",void 0),i}(Io),zo=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Co(i,t),To([e.Property("Sequence")],i.prototype,"flow",void 0),To([e.Property("Normal")],i.prototype,"sequence",void 0),To([e.Property("Default")],i.prototype,"message",void 0),To([e.Property("Default")],i.prototype,"association",void 0),i}(Io),Do=function(t){function i(e,i,r,o){var n=t.call(this,e,i,r,o)||this;return n.points=[],n}return Co(i,t),To([e.Property("Straight")],i.prototype,"type",void 0),i}(e.ChildProperty),ko=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Co(i,t),To([e.Complex({x:0,y:0},wr)],i.prototype,"point",void 0),i}(Do),Ro=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Co(i,t),To([e.Complex({x:0,y:0},wr)],i.prototype,"point1",void 0),To([e.Complex({x:0,y:0},wr)],i.prototype,"point2",void 0),To([e.Complex({angle:0,distance:0},Oo)],i.prototype,"vector1",void 0),To([e.Complex({angle:0,distance:0},Oo)],i.prototype,"vector2",void 0),i}(ko),No=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Co(i,t),To([e.Property(null)],i.prototype,"length",void 0),To([e.Property(null)],i.prototype,"direction",void 0),i}(Do),Bo=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Co(i,t),To([e.Property(!0)],i.prototype,"optional",void 0),To([e.Property(void 0)],i.prototype,"lowerBounds",void 0),To([e.Property(void 0)],i.prototype,"upperBounds",void 0),i}(e.ChildProperty),jo=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Co(i,t),To([e.Property("")],i.prototype,"type",void 0),To([e.Complex({},Bo)],i.prototype,"target",void 0),To([e.Complex({},Bo)],i.prototype,"source",void 0),i}(e.ChildProperty),Ho=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Co(i,t),To([e.Property("UmlClassifier")],i.prototype,"type",void 0),To([e.Property("Aggregation")],i.prototype,"relationship",void 0),To([e.Property("Directional")],i.prototype,"associationType",void 0),To([e.Complex({},jo)],i.prototype,"multiplicity",void 0),i}(Io),Wo=function(i){function r(t,e,r,o){var n=i.call(this,t,e,r,o)||this;return n.parentId="",n.bridges=[],n.status="None",n.shape&&"UmlActivity"===n.shape.type&&Pe(r,n),n}return Co(r,i),r.prototype.init=function(t){this.id||(this.id=Hi());var e,i=new Qr,r=new Yr;r.id=this.id+"_path";var o=new Yr,n=new Yr;r=this.getSegmentElement(this,r);var a,s=[];switch(s=this.getConnectorPoints(this.type),s=this.clipDecorators(this,s),a=xr.toBounds(s),i.width=a.width,i.height=a.height,i.offsetX=a.x+i.pivot.x*a.width,i.offsetY=a.y+i.pivot.y*a.height,this.shape.type){case"Bpmn":switch(this.shape.flow){case"Sequence":e=this.getBpmnSequenceFlow();break;case"Association":(e=new Yr).visible=!1,this.getBpmnAssociationFlow();break;case"Message":e=this.getBpmnMessageFlow(),r=this.getSegmentElement(this,r),this.updateShapePosition(this,e)}break;case"UmlActivity":switch(this.shape.flow){case"Object":this.getUMLObjectFlow();break;case"Exception":this.getUMLExceptionFlow(r)}break;case"UmlClassifier":this.getConnectorRelation()}var h=this.intermediatePoints;if("Bezier"===this.type){var d=this.segments[0],l=this.segments[this.segments.length-1];h=[wr.isEmptyPoint(l.point2)?l.bezierPoint2:l.point2,wr.isEmptyPoint(d.point1)?d.bezierPoint1:d.point1]}var c=t.getDescription;this.sourceWrapper&&this.sourceWrapper.style.strokeWidth;if(o=this.getDecoratorElement(s[0],h[1],this.sourceDecorator,!0,c),n=this.getDecoratorElement(s[s.length-1],h[h.length-2],this.targetDecorator,!1,c),o.id=this.id+"_srcDec",n.id=this.id+"_tarDec",r.style=this.style,r.style.fill="transparent",void 0!==c){var p=c(this,t);r.description=p||this.id}i.style.strokeColor="transparent",i.style.fill="transparent",i.style.strokeWidth=0,i.children=[r,o,n],i.id=this.id,void 0!==e&&i.children.push(e),i.offsetX=r.offsetX,i.offsetY=r.offsetY,i.width=r.width,i.height=r.height;for(var g=0;this.annotations,g<this.annotations.length;g++)i.children.push(this.getAnnotationElement(this.annotations[g],this.intermediatePoints,a,c,t.element.id));return this.wrapper=i,i},r.prototype.getConnectorRelation=function(){var t=this.shape;"Association"===t.relationship?(this.segments[0].type="Straight",this.sourceDecorator.shape="None",this.targetDecorator.shape="Arrow",this.style.strokeWidth=2):"Inheritance"===t.relationship?(this.segments[0].type="Orthogonal",this.sourceDecorator.shape="None",this.targetDecorator.shape="Arrow",this.targetDecorator.style.fill="white",this.style.strokeWidth=2,this.style.strokeDashArray="4 4"):"Composition"===t.relationship?(this.segments[0].type="Orthogonal",this.sourceDecorator.shape="Diamond",this.targetDecorator.shape="None",this.sourceDecorator.style.fill="black",this.style.strokeWidth=2):"Aggregation"===t.relationship?(this.segments[0].type="Orthogonal",this.sourceDecorator.shape="Diamond",this.targetDecorator.shape="None",this.sourceDecorator.style.fill="white",this.style.strokeWidth=2):"Dependency"===t.relationship?(this.segments[0].type="Orthogonal",this.sourceDecorator.shape="None",this.targetDecorator.shape="OpenArrow",this.sourceDecorator.style.fill="white",this.style.strokeWidth=2,this.style.strokeDashArray="4 4"):"Realization"===t.relationship&&(this.segments[0].type="Orthogonal",this.sourceDecorator.shape="None",this.targetDecorator.shape="Arrow",this.sourceDecorator.style.fill="white",this.style.strokeWidth=2),"BiDirectional"===t.associationType&&(this.sourceDecorator.shape="None",this.targetDecorator.shape="None");var e,i,r="",o="",n="",a="";t.multiplicity.source&&(t.multiplicity.source.lowerBounds=t.multiplicity.source.lowerBounds,t.multiplicity.source.upperBounds=t.multiplicity.source.upperBounds),t.multiplicity.target&&(t.multiplicity.target.lowerBounds=t.multiplicity.target.lowerBounds,t.multiplicity.target.upperBounds=t.multiplicity.target.upperBounds),e=t.multiplicity.source,i=t.multiplicity.target,a=e.upperBounds?e.lowerBounds+"..."+e.upperBounds:e.lowerBounds,r=i.upperBounds?i.lowerBounds+"..."+i.upperBounds:i.lowerBounds,"ManyToOne"===t.multiplicity.type&&(t.multiplicity.target.optional=!1,o=a||"*",n="1"),"OneToMany"===t.multiplicity.type&&(t.multiplicity.source.optional=!1,n=r||"*",o="1"),"ManyToOne"===t.multiplicity.type&&(o=a||"*",n=r||"*"),"OneToOne"===t.multiplicity.type&&(t.multiplicity.target.optional=!1,t.multiplicity.source.optional=!1,o="1",n="1"),this.annotations=[{id:this.id+"sourcelabel",content:o,offset:0,alignment:"Before",margin:{right:5,bottom:5}},{id:this.id+"targetlabel",content:n,offset:1,alignment:"Before",margin:{right:5,bottom:5}}]},r.prototype.getBpmnSequenceFlow=function(){var e,i=new Yr,r=new Yr;if("Normal"===this.shape.sequence&&"Bezier"!==this.type&&(this.targetDecorator.shape="Arrow",this.targetDecorator.style.fill="black"),"Default"===this.shape.sequence){i=this.getSegmentElement(this,i);for(var o=this.intermediatePoints,n=0;n<o.length-1;n++)length+=this.distance(o[n],o[n+1]),e=this.findPath(o[n],o[n+1]),r.data=e[0],r.id=this.id+"_"+this.shape.sequence,r.offsetX=e[1].x,r.offsetY=e[1].y,r.rotateAngle=45,r.transform=t.Transform.Self;this.targetDecorator.shape="Arrow",this.targetDecorator.style.fill="black"}return"Conditional"===this.shape.sequence&&(this.targetDecorator.shape="Arrow",this.sourceDecorator.shape="Diamond",this.sourceDecorator.style.fill="white",this.targetDecorator.style.fill="black",this.sourceDecorator.width=20,this.sourceDecorator.height=10),r},r.prototype.getUMLObjectFlow=function(){if(this.annotations)for(var t=0;t<this.annotations.length;t++)this.annotations[t].content="["+this.annotations[t].content+"]"},r.prototype.getUMLExceptionFlow=function(t){this.type="Straight";var e=this.shape.exceptionFlowHeight/2,i={x:(this.targetPoint.x+this.sourcePoint.x)/2,y:(this.targetPoint.y+this.sourcePoint.y)/2},r=i.x-this.sourcePoint.x,o=i.y-this.sourcePoint.y,n=e/Math.sqrt(r*r+o*o),a={x:i.x-r*n,y:i.y-o*n},s={x:i.x+r*n,y:i.y+o*n},h=m();b(h,315,i.x,i.y),this.segments=[];var d=new ko(this,"segments",{type:"Straight",point:y(h,s)},!0);this.segments.push(d),d=new ko(this,"segments",{type:"Straight",point:y(h,a)},!0),this.segments.push(d),t=this.getSegmentElement(this,t)},r.prototype.getBpmnAssociationFlow=function(){"Default"===this.shape.association&&(this.targetDecorator.shape="Arrow",this.targetDecorator.style.fill="black"),"Directional"===this.shape.association&&(this.style.strokeDashArray="2 2",this.targetDecorator.style.fill="black",this.targetDecorator.shape="Arrow"),"BiDirectional"===this.shape.association&&(this.style.strokeDashArray="2 2",this.targetDecorator.shape="Arrow",this.targetDecorator.style.fill="black",this.sourceDecorator.shape="Arrow",this.sourceDecorator.style.fill="white",this.sourceDecorator.width=5,this.sourceDecorator.height=10)},r.prototype.getBpmnMessageFlow=function(){var e=new Yr;return this.style.strokeDashArray="4 4",this.targetDecorator.shape="Arrow",this.targetDecorator.width=5,this.targetDecorator.height=10,this.sourceDecorator.shape="Circle","InitiatingMessage"!==this.shape.message&&"NonInitiatingMessage"!==this.shape.message||(e.id=this.id+"_"+this.shape.message,e.width=25,e.height=15,e.data="M0,0 L19.8,12.8 L40,0 L0, 0 L0, 25.5 L40, 25.5 L 40, 0",e.horizontalAlignment="Center",e.verticalAlignment="Center",e.transform=t.Transform.Self,e.style.fill="NonInitiatingMessage"===this.shape.message?"lightgrey":"white"),e},r.prototype.distance=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},r.prototype.findPath=function(t,e){var i={x:t.x,y:t.y},r=this.distance(t,e);r=Math.min(30,r/2);var o=$(t,e),n=wr.transform({x:i.x,y:i.y},o,r),a=wr.transform({x:n.x,y:n.y},o,-12),s=wr.transform({x:a.x,y:a.y},o,24);return["M"+a.x+" "+a.y+" L"+s.x+" "+s.y,n]},r.prototype.getAnnotationElement=function(t,e,i,r,o){t.id=t.id||Hi();var n;o&&t.template?(n=new Po(this.id,o,t.id)).content=t.template:((n=new Gr).content=t.content,n.style.textOverflow="Wrap"),n.constraints=t.constraints,n.visible=t.visibility,n.rotateAngle=t.rotateAngle,n.horizontalAlignment=t.horizontalAlignment,n.verticalAlignment=t.verticalAlignment,n.width=t.width,n.height=t.height,void 0===i.width||t.template||(n.width=(t.width||i.width)-t.margin.left-t.margin.right),n.margin=t.margin,n.id=this.id+"_"+t.id,0===i.width&&(i.width=this.style.strokeWidth),0===i.height&&(i.height=this.style.strokeWidth),n.style=t.style;var a,s=ir(r);return s&&(a=s(t,this)),n.description=a||n.id,this.updateAnnotation(t,e,i,n),n},r.prototype.updateAnnotation=function(t,e,i,r){var o,n,a,s,h,d,l={x:0,y:0};r instanceof Po||r.refreshTextElement(),r.width=t.width||i.width,n=(o=Re(e,t,i)).point,t.segmentAngle&&(r.rotateAngle=t.rotateAngle+o.angle,r.rotateAngle=(r.rotateAngle+360)%360),0===i.width&&(i.width=this.style.strokeWidth),0===i.height&&(i.height=this.style.strokeWidth),d={x:(n.x-i.x)/i.width,y:(n.y-i.y)/i.height},l.x=i.width*d.x,l.y=i.height*d.y,s=(a=je(t,o.angle,e)).hAlign,h=a.vAlign;var c,p;"left"===s?(c="Left",l.x+=t.displacement.x):"right"===s?(c="Right",l.x-=t.displacement.x):"center"===s&&(c="Center"),"top"===h?(p="Top",l.y+=t.displacement.y):"bottom"===h?(p="Bottom",l.y-=t.displacement.y):"center"===h&&(p="Center"),r.horizontalAlignment=c,r.verticalAlignment=p,r.setOffsetWithRespectToBounds(l.x,l.y,"Absolute"),r.relativeMode="Point"},r.prototype.getConnectorPoints=function(t,e,i){Math.abs(this.sourcePoint.x-this.targetPoint.x),Math.abs(this.sourcePoint.y-this.targetPoint.y);var r=R(this,i).slice(0);return r&&r.length>0&&(this.sourcePoint=r[0],this.targetPoint=r[r.length-1]),r},r.prototype.clipDecorator=function(t,e,i){var r={x:0,y:0},o={x:0,y:0},n={x:0,y:0},a=e.length;o=i?e[0]:e[a-1],n=i?e[1]:e[a-2];var s=wr.distancePoints(o,n);s=0===s?1:s;var h=t.style.strokeWidth-1;r.x=Math.round(o.x+h*(n.x-o.x)/s),r.y=Math.round(o.y+h*(n.y-o.y)/s);var d=1,l=i?t.sourceWrapper:t.targetWrapper;return l&&(d=l.style.strokeWidth),(i&&"None"!==t.sourceDecorator.shape||!i&&"None"!==t.targetDecorator.shape)&&(r=wr.adjustPoint(r,n,!0,d/2)),r},r.prototype.clipDecorators=function(t,e){return"None"!==t.sourceDecorator.shape&&(e[0]=this.clipDecorator(t,e,!0)),"None"!==t.targetDecorator.shape&&(e[e.length-1]=this.clipDecorator(t,e,!1)),e},r.prototype.updateSegmentElement=function(t,e,i){var r,o=new xr;if(r=this.getSegmentPath(t,e),"Bezier"===t.type){if(this.segments.length>0)for(var n=0;n<this.segments.length;n++){var a=this.segments[n],s=t.segments[n],h=wr.isEmptyPoint(a.point1)?s.bezierPoint1:s.point1,d=wr.isEmptyPoint(a.point2)?s.bezierPoint2:s.point2;o.uniteRect(bt(a.points[0],h,d,a.points[1],t))}}else o=xr.toBounds(e);return i.width=o.width,i.height=o.height,i.offsetX=o.x+i.width/2,i.offsetY=o.y+i.height/2,i.data=r,t.wrapper&&(t.wrapper.offsetX=i.offsetX,t.wrapper.offsetY=i.offsetY,t.wrapper.width=o.width,t.wrapper.height=o.height),i},r.prototype.getSegmentElement=function(t,e){var i=[];return i=this.getConnectorPoints(t.type),this.intermediatePoints=i,e.staticSize=!0,e=this.updateSegmentElement(t,i,e)},r.prototype.getDecoratorElement=function(e,i,r,o,n){var a=new Yr;if(a.transform=t.Transform.Self,this.updateDecoratorElement(a,e,i,r),void 0!==n){var s=n(r,this);a.description=s||"source"}return a},r.prototype.bridgePath=function(t,e,i){var r=e;if(t.bridges.length>0)if("Straight"===t.type)for(var o=0;o<t.bridges.length;o++){(n=t.bridges[o]).rendered||(r+=" L"+n.startPoint.x+" "+n.startPoint.y,r+=n.path,n.rendered=!0)}else if("Orthogonal"===t.type)for(o=0;o<t.bridges.length;o++){var n;(n=t.bridges[o]).segmentPointIndex===i&&(n.rendered||n.segmentPointIndex===i&&(r+=" L"+n.startPoint.x+" "+n.startPoint.y,r+=n.path,n.rendered=!0))}return r},r.prototype.updateDecoratorElement=function(t,e,i,r){var o,n;t.offsetX=e.x,t.offsetY=e.y,n=wr.findAngle(e,i),o=M(r.shape,r);var a=new yr(r.width,r.height);t.pivot.x=r.pivot.x,t.pivot.y=r.pivot.y,t.style=r.style,t.rotateAngle=n,t.data=o,t.canMeasurePath=!0,t.width=a.width,t.height=a.height},r.prototype.getSegmentPath=function(t,e){for(var i,r,o,n="",a=[],s=0;s<e.length;)a.push({x:e[s].x,y:e[s].y}),s++;for(var h=0;h<t.bridges.length;h++){t.bridges[h].rendered=!1}if(a=this.clipDecorators(t,a),this.cornerRadius>0&&"Bezier"!==this.type)for(var d=0;d<a.length-1;d++){i=a[d],0===d&&(n="M"+i.x+" "+i.y);var l=wr.distancePoints(a[d],a[d+1]);l>0&&(r=d<a.length-2?l<2*this.cornerRadius?wr.adjustPoint(a[d],a[d+1],!1,l/2):wr.adjustPoint(a[d],a[d+1],!1,this.cornerRadius):a[d+1],d>0&&(l<2*this.cornerRadius?(o=wr.adjustPoint(a[d],a[d+1],!0,l/2),d<a.length-2&&(r=null)):o=wr.adjustPoint(a[d],a[d+1],!0,this.cornerRadius)),o&&(n+="Q"+i.x+" "+i.y+" "+o.x+" "+o.y),r&&(t.bridges.length>0&&(n=this.bridgePath(t,n,d),"Orthogonal"===t.type&&(n=this.bridgePath(t,n,d+1))),n+=" L"+r.x+" "+r.y))}else if("Bezier"===this.type){for(var c=void 0,p=this.segments,g=0;g<p.length;g++)a.length>2&&(p[g].bezierPoint1={x:0,y:0},p[g].bezierPoint2={x:0,y:0}),!wr.isEmptyPoint(p[g].point1)||p[g].vector1.angle||p[g].vector1.distance?p[g].vector1.angle||p[g].vector1.distance?p[g].bezierPoint1=wr.transform(a[g],p[g].vector1.angle,p[g].vector1.distance):p[g].bezierPoint1={x:p[g].point1.x||p[g].bezierPoint1.x,y:p[g].point1.y||p[g].bezierPoint1.y}:((t.sourceID||this.sourcePortID)&&this.sourceWrapper&&(c=mt(this.sourceWrapper.bounds,a[g],!0)),p[g].bezierPoint1=vt(a[g],a[g+1],c)),!wr.isEmptyPoint(p[g].point2)||p[g].vector2.angle||p[g].vector2.distance?p[g].vector2.angle||p[g].vector2.distance?p[g].bezierPoint2=wr.transform(a[g+1],p[g].vector2.angle,p[g].vector2.distance):p[g].bezierPoint2={x:p[g].point2.x||p[g].bezierPoint2.x,y:p[g].point2.y||p[g].bezierPoint2.y}:((t.targetID||this.targetPortID)&&this.targetWrapper&&(c=mt(this.targetWrapper.bounds,a[g+1],!0)),p[g].bezierPoint2=vt(a[g+1],a[g],c));a.splice(1,0,{x:p[0].bezierPoint1.x,y:p[0].bezierPoint1.y}),a.splice(a.length-1,0,{x:p[p.length-1].bezierPoint2.x,y:p[p.length-1].bezierPoint2.y}),a=this.clipDecorators(t,a);for(var u=0;u<p.length;u++){0===u&&(n="M"+a[0].x+" "+a[0].y);var f=u===p.length-1?a[a.length-1].x+" "+a[a.length-1].y:p[u].points[p[u].points.length-1].x+" "+p[u].points[p[u].points.length-1].y;n+="C"+p[u].bezierPoint1.x+" "+p[u].bezierPoint1.y+" "+p[u].bezierPoint2.x+" "+p[u].bezierPoint2.y+" "+f}}else for(var m=0;m<a.length;m++)i=a[m],0===m&&(n="M"+i.x+" "+i.y),m>0&&(n=this.bridgePath(t,n,m),n+=" L"+i.x+" "+i.y);return n},r.prototype.updateShapeElement=function(t){var e;switch(t.shape.type){case"Bpmn":t.wrapper.children[3]instanceof Yr&&(e=t.wrapper.children[3]),"Message"===t.shape.flow&&this.updateShapePosition(t,e);break;case"UmlActivity":"Exception"===t.shape.flow&&this.getUMLExceptionFlow(t.wrapper.children[0])}},r.prototype.updateShapePosition=function(t,e){for(var i,r,o=0,n=this.intermediatePoints,a=0;a<n.length-1;a++){var s=.5*(o+=this.distance(n[a],n[a+1]));o>=s&&(i=$(n[a],n[a+1]),r=wr.transform(n[a],i,s))}e.offsetX=r.x,e.offsetY=r.y},r.prototype.scale=function(t,e,i,r,o){var n=0,a=0;if(this.wrapper&&this.wrapper.outerBounds){var s=ut(this),h=(this.wrapper.bounds.width||this.style.strokeWidth||1)-2,d=(this.wrapper.bounds.height||this.style.strokeWidth||1)-2;n=s.width-h,a=s.height-d,t=(i-Math.max(n,a))/h,e=(r-Math.max(n,a))/d,n=a=Math.min(n,a)}t=e=Math.min(t,e);var l=m();b(l,-(o=o||this.wrapper).rotateAngle,o.offsetX,o.offsetY),w(l,t,e,o.offsetX,o.offsetY),b(l,o.rotateAngle,o.offsetX,o.offsetY);var c=v(l,this.intermediatePoints);return this.sourcePoint=c[0],this.targetPoint=c[c.length-1],c=this.intermediatePoints=R(this),Qe(this,c),{x:n,y:a}},To([e.ComplexFactory(Ao)],r.prototype,"shape",void 0),To([e.Property(t.ConnectorConstraints.Default)],r.prototype,"constraints",void 0),To([e.Property(10)],r.prototype,"bridgeSpace",void 0),To([e.Collection([],ho)],r.prototype,"annotations",void 0),To([e.Complex({},wr)],r.prototype,"sourcePoint",void 0),To([e.Complex({},wr)],r.prototype,"targetPoint",void 0),To([e.CollectionFactory(Mo)],r.prototype,"segments",void 0),To([e.Property("")],r.prototype,"sourceID",void 0),To([e.Property("")],r.prototype,"targetID",void 0),To([e.Property(10)],r.prototype,"hitPadding",void 0),To([e.Property("Straight")],r.prototype,"type",void 0),To([e.Property(0)],r.prototype,"cornerRadius",void 0),To([e.Complex({shape:"None"},Lo)],r.prototype,"sourceDecorator",void 0),To([e.Complex({shape:"Arrow"},Lo)],r.prototype,"targetDecorator",void 0),To([e.Complex({},vo)],r.prototype,"tooltip",void 0),To([e.Property("")],r.prototype,"sourcePortID",void 0),To([e.Property("")],r.prototype,"targetPortID",void 0),To([e.Complex({strokeWidth:1,strokeColor:"black"},jr)],r.prototype,"style",void 0),To([e.Property(null)],r.prototype,"wrapper",void 0),r}(xo),_o=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Xo=function(t,e,i,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},Yo=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return _o(i,t),Xo([e.Property("")],i.prototype,"name",void 0),Xo([e.Property("")],i.prototype,"pathData",void 0),Xo([e.Property("#000000")],i.prototype,"backgroundColor",void 0),Xo([e.Property("top")],i.prototype,"side",void 0),Xo([e.Property("")],i.prototype,"borderColor",void 0),Xo([e.Property(.5)],i.prototype,"borderWidth",void 0),Xo([e.Property(25)],i.prototype,"size",void 0),Xo([e.Property("white")],i.prototype,"pathColor",void 0),Xo([e.Property(10)],i.prototype,"displacement",void 0),Xo([e.Property(!0)],i.prototype,"visible",void 0),Xo([e.Property(0)],i.prototype,"offset",void 0),Xo([e.Complex({},Er)],i.prototype,"margin",void 0),Xo([e.Property("Center")],i.prototype,"horizontalAlignment",void 0),Xo([e.Property("Center")],i.prototype,"verticalAlignment",void 0),i}(e.ChildProperty),Vo=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return _o(r,i),r.prototype.init=function(t){var e=new _r;if(e.measureChildren=!1,e.children=[],this.annotation){var i=this.nodes.length>0?t.nameTable[this.nodes[0].id].wrapper:t.nameTable[this.connectors[0].id].wrapper,r=t.getWrapper(i,this.annotation.id);e.children.push(r)}else if(this.nodes||this.connectors){for(var o=0;o<this.nodes.length;o++){r=t.nameTable[this.nodes[o].id].wrapper;e.children.push(r)}for(var n=0;n<this.connectors.length;n++){r=t.nameTable[this.connectors[n].id].wrapper;e.children.push(r)}}return this.wrapper=e,e},Xo([e.Property(null)],r.prototype,"wrapper",void 0),Xo([e.Collection([],En)],r.prototype,"nodes",void 0),Xo([e.Collection([],Wo)],r.prototype,"connectors",void 0),Xo([e.Property()],r.prototype,"width",void 0),Xo([e.Property()],r.prototype,"height",void 0),Xo([e.Property(0)],r.prototype,"rotateAngle",void 0),Xo([e.Property(0)],r.prototype,"offsetX",void 0),Xo([e.Property(0)],r.prototype,"offsetY",void 0),Xo([e.Complex({x:.5,y:.5},wr)],r.prototype,"pivot",void 0),Xo([e.Property("CompleteIntersect")],r.prototype,"rubberBandSelectionMode",void 0),Xo([e.Collection([],Yo)],r.prototype,"userHandles",void 0),Xo([e.Property(t.SelectorConstraints.All)],r.prototype,"constraints",void 0),r}(e.ChildProperty),Uo=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Fo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.orientation="Vertical",e.measureChildren=void 0,e}return Uo(e,t),e.prototype.measure=function(t){var e="Horizontal"===this.orientation?this.updateHorizontalStack:this.updateVerticalStack;return this.desiredSize=this.measureStackPanel(t,e),this.desiredSize},e.prototype.arrange=function(t){var e="Horizontal"===this.orientation?this.arrangeHorizontalStack:this.arrangeVerticalStack;return this.actualSize=this.arrangeStackPanel(t,e),this.updateBounds(),this.actualSize},e.prototype.measureStackPanel=function(e,i){var r=void 0;if(void 0!==this.children&&this.children.length>0)for(var o=0,n=this.children;o<n.length;o++){var a=n[o];a.parentTransform=this.rotateAngle+this.parentTransform,a.measure(a.desiredSize);var s=a.desiredSize.clone();this.applyChildMargin(a,s),0!==a.rotateAngle&&(s=$i(s,a.rotateAngle)),void 0===r?r=s:i(s,r)}return r=t.prototype.validateDesiredSize.call(this,r,e),this.stretchChildren(r),this.applyPadding(r),r},e.prototype.arrangeStackPanel=function(e,i){if(void 0!==this.children&&this.children.length>0){var r=void 0,o=void 0;r=this.offsetX-e.width*this.pivot.x+this.padding.left,o=this.offsetY-e.height*this.pivot.y+this.padding.top;for(var n=0,a=this.children;n<a.length;n++){var s=a[n],h=s.desiredSize.clone(),d=h;"Vertical"===this.orientation?o+=s.margin.top:r+=s.margin.left,0!==s.rotateAngle&&(d=$i(h,s.rotateAngle));var l=i(r,o,s,this,e,d);t.prototype.findChildOffsetFromCenter.call(this,s,l),s.arrange(h,!0),"Vertical"===this.orientation?o+=d.height+s.margin.bottom:r+=d.width+s.margin.right}}return e},e.prototype.updateHorizontalStack=function(t,e){e.height=Math.max(t.height,e.height),e.width+=t.width},e.prototype.updateVerticalStack=function(t,e){e.width=Math.max(t.width,e.width),e.height+=t.height},e.prototype.arrangeHorizontalStack=function(t,e,i,r,o,n){var a=0;if("Top"===i.verticalAlignment)a=e+i.margin.top+n.height/2;else if("Bottom"===i.verticalAlignment){a=r.offsetY+o.height*(1-r.pivot.y)-r.padding.bottom-i.margin.bottom-n.height/2}else a=r.offsetY-o.height*r.pivot.y+o.height/2,i.margin.top&&(a=e+i.margin.top+n.height/2);return{x:t+n.width/2,y:a}},e.prototype.arrangeVerticalStack=function(t,e,i,r,o,n){var a=0;if("Left"===i.horizontalAlignment)a=t+i.margin.left+n.width/2;else if("Right"===i.horizontalAlignment){a=r.offsetX+o.width*(1-r.pivot.x)-r.padding.right-i.margin.right-n.width/2}else a=r.offsetX-o.width*r.pivot.x+o.width/2,i.margin.left&&(a=t+i.margin.left+n.width/2);return{x:a,y:e+n.height/2}},e.prototype.stretchChildren=function(t){if(void 0!==this.children&&this.children.length>0)for(var e=0,i=this.children;e<i.length;e++){var r=i[e];"Vertical"===this.orientation?"Stretch"===r.horizontalAlignment&&(r.desiredSize.width=t.width-(r.margin.left+r.margin.right)):"Stretch"===r.verticalAlignment&&(r.desiredSize.height=t.height-(r.margin.top+r.margin.bottom))}},e.prototype.applyChildMargin=function(t,e){e.height+=t.margin.top+t.margin.bottom,e.width+=t.margin.left+t.margin.right},e}(_r),Go=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Zo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.childTable=[],e.cellStyle={},e.desiredRowHeight=[],e.desiredCellWidth=[],e}return Go(e,t),e.prototype.columnDefinitions=function(){return this.colDefns},e.prototype.addObject=function(t,e,i,r,o){if(this.rows.length>=e){var n=this.rows[e];if(n.cells.length>i){o=o||1,r=r||1;var a=n.cells[i];a.columnSpan=Math.max(o,a.columnSpan),a.rowSpan=Math.max(r,a.rowSpan);var s=new $o;(s=t).rowId=e,s.columnId=i,s.columnSpan=o,this.childTable[s.id]=s,this.addObjectToCell(s,a)}}},e.prototype.addObjectToCell=function(t,e){e.children||(e.children=[]),t.style.strokeColor="black",t.style.strokeWidth=1,t.style.fill="white",e.children.push(t)},e.prototype.updateProperties=function(t,e,i,r){this.offsetX=t,this.offsetY=e,this.width=i,this.height=r},e.prototype.setDefinitions=function(t,e){this.rowDefns=t,this.colDefns=e,this.children=[],this.rows=this.rows||[];for(var i=0;i<t.length;i++){var r=t[i],o=new Qo;o.cells=[];var n=new Ko;n.width=this.width;var a=this.colDefns;(void 0===a||a.length<1)&&(a=[n]),this.addCellInRow(a,r,o),this.rows.push(o)}},e.prototype.addCellInRow=function(t,e,i){for(var r=0;r<t.length;r++){var o=t[r],n=new Jo;n.children=[],this.cellStyle.fill="none",this.cellStyle.strokeColor="none",n.id=Hi(),n.style=this.cellStyle,n.desiredCellWidth=n.minWidth=o.width,n.desiredCellHeight=n.minHeight=e.height,i.cells.push(n),this.children.push(n)}},e.prototype.calculateSize=function(){for(var t=this.rows||[],e=0,i=0,r=0;r<t.length;r++){var o=this.rows[r];i=0;for(var n=0;n<o.cells.length;n++)i+=o.cells[n].desiredCellWidth,n===o.cells.length-1&&(this.width&&this.width!==i&&(o.cells[n].desiredCellWidth+=this.width-i,o.cells[n].children&&o.cells[n].children.length&&(o.cells[n].children[0].minWidth=o.cells[n].desiredCellWidth)),e+=o.cells[n].desiredCellHeight,r===t.length-1&&this.height&&this.height!==e&&(o.cells[n].desiredCellHeight+=this.height-e,o.cells[n].children&&o.cells[n].children.length&&(o.cells[n].children[0].minHeight=o.cells[n].desiredCellHeight)))}},e.prototype.updateRowHeight=function(t,e){var i=this.rows[t];void 0!==this.height&&(this.height+=e-i.cells[0].desiredCellHeight);for(var r=0;r<i.cells.length;r++)i.cells[r].desiredCellHeight=i.cells[r].minHeight=e,i.cells[r].children&&i.cells[r].children.length&&(i.cells[r].children[0].minHeight=e);this.desiredRowHeight[t]=e,this.measure(new yr(this.width,this.height)),this.arrange(this.desiredSize)},e.prototype.updateColumnWidth=function(t,e){void 0!==this.width&&(this.width+=e-this.rows[0].cells[t].desiredCellWidth);for(var i=0;i<this.rows.length;i++)this.rows[i].cells[t].desiredCellWidth=this.rows[i].cells[t].minWidth=e,this.rows[i].cells[t].children&&this.rows[i].cells[t].children.length&&(this.rows[i].cells[t].children[0].minWidth=e);this.desiredCellWidth[t]=e,this.measure(new yr(this.width,this.height)),this.arrange(this.desiredSize)},e.prototype.addRow=function(t,e){for(var i=0;i<e.length;i++){var r=e[i];this.rowDefns.push(r);var o=new Qo;o.cells=[];(new Ko).width=this.width;var n=this.colDefns;this.addCellInRow(n,r,o),t>this.rows.length-1?this.rows.push(o):this.rows.splice(t,0,o)}this.measure(new yr(this.width,this.height)),this.arrange(this.desiredSize)},e.prototype.addColumn=function(t,e){for(var i=this.rows,r=0;r<i.length;r++)for(var o=i[r],n=this.rowDefns[r],a=0;a<e.length;a++){var s=e[a],h=new Jo;h.style=this.cellStyle,h.desiredCellWidth=s.width,h.desiredCellHeight=n.height,t>o.cells.length-1?o.cells.push(h):o.cells.splice(t,0,h),this.children.push(h)}this.measure(new yr(this.width,this.height)),this.arrange(this.desiredSize)},e.prototype.removeRow=function(t){for(var e=this.rows[t],i=0;i<e.cells.length;i++){var r=e.cells[i];this.children.splice(this.children.indexOf(r),1);var o=document.getElementById(r.id+"_groupElement");o.parentElement.removeChild(o)}this.rows.splice(t,1),this.rowDefns.splice(t,1),this.measure(new yr(this.width,this.height)),this.arrange(this.desiredSize)},e.prototype.removeColumn=function(t){for(var e=this.rows,i=0;i<e.length;i++){var r=e[i].cells[t];this.children.splice(this.children.indexOf(r),1);var o=document.getElementById(r.id+"_groupElement");o.parentElement.removeChild(o),e[i].cells.splice(t,1)}this.measure(new yr(this.width,this.height)),this.arrange(this.desiredSize)},e.prototype.updateRowIndex=function(t,e){this.rows;var i=this.rows[t];this.rows.splice(t,1),this.rows.splice(e,0,i),this.measure(new yr(this.width,this.height)),this.arrange(this.desiredSize)},e.prototype.measure=function(e){var i=void 0;if(void 0!==this.rows&&this.rows.length>0){var r=0,o=0;i=new yr(0,0),this.calculateSize();for(var n=0,a=this.rows;n<a.length;n++){o=0;for(var s=0,h=(g=a[n]).cells;s<h.length;s++){var d=(y=h[s]).measure(new yr(y.desiredCellWidth,y.desiredCellHeight));1===y.rowSpan&&(0===o||void 0===this.desiredRowHeight[r]?this.desiredRowHeight[r]=d.height:this.desiredRowHeight[r]=Math.max(d.height,this.desiredRowHeight[r])),1===y.columnSpan&&(0===r||void 0===this.desiredCellWidth[o]?this.desiredCellWidth[o]=d.width:this.desiredCellWidth[o]=Math.max(d.width,this.desiredCellWidth[o]),r===this.rows.length-1&&(i.width+=this.desiredCellWidth[o])),o++}i.height+=this.desiredRowHeight[r],r++}r=o=0;for(var l=0,c=0,p=this.rows;c<p.length;c++){var g;o=0;for(var u=0,f=0,m=(g=p[c]).cells;f<m.length;f++){var y;if(1!==(y=m[f]).columnSpan){y.desiredSize.width=0;for(var v=0;v<y.columnSpan;v++)v+o<g.cells.length&&(y.desiredSize.width+=this.desiredCellWidth[v+o],y.minWidth=y.desiredSize.width,y.measure(y.desiredSize));o++}else y.desiredSize.width=this.desiredCellWidth[u],y.measure(y.desiredSize);if(1!==y.rowSpan){y.desiredSize.height=0;for(v=0;v<y.rowSpan;v++)v+l<this.rows.length&&(y.desiredSize.height+=this.desiredRowHeight[v+l],y.minHeight=y.desiredSize.height,y.measure(y.desiredSize))}else y.desiredSize.height=this.desiredRowHeight[l],y.measure(y.desiredSize);r++,u++}l++}}return void 0===i&&(i=t.prototype.validateDesiredSize.call(this,i,e)),t.prototype.stretchChildren.call(this,i),this.desiredSize=i,i},e.prototype.arrange=function(t,e){if(void 0!==this.rows&&this.rows.length>0){for(var i=this.offsetX-t.width*this.pivot.x,r=this.offsetY-t.height*this.pivot.y,o=i,n=0,a=0,s=0,h=this.rows;s<h.length;s++){o=i,n=0;for(var d=0,l=(f=h[s]).cells;d<l.length;d++){var c=l[d],p=Math.max(this.desiredCellWidth[n],c.desiredSize.width),g=Math.max(this.desiredRowHeight[a],c.desiredSize.height);c.offsetX=o+p*c.pivot.x,c.offsetY=r+g*c.pivot.y,o+=this.desiredCellWidth[n],c.arrange(new yr(p,g)),n++}r+=this.desiredRowHeight[a],a++}if(e)for(var u=0;u<this.rows.length;u++)for(var f=this.rows[u],m=0;m<f.cells.length;m++){if((c=f.cells[m]).columnSpan>1&&this.children.splice(this.children.indexOf(c)+1,c.columnSpan-1),c.rowSpan>1){var y=void 0,v=void 0;for(y=u,v=0;y+c.rowSpan-1<this.rows.length&&v<c.rowSpan-1;y++,v++){var b=this.rows[y+1].cells[m];this.children.splice(this.children.indexOf(b),1)}}}}return this.actualSize=t,this.updateBounds(),t},e}(_r),qo=function(){return function(){this.height=void 0}}(),Ko=function(){return function(){this.width=void 0}}(),Qo=function(){return function(){this.cells=null}}(),Jo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.columnSpan=1,e.rowSpan=1,e}return Go(e,t),e}(Qr),$o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.rowId=0,e.columnId=0,e.rowSpan=1,e.columnSpan=1,e}return Go(e,t),e}(Ar),tn=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),en=function(t,e,i,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},rn=function(t){switch(t.type){case"Basic":return ln;case"Flow":return cn;case"Path":return nn;case"Image":return hn;case"Text":return dn;case"Bpmn":return xn;case"Native":return an;case"HTML":return sn;case"UmlActivity":return Sn;case"UmlClassifier":return In;case"SwimLane":return Rn;default:return ln}},on=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("Basic")],i.prototype,"type",void 0),i}(e.ChildProperty),nn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("Path")],i.prototype,"type",void 0),en([e.Property("")],i.prototype,"data",void 0),i}(on),an=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("Native")],i.prototype,"type",void 0),en([e.Property("")],i.prototype,"content",void 0),en([e.Property("Stretch")],i.prototype,"scale",void 0),i}(on),sn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("HTML")],i.prototype,"type",void 0),en([e.Property("")],i.prototype,"content",void 0),i}(on),hn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("Image")],i.prototype,"type",void 0),en([e.Property("")],i.prototype,"source",void 0),en([e.Property("")],i.prototype,"scale",void 0),en([e.Property("None")],i.prototype,"align",void 0),i}(on),dn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("Text")],i.prototype,"type",void 0),en([e.Property("")],i.prototype,"content",void 0),en([e.Complex({},Er)],i.prototype,"margin",void 0),i}(on),ln=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("Basic")],i.prototype,"type",void 0),en([e.Property("Rectangle")],i.prototype,"shape",void 0),en([e.Property(0)],i.prototype,"cornerRadius",void 0),en([e.Collection([],wr)],i.prototype,"points",void 0),i}(on),cn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("Flow")],i.prototype,"type",void 0),en([e.Property("Terminator")],i.prototype,"shape",void 0),i}(on),pn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("None")],i.prototype,"type",void 0),i}(e.ChildProperty),gn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("None")],i.prototype,"type",void 0),en([e.Property(!1)],i.prototype,"collection",void 0),i}(e.ChildProperty),un=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("None")],i.prototype,"type",void 0),en([e.Property("None")],i.prototype,"loop",void 0),en([e.Property(!1)],i.prototype,"call",void 0),en([e.Property(!1)],i.prototype,"compensation",void 0),i}(e.ChildProperty),fn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("Start")],i.prototype,"event",void 0),en([e.Property("None")],i.prototype,"trigger",void 0),i}(e.ChildProperty),mn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("None")],i.prototype,"trigger",void 0),en([e.Property("Start")],i.prototype,"event",void 0),en([e.Property("")],i.prototype,"id",void 0),en([e.Complex({},wr)],i.prototype,"offset",void 0),en([e.Collection([],so)],i.prototype,"annotations",void 0),en([e.Collection([],io)],i.prototype,"ports",void 0),en([e.Property()],i.prototype,"width",void 0),en([e.Property()],i.prototype,"height",void 0),en([e.Complex({},Er)],i.prototype,"margin",void 0),en([e.Property("Center")],i.prototype,"horizontalAlignment",void 0),en([e.Property("Center")],i.prototype,"verticalAlignment",void 0),en([e.Property(!0)],i.prototype,"visible",void 0),i}(e.ChildProperty),yn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Complex({id:"success",event:"End",offset:{x:1,y:.5}},mn)],i.prototype,"success",void 0),en([e.Complex({id:"failure",event:"Intermediate",trigger:"Error",offset:{x:.25,y:1}},mn)],i.prototype,"failure",void 0),en([e.Complex({id:"cancel",event:"Intermediate",trigger:"Cancel",offset:{x:.75,y:1}},mn)],i.prototype,"cancel",void 0),i}(e.ChildProperty),vn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("None")],i.prototype,"type",void 0),en([e.Property(!1)],i.prototype,"adhoc",void 0),en([e.Property("Default")],i.prototype,"boundary",void 0),en([e.Property(!1)],i.prototype,"compensation",void 0),en([e.Property("None")],i.prototype,"loop",void 0),en([e.Property(!0)],i.prototype,"collapsed",void 0),en([e.Collection([],mn)],i.prototype,"events",void 0),en([e.Complex({},yn)],i.prototype,"transaction",void 0),en([e.Property(void 0)],i.prototype,"processes",void 0),i}(e.ChildProperty),bn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("Task")],i.prototype,"activity",void 0),en([e.Complex({},un)],i.prototype,"task",void 0),en([e.Complex({},vn)],i.prototype,"subProcess",void 0),i}(e.ChildProperty),wn=function(t){function i(e,i,r,o){return t.call(this,e,i,r,o)||this}return tn(i,t),en([e.Property("")],i.prototype,"text",void 0),en([e.Property("")],i.prototype,"id",void 0),en([e.Property(0)],i.prototype,"angle",void 0),en([e.Property()],i.prototype,"height",void 0),en([e.Property()],i.prototype,"width",void 0),en([e.Property(0)],i.prototype,"length",void 0),i}(e.ChildProperty),xn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("Bpmn")],i.prototype,"type",void 0),en([e.Property("Event")],i.prototype,"shape",void 0),en([e.Complex({},fn)],i.prototype,"event",void 0),en([e.Complex({},pn)],i.prototype,"gateway",void 0),en([e.Complex({},gn)],i.prototype,"dataObject",void 0),en([e.Complex({},bn)],i.prototype,"activity",void 0),en([e.Complex({},wn)],i.prototype,"annotation",void 0),en([e.Collection([],wn)],i.prototype,"annotations",void 0),i}(on),Sn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("UmlActivity")],i.prototype,"type",void 0),en([e.Property("Action")],i.prototype,"shape",void 0),i}(on),Pn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("")],i.prototype,"name",void 0),en([e.Property("")],i.prototype,"type",void 0),en([e.Complex({},Hr)],i.prototype,"style",void 0),i}(e.ChildProperty),Cn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("Public")],i.prototype,"scope",void 0),en([e.Property(!1)],i.prototype,"isSeparator",void 0),i}(Pn),Tn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Collection([],Pn)],i.prototype,"parameters",void 0),i}(Cn),An=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("")],i.prototype,"name",void 0),en([e.Collection([],Cn)],i.prototype,"attributes",void 0),en([e.Collection([],Tn)],i.prototype,"methods",void 0),en([e.Complex({},Hr)],i.prototype,"style",void 0),i}(e.ChildProperty),Mn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property(!1)],i.prototype,"isSeparator",void 0),i}(An),Ln=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("")],i.prototype,"name",void 0),en([e.Property("")],i.prototype,"value",void 0),en([e.Property(!1)],i.prototype,"isSeparator",void 0),en([e.Complex({},Hr)],i.prototype,"style",void 0),i}(e.ChildProperty),On=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("")],i.prototype,"name",void 0),en([e.Collection([],Ln)],i.prototype,"members",void 0),en([e.Complex({},Hr)],i.prototype,"style",void 0),i}(e.ChildProperty),In=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("UmlClassifier")],i.prototype,"type",void 0),en([e.Complex({},An)],i.prototype,"class",void 0),en([e.Complex({},Mn)],i.prototype,"interface",void 0),en([e.Complex({},On)],i.prototype,"enumeration",void 0),en([e.Property("Class")],i.prototype,"classifier",void 0),i}(on),En=function(i){function r(t,e,r,o){var n=i.call(this,t,e,r,o)||this;n.isCanvasUpdate=!1,n.status="None",n.parentId="",n.processId="",n.umlIndex=-1,n.outEdges=[],n.inEdges=[],n.isHeader=!1,n.isLane=!1,n.isPhase=!1;var a;return n.children&&n.children.length>0&&((a=r).style&&a.style.fill||(n.style.fill="transparent"),a.style&&a.style.strokeColor||(n.style.strokeColor="transparent")),n.shape&&"UmlActivity"===n.shape.type&&Pe(r,n),n}return tn(r,i),Object.defineProperty(r.prototype,"actualSize",{get:function(){return null!==this.wrapper?this.wrapper.actualSize:new yr(this.width||0,this.height||0)},enumerable:!0,configurable:!0}),r.prototype.init=function(e){var i;i="SwimLane"!=this.shape.type?new Ar:new Zo;var r;switch(this.shape.changedProperties={},this.shape.oldProperties={},this.shape.type){case"Path":var o=new Yr;o.data=this.shape.data,i=o;break;case"Image":var n=new qr;n.source=this.shape.source,n.imageAlign=this.shape.align,n.imageScale=this.shape.scale,i=n;break;case"Text":var a=new Gr;a.content=this.shape.content,i=a,r=this.style,i.style=r;break;case"Basic":if("Rectangle"===this.shape.shape){(i=d=new Ar).cornerRadius=this.shape.cornerRadius}else if("Polygon"===this.shape.shape){var s=new Yr;s.data=h(this.shape.points),i=s}else{var d=new Yr,l=T(this.shape.shape);d.data=l,i=d}break;case"Flow":var c=new Yr,p=O(this.shape.shape);c.data=p,i=c;break;case"UmlActivity":i=qe(new Yr,i,this);break;case"Bpmn":if(e.bpmnModule){i=e.bpmnModule.initBPMNContent(i,this,e);var g=this.shape.activity.subProcess;if(g.processes&&g.processes.length)for(var u=0,f=this.shape.activity.subProcess.processes;u<f.length;u++){var m=f[u];!e.nameTable[m]||e.nameTable[m].processId&&e.nameTable[m].processId!==this.id||(e.nameTable[m].processId=this.id,g.collapsed&&e.updateElementVisibility(e.nameTable[m].wrapper,e.nameTable[m],!g.collapsed),i.children.push(e.nameTable[m].wrapper))}}break;case"Native":var y=new Ur(this.id,e.element.id);y.content=this.shape.content,y.scale=this.shape.scale,i=y;break;case"HTML":var v=new Po(this.id,e.element.id);v.content=this.shape.content,i=v;break;case"UmlClassifier":i=Ft(i,this,e);break;case"SwimLane":i.cellStyle.fill="none",i.cellStyle.strokeColor="none",this.container={type:"Grid",orientation:this.shape.orientation},i.id=this.id,this.container.orientation=this.shape.orientation,oe(i,e,this)}return i.id=this.id+"_content",i.relativeMode="Object",void 0!==this.width&&(i.width=this.width),i.horizontalAlignment="Stretch",void 0!==this.height&&(i.height=this.height),void 0!==this.minHeight&&(i.minHeight=this.minHeight),void 0!==this.maxHeight&&(i.maxHeight=this.maxHeight),void 0!==this.minWidth&&(i.minWidth=this.minWidth),void 0!==this.maxWidth&&(i.maxWidth=this.maxWidth),"Rectangle"!==this.shape.shape||this.shape.cornerRadius||(i.isRectElement=!0),i.verticalAlignment="Stretch",this.shape instanceof dn&&(i.margin=this.shape.margin),Lt(this)&&0!=(this.constraints&t.NodeConstraints.Shadow)&&(i.shadow=this.shadow),"Bpmn"===this.shape.type&&"Message"!==this.shape.shape&&"DataSource"!==this.shape.shape||"UmlActivity"===this.shape.type&&"FinalNode"===this.shape.shape||"Text"!==this.shape.type&&(i.style=this.style),i},r.prototype.initContainer=function(){this.id||(this.id=Hi());var t;if(this.container)switch(this.container.type){case"Canvas":t=new Qr;break;case"Stack":t=new Fo;break;case"Grid":(t=new Zo).setDefinitions(this.rows,this.columns)}else t=this.children?new _r:new Qr;return t.id=this.id,t.offsetX=this.offsetX,t.offsetY=this.offsetY,t.visible=this.visible,t.horizontalAlignment=this.horizontalAlignment,t.verticalAlignment=this.verticalAlignment,this.container&&(t.width=this.width,t.height=this.height,"Stack"===this.container.type&&(t.orientation=this.container.orientation)),t.style.fill=this.backgroundColor,t.style.strokeColor=this.borderColor,t.style.strokeWidth=this.borderWidth,t.rotateAngle=this.rotateAngle,t.minHeight=this.minHeight,t.minWidth=this.minWidth,t.maxHeight=this.maxHeight,t.maxWidth=this.maxWidth,t.pivot=this.pivot,t.margin=this.margin,this.wrapper=t,t},r.prototype.initPorts=function(t,e){this.wrapper;for(var i,r=0;this.ports,r<this.ports.length;r++){i=this.initPortWrapper(this.ports[r]);var o=void 0,n=ir(t);n&&(o=n(i,this)),i.description=o||i.id,e.children.push(i)}},r.prototype.getIconOffet=function(t,e){var i,r;return"BottomToTop"===t.orientation?(i=e.offset.x,r=1-e.offset.y):"LeftToRight"===t.orientation?(i=e.offset.y,r=e.offset.x):"RightToLeft"===t.orientation?(i=1-e.offset.y,r=e.offset.x):(i=e.offset.x,r=e.offset.y),{x:i,y:r}},r.prototype.initIcons=function(t,e,i,r){this.wrapper;var o,n=this.isExpanded?this.expandIcon:this.collapseIcon;if("None"!==n.shape){var a=new Qr;a.float=!0;a.id=this.id+"_icon_content",a.children=[],a.height=n.height,a.width=n.width,a.style.strokeColor="transparent",a.margin=n.margin,a.horizontalAlignment="Center",a.verticalAlignment="Center",a.visible=this.visible,o=this.getIconOffet(e,n),a.setOffsetWithRespectToBounds(o.x,o.y,"Fraction"),a.relativeMode="Point",this.initIconSymbol(n,a,t,r);var s=void 0,h=ir(t);h&&(s=h(n,this)),a.description=s||a.id,i.children.push(a)}},r.prototype.initAnnotations=function(t,e,i,r){for(var o,n=0;this.annotations,n<this.annotations.length;n++){o=this.initAnnotationWrapper(this.annotations[n],i,r);var a=void 0,s=ir(t);s&&(a=s(o,this)),o.description=a||o.id,e.children.push(o)}},r.prototype.initPortWrapper=function(e){e.id=e.id||Hi();var i=new Yr;i.height=e.height,i.width=e.width;var r="Custom"===e.shape?e.pathData:A(e.shape);i.id=this.id+"_"+e.id,i.margin=e.margin,i.data=r;var o=e.style;return i.style={fill:o.fill,strokeColor:o.strokeColor,gradient:null,opacity:o.opacity,strokeDashArray:o.strokeDashArray,strokeWidth:o.strokeWidth},i.horizontalAlignment=e.horizontalAlignment,i.verticalAlignment=e.verticalAlignment,i.setOffsetWithRespectToBounds(e.offset.x,e.offset.y,"Fraction"),void 0===this.width&&void 0===this.height||(i.float=!0),i.relativeMode="Point",i.visible=!(!ei(e,t.PortVisibility.Visible)||ei(e,t.PortVisibility.Hover)||ei(e,t.PortVisibility.Connect)),i},r.prototype.initAnnotationWrapper=function(t,e,i){t.id=t.id||Hi();var r,o=t;if(e&&t.template)(r=new Po(this.id,e,t.id)).content=t.template;else{(r=new Gr).canMeasure=!i;var n=t.style,a=t.hyperlink.link?t.hyperlink:void 0;r.style={fill:n.fill,strokeColor:n.strokeColor,strokeWidth:n.strokeWidth,bold:n.bold,textWrapping:n.textWrapping,color:a?a.color||r.hyperlink.color:n.color,whiteSpace:n.whiteSpace,fontFamily:n.fontFamily,fontSize:n.fontSize,italic:n.italic,gradient:null,opacity:n.opacity,strokeDashArray:n.strokeDashArray,textAlign:n.textAlign,textOverflow:t.style.textOverflow,textDecoration:a?a.textDecoration||r.hyperlink.textDecoration:n.textDecoration},r.hyperlink.link=t.hyperlink.link||void 0,r.hyperlink.content=t.hyperlink.content||void 0,r.hyperlink.textDecoration=t.hyperlink.textDecoration||void 0,r.content=a?a.content||r.hyperlink.link:t.content}return r.constraints=t.constraints,r.height=t.height,r.width=t.width,r.visible=t.visibility,r.rotateAngle=t.rotateAngle,r.id=this.id+"_"+t.id,void 0===this.width||t.template||(void 0===t.width||t.width>this.width&&("Wrap"===t.style.textWrapping||"WrapWithOverflow"===t.style.textWrapping))&&(r.width=this.width),r.margin=t.margin,r.horizontalAlignment=t.horizontalAlignment,r.verticalAlignment=t.verticalAlignment,r.setOffsetWithRespectToBounds(o.offset.x,o.offset.y,"Fraction"),void 0===this.width&&void 0===this.height||(r.float=!0),r.relativeMode="Point",r},r.prototype.initIconContainer=function(t,e){var i=new Ar;return i.id=e.id+"_rect",i.height=t.height,i.width=t.width,i.visible=e.visible,i.margin=t.margin,i.cornerRadius=t.cornerRadius,i.style={fill:t.fill,strokeColor:t.borderColor,strokeWidth:t.borderWidth},i.setOffsetWithRespectToBounds(.5,.5,"Fraction"),i.horizontalAlignment="Center",i.verticalAlignment="Center",i.relativeMode="Object",i.description=i.description||"Click here to expand or collapse",i},r.prototype.initIconSymbol=function(t,e,i,r){var o;if(e.children.push(this.initIconContainer(t,e)),"Template"===t.shape)(o=new Ur(this.id,r)).content=t.content,o.height=10,o.width=10;else{(o=new Yr).data=L(t);var n=fi(o.data);o.height=n.height<10?n.height:10-(t.padding.bottom+t.padding.top),o.width=n.width<10?n.width:10-(t.padding.left+t.padding.right)}o.id=e.id+"_shape",o.horizontalAlignment="Center",o.verticalAlignment="Center",o.visible=e.visible,o.visible=e.visible,o.style={fill:"black",strokeColor:t.borderColor,strokeWidth:t.borderWidth},o.setOffsetWithRespectToBounds(.5,.5,"Fraction"),o.relativeMode="Object",o.description=e.description||"Click here to expand or collapse",e.children.push(o)},en([e.Collection([],so)],r.prototype,"annotations",void 0),en([e.Property(0)],r.prototype,"offsetX",void 0),en([e.Property(0)],r.prototype,"offsetY",void 0),en([e.Complex({x:.5,y:.5},wr)],r.prototype,"pivot",void 0),en([e.Property()],r.prototype,"width",void 0),en([e.Property()],r.prototype,"height",void 0),en([e.Property()],r.prototype,"minWidth",void 0),en([e.Property()],r.prototype,"minHeight",void 0),en([e.Property()],r.prototype,"maxWidth",void 0),en([e.Property()],r.prototype,"maxHeight",void 0),en([e.Property(0)],r.prototype,"rotateAngle",void 0),en([e.Complex({},Hr)],r.prototype,"style",void 0),en([e.Property("transparent")],r.prototype,"backgroundColor",void 0),en([e.Property("none")],r.prototype,"borderColor",void 0),en([e.Property(0)],r.prototype,"borderWidth",void 0),en([e.Property()],r.prototype,"data",void 0),en([e.ComplexFactory(rn)],r.prototype,"shape",void 0),en([e.Property(null)],r.prototype,"wrapper",void 0),en([e.Property(t.NodeConstraints.Default)],r.prototype,"constraints",void 0),en([e.Complex({},zr)],r.prototype,"shadow",void 0),en([e.Property()],r.prototype,"children",void 0),en([e.Property(null)],r.prototype,"container",void 0),en([e.Property("Left")],r.prototype,"horizontalAlignment",void 0),en([e.Property("Top")],r.prototype,"verticalAlignment",void 0),en([e.Property()],r.prototype,"rows",void 0),en([e.Property()],r.prototype,"columns",void 0),en([e.Property()],r.prototype,"rowIndex",void 0),en([e.Property()],r.prototype,"columnIndex",void 0),en([e.Property()],r.prototype,"rowSpan",void 0),en([e.Property()],r.prototype,"columnSpan",void 0),r}(xo),zn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("")],i.prototype,"id",void 0),en([e.Complex({},ao)],i.prototype,"content",void 0),en([e.Property("")],i.prototype,"style",void 0),en([e.Property(25)],i.prototype,"height",void 0),en([e.Property(25)],i.prototype,"width",void 0),i}(e.ChildProperty),Dn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("")],i.prototype,"id",void 0),en([e.Property("")],i.prototype,"style",void 0),en([e.Collection([],En)],i.prototype,"childNodes",void 0),en([e.Property(25)],i.prototype,"height",void 0),en([e.Property(25)],i.prototype,"width",void 0),en([e.Complex({},zn)],i.prototype,"header",void 0),i}(e.ChildProperty),kn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("")],i.prototype,"id",void 0),en([e.Property("")],i.prototype,"style",void 0),en([e.Complex({},zn)],i.prototype,"header",void 0),en([e.Property(30)],i.prototype,"height",void 0),en([e.Property(30)],i.prototype,"width",void 0),en([e.Property(100)],i.prototype,"offset",void 0),i}(e.ChildProperty),Rn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tn(i,t),en([e.Property("SwimLane")],i.prototype,"type",void 0),en([e.Property("10")],i.prototype,"phaseSize",void 0),en([e.Collection([],kn)],i.prototype,"phases",void 0),en([e.Property("Horizontal")],i.prototype,"orientation",void 0),en([e.Collection([],Dn)],i.prototype,"lanes",void 0),en([e.Complex({},zn)],i.prototype,"header",void 0),en([e.Property("")],i.prototype,"lineStyle",void 0),en([e.Property(!1)],i.prototype,"isLane",void 0),en([e.Property(!1)],i.prototype,"isPhase",void 0),i}(on),Nn=function(){function t(){}return en([e.Property("Canvas")],t.prototype,"type",void 0),en([e.Property("Vertical")],t.prototype,"orientation",void 0),t}(),Bn=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),jn=function(t,e,i,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},Hn=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.offset=0,r.scale=1,r}return Bn(i,t),i.prototype.preRender=function(){this.unWireEvents(),this.wireEvents()},i.prototype.render=function(){this.updateRulerGeometry()},i.prototype.getModuleName=function(){return"Ruler"},i.prototype.destroy=function(){this.unWireEvents(),this.notify("destroy",{}),t.prototype.destroy.call(this),this.element.classList.remove("e-ruler")},i.prototype.getPersistData=function(){return this.addOnPersist(["loaded"])},i.prototype.onPropertyChanged=function(t,e){for(var i=0,r=Object.keys(t);i<r.length;i++){switch(r[i]){case"length":case"interval":case"segmentWidth":case"tickAlignment":case"markerColor":case"thickness":this.updateRuler()}}},i.prototype.updateRulerGeometry=function(){this.element.style.textAlign="left",this.renderRulerSpace(),this.updateRuler()},i.prototype.renderRulerSpace=function(){var t=this.getRulerGeometry(),e=document.getElementById(this.element.id+"_ruler_space");return e||(e=Oi("div",{id:this.element.id+"_ruler_space",style:"height:"+t.height+"px;width:"+t.width+"px;cssFloat:left;"}),this.element.appendChild(e)),e},i.prototype.updateRuler=function(){var t=this.getRulerSize(),e=this.getRulerGeometry(),i=0,r=0,o=new yr,n=this.getRulerSVG(e);if(n&&(i=this.length,o.height=t,r=this.offset,i&&i!==1/0)){var a=i+this.segmentWidth,s=r;this.updateSegments(s,a+Math.abs(s),n,t)}},i.prototype.updateSegments=function(t,e,i,r){for(var o=t,n={trans:0};o<e;){var a=this.getNewSegment(o,i);a&&(i.appendChild(a.segment),o=this.updateSegment(t,e,a,o,n,r))}},i.prototype.updateSegment=function(t,e,i,r,o,n){var a=this.updateSegmentWidth(this.scale);r===t?(this.startValue=Math.floor(t/a)*a/this.scale,this.startValue=this.startValue%1!=0?Number(this.startValue.toFixed(1)):this.startValue,i.label.textContent=this.startValue.toString(),this.defStartValue=r=this.startValue*this.scale,"Horizontal"===this.orientation?this.hRulerOffset=t-r:this.vRulerOffset=t-r):(this.startValue=r/this.scale,this.startValue=this.startValue%1!=0?Number(this.startValue.toFixed(1)):this.startValue,i.label.textContent=this.startValue.toString()),this.updateTickLabel(i,n);var s="Horizontal"===this.orientation?o.trans+.5+",0.5":"0.5,"+(o.trans+.5);return i.segment.setAttribute("transform","translate("+s+")"),o.trans+=a,r+=a},i.prototype.updateTickLabel=function(t,e){var i=t.segment.lastChild.getBBox(),r="Horizontal"===this.orientation,o="RightOrBottom"===this.tickAlignment,n=r?2:0,a=r?o?e/2+5.5-5.5:e/2+5.5:i.height,s=o?-(i.width+2)+","+(e/2-i.height):-(i.width+2)+","+(e/2-i.height/2),h=r?{x:n,y:a}:{x:n,y:a,transform:"rotate(270)translate("+s+")"};Ni(t.segment.lastChild,h)},i.prototype.getNewSegment=function(t,e){var i=this.createNewTicks(t,e);return{segment:i,label:this.createTickLabel(e,i)}},i.prototype.createNewTicks=function(t,e){var i,r,o,n=this.updateSegmentWidth(this.scale);o=Ii("g",{class:"e-ruler-segment"});for(var a=0;a<this.interval;a++)r=n/this.interval,i=this.createTick(e,r,a+1,t),o.appendChild(i);return o},i.prototype.getLinePoint=function(t,e,i){var r=this.updateSegmentWidth(this.scale),o=this.getRulerSize();return e*=i-1,i=e%r==0?o:.3*o},i.prototype.createTick=function(t,e,i,r){var o,n,a,s=this.getLinePoint(t,e,i),h=this.getRulerSize(),d="Horizontal"===this.orientation,l="RightOrBottom"===this.tickAlignment,c=ir(this.arrangeTick);n={ruler:void 0,tickLength:s,tickInterval:this.segmentWidth/this.interval*(i-1)},c&&c(n),s=n.tickLength;var p=e*(i-1);return a={x1:d?p:l?h:0,y1:d?l?h:h-(h-s):p,x2:d?p:l?h-s:h-(h-s),y2:d?l?h-s:0:p,"stroke-width":"1",stroke:"black"},(o=Ii("line",a)).setAttribute("class","e-ruler-tick"),o},i.prototype.createTickLabel=function(t,e){var i;if(e){i=Ii("text",{class:"e-ruler-tick-label"}),e.appendChild(i)}return i},i.prototype.updateSegmentWidth=function(t){if(100!==this.segmentWidth)return this.segmentWidth;var e,i=1;for(e=100,e=100/Math.pow(2,Math.round(Math.log(t)/Math.log(2)));e>100;)i/=10,e/=10;for(;e<25;)i*=10,e*=10;return e>=25&&e%25!=0&&(e=25*Math.round(e/25)),e*t/i},i.prototype.createMarkerLine=function(t,e,i){var r;return e&&((r=t.getElementById(e.id+"_marker"))&&r.parentNode.removeChild(r),r=Ii("line",i)),r},i.prototype.drawRulerMarker=function(t,e,i){var r,o,n,a,s,h,d,l="Horizontal"===this.orientation,c=t.getElementsByTagName("svg");for(s=0;s<c.length;s++){c[s]&&(r=c[s]);break}if(r){o=this.getRulerSize(),h={id:t.id+"_marker",x1:0,y1:0,x2:l?0:o,y2:l?o:0,stroke:this.markerColor,"stroke-width":1.5,class:"e-d-ruler-marker"},d=this.createMarkerLine(r,t,h),n=this.scale,a=this.offset-this.defStartValue;var p=(l?e.x:e.y)*n+i+a;d.setAttribute("transform","translate("+(l?p+.5+" 0.5":"0.5 "+(p+.5))+")"),r.appendChild(d)}},i.prototype.getRulerGeometry=function(){return new yr(this.element?this.element.getBoundingClientRect().width:0,this.element?this.element.getBoundingClientRect().height:0)},i.prototype.getRulerSize=function(){return this.thickness},i.prototype.getRulerSVG=function(t){var e,i,r=this.getRulerSize();if(this.element&&(e=document.getElementById(this.element.id+"_ruler_space"))){if(i=Ii("svg",{id:this.element.id+"_Ruler_svg",width:"Horizontal"===this.orientation?t.width+200:r+"px",height:"Horizontal"===this.orientation?r:t.height+200+"px",style:"position:inherit;"}),e.childNodes.length>0)for(var o=e.childNodes.length-1;o>=0;o--)e.childNodes[o].parentNode.removeChild(e.childNodes[o]);e.appendChild(i)}return i},i.prototype.wireEvents=function(){},i.prototype.unWireEvents=function(){},jn([e.Property(5)],i.prototype,"interval",void 0),jn([e.Property(100)],i.prototype,"segmentWidth",void 0),jn([e.Property("Horizontal")],i.prototype,"orientation",void 0),jn([e.Property("RightOrBottom")],i.prototype,"tickAlignment",void 0),jn([e.Property("red")],i.prototype,"markerColor",void 0),jn([e.Property(25)],i.prototype,"thickness",void 0),jn([e.Property(null)],i.prototype,"arrangeTick",void 0),jn([e.Property(400)],i.prototype,"length",void 0),i}(e.Component),Wn={Action:"M 90 82.895 C 90 86.819 86.776 90 82.8 90 H 7.2 C 3.224 90 0 86.819 0 82.895 V 7.105 C 0 3.181 3.224 0 7.2 0 h 75.6 C 86.776 0 90 3.181 90 7.105 V 82.895 Z",Decision:"M10,19.707L0.293,10L10,0.293L19.707,10L10,19.707z",MergeNode:"M10,19.707L0.293,10L10,0.293L19.707,10L10,19.707z",InitialNode:"M10,19.5c-5.238,0-9.5-4.262-9.5-9.5S4.762,0.5,10,0.5s9.5,4.262,9.5,9.5S15.238,19.5,10,19.5z",ForkNode:"m0.75,0.75l636.00002,0l0,290l-636.00002,0l0,-290z",JoinNode:"m0.75,0.75l636.00002,0l0,290l-636.00002,0l0,-290z",TimeEvent:"M50.001,0.00286865 L25.001,25.0029 L0.000976562,0.00286865 L50.001,0.00286865 z M0.000976562,50.0029 L25.001,25.0029 L50.001,50.0029 L0.000976562,50.0029 z",AcceptingEvent:"M17.8336 32.164 L29.64 24 L17.32 16 L48.1664 16 L48.5 32 Z",SendSignal:"M48.164 31.8336 L56 23.832 L47.836 16 L16.168 16 L16.1668 31.8336 Z",ReceiveSignal:"M48.1664 31.8336 L39.836 24 L47.836 16 L16.168 16 L16.168 31.836 Z",StructuredNode:"M0,0 L50,0 L50,50 L0,50 z",Note:"M20 12 L4 12 L4 22 L22 22 L22 14 L20 14 L20 12 L22 14 Z"},_n=function(t){return t&&(t=void 0!==t.sourceID||void 0!==t.sourcePoint||void 0!==t.targetID||void 0!==t.targetPoint||void 0!==t.type?Wo:En),t},Xn=function(){function t(){}return t.getContext=function(t){return t.getContext("2d")},t.setCanvasSize=function(t,e,i){t&&(t.setAttribute("width",e.toString()),t.setAttribute("height",i.toString()))},t.prototype.renderGradient=function(t,e,i,r){var o,n,a;if("None"!==t.gradient.type){for(var s=0;s<t.gradient.stops.length;s++)o=void 0!==o?t.gradient.stops[s].offset:Math.max(o,t.gradient.stops[s].offset),n=void 0!==n?t.gradient.stops[s].offset:Math.min(n,t.gradient.stops[s].offset);if("Linear"===t.gradient.type){var h=t.gradient;a=e.createLinearGradient(i+h.x1,r+h.y1,i+h.x2,r+h.y2)}else{var d=t.gradient;a=e.createRadialGradient(i+d.fx,r+d.fy,0,i+d.cx,r+d.cy,d.r)}for(s=0;s<t.gradient.stops.length;s++){var l=t.gradient.stops[s],c=n<0?(o+l.offset)/(2*o):l.offset/o;a.addColorStop(c,l.color)}e.fillStyle=a}return e},t.prototype.renderShadow=function(e,i,r){void 0===r&&(r=null);var o=t.getContext(i);o.save(),o.beginPath(),o.strokeStyle=o.fillStyle=e.shadow.color,o.globalAlpha=e.shadow.opacity;var n=wr.transform({x:0,y:0},e.shadow.angle,e.shadow.distance),a=e.x+n.x,s=e.y+n.y,h=a+e.width*e.pivotX,d=s+e.height*e.pivotY;this.rotateContext(i,e.angle,h,d),r?(o.translate(a,s),this.renderPath(i,e,r),o.translate(-a,-s)):(o.rect(a,s,e.width,e.height),o.fillRect(a,s,e.width,e.height)),o.fill(),o.stroke(),o.closePath(),o.restore()},t.createCanvas=function(t,e,i){var r=Oi("canvas",{id:t});return this.setCanvasSize(r,e,i),r},t.prototype.setStyle=function(e,i){var r=t.getContext(e);"none"===i.fill&&(i.fill="transparent"),"none"===i.stroke&&(i.stroke="transparent"),r.strokeStyle=i.stroke,r.lineWidth=i.strokeWidth,0===i.strokeWidth&&(r.strokeStyle="transparent"),r.globalAlpha=i.opacity;var o=[];i.dashArray&&(o=this.parseDashArray(i.dashArray)),r.setLineDash(o),i.gradient&&"None"!==i.gradient.type?this.renderGradient(i,r,0,0):r.fillStyle=i.fill},t.prototype.rotateContext=function(e,i,r,o){var n=t.getContext(e);n.translate(r,o),n.rotate(i*Math.PI/180),n.translate(-r,-o)},t.prototype.setFontStyle=function(e,i){var r=t.getContext(e),o="";i.italic&&(o+="italic "),i.bold&&(o+="bold "),o+=i.fontSize+"px ",o+=i.fontFamily,r.font=o},t.prototype.parseDashArray=function(t){for(var e=[],i=-1!==t.indexOf(" ")?" ":",",r=0,o=t.split(i);r<o.length;r++){var n=o[r];e.push(Number(n))}return e},t.prototype.drawRectangle=function(e,i){if(!0===i.visible)if(i.cornerRadius)i.data=s(i.cornerRadius,i.height,i.width),this.drawPath(e,i);else{var r=t.getContext(e);i.shadow&&this.renderShadow(i,e),r.save(),r.beginPath();i.cornerRadius;var o=i.x+i.width*i.pivotX,n=i.y+i.height*i.pivotY;this.rotateContext(e,i.angle,o,n),this.setStyle(e,i),r.rect(i.x,i.y,i.width,i.height),r.fillRect(i.x,i.y,i.width,i.height),r.fill(),r.stroke(),r.closePath(),r.restore()}},t.prototype.drawPath=function(e,i){var r=[];r=d(r=n(i.data)),i.shadow&&this.renderShadow(i,e,r);var o=t.getContext(e);o.save(),o.beginPath();var a=i.y+i.height*i.pivotY,s=i.x+i.width*i.pivotX;this.rotateContext(e,i.angle,s,a),this.setStyle(e,i),o.translate(i.x,i.y),this.renderPath(e,i,r),o.fill(),o.translate(-i.x,-i.y),o.stroke(),o.restore()},t.prototype.renderPath=function(e,i,r){if(!0===i.visible){var o,n=t.getContext(e),a=void 0,s=void 0,h=void 0,d=void 0,l=void 0,c=void 0,p=void 0,g=void 0,u=void 0,f=r;for(p=0,g=0,u=0,o=f.length;u<o;++u){var m=f[u],y=m.command;switch("x1"in m&&(h=m.x1),"x2"in m&&(l=m.x2),"y1"in m&&(d=m.y1),"y2"in m&&(c=m.y2),"x"in m&&(p=m.x),"y"in m&&(g=m.y),y){case"M":n.moveTo(p,g),m.x=p,m.y=g;break;case"L":n.lineTo(p,g),m.x=p,m.y=g;break;case"C":n.bezierCurveTo(h,d,l,c,p,g),m.x=p,m.y=g,m.x1=h,m.y1=d,m.x2=l,m.y2=c;break;case"Q":n.quadraticCurveTo(h,d,p,g),m.x=p,m.y=g,m.x1=h,m.y1=d;break;case"A":var v=a,b=s,w=m.r1,x=m.r2,S=m.angle*(Math.PI/180),P=m.largeArc,C=m.sweep,T=p,A=g,M={x:Math.cos(S)*(v-T)/2+Math.sin(S)*(b-A)/2,y:-Math.sin(S)*(v-T)/2+Math.cos(S)*(b-A)/2},L=Math.pow(M.x,2)/Math.pow(w,2)+Math.pow(M.y,2)/Math.pow(x,2);L>1&&(w*=Math.sqrt(L),x*=Math.sqrt(L));var O=Math.pow(x,2)*Math.pow(M.x,2),I=(P===C?-1:1)*Math.sqrt((Math.pow(w,2)*Math.pow(x,2)-Math.pow(w,2)*Math.pow(M.y,2)-O)/(Math.pow(w,2)*Math.pow(M.y,2)+Math.pow(x,2)*Math.pow(M.x,2)));isNaN(I)&&(I=0);var E=I*w*M.y/x,z=I*-x*M.x/w,D={x:(v+T)/2+Math.cos(S)*E-Math.sin(S)*z,y:(b+A)/2+Math.sin(S)*E+Math.cos(S)*z},k=this.a([1,0],[(M.x-E)/w,(M.y-z)/x]),R=[(M.x-E)/w,(M.y-z)/x],N=[(-M.x-E)/w,(-M.y-z)/x],B=this.a(R,N);if(this.r(R,N)<=-1&&(B=Math.PI),this.r(R,N)>=1&&(B=0),m.centp=D,m.xAxisRotation=S,m.rx=w,m.ry=x,m.a1=k,m.ad=B,m.sweep=C,null!=n){var j=w>x?w:x,H=w>x?1:w/x,W=w>x?x/w:1;n.save(),n.translate(D.x,D.y),n.rotate(S),n.scale(H,W),n.arc(0,0,j,k,k+B,!C),n.scale(1/H,1/W),n.rotate(-S),n.translate(-D.x,-D.y),n.restore()}break;case"Z":case"z":n.closePath(),p=a,g=s}a=p,s=g}}},t.prototype.drawText=function(e,i){if(i.content&&!0===i.visible){var r=t.getContext(e);r.save(),this.setStyle(e,i);var o=i.x+i.width*i.pivotX,n=i.y+i.height*i.pivotY;this.rotateContext(e,i.angle,o,n),this.setFontStyle(e,i);var a=0,s=[];s=i.childNodes;var h=i.wrapBounds;if(r.fillStyle=i.color,h){var d=this.labelAlign(i,h,s);for(a=0;a<s.length;a++){var l=s[a],c=d.x+l.x-h.x,p=d.y+l.dy*a+.8*i.fontSize;if(h.width>i.width&&"Wrap"!==i.textOverflow&&(l.text=Qi(l.text,i)),r.fillText(l.text,c,p),"Underline"===i.textDecoration||"Overline"===i.textDecoration||"LineThrough"===i.textDecoration){var g=c,u=void 0,f=c+r.measureText(l.text).width,m=void 0;switch(i.textDecoration){case"Underline":u=p+2,m=p+2;break;case"Overline":u=d.y+l.dy*a,m=d.y+l.dy*a;break;case"LineThrough":u=(p+d.y+l.dy*a)/2+2,m=(p+d.y+l.dy*a)/2+2}r.beginPath(),r.moveTo(g,u),r.lineTo(f,m),r.strokeStyle=i.color,r.lineWidth=.08*i.fontSize,r.globalAlpha=i.opacity,r.stroke()}}}r.restore()}},t.prototype.loadImage=function(t,e,i,r,o){this.rotateContext(i,e.angle,r,o);var n=new Image;n.src=e.source,this.image(t,n,e.x,e.y,e.width,e.height,e)},t.prototype.drawImage=function(e,i,r,o){var n=this;if(i.visible){var a=t.getContext(e);a.save();var s=i.x+i.width*i.pivotX,h=i.y+i.height*i.pivotY,d=new Image;d.src=i.source;var l=a.canvas.id.split("_");l[l.length-1];o?d.onload=function(){n.loadImage(a,i,e,s,h)}:this.loadImage(a,i,e,s,h),a.restore()}},t.prototype.image=function(t,e,i,r,o,n,a){t.beginPath();var s=e.width,h=e.height,d=o,l=n,c=0,p=0;if(a&&"None"!==a.alignment){var g=a.alignment.toLowerCase().substr(1,3),u=a.alignment.toLowerCase().substr(5,3);if("Slice"===a.scale){var f=function(){c=d,p=h*d/s},m=function(){c=s*l/h,p=l};d>l?(f(),l>p&&m()):d===l?s>h?m():f():(m(),d>c&&f());var y=this.getSliceOffset(g,c,d,s),v=this.getSliceOffset(u,p,l,h),b=s-y,w=h-v,x=c-y*(c/s),S=p-v*(p/h),P=Oi("canvas",{width:o.toString(),height:n.toString()});P.getContext("2d").drawImage(e,y,v,b,w,0,0,x,S),t.drawImage(P,i,r,o,n)}else if("Meet"===a.scale){var C=h/s,T=l/d;c=T>C?d:l/C,p=T>C?d*C:l,i+=this.getMeetOffset(g,c,d),r+=this.getMeetOffset(u,p,l),t.drawImage(e,0,0,s,h,i,r,c,p)}else t.drawImage(e,i,r,o,n)}else t.drawImage(e,i,r,o,n);t.closePath()},t.prototype.getSliceOffset=function(t,e,i,r){switch(t){case"min":return 0;case"mid":return(e-i)/2*r/e;case"max":return(e-i)*r/e;default:return 0}},t.prototype.getMeetOffset=function(t,e,i){var r=Math.max(e,i),o=Math.min(e,i);switch(t){case"min":return 0;case"mid":return(r-o)/2;case"max":return r-o;default:return 0}},t.prototype.m=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))},t.prototype.r=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(this.m(t)*this.m(e))},t.prototype.a=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(this.r(t,e))},t.prototype.labelAlign=function(t,e,i){var r=new yr(e.width,i.length*(1.2*t.fontSize)),o={x:0,y:0},n=t.x,a=t.y,s=.5*t.width,h=.5*t.height;return"left"===t.textAlign?s=0:"center"===t.textAlign?s=e.width>t.width&&("Ellipsis"===t.textOverflow||"Clip"===t.textOverflow)?0:.5*t.width:"right"===t.textAlign&&(s=1*t.width),o.x=n+s+(e?e.x:0),o.y=a+h-r.height/2,o},t}(),Yn=function(){function t(){}return t.prototype.renderShadow=function(t,e,i,r){void 0===i&&(i=null);var o,n,a=wr.transform({x:0,y:0},t.shadow.angle,t.shadow.distance),s=t.x+a.x,h=t.y+a.y;t.width,t.pivotX,t.height,t.pivotY;r&&(n=r.getElementById(e.id+"_shadow")),n||(o=i?"path":"rect",n=document.createElementNS("http://www.w3.org/2000/svg",o),e.appendChild(n));var d={id:e.id+"_shadow",fill:t.shadow.color,stroke:t.shadow.color,opacity:t.shadow.opacity.toString(),transform:"rotate("+t.angle+","+(t.x+t.width*t.pivotX)+","+(t.y+t.height*t.pivotY)+")translate("+(t.x+a.x)+","+(t.y+a.y)+")"};if(r){var l=r.getElementById(e.id);l&&l.insertBefore(n,l.firstChild)}Ni(n,d),i?i&&this.renderPath(n,t,i):Ni(n,{width:t.width,height:t.height})},t.prototype.parseDashArray=function(t){return[]},t.prototype.drawRectangle=function(t,e,i,r,o,n,a){e.shadow&&!r&&this.renderShadow(e,t,void 0,n);var s;s=e.id===t.id?e.id+"_container":e.id;var h;n&&(h=n.getElementById(s)),h&&!o||(h=document.createElementNS("http://www.w3.org/2000/svg","rect"),t.appendChild(h));var d;n&&!e.shadow&&(d=n.getElementById(e.id+"_groupElement_shadow"))&&d.parentNode.removeChild(d);var l={id:s,x:e.x.toString(),y:e.y.toString(),width:e.width.toString(),height:e.height.toString(),visibility:e.visible?"visible":"hidden",transform:"rotate("+e.angle+","+(e.x+e.width*e.pivotX)+","+(e.y+e.height*e.pivotY)+")",rx:e.cornerRadius||0,ry:e.cornerRadius||0,opacity:e.opacity,"aria-label":a||""};e.class&&(l.class=e.class);a||(l["pointer-events"]="none"),Ni(h,l),this.setSvgStyle(h,e,i)},t.prototype.updateSelectionRegion=function(t,e){var i;i=t.parentNode.getElementById(e.id);var r;r={id:e.id,x:e.x.toString(),y:e.y.toString(),width:e.width.toString(),height:e.height.toString(),transform:"rotate("+e.angle+","+(e.x+e.width*e.pivotX)+","+(e.y+e.height*e.pivotY)+")",class:"e-diagram-selected-region"},i||(i=document.createElementNS("http://www.w3.org/2000/svg","rect"),t.appendChild(i)),this.setSvgStyle(i,e),Ni(i,r)},t.prototype.createGElement=function(t,e){return Ii(t,e)},t.prototype.drawLine=function(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg","line");this.setSvgStyle(i,e);var r=e.x+e.width*e.pivotX,o=e.y+e.height*e.pivotY,n={id:e.id,x1:e.startPoint.x+e.x,y1:e.startPoint.y+e.y,x2:e.endPoint.x+e.x,y2:e.endPoint.y+e.y,stroke:e.stroke,"stroke-width":e.strokeWidth.toString(),opacity:e.opacity.toString(),transform:"rotate("+e.angle+" "+r+" "+o+")",visibility:e.visible?"visible":"hidden"};e.class&&(n.class=e.class),Ni(i,n),t.appendChild(i)},t.prototype.drawCircle=function(t,e,i,r){var o=document.createElementNS("http://www.w3.org/2000/svg","circle");this.setSvgStyle(o,e);var n=e.class||"";i||(n+=" e-disabled");var a={id:e.id,cx:e.centerX,cy:e.centerY,r:e.radius,visibility:e.visible?"visible":"hidden",class:n,"aria-label":r?r["aria-label"]:""};o.style.display=e.visible?"block":"none",Ni(o,a),t.appendChild(o)},t.prototype.drawPath=function(t,e,i,r,o,a){var s=Math.floor(10*Math.random()+1);t.id,s.toString();var h=[];h=d(h=n(e.data)),e.shadow&&this.renderShadow(e,t,h,o);var l;o&&!e.shadow&&(l=o.getElementById(e.id+"_groupElement_shadow"))&&l.parentNode.removeChild(l);var c;o&&(c=o.getElementById(e.id)),c&&!r||(c=document.createElementNS("http://www.w3.org/2000/svg","path"),t.appendChild(c)),this.renderPath(c,e,h);var p={id:e.id,transform:"rotate("+e.angle+","+(e.x+e.width*e.pivotX)+","+(e.y+e.height*e.pivotY)+")translate("+e.x+","+e.y+")",visibility:e.visible?"visible":"hidden",opacity:e.opacity,"aria-label":a||""};e.class&&(p.class=e.class),Ni(c,p),this.setSvgStyle(c,e,i)},t.prototype.renderPath=function(t,e,i){var r,o,n,a,s,h,d,l,c=i,p="";for(s=0,h=0,l=0,d=c.length;l<d;++l){var g=c[l],u=g.command;switch("x1"in g&&(r=g.x1),"x2"in g&&(n=g.x2),"y1"in g&&(o=g.y1),"y2"in g&&(a=g.y2),"x"in g&&(s=g.x),"y"in g&&(h=g.y),u){case"M":p=p+"M"+s.toString()+","+h.toString()+" ";break;case"L":p=p+"L"+s.toString()+","+h.toString()+" ";break;case"C":p=p+"C"+r.toString()+","+o.toString()+","+n.toString()+","+a.toString()+",",p+=s.toString()+","+h.toString()+" ";break;case"Q":p=p+"Q"+r.toString()+","+o.toString()+","+s.toString()+","+h.toString()+" ";break;case"A":p=p+"A"+g.r1.toString()+","+g.r2.toString()+","+g.angle.toString()+",",p+=g.largeArc.toString()+","+g.sweep+","+s.toString()+","+h.toString()+" ";break;case"Z":case"z":p+="Z "}}t.setAttribute("d",p)},t.prototype.setSvgFontStyle=function(t,e){t.style.fontStyle=e.italic?"italic":"normal",t.style.fontWeight=e.bold?"bold":"normal",t.style.fontSize=e.fontSize.toString()+"px",t.style.fontFamily=e.fontFamily},t.prototype.drawText=function(t,e,i,r,o){if(void 0!==e.content){var n=void 0,a=void 0,s=void 0,h=void 0,d=void 0,l=void 0,c=0,p=0,g=0,u=void 0;if(i&&(u=i.getElementById(e.id+"_text")),u){if(e.doWrap)for(;u.firstChild;)u.removeChild(u.firstChild)}else e.doWrap=!0,u=document.createElementNS("http://www.w3.org/2000/svg","text"),"pre-wrap"===e.whiteSpace&&u.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),t.appendChild(u);var f=e.x+e.width*e.pivotX,m=e.y+e.height*e.pivotY;if(e.doWrap)for(this.setSvgStyle(u,e,o),this.setSvgFontStyle(u,e),n=document.createTextNode(e.content),a=e.childNodes,s=e.wrapBounds,h=this.svgLabelAlign(e,s,a),s.width>e.width&&"Wrap"!==e.textOverflow&&(a[0].text=Qi(e.content,e)),g=0;g<a.length;g++)l=document.createElementNS("http://www.w3.org/2000/svg","tspan"),n=document.createTextNode(a[g].text),d=a[g],c=h.x+d.x-s.x,p=h.y+d.dy*g+.8*e.fontSize,Ni(l,{x:c.toString(),y:p.toString()}),u.setAttribute("fill",d.text),l.appendChild(n),u.appendChild(l);e.textDecoration&&"LineThrough"===e.textDecoration&&(e.textDecoration=Zi(e.textDecoration));Ni(u,{id:e.id+"_text",fill:e.color,visibility:e.visible?"visible":"hidden","text-decoration":e.textDecoration,transform:"rotate("+e.angle+","+f+","+m+")translate("+e.x+","+e.y+")",opacity:e.opacity,"aria-label":r||""})}},t.prototype.drawImage=function(t,e,i,r){var o;e.id;i&&(o=i.getElementById(e.id+"image")),o||(o=document.createElementNS("http://www.w3.org/2000/svg","image"),t.appendChild(o));var n=new Image;n.src=e.source;var a="None"!==e.scale?e.scale:"",s=e.alignment,h=s.charAt(0).toLowerCase()+s.slice(1);a&&(h+=" "+a.charAt(0).toLowerCase()+a.slice(1));Ni(o,{id:e.id+"image",x:e.x.toString(),y:e.y.toString(),transform:"rotate("+e.angle+","+(e.x+e.width*e.pivotX)+","+(e.y+e.height*e.pivotY)+")",width:e.width.toString(),visibility:e.visible?"visible":"hidden",height:e.height.toString(),preserveAspectRatio:h,opacity:(e.opacity||1).toString()}),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n.src.toString())},t.prototype.drawHTMLContent=function(t,e,i,r){var o;if(e){var n=void 0;for(n=0;n<e.childNodes.length;n++)e.childNodes[n].id===t.id+"_html_element"&&(o=e.childNodes[n])}if(!o){(o=Oi("div",{id:t.id+"_html_element",class:"foreign-object"})).appendChild(t.template.cloneNode(!0)),e.appendChild(o)}var a=Wi(t).topLeft;o.setAttribute("style","height:"+t.actualSize.height+"px; width:"+t.actualSize.width+"px;left:"+a.x+"px; top:"+a.y+"px;position:absolute;transform:rotate("+(t.rotateAngle+t.parentTransform)+"deg);pointer-events:"+(r?"all":"none")+";visibility:"+(t.visible?"visible":"hidden")+";opacity:"+t.style.opacity+";")},t.prototype.drawNativeContent=function(t,e,i,r,o){var n,a;o&&(n=o.getElementById(t.id+"_native_element"),a=o.getElementById(t.id+"_clip")),n||((n=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id",t.id+"_native_element"),n.appendChild(t.template.cloneNode(!0)),e.appendChild(n)),a&&n.removeChild(a),n.setAttribute("style","visibility:"+(t.visible?"visible":"hidden")+";opacity:"+t.style.opacity+";"),this.setNativTransform(t,n,i,r),"Slice"===t.scale&&this.drawClipPath(t,n,i,r,o),Ni(n,t.description?{"aria-label":t.description}:{})},t.prototype.setNativTransform=function(t,e,i,r){var o=0!==t.contentSize.width?t.contentSize.width:1,n=0!==t.contentSize.height?t.contentSize.height:1,a=t.templatePosition.x*r/o,s=t.templatePosition.y*i/n;e.setAttribute("transform","rotate("+t.parentTransform+","+t.offsetX+","+t.offsetY+") translate("+(t.offsetX-a-r*t.pivot.x)+","+(t.offsetY-s-i*t.pivot.y)+") scale("+r/o+","+i/n+")")},t.prototype.drawClipPath=function(t,e,i,r,o){var n=t.contentSize.width,a=t.contentSize.height,s=(t.actualSize.width,t.actualSize.height,t.width/(r/n)),h=t.height/(i/a),d=t.templatePosition.x+(t.width>=t.height?0:(n-s)/2),l=t.templatePosition.y+(t.height>=t.width?0:(a-h)/2),c=o.getElementById(t.id+"_clip");(c=document.createElementNS("http://www.w3.org/2000/svg","clipPath")).setAttribute("id",t.id+"_clip"),e.appendChild(c);var p=o.getElementById(t.id+"_clip_rect");p=document.createElementNS("http://www.w3.org/2000/svg","rect"),c.appendChild(p);return Ni(p,{id:t.id+"_clip_rect",width:s.toString(),height:h.toString(),x:d.toString(),y:l.toString()}),e.setAttribute("clip-path","url(#"+t.id+"_clip)"),e},t.prototype.renderGradient=function(t,e,i){var r,o,n,a=Ai(i),s=a.getElementById(i+"gradient_pattern");s||(s=Ii("defs",{id:i+"gradient_pattern"}),a.insertBefore(s,a.firstChild));var h,d;if("None"!==t.gradient.type){for(var l=0;l<t.gradient.stops.length;l++)r=r?Math.max(r,t.gradient.stops[l].offset):t.gradient.stops[l].offset,o=o?Math.min(o,t.gradient.stops[l].offset):t.gradient.stops[l].offset;"Linear"===t.gradient.type?((d=t.gradient).id=e.id+"_linear",(n=a.getElementById(e.id+"_linear"))&&n.parentNode.removeChild(n),n=this.createLinearGradient(d),s.appendChild(n)):((h=t.gradient).id=e.id+"_radial",n=a.getElementById(e.id+"_radial"),(n=a.getElementById(e.id+"_linear"))&&n.parentNode.removeChild(n),n=this.createRadialGradient(h),s.appendChild(n));for(l=0;l<t.gradient.stops.length;l++){var c=t.gradient.stops[l],p=o<0?(r+c.offset)/(2*r):c.offset/r,g=document.createElementNS("http://www.w3.org/2000/svg","stop");Ni(g,{offset:p.toString(),style:"stop-color:"+c.color}),n.appendChild(g)}}return n},t.prototype.createLinearGradient=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");return Ni(e,{id:t.id,x1:t.x1+"%",y1:t.y1+"%",x2:t.x2+"%",y2:t.y2+"%"}),e},t.prototype.createRadialGradient=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","radialGradient");return Ni(e,{id:t.id,cx:t.cx+"%",cy:t.cy+"%",r:t.r+"%",fx:t.fx+"%",fy:t.fy+"%"}),e},t.prototype.setSvgStyle=function(t,e,i){"none"===e.fill&&(e.fill="transparent"),"none"===e.stroke&&(e.stroke="transparent");var r,o=[];if(void 0!==e.dashArray){o=(new Xn).parseDashArray(e.dashArray)}if(e.gradient&&"None"!==e.gradient.type){r="url(#"+this.renderGradient(e,t,i).id+")"}else r=e.fill;e.stroke&&t.setAttribute("stroke",e.stroke),void 0!==e.strokeWidth&&null!==e.strokeWidth&&t.setAttribute("stroke-width",e.strokeWidth.toString()),o&&t.setAttribute("stroke-dasharray",o.toString()),r&&t.setAttribute("fill",r)},t.prototype.svgLabelAlign=function(t,e,i){var r=new yr(e.width,i.length*(1.2*t.fontSize)),o={x:0,y:0},n=.5*t.width,a=.5*t.height;return"left"===t.textAlign?n=0:"center"===t.textAlign?n=e.width>t.width&&("Ellipsis"===t.textOverflow||"Clip"===t.textOverflow)?0:.5*t.width:"right"===t.textAlign&&(n=1*t.width),o.x=0+n+(e?e.x:0),o.y=1.2+a-r.height/2,o},t}(),Vn=function(){function e(t,e,i){this.renderer=null,this.isSvgMode=!0,this.transform={x:0,y:0},this.diagramId=t,this.element=wi(this.diagramId),this.svgRenderer=e,this.isSvgMode=i,this.renderer=i?new Yn:new Xn}return e.prototype.setCursor=function(t,e){t.style.cursor=e},e.prototype.setLayers=function(){this.iconSvgLayer=this.element.getElementsByClassName("e-ports-expand-layer")[0],this.adornerSvgLayer=this.element.getElementsByClassName("e-adorner-layer")[0],this.nativeSvgLayer=this.element.getElementsByClassName("e-native-layer")[0],this.diagramSvgLayer=this.element.getElementsByClassName("e-diagram-layer")[0]},e.prototype.getAdornerLayer=function(){return Pi(this.diagramId)},e.prototype.getParentSvg=function(t,e,i){return this.diagramId&&t&&t.id?t.id.split("_icon_content").length>1||t.id.split("_nodeport").length>1?this.iconSvgLayer:e&&"selector"===e?this.adornerSvgLayer:t instanceof Ur?this.nativeSvgLayer:this.diagramSvgLayer:i},e.prototype.getParentElement=function(t,e,i,r){var o=e;if(i&&this.diagramId&&t&&t.id){t.id.split("_icon_content").length>1?(o=i.getElementById(this.diagramId+"_diagramExpander"),e=null):t.id.split("_nodeport").length>1?o=i.getElementById(this.diagramId+"_diagramPorts"):t instanceof Ur?(o=i.getElementById(this.diagramId+"_nativeLayer"),e=null):o=i.getElementById(this.diagramId+"_diagramLayer");var n=this.getGroupElement(t,e||o,r);o=n.g,n.svg&&(i=n.svg)}return{g:o,svg:i}},e.prototype.getGroupElement=function(t,e,i){var r,o,n=this.getParentSvg(t);if(e&&n){if(n&&!(r=n.getElementById(t.id+"_groupElement"))&&n!==this.nativeSvgLayer){var a=this.nativeSvgLayer;r=a.getElementById(t.id+"_groupElement"),o=a}r||(r=this.svgRenderer.createGElement("g",{id:t.id+"_groupElement"}),void 0!==i&&e.childNodes.length>i?e.insertBefore(r,e.childNodes[i]):e.appendChild(r))}return{g:r,svg:o}},e.prototype.renderElement=function(t,e,i,r,o,n,a,s){t instanceof _r?this.renderContainer(t,e,i,r,o,n,a,s):t instanceof qr?this.renderImageElement(t,e,r,o,a):t instanceof Yr?this.renderPathElement(t,e,r,o,a):t instanceof Gr?this.renderTextElement(t,e,r,o,a):t instanceof Ur?this.renderNativeElement(t,e,r,o,a):t instanceof Po?this.renderHTMLElement(t,e,i,r,o,a):this.renderRect(t,e,r,o)},e.prototype.drawSelectionRectangle=function(t,e,i,r,o,n){t=(t+n.tx)*n.scale,e=(e+n.ty)*n.scale;var a={width:i*n.scale,height:r*n.scale,x:t+.5,y:e+.5,fill:"transparent",stroke:"gray",angle:0,pivotX:.5,pivotY:.5,strokeWidth:1,dashArray:"6 3",opacity:1,visible:!0,id:o.id+"_selected_region"},s=this.getAdornerLayer();this.svgRenderer.updateSelectionRegion(s,a)},e.prototype.renderHighlighter=function(t,e,i){var r=t.actualSize.width||2,o=t.actualSize.height||2,n=t.offsetX-r*t.pivot.x,a=t.offsetY-o*t.pivot.y;n=(n+i.tx)*i.scale,a=(a+i.ty)*i.scale;var s={width:r*i.scale,height:o*i.scale,x:n,y:a,fill:"transparent",stroke:"#8CC63F",angle:t.rotateAngle,pivotX:t.pivot.x,pivotY:t.pivot.y,strokeWidth:4,dashArray:"",opacity:1,cornerRadius:0,visible:!0,id:e.id+"_highlighter",class:"e-diagram-highlighter"};this.svgRenderer.drawRectangle(e,s,this.diagramId)},e.prototype.renderStackHighlighter=function(t,e,i,r,o,a){var s=t.actualSize.width||2,h=t.offsetX-s*t.pivot.x,d=t.actualSize.height||2,c=t.offsetY-d*t.pivot.y;h=(h+i.tx)*i.scale;var p,u=t.bounds,f="";if(c=(c+i.ty)*i.scale,r)if(a){p="M 0 0 L "+((v=s*i.scale)+2)+" 0 Z";var m=-u.x,y=-u.y;m=t.actualSize.width/Number(u.width?u.width:1)*i.scale,y=t.actualSize.height/Number(u.height?u.height:1)*i.scale;f=l(g(n("M7,4 L8,4 8,7 11,7 11,8 8,8 8,11 7,11 7,8 4,8 4,7 7,7 z M7.5,0.99999994C3.9160004,1 1,3.9160004 0.99999994,7.5 1,11.084 3.9160004,14 7.5,14 11.084,14 14,11.084 14,7.5 14,3.9160004 11.084,1 7.5,0.99999994 z M7.5,0 C11.636002,0 15,3.3639984 15,7.5 15,11.636002 11.636002,15 7.5,15 3.3640003,15 0,11.636002 0,7.5 0,3.3639984 3.3640003,0 7.5,0 z")),m+v+2,y-8,!1,u.x,u.y,0,0),o.y>=t.offsetY&&(c+=d)}else{p="M -10 -10 L 0 0 Z M -10 10 L 0 0 Z M 0 0 L "+(v=s*i.scale)+" 0 Z M "+v+" 0 L "+(v+10)+" 10 Z L "+(v+10)+" -10 Z"}else{var v;p="M 10 -10 L 0 0 Z M -10 -10 L 0 0 Z M 0 0 L 0 "+(v=d*i.scale)+" Z M 0  "+v+" L -10  "+(v+10)+" Z L 10  "+(v+10)+" Z",o.x>=t.offsetX&&(h+=s)}var b={data:p+f,width:s*i.scale,height:d*i.scale,x:h,y:c,fill:"transparent",stroke:"#8CC63F",angle:t.rotateAngle,pivotX:t.pivot.x,pivotY:t.pivot.y,strokeWidth:1,dashArray:"",opacity:1,visible:!0,id:e.id+"_stack_highlighter",class:"e-diagram-highlighter"};this.svgRenderer.drawPath(e,b,this.diagramId)},e.prototype.drawLine=function(t,e){this.svgRenderer.drawLine(t,e)},e.prototype.drawPath=function(t,e){this.svgRenderer.drawPath(t,e,this.diagramId)},e.prototype.renderResizeHandle=function(e,i,r,o,n,a,s,h,d){var l=e.offsetX-e.actualSize.width*e.pivot.x,c=e.offsetY-e.actualSize.height*e.pivot.y,p=e.actualSize.height,g=e.actualSize.width;r&t.ThumbsConstraints.Rotate&&(this.renderPivotLine(e,i,a,n,s),this.renderRotateThumb(e,i,a,n,s)),this.renderBorder(e,i,a,h,d);var u=e.actualSize.width*o,f=e.actualSize.height*o;d||(u>=40&&f>=40&&(n&t.SelectorConstraints.ResizeNorthWest&&this.renderCircularHandle("resizeNorthWest",e,l,c,i,ti(n,"ResizeNorthWest"),r&t.ThumbsConstraints.ResizeNorthWest,a,void 0,s,{"aria-label":"Thumb to resize the selected object on top left side direction"},void 0,"e-diagram-resize-handle e-northwest"),n&t.SelectorConstraints.ResizeNorthEast&&this.renderCircularHandle("resizeNorthEast",e,l+g,c,i,ti(n,"ResizeNorthEast"),r&t.ThumbsConstraints.ResizeNorthEast,a,void 0,s,{"aria-label":"Thumb to resize the selected object on top right side direction"},void 0,"e-diagram-resize-handle e-northeast"),n&t.SelectorConstraints.ResizeSouthWest&&this.renderCircularHandle("resizeSouthWest",e,l,c+p,i,ti(n,"ResizeSouthWest"),r&t.ThumbsConstraints.ResizeSouthWest,a,void 0,s,{"aria-label":"Thumb to resize the selected object on bottom left side direction"},void 0,"e-diagram-resize-handle e-southwest"),n&t.SelectorConstraints.ResizeSouthEast&&this.renderCircularHandle("resizeSouthEast",e,l+g,c+p,i,ti(n,"ResizeSouthEast"),r&t.ThumbsConstraints.ResizeSouthEast,a,void 0,s,{"aria-label":"Thumb to resize the selected object on bottom right side direction"},void 0,"e-diagram-resize-handle e-southeast")),n&t.SelectorConstraints.ResizeNorth&&this.renderCircularHandle("resizeNorth",e,l+g/2,c,i,ti(n,"ResizeNorth"),r&t.ThumbsConstraints.ResizeNorth,a,void 0,s,{"aria-label":"Thumb to resize the selected object on top side direction"},void 0,"e-diagram-resize-handle e-north"),n&t.SelectorConstraints.ResizeSouth&&this.renderCircularHandle("resizeSouth",e,l+g/2,c+p,i,ti(n,"ResizeSouth"),r&t.ThumbsConstraints.ResizeSouth,a,void 0,s,{"aria-label":"Thumb to resize the selected object on bottom side direction"},void 0,"e-diagram-resize-handle e-south"),n&t.SelectorConstraints.ResizeWest&&this.renderCircularHandle("resizeWest",e,l,c+p/2,i,ti(n,"ResizeWest"),r&t.ThumbsConstraints.ResizeWest,a,void 0,s,{"aria-label":"Thumb to resize the selected object on left side direction"},void 0,"e-diagram-resize-handle e-west"),n&t.SelectorConstraints.ResizeEast&&this.renderCircularHandle("resizeEast",e,l+g,c+p/2,i,ti(n,"ResizeEast"),r&t.ThumbsConstraints.ResizeEast,a,void 0,s,{"aria-label":"Thumb to resize the selected object on right side direction"},void 0,"e-diagram-resize-handle e-east"))},e.prototype.renderEndPointHandle=function(e,i,r,o,n,a,s,h){var d,l,c=e.sourcePoint,p=e.targetPoint,g=e.wrapper;if(this.renderCircularHandle("connectorSourceThumb",g,c.x,c.y,i,ti(o,"ConnectorSourceThumb"),r&t.ThumbsConstraints.ConnectorSource,n,a,void 0,{"aria-label":"Thumb to move the source point of the connector"},void 0,"e-diagram-endpoint-handle e-targetend"),this.renderCircularHandle("connectorTargetThumb",g,p.x,p.y,i,ti(o,"ConnectorTargetThumb"),r&t.ThumbsConstraints.ConnectorTarget,n,s,void 0,{"aria-label":"Thumb to move the target point of the connector"},void 0,"e-diagram-endpoint-handle e-targetend"),h)if(("Straight"===e.type||"Bezier"===e.type)&&e.segments.length>0)for(d=0;d<e.segments.length-1;d++)l=e.segments[d],this.renderCircularHandle("segementThumb_"+(d+1),g,l.point.x,l.point.y,i,!0,r&t.ThumbsConstraints.ConnectorSource,n,a,null,null,d);else for(d=0;d<e.segments.length;d++){var u=e.segments[d];this.renderOrthogonalThumbs("orthoThumb_"+(d+1),g,u,i,ti(o,"ConnectorSourceThumb"),n)}if("Bezier"===e.type)for(d=0;d<e.segments.length;d++){var f=e.segments[d],m=wr.isEmptyPoint(f.point1)?f.bezierPoint1:f.point1;this.renderCircularHandle("bezierPoint_"+(d+1)+"_1",g,m.x,m.y,i,ti(o,"ConnectorSourceThumb"),r&t.ThumbsConstraints.ConnectorSource,n,void 0,void 0,{"aria-label":"Thumb to move the source point of the connector"},void 0,"e-diagram-bezier-handle e-source"),ti(o,"ConnectorSourceThumb")&&this.renderBezierLine("bezierLine_"+(d+1)+"_1",g,i,f.points[0],wr.isEmptyPoint(f.point1)?f.bezierPoint1:f.point1,n),m=wr.isEmptyPoint(f.point2)?f.bezierPoint2:f.point2,this.renderCircularHandle("bezierPoint_"+(d+1)+"_2",g,m.x,m.y,i,ti(o,"ConnectorTargetThumb"),r&t.ThumbsConstraints.ConnectorTarget,n,void 0,void 0,{"aria-label":"Thumb to move the target point of the connector"},void 0,"e-diagram-bezier-handle e-target"),ti(o,"ConnectorTargetThumb")&&this.renderBezierLine("bezierLine_"+(d+1)+"_2",g,i,f.points[1],wr.isEmptyPoint(f.point2)?f.bezierPoint2:f.point2,n)}},e.prototype.renderOrthogonalThumbs=function(t,e,i,r,o,n){var a,s,h,d=0;for(d=0;d<i.points.length-1;d++)h=wr.distancePoints(i.points[d],i.points[d+1]),a=i.points[d].y.toFixed(2)===i.points[d+1].y.toFixed(2)?"horizontal":"vertical",s=h>=50,this.renderOrthogonalThumb(t+"_"+(d+1),e,(i.points[d].x+i.points[d+1].x)/2,(i.points[d].y+i.points[d+1].y)/2,r,s,a,n)},e.prototype.renderOrthogonalThumb=function(t,e,i,r,o,n,a,s){var h,d,l;"horizontal"===a?(h="M0,7 L15,0 L30,7 L15,14 z",d=-15,l=-7):(h="M7,0 L0,15 L7,30 L14,15 z",d=-7,l=-15);var c={x:(i+s.tx)*s.scale+d,y:(r+s.ty)*s.scale+l,angle:0,fill:"#e2e2e2",stroke:"black",strokeWidth:1,dashArray:"",data:h,width:20,height:20,pivotX:0,pivotY:0,opacity:1,visible:n,id:t};this.svgRenderer.drawPath(o,c,this.diagramId)},e.prototype.renderPivotLine=function(e,i,r,o,n){var a=e,s=!!(o&t.SelectorConstraints.Rotate);n&&(s=!1);var h=this.getBaseAttributes(a,r);h.fill="None",h.stroke="black",h.strokeWidth=1,h.dashArray="2,3",h.visible=s;var d=r.scale;h.x*=d,h.y*=d,h.width*=d,h.height*=d,h.id="pivotLine",h.class="e-diagram-pivot-line";var l={x:a.actualSize.width*a.pivot.x*d,y:-20},c={x:a.actualSize.width*a.pivot.x*d,y:0};h.startPoint=l,h.endPoint=c,this.svgRenderer.drawLine(i,h)},e.prototype.renderBezierLine=function(t,e,i,r,o,n){var a=this.getBaseAttributes(e,n);a.id=t,a.stroke="black",a.strokeWidth=1,a.dashArray="3,3",a.fill="None",a.class="e-diagram-bezier-line",a.x=0,a.y=0;var s=n.scale,h={x:(r.x+n.tx)*s,y:(r.y+n.ty)*s},d={x:(o.x+n.tx)*s,y:(o.y+n.ty)*s};a.startPoint=h,a.endPoint=d,this.svgRenderer.drawLine(i,a)},e.prototype.renderCircularHandle=function(t,e,i,r,o,n,a,s,h,d,l,c,p){var g=e,u=7,f={x:i,y:r};if(0!==g.rotateAngle||0!==g.parentTransform){var v=m();b(v,g.rotateAngle+g.parentTransform,g.offsetX,g.offsetY),f=y(v,f)}var w=this.getBaseAttributes(g);w.stroke="black",w.strokeWidth=1,void 0!==c?(u=5,w.id="segmentEnd_"+c,w.fill="#e2e2e2"):(u=7,w.fill=h?"#8CC63F":"white"),w.centerX=(f.x+s.tx)*s.scale,w.centerY=(f.y+s.ty)*s.scale,w.radius=u,w.angle=0,w.id=t,w.visible=n,w.class=p,h&&(w.class+=" e-connected"),d&&(w.visible=!1),this.svgRenderer.drawCircle(o,w,a,l)},e.prototype.renderBorder=function(t,e,i,r,o){var n=t,a=this.getBaseAttributes(n,i);a.x*=i.scale,a.y*=i.scale,a.width*=i.scale,a.height*=i.scale,a.fill="transparent",a.stroke="#097F7F",a.strokeWidth=.6,a.dashArray="6,3",a.class="e-diagram-border",a.id="borderRect",r||(a.class+=" e-disabled"),o&&(a.class+=" e-thick-border"),a.cornerRadius=0;var s=this.getParentSvg(t,"selector");this.svgRenderer.drawRectangle(e,a,this.diagramId,void 0,!0,s)},e.prototype.renderUserHandler=function(e,i,r){for(var o=e.wrapper,a=0,s=e.userHandles;a<s.length;a++){var h=s[a],d=(new Yr,void 0),c=h.pathData;(d=Je(e,h,r)).x=(d.x+r.tx)*r.scale,d.y=(d.y+r.ty)*r.scale,h.visible&&(h.visible=!!(e.constraints&t.SelectorConstraints.UserHandle));var p=this.getBaseAttributes(o);p.id=h.name+"_userhandle",p.fill=h.backgroundColor,p.stroke=h.borderColor,p.strokeWidth=h.borderWidth,p.centerX=d.x,p.centerY=d.y,p.radius=.5*h.size,p.class="e-diagram-userhandle-circle",p.angle=0,p.visible=h.visible,p.opacity=1,this.svgRenderer.drawCircle(i,p,1,{"aria-label":h.name+"user handle"});var u=[];u=g(u=n(c));var f=fi(c),m=l(u,(h.size-.45*h.size)/f.width,(h.size-.45*h.size)/f.height,!0,f.x,f.y,0,0);f=fi(m);var y={x:d.x-f.width/2,y:d.y-f.height/2,angle:0,id:"",class:"e-diagram-userhandle-path",fill:h.pathColor,stroke:h.backgroundColor,strokeWidth:.5,dashArray:"",data:m,width:h.size-5,height:h.size-5,pivotX:0,pivotY:0,opacity:1,visible:h.visible};this.svgRenderer.drawPath(i,y,this.diagramId,void 0,void 0,{"aria-label":h.name+"user handle"})}},e.prototype.renderRotateThumb=function(e,i,r,o,n){new Yr;var a,s=new yr;s.width=18,s.height=16;var h=e.offsetY-e.actualSize.height*e.pivot.y,d=e.offsetX-e.actualSize.width*e.pivot.x,l=!!(o&t.SelectorConstraints.Rotate);n&&(l=!1);var c=d+e.pivot.x*e.actualSize.width,p=h;if(c=(c+r.tx)*r.scale,p=(p+r.ty)*r.scale,a={x:c-.5*s.width,y:p-30-.5*s.height},0!==e.rotateAngle||0!==e.parentTransform){var g=m();b(g,e.rotateAngle+e.parentTransform,(r.tx+e.offsetX)*r.scale,(r.ty+e.offsetY)*r.scale),a=y(g,a)}var u={x:a.x,y:a.y,angle:e.rotateAngle+e.parentTransform,fill:"#231f20",stroke:"black",strokeWidth:.5,dashArray:"",data:"M 16.856144362449648 10.238890446662904 L 18.000144362449646 3.437890446662903L 15.811144362449646 4.254890446662903 C 14.837144362449646 2.5608904466629028 13.329144362449647  1.2598904466629026 11.485144362449645 0.5588904466629026 C 9.375144362449646 - 0.24510955333709716 7.071144362449646  - 0.18010955333709716 5.010144362449646 0.7438904466629028 C 2.942144362449646 1.6678904466629028 1.365144362449646 3.341890446662903 0.558144362449646 5.452890446662903 C - 0.244855637550354 7.567890446662903 - 0.17985563755035394 9.866890446662904 0.7431443624496461 11.930890446662904 C 1.6681443624496461 13.994890446662904 3.343144362449646 15.575890446662903 5.457144362449647 16.380890446662903 C 6.426144362449647 16.7518904466629 7.450144362449647 16.9348904466629 8.470144362449647 16.9348904466629 C 9.815144362449647 16.9348904466629 11.155144362449647 16.6178904466629 12.367144362449647 15.986890446662901 L 11.351144362449647 14.024890446662901 C 9.767144362449647 14.8468904466629 7.906144362449647 14.953890446662902 6.237144362449647 14.3178904466629 C 4.677144362449647 13.7218904466629 3.444144362449647 12.5558904466629 2.758144362449647 11.028890446662901 C 2.078144362449646 9.501890446662903 2.031144362449646 7.802890446662903 2.622144362449646 6.243890446662903 C 3.216144362449646 4.6798904466629025 4.387144362449646 3.442890446662903 5.914144362449646 2.760890446662903 C 7.437144362449646 2.078890446662903 9.137144362449646 2.0298904466629026 10.700144362449645 2.6258904466629027 C 11.946144362449646 3.100890446662903 12.971144362449646 3.9538904466629026 13.686144362449646 5.049890446662903 L 11.540144362449645 5.850890446662903 L 16.856144362449648 10.238890446662904 Z",width:20,height:20,pivotX:0,pivotY:0,opacity:1,visible:l,id:e.id,class:"e-diagram-rotate-handle"};u.id="rotateThumb",this.svgRenderer.drawPath(i,u,this.diagramId,!0,void 0,{"aria-label":"Thumb to rotate the selected object"})},e.prototype.renderPathElement=function(t,e,i,r,o){var n=this.getBaseAttributes(t,i);n.data=t.absolutePath,n.data=t.absolutePath;var a=t.description?t.description:t.id;this.renderer.drawPath(e,n,this.diagramId,void 0,r,a)},e.prototype.renderSvgGridlines=function(e,i,r,o,n,a){var s=document.createElementNS("http://www.w3.org/2000/svg","pattern"),h=document.createElementNS("http://www.w3.org/2000/svg","defs");h.setAttribute("id",this.diagramId+"_grid_pattern_defn"),(e.constraints&t.SnapConstraints.ShowHorizontalLines||e.constraints&t.SnapConstraints.ShowVerticalLines)&&s.setAttribute("id",this.diagramId+"_pattern");var d=0,l=0,c=0,p=0,g=1,u=!1;if(o.showRulers&&o.dynamicGrid&&n&&a)c=a.updateSegmentWidth(r.scale),p=n.updateSegmentWidth(r.scale),e.horizontalGridlines.scaledIntervals=[c/n.interval],e.verticalGridlines.scaledIntervals=[p/a.interval],u=!0;else{for(var f=0,m=e.verticalGridlines.lineIntervals;f<m.length;f++){d+=m[f]}for(var y=0,v=e.horizontalGridlines.lineIntervals;y<v.length;y++){l+=v[y]}g=this.scaleSnapInterval(e,r.scale)}d=u?p:d*g,l=u?c:l*g;Ni(s,{id:this.diagramId+"_pattern",x:0,y:0,width:d,height:l,patternUnits:"userSpaceOnUse"}),this.horizontalSvgGridlines(s,d,l,g,e,o,a,u),this.verticalSvgGridlines(s,d,l,g,e,o,n,u),h.appendChild(s),i.appendChild(h)},e.prototype.horizontalSvgGridlines=function(e,i,r,o,n,a,s,h){var d,l=0,c=[];if(n.constraints&t.SnapConstraints.ShowHorizontalLines){var p=n.horizontalGridlines.lineIntervals;n.horizontalGridlines.lineColor;n.horizontalGridlines.lineDashArray&&(c=this.renderer.parseDashArray(n.horizontalGridlines.lineDashArray)),a.showRulers&&a.dynamicGrid&&s&&(p=this.updateLineIntervals(p,a,s,r));for(var g=0;g<p.length;g+=2){d=document.createElementNS("http://www.w3.org/2000/svg","path");var u=l+p[g]/2;u=h?u:u*o;Ni(d,{"stroke-width":p[g],stroke:n.horizontalGridlines.lineColor,d:"M0,"+u+" L"+i+","+u+" Z",dashArray:c.toString(),class:1.25===p[g]?"e-diagram-thick-grid":"e-diagram-thin-grid"}),e.appendChild(d),l+=p[g+1]+p[g]}}},e.prototype.verticalSvgGridlines=function(e,i,r,o,n,a,s,h){var d,l=0,c=[];if(n.constraints&t.SnapConstraints.ShowVerticalLines){var p=n.verticalGridlines.lineIntervals;n.verticalGridlines.lineColor;n.verticalGridlines.lineDashArray&&(c=this.renderer.parseDashArray(n.verticalGridlines.lineDashArray)),a.showRulers&&a.dynamicGrid&&s&&(p=this.updateLineIntervals(p,a,s,i));for(var g=0;g<p.length;g+=2){d=document.createElementNS("http://www.w3.org/2000/svg","path");var u=l+p[g]/2;u=h?u:u*o;Ni(d,{"stroke-width":p[g],stroke:n.verticalGridlines.lineColor,d:"M"+u+",0 L"+u+","+r+" Z",dashArray:c.toString(),class:1.25===p[g]?"e-diagram-thick-grid":"e-diagram-thin-grid"}),e.appendChild(d),l+=p[g+1]+p[g]}}},e.prototype.updateGrid=function(t,e,i,r,o,n){var a,s=e.getElementById(this.diagramId+"_grid_rect"),h=!1;if(s){var d=e.getElementById(this.diagramId+"_pattern");d&&d.parentNode.removeChild(d);var l=0,c=0,p=1;r.showRulers&&r.dynamicGrid&&n&&o?(l=n.updateSegmentWidth(i.scale),c=o.updateSegmentWidth(i.scale),h=!0,t.horizontalGridlines.scaledIntervals=[l/o.interval],t.verticalGridlines.scaledIntervals=[c/n.interval]):p=this.scaleSnapInterval(t,i.scale);var g=0;for(a=0;a<t.horizontalGridlines.lineIntervals.length;a++)g+=t.horizontalGridlines.lineIntervals[a];var u=0;for(a=0;a<t.verticalGridlines.lineIntervals.length;a++)u+=t.verticalGridlines.lineIntervals[a];var f={x:-i.tx*i.scale,y:-i.ty*i.scale};Ni(s,f),u=h?c:u*p,g=h?l:g*p,f={id:this.diagramId+"_pattern",x:0,y:0,width:u,height:g,patternUnits:"userSpaceOnUse"},Ni(d=document.createElementNS("http://www.w3.org/2000/svg","pattern"),f),this.horizontalSvgGridlines(d,u,g,p,t,r,n,h),this.verticalSvgGridlines(d,u,g,p,t,r,o,h);var m=e.getElementById(this.diagramId+"_grid_pattern_defn");m&&m.appendChild(d)}},e.prototype.updateLineIntervals=function(t,e,i,r){for(var o=[],n=r/i.interval,a=0;a<2*i.interval;a++)o[a]=a%2==0?0===a?1.25:.25:n-o[a-1];return o},e.prototype.scaleSnapInterval=function(t,e){if(e>=2)for(;e>=2;)e/=2;else if(e<=.5)for(;e<=.5;)e*=2;var i;if(t.horizontalGridlines.scaledIntervals=t.horizontalGridlines.snapIntervals,t.verticalGridlines.scaledIntervals=t.verticalGridlines.snapIntervals,1!==e){var r=t.horizontalGridlines;for(r.scaledIntervals=[],i=0;i<r.snapIntervals.length;i++)r.scaledIntervals[i]=r.snapIntervals[i]*e;for((r=t.verticalGridlines).scaledIntervals=[],i=0;i<r.snapIntervals.length;i++)r.scaledIntervals[i]=r.snapIntervals[i]*e}return e},e.prototype.renderTextElement=function(t,e,i,r,o){var n=this.getBaseAttributes(t,i);n.cornerRadius=0,n.whiteSpace=Ji(t.style.whiteSpace,t.style.textWrapping),n.content=t.content,n.breakWord=Zi(t.style.textWrapping),n.textAlign=Gi(t.style.textAlign),n.color=t.style.color,n.italic=t.style.italic,n.bold=t.style.bold,n.fontSize=t.style.fontSize,n.fontFamily=t.style.fontFamily,n.textOverflow=t.style.textOverflow,n.textDecoration=t.style.textDecoration,n.doWrap=t.doWrap,n.wrapBounds=t.wrapBounds,n.childNodes=t.childNodes,n.dashArray="",n.strokeWidth=0,n.fill=t.style.fill;var a=t.description?t.description:t.content?t.content:t.id;this.renderer.drawRectangle(e,n,this.diagramId,void 0,void 0,r),this.renderer.drawText(e,n,r,a,this.diagramId),this.isSvgMode&&(t.doWrap=!1)},e.prototype.renderNativeElement=function(t,e,i,r,o){var n,a,s=this.getParentSvg(t,void 0,e)||r,h=this.getParentElement(t,e,s).g||e,d=this.getBaseAttributes(t,i);switch(d.fill="transparent",d.cornerRadius=t.cornerRadius,d.stroke="transparent",this.renderer.drawRectangle(e,d,this.diagramId,void 0,void 0,r),t.scale){case"None":n=t.contentSize.width,a=t.contentSize.height;break;case"Stretch":n=t.actualSize.width,a=t.actualSize.height;break;case"Meet":n=a=t.actualSize.width<=t.actualSize.height?t.actualSize.width:t.actualSize.height;break;case"Slice":n=a=t.actualSize.width>=t.actualSize.height?t.actualSize.width:t.actualSize.height}this.svgRenderer&&this.svgRenderer.drawNativeContent(t,h,a,n,s)},e.prototype.renderHTMLElement=function(t,e,i,r,o,n){var a=this.getBaseAttributes(t,r);a.fill="transparent",a.cornerRadius=t.cornerRadius,a.stroke="transparent",this.renderer.drawRectangle(e,a,this.diagramId,void 0,void 0,o),this.svgRenderer&&this.svgRenderer.drawHTMLContent(t,i.children[0],r,Te(i))},e.prototype.renderImageElement=function(t,e,i,r,o){var n=this.getBaseAttributes(t,i);n.cornerRadius=0,this.renderer.drawRectangle(e,n,this.diagramId,void 0,void 0,r);var a,s,h,d;if("Stretch"===t.stretch)a=t.actualSize.width,s=t.actualSize.height;else{var l=t.contentSize.width,c=t.contentSize.height,p=n.width/l,g=n.height/c,u=void 0;switch(t.stretch){case"Meet":a=l*(u=Math.min(p,g)),s=c*u,n.x+=Math.abs(n.width-a)/2,n.y+=Math.abs(n.height-s)/2;break;case"Slice":p=n.width/l,g=n.height/c,a=l*(u=Math.max(p,g)),s=c*u,h=n.width/a*l,d=n.height/s*c;break;case"None":a=l,s=c}}n.width=a,n.height=s,n.sourceWidth=h,n.sourceHeight=d,n.source=t.source,n.alignment=t.imageAlign,n.scale=t.imageScale,n.description=t.description?t.description:t.id,this.renderer.drawImage(e,n,r,o)},e.prototype.renderContainer=function(t,e,i,r,o,n,a,s){var h={svg:o,g:e};if(this.diagramId&&(o=this.getParentSvg(t)||o,this.isSvgMode)){var d=void 0;d=this.getParentElement(t,e,o,s).g||e,o=this.getParentSvg(this.hasNativeParent(t.children))||o;var l=this.getParentElement(this.hasNativeParent(t.children),d,o);h.svg=l.svg||o,h.g=l.g||d,n?(o&&(o.getElementById(h.g.id)||e.appendChild(h.g)),e=h.g):e=h.g}if(this.renderRect(t,e,r,o),t.hasChildren())for(var c,p=void 0,g=0,u=t.children;g<u.length;g++){var f=u[g];o=this.getParentSvg(this.hasNativeParent(t.children)||f)||o,this.isSvgMode&&(p=(c=this.getParentElement(this.hasNativeParent(t.children)||f,e,o)).g||e,c.svg&&(o=c.svg)),this.renderElement(f,p||e,i,r,o,!0,a)}},e.prototype.hasNativeParent=function(t,e){if(t&&t.length>0){var i=t[0];if(i instanceof Ur)return i;i.children&&i.children.length&&this.hasNativeParent(i.children,e++||0)}},e.prototype.renderRect=function(t,e,i,r){var o=this.getBaseAttributes(t,i);o.cornerRadius=t.cornerRadius||0;var n=t.description?t.description:t.id;this.renderer.drawRectangle(e,o,this.diagramId,void 0,void 0,r,n)},e.prototype.drawRect=function(t,e){e.cornerRadius=0,this.svgRenderer.drawRectangle(t,e,this.diagramId)},e.prototype.getBaseAttributes=function(t,e){var i={width:t.actualSize.width,height:t.actualSize.height,x:t.offsetX-t.actualSize.width*t.pivot.x+.5,y:t.offsetY-t.actualSize.height*t.pivot.y+.5,fill:t.style.fill,stroke:t.style.strokeColor,angle:t.rotateAngle+t.parentTransform,pivotX:t.pivot.x,pivotY:t.pivot.y,strokeWidth:t.style.strokeWidth,dashArray:t.style.strokeDashArray||"",opacity:t.style.opacity,shadow:t.shadow,gradient:t.style.gradient,visible:t.visible,id:t.id,description:t.description};return e&&(i.x+=e.tx,i.y+=e.ty),i},e.renderSvgBackGroundImage=function(t,e,i,r,o,n){document.getElementById(e.id);var a=Ai(e.id).getElementById(e.id+"_image");if(!a&&t.source){var s=function(t){return wi(t).getElementsByClassName("e-background-image-layer")[0]}(e.id);(a=document.createElementNS("http://www.w3.org/2000/svg","image")).setAttribute("id",e.id+"_image"),s.appendChild(a)}if(a){a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.source);var h="None"!==t.scale?t.scale:"",d=t.align,l=d.charAt(0).toLowerCase()+d.slice(1)+" "+h.charAt(0).toLowerCase()+h.slice(1);document.getElementById(e.id);Ni(a,{id:e.id+"_image",x:i,y:r,width:o,height:n,preserveAspectRatio:l})}},e.prototype.transformLayers=function(t,e){var i=t.tx*t.scale,r=t.ty*t.scale;if(i!==this.transform.x||r!==this.transform.y||0===i||0===r){if(e){this.diagramSvgLayer.getElementById(this.diagramId+"_diagramLayer").setAttribute("transform","translate("+t.tx*t.scale+","+t.ty*t.scale+"),scale("+t.scale+")")}(function(t){return Ti(t).getElementById(t+"_gridline")})(this.diagramId).setAttribute("transform","translate("+t.tx*t.scale+","+t.ty*t.scale+")");this.iconSvgLayer.getElementById(this.diagramId+"_diagramPorts").setAttribute("transform","translate("+t.tx*t.scale+","+t.ty*t.scale+"),scale("+t.scale+")");this.iconSvgLayer.getElementById(this.diagramId+"_diagramExpander").setAttribute("transform","translate("+t.tx*t.scale+","+t.ty*t.scale+"),scale("+t.scale+")");this.nativeSvgLayer.getElementById(this.diagramId+"_nativeLayer").setAttribute("transform","translate("+t.tx*t.scale+","+t.ty*t.scale+"),scale("+t.scale+")");return Li(this.diagramId).children[0].style.transform="translate("+t.tx*t.scale+"px,"+t.ty*t.scale+"px)scale("+t.scale+")",this.transform={x:t.tx*t.scale,y:t.ty*t.scale},!0}return!1},e.prototype.updateNode=function(t,e,i,r){this.renderElement(t,e,i,r,this.getParentSvg(t))},e}(),Un=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Fn=function(t,e,i,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},Gn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Un(i,t),Fn([e.Property("")],i.prototype,"source",void 0),Fn([e.Property("transparent")],i.prototype,"color",void 0),Fn([e.Property("None")],i.prototype,"scale",void 0),Fn([e.Property("None")],i.prototype,"align",void 0),i}(e.ChildProperty),Zn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Un(i,t),Fn([e.Property(null)],i.prototype,"width",void 0),Fn([e.Property(null)],i.prototype,"height",void 0),Fn([e.Complex({},Er)],i.prototype,"margin",void 0),Fn([e.Property("Landscape")],i.prototype,"orientation",void 0),Fn([e.Property("Infinity")],i.prototype,"boundaryConstraints",void 0),Fn([e.Complex({},Gn)],i.prototype,"background",void 0),Fn([e.Property(!1)],i.prototype,"multiplePage",void 0),Fn([e.Property(!1)],i.prototype,"showPageBreaks",void 0),i}(e.ChildProperty),qn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Un(i,t),Fn([e.Property(0)],i.prototype,"horizontalOffset",void 0),Fn([e.Property(0)],i.prototype,"verticalOffset",void 0),Fn([e.Property(1)],i.prototype,"currentZoom",void 0),Fn([e.Property(0)],i.prototype,"viewPortWidth",void 0),Fn([e.Property(0)],i.prototype,"viewPortHeight",void 0),Fn([e.Property(.2)],i.prototype,"minZoom",void 0),Fn([e.Property(30)],i.prototype,"maxZoom",void 0),Fn([e.Property("Diagram")],i.prototype,"scrollLimit",void 0),Fn([e.Property()],i.prototype,"scrollableArea",void 0),Fn([e.Property(!1)],i.prototype,"canAutoScroll",void 0),Fn([e.Complex({left:15,right:15,top:15,bottom:15},Er)],i.prototype,"autoScrollBorder",void 0),i}(e.ChildProperty),Kn=function(){function t(){this.services={}}return t.prototype.register=function(t,e){this.services[t]=e},t.prototype.getService=function(t){return this.services[t]},t}(),Qn=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Jn=function(t,e,i,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},$n=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Qn(i,t),Jn([e.Property("lightgray")],i.prototype,"lineColor",void 0),Jn([e.Property("")],i.prototype,"lineDashArray",void 0),Jn([e.Property([1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75])],i.prototype,"lineIntervals",void 0),Jn([e.Property([20])],i.prototype,"snapIntervals",void 0),i}(e.ChildProperty),ta=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return Qn(r,i),Jn([e.Complex({},$n)],r.prototype,"horizontalGridlines",void 0),Jn([e.Complex({},$n)],r.prototype,"verticalGridlines",void 0),Jn([e.Property(t.SnapConstraints.All)],r.prototype,"constraints",void 0),Jn([e.Property(5)],r.prototype,"snapAngle",void 0),Jn([e.Property(5)],r.prototype,"snapObjectDistance",void 0),r}(e.ChildProperty),ea=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),ia=function(t,e,i,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},ra=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return ea(i,t),ia([e.Property(5)],i.prototype,"interval",void 0),ia([e.Property(100)],i.prototype,"segmentWidth",void 0),ia([e.Property("Horizontal")],i.prototype,"orientation",void 0),ia([e.Property("RightOrBottom")],i.prototype,"tickAlignment",void 0),ia([e.Property("red")],i.prototype,"markerColor",void 0),ia([e.Property(25)],i.prototype,"thickness",void 0),ia([e.Property(null)],i.prototype,"arrangeTick",void 0),i}(e.ChildProperty),oa=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return ea(i,t),ia([e.Property(!1)],i.prototype,"showRulers",void 0),ia([e.Property(!0)],i.prototype,"dynamicGrid",void 0),ia([e.Complex({orientation:"Horizontal"},ra)],i.prototype,"horizontalRuler",void 0),ia([e.Complex({orientation:"Vertical"},ra)],i.prototype,"verticalRuler",void 0),i}(e.ChildProperty),na=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),aa=function(t,e,i,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},sa=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return na(i,t),aa([e.Property("")],i.prototype,"read",void 0),aa([e.Property("")],i.prototype,"create",void 0),aa([e.Property("")],i.prototype,"update",void 0),aa([e.Property("")],i.prototype,"destroy",void 0),aa([e.Property()],i.prototype,"customFields",void 0),i}(e.ChildProperty),ha=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return na(i,t),aa([e.Property("")],i.prototype,"id",void 0),aa([e.Property("")],i.prototype,"sourceID",void 0),aa([e.Property("")],i.prototype,"targetID",void 0),aa([e.Property(null)],i.prototype,"sourcePointX",void 0),aa([e.Property(null)],i.prototype,"sourcePointY",void 0),aa([e.Property(null)],i.prototype,"targetPointX",void 0),aa([e.Property(null)],i.prototype,"targetPointY",void 0),aa([e.Property(null)],i.prototype,"dataManager",void 0),aa([e.Complex({},sa)],i.prototype,"crudAction",void 0),i}(e.ChildProperty),da=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return na(i,t),aa([e.Property("")],i.prototype,"id",void 0),aa([e.Property(null)],i.prototype,"dataManager",void 0),aa([e.Property("")],i.prototype,"root",void 0),aa([e.Property("")],i.prototype,"parentId",void 0),aa([e.Property()],i.prototype,"data",void 0),aa([e.Property()],i.prototype,"doBinding",void 0),aa([e.Complex({},sa)],i.prototype,"crudAction",void 0),aa([e.Complex({},ha)],i.prototype,"connectionDataSource",void 0),i}(e.ChildProperty),la=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),ca=function(t,e,i,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},pa=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return la(i,t),ca([e.Property("")],i.prototype,"fixedNode",void 0),ca([e.Property(30)],i.prototype,"horizontalSpacing",void 0),ca([e.Property(30)],i.prototype,"verticalSpacing",void 0),ca([e.Property(30)],i.prototype,"maxIteration",void 0),ca([e.Property(40)],i.prototype,"springFactor",void 0),ca([e.Property(50)],i.prototype,"springLength",void 0),ca([e.Complex({left:50,top:50,right:0,bottom:0},Er)],i.prototype,"margin",void 0),ca([e.Property("Auto")],i.prototype,"horizontalAlignment",void 0),ca([e.Property("Auto")],i.prototype,"verticalAlignment",void 0),ca([e.Property("TopToBottom")],i.prototype,"orientation",void 0),ca([e.Property("Auto")],i.prototype,"connectionDirection",void 0),ca([e.Property("Default")],i.prototype,"connectorSegments",void 0),ca([e.Property("None")],i.prototype,"type",void 0),ca([e.Property()],i.prototype,"getLayoutInfo",void 0),ca([e.Property()],i.prototype,"getBranch",void 0),ca([e.Property()],i.prototype,"bounds",void 0),ca([e.Property(!0)],i.prototype,"enableAnimation",void 0),ca([e.Property("")],i.prototype,"root",void 0),i}(e.ChildProperty),ga={None:"default",Rotate:"crosshair",Select:"default",Drag:"move",ResizeWest:"w-resize",ResizeEast:"e-resize",ResizeSouth:"s-resize",ResizeNorth:"n-resize",Draw:"crosshair",PortDraw:"crosshair",ResizeNorthEast:"ne-resize",ResizeNorthWest:"nw-resize",ResizeSouthEast:"se-resize",ResizeSouthWest:"sw-resize",ConnectorSourceEnd:"move",ConnectorTargetEnd:"move",BezierSourceThumb:"move",BezierTargetThumb:"move",OrthoThumb:"move",SegmentEnd:"move",Pan:"pointer",Hyperlink:"pointer",PortDrag:"pointer",LabelSelect:"pointer",LabelDrag:"move",LabelRotate:"crosshair",LabelResizeWest:"w-resize",LabelResizeEast:"e-resize",LabelResizeSouth:"s-resize",LabelResizeNorth:"n-resize",LabelResizeNorthEast:"ne-resize",LabelResizeNorthWest:"nw-resize",LabelResizeSouthEast:"se-resize",LabelResizeSouthWest:"sw-resize"},ua=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),fa=function(){function t(t,e){void 0===e&&(e=!1),this.commandHandler=null,this.inAction=!1,this.isProtectChange=!1,this.currentElement=null,this.blocked=!1,this.isTooltipVisible=!1,this.childTable={},this.undoElement={nodes:[],connectors:[]},this.undoParentElement={nodes:[],connectors:[]},this.commandHandler=t,this.isProtectChange=e}return t.prototype.startAction=function(t){this.currentElement=t,this.inAction=!0},t.prototype.mouseDown=function(t){this.currentElement=t.source,this.startPosition=this.currentPosition=this.prevPosition=t.position,this.isTooltipVisible=!0,this.startAction(t.source),this.commandHandler.startTransaction(this.isProtectChange)},t.prototype.mouseMove=function(t){return this.currentPosition=t.position,!this.blocked},t.prototype.mouseUp=function(t){this.currentPosition=t.position,this.isTooltipVisible=!1,this.commandHandler.endTransaction(this.isProtectChange),this.endAction()},t.prototype.endAction=function(){this.isTooltipVisible||this.commandHandler.closeTooltip(),this.commandHandler=null,this.currentElement=null,this.currentPosition=null,this.inAction=!1,this.blocked=!1},t.prototype.mouseWheel=function(t){this.currentPosition=t.position},t.prototype.mouseLeave=function(t){this.mouseUp(t)},t.prototype.updateSize=function(t,e,i,r,o,n){t=this.commandHandler.renderContainerHelper(t)||t;var a,s={snapped:!1,offset:0,left:!1,right:!1},h={snapped:!1,offset:0,top:!1,bottom:!1},d=this.currentPosition.x-this.startPosition.x,l=this.currentPosition.y-this.startPosition.y,c=!(t instanceof Gr)&&this.commandHandler.snappingModule&&this.commandHandler.snappingModule.canSnap(),p=c?this.commandHandler.snappingModule.getLayer():null,g=t instanceof Gr?n:t.rotateAngle;b(a=m(),-g,0,0);t.offsetX,t.offsetY;var u=t.width,f=t.height;t.pivot.x,t.pivot.y;var v,w=0,x=0,S=t instanceof Gr?t.actualSize.width:t.width,P=t instanceof Gr?t.actualSize.height:t.height;switch(r){case"ResizeWest":d=(v=y(a,{x:d,y:l})).x,l=v.y,x=1,d=c?this.commandHandler.snappingModule.snapLeft(s,h,p,d,l,t,i===e,o):d,l=0,w=(o.width-d)/S;break;case"ResizeEast":d=(v=y(a,{x:d,y:l})).x,l=v.y,d=c?this.commandHandler.snappingModule.snapRight(s,h,p,d,l,t,i===e,o):d,l=0,w=(o.width+d)/S,x=1;break;case"ResizeNorth":w=1,d=(v=y(a,{x:d,y:l})).x,l=v.y,l=c?this.commandHandler.snappingModule.snapTop(s,h,p,d,l,t,i===e,o):l,x=(o.height-l)/P;break;case"ResizeSouth":w=1,d=(v=y(a,{x:d,y:l})).x,l=v.y,l=c?this.commandHandler.snappingModule.snapBottom(s,h,p,d,l,t,i===e,o):l,x=(o.height+l)/P;break;case"ResizeNorthEast":d=(v=y(a,{x:d,y:l})).x,l=v.y,d=c?this.commandHandler.snappingModule.snapRight(s,h,p,d,l,t,i===e,o):d,l=c?this.commandHandler.snappingModule.snapTop(s,h,p,d,l,t,i===e,o):l,w=(o.width+d)/S,x=(o.height-l)/P;break;case"ResizeNorthWest":d=(v=y(a,{x:d,y:l})).x,l=v.y,l=c?this.commandHandler.snappingModule.snapTop(s,h,p,d,l,t,i===e,o):l,d=c?this.commandHandler.snappingModule.snapLeft(s,h,p,d,l,t,i===e,o):d,w=(o.width-d)/S,x=(o.height-l)/P;break;case"ResizeSouthEast":d=(v=y(a,{x:d,y:l})).x,l=v.y,l=c?this.commandHandler.snappingModule.snapBottom(s,h,p,d,l,t,i===e,o):l,d=c?this.commandHandler.snappingModule.snapRight(s,h,p,d,l,t,i===e,o):d,x=(o.height+l)/P,w=(o.width+d)/S;break;case"ResizeSouthWest":d=(v=y(a,{x:d,y:l})).x,l=v.y,l=c?this.commandHandler.snappingModule.snapBottom(s,h,p,d,l,t,i===e,o):l,d=c?this.commandHandler.snappingModule.snapLeft(s,h,p,d,l,t,i===e,o):d,w=(o.width-d)/S,x=(o.height+l)/P}return{width:w,height:x}},t.prototype.getPivot=function(t){switch(t){case"ResizeWest":return{x:1,y:.5};case"ResizeEast":return{x:0,y:.5};case"ResizeNorth":return{x:.5,y:1};case"ResizeSouth":return{x:.5,y:0};case"ResizeNorthEast":return{x:0,y:1};case"ResizeNorthWest":return{x:1,y:1};case"ResizeSouthEast":return{x:0,y:0};case"ResizeSouthWest":return{x:1,y:0}}return{x:.5,y:.5}},t}(),ma=function(t){function e(e,i,r){var o=t.call(this,e,!0)||this;return o.action=r,o}return ua(e,t),e.prototype.mouseDown=function(e){this.inAction=!0,t.prototype.mouseDown.call(this,e)},e.prototype.mouseMove=function(e){if(t.prototype.mouseMove.call(this,e),this.inAction&&!1===wr.equals(this.currentPosition,this.prevPosition)){var i=xr.toBounds([this.prevPosition,this.currentPosition]);this.commandHandler.drawSelectionRectangle(i.x,i.y,i.width,i.height)}return!this.blocked},e.prototype.mouseUp=function(e){if(!1===wr.equals(this.currentPosition,this.prevPosition)&&this.inAction){var i=xr.toBounds([this.prevPosition,this.currentPosition]);this.commandHandler.doRubberBandSelection(i)}else{var r=this.commandHandler.getSelectedObject();this.commandHandler.hasSelection()&&e.info&&e.info.ctrlKey?e&&e.source&&(this.commandHandler.isSelected(e.source)?1===e.clickCount&&this.commandHandler.unSelect(e.source):this.commandHandler.selectObjects([e.source],!0)):(this.commandHandler.clearSelection(null===e.source),"LabelSelect"===this.action?this.commandHandler.labelSelect(e.source,e.sourceWrapper):e.source&&this.commandHandler.selectObjects([e.source],!1,r))}this.inAction=!1,t.prototype.mouseUp.call(this,e)},e.prototype.mouseLeave=function(t){this.inAction&&this.mouseUp(t)},e}(fa),ya=function(e){function i(t,i){var r=e.call(this,t,!0)||this;return r.endPoint=i,r}return ua(i,e),i.prototype.mouseDown=function(t){this.inAction=!0,this.undoElement=void 0,this instanceof Sa||(this.undoElement=Xi(t.source)),e.prototype.mouseDown.call(this,t);var i;if(t.source&&t.source.connectors&&({x:this.prevPosition.x,y:this.prevPosition.y},i=t.source.connectors[0]),"BezierSourceThumb"===this.endPoint||"BezierTargetThumb"===this.endPoint)for(var r=0;r<i.segments.length;r++){var o=i.segments[r],n=wr.isEmptyPoint(o.point1)?o.bezierPoint1:o.point1,a=wr.isEmptyPoint(o.point2)?o.bezierPoint2:o.point2;(nr(this.currentPosition,n,i.hitPadding)||nr(this.currentPosition,a,i.hitPadding))&&(this.selectedSegment=o)}this.currentPosition=t.position},i.prototype.mouseUp=function(i){if(this.commandHandler.updateSelector(),this.commandHandler.removeSnap(),this.commandHandler.changeAnnotationDrag(i),this instanceof Sa||("ConnectorSourceEnd"!==this.endPoint||!i.source.connectors.length||wr.equals(i.source.connectors[0].sourcePoint,this.undoElement.connectors[0].sourcePoint)&&i.source.connectors[0].sourceID===this.undoElement.connectors[0].sourceID)&&("ConnectorTargetEnd"!==this.endPoint||wr.equals(i.source.connectors[0].targetPoint,this.undoElement.connectors[0].targetPoint)&&i.source.connectors[0].targetID===this.undoElement.connectors[0].targetID)){if(!(this instanceof Sa||"BezierTargetThumb"!==this.endPoint&&"BezierSourceThumb"!==this.endPoint)&&this.undoElement&&i.source){l={type:"SegmentChanged",redoObject:Xi(i.source),undoObject:this.undoElement,category:"Internal"};this.commandHandler.addHistoryEntry(l)}}else{var r=void 0,o=void 0;i.source&&i.source.connectors&&(r={x:this.prevPosition.x,y:this.prevPosition.y},o=i.source.connectors[0]);var n=void 0,a=void 0;if(i.target){var s=this.commandHandler.findTarget(i.targetWrapper,i.target,"ConnectorSourceEnd"===this.endPoint,!0);s instanceof io?n=s.id:a=s.id}var h={connector:o,state:"Completed",targetNode:a,oldValue:r,newValue:r,cancel:!1,targetPort:n},d="ConnectorSourceEnd"===this.endPoint?t.DiagramEvent.sourcePointChange:t.DiagramEvent.targetPointChange;if(this.commandHandler.triggerEvent(d,h),this.commandHandler.removeTerminalSegment(o,!0),this.undoElement&&i.source){var l={type:"ConnectionChanged",redoObject:Xi(Xi(i.source)),undoObject:Xi(this.undoElement),category:"Internal"};this.commandHandler.addHistoryEntry(l)}}e.prototype.mouseUp.call(this,i)},i.prototype.mouseMove=function(i){if(e.prototype.mouseMove.call(this,i),!(this instanceof Sa)&&("ConnectorSourceEnd"===this.endPoint&&wr.equals(i.source.connectors[0].sourcePoint,this.undoElement.connectors[0].sourcePoint)||"ConnectorTargetEnd"===this.endPoint&&wr.equals(i.source.connectors[0].targetPoint,this.undoElement.connectors[0].targetPoint))){var r=void 0,o=void 0;i.source&&i.source.connectors&&(r={x:this.prevPosition.x,y:this.prevPosition.y},o=i.source.connectors[0]);var n=void 0,a=void 0;if(i.target){a=i.target.id;(y=this.commandHandler.findTarget(i.targetWrapper,i.target,"ConnectorSourceEnd"===this.endPoint,!0))instanceof io||y instanceof mn?n=y.id:a=y.id}var s={connector:o,state:"Start",targetNode:a,oldValue:r,newValue:r,cancel:!1,targetPort:n},h="ConnectorSourceEnd"===this.endPoint?t.DiagramEvent.sourcePointChange:t.DiagramEvent.targetPointChange;this.commandHandler.triggerEvent(h,s)}if(this.currentPosition=i.position,this.currentPosition&&this.prevPosition){var d=this.currentPosition.x-this.prevPosition.x,l=this.currentPosition.y-this.prevPosition.y,c=void 0,p=(r=void 0,void 0),g=void 0;this.currentPosition=this.commandHandler.snapConnectorEnd(this.currentPosition);var u=void 0;i.source&&i.source.connectors&&(c={x:this.currentPosition.x,y:this.currentPosition.y},r={x:this.prevPosition.x,y:this.prevPosition.y},u=i.source.connectors[0]);var f=void 0,m=void 0;if(i.target){(y=this.commandHandler.findTarget(i.targetWrapper,i.target,"ConnectorSourceEnd"===this.endPoint,!0))instanceof io?f=y.id:m=y.id}s={connector:u,state:"Progress",targetNode:m,oldValue:r,newValue:c,cancel:!1,targetPort:f};if(!(this instanceof Sa)){h="ConnectorSourceEnd"===this.endPoint?t.DiagramEvent.sourcePointChange:t.DiagramEvent.targetPointChange;this.commandHandler.triggerEvent(h,s)}if(i.target&&(p=oi(i.target,!0),g=oi(i.target,!1)),!s.cancel&&this.inAction&&void 0!==this.endPoint&&0!==d||0!==l)if(this.blocked=!this.commandHandler.dragConnectorEnds(this.endPoint,i.source,this.currentPosition,this.selectedSegment,i.target,f),this.commandHandler.updateSelector(),i.target&&("ConnectorSourceEnd"===this.endPoint&&(Et(i.target)||zt(g))||"ConnectorTargetEnd"===this.endPoint&&(Ot(i.target)||It(p)))){this.commandHandler.canDisconnect(this.endPoint,i,f,m)&&this.commandHandler.disConnect(i.source,this.endPoint);var y;if((y=this.commandHandler.findTarget(i.targetWrapper,i.target,"ConnectorSourceEnd"===this.endPoint,!0))instanceof En)(Ot(y)&&"ConnectorTargetEnd"===this.endPoint||Et(y)&&"ConnectorSourceEnd"===this.endPoint)&&this.commandHandler.connect(this.endPoint,i);else{this.checkConnect(y)&&this.commandHandler.connect(this.endPoint,i)}}else-1===this.endPoint.indexOf("Bezier")&&(this.commandHandler.disConnect(i.source,this.endPoint),this.commandHandler.updateSelector());if(this.commandHandler.canEnableDefaultTooltip()){var v=this.getTooltipContent(i.position);this.commandHandler.showTooltip(i.source,i.position,v,"ConnectTool",this.isTooltipVisible),this.isTooltipVisible=!1}}return this.prevPosition=this.currentPosition,!this.blocked},i.prototype.mouseLeave=function(t){this.mouseUp(t)},i.prototype.getTooltipContent=function(t){return"X:"+Math.round(t.x)+" Y:"+Math.round(t.y)},i.prototype.checkConnect=function(t){return!(!It(t)||"ConnectorTargetEnd"!==this.endPoint)||(!(!zt(t)||"ConnectorSourceEnd"!==this.endPoint)||!It(t)&&!zt(t))},i.prototype.endAction=function(){e.prototype.endAction.call(this),this.prevPosition=null,this.endPoint=null},i}(fa),va=function(e){function i(t,i){var r=e.call(this,t,!0)||this;return r.currentTarget=null,r.objectType=i,r}return ua(i,e),i.prototype.mouseDown=function(t){if(t.source instanceof En||t.source instanceof Wo){this.commandHandler.selectObjects([t.source],t.info&&t.info.ctrlKey);var i={nodes:[],connectors:[]};t.source instanceof En?i.nodes.push(Xi(t.source)):i.connectors.push(Xi(t.source)),this.undoElement=Xi(i)}else this.undoElement=Xi(t.source);this.undoParentElement=this.commandHandler.getSubProcess(t.source),"Port"===this.objectType&&(this.portId=t.sourceWrapper.id),e.prototype.mouseDown.call(this,t),this.initialOffset={x:0,y:0}},i.prototype.mouseUp=function(i){var r,o,n=!1,a={nodes:[],connectors:[]};if("Port"!==this.objectType){if(i.source instanceof En||i.source instanceof Wo){i.source instanceof En?a.nodes.push(Xi(i.source)):a.connectors.push(Xi(i.source)),r=Xi(a);var s=i.source.wrapper;r.offsetX=s.offsetX,r.offsetY=s.offsetY}else r=Xi(i.source);if((o=this.commandHandler.renderContainerHelper(i.source)||i.source).offsetX!==this.undoElement.offsetX||o.offsetY!==this.undoElement.offsetY){var h=void 0,d=void 0;i.source&&(d={offsetX:i.source.wrapper.offsetX,offsetY:i.source.wrapper.offsetY},h={offsetX:i.source.wrapper.offsetX,offsetY:i.source.wrapper.offsetY});var l={source:i.source,state:"Completed",oldValue:h,newValue:d,target:this.currentTarget,targetPosition:this.currentPosition,allowDrop:!0,cancel:!1};this.commandHandler.triggerEvent(t.DiagramEvent.positionChange,l),this.commandHandler.startGroupAction(),n=!0;var c={type:"PositionChanged",redoObject:Xi(r),undoObject:Xi(this.undoElement),category:"Internal"};if(r.nodes[0]&&r.nodes[0].processId){var p={type:"SizeChanged",category:"Internal",undoObject:this.undoParentElement,redoObject:this.commandHandler.getSubProcess(i.source)};this.commandHandler.addHistoryEntry(p)}this.commandHandler.addHistoryEntry(c)}this.commandHandler.snapPoint(this.prevPosition,this.currentPosition,0,0);if(this.commandHandler.removeSnap(),this.commandHandler.removeHighlighter(),i.source&&this.currentTarget&&kt(this.currentTarget)&&this.commandHandler.isDroppable(i.source,this.currentTarget)){this.commandHandler.drop(this.currentElement,this.currentTarget,this.currentPosition);l={element:i.source,target:this.currentTarget,position:this.currentPosition,cancel:!1};if(this.commandHandler.triggerEvent(t.DiagramEvent.drop,l),!l.cancel&&i.source&&this.commandHandler.isParentAsContainer(this.currentTarget)){var g=i.source instanceof Vo?i.source.nodes[0]:i.source;this.commandHandler.dropChildToContainer(this.currentTarget,g),this.commandHandler.renderContainerHelper(g)}}i.source&&this.currentTarget&&this.commandHandler.dropAnnotation(i.source,this.currentTarget),this.commandHandler.updateSelector(),n&&this.commandHandler.endGroupAction()}else{a.nodes.push(Xi(i.source)),r=Xi(a);c={type:"PortPositionChanged",objectId:this.portId,redoObject:Xi(r),undoObject:Xi(this.undoElement),category:"Internal"};this.commandHandler.addHistoryEntry(c)}e.prototype.mouseUp.call(this,i)},i.prototype.mouseMove=function(i){e.prototype.mouseMove.call(this,i);var r,o=!1;(r=this.commandHandler.renderContainerHelper(i.source)||i.source)instanceof En||r instanceof Wo?r instanceof En?r.offsetX===this.undoElement.nodes[0].offsetX&&r.offsetY===this.undoElement.nodes[0].offsetY&&(o=!0):wr.equals(r.sourcePoint,this.undoElement.connectors[0].sourcePoint)&&wr.equals(r.targetPoint,this.undoElement.connectors[0].targetPoint)&&(o=!0):r.wrapper.offsetX===this.undoElement.wrapper.offsetX&&r.wrapper.offsetY===this.undoElement.wrapper.offsetY&&(o=!0);var n;r&&(n={offsetX:r.wrapper.offsetX,offsetY:r.wrapper.offsetY});var a={source:r,state:"Start",oldValue:n,newValue:n,target:i.target,targetPosition:i.position,allowDrop:!0,cancel:!1};if(o&&this.commandHandler.triggerEvent(t.DiagramEvent.positionChange,a),this.currentPosition=i.position,"Port"!==this.objectType){this.currentPosition.x,this.prevPosition.x,this.currentPosition.y,this.prevPosition.y;var s=this.initialOffset.x+(this.currentPosition.x-this.prevPosition.x),h=this.initialOffset.y+(this.currentPosition.y-this.prevPosition.y);this.commandHandler.dragOverElement(i,this.currentPosition),this.commandHandler.disConnect(i.source),this.commandHandler.removeSnap();var d,l=void 0,c=this.commandHandler.snapPoint(this.prevPosition,this.currentPosition,s,h);this.initialOffset.x=s-c.x,this.initialOffset.y=h-c.y,r&&(d={offsetX:r.wrapper.offsetX,offsetY:r.wrapper.offsetY},l={offsetX:r.wrapper.offsetX+c.x,offsetY:r.wrapper.offsetY+c.y}),this.currentTarget&&i.target!==this.currentTarget&&this.commandHandler.removeChildFromBPmn(i.source,i.target,this.currentTarget),this.currentTarget=i.target;var p={source:r,state:"Progress",oldValue:d,newValue:l,target:i.target,targetPosition:i.position,allowDrop:!0,cancel:!1};if(this.commandHandler.triggerEvent(t.DiagramEvent.positionChange,p),!p.cancel){this.blocked=!this.commandHandler.dragSelectedObjects(c.x,c.y);var g=!this.commandHandler.mouseOver(this.currentElement,this.currentTarget,this.currentPosition);this.blocked=this.blocked||g}if(this.commandHandler.removeStackHighlighter(),this.commandHandler.renderStackHighlighter(i),this.currentTarget&&i.source!==this.currentTarget&&this.commandHandler.isDroppable(i.source,this.currentTarget)&&"helper"!==i.source.id?this.commandHandler.isParentAsContainer(i.source instanceof Vo?i.source.nodes[0]:i.source,!0)||this.commandHandler.drawHighlighter(this.currentTarget):this.commandHandler.removeHighlighter(),this.commandHandler.canEnableDefaultTooltip()){var u=this.getTooltipContent(i.source);this.commandHandler.showTooltip(i.source,i.position,u,"MoveTool",this.isTooltipVisible),this.isTooltipVisible=!1}}else this.commandHandler.portDrag(i.source,i.sourceWrapper,i.position.x-this.prevPosition.x,i.position.y-this.prevPosition.y);return this.prevPosition=this.currentPosition,!this.blocked},i.prototype.getTooltipContent=function(t){return"X:"+Math.round(t.wrapper.bounds.x)+" Y:"+Math.round(t.wrapper.bounds.y)},i.prototype.mouseLeave=function(t){this.mouseUp(t)},i.prototype.endAction=function(){e.prototype.endAction.call(this),this.currentTarget=null,this.prevPosition=null},i}(fa),ba=function(e){function i(t){return e.call(this,t,!0)||this}return ua(i,e),i.prototype.mouseDown=function(t){if(this.undoElement=Xi(t.source),this.undoElement.nodes[0]&&this.undoElement.nodes[0].children)for(var i=this.commandHandler.getAllDescendants(this.undoElement.nodes[0],[]),r=0;r<i.length;r++){var o=this.commandHandler.cloneChild(i[r].id);this.childTable[i[r].id]=Xi(o)}e.prototype.mouseDown.call(this,t)},i.prototype.mouseUp=function(i){var r;if(r=this.commandHandler.renderContainerHelper(i.source)||i.source,this.undoElement.rotateAngle!==r.wrapper.rotateAngle){var o={rotateAngle:r.wrapper.rotateAngle},n={source:i.source,state:"Completed",oldValue:o,newValue:o,cancel:!1};this.commandHandler.triggerEvent(t.DiagramEvent.rotateChange,n);var a={type:"RotationChanged",redoObject:Xi(Xi(i.source)),undoObject:Xi(this.undoElement),category:"Internal",childTable:this.childTable};this.commandHandler.addHistoryEntry(a),this.commandHandler.updateSelector()}e.prototype.mouseUp.call(this,i)},i.prototype.mouseMove=function(i){e.prototype.mouseMove.call(this,i);var r;if(r=this.commandHandler.renderContainerHelper(i.source)||i.source,this.undoElement.rotateAngle===r.wrapper.rotateAngle){var o={rotateAngle:r.wrapper.rotateAngle},n={source:i.source,state:"Start",oldValue:o,newValue:o,cancel:!1};this.commandHandler.triggerEvent(t.DiagramEvent.rotateChange,n)}this.currentPosition=i.position;var a={x:r.wrapper.offsetX,y:r.wrapper.offsetY},s=wr.findAngle(a,this.currentPosition)+90,h=this.commandHandler.snapAngle(s);s=((s=0!==h?h:s)+360)%360;var d={rotateAngle:r.wrapper.rotateAngle},l={rotateAngle:s},c={source:i.source,state:"Progress",oldValue:d,newValue:l,cancel:!1};if(this.commandHandler.triggerEvent(t.DiagramEvent.rotateChange,c),c.cancel||(this.blocked=!this.commandHandler.rotateSelectedItems(s-r.wrapper.rotateAngle)),this.commandHandler.canEnableDefaultTooltip()){var p=this.getTooltipContent(i.source);this.commandHandler.showTooltip(i.source,i.position,p,"RotateTool",this.isTooltipVisible),this.isTooltipVisible=!1}return!this.blocked},i.prototype.getTooltipContent=function(t){return Math.round(t.rotateAngle%360).toString()+""},i.prototype.mouseLeave=function(t){this.mouseUp(t)},i.prototype.endAction=function(){e.prototype.endAction.call(this)},i}(fa),wa=function(e){function i(t,i){var r=e.call(this,t,!0)||this;return r.initialBounds=new xr,r.corner=i,r}return ua(i,e),i.prototype.mouseDown=function(t){if(this.undoElement=Xi(t.source),this.undoParentElement=this.commandHandler.getSubProcess(t.source),e.prototype.mouseDown.call(this,t),this.undoElement.nodes[0]&&this.undoElement.nodes[0].children)for(var i=this.commandHandler.getAllDescendants(this.undoElement.nodes[0],[]),r=0;r<i.length;r++){var o=this.commandHandler.cloneChild(i[r].id);this.childTable[i[r].id]=Xi(o)}this.commandHandler.checkSelection(t.source,this.corner),e.prototype.mouseDown.call(this,t),this.initialBounds.x=t.source.wrapper.offsetX,this.initialBounds.y=t.source.wrapper.offsetY,this.initialBounds.height=t.source.wrapper.actualSize.height,this.initialBounds.width=t.source.wrapper.actualSize.width},i.prototype.mouseUp=function(i){this.commandHandler.removeSnap();var r;if(r=this.commandHandler.renderContainerHelper(i.source)||i.source,this.undoElement.offsetX!==r.wrapper.offsetX||this.undoElement.offsetY!==r.wrapper.offsetY){var o=this.updateSize(i.source,this.currentPosition,this.prevPosition,this.corner,this.initialBounds);this.blocked=this.scaleObjects(o.width,o.height,this.corner,this.currentPosition,this.prevPosition,r);var n={offsetX:i.source.wrapper.offsetX,offsetY:i.source.wrapper.offsetY,width:i.source.wrapper.actualSize.width,height:i.source.wrapper.actualSize.height},a={source:i.source,state:"Completed",oldValue:n,newValue:n,cancel:!1};this.commandHandler.triggerEvent(t.DiagramEvent.sizeChange,a);var s=Xi(i.source),h={type:"SizeChanged",redoObject:Xi(s),undoObject:Xi(this.undoElement),category:"Internal",childTable:this.childTable};if(this.commandHandler.startGroupAction(),this.commandHandler.addHistoryEntry(h),s.nodes[0]&&s.nodes[0].processId){var d={type:"SizeChanged",redoObject:this.commandHandler.getSubProcess(i.source),undoObject:this.undoParentElement,category:"Internal"};this.commandHandler.addHistoryEntry(d)}this.commandHandler.endGroupAction()}return e.prototype.mouseUp.call(this,i),!this.blocked},i.prototype.mouseMove=function(i){e.prototype.mouseMove.call(this,i);var r;if(r=this.commandHandler.renderContainerHelper(i.source)||i.source,this.undoElement.offsetX===r.wrapper.offsetX&&this.undoElement.offsetY===r.wrapper.offsetY){var o={offsetX:i.source.wrapper.offsetX,offsetY:i.source.wrapper.offsetY,width:i.source.wrapper.actualSize.width,height:i.source.wrapper.actualSize.height},n={source:i.source,state:"Start",oldValue:o,newValue:this.currentElement,cancel:!1};this.commandHandler.triggerEvent(t.DiagramEvent.sizeChange,n)}this.currentPosition=i.position;var a={x:this.currentPosition.x-this.startPosition.x,y:this.currentPosition.y-this.startPosition.y};a=tr(-this.currentElement.wrapper.rotateAngle,void 0,void 0,a);this.currentElement.wrapper.actualSize.width,a.x,this.currentElement.wrapper.actualSize.width,this.currentElement.wrapper.actualSize.height,a.y,this.currentElement.wrapper.actualSize.height;a=this.getChanges(a),this.commandHandler.removeSnap();var s=this.updateSize(i.source,this.startPosition,this.currentPosition,this.corner,this.initialBounds);if(this.blocked=!this.scaleObjects(s.width,s.height,this.corner,this.startPosition,this.currentPosition,r),this.commandHandler.canEnableDefaultTooltip()){var h=this.getTooltipContent(i.source);this.commandHandler.showTooltip(i.source,i.position,h,"ResizeTool",this.isTooltipVisible),this.isTooltipVisible=!1}return this.prevPosition=this.currentPosition,!this.blocked},i.prototype.mouseLeave=function(t){this.mouseUp(t)},i.prototype.getTooltipContent=function(t){return"W:"+Math.round(t.wrapper.bounds.width)+" H:"+Math.round(t.wrapper.bounds.height)},i.prototype.getChanges=function(t){switch(this.corner){case"ResizeEast":return{x:t.x,y:0};case"ResizeSouthEast":return t;case"ResizeSouth":return{x:0,y:t.y};case"ResizeNorth":return{x:0,y:-t.y};case"ResizeNorthEast":return{x:t.x,y:-t.y};case"ResizeNorthWest":return{x:-t.x,y:-t.y};case"ResizeWest":return{x:-t.x,y:0};case"ResizeSouthWest":return{x:-t.x,y:t.y}}return t},i.prototype.scaleObjects=function(e,i,r,o,n,a){a instanceof Vo&&1===a.nodes.length&&a.nodes[0].constraints&t.NodeConstraints.AspectRatio&&("ResizeWest"===r||"ResizeEast"===r||"ResizeNorth"===r||"ResizeSouth"===r?1===i&&1===e||(i=e=Math.max(1===i?0:i,1===e?0:e)):i=e=o!==n?Math.max(i,e):0);var s={offsetX:a.offsetX,offsetY:a.offsetY,width:a.width,height:a.height};this.blocked=this.commandHandler.scaleSelectedItems(e,i,this.getPivot(this.corner));var h;return h={source:a,state:"Progress",oldValue:s,newValue:{offsetX:a.offsetX,offsetY:a.offsetY,width:a.width,height:a.height},cancel:!1},this.commandHandler.triggerEvent(t.DiagramEvent.sizeChange,h),h.cancel&&this.commandHandler.scaleSelectedItems(1/e,1/i,this.getPivot(this.corner)),this.blocked},i}(fa),xa=function(t){function e(e,i){var r=t.call(this,e,!0)||this;return r.sourceObject=i,r}return ua(e,t),e.prototype.mouseDown=function(e){t.prototype.mouseDown.call(this,e),this.inAction=!0},e.prototype.mouseMove=function(e){t.prototype.mouseMove.call(this,e);var i,r={offsetX:this.currentPosition.x,width:3,height:3,offsetY:this.currentPosition.y};if(this.drawingObject||(this.drawingObject=this.commandHandler.drawObject(r)),this.inAction&&!1===wr.equals(this.currentPosition,this.prevPosition)){var o=xr.toBounds([this.prevPosition,this.currentPosition]);(i=this.commandHandler.checkBoundaryConstraints(void 0,void 0,o))&&this.commandHandler.updateNodeDimension(this.drawingObject,o)}return i},e.prototype.mouseUp=function(e){var i=xr.toBounds([this.prevPosition,this.currentPosition]);this.commandHandler.checkBoundaryConstraints(void 0,void 0,i),this.drawingObject&&this.drawingObject instanceof En&&(this.commandHandler.addObjectToDiagram(this.drawingObject),this.drawingObject=null),t.prototype.mouseUp.call(this,e),this.inAction=!1},e.prototype.endAction=function(){t.prototype.endAction.call(this)},e.prototype.mouseLeave=function(t){this.inAction&&this.mouseUp(t)},e}(fa),Sa=function(t){function e(e,i,r){var o=t.call(this,e,i)||this;return o.sourceObject=r,o}return ua(e,t),e.prototype.mouseDown=function(e){t.prototype.mouseDown.call(this,e),this.inAction=!0},e.prototype.mouseMove=function(e){if(this.inAction){var i={sourcePoint:this.currentPosition,targetPoint:this.currentPosition};this.drawingObject||(this.drawingObject=this.commandHandler.drawObject(i)),e.source=this.drawingObject,e.target&&this.commandHandler.connect(this.endPoint,e),this.endPoint="ConnectorTargetEnd"}return this.inAction||(this.commandHandler.updateSelector(),e.source&&e.sourceWrapper&&this.commandHandler.renderHighlighter(e,!0)),t.prototype.mouseMove.call(this,e),!this.blocked},e.prototype.mouseUp=function(e){this.drawingObject&&this.drawingObject instanceof Wo&&(this.commandHandler.addObjectToDiagram(this.drawingObject),this.drawingObject=null),this.inAction=!1,t.prototype.mouseUp.call(this,e)},e.prototype.endAction=function(){t.prototype.endAction.call(this)},e.prototype.mouseLeave=function(t){this.inAction&&this.mouseUp(t)},e}(ya),Pa=function(t){function e(e){return t.call(this,e,!0)||this}return ua(e,t),e.prototype.mouseDown=function(e){t.prototype.mouseDown.call(this,e),this.commandHandler.clearSelection();var i={shape:{type:"Text"},offsetX:this.currentPosition.x,width:50,height:20,offsetY:this.currentPosition.y};e.source||(this.drawingNode=this.commandHandler.drawObject(i))},e.prototype.mouseMove=function(e){if(t.prototype.mouseMove.call(this,e),this.drawingNode)this.drawingNode.style.strokeColor="black",this.drawingNode.style.strokeDashArray="2 2",this.drawingNode.style.fill="transparent";else{var i={shape:{type:"Text"},offsetX:this.currentPosition.x,width:30,height:30,style:{strokeDashArray:"2 2",fill:"transparent"},offsetY:this.currentPosition.y};this.drawingNode=this.commandHandler.drawObject(i)}if(this.inAction&&!1===wr.equals(this.currentPosition,this.prevPosition)){var r=xr.toBounds([this.prevPosition,this.currentPosition]);this.commandHandler.updateNodeDimension(this.drawingNode,r)}return!this.blocked},e.prototype.mouseUp=function(e){this.drawingNode?(this.drawingNode.style.strokeColor="none",this.drawingNode.style.fill="none"):this.drawingNode=e.source,this.drawingNode&&(this.drawingNode instanceof En||this.drawingNode instanceof Wo)&&this.commandHandler.addText(this.drawingNode,this.currentPosition),t.prototype.mouseUp.call(this,e),this.inAction=!1},e.prototype.endAction=function(){t.prototype.endAction.call(this)},e}(fa),Ca=function(t){function e(e,i){var r=t.call(this,e)||this;return r.zooming=i,r}return ua(e,t),e.prototype.mouseDown=function(e){t.prototype.mouseDown.call(this,e),this.inAction=!0},e.prototype.mouseMove=function(e){if(t.prototype.mouseMove.call(this,e),this.inAction)if(this.zooming||!1!==wr.equals(this.currentPosition,this.prevPosition)){if(e.moveTouches.length>=2){var i=e.startTouches[0],r=e.startTouches[1],o=e.moveTouches[0],n=e.moveTouches[1],a=this.getDistance(o,n)/this.getDistance(i,r),s=e.position;this.commandHandler.zoom(a,0,0,s),this.updateTouch(i,o),this.updateTouch(r,n)}}else{var h=this.currentPosition.x-this.prevPosition.x,d=this.currentPosition.y-this.prevPosition.y;this.commandHandler.scroll(h,d,this.currentPosition)}return!this.blocked},e.prototype.mouseUp=function(e){t.prototype.mouseUp.call(this,e),this.inAction=!1},e.prototype.endAction=function(){t.prototype.endAction.call(this)},e.prototype.getDistance=function(t,e){var i=e.pageX-t.pageX,r=e.pageY-t.pageY;return Math.sqrt(i*i+r*r)},e.prototype.updateTouch=function(t,e){t.pageX=e.pageX,t.pageY=e.pageY},e}(fa),Ta=function(t){function e(e){return t.call(this,e,!0)||this}return ua(e,t),e.prototype.mouseUp=function(e){this.commandHandler.initExpand(e),t.prototype.mouseUp.call(this,e)},e}(fa),Aa=function(t){function e(e){return t.call(this,e,!0)||this}return ua(e,t),e.prototype.mouseUp=function(e){window.open(e.sourceWrapper.hyperlink.link,"_blank").focus(),t.prototype.mouseUp.call(this,e)},e}(fa),Ma=function(t){function e(e){return t.call(this,e,!0)||this}return ua(e,t),e.prototype.mouseDown=function(e){if(t.prototype.mouseDown.call(this,e),this.inAction=!0,this.drawingObject){var i=void 0,r=this.drawingObject.shape;i={x:(i=r.points[r.points.length-1]).x,y:i.y},this.drawingObject.shape.points.push(i)}else{this.startPoint={x:this.startPosition.x,y:this.startPosition.y};var o={offsetX:this.currentPosition.x,offsetY:this.currentPosition.y,width:5,height:5,style:{strokeColor:"black",strokeWidth:1},shape:{type:"Basic",shape:"Polygon",points:[{x:this.startPoint.x,y:this.startPoint.y},{x:this.currentPosition.x,y:this.currentPosition.y}]}};this.drawingObject=this.commandHandler.drawObject(o)}},e.prototype.mouseMove=function(e){if(t.prototype.mouseMove.call(this,e),this.inAction){var i=this.drawingObject.shape;if(this.drawingObject&&this.currentPosition&&(i.points[i.points.length-1].x=this.currentPosition.x,i.points[i.points.length-1].y=this.currentPosition.y,this.drawingObject.wrapper.children[0].data=h(this.drawingObject.shape.points),this.inAction&&!1===wr.equals(this.currentPosition,this.prevPosition))){var r=xr.toBounds(this.drawingObject.shape.points);this.commandHandler.updateNodeDimension(this.drawingObject,r)}}return!0},e.prototype.mouseUp=function(e,i){t.prototype.mouseMove.call(this,e),this.inAction&&(this.inAction=!1,this.drawingObject&&this.commandHandler.addObjectToDiagram(this.drawingObject)),this.endAction()},e.prototype.mouseWheel=function(e){t.prototype.mouseWheel.call(this,e),this.mouseMove(e)},e.prototype.endAction=function(){this.inAction=!1,this.drawingObject=null},e}(fa),La=function(t){function e(e){return t.call(this,e,!0)||this}return ua(e,t),e.prototype.mouseMove=function(e){if(t.prototype.mouseMove.call(this,e),this.inAction){var i=this.drawingObject;i.targetPoint=this.currentPosition,this.commandHandler.updateConnectorPoints(i)}return!0},e.prototype.mouseDown=function(e){if(t.prototype.mouseDown.call(this,e),this.inAction=!0,this.drawingObject){var i=this.drawingObject,r=void 0;(r=new ko(i,"segments",{type:"Straight"},!0)).point=this.currentPosition,i.segments[i.segments.length-1]=r}else{var o={id:"Connector",type:"Straight",sourcePoint:this.currentPosition,targetPoint:this.currentPosition};this.drawingObject=this.commandHandler.drawObject(o)}},e.prototype.mouseWheel=function(e){t.prototype.mouseWheel.call(this,e),this.mouseMove(e)},e.prototype.mouseUp=function(e){t.prototype.mouseMove.call(this,e),this.inAction&&this.drawingObject&&this.commandHandler.addObjectToDiagram(this.drawingObject),this.endAction()},e.prototype.endAction=function(){this.drawingObject=null,this.inAction=!1},e}(fa),Oa=function(t){function e(e){return t.call(this,e,!0)||this}return ua(e,t),e.prototype.mouseDown=function(e){this.inAction=!0,this.undoElement=Xi(e.source),this.annotationId=e.sourceWrapper.id,t.prototype.mouseDown.call(this,e)},e.prototype.mouseMove=function(e){t.prototype.mouseMove.call(this,e);var i=this.currentPosition.x-this.prevPosition.x,r=this.currentPosition.y-this.prevPosition.y,o=e.source;if(o instanceof En){var n=m();b(n,-o.rotateAngle,0,0);var a=y(n,{x:i,y:r});i=a.x,r=a.y}return this.inAction&&(this.commandHandler.labelDrag(e.source,e.sourceWrapper,i,r),this.commandHandler.updateSelector()),this.prevPosition=this.currentPosition,!this.blocked},e.prototype.mouseUp=function(e){var i=e.source;this.inAction=!1;var r={type:"AnnotationPropertyChanged",objectId:this.annotationId,undoObject:Xi(this.undoElement),category:"Internal",redoObject:Xi(i)};this.commandHandler.addHistoryEntry(r),t.prototype.mouseUp.call(this,e)},e.prototype.mouseLeave=function(t){this.mouseUp(t)},e}(fa),Ia=function(t){function e(e,i){var r=t.call(this,e,!0)||this;return r.corner=i,r}return ua(e,t),e.prototype.mouseDown=function(e){this.inAction=!0;var i=e.source.nodes.length?e.source.nodes[0]:e.source.connectors[0];this.annotationId=e.source.wrapper.children[0].id,this.undoElement=Xi(i);var r=e.source.wrapper.children[0];this.initialBounds={x:r.offsetX,y:r.offsetY,width:r.actualSize.width,height:r.actualSize.height},t.prototype.mouseDown.call(this,e)},e.prototype.mouseMove=function(e){return t.prototype.mouseMove.call(this,e),this.inAction&&this.resizeObject(e),!this.blocked},e.prototype.mouseUp=function(e){var i=e.source.nodes.length?e.source.nodes[0]:e.source.connectors[0];this.inAction=!1;var r={type:"AnnotationPropertyChanged",objectId:this.annotationId,redoObject:Xi(i),undoObject:Xi(this.undoElement),category:"Internal"};this.commandHandler.addHistoryEntry(r),t.prototype.mouseUp.call(this,e)},e.prototype.mouseLeave=function(t){this.mouseUp(t)},e.prototype.resizeObject=function(t){var e;e=t.source.nodes.length?t.source.nodes[0]:t.source.connectors[0];var i,r,o=t.source.wrapper.children[0],n={x:o.offsetX,y:o.offsetY},a=o.rotateAngle;a=((a+=e instanceof En?e.rotateAngle:0)+360)%360;var s=m();b(s,a,n.x,n.y);var h=this.corner.slice(5),d=this.updateSize(o,this.startPosition,this.currentPosition,h,this.initialBounds,a),l=o.offsetX-o.actualSize.width*o.pivot.x,c=o.offsetY-o.actualSize.height*o.pivot.y,p=this.getPivot(h),g=y(s,p={x:l+o.actualSize.width*p.x,y:c+o.actualSize.height*p.y});d.x=g.x,d.y=g.y,i=d.width,r=d.height,i=i<0?1:i,r=r<0?1:r,this.commandHandler.labelResize(e,t.source.annotation,i,r,d,t.source),this.commandHandler.updateSelector()},e}(fa),Ea=function(t){function e(e){return t.call(this,e,!0)||this}return ua(e,t),e.prototype.mouseDown=function(e){this.inAction=!0,this.annotationId=e.source.wrapper.children[0].id;var i=e.source.nodes.length?e.source.nodes[0]:e.source.connectors[0];this.undoElement=Xi(i),t.prototype.mouseDown.call(this,e)},e.prototype.mouseMove=function(e){if(t.prototype.mouseMove.call(this,e),e.source&&this.inAction){var i=e.source.nodes[0]?e.source.nodes[0]:e.source.connectors[0],r=void 0;r=e.source.annotation,this.commandHandler.labelRotate(i,r,this.currentPosition,e.source),this.commandHandler.updateSelector()}return this.prevPosition=this.currentPosition,!this.blocked},e.prototype.mouseUp=function(e){this.inAction=!1;var i=e.source.nodes.length?e.source.nodes[0]:e.source.connectors[0],r={type:"AnnotationPropertyChanged",objectId:this.annotationId,redoObject:Xi(i),undoObject:Xi(this.undoElement),category:"Internal"};this.commandHandler.addHistoryEntry(r),t.prototype.mouseUp.call(this,e)},e.prototype.mouseLeave=function(t){this.mouseUp(t)},e}(fa),za=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Da=function(t){function e(e,i){var r=t.call(this,e,!0)||this;return r.endPoint=i,r}return za(e,t),e.prototype.mouseDown=function(e){this.inAction=!0,this.undoElement=Xi(e.source),t.prototype.mouseDown.call(this,e);var i;e.source&&e.source.connectors&&(i=e.source.connectors[0]);for(var r=0;r<i.segments.length;r++){var o=i.segments[r];if("OrthoThumb"===this.endPoint)for(var n=0;n<o.points.length-1;n++){var a={x:0,y:0};a.x=(o.points[n].x+o.points[n+1].x)/2,a.y=(o.points[n].y+o.points[n+1].y)/2,nr(this.currentPosition,a,30)&&(this.selectedSegment=o,this.segmentIndex=n)}else nr(this.currentPosition,o.point,10)&&(this.selectedSegment=o)}},e.prototype.mouseMove=function(e){if(t.prototype.mouseMove.call(this,e),this.currentPosition=e.position,this.currentPosition&&this.prevPosition){var i=this.currentPosition.y-this.prevPosition.y,r=this.currentPosition.x-this.prevPosition.x;this.currentPosition=this.commandHandler.snapConnectorEnd(this.currentPosition);var o=void 0;if(e.source&&e.source.connectors&&(o=e.source.connectors[0]),this.inAction&&void 0!==this.endPoint&&0!==r||0!==i){if("OrthoThumb"===this.endPoint)this.blocked=!this.dragOrthogonalSegment(o,this.selectedSegment,this.currentPosition,this.segmentIndex);else{var n=this.currentPosition.x-this.selectedSegment.point.x,a=this.currentPosition.y-this.selectedSegment.point.y,s=o.segments.indexOf(this.selectedSegment);this.blocked=!this.commandHandler.dragControlPoint(o,n,a,!1,s)}this.commandHandler.updateSelector()}}return this.prevPosition=this.currentPosition,!this.blocked},e.prototype.mouseUp=function(e){var i;if(e.source&&e.source.connectors&&(i=e.source.connectors[0]),e&&e.source&&e.info&&e.info.ctrlKey&&e.info.shiftKey&&"Straight"===i.type)this.addOrRemoveSegment(i,this.currentPosition);else if("OrthoThumb"===this.endPoint&&this.selectedSegment){var r=i.segments.indexOf(this.selectedSegment),o=i.segments[r-1],n=i.segments[r+1];if(r===i.segments.length-2&&this.updateLastSegment(i,this.selectedSegment))i.segments.splice(i.segments.length-2,1);else if(o&&Math.abs(o.length)<5)1!==r&&this.removePrevSegment(i,r);else if(n){var a=wr.distancePoints(n.points[0],n.points[1]),s=n.length||0===n.length?n.length:a;Math.abs(s)<=5&&this.removeNextSegment(i,r)}this.commandHandler.updateEndPoint(i)}if(this.undoElement){var h={type:"SegmentChanged",redoObject:Xi(e.source),undoObject:this.undoElement,category:"Internal"};this.commandHandler.addHistoryEntry(h)}t.prototype.mouseUp.call(this,e)},e.prototype.removePrevSegment=function(t,e){var i=t.segments[e-2],r=t.segments[e+1];if(!((r.length||0===r.length?r.length:wr.distancePoints(r.points[0],r.points[1]))<=5)){var o=t.segments[e+1];t.segments.splice(e-1,2);var n=this.selectedSegment;"Left"===n.direction||"Right"===n.direction?(i.points[i.points.length-1].x=o.points[0].x,o.points[0].y=i.points[i.points.length-1].y):(i.points[i.points.length-1].y=o.points[0].y,o.points[0].x=i.points[i.points.length-1].x),(n.length||0===n.length)&&this.findSegmentDirection(i),this.findSegmentDirection(o)}},e.prototype.findSegmentDirection=function(t){t.direction&&(t.length||0===t.length)&&(t.length=wr.distancePoints(t.points[0],t.points[t.points.length-1]),t.direction=wr.direction(t.points[0],t.points[t.points.length-1]))},e.prototype.removeNextSegment=function(t,e){var i=this.selectedSegment,r=t.segments[e-1],o=t.segments[e+2],n=t.segments[e+1];if(n.length||0===n.length?(t.segments.splice(e,2),"Top"===i.direction||"Bottom"===i.direction?(o.points[0].y=i.points[0].y,r.points[r.points.length-1].x=o.points[0].x):(o.points[0].x=i.points[0].x,r.points[r.points.length-1].y=o.points[0].y)):(t.segments.splice(e+1,1),"Top"===i.direction||"Bottom"===i.direction?r.points[r.points.length-1].x=n.points[n.points.length-1].x:r.points[r.points.length-1].y=n.points[n.points.length-1].y,this.findSegmentDirection(r),i.length=i.direction=null),r&&o&&(r.length=wr.distancePoints(r.points[0],o.points[0]),r.direction=wr.direction(r.points[0],o.points[0]),o.length||0===o.length)){o.length=wr.distancePoints(r.points[r.points.length-1],o.points[o.points.length-1]);var a=r.points,s=o.points;o.direction=wr.direction(a[a.length-1],s[s.length-1])}},e.prototype.addOrRemoveSegment=function(t,e){for(var i,r,o=0;o<t.segments.length;o++){nr(e,(n=t.segments[o]).point,t.hitPadding)&&(r=o,i=!0)}if(i&&void 0!==r){if(t.segments&&t.segments[r]&&"Straight"===t.segments[r].type){var n=t.segments[r],a=t.segments[r+1];a&&(t.segments.splice(r,1),a.points[0]=n.points[0])}}else{var s=this.findIndex(t,e);if(t.segments&&t.segments[s]&&"Straight"===t.segments[s].type){n=t.segments[s];var h=new ko(t,"segments",{type:"Straight",point:e},!0);h.points[0]=n.points[0],h.points[1]=e,n.points[0]=e,t.segments.splice(s,0,h),i=!0}}i&&this.commandHandler.updateEndPoint(t)},e.prototype.findIndex=function(t,e){for(var i=[],r=0;r<t.segments.length;r++){var o=t.segments[r],n=xr.toBounds([o.points[0],o.points[1]]);n.Inflate(t.hitPadding),n.containsPoint(e)&&i.push(o)}if(1===i.length)return t.segments.indexOf(i[0]);var a=void 0,s=void 0,h=void 0,d=void 0,l=void 0,c=void 0;for(r=0;r<i.length;r++)d=i[r],l=(e.y-d.points[0].y)/(d.points[1].y-e.y),c=(e.x-d.points[0].x)/(d.points[1].x-e.x),a=Math.abs(l-c),0===r&&(s=a,h=0),a<s&&(s=a,h=r);return t.segments.indexOf(i[h])},e.prototype.dragOrthogonalSegment=function(t,e,i,r){var o={x:0,y:0};o.x=(e.points[r].x+e.points[r+1].x)/2,o.y=(e.points[r].y+e.points[r+1].y)/2;var n=i.y-o.y,a=i.x-o.x,s=t.segments.indexOf(e),h=!1;e.points[0].y.toFixed(2),e.points[1].y.toFixed(2);return-1!==s&&(0===s&&1===t.segments.length&&2===e.points.length?(s=this.addSegments(t,e,a,n,s),h=!0):s!==t.segments.length-1||null!==e.direction&&null!==e.length?0===s&&(s=this.insertFirstSegment(t,e,a,n,s),h=!0):(s=this.addTerminalSegment(t,e,a,n,r),h=!0),h&&(this.selectedSegment=e=t.segments[s],this.segmentIndex=0),this.updateAdjacentSegments(t,s,a,n),this.commandHandler.updateEndPoint(t)),!0},e.prototype.addSegments=function(t,e,i,r,o){var n,a,s=[],h=wr.distancePoints(e.points[0],e.points[1]),d=wr.direction(e.points[0],e.points[1]);return s.push(new No(t,"segments",{type:"Orthogonal",direction:d,length:h/4},!0)),n=e.points[0].y===e.points[1].y?r>0?"Bottom":"Top":i>0?"Right":"Left",a=e.points[0].x===e.points[1].x?r:i,s.push(new No(t,"segments",{type:"Orthogonal",direction:n,length:a},!0)),s.push(new No(t,"segments",{type:"Orthogonal",direction:d,length:h/2},!0)),t.segments=s.concat(t.segments),o+2},e.prototype.insertFirstSegment=function(t,e,i,r,o){var n,a,s,h,d,l=[];if(t.sourcePortID&&e.length&&t.segments[0].points.length>2){t.segments.splice(0,1);for(var c=void 0,p=0;p<e.points.length-1;p++){var g=wr.distancePoints(e.points[p],e.points[p+1]),u=wr.direction(e.points[p],e.points[p+1]);0===(d=new No(t,"segments",{type:"Orthogonal",direction:u,length:g},!0)).length&&(!c||"Top"!==c.direction&&"Bottom"!==c.direction?d.direction=r>0?"Bottom":"Top":d.direction=i>0?"Right":"Left"),c=d,l.push(d)}t.segments=l.concat(t.segments),h=1}else{s={type:"Orthogonal",direction:e.direction,length:e.length/3},l.push(new No(t,"segments",s,!0)),"Bottom"===e.direction||"Top"===e.direction?(a=Math.abs(i),n=i>0?"Right":"Left"):(a=Math.abs(r),n=r>0?"Bottom":"Top"),d=new No(t,"segments",{type:"Orthogonal",direction:n,length:a},!0),l.push(d);var f=t.segments[1];f&&f.length&&(f.length=n!==f.direction?f.length+a:f.length-a),h=2,e.length=2*e.length/3,t.segments=l.concat(t.segments)}return h},e.prototype.updateAdjacentSegments=function(t,e,i,r){var o=t.segments[e],n=o.points[o.points.length-1],a=o.points[0],s=!0;if("Orthogonal"===o.type){o.points[0]=a,o.points[o.points.length-1]=n;if(t.segments[e-1]&&(s=this.updatePreviousSegment(i,r,t,e)),t.segments.length-1>e&&s){var h=t.segments[e+1];this.updateNextSegment(t,o,h,i,r)}}},e.prototype.addTerminalSegment=function(t,e,i,r,o){var n,a,s,h,d=t.segments.indexOf(e);t.segments.pop();var l=t.segments[t.segments.length-1];n=l&&"Orthogonal"===l.type?l:null;for(var c=0;c<e.points.length-2;c++)s=wr.distancePoints(e.points[c],e.points[c+1]),h=wr.direction(e.points[c],e.points[c+1]),a=new No(t,"segments",{type:"Orthogonal",length:s,direction:h},!0),t.segments.push(a),n=a;var p=o;if((2===e.points.length||p===e.points.length-2)&&(n&&(n.length+=5),void 0!==p)){var g=void 0;s=2*wr.distancePoints(e.points[e.points.length-2],e.points[e.points.length-1])/3,h=wr.direction(e.points[e.points.length-2],e.points[e.points.length-1]),g=new No(t,"segments",{type:"Orthogonal",length:s,direction:h}),t.segments.push(g)}var u=new No(t,"segments",{type:"Orthogonal"},!0);return t.segments.push(u),this.commandHandler.updateEndPoint(t),d+=o},e.prototype.updatePortSegment=function(t,e,i,r,o){if(1===i&&2===t.points.length&&t.length<0){var n=e.sourceWrapper.corners,a=e.segments[i],s=e.segments[i+1],h=void 0,d=[];h=new No(e,"segments",{type:"Orthogonal",length:13,direction:t.direction}),d.push(h);var l=void 0;l="Left"===a.direction?a.points[0].x-(n.middleLeft.x-20):"Right"===a.direction?n.middleRight.x+20-a.points[0].x:"Bottom"===a.direction?n.bottomCenter.y+20-a.points[0].y:a.points[0].y-(n.topCenter.y-20);a.direction;h=new No(e,"segments",{type:"Orthogonal",length:l,direction:a.direction}),d.push(h),a.length=a.length-l,s&&s.length&&s.direction&&(s.direction===t.direction?s.length-=13:s.direction===ft(t.direction)&&(s.length+=13)),e.segments=d.concat(e.segments),this.selectedSegment=e.segments[3]}},e.prototype.updatePreviousSegment=function(t,e,i,r){var o=i.segments[r],n=i.segments[r-1];n.points[n.points.length-1]=o.points[0];var a=!i.sourceID||""!==i.sourcePortID,s=!0;return"Orthogonal"===n.type&&("Bottom"===n.direction?n.length+=e:"Top"===n.direction?n.length-=e:"Right"===n.direction?n.length+=t:n.length-=t,""!==i.sourcePortID&&n.length<0?this.updatePortSegment(n,i,r,t,e):i.sourceID&&""===i.sourcePortID&&n.length<0&&1===r&&(s=!1,this.updateFirstSegment(i,o)),a&&this.changeSegmentDirection(n)),s},e.prototype.changeSegmentDirection=function(t){t.length<0&&(t.direction=ft(t.direction),t.length*=-1)},e.prototype.updateNextSegment=function(t,e,i,r,o){e.points[e.points.length-1];i.points[0]=e.points[e.points.length-1],i&&"Orthogonal"===i.type&&(i.length||0===i.length)&&("Left"===i.direction||"Right"===i.direction?0!==r&&(i.length="Right"===i.direction?i.length-r:i.length+r,(i.length||0===i.length)&&this.changeSegmentDirection(i)):0!==o&&(i.length="Bottom"===i.direction?i.length-o:i.length+o,(i.length||0===i.length)&&this.changeSegmentDirection(i)))},e.prototype.updateFirstSegment=function(t,e){var i,r=t.segments.indexOf(e),o=!1,n=t.segments[r],a=t.segments[r-1];if(a.length<0&&t.sourceID){var s=t.sourceWrapper.corners,h=[],d=void 0,l=!1;this.changeSegmentDirection(n);var c=t.segments[r+1],p=t.segments[r+2];switch(c&&this.changeSegmentDirection(c),p&&this.changeSegmentDirection(p),a.direction){case"Top":case"Bottom":i=n.length>0&&"Left"===n.direction?s.middleLeft:s.middleRight,n.length>s.width/2?Math.abs(a.length)<s.height/2&&(a.length=wr.distancePoints(s.center,a.points[a.points.length-1]),n.points[0].x=i.x,n.length=wr.distancePoints(n.points[0],n.points[n.points.length-1]),n.length-=20,o=!0):(c&&c.direction&&c.length&&(c.points[0].y=i.y,c.points[0].x=c.points[c.points.length-1].x="Right"===n.direction?i.x+20:i.x-20),o=!0,l=!0);break;case"Left":case"Right":i=n.length>0&&"Top"===n.direction?s.topCenter:s.bottomCenter,n.length>s.height/2?Math.abs(a.length)<s.width/2&&(a.length=wr.distancePoints(s.center,a.points[a.points.length-1]),n.points[0].y=i.y,n.length=wr.distancePoints(n.points[0],n.points[n.points.length-1]),n.length-=20,o=!0):(c&&c.direction&&c.length&&(c.points[0].x=i.x,c.points[0].y=c.points[c.points.length-1].y="Bottom"===n.direction?i.y+20:i.y-20),o=!0,l=!0)}this.changeSegmentDirection(a),this.changeSegmentDirection(n),o&&(d={type:"Orthogonal",direction:n.direction,length:20},h.push(new No(t,"segments",d,!0)),l&&(c&&c.direction&&c.length&&(c.length=wr.distancePoints(c.points[0],c.points[c.points.length-1])),p&&p.direction&&p.length&&(p.length=wr.distancePoints(c.points[c.points.length-1],p.points[p.points.length-1])),t.segments.splice(r-1,2)),t.segments=h.concat(t.segments)),this.selectedSegment=l?t.segments[r-1]:t.segments[r+1],this.commandHandler.updateEndPoint(t)}},e.prototype.updateLastSegment=function(t,e){if(t.targetID&&""===t.targetPortID){var i=void 0,r=void 0,o=void 0,n=void 0,a=t.targetWrapper.corners,s=e.points[0],h=e.points[e.points.length-1];"Right"===e.direction||"Left"===e.direction?(i={x:s.x,y:s.y},r={x:"Left"===e.direction?h.x-a.width/2:h.x+a.width/2,y:h.y},o={x:a.center.x,y:a.center.y-a.height},n={x:a.center.x,y:a.center.y+a.height}):(i={x:s.x,y:s.y},r={x:h.x,y:"Bottom"===e.direction?h.y+a.height/2:h.y-a.height/2},o={x:a.center.x-a.width,y:a.center.y},n={x:a.center.x+a.width,y:a.center.y});return Le({x1:i.x,y1:i.y,x2:r.x,y2:r.y},{x1:o.x,y1:o.y,x2:n.x,y2:n.y}).enabled}return!1},e.prototype.destroy=function(){},e.prototype.getModuleName=function(){return"ConnectorEditingTool"},e}(fa),ka=function(){function e(t,e){this.currentAction="None",this.focus=!1,this.isBlocked=!1,this.isMouseDown=!1,this.inAction=!1,this.doingAutoScroll=!1,this.diagram=null,this.objectFinder=null,this.tool=null,this.eventArgs=null,this.diagram=t,this.objectFinder=new Ra,this.commandHandler=e}return Object.defineProperty(e.prototype,"action",{get:function(){return this.currentAction},set:function(e){e!==this.currentAction&&("PortDraw"===this.currentAction&&(this.diagram.tool&=~t.DiagramTools.DrawOnce,this.tool&&this.tool.mouseUp({position:this.currentPosition}),this.tool=null),"Rotate"===e||"LabelRotate"===e?this.diagram.diagramCanvas.classList.add("e-diagram-rotate"):"Rotate"!==this.currentAction&&"LabelRotate"!==this.currentAction||this.diagram.diagramCanvas.classList.remove("e-diagram-rotate"),this.currentAction=e,"None"===this.currentAction||"Select"===this.currentAction||this.diagram.diagramActions&t.DiagramAction.TextEdit?this.diagram.diagramActions=this.diagram.diagramActions&~t.DiagramAction.ToolAction:this.diagram.diagramActions=this.diagram.diagramActions|t.DiagramAction.ToolAction,this.diagram.setCursor(this.diagram.getCursor(e,this.inAction)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blocked",{get:function(){return this.isBlocked},set:function(t){this.isBlocked=t,this.blocked?this.diagram.setCursor("not-allowed"):this.diagram.setCursor(this.diagram.getCursor(this.action,this.inAction))},enumerable:!0,configurable:!0}),e.prototype.getMousePosition=function(t){var e,i,r;-1!==t.type.indexOf("touch")?(i=(e=t).changedTouches[0].clientX,r=e.changedTouches[0].clientY):(i=t.clientX,r=t.clientY);var o=new yr;o=me(this.diagram);var n=this.diagram.element.getBoundingClientRect();return i=i+this.diagram.diagramCanvas.scrollLeft-n.left-o.width,r=r+this.diagram.diagramCanvas.scrollTop-n.top-o.height,i/=this.diagram.scroller.transform.scale,r/=this.diagram.scroller.transform.scale,i-=this.diagram.scroller.transform.tx,r-=this.diagram.scroller.transform.ty,{x:i,y:r}},e.prototype.windowResize=function(t){var e=this;return this.resizeTo&&clearTimeout(this.resizeTo),this.resizeTo=setTimeout(function(){e.updateViewPortSize(e.diagram.element)},300),!1},e.prototype.updateViewPortSize=function(t){var e=document.getElementById(t.id);if(e){var i=e.getBoundingClientRect();this.diagram.scroller.setViewPortSize(i.width,i.height);var r=new yr;r=me(this.diagram);var o=this.diagram.getSizeValue(this.diagram.width,r.width),n=this.diagram.getSizeValue(this.diagram.height,r.height);this.diagram.diagramCanvas.style.width=o,this.diagram.diagramCanvas.style.height=n,this.diagram.scroller.setSize(),this.diagram.transformLayers(),this.diagram.rulerSettings.showRulers&&ue(this.diagram)}},e.prototype.canHideResizers=function(){return(this.tool instanceof va||this.tool instanceof ba)&&this.isMouseDown},e.prototype.updateCursor=function(){if(1===this.diagram.selectedItems.nodes.length||1===this.diagram.selectedItems.connectors.length){var t=[];t=t.concat(this.diagram.selectedItems.nodes,this.diagram.selectedItems.connectors),this.blocked=this.isMouseDown&&1===t.length&&this.tool instanceof ma&&!St(t[0])}},e.prototype.isForeignObject=function(t,e){var i=t;if(i)for(;null!==i.parentNode;){if("string"==typeof i.className&&(!e&&-1!==i.className.indexOf("foreign-object")||e&&-1!==i.className.indexOf("e-diagram-text-edit")))return i;i=i.parentNode}return null},e.prototype.isMetaKey=function(t){return navigator.platform.match("Mac")?t.metaKey:t.ctrlKey},e.prototype.renderUmlHighLighter=function(t){this.diagram.commandHandler.removeStackHighlighter();var e=this.diagram.selectedItems.nodes[0];if(e&&e.container&&"Stack"===e.container.type&&"UmlClassifier"===e.shape.type){if(!e.wrapper.bounds.containsPoint(this.currentPosition)){var i=this.diagram.findObjectsUnderMouse({x:this.currentPosition.x-20,y:this.currentPosition.y}),r=this.diagram.findObjectUnderMouse(i,this.action,this.inAction);if(r&&r.parentId&&r.parentId===e.id){var o="Vertical"===this.diagram.nameTable[r.parentId].container.orientation;ie(r.wrapper,o,t.position,this.diagram,!0)}}}},e.prototype.isDeleteKey=function(t,e){return navigator.platform.match("Mac")&&"Backspace"===t&&"delete"===e},e.prototype.isMouseOnScrollBar=function(t){var e,i,r,o,n=t.offsetX,a=t.offsetY,s=this.diagram.diagramCanvas,h=s.offsetHeight,d=s.offsetWidth;return!!(h<s.scrollHeight&&(e={x:d-17,y:0},i={x:d,y:0},r={x:d-17,y:h},o={x:d,y:h},xr.toBounds([e,i,r,o]).containsPoint({x:n,y:a})))||!!(d<s.scrollWidth&&(e={x:0,y:h-17},i={x:d,y:h-17},r={x:0,y:h},o={x:d,y:h},xr.toBounds([e,i,r,o]).containsPoint({x:n,y:a})))},e.prototype.updateVirtualization=function(){var t,e=this;t=setInterval(function(i){e.diagram.removeVirtualObjects(t)},50),setTimeout(function(){e.diagram.deleteVirtualObject=!0},50)},e.prototype.mouseDown=function(e){this.focus=!0;var i;if(i=e.touches,this.isMouseOnScrollBar(e))return this.isScrolling=!0,void e.preventDefault();if(!this.checkEditBoxAsTarget(e)&&_t(this.diagram)||Bt(this.diagram)&&!Wt(this.diagram))if("Select"!==this.action&&"Drag"!==this.action||this.diagram.updatePortVisibility(this.hoverElement,t.PortVisibility.Hover,!0),!(this.tool instanceof Ma||this.tool instanceof La)||2!==e.button&&2!==e.buttons)if(!0===this.inAction&&!0===this.isMouseDown&&(this.tool instanceof Ma||this.tool instanceof La))this.isMouseDown=!0,this.eventArgs={},this.getMouseEventArgs(this.currentPosition,this.eventArgs),this.eventArgs.position=this.currentPosition,this.tool.mouseDown(this.eventArgs);else{this.isMouseDown=!0,this.currentPosition=this.prevPosition=this.getMousePosition(e),this.eventArgs={},this.diagram.textEditing&&!this.isMouseOnScrollBar(e)&&(this.diagram.endEdit(),this.diagram.textEditing=!1);var r=void 0,o=this.objectFinder.findObjectsUnderMouse(this.currentPosition,this.diagram,this.eventArgs,null,this.action),n=this.objectFinder.findObjectUnderMouse(this.diagram,o,this.action,this.inAction,this.eventArgs,e),a=null;null!==n&&(a=this.diagram.findElementUnderMouse(n,this.currentPosition))&&(r=this.commandHandler.findTarget(a,n)),this.action=this.diagram.findActionToBeDone(n,a,this.currentPosition,r);var s=this.isMetaKey(e);if(s&&e.shiftKey&&this.diagram.connectorEditingToolModule?this.action="SegmentEnd":!s&&!e.shiftKey||Bt(this.diagram)||(this.action="Select"),this.tool=this.diagram.getTool(this.action),this.tool||(this.action="Select",this.tool=this.diagram.getTool(this.action)),this.getMouseEventArgs(this.currentPosition,this.eventArgs),s||e.shiftKey){var h=s&&e.shiftKey?{ctrlKey:s,shiftKey:e.shiftKey}:{ctrlKey:!0};this.eventArgs.info=h}this.eventArgs.position=this.currentPosition,this.tool.mouseDown(this.eventArgs),this.initialEventArgs={source:this.eventArgs.source,sourceWrapper:this.eventArgs.sourceWrapper},this.initialEventArgs.position=this.currentPosition,this.initialEventArgs.info=this.eventArgs.info,this.inAction=!1,"touchstart"===e.type&&(i&&i.length>=2&&(this.touchStartList=Di(this.touchStartList,0,i)),i||e.preventDefault())}else{this.diagram,this.currentPosition,e.buttons,this.eventArgs.actualObject;this.inAction=!1,this.tool.mouseUp(this.eventArgs)}this.isForeignObject(e.target)||this.isForeignObject(e.target,!0)||i||e.preventDefault()},e.prototype.mouseMoveExtend=function(e,i){(this.tool instanceof Ma||this.tool instanceof La)&&this.tool.mouseMove(this.eventArgs),this.diagram.scrollSettings.canAutoScroll?this.checkAutoScroll(e):this.blocked||this.tool.mouseMove(this.eventArgs),this.eventArgs.target&&(this.hoverElement=this.eventArgs.target);var r=!(this.eventArgs.target instanceof En&&i instanceof En);this.tool instanceof ya&&this.diagram.updatePortVisibility(this.hoverElement instanceof En?this.hoverElement:this.hoverNode,t.PortVisibility.Connect|t.PortVisibility.Hover,r),this.hoverElement instanceof En&&this.hoverNode instanceof En&&this.hoverNode&&this.hoverNode.id!==this.hoverElement.id&&this.diagram.updatePortVisibility(this.hoverNode,t.PortVisibility.Connect|t.PortVisibility.Hover,!0),this.hoverElement=r?null:i,this.hoverNode=r?null:i},e.prototype.checkAction=function(t){if("LabelSelect"===this.action&&this.eventArgs.sourceWrapper&&(this.eventArgs.sourceWrapper instanceof Gr||this.eventArgs.sourceWrapper instanceof Po)){var e=this.commandHandler.findTarget(this.eventArgs.sourceWrapper,this.eventArgs.source);!hr(this.diagram,e,!1,this.eventArgs.sourceWrapper)&&St(e)&&(this.action="LabelDrag",this.tool=this.getTool(this.action),this.tool.mouseDown(this.initialEventArgs))}else St(t)&&xt(t)&&this.initialEventArgs&&this.initialEventArgs.source&&"Select"===this.action&&(!hr(this.diagram,this.eventArgs.source,!1)&&this.eventArgs.source instanceof Vo&&this.getMouseEventArgs(this.currentPosition,this.eventArgs),t instanceof Wo&&(!(t instanceof Wo)||nr(this.currentPosition,t.sourcePoint,t.hitPadding)||nr(this.currentPosition,t.targetPoint,t.hitPadding))||(this.action="Drag"),this.tool=this.getTool(this.action),this.tool.mouseDown(this.initialEventArgs))},e.prototype.mouseMove=function(e,i){if(this.focus=!0,this.isScrolling)e.preventDefault();else if(_t(this.diagram)||Bt(this.diagram)&&!Wt(this.diagram)){this.currentPosition=this.getMousePosition(e);var r=this.diagram.findObjectsUnderMouse(this.currentPosition),o=this.diagram.findObjectUnderMouse(r,this.action,this.inAction);!function(t,e){t.rulerSettings.showRulers&&(t.hRuler.drawRulerMarker(t.hRuler.element,e,t.scroller.horizontalOffset),t.vRuler.drawRulerMarker(t.vRuler.element,e,t.scroller.verticalOffset))}(this.diagram,this.currentPosition);var n=!1,a=void 0;if("touchmove"===e.type&&(i=e.touches)&&i.length>1&&(this.touchMoveList=Di(this.touchMoveList,0,i),"PinchZoom"!==this.action&&(n=!0)),!1===wr.equals(this.currentPosition,this.prevPosition)||this.inAction){if(!1===this.isMouseDown||n){this.eventArgs={};var s=null;null!==o&&(s=this.diagram.findElementUnderMouse(o,this.currentPosition),o!==this.hoverElement?(this.hoverElement&&(this.elementLeave(),this.diagram.updatePortVisibility(this.hoverElement,t.PortVisibility.Hover,!0)),o instanceof En&&(this.hoverNode=o),this.hoverElement=o,this.elementEnter(this.currentPosition,!1)):this.hoverElement||this.hoverElement!==o||this.elementEnter(this.currentPosition,!0),s&&(a=this.commandHandler.findTarget(s,o))),this.action=this.diagram.findActionToBeDone(o,s,this.currentPosition,a),this.getMouseEventArgs(this.currentPosition,this.eventArgs),this.tool=this.getTool(this.action),this.mouseEvents(),this.tool instanceof Sa||this.tool instanceof La||this.tool instanceof Ma?this.tool.mouseMove(this.eventArgs):i&&this.tool instanceof Ca&&this.tool.mouseDown(this.eventArgs),this.updateCursor(),this.renderUmlHighLighter(this.eventArgs);var h=!1;(!this.hoverElement||this.tool instanceof Ca||!(o instanceof En)||0!==this.diagram.selectedItems.nodes.length&&hr(this.diagram,this.hoverElement))&&(h=!0),this.diagram.updatePortVisibility(this.hoverElement,t.PortVisibility.Hover,h),null===o&&this.hoverElement&&(this.hoverElement=null,this.elementLeave()),n=!1}else{if(this.eventArgs.position=this.currentPosition,"Drag"===this.action&&!hr(this.diagram,this.eventArgs.source,!1)&&this.eventArgs.source instanceof Vo&&this.getMouseEventArgs(this.currentPosition,this.eventArgs),this.mouseEvents(),e.ctrlKey||e.shiftKey){var d=e.ctrlKey&&e.shiftKey?{ctrlKey:e.ctrlKey,shiftKey:e.shiftKey}:{ctrlKey:!0};this.eventArgs.info=d}this.checkAction(o),this.getMouseEventArgs(this.currentPosition,this.eventArgs,this.eventArgs.source),this.updateCursor(),this.inAction=!0,this.initialEventArgs=null,this.mouseMoveExtend(e,o)}this.prevPosition=this.currentPosition,this.isForeignObject(e.target,!0)||e.preventDefault()}}},e.prototype.checkAutoScroll=function(t){var e=this.startAutoScroll(t);if(!e&&this.doingAutoScroll)this.doingAutoScroll=!1,clearInterval(this.timeOutValue);else if(e){if((this.tool instanceof va||this.tool instanceof wa||this.tool instanceof ma)&&this.inAction){var i=this;this.diagram.scrollSettings.canAutoScroll&&e&&!this.doingAutoScroll&&(this.doingAutoScroll=!0,this.timeOutValue=setInterval(function(r){i.doAutoScroll(e,t,100)},100))}}else this.blocked=!this.tool.mouseMove(this.eventArgs)},e.prototype.mouseUp=function(e){var i;if("SVG"===this.diagram.mode&&Rt(this.diagram)&&this.updateVirtualization(),i=e.touches,this.isScrolling)return this.isScrolling=!1,void e.preventDefault();if(!this.checkEditBoxAsTarget(e)&&_t(this.diagram)||Bt(this.diagram)&&!Wt(this.diagram)){if(this.tool&&(!(this.tool instanceof Ma||this.tool instanceof La)||(this.tool instanceof Ma||this.tool instanceof La)&&2===e.detail)){if(!this.isForeignObject(e.target)&&this.isMouseDown&&document.getElementById(this.diagram.element.id+"content").focus(),!this.inAction&&3!==e.which&&"Drag"===this.action){this.action="Select";var r=this.diagram.findObjectsUnderMouse(this.currentPosition),o=this.diagram.findObjectUnderMouse(r,this.action,this.inAction),n=!0;!e.ctrlKey&&this.isMouseDown&&this.diagram.selectedItems.nodes.length+this.diagram.selectedItems.connectors.length>1&&1===e.which&&(n=!1,this.commandHandler.clearSelection()),hr(this.diagram,o)&&n||this.commandHandler.selectObjects([o])}var a=this.updateContainerProperties();if(this.addUmlNode(),this.inAction=!1,this.isMouseDown=!1,this.currentPosition=this.getMousePosition(e),this.tool&&(this.tool.prevPosition||this.tool instanceof Aa)){this.eventArgs.position=this.currentPosition,this.getMouseEventArgs(this.currentPosition,this.eventArgs,this.eventArgs.source);var s=this.isMetaKey(e);if(s||e.shiftKey){var h=s&&e.shiftKey?{ctrlKey:s,shiftKey:e.shiftKey}:{ctrlKey:!0};this.eventArgs.info=h}this.eventArgs.clickCount=e.detail,this.tool.mouseUp(this.eventArgs),a&&this.diagram.endGroupAction()}if(this.diagram.selectedObject.helperObject){var d=this.tool instanceof wa;this.diagram.remove(this.diagram.selectedObject.helperObject);o=this.diagram.selectedObject.actualObject;this.diagram.updateDiagramObject(o),this.diagram.selectedObject={helperObject:void 0,actualObject:void 0},qt(this.diagram,o,this.eventArgs.position,d),this.diagram.updateSelector()}if(this.blocked=!1,this.hoverElement){var l=t.PortVisibility.Connect;hr(this.diagram,this.hoverElement)&&(l|=t.PortVisibility.Hover),this.diagram.updatePortVisibility(this.hoverElement,l,!0),this.hoverElement=null}this.touchStartList=null,this.touchMoveList=null,this.tool instanceof Pa||(this.tool=null)}i||e.preventDefault(),this.diagram.currentDrawingObject=void 0;var c=this.diagram.selectedItems;if(!this.inAction&&c.wrapper&&c.userHandles.length>0&&this.diagram.renderSelector(!0),!this.inAction&&!this.diagram.currentSymbol&&this.eventArgs){var p={element:this.eventArgs.source||this.diagram,position:this.eventArgs.position,count:e.detail,actualObject:this.eventArgs.actualObject};this.diagram.triggerEvent(t.DiagramEvent.click,p)}this.eventArgs={}}this.eventArgs={},this.diagram.commandHandler.removeStackHighlighter()},e.prototype.mouseLeave=function(e){this.tool&&this.inAction&&this.tool.mouseLeave(this.eventArgs),this.eventArgs&&this.eventArgs.source&&(this.diagram.updatePortVisibility(this.eventArgs.source,t.PortVisibility.Hover,!0),this.hoverElement=null),this.tool instanceof ya&&this.eventArgs&&this.eventArgs.target&&this.eventArgs.target instanceof En&&(this.diagram.updatePortVisibility(this.eventArgs.target,t.PortVisibility.Hover|t.PortVisibility.Connect,!0),this.hoverElement=null);var i=this.diagram.selectedItems;i&&i.wrapper&&this.diagram.renderSelector(!0),this.isMouseDown=!1,this.focus=!1,this.touchStartList=null,this.touchMoveList=null,this.commandHandler.removeSnap(),this.inAction=!1,this.eventArgs={},this.tool=null,function(){var t,e,i=document.getElementsByClassName("e-d-ruler-marker");if(i&&i.length>0)for(e=i.length-1;e>=0;e--)(t=i[e])&&t.parentNode.removeChild(t)}(),"Rotate"===this.action&&this.diagram.diagramCanvas.classList.remove("e-diagram-rotate"),e.preventDefault()},e.prototype.mouseWheel=function(t){var e=t.wheelDelta>0||-40*t.detail>0,i=this.getMousePosition(t);this.diagram.tooltipObject.close();if(this.isMetaKey(t))this.diagram.zoom(e?1.2:1/1.2,i),t.preventDefault();else{var r=this.diagram.scroller.horizontalOffset,o=this.diagram.scroller.verticalOffset,n=e?20:-20;this.tool&&(this.tool instanceof Ma||this.tool instanceof La)&&(this.eventArgs={},this.getMouseEventArgs(i,this.eventArgs),this.eventArgs.position=i,this.tool.mouseWheel(this.eventArgs)),t.shiftKey?this.diagram.scroller.zoom(1,n,0,i):this.diagram.scroller.zoom(1,0,n,i),r===this.diagram.scroller.horizontalOffset&&o===this.diagram.scroller.verticalOffset||t.preventDefault()}this.diagram.textEditing&&(this.diagram.isTriggerEvent=!0,this.diagram.startTextEdit(),this.diagram.isTriggerEvent=!1)},e.prototype.keyDown=function(e){if(!(this.diagram.diagramActions&t.DiagramAction.TextEdit)&&!this.checkEditBoxAsTarget(e)||"Escape"===e.key||27===e.keyCode){var i=void 0,r=e.keyCode?e.keyCode:e.which,o=e.key,n=this.isMetaKey(e);if(this.diagram.commandManager&&this.diagram.commands)for(var a=this.diagram.commands,s=0,h=Object.keys(a);s<h.length;s++){var d=h[s];if((i=this.diagram.commands[d])&&(i.gesture.keyModifiers||i.gesture.key)&&(r===i.gesture.key||o===t.Keys[i.gesture.key]||this.isDeleteKey(o,d))&&(!i.gesture.keyModifiers&&!e.altKey&&!e.shiftKey&&!n||i.gesture.keyModifiers&&(n||e.altKey||e.shiftKey)&&this.altKeyPressed(i.gesture.keyModifiers)&&e.altKey||this.shiftKeyPressed(i.gesture.keyModifiers)&&e.shiftKey||this.ctrlKeyPressed(i.gesture.keyModifiers)&&n)){var l=ir(i.canExecute);if(l&&l({keyDownEventArgs:KeyboardEvent,parameter:i.parameter})){if(e.preventDefault(),"Escape"===e.key&&this.checkEditBoxAsTarget(e)&&document.getElementById(this.diagram.diagramCanvas.id).focus(),i.execute){ir(i.execute)({keyDownEventArgs:KeyboardEvent,parameter:i.parameter})}break}}}}},e.prototype.startAutoScroll=function(t){var e=this.getMousePosition(t);e.x*=this.diagram.scroller.currentZoom,e.y*=this.diagram.scroller.currentZoom;var i,r=me(this.diagram),o=this.diagram.scrollSettings.autoScrollBorder;return this.diagram.scrollSettings.canAutoScroll&&(e.x+this.diagram.scroller.horizontalOffset+o.right+r.width>=this.diagram.scroller.viewPortWidth-18?i="right":e.x+this.diagram.scroller.horizontalOffset<o.left?i="left":e.y+this.diagram.scroller.verticalOffset+o.bottom+r.height>this.diagram.scroller.viewPortHeight-18?i="bottom":e.y+this.diagram.scroller.verticalOffset<o.top&&(i="top")),i},e.prototype.doAutoScroll=function(t,e,i,r){var o=t;if((this.tool instanceof va||this.tool instanceof wa||this.tool instanceof ma)&&this.inAction){var n=this.getMousePosition(e),a=(this.diagram.scrollSettings.autoScrollBorder,0),s=0,h={x:n.x,y:n.y};switch(o){case"right":h.x=n.x+10,a=10;break;case"left":h.x=n.x-10,a=-10;break;case"bottom":h.y=n.y+10,s=10;break;case"top":h.y=n.y-10,s=-10}this.eventArgs.position={x:h.x,y:h.y},this.tool.mouseMove(this.eventArgs),this.diagram.scroller.zoom(1,-a,-s,n)}},e.prototype.mouseEvents=function(){for(var e=this.diagram.findObjectsUnderMouse(this.currentPosition),i=0;i<e.length;i++)this.eventArgs.actualObject===e[i]&&e.splice(i,1);var r={targets:e,element:this.eventArgs.source===this.eventArgs.actualObject?void 0:this.eventArgs.source,actualObject:this.eventArgs.actualObject};if(this.lastObjectUnderMouse&&(!this.eventArgs.actualObject||this.lastObjectUnderMouse!==this.eventArgs.actualObject)){var o={targets:void 0,element:this.lastObjectUnderMouse,actualObject:void 0};this.diagram.triggerEvent(t.DiagramEvent.mouseLeave,o),this.lastObjectUnderMouse=null}(!this.lastObjectUnderMouse&&this.eventArgs.source||this.lastObjectUnderMouse!==this.eventArgs.actualObject)&&(this.lastObjectUnderMouse=this.eventArgs.actualObject,this.diagram.triggerEvent(t.DiagramEvent.mouseEnter,r)),this.eventArgs.actualObject&&this.diagram.triggerEvent(t.DiagramEvent.mouseOver,r)},e.prototype.elementEnter=function(e,i){if(!i){var r=this.hoverElement instanceof En&&this.hoverElement.constraints&t.NodeConstraints.Tooltip||this.hoverElement instanceof Wo&&this.hoverElement.constraints&t.ConnectorConstraints.Tooltip;D(this.diagram,r?this.hoverElement:void 0);var o=ze(this.diagram,e,this.hoverElement);this.diagram.tooltipObject.close(),this.diagram.tooltipObject.offsetX=o.x,this.diagram.tooltipObject.offsetY=o.y,this.diagram.tooltipObject.dataBind(),function(e,i){var r=0;return e instanceof Wo?e.constraints&t.ConnectorConstraints.Tooltip?r=e.constraints&t.ConnectorConstraints.Tooltip:e.constraints&t.ConnectorConstraints.InheritTooltip&&(r=i.constraints&t.DiagramConstraints.Tooltip):e.constraints&t.NodeConstraints.Tooltip?r=e.constraints&t.NodeConstraints.Tooltip:e.constraints&t.NodeConstraints.InheritTooltip&&(r=i.constraints&t.DiagramConstraints.Tooltip),r}(this.hoverElement,this.diagram)&&this.diagram.tooltipObject.open(this.diagram.element)}},e.prototype.elementLeave=function(){this.diagram.tooltipObject.close()},e.prototype.altKeyPressed=function(e){return!!(e&t.KeyModifiers.Alt)},e.prototype.ctrlKeyPressed=function(e){return!!(e&t.KeyModifiers.Control)},e.prototype.shiftKeyPressed=function(e){return!!(e&t.KeyModifiers.Shift)},e.prototype.scrolled=function(t){this.diagram.updateScrollOffset()},e.prototype.doubleClick=function(e){if(_t(this.diagram)){var i=void 0,r=this.diagram.findObjectsUnderMouse(this.currentPosition),o=this.diagram.findObjectUnderMouse(r,this.action,this.inAction);if(null!==o&&_t(this.diagram))if(i=this.diagram.findElementUnderMouse(o,this.currentPosition),this.tool&&(this.tool instanceof Ma||this.tool instanceof La)){o||this.diagram,this.currentPosition,e.detail;this.tool.mouseUp(this.eventArgs),this.isMouseDown=!1,this.eventArgs={},this.tool=null,e.preventDefault()}else{var n=this.diagram.commandHandler.getObjectLayer(o.id);if(n&&!n.lock&&n.visible&&!(this.diagram.diagramActions&t.DiagramAction.TextEdit)){var a="";"TextAnnotation"===o.shape.shape&&(a=o.id.split("_textannotation_")[1]),this.diagram.startTextEdit(o,a||(i instanceof Gr?i.id.split(o.id+"_")[1]:void 0))}}var s={source:o||this.diagram,position:this.currentPosition,count:e.detail};this.diagram.triggerEvent(t.DiagramEvent.doubleClick,s)}},e.prototype.itemClick=function(t,e){var i=t;return $t(this.diagram,i,!0)?i:null},e.prototype.inputChange=function(t){var e,i,r,o,n,a,s,h,d,l=document.getElementById(this.diagram.element.id+"_editBox"),c=document.getElementById(this.diagram.element.id+"_editTextBoxDiv"),p=l.value,g=p.split("\n");!(o=this.diagram.selectedItems.nodes[0]?this.diagram.selectedItems.nodes[0]:this.diagram.selectedItems.connectors[0])&&this.tool instanceof Pa&&(o=this.diagram.nameTable[this.diagram.activeLabel.parentId]),o&&("Text"!==o.shape.type&&o.annotations.length>0||"Text"===o.shape.type)&&(r=this.diagram.getWrapper(o.wrapper,this.diagram.activeLabel.id),e=(e=o.wrapper.bounds.width<r.bounds.width?o.wrapper.bounds.width:r.bounds.width)>90?e:90,s=yi(r.style,p,void 0,void 0,e),i=Number(l.style.fontSize.split("px")[0]),g.length>1&&""===g[g.length-1]&&(s.height=s.height+i),h=this.diagram.scroller.transform,d=Xt(this.diagram)?h.scale:1,a=(90>(a=s.width)?90:a)*d,n=(12>s.height?12:s.height)*d,c.style.left=(r.bounds.center.x+h.tx)*h.scale-a/2-2.5+"px",c.style.top=(r.bounds.center.y+h.ty)*h.scale-n/2-3+"px",c.style.width=a+"px",c.style.height=n+"px",l.style.minHeight="12px",l.style.minWidth="90px",l.style.width=a+"px",l.style.height=n+"px")},e.prototype.isAddTextNode=function(t,e){return!!(this.tool instanceof Pa||e)&&(this.tool=null,t&&!jt(this.diagram)&&(this.diagram.drawingObject=void 0,this.diagram.currentDrawingObject=void 0),!(ai(this.diagram.nodes,t.id)||ai(this.diagram.connectors,t.id)||this.diagram.bpmnModule&&this.diagram.bpmnModule.textAnnotationConnectors.indexOf(t)>-1))},e.prototype.checkEditBoxAsTarget=function(t){return!(!t.target||t.target.id!==this.diagram.element.id+"_editBox")},e.prototype.getMouseEventArgs=function(t,e,i){e.position=t;var r,o;i?(o=this.diagram.findObjectsUnderMouse(this.currentPosition,i),r=this.diagram.findTargetObjectUnderMouse(o,this.action,this.inAction,e.position,i)):"Drag"===this.action||"ConnectorSourceEnd"===this.action||"SegmentEnd"===this.action||"OrthoThumb"===this.action||"BezierSourceThumb"===this.action||"BezierTargetThumb"===this.action||"ConnectorTargetEnd"===this.action||-1!==this.action.indexOf("Rotate")||-1!==this.action.indexOf("Resize")?r=this.diagram.selectedItems:(o=this.diagram.findObjectsUnderMouse(this.currentPosition),r=this.diagram.findObjectUnderMouse(o,this.action,this.inAction)),r&&r.isHeader&&(r=this.diagram.nameTable[r.parentId],this.eventArgs.actualObject=r);var n;return r&&(n=this.diagram.findElementUnderMouse(r,this.currentPosition)),i?(e.target=r,e.targetWrapper=n):(e.source=r,e.sourceWrapper=n),e.actualObject=this.eventArgs.actualObject,e.startTouches=this.touchStartList,e.moveTouches=this.touchMoveList,e},e.prototype.resetTool=function(){this.action="Select",this.hoverElement=null,this.hoverNode=null,this.tool=this.diagram.getTool(this.action),this.updateCursor()},e.prototype.getTool=function(t){switch(t){case"Select":return new ma(this.commandHandler,!0);case"Drag":return new va(this.commandHandler);case"Rotate":return new ba(this.commandHandler);case"LayoutAnimation":return new Ta(this.commandHandler);case"Hyperlink":return new Aa(this.commandHandler);case"ResizeSouthEast":case"ResizeSouthWest":case"ResizeNorthEast":case"ResizeNorthWest":case"ResizeSouth":case"ResizeNorth":case"ResizeWest":case"ResizeEast":return new wa(this.commandHandler,t);case"ConnectorSourceEnd":case"ConnectorTargetEnd":case"BezierSourceThumb":case"BezierTargetThumb":return new ya(this.commandHandler,t);case"SegmentEnd":case"OrthoThumb":return new Da(this.commandHandler,t);case"Draw":var e=Se(this.diagram.drawingObject);if("Node"===e&&"Text"===this.diagram.drawingObject.shape.type)return new Pa(this.commandHandler);if("Node"===e&&"Polygon"===this.diagram.drawingObject.shape.shape&&!this.diagram.drawingObject.shape.points)return new Ma(this.commandHandler);if("Node"===e||"Node"===e&&"Polygon"===this.diagram.drawingObject.shape.shape&&this.diagram.drawingObject.shape.points)return new xa(this.commandHandler,this.diagram.drawingObject);if("Connector"===e&&"Polyline"===this.diagram.drawingObject.type)return new La(this.commandHandler);if("Connector"===e)return new Sa(this.commandHandler,"ConnectorSourceEnd",this.diagram.drawingObject);break;case"Pan":return new Ca(this.commandHandler,!1);case"PinchZoom":return new Ca(this.commandHandler,!0);case"PortDrag":return new va(this.commandHandler,"Port");case"PortDraw":return new Sa(this.commandHandler,"ConnectorSourceEnd",this.diagram.drawingObject);case"LabelSelect":return new ma(this.commandHandler,!0,"LabelSelect");case"LabelDrag":return new Oa(this.commandHandler);case"LabelResizeSouthEast":case"LabelResizeSouthWest":case"LabelResizeNorthEast":case"LabelResizeNorthWest":case"LabelResizeSouth":case"LabelResizeNorth":case"LabelResizeWest":case"LabelResizeEast":return new Ia(this.commandHandler,t);case"LabelRotate":return new Ea(this.commandHandler)}return null},e.prototype.getCursor=function(t){var e=this.diagram.selectedItems.annotation?this.diagram.selectedItems.wrapper.children[0]:this.diagram.selectedItems;return dr(t,this.diagram.selectedItems.annotation?e.rotateAngle+e.parentTransform:e.rotateAngle)},e.prototype.findElementUnderMouse=function(t,e){return this.objectFinder.findElementUnderSelectedItem(t,e)},e.prototype.findObjectsUnderMouse=function(t,e){return this.objectFinder.findObjectsUnderMouse(t,this.diagram,this.eventArgs,e)},e.prototype.findObjectUnderMouse=function(t,e,i){return this.objectFinder.findObjectUnderMouse(this.diagram,t,e,i,this.eventArgs,this.currentPosition)},e.prototype.findTargetUnderMouse=function(t,e,i,r,o){return this.objectFinder.findObjectUnderMouse(this.diagram,t,e,i,this.eventArgs,r,o)},e.prototype.findActionToBeDone=function(t,e,i,r){return rr(t,e,this.currentPosition,this.diagram,this.touchStartList,this.touchMoveList,r)},e.prototype.updateContainerProperties=function(){var e,i,r,o=!1;if(this.diagram.selectedObject.helperObject){e=this.diagram.selectedObject.helperObject,this.diagram.selectedItems.wrapper.children[0].offsetX=e.wrapper.offsetX,this.diagram.selectedItems.wrapper.children[0].offsetY=e.wrapper.offsetY,this.diagram.selectedItems.wrapper.children[0].actualSize.width=e.wrapper.actualSize.width,this.diagram.selectedItems.wrapper.children[0].actualSize.height=e.wrapper.actualSize.height;var n=this.diagram.selectedObject.actualObject;n.offsetX=e.offsetX,n.offsetY=e.offsetY,n.width=e.width,n.height=e.height,n.rotateAngle=e.rotateAngle;var a=this.diagram.findObjectsUnderMouse(this.currentPosition),s=this.diagram.findObjectUnderMouse(a,this.action,this.inAction),h=this.diagram.nameTable[n.parentId],d=void 0;if(h&&h.container&&"Stack"===h.container.type&&(this.diagram.startGroupAction(),r=!0),!s&&h&&h.container&&"Stack"===h.container.type&&"Drag"===this.action){var l=h.wrapper.children.indexOf(n.wrapper);if(d={targetIndex:void 0,target:void 0,sourceIndex:l,source:Xi(n)},l>-1){var c=h.children;c.splice(c.indexOf(n.id),1),this.diagram.nameTable[n.id].parentId="",i=!0,h.wrapper.children.splice(l,1)}}if(re(n,s,this.diagram,this.action),(h=$t(this.diagram,n)?this.diagram.nameTable[n.parentId]:this.diagram.nameTable[n.parentId]||n)&&h.container&&"Canvas"===h.container.type&&(h.maxWidth=h.wrapper.actualSize.width,h.wrapper.maxWidth=h.wrapper.actualSize.width,h.maxHeight=h.wrapper.actualSize.height,h.wrapper.maxHeight=h.wrapper.actualSize.height,o=!0),$t(this.diagram,n,!0)&&h&&"Canvas"===h.container.type)te(this.diagram,n);else if(h&&h.container&&"Grid"===h.container.type){var p="SwimLane"===h.shape.type?h.wrapper.children[0]:h.wrapper,g=h.wrapper.bounds.x,u=h.wrapper.bounds.y;void 0!==n.columnIndex&&"Horizontal"===h.container.orientation&&1===n.rowIndex||"Vertical"===h.container.orientation&&n.rowIndex>0&&n.columnIndex>0?p.updateColumnWidth(n.columnIndex,e.width):void 0!==n.rowIndex&&p.updateRowHeight(n.rowIndex,e.height),this.diagram.nodePropertyChange(h,{},{offsetX:h.offsetX,offsetY:h.offsetY,width:h.width,height:h.height,rotateAngle:h.rotateAngle}),this.diagram.drag(h,g-h.wrapper.bounds.x,u-h.wrapper.bounds.y)}else this.diagram.nodePropertyChange(n,{},{offsetX:n.offsetX,offsetY:n.offsetY,width:n.width,height:n.height,rotateAngle:n.rotateAngle}),this.diagram.updateConnectorEdges(n);if(o&&(h.maxWidth=void 0,h.wrapper.maxWidth=void 0,h.maxHeight=void 0,h.wrapper.maxHeight=void 0),i){this.diagram.nodePropertyChange(h,{},{offsetX:h.offsetX,offsetY:h.offsetY,width:h.width,height:h.height,rotateAngle:h.rotateAngle});var f={type:"StackChildPositionChanged",redoObject:{sourceIndex:void 0,source:d.source},undoObject:d,category:"Internal"};this.diagram.diagramActions&t.DiagramAction.UndoRedo||this.diagram.addHistoryEntry(f)}}return r},e.prototype.addUmlNode=function(){var e=this.diagram.selectedItems.nodes[0],i=this.diagram.findObjectsUnderMouse({x:this.currentPosition.x+20,y:this.currentPosition.y}),r=this.diagram.findObjectUnderMouse(i,this.action,this.inAction);if(r||(i=this.diagram.findObjectsUnderMouse({x:this.currentPosition.x-20,y:this.currentPosition.y}),r=this.diagram.findObjectUnderMouse(i,this.action,this.inAction)),e&&e.container&&"Stack"===e.container.type&&r&&r.parentId&&r.parentId===e.id){var o=r,n=xi(this.diagram.element.id);if(n.getElementById(n.id+"_stack_highlighter")){var a=e.wrapper.children.indexOf(r.wrapper)+1,s=new En(this.diagram,"nodes",{style:{fill:e.style.fill,strokeColor:"#ffffff00"},annotations:r.annotations,verticalAlignment:"Stretch",horizontalAlignment:"Stretch",constraints:(t.NodeConstraints.Default|t.NodeConstraints.HideThumbs)&~(t.NodeConstraints.Rotate|t.NodeConstraints.Drag|t.NodeConstraints.Resize),minHeight:25},!0);s.annotations[0].content=" + Name : Type";o.id.split("_");s.id=Hi()+s.id,s.parentId=e.id,s.zIndex=-1,s.umlIndex=a,this.diagram.startGroupAction();e.wrapper.children.indexOf(s.wrapper);this.diagram.add(s),this.diagram.select([this.diagram.nameTable[s.id]]),this.diagram.endGroupAction(),this.diagram.startTextEdit()}}},e}(),Ra=function(){function t(){}return t.prototype.findObjectsUnderMouse=function(t,e,i,r,o){var n=[];r&&r instanceof Vo&&r.nodes.length+r.connectors.length===1&&(r=r.nodes[0]||r.connectors[0]).children&&0===r.children.length&&(i.actualObject=r);for(var a,s,h,d,l,c={},p=0,g=e.spatialSearch.findObjects(new xr(t.x-50,t.y-50,100,100));p<g.length;p++){var u=t;s=(M=g[p]).wrapper.outerBounds;var f=!M.rotateAngle&&s.containsPoint(u);if((M!==r||e.currentDrawingObject instanceof Wo)&&M instanceof Wo?M!==e.currentDrawingObject:M.wrapper.visible){if((C=e.commandHandler.getObjectLayer(M.id))&&!C.lock&&C.visible){if(l=c[C.zIndex]=c[C.zIndex]||[],M.rotateAngle){s=Wi(a=M.wrapper);for(var v=0,w=a.children;v<w.length;v++)h=w[v],b(d=m(),-(h.rotateAngle+h.parentTransform),h.offsetX,h.offsetY),u=y(d,t),Wi(h).containsPoint(u)&&(f=!0)}if((!r||!1===hr(e,M))&&Pt(M)&&(M instanceof Wo?Me(M,t):f)){var x=M instanceof Wo?M.hitPadding||0:0;this.findElementUnderMouse(M,t,x)&&"helper"!==M.id&&di(M,"zIndex",l)}}}}for(var S=0,P=e.layers;S<P.length;S++)for(var C=P[S],T=0,A=n=n.concat(c[C.zIndex]||[]);T<A.length;T++){var M;if("Bpmn"===(M=A[T]).shape.type&&M.processId&&(!(e.eventHandler.tool instanceof va)||e.eventHandler.tool instanceof va&&kt(M))){(D=n.indexOf(e.nameTable[M.processId]))>-1&&n.splice(D,1)}if("UmlClassifier"===M.shape.type&&M.container&&"Stack"===M.container.type){(D=n.indexOf(e.nameTable[e.nameTable[M.id].wrapper.children[0].id]))>-1&&n.splice(D,1)}}for(var L=0;L<n.length;L++){var O=e.nameTable[n[L].parentId];if(O)for(var I=this.findElementUnderMouse(O,t),E=0;E<O.ports.length;E++)if(I.id.match("_"+O.ports[E].id+"$")){var z=O.ports[E];if(Ut(z)||Vt(z))return n}for(;O;){var D;if(-1===(D=n.indexOf(O)))break;n.splice(D,1),O=e.nameTable[O.parentId]}}return n},t.prototype.isTarget=function(t,e,i){var r,o=e.selectedItems.connectors[0];if(!(r="ConnectorSourceEnd"===i?e.nameTable[o.targetID]:r=e.nameTable[o.sourceID])||(r.processId||t.processId)&&r.processId===t.processId||(r.processId!==t.processId&&(t=null),t&&t.parentId&&"UmlClassifier"===e.nameTable[t.parentId].shape.type&&(t=e.nameTable[t.parentId])),"ConnectorSourceEnd"===i&&o.targetID){var n=e.nameTable[o.targetID];if(n&&n.shape&&"TextAnnotation"===n.shape.shape){var a=o.id.split("_");("Bpmn"===n.shape.type&&"Bpmn"!==t.shape.type||a[0]===t.id||"TextAnnotation"===t.shape.shape)&&(t=null),t.parentId&&"UmlClassifier"===e.nameTable[t.parentId].shape.type&&(t=e.nameTable[t.parentId])}}return t},t.prototype.findObjectUnderMouse=function(t,e,i,r,o,n,a){var s,h,d="eventHandler",l=null;if(0!==e.length)if(a&&a instanceof Vo&&a.nodes.length+a.connectors.length===1&&(a=a.nodes[0]||a.connectors[0]),"ConnectorSourceEnd"===i&&a||"PortDraw"===i||(Ht(t)||jt(t))&&_n(t.drawingObject)===Wo){for(var c=t.selectedItems.connectors[0],p=e.length-1;p>=0;p--)if(h=oi(e[p],!1),e[p]instanceof En&&(Et(e[p])||zt(h)))return l=e[p],c&&(l=this.isTarget(l,t,i)),o.actualObject=l,l}else if("ConnectorTargetEnd"===i&&a){for(p=e.length-1;p>=0;p--)if(s=oi(e[p],!0),e[p]instanceof En&&(Ot(e[p])||It(s)))return l=e[p],l=this.isTarget(l,t,i),o.actualObject=l,l}else{if(a&&("Drag"===i||t[d].tool instanceof va)){var g=0;for(p=0;p<e.length;p++){var u=e[p];a!==u&&(u instanceof Wo||!n||u.wrapper.bounds.containsPoint(n))&&kt(u)&&(l?(l=g>=u.zIndex?l:u,g=Math.max(g,u.zIndex)):g=(l=u).zIndex)}return l&&"Bpmn"===l.shape.type&&(l=t.selectedItems.nodes.length>0&&"Bpmn"===t.selectedItems.nodes[0].shape.type?l:null),l&&(o.actualObject=l),l}if("Select"===i&&t[d].tool){for(p=e.length-1;p>=0;p--)if(e[p]instanceof Wo&&e[p-1]instanceof En&&e[p-1].ports){if((v=this.findTargetElement(e[p-1].wrapper,n,void 0))&&(v.id.match("_icon_content_shape$")||v.id.match("_icon_content_rect$")))return e[p-1];for(var f=0;f<e[p-1].ports.length;f++)if(v&&v.id.match("_"+e[p-1].ports[f].id+"$")&&Vt(e[p-1].ports[f]))return e[p-1]}if(l=e[e.length-1],o.actualObject=l,!t[d].itemClick(l,!0)&&l.parentId)for(var m=l,y=hr(t,m);m&&(!hr(t,m)||y);)l=m,m=t.nameTable[m.parentId]}else if("Pan"===i||"LayoutAnimation"===i){for(p=e.length-1;p>=0;p--)if(e[p]instanceof En){var v=this.findTargetElement(e[p].wrapper,n,void 0);if("LayoutAnimation"===i||"Pan"===i||v&&(v.id.match("_icon_content_shape$")||v.id.match("_icon_content_rect$")))return e[p]}}else l=e[e.length-1],o&&l&&(o.actualObject=l)}return l},t.prototype.findElementUnderSelectedItem=function(t,e){return t instanceof Vo?1!==t.nodes.length||t.connectors&&t.connectors.length?t.nodes&&!t.nodes.length||1!==t.connectors.length?null:this.findElementUnderMouse(t.connectors[0],e):this.findElementUnderMouse(t.nodes[0],e):this.findElementUnderMouse(t,e)},t.prototype.findElementUnderMouse=function(t,e,i){return this.findTargetElement(t.wrapper,e,i)},t.prototype.findTargetElement=function(t,e,i){for(var r=t.children.length-1;r>=0;r--){var o=t.children[r];if(o&&o.outerBounds.containsPoint(e)){if(o instanceof _r){var n=this.findTargetElement(o,e);if(n)return n}if(o.bounds.containsPoint(e))return o}}return t.bounds.containsPoint(e,i)&&"none"!==t.style.fill?t:null},t}(),Na=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Ba=function(t,e,i,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},ja=function(t){function i(e,i,r,o){var n=t.call(this,e,i,r,o)||this;return n.objectZIndex=-1,n.zIndexTable={},n.objects=[],n}return Na(i,t),Ba([e.Property("")],i.prototype,"id",void 0),Ba([e.Property(!0)],i.prototype,"visible",void 0),Ba([e.Property(!1)],i.prototype,"lock",void 0),Ba([e.Property()],i.prototype,"objects",void 0),Ba([e.Property()],i.prototype,"addInfo",void 0),Ba([e.Property(-1)],i.prototype,"zIndex",void 0),i}(e.ChildProperty),Ha=function(){function i(t){this.clipboardData={},this.connectorsTable=[],this.processTable={},this.childTable={},this.parentTable={},this.diagram=t}return Object.defineProperty(i.prototype,"snappingModule",{get:function(){return this.diagram.snappingModule},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layoutAnimateModule",{get:function(){return this.diagram.layoutAnimateModule},enumerable:!0,configurable:!0}),i.prototype.startTransaction=function(t){this.state={element:this.diagram.selectedItems,backup:null},t&&this.diagram.protectPropertyChange(!0),Pi(this.diagram.element.id).style.pointerEvents="none"},i.prototype.endTransaction=function(t){this.state=null,t&&this.diagram.protectPropertyChange(!1),Pi(this.diagram.element.id).style.pointerEvents="all"},i.prototype.showTooltip=function(t,e,i,r,o){var n=this;o&&(this.diagram.tooltipObject.position="BottomCenter",this.diagram.tooltipObject.animation={open:{delay:0,duration:0}},this.diagram.tooltip.relativeMode="ConnectTool"===r?"Mouse":"Object",this.diagram.tooltipObject.openDelay=0,this.diagram.tooltipObject.closeDelay=0),this.diagram.tooltipObject.content=i;var a=ze(this.diagram,{x:e.x,y:e.y},t);this.diagram.tooltipObject.offsetX=a.x+("ConnectTool"===r?10:0),this.diagram.tooltipObject.offsetY=a.y+10,this.diagram.tooltipObject.dataBind(),o&&setTimeout(function(){n.diagram.tooltipObject.open(n.diagram.element)},1)},i.prototype.closeTooltip=function(){this.diagram.tooltipObject.close()},i.prototype.canEnableDefaultTooltip=function(){return!!(this.diagram.selectedItems.constraints&t.SelectorConstraints.ToolTip)},i.prototype.updateSelector=function(){this.diagram.updateSelector()},i.prototype.triggerEvent=function(e,i){if(e===t.DiagramEvent.drop||e===t.DiagramEvent.positionChange||e===t.DiagramEvent.connectionChange){if(this.diagram.currentSymbol)return;if(e===t.DiagramEvent.drop&&(i.source=this.diagram),this.diagram.currentDrawingObject)return}this.diagram.triggerEvent(e,i)},i.prototype.dragOverElement=function(e,i){if(this.diagram.currentSymbol){var r={element:e.source,target:e.target,mousePosition:i,diagram:this.diagram};this.triggerEvent(t.DiagramEvent.dragOver,r)}},i.prototype.disConnect=function(e,i){var r,o={},n={};if(e instanceof Vo?r=e.connectors[0]:e instanceof Wo&&this.diagram.currentDrawingObject&&(r=this.diagram.currentDrawingObject),e&&r&&(sr(this.diagram)||this.diagram.currentDrawingObject))if(!i||"ConnectorSourceEnd"!==i&&"ConnectorTargetEnd"!==i){if("OrthoThumb"!==i&&"SegmentEnd"!==i&&(r.sourceID||r.targetID)){o={sourceID:r.sourceID,sourcePortID:r.sourcePortID,targetID:r.targetID,targetPortID:r.targetPortID},r.sourceID="",r.sourcePortID="",r.targetID="",r.targetPortID="";var a={connector:r,oldValue:o,newValue:n={sourceID:r.sourceID,sourcePortID:r.sourcePortID,targetID:r.targetID,targetPortID:r.targetPortID},cancel:!1,state:"Changing",connectorEnd:i};this.triggerEvent(t.DiagramEvent.connectionChange,a),a.cancel?(r.sourceID=o.sourceID,r.sourcePortID=o.sourcePortID,r.targetID=o.targetID,r.targetPortID=o.targetPortID):(this.diagram.connectorPropertyChange(r,o,n),this.diagram.updateDiagramObject(r),a={connector:r,oldValue:o,newValue:n,cancel:!1,state:"Changed",connectorEnd:i},this.triggerEvent(t.DiagramEvent.connectionChange,a))}}else{var s="ConnectorSourceEnd"===i?"sourceID":"targetID",h="ConnectorSourceEnd"===i?"sourcePortID":"targetPortID";r[s]&&(o[s]=r[s],r[s]="",n[s]=r[s],(r.sourcePortID||r.targetPortID)&&(o[h]=r[h],r[h]="",n[h]=r[h]),this.connectionEventChange(r,o,n,i))}},i.prototype.connectionEventChange=function(e,i,r,o){var n="ConnectorSourceEnd"===o?"sourceID":"targetID",a="ConnectorSourceEnd"===o?"sourcePortID":"targetPortID",s={connector:e,oldValue:{nodeId:i[n],portId:i[a]},newValue:{nodeId:r[n],portId:r[a]},cancel:!1,state:"Changing",connectorEnd:o};this.triggerEvent(t.DiagramEvent.connectionChange,s),s.cancel?(e[n]=i[n],e[a]=i[a],r=i):(this.diagram.connectorPropertyChange(e,i,r),this.diagram.updateDiagramObject(e),s={connector:e,oldValue:{nodeId:i[n],portId:i[a]},newValue:{nodeId:r[n],portId:r[a]},cancel:!1,state:"Changed",connectorEnd:o},this.triggerEvent(t.DiagramEvent.connectionChange,s))},i.prototype.findTarget=function(t,e,i,r){if(e instanceof En){if(t&&t.id===e.id+"_content")return e;if(i&&"Bpmn"===e.shape.type&&"Activity"===e.shape.shape&&"Transaction"===e.shape.activity.subProcess.type){var o=e.shape.activity.subProcess.transaction;if(o.success.visible&&0===t.id.indexOf(e.id+"_success"))return o.success;if(o.cancel.visible&&0===t.id.indexOf(e.id+"_cancel"))return o.cancel;if(o.failure.visible&&0===t.id.indexOf(e.id+"_failure"))return o.failure}if(t instanceof Yr)for(var n=0;n<e.ports.length;n++){var a=e.ports[n];if(t.id===e.id+"_"+a.id)return a}}if(!r){var s=void 0;for(n=0;n<e.annotations.length;n++)if(s=e.annotations[n],t.id===e.id+"_"+s.id)return s}return e},i.prototype.canDisconnect=function(t,e,i,r){var o;e.source instanceof Vo?o=e.source.connectors[0]:e.source instanceof Wo&&this.diagram.currentDrawingObject&&(o=this.diagram.currentDrawingObject);this.findTarget(e.targetWrapper,e.target,"ConnectorSourceEnd"===t,!0);var n="ConnectorSourceEnd"===t?"sourcePortID":"targetPortID";return o["ConnectorSourceEnd"===t?"sourceID":"targetID"]!==r||o[n]!==i},i.prototype.changeAnnotationDrag=function(t){var e;if(t.source&&t.source.connectors&&t.source.connectors.length&&this.diagram.bpmnModule&&this.diagram.bpmnModule.textAnnotationConnectors.indexOf(t.source.connectors[0])>-1){t.source instanceof Vo&&(e=t.source.connectors[0]);var i=e.id.split("_"),r=(i[i.length-1],i[i.length-3]||i[0]);if(t.target&&t.target.id!==r&&"TextAnnotation"!==t.target.shape.shape){this.diagram.startGroupAction();var o=this.diagram.nameTable[i[0]],n=this.getAnnotation(o,i[1]),a={id:i[1]+Hi(),angle:wr.findAngle(e.intermediatePoints[0],e.intermediatePoints[1]),text:n.text,length:wr.distancePoints(e.intermediatePoints[0],e.intermediatePoints[1]),shape:{shape:"TextAnnotation",type:"Bpmn"},nodeId:n.nodeId},s=new wn(t.target.shape,"annotations",a,!0);this.diagram.bpmnModule.checkAndRemoveAnnotations(this.diagram.nameTable[e.targetID],this.diagram),this.diagram.refreshCanvasLayers(),s.id=i[1],this.diagram.addTextAnnotation(s,t.target),this.diagram.endGroupAction()}else e&&(e.sourceID=r,this.diagram.connectorPropertyChange(e,{},{sourceID:r}),this.diagram.updateDiagramObject(e))}},i.prototype.connect=function(e,i){var r,o,n,a={},s={};i.source instanceof Vo?n=i.source.connectors[0]:i.source instanceof Wo&&this.diagram.currentDrawingObject&&(n=this.diagram.currentDrawingObject);var h=this.findTarget(i.targetWrapper,i.target,"ConnectorSourceEnd"===e,!0),d="ConnectorSourceEnd"===e?"sourceID":"targetID",l="ConnectorSourceEnd"===e?"sourcePortID":"targetPortID";if(h instanceof En)s[d]=n[d],n[d]=h.id,a[d]=n[d],s[l]=n[l],this.connectionEventChange(n,s,a,e);else{r=n[d],o=n[l],n[l]=h.id,n[d]=i.target.id,a[d]=n[d],a[l]=n[l];var c={connector:n,oldValue:{nodeId:r,portId:o},newValue:{nodeId:a[d],portId:a[l]},cancel:!1,state:"Changing",connectorEnd:e};this.triggerEvent(t.DiagramEvent.connectionChange,c),c.cancel?(n[d]=r,n[l]=o,a[d]=r,a[l]=o):(this.diagram.connectorPropertyChange(n,{},a),this.diagram.updateDiagramObject(n),c={connector:n,oldValue:{nodeId:r,portId:o},newValue:{nodeId:a[d],portId:a[l]},cancel:!1,state:"Changed",connectorEnd:e},this.triggerEvent(t.DiagramEvent.connectionChange,c))}this.renderHighlighter(i,void 0,"ConnectorSourceEnd"===e)},i.prototype.cut=function(){this.clipboardData.pasteIndex=0,this.diagram.undoRedoModule&&this.diagram.historyList.startGroupAction(),this.clipboardData.clipObject=this.copyObjects(),this.diagram.undoRedoModule&&this.diagram.historyList.endGroupAction(),"SVG"!==this.diagram.mode&&this.diagram.refreshDiagramLayer()},i.prototype.addLayer=function(t,e){t.id=t.id||Hi(),t.zIndex=this.diagram.layers.length,(t=new ja(this.diagram,"layers",t,!0)).objectZIndex=-1,t.zIndexTable={},this.diagram.layers.push(t),this.diagram.layerZIndexTable[t.zIndex]=t.id,this.diagram.activeLayer=t;t.objects;if(e)for(var i=0;i<e.length;i++)this.diagram.add(e[i])},i.prototype.getObjectLayer=function(t){for(var e=this.diagram.layers,i=0;i<e.length;i++){if(e[i].objects.indexOf(t)>-1)return e[i]}return this.diagram.activeLayer},i.prototype.getLayer=function(t){for(var e=this.diagram.layers,i=0;i<e.length;i++)if(e[i].id===t)return e[i]},i.prototype.removeLayer=function(t){var e=this.getLayer(t);if(e){for(var i=this.diagram.layers.indexOf(e),r=e.objects,o=r.length-1;o>=0;o--)this.diagram.unSelect(this.diagram.nameTable[r[o]]),this.diagram.remove(this.diagram.nameTable[r[o]]),"default_layer"!==e.id&&this.diagram.activeLayer.id===t&&(this.diagram.activeLayer=this.diagram.layers[this.diagram.layers.length-1]);delete this.diagram.layerZIndexTable[e.zIndex],this.diagram.layers.splice(i,1),"SVG"!==this.diagram.mode&&this.diagram.refreshDiagramLayer()}},i.prototype.moveObjects=function(t,e){var i=this.getLayer(e)||this.diagram.activeLayer;this.diagram.setActiveLayer(i.id);for(var r,o=0,n=t;o<n.length;o++){var a=n[o];this.getObjectLayer(a).objects.indexOf(a)>-1&&(r=this.diagram.nameTable[a],this.diagram.unSelect(r),this.diagram.remove(this.diagram.nameTable[a]),this.diagram.add(r))}},i.prototype.cloneLayer=function(t){this.diagram.layers;var e=this.getLayer(t);if(e){var i=[],r={id:t+"_"+Hi(),objects:[],visible:!0,lock:!1};this.addLayer(r),r.zIndex=this.diagram.layers.length-1;for(var o=0,n=e.objects;o<n.length;o++){var a=n[o];i.push(this.diagram.nameTable[a])}this.paste(i)}},i.prototype.copy=function(){return this.clipboardData.pasteIndex=1,this.clipboardData.clipObject=this.copyObjects(),this.clipboardData.clipObject},i.prototype.copyObjects=function(){var t=[],e=[];if(this.clipboardData.childTable={},this.diagram.selectedItems.connectors.length>0){t=this.diagram.selectedItems.connectors;for(var i=0;i<t.length;i++){var r=void 0;r=this.diagram.bpmnModule&&this.diagram.bpmnModule.textAnnotationConnectors.indexOf(t[i])>-1?Xi(this.diagram.nameTable[t[i].targetID]):Xi(t[i]),e.push(r)}}if(this.diagram.selectedItems.nodes.length>0){t=t.concat(this.diagram.selectedItems.nodes);for(i=0;i<this.diagram.selectedItems.nodes.length;i++){var o=Xi(this.diagram.selectedItems.nodes[i]);this.copyProcesses(o),e.push(Xi(o));var n=m();if(b(n,-o.rotateAngle,o.offsetX,o.offsetY),o.children){for(var a=this.clipboardData.childTable,s=void 0,h=this.getAllDescendants(o,[],!0),d=0;d<h.length;d++){var l=a[(s=this.diagram.nameTable[h[d].id]).id]=Xi(s),c=y(n,{x:l.wrapper.offsetX,y:l.wrapper.offsetY});s instanceof En&&(l.offsetX=c.x,l.offsetY=c.y,l.rotateAngle-=o.rotateAngle)}this.clipboardData.childTable=a}}}if(0===this.clipboardData.pasteIndex){this.startGroupAction();for(var p=0,g=t;p<g.length;p++){var u=g[p];this.diagram.nameTable[u.id]&&(this.diagram.bpmnModule&&this.diagram.bpmnModule.textAnnotationConnectors.indexOf(u)>-1?this.diagram.remove(this.diagram.nameTable[u.targetID]):this.diagram.remove(u))}this.endGroupAction()}return this.sortByZIndex(e,"zIndex"),e},i.prototype.copyProcesses=function(t){if("Bpmn"===t.shape.type&&t.shape.activity&&t.shape.activity.subProcess.processes&&t.shape.activity.subProcess.processes.length>0){for(var e=0,i=t.shape.activity.subProcess.processes;e<i.length;e++){var r=i[e];this.processTable[r]=Xi(this.diagram.nameTable[r]),this.processTable[r].shape.activity.subProcess.processes&&this.processTable[r].shape.activity.subProcess.processes.length>0&&this.copyProcesses(this.processTable[r])}this.clipboardData.processTable=this.processTable}},i.prototype.group=function(){var e=this.diagram.isProtectedOnChange;this.diagram.protectPropertyChange(!0),this.diagram.diagramActions=this.diagram.diagramActions|t.DiagramAction.Group;var i=[],r={};r.id="group"+Hi(),(r=new En(this.diagram,"nodes",r,!0)).children=[],i=(i=this.diagram.selectedItems.nodes).concat(this.diagram.selectedItems.connectors);for(var o=0;o<i.length;o++)i[o].parentId||r.children.push(i[o].id);this.diagram.add(r);var n={type:"Group",undoObject:r,redoObject:r,category:"Internal"};this.addHistoryEntry(n),this.diagram.diagramActions=this.diagram.diagramActions&~t.DiagramAction.Group,this.diagram.protectPropertyChange(e)},i.prototype.unGroup=function(e){var i=this.diagram.isProtectedOnChange;this.diagram.protectPropertyChange(!0),this.diagram.diagramActions=this.diagram.diagramActions|t.DiagramAction.Group;var r=[];e?r.push(e):r=this.diagram.selectedItems.nodes;for(var o=0;o<r.length;o++){var n=r[o],a={type:"UnGroup",undoObject:Xi(n),redoObject:Xi(n),category:"Internal"};if(this.diagram.diagramActions&t.DiagramAction.UndoRedo||this.addHistoryEntry(a),n.children){n.ports&&n.ports.length>0&&this.diagram.removePorts(n,n.ports),n.annotations&&n.annotations.length>0&&this.diagram.removeLabels(n,n.annotations);for(var s=this.diagram.nameTable[n.parentId],h=n.children.length-1;h>=0;h--)this.diagram.nameTable[n.children[0]].parentId="",this.diagram.deleteChild(this.diagram.nameTable[n.children[0]],n),n.parentId&&n.children[0]&&this.diagram.addChild(s,n.children[0]);n.parentId&&this.diagram.deleteChild(n,s)}this.diagram.removeNode(n),this.clearSelection()}this.diagram.diagramActions=this.diagram.diagramActions&~t.DiagramAction.Group,this.diagram.protectPropertyChange(i)},i.prototype.paste=function(t){if(t||this.clipboardData.clipObject){this.diagram.protectPropertyChange(!0);var e=t?this.getNewObject(t):this.clipboardData.clipObject;if(e){var i=1!==e.length,r=!1,o={},n={};0!==this.clipboardData.pasteIndex&&this.clearSelection(),this.diagram.undoRedoModule&&(r=!0,this.diagram.historyList.startGroupAction());for(var a=0,s=e;a<s.length;a++){o[(d=s[a]).id]=d}for(var h=0;h<e.length;h++){var d=e[h];if(_n(d)===Wo){var l=Xi(d),c=l.sourceID;l.sourceID="",o[c]&&n[c]&&(l.sourceID=n[c]),c=l.targetID,l.targetID="",o[c]&&n[c]&&(l.targetID=n[c]);var p=this.cloneConnector(l,i);n[d.id]=p.id}else{var g=this.cloneNode(d,i);if(g){n[d.id]=g.id;var u=d.inEdges;if(u)for(var f=0,m=u;f<m.length;f++){if(o[b=m[f]]&&n[b]){(w=this.diagram.nameTable[n[b]]).targetID=n[d.id],this.diagram.connectorPropertyChange(w,{targetID:"",targetPortID:""},{targetID:w.targetID,targetPortID:w.targetPortID})}}if(u=d.outEdges)for(var y=0,v=u;y<v.length;y++){var b;if(o[b=v[y]]&&n[b]){var w;(w=this.diagram.nameTable[n[b]]).sourceID=n[d.id],this.diagram.connectorPropertyChange(w,{sourceID:"",sourcePortID:""},{sourceID:w.sourceID,sourcePortID:w.sourcePortID})}}}}}!0===r&&(this.diagram.historyList.endGroupAction(),r=!1),"SVG"!==this.diagram.mode&&this.diagram.refreshDiagramLayer(),this.clipboardData.pasteIndex++,this.diagram.protectPropertyChange(!1)}}},i.prototype.getNewObject=function(t){var e,i=[];this.clipboardData.pasteIndex=1;for(var r=0;r<t.length;r++)e=Xi(t[r]),i.push(e);return i},i.prototype.cloneConnector=function(t,e){var i,r=Xi(t);return this.translateObject(r),r.zIndex=-1,i=this.diagram.add(r),this.selectObjects([i],e),i},i.prototype.cloneNode=function(t,e,i,r){var o,n,a={},s=Xi(t);if(t.shape&&"Bpmn"===t.shape.type&&t.shape.activity&&t.shape.activity.subProcess.processes&&t.shape.activity.subProcess.processes.length&&(n=s.shape.activity.subProcess.processes,s.zIndex=-1,s.shape.activity.subProcess.processes=void 0),!t.children||!t.children.length||i&&i.length)if(t.shape&&"TextAnnotation"===t.shape.shape&&-1!==t.id.indexOf("_textannotation_")&&this.diagram.nameTable[t.id])for(var h=t.id.split("_textannotation_"),d=void 0,l=this.diagram.nameTable[t.id],c=0;c<l.inEdges.length;c++){var p=this.diagram.nameTable[l.inEdges[c]];if(p){d=this.diagram.nameTable[p.sourceID];var g=this.getAnnotation(d,h[1]),u={id:h[1]+Hi(),angle:g.angle,text:g.text,length:g.length,shape:{shape:"TextAnnotation",type:"Bpmn"},nodeId:g.nodeId};this.diagram.addTextAnnotation(u,d)}}else this.translateObject(s,r),s.zIndex=-1,i&&(s.children=i),o=this.diagram.add(s);else o=this.cloneGroup(t,e);for(var f=0,m=Object.keys(a);f<m.length;f++){var y=m[f];this.diagram.add(a[y])}return n&&n.length&&(o.shape.activity.subProcess.processes=n,this.cloneSubProcesses(o)),o&&this.selectObjects([o],e),o},i.prototype.getAnnotation=function(t,e){var i=t.shape.annotations;if(i&&i.length)for(var r=0;r<=i.length;r++)if(i[r].id===e)return i[r]},i.prototype.cloneSubProcesses=function(t){var e=[],i={};if("Bpmn"===t.shape.type&&t.shape.activity&&t.shape.activity.subProcess.processes&&t.shape.activity.subProcess.processes.length)for(var r=t.shape.activity.subProcess.processes,o=0;o<r.length;o++){for(var n=this.diagram.nameTable[r[o]]||this.clipboardData.processTable[r[o]],a=0,s=n.outEdges;a<s.length;a++){var h=s[a];e.indexOf(h)<0&&e.push(h)}for(var d=0,l=n.inEdges;d<l.length;d++){h=l[d];e.indexOf(h)<0&&e.push(h)}var c=Xi(this.clipboardData.processTable[r[o]]);c.processId=t.id;var p=this.cloneNode(c,!1);i[r[o]]=p.id,r[o]=p.id,this.diagram.addProcess(p,t.id);for(var g=0,u=e;g<u.length;g++){var f=u[g],m=Xi(this.diagram.nameTable[f]||this.diagram.connectorTable[f]);i[m.sourceID]&&i[m.targetID]&&(m.zIndex=-1,m.id+=Hi(),m.sourceID=i[m.sourceID],m.targetID=i[m.targetID],e.splice(e.indexOf(f),1),this.diagram.add(m))}}},i.prototype.cloneGroup=function(t,e){var i,r=[],o=[],n=[],a=[];o=o.concat(t.children);var s=Hi();if(this.clipboardData.childTable||t.children.length>0)for(var h=0;h<o.length;h++){var d=void 0;(d=this.clipboardData.childTable?this.clipboardData.childTable[o[h]]:this.diagram.nameTable[o[h]]).parentId="",d&&(_n(d)===Wo?n.push(d):(i=this.cloneNode(d,e,void 0,s),a.push(d.id),r.push(i.id)))}for(var l=0;l<n.length;l++){if(n[l].sourceID||n[l].targetID)for(var c=0;c<a.length;c++)n[l].sourceID===a[c]&&(n[l].sourceID+=s),n[l].targetID===a[c]&&(n[l].targetID+=s);i=this.cloneConnector(n[l],e),r.push(i.id)}var p=this.cloneNode(t,e,r);return p&&p.container&&p.shape&&"UmlClassifier"===p.shape.type&&(this.diagram.updateDiagramObject(p),p.wrapper.measure(new yr)),p},i.prototype.translateObject=function(t,e){t.id+=e||Hi();var i=10*this.clipboardData.pasteIndex;if(_n(t)===Wo){if(t.sourcePoint={x:t.sourcePoint.x+i,y:t.sourcePoint.y+i},t.targetPoint={x:t.targetPoint.x+i,y:t.targetPoint.y+i},"Bezier"===t.type)for(var r=t.segments,o=0;o<r.length;o++)wr.isEmptyPoint(r[o].point1)||(r[o].point1={x:r[o].point1.x+i,y:r[o].point1.y+i}),wr.isEmptyPoint(r[o].point2)||(r[o].point2={x:r[o].point2.x+i,y:r[o].point2.y+i});if(("Straight"===t.type||"Bezier"===t.type)&&t.segments&&t.segments.length>0)for(r=t.segments,o=0;o<r.length-1;o++)r[o].point.x+=i,r[o].point.y+=i}else t.offsetX+=i,t.offsetY+=i},i.prototype.drawObject=function(t){var e,i;i=Xi(this.diagram.drawingObject);for(var r=0,o=Object.keys(t);r<o.length;r++){var n=o[r];i[n]=t[n]}return _n(this.diagram.drawingObject)===En?((e=new En(this.diagram,"nodes",i,!0)).id=(this.diagram.drawingObject.id||"node")+Hi(),this.diagram.initObject(e)):((e=new Wo(this.diagram,"connectors",i,!0)).id=(this.diagram.drawingObject.id||"connector")+Hi(),this.diagram.initObject(e)),this.diagram.updateDiagramObject(e),this.diagram.currentDrawingObject=e,e},i.prototype.addObjectToDiagram=function(e){var i;this.diagram.removeFromAQuad(e),this.diagram.removeObjectsFromLayer(this.diagram.nameTable[e.id]),delete this.diagram.nameTable[e.id],i=this.diagram.add(e),"SVG"!==this.diagram.mode&&this.diagram.refreshDiagramLayer(),this.selectObjects([i]),e&&!jt(this.diagram)&&(this.diagram.tool&=~t.DiagramTools.DrawOnce,this.diagram.currentDrawingObject=void 0)},i.prototype.addText=function(t,e){var i=this.diagram.findElementUnderMouse(t,e);this.diagram.startTextEdit(t,i instanceof Gr?i.id.split("_")[1]:void 0)},i.prototype.selectObjects=function(e,i,r){var o={oldValue:r||[],newValue:e,cause:this.diagram.diagramActions,state:"Changing",type:"Addition",cancel:!1};this.diagram.triggerEvent(t.DiagramEvent.selectionChange,o);var n=function(e){return e.tool&t.DiagramTools.MultipleSelect}(this.diagram),a=Nt(this.diagram);if(a||n){if(!n&&(e.length>1||i&&1===e.length)){if(1!==e.length)return;this.clearSelection()}if(!(a||1!==e.length||i&&ar(this.diagram)))return void this.clearSelection()}if(!o.cancel){for(var s=0;s<e.length;s++){var h=e[s];if(!0,ar(this.diagram)){if((s>0||i)&&h.children&&!h.parentId)for(var d=0;d<this.diagram.selectedItems.nodes.length;d++){var l=this.diagram.nameTable[this.diagram.selectedItems.nodes[d].parentId];l&&(l=this.findParent(l))&&h.id===l.id&&this.selectGroup(h)}this.selectProcesses(h),this.selectBpmnSubProcesses(h)&&this.select(h,s>0||i,!0)}else this.select(h,s>0||i,!0)}o={oldValue:r||[],newValue:e,cause:this.diagram.diagramActions,state:"Changed",type:"Addition",cancel:!1},this.diagram.triggerEvent(t.DiagramEvent.selectionChange,o),this.diagram.renderSelector(i||e&&e.length>1)}},i.prototype.findParent=function(t){return t.parentId&&(t=this.diagram.nameTable[t.parentId],this.findParent(t)),t},i.prototype.selectProcesses=function(t){if(this.hasProcesses(t))for(var e=t.shape.activity.subProcess.processes,i=0;i<e.length;i++){var r=this.diagram.nameTable[e[i]];this.hasProcesses(r)&&this.selectObjects([r],!0),this.unSelect(r)}},i.prototype.selectGroup=function(t){for(var e=0;e<t.children.length;e++){var i=this.diagram.nameTable[t.children[e]];i.children&&this.selectGroup(i),this.unSelect(this.diagram.nameTable[t.children[e]])}},i.prototype.selectBpmnSubProcesses=function(t){var e,i=!0;if(t.processId)i=!hr(this.diagram,this.diagram.nameTable[t.processId])&&this.selectBpmnSubProcesses(this.diagram.nameTable[t.processId]);else if(t instanceof Wo&&(t.sourceID&&this.diagram.nameTable[t.sourceID]&&this.diagram.nameTable[t.sourceID].processId&&(e=this.diagram.nameTable[t.sourceID].processId),t.targetID&&this.diagram.nameTable[t.targetID]&&this.diagram.nameTable[t.targetID].processId&&(e=this.diagram.nameTable[t.targetID].processId),e)){if(hr(this.diagram,this.diagram.nameTable[e]))return!1;i=this.selectBpmnSubProcesses(this.diagram.nameTable[e])}return i},i.prototype.hasProcesses=function(t){return!!(t&&"Bpmn"===t.shape.type&&t.shape.activity&&t.shape.activity.subProcess.processes&&t.shape.activity.subProcess.processes.length>0)},i.prototype.select=function(t,e,i){var r=this.getObjectLayer(t.id);if(xt(t)&&!(t instanceof Vo)&&!hr(this.diagram,t)&&r&&!r.lock&&r.visible&&t.wrapper.visible){(e=!!ar(this.diagram)&&e)||this.clearSelection();var o=this.diagram.selectedItems;if(t instanceof En?o.nodes.push(t):o.connectors.push(t),e)o.wrapper.rotateAngle=o.rotateAngle=0,o.wrapper.children.push(t.wrapper);else if(o.init(this.diagram),1===o.nodes.length&&0===o.connectors.length){if($t(this.diagram,o.nodes[0],!0)){var n=this.diagram.nameTable[o.nodes[0].parentId];if(n&&"Grid"===n.container.type){var a=new Qr;a.children=[];var s=new Ar;if(o.nodes[0].rowIndex&&o.nodes[0].rowIndex>0)if("Horizontal"===n.container.orientation&&1===o.nodes[0].rowIndex||"Vertical"===n.container.orientation&&o.nodes[0].rowIndex>0&&o.nodes[0].columnIndex>0){var h=Kt(n,o.nodes[0].columnIndex,!0);a.offsetX=h.center.x,a.offsetY=h.center.y,s.width=h.width,s.height=h.height}else a.offsetX=n.offsetX,a.offsetY=o.nodes[0].wrapper.offsetY,s.width=n.wrapper.actualSize.width,s.height=o.nodes[0].wrapper.actualSize.height;a.children.push(s),a.measure(new yr),a.arrange(a.desiredSize),o.wrapper.children[0]=a}}o.rotateAngle=o.nodes[0].rotateAngle,o.wrapper.rotateAngle=o.nodes[0].rotateAngle,o.wrapper.pivot=o.nodes[0].pivot}i||this.diagram.renderSelector(e)}},i.prototype.labelSelect=function(t,e){var i=this.diagram.selectedItems;i.nodes=i.connectors=[],t instanceof En?i.nodes[0]=t:i.connectors[0]=t,i.annotation=this.findTarget(e,t),i.init(this.diagram),this.diagram.renderSelector(!1)},i.prototype.unSelect=function(e){var i=[];i.push(e);var r={oldValue:i,newValue:[],cause:this.diagram.diagramActions,state:"Changing",type:"Removal",cancel:!1};if(this.diagram.currentSymbol||this.diagram.triggerEvent(t.DiagramEvent.selectionChange,r),hr(this.diagram,e)){var o=this.diagram.selectedItems,n=void 0;e instanceof En?(n=o.nodes.indexOf(e,0),o.nodes.splice(n,1)):(n=o.connectors.indexOf(e,0),o.connectors.splice(n,1)),(r={oldValue:i,newValue:[],cause:this.diagram.diagramActions,state:"Changed",type:"Removal",cancel:!1}).cancel||(n=o.wrapper.children.indexOf(e.wrapper,0),o.wrapper.children.splice(n,1),this.diagram.updateSelector(),this.diagram.currentSymbol||this.diagram.triggerEvent(t.DiagramEvent.selectionChange,r))}},i.prototype.getChildElements=function(t){for(var e=[],i=0;i<t.length;i++){var r=t[i];r.children&&r.children.length>0?e.concat(this.getChildElements(r.children)):(e.push(r.id),r instanceof Gr&&e.push(r.id+"_text"))}return e},i.prototype.moveSvgNode=function(t,e){var i=wi(e+"_groupElement",this.diagram.element.id),r=wi(t+"_groupElement",this.diagram.element.id);i.parentNode.insertBefore(r,i)},i.prototype.sendLayerBackward=function(t){var e=this.getLayer(t);if(e&&0!==e.zIndex){var i=e.zIndex;if("SVG"===this.diagram.mode){var r=e.objects,o=this.getLayer(this.diagram.layerZIndexTable[i-1]).objects[0];if(o)for(var n=0,a=r;n<a.length;n++){var s=a[n];this.moveSvgNode(s,o)}}var h=this.getLayer(this.diagram.layerZIndexTable[i-1]);h.zIndex=h.zIndex+1,e.zIndex=e.zIndex-1;var d=this.diagram.layerZIndexTable[i];this.diagram.layerZIndexTable[i]=this.diagram.layerZIndexTable[i-1],this.diagram.layerZIndexTable[i-1]=d,"Canvas"===this.diagram.mode&&this.diagram.refreshDiagramLayer()}},i.prototype.bringLayerForward=function(t){var e=this.getLayer(t);if(e&&e.zIndex<this.diagram.layers.length-1){var i=e.zIndex;if("SVG"===this.diagram.mode)for(var r=this.getLayer(this.diagram.layerZIndexTable[i+1]).objects[0],o=0,n=e.objects;o<n.length;o++){var a=n[o];r&&this.moveSvgNode(r,a)}var s=this.getLayer(this.diagram.layerZIndexTable[i+1]);s.zIndex=s.zIndex-1,e.zIndex=e.zIndex+1;var h=this.diagram.layerZIndexTable[i];this.diagram.layerZIndexTable[i]=this.diagram.layerZIndexTable[i+1],this.diagram.layerZIndexTable[i+1]=h,"Canvas"===this.diagram.mode&&this.diagram.refreshDiagramLayer()}},i.prototype.sendToBack=function(){if(ar(this.diagram)){for(var t=this.diagram.selectedItems.nodes.length?this.diagram.selectedItems.nodes[0].id:this.diagram.selectedItems.connectors[0].id,e=this.diagram.nameTable[t].zIndex,i=this.diagram.layers.indexOf(this.getObjectLayer(t)),r=this.diagram.layers[i].zIndexTable,o=e;o>0;o--)r[o]&&(r[o-1]?(r[o]=r[o-1],this.diagram.nameTable[r[o]].zIndex=o):(r[o-1]=r[o],this.diagram.nameTable[r[o-1]].zIndex=o,delete r[o]));if(r[0]=this.diagram.nameTable[t].id,this.diagram.nameTable[t].zIndex=0,"SVG"===this.diagram.mode){for(var n=r[o=1];!n&&o<e;)n=r[++o];this.moveSvgNode(t,n),this.updateNativeNodeIndex(t)}else this.diagram.refreshCanvasLayers()}},i.prototype.bringToFront=function(){if(ar(this.diagram)){for(var t=this.diagram.selectedItems.nodes.length?this.diagram.selectedItems.nodes[0].id:this.diagram.selectedItems.connectors[0].id,e=this.diagram.layers.indexOf(this.getObjectLayer(t)),i=this.diagram.layers[e].zIndexTable,r=Number(Object.keys(i).sort(function(t,e){return Number(t)-Number(e)}).reverse()[0]),o=this.diagram.nameTable[t].zIndex;o<r;o++)i[o]&&(i[o+1]?(i[o]=i[o+1],this.diagram.nameTable[i[o]].zIndex=o):(i[o+1]=i[o],this.diagram.nameTable[i[o+1]].zIndex=o,delete i[o]));if(i[r]=this.diagram.nameTable[t].id,this.diagram.nameTable[t].zIndex=r,"SVG"===this.diagram.mode){var n=this.diagram.diagramLayer,a=(this.getChildElements(this.diagram.nameTable[t].wrapper.children),wi(t+"_groupElement",this.diagram.element.id));a.parentNode.removeChild(a);var s=this.diagram.selectedItems.nodes;if(s.length>0&&("Native"===s[0].shape.type||"HTML"===s[0].shape.type))for(var h=0;h<this.diagram.views.length;h++){var d=(a=wi(t+("HTML"===s[0].shape.type?"_content_html_element":"_content_groupElement"),this.diagram.views[h])).parentNode.lastChild;d.parentNode.insertBefore(a,d.nextSibling)}var l=Li(this.diagram.element.id);this.diagram.diagramRenderer.renderElement(this.diagram.nameTable[t].wrapper,n,l)}else this.diagram.refreshCanvasLayers()}},i.prototype.sortByZIndex=function(t,e){var i=e||"zIndex";return t=t.sort(function(t,e){return t[i]-e[i]})},i.prototype.sendForward=function(){if(ar(this.diagram)){var t=this.diagram.selectedItems.nodes.length?this.diagram.selectedItems.nodes[0].id:this.diagram.selectedItems.connectors[0].id,e=this.diagram.layers.indexOf(this.getObjectLayer(t)),i=this.diagram.layers[e].zIndexTable,r=(Object.keys(i).length,this.diagram.nameTable[t]),o=[],n=this.diagram.spatialSearch.findObjects(r.wrapper.bounds);n.length>2&&(n=this.sortByZIndex(n));for(var a=0,s=n;a<s.length;a++){var h=s[a];if(r.id!==h.id){if(e===this.getObjectLayer(h.id).zIndex&&Number(this.diagram.nameTable[t].zIndex)<Number(h.zIndex)&&r.wrapper.bounds.intersects(h.wrapper.bounds)){o.push(h);break}}}if(o.length>0){var d=o[0].zIndex,l=r.zIndex;i[d];this.diagram.layers[0].zIndexTable[d]=r.id,this.diagram.nameTable[i[d]].zIndex=d,this.diagram.layers[0].zIndexTable[l]=o[0].id,this.diagram.nameTable[i[l]].zIndex=l,"SVG"===this.diagram.mode?(this.moveSvgNode(i[Number(o[0].zIndex)],t),this.updateNativeNodeIndex(i[Number(o[0].zIndex)],t)):this.diagram.refreshCanvasLayers()}}},i.prototype.sendBackward=function(){if(ar(this.diagram)){var t=this.diagram.selectedItems.nodes.length?this.diagram.selectedItems.nodes[0].id:this.diagram.selectedItems.connectors[0].id,e=this.diagram.layers.indexOf(this.getObjectLayer(t)),i=this.diagram.layers[e].zIndexTable,r=(Object.keys(i).length,this.diagram.nameTable[t]),o=[],n=this.diagram.spatialSearch.findObjects(r.wrapper.bounds);n.length>2&&(n=this.sortByZIndex(n));for(var a=0,s=n;a<s.length;a++){var h=s[a];if(r.id!==h.id){e===this.getObjectLayer(h.id).zIndex&&Number(this.diagram.nameTable[t].zIndex)>Number(h.zIndex)&&r.wrapper.bounds.intersects(h.wrapper.bounds)&&o.push(h)}}if(o.length>0){var d=o[o.length-1].zIndex,l=r.zIndex;i[d];i[d]=r.id,this.diagram.nameTable[i[d]].zIndex=d,i[l]=o[o.length-1].id,this.diagram.nameTable[i[l]].zIndex=l,"SVG"===this.diagram.mode?(this.moveSvgNode(t,i[o[o.length-1].zIndex]),this.updateNativeNodeIndex(t,i[o[o.length-1].zIndex])):this.diagram.refreshCanvasLayers()}}},i.prototype.updateNativeNodeIndex=function(t,e){for(var i=this.diagram.selectedItems.nodes,r=0;r<this.diagram.views.length;r++)if(i.length>0&&("HTML"===i[0].shape.type||"Native"===i[0].shape.type)){var o="HTML"===i[0].shape.type?"_content_html_element":"_content_groupElement",n=wi(t+o,this.diagram.views[r]),a=e?wi(e+o,this.diagram.views[r]):n.parentElement.firstChild;a.parentNode.insertBefore(n,a)}},i.prototype.initSelectorWrapper=function(){var t=this.diagram.selectedItems;t.init(this.diagram),1===t.nodes.length&&0===t.connectors.length&&(t.rotateAngle=t.nodes[0].rotateAngle,t.wrapper.rotateAngle=t.nodes[0].rotateAngle,t.wrapper.pivot=t.nodes[0].pivot)},i.prototype.doRubberBandSelection=function(t){this.clearSelectionRectangle(),this.clearSelection();var e=[],i=[];e=this.diagram.getNodesConnectors(e),(i="CompleteIntersect"===this.diagram.selectedItems.rubberBandSelectionMode?we(t,e):this.diagram.spatialSearch.findObjects(t)).length&&this.selectObjects(i,!0)},i.prototype.clearSelectionRectangle=function(){var t=xi(this.diagram.element.id).getElementById(this.diagram.element.id+"_diagramAdorner_selected_region");t&&e.remove(t)},i.prototype.dragConnectorEnds=function(t,e,i,r,o,n){var a,s,h,d=!1;return e instanceof Vo?a=e.connectors[0]:e instanceof Wo&&this.diagram.currentDrawingObject&&(this.clearSelection(),a=this.diagram.currentDrawingObject),"BezierSourceThumb"!==t&&"BezierTargetThumb"!==t||(d=!0),"ConnectorSourceEnd"===t||"BezierSourceThumb"===t?(s=i.x-(d?r.bezierPoint1.x:a.sourcePoint.x),h=i.y-(d?r.bezierPoint1.y:a.sourcePoint.y),this.dragSourceEnd(a,s,h,null,i,t,void 0,o,n,void 0,r)):(s=i.x-(d?r.bezierPoint2.x:a.targetPoint.x),h=i.y-(d?r.bezierPoint2.y:a.targetPoint.y),this.dragTargetEnd(a,s,h,null,i,t,void 0,r))},i.prototype.getSelectedObject=function(){var t=this.diagram.selectedItems;return t.nodes.concat(t.connectors)},i.prototype.clearSelection=function(e){if(ar(this.diagram)){var i=this.diagram.selectedItems,r=this.getSelectedObject(),o={oldValue:r,newValue:[],cause:this.diagram.diagramActions,state:"Changing",type:"Removal",cancel:!1};e&&this.diagram.triggerEvent(t.DiagramEvent.selectionChange,o),o.cancel||(i.offsetX=0,i.offsetY=0,i.width=0,i.height=0,i.rotateAngle=0,i.nodes=[],i.connectors=[],i.wrapper=null,i.annotation=void 0,this.diagram.clearSelectorLayer(),e&&(o={oldValue:r,newValue:[],cause:this.diagram.diagramActions,state:"Changed",type:"Removal",cancel:!1},this.diagram.triggerEvent(t.DiagramEvent.selectionChange,o)))}},i.prototype.removeStackHighlighter=function(){var t=xi(this.diagram.element.id),e=t.getElementById(t.id+"_stack_highlighter");e&&e.parentNode.removeChild(e)},i.prototype.renderStackHighlighter=function(t,e){var i=this.diagram.selectedItems.nodes[0];if(!e){var r=this.diagram.findObjectsUnderMouse(t.position);e=this.diagram.findObjectUnderMouse(r,"Drag",!0)}if(i&&e&&i.parentId&&e.parentId&&i.parentId===e.parentId&&i.id!==e.id&&this.diagram.nameTable[e.parentId].container&&"Stack"===this.diagram.nameTable[e.parentId].container.type){var o="Vertical"===this.diagram.nameTable[e.parentId].container.orientation;ie(e.wrapper,o,t.position,this.diagram)}},i.prototype.drag=function(t,e,i){var r;if(St(t)&&this.checkBoundaryConstraints(e,i,t.wrapper.bounds)&&Yt(this.diagram))if(t instanceof En){var o={offsetX:t.offsetX,offsetY:t.offsetY};if(t.offsetX+=e,t.offsetY+=i,t.children&&!t.container){for(var n=this.getAllDescendants(t,[]),a=0;a<n.length;a++)r=this.diagram.nameTable[n[a].id],this.drag(r,e,i);this.updateInnerParentProperties(t)}$t(this.diagram,t,!0)?te(this.diagram,t):this.diagram.nodePropertyChange(t,o,{offsetX:t.offsetX,offsetY:t.offsetY})}else{var s=t,h="Bezier"===s.type,d=!1;if(s.sourceWrapper?d=!0:this.dragSourceEnd(s,e,i,!0,null,"",h),s.targetWrapper?d=!0:this.dragTargetEnd(s,e,i,!0,null,"",h),!d){this.dragControlPoint(s,e,i,!0);var l={sourcePoint:s.sourcePoint,targetPoint:s.targetPoint};this.diagram.connectorPropertyChange(s,{},l)}}},i.prototype.connectorSegmentChange=function(t,e,i){var r,o,n=!0;if(!1===e.equals(e,t.wrapper.bounds)&&t.outEdges.length>0)for(var a=0;a<t.outEdges.length;a++){var s=this.diagram.nameTable[t.outEdges[a]];if(n=""!==s.targetID?!this.isSelected(this.diagram.nameTable[s.targetID]):!this.isSelected(this.diagram.nameTable[s.id]),"Orthogonal"===s.type&&s.segments&&s.segments.length>1)if(i){var h=s.segments[0],d=s.segments[1],l=tt(V(t.wrapper,t.wrapper.corners,t.wrapper.bounds),h.direction),c=ht({corners:void 0,point:l=it(s,s.sourceWrapper,l,{x:s.sourceWrapper.offsetX,y:s.sourceWrapper.offsetY},!1),margin:void 0,direction:h.direction},{corners:void 0,point:d.points[1],margin:void 0,direction:void 0});h.length=wr.distancePoints(c[0],c[1]),d.direction&&d.length&&(d.length=wr.distancePoints(c[1],c[2]))}else if(n){switch(s.segments[0].direction){case"Bottom":r=t.wrapper.bounds.bottomCenter.x-e.bottomCenter.x,o=t.wrapper.bounds.bottomCenter.y-e.bottomCenter.y;break;case"Top":r=t.wrapper.bounds.topCenter.x-e.topCenter.x,o=t.wrapper.bounds.topCenter.y-e.topCenter.y;break;case"Left":r=t.wrapper.bounds.middleLeft.x-e.middleLeft.x,o=t.wrapper.bounds.middleLeft.y-e.middleLeft.y;break;case"Right":r=t.wrapper.bounds.middleRight.x-e.middleRight.x,o=t.wrapper.bounds.middleRight.y-e.middleRight.y}this.dragSourceEnd(s,r,o,!0,null,"ConnectorSourceEnd",void 0,void 0,void 0,!0)}}},i.prototype.updateEndPoint=function(t){var e={sourcePoint:t.sourcePoint,targetPoint:t.targetPoint,sourceID:t.sourceID?t.sourceID:void 0,targetID:t.targetID?t.targetID:void 0,sourcePortID:t.sourcePortID?t.sourcePortID:void 0,targetPortID:t.targetPortID?t.targetPortID:void 0,segments:t.segments?t.segments:void 0};this.diagram.connectorPropertyChange(t,{},e),this.diagram.updateSelector()},i.prototype.dragSourceEnd=function(t,e,i,r,o,n,a,s,h,d,l){var c=this.diagram.nameTable[t.id],p=this.checkBoundaryConstraints(e,i,c.wrapper.bounds);if(Ct(c)&&p&&"BezierSourceThumb"!==n&&Yt(this.diagram)&&(c.sourcePoint.x+=e,c.sourcePoint.y+=i,"ConnectorSourceEnd"===n&&"Orthogonal"===c.type&&this.changeSegmentLength(c,s,h,d)),"Bezier"===c.type)if(l)this.translateBezierPoints(t,""===n?"ConnectorSourceEnd":n,e,i,l,o,!a);else for(var g=0;g<t.segments.length;g++)this.translateBezierPoints(t,""===n?"ConnectorSourceEnd":n,e,i,t.segments[g],o,!a);return r||this.updateEndPoint(c),p},i.prototype.changeSegmentLength=function(t,e,i,r){if(t.segments&&null!==t.segments[0].direction&&(!e&&""===t.sourceID||r)){var o=t.segments[0],n=t.segments[1],a=this.diagram.nameTable[t.sourceID],s=void 0;if(o.points[0]=t.sourcePoint,"Top"===o.direction||"Bottom"===o.direction?(o.points[o.points.length-1].x=t.sourcePoint.x,n.points[0].y=o.points[o.points.length-1].y):(o.points[o.points.length-1].y=t.sourcePoint.y,n.points[0].x=o.points[o.points.length-1].x),o.direction&&(o.length||0===o.length)&&(o.length=wr.distancePoints(o.points[0],o.points[o.points.length-1])),n.direction&&(n.length||0===n.length)&&(n.length=wr.distancePoints(o.points[o.points.length-1],n.points[n.points.length-1]),n.direction=wr.direction(o.points[o.points.length-1],n.points[n.points.length-1])),""!==t.sourcePortID&&o.length<10)if(t.segments.length>2){var h=t.segments[2],d=wr.direction(h.points[0],h.points[1]);o.direction===ft(d)?("Right"===o.direction?h.points[0].x=o.points[o.points.length-1].x=a.wrapper.corners.middleRight.x+20:"Left"===o.direction?h.points[0].x=o.points[o.points.length-1].x=a.wrapper.corners.middleLeft.x-20:"Top"===o.direction?h.points[0].y=o.points[o.points.length-1].y=a.wrapper.corners.topCenter.y-20:h.points[0].y=o.points[o.points.length-1].y=a.wrapper.corners.bottomCenter.y+20,h.direction&&h.length&&(h.length=wr.distancePoints(h.points[0],h.points[h.points.length-1])),o.length=wr.distancePoints(o.points[0],o.points[o.points.length-1])):o.direction===d&&h.direction&&h.length?("Top"===o.direction||"Bottom"===o.direction?(h.points[0]=o.points[0],h.points[h.points.length-1].x=h.points[0].x):(h.points[0]=o.points[0],h.points[h.points.length-1].y=h.points[0].y),h.length=wr.distancePoints(h.points[0],h.points[h.points.length-1]),t.segments.splice(0,2)):o.length=20}else o.length=20;else if(o.length<1)if(""!==t.sourceID){if("Right"===n.direction?(s=a.wrapper.corners.middleRight,n.points[n.points.length-1].y=s.y):"Left"===n.direction?(s=a.wrapper.corners.middleLeft,n.points[n.points.length-1].y=s.y):"Top"===n.direction?(s=a.wrapper.corners.topCenter,n.points[n.points.length-1].x=s.x):(s=a.wrapper.corners.bottomCenter,n.points[n.points.length-1].x=s.x),n.length=wr.distancePoints(s,n.points[n.points.length-1]),t.segments.length>2){(h=t.segments[2]).direction&&h.length&&(h.length=wr.distancePoints(n.points[n.points.length-1],h.points[h.points.length-1]))}t.segments.splice(0,1)}else t.segments.splice(0,1)}else e&&!i&&t.sourceID!==e.id&&t.segments&&null!==t.segments[0].direction&&e&&e instanceof En&&this.changeSourceEndToNode(t,e),e&&i&&t.sourcePortID!==i&&t.segments&&null!==t.segments[0].direction&&e&&e instanceof En&&this.changeSourceEndToPort(t,e,i)},i.prototype.changeSourceEndToPort=function(t,e,i){var r=this.diagram.getWrapper(e.wrapper,i),o={x:r.offsetX,y:r.offsetY},n=gt(o,Wi(e.wrapper),e.wrapper.bounds),a=t.segments[0],s=t.segments[1];if(a.direction!==n){var h=[],d={};if(a.direction===ft(n)){d={};var l=void 0;"Top"===n||"Bottom"===n?(l="Top"===n?{type:"Orthogonal",isTerminal:!0,direction:n,length:Math.abs(a.points[0].y-o.y)}:{type:"Orthogonal",isTerminal:!0,direction:n,length:Math.abs(o.y-a.points[0].y)},d=a.points[0].x>o.x?{type:"Orthogonal",isTerminal:!0,direction:"Right",length:a.points[0].x-o.x}:{type:"Orthogonal",isTerminal:!0,direction:"Left",length:o.x-a.points[0].x}):(l="Right"===n?{type:"Orthogonal",isTerminal:!0,direction:n,length:Math.abs(a.points[0].x-o.x)}:{type:"Orthogonal",isTerminal:!0,direction:n,length:Math.abs(o.x-a.points[0].x)},d=a.points[0].y>o.y?{type:"Orthogonal",direction:"Top",isTerminal:!0,length:a.points[0].y-o.y}:{type:"Orthogonal",direction:"Bottom",isTerminal:!0,length:o.y-a.points[0].y}),h.push(new No(t,"segments",l,!0)),h.push(new No(t,"segments",d,!0))}else d={type:"Orthogonal",direction:n,length:20,isTerminal:!0},h.push(new No(t,"segments",d,!0));a.direction!==ft(n)&&("Top"===n||"Bottom"===n?(a.points[0].x=o.x,a.points[0].y=a.points[a.points.length-1].y="Top"===n?o.y-20:o.y+20):(a.points[0].y=o.y,a.points[0].x=a.points[a.points.length-1].x="Right"===n?o.x+20:o.x-20),a.length=wr.distancePoints(a.points[0],a.points[a.points.length-1]),s.length=wr.distancePoints(a.points[a.points.length-1],s.points[s.points.length-1])),t.segments=h.concat(t.segments)}else a.points[0]=o,"Top"===n||"Bottom"===n?a.points[a.points.length-1].x=o.x:a.points[a.points.length-1].y=o.y,a.length=wr.distancePoints(a.points[0],a.points[a.points.length-1]),s.length=wr.distancePoints(a.points[a.points.length-1],s.points[s.points.length-1])},i.prototype.removeTerminalSegment=function(t,e){for(var i=0;i<t.segments.length-2;i++){var r=t.segments[0];r.isTerminal&&(e?r.isTerminal=!1:(t.segments.splice(i,1),i--))}},i.prototype.changeSourceEndToNode=function(t,e){this.removeTerminalSegment(t);var i,r,o=e.wrapper.children[0].corners,n=t.segments[0],a=t.segments[1],s=[];if("Right"===n.direction||"Left"===n.direction)if(i="Left"===n.direction?o.middleLeft:o.middleRight,n.length>o.width||"Left"===n.direction&&i.x>=n.points[0].x||"Right"===n.direction&&i.x<=n.points[0].x)n.points[0].y=n.points[n.points.length-1].y=i.y,n.points[0].x=i.x,n.length=wr.distancePoints(n.points[0],n.points[n.points.length-1]),a.length=wr.distancePoints(n.points[n.points.length-1],a.points[a.points.length-1]);else{var h=void 0;r="Bottom"===(h=a.direction?a.direction:wr.direction(a.points[0],a.points[a.points.length-1]))?o.bottomCenter:o.topCenter,a.length&&a.direction&&(a.length="Top"===h?n.points[n.points.length-1].y-(r.y+20):r.y+20-n.points[n.points.length-1].y),n.length=n.points[n.points.length-1].x-r.x,n.direction=n.length>0?"Right":"Left";var d={type:"Orthogonal",direction:h,length:20};s.push(new No(t,"segments",d,!0)),t.segments=s.concat(t.segments)}else if(i="Bottom"===n.direction?o.bottomCenter:o.topCenter,n.length>o.height||"Top"===n.direction&&i.y>=n.points[0].y||"Bottom"===n.direction&&i.y<=n.points[0].y)n.points[0].x=n.points[n.points.length-1].x=i.x,n.points[0].y=i.y,n.length=wr.distancePoints(n.points[0],n.points[n.points.length-1]),a.length=wr.distancePoints(n.points[n.points.length-1],a.points[a.points.length-1]);else{r="Left"===a.direction?o.middleLeft:o.middleRight;h=void 0;h=a.direction?a.direction:wr.direction(a.points[0],a.points[a.points.length-1]),a.length&&a.direction&&(a.length="Left"===h?n.points[n.points.length-1].x-(r.x+20):r.x+20-n.points[n.points.length-1].x),n.length=n.points[n.points.length-1].y-r.y,n.direction=n.length>0?"Bottom":"Top";d={type:"Orthogonal",direction:h,length:20};s.push(new No(t,"segments",d,!0)),t.segments=s.concat(t.segments)}},i.prototype.translateBezierPoints=function(t,e,i,r,o,n,a){var s=t.segments.indexOf(o),h=t.segments[s];h&&("BezierSourceThumb"===e&&(h.vector1.angle||h.vector1.distance)?h.vector1={distance:t.distance(t.sourcePoint,n),angle:wr.findAngle(t.sourcePoint,n)}:"BezierTargetThumb"===e&&(h.vector2.angle||h.vector2.distance)?h.vector2={distance:t.distance(t.targetPoint,n),angle:wr.findAngle(t.targetPoint,n)}:("ConnectorSourceEnd"===e&&!t.sourceID||"ConnectorTargetEnd"===e&&!t.targetID)&&a&&yt(h.vector1)&&yt(h.vector2)?(wr.isEmptyPoint(h.point1)&&(h.bezierPoint1=vt(t.sourcePoint,t.targetPoint)),wr.isEmptyPoint(h.point2)&&(h.bezierPoint2=vt(t.targetPoint,t.sourcePoint))):"BezierSourceThumb"===e||"ConnectorSourceEnd"===e&&!a&&yt(h.vector1)?(h.bezierPoint1.x+=i,h.bezierPoint1.y+=r,wr.isEmptyPoint(h.point1)&&!a||(h.point1={x:h.bezierPoint1.x,y:h.bezierPoint1.y})):("BezierTargetThumb"===e||"ConnectorTargetEnd"===e&&!a&&yt(h.vector2))&&(h.bezierPoint2.x+=i,h.bezierPoint2.y+=r,wr.isEmptyPoint(h.point2)&&!a||(h.point2={x:h.bezierPoint2.x,y:h.bezierPoint2.y})))},i.prototype.dragTargetEnd=function(t,e,i,r,o,n,a,s){var h=this.diagram.nameTable[t.id],d=this.checkBoundaryConstraints(e,i,h.wrapper.bounds);if(Tt(h)&&"BezierTargetThumb"!==n&&d&&Yt(this.diagram)&&(h.targetPoint.x+=e,h.targetPoint.y+=i,"ConnectorTargetEnd"===n&&"Orthogonal"===h.type&&h.segments&&h.segments.length>0)){var l=h.segments[h.segments.length-2];l&&2===h.segments[h.segments.length-1].points.length&&("Left"===l.direction||"Right"===l.direction?l.points[l.points.length-1].x=h.targetPoint.x:l.points[l.points.length-1].y=h.targetPoint.y,l.length=wr.distancePoints(l.points[0],l.points[l.points.length-1]),l.direction=wr.direction(l.points[0],l.points[l.points.length-1]))}if("Bezier"===h.type)if(s)this.translateBezierPoints(t,""===n?"ConnectorTargetEnd":n,e,i,s,o,!a);else for(var c=0;c<t.segments.length;c++)this.translateBezierPoints(t,""===n?"ConnectorTargetEnd":n,e,i,t.segments[c],o,!a);return r||this.updateEndPoint(h),d},i.prototype.dragControlPoint=function(t,e,i,r,o){var n=this.diagram.nameTable[t.id];if(("Straight"===n.type||"Bezier"===n.type)&&n.segments.length>0){if(void 0!==o&&n.segments[o])n.segments[o].point.x+=e,n.segments[o].point.y+=i;else for(var a=0;a<n.segments.length-1;a++)n.segments[a].point.x+=e,n.segments[a].point.y+=i;r||this.updateEndPoint(n)}return!0},i.prototype.rotateObjects=function(t,e,i,r,o){r=r||{};var n=m();b(n,i,r.x,r.y);for(var a=0,s=e;a<s.length;a++){var h=s[a];if(h instanceof En){if(Mt(h)&&Yt(this.diagram)){if(!1!==o||t!==h){h.rotateAngle+=i,h.rotateAngle=(h.rotateAngle+360)%360;var d=y(n,{x:h.offsetX,y:h.offsetY});h.offsetX=d.x,h.offsetY=d.y,this.diagram.nodePropertyChange(h,{},{offsetX:h.offsetX,offsetY:h.offsetY,rotateAngle:h.rotateAngle})}if(h.processId){var l=this.diagram.nameTable[h.processId],c=this.diagram.bpmnModule.getChildrenBound(l,h.id,this.diagram);this.diagram.bpmnModule.updateSubProcessess(c,h,this.diagram)}h.children&&h.children.length&&!h.container&&this.getChildren(h,e)}}else this.rotatePoints(h,i,r||{x:h.wrapper.offsetX,y:h.wrapper.offsetY});this.diagram.updateDiagramObject(h)}this.diagram.updateSelector()},i.prototype.snapConnectorEnd=function(e){return this.diagram.snapSettings.constraints&t.SnapConstraints.SnapToLines&&this.snappingModule&&this.diagram.snappingModule.snapConnectorEnd(e),e},i.prototype.snapAngle=function(e){return this.diagram.snapSettings.constraints&t.SnapConstraints.SnapToLines&&this.snappingModule?this.snappingModule.snapAngle(this.diagram,e):0},i.prototype.rotatePoints=function(t,e,i){if(!t.sourceWrapper||!t.targetWrapper){var r=m();b(r,e,i.x,i.y),t.sourcePoint=y(r,t.sourcePoint),t.targetPoint=y(r,t.targetPoint);var o={sourcePoint:t.sourcePoint,targetPoint:t.targetPoint};this.diagram.connectorPropertyChange(t,{},o)}},i.prototype.updateInnerParentProperties=function(t){var e=this.diagram.isProtectedOnChange;this.diagram.protectPropertyChange(!0);for(var i=this.getAllDescendants(t,[],!1,!0),r=0;r<i.length;r++){var o=this.diagram.nameTable[i[r].id];o.offsetX=o.wrapper.offsetX,o.offsetY=o.wrapper.offsetY,o.width=o.wrapper.width,o.height=o.wrapper.height}this.diagram.protectPropertyChange(e)},i.prototype.scale=function(t,e,i,r,o){var n=this.diagram.nameTable[t.id],a=n,s=n.wrapper;o||(o=t);var h=o.wrapper,d=pi(h.offsetX-h.actualSize.width*h.pivot.x,h.offsetY-h.actualSize.height*h.pivot.y,h.actualSize.width,h.actualSize.height,h.rotateAngle,h.offsetX,h.offsetY,r);if(void 0!==s.actualSize.width&&void 0!==s.actualSize.height&&Yt(this.diagram)){if(a.children&&!a.container){for(var l=0,c=this.getAllDescendants(a,[]);l<c.length;l++){var p=c[l];this.scaleObject(e,i,d,p,s,o)}t.wrapper.measure(new yr),t.wrapper.arrange(t.wrapper.desiredSize),this.diagram.updateGroupOffset(n),this.updateInnerParentProperties(a)}else this.scaleObject(e,i,d,n,s,o);var g=_i(t.wrapper);if(!this.checkBoundaryConstraints(void 0,void 0,g))return this.scale(t,1/e,1/i,r),!1;this.diagram.updateDiagramObject(t)}return!0},i.prototype.getAllDescendants=function(t,e,i,r){for(var o=t,n=[],a=0;a<o.children.length;a++)(t=this.diagram.nameTable[o.children[a]])&&(t.children?(i&&e.push(t),r&&n.push(t),e=this.getAllDescendants(t,e)):e.push(t));return r?n:e},i.prototype.getChildren=function(t,e){var i=t;if(t.children)for(var r=0;r<i.children.length;r++)t=this.diagram.nameTable[i.children[r]],e.push(t);return e},i.prototype.cloneChild=function(t){return this.diagram.nameTable[t]},i.prototype.scaleObject=function(t,e,i,r,o,n){t=t<0?1:t,e=e<0?1:e;r.wrapper.offsetX,r.wrapper.offsetY,r.wrapper.actualSize.width,r.wrapper.actualSize.height;if(1!==t||1!==e){var a=void 0,s=void 0;if(r instanceof En){var h=void 0,d=void 0;"Bpmn"===(p=r).shape.type&&p.shape.activity.subProcess.processes&&p.shape.activity.subProcess.processes.length>0&&(d=this.diagram.bpmnModule.getChildrenBound(p,p.id,this.diagram),h=p.wrapper.bounds.containsRect(d)),a=p.wrapper.actualSize.width*t,s=p.wrapper.actualSize.height*e,void 0!==p.maxWidth&&0!==p.maxWidth&&(a=Math.min(p.maxWidth,a)),void 0!==p.minWidth&&0!==p.minWidth&&(a=Math.max(p.minWidth,a)),void 0!==p.maxHeight&&0!==p.maxHeight&&(s=Math.min(p.maxHeight,s)),void 0!==p.minHeight&&0!==p.minHeight&&(s=Math.max(p.minHeight,s)),h&&(a=Math.max(a,d.right-p.wrapper.bounds.x),s=Math.max(s,d.bottom-p.wrapper.bounds.y)),t=a/p.actualSize.width,e=s/p.actualSize.height}var l=m(),c=void 0;if(n||(n=r),c=n.wrapper,b(l,-c.rotateAngle,i.x,i.y),w(l,t,e,i.x,i.y),b(l,c.rotateAngle,i.x,i.y),r instanceof En){var p,g,u=void 0,f=y(l,{x:(p=r).wrapper.offsetX,y:p.wrapper.offsetY}),v=p.wrapper.offsetX-p.wrapper.actualSize.width*p.pivot.x,x=p.wrapper.offsetY-p.wrapper.actualSize.height*p.pivot.y;if(a>0)if(p.processId){var S=this.diagram.nameTable[p.processId];(!S.maxWidth||p.margin.left+a<S.maxWidth)&&(p.width=a,p.offsetX=f.x)}else p.width=a,p.offsetX=f.x;if(s>0)if(p.processId){var P=this.diagram.nameTable[p.processId];(!P.maxHeight||p.margin.top+s<P.maxHeight)&&(p.height=s,p.offsetY=f.y)}else p.height=s,p.offsetY=f.y;u=p.wrapper.offsetX-p.wrapper.actualSize.width*p.pivot.x,g=p.wrapper.offsetY-p.wrapper.actualSize.height*p.pivot.y;this.diagram.nameTable[p.processId]&&(p.margin.top+(g-x)<=0||p.margin.left+(u-v)<=0)?this.diagram.nodePropertyChange(r,{},{margin:{top:p.margin.top,left:p.margin.left}}):$t(this.diagram,r,!0)?te(this.diagram,r):this.diagram.nodePropertyChange(r,{},{width:p.width,height:p.height,offsetX:p.offsetX,offsetY:p.offsetY,margin:{top:p.margin.top+(g-x),left:p.margin.left+(u-v)}})}else{var C=r;if(!C.sourceWrapper||!C.targetWrapper){C.sourcePoint=y(l,C.sourcePoint),C.targetPoint=y(l,C.targetPoint);var T={sourcePoint:C.sourcePoint,targetPoint:C.targetPoint};this.diagram.connectorPropertyChange(C,{},T)}}var A=this.diagram.nameTable[r.processId];if(A){A.wrapper.bounds,r.wrapper.bounds,d=this.diagram.bpmnModule.getChildrenBound(A,r.id,this.diagram);this.diagram.bpmnModule.updateSubProcessess(d,r,this.diagram)}}},i.prototype.portDrag=function(t,e,i,r){var o,n,a=this.findTarget(e,t),s=_i(t.wrapper);a&&Ut(a,this.diagram)&&(o=this.getPortChanges(t,a),a.offset.x+=i/s.width,a.offset.y+=r/s.height,n=this.getPortChanges(t,a),this.diagram.nodePropertyChange(t,o,n),this.diagram.updateDiagramObject(t))},i.prototype.labelDrag=function(t,e,i,r){var o,n,a;a=this.findTarget(e,t);var s=Wi(t.wrapper);o=this.getAnnotationChanges(t,a),a instanceof so?(a.offset.x+=i/s.width,a.offset.y+=r/s.height):(this.updatePathAnnotationOffset(t,a,i,r),a instanceof ho&&(a.alignment="Center")),n=this.getAnnotationChanges(t,a),t instanceof En?this.diagram.nodePropertyChange(t,o,n):this.diagram.connectorPropertyChange(t,o,n),this.diagram.updateDiagramObject(t),hr(this.diagram,a,!1,e)||this.labelSelect(t,e)},i.prototype.updatePathAnnotationOffset=function(t,e,i,r,o,n){var a,s,h,d=this.diagram.getWrapper(t.wrapper,e.id),l=d.offsetX,c=d.offsetY,p=t.intermediatePoints,g=0,u=0,f=o||{x:l+i,y:c+r},m=this.getInterceptWithSegment(f,p),y=p[p.length-1];if(u=wr.getLengthFromListOfPoints(p),m.length>0){if(e.dragLimit.top||e.dragLimit.bottom||e.dragLimit.left||e.dragLimit.right){var v={minDistance:null};y=this.getRelativeOffset(f,p,v);var b={minDistance:null};if(h=this.getRelativeOffset(f,m,b),null!=v&&b.minDistance<v.minDistance)y=h;else{y=Ne(t.intermediatePoints,e,t.wrapper.bounds).point}}else y=h=m[m.length-1];if(y){var w=void 0;for(w=0;w<p.length;w++){if(null!=s){if(xr.toBounds([s,p[w]]).containsPoint(y)){g+=wr.findLength(s,y);break}g+=wr.findLength(s,p[w])}s=p[w]}a={x:g/u,y:0}}this.updateLabelMargin(t,e,a,f,n,i,r)}else this.updateLabelMargin(t,e,null,f,n,i,r)},i.prototype.getRelativeOffset=function(t,e,i){var r,o,n,a;for(a=0;a<e.length;a++)n=e[a],o=Math.round(Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))),null!==i.minDistance&&Math.min(Math.abs(i.minDistance),Math.abs(o))!==Math.abs(o)||(r=n,i.minDistance=o);return r},i.prototype.dragLimitValue=function(t,e,i,r){var o=!1,n=!1;return i.x>=e.x-t.dragLimit.left-r.width/2&&i.x<=e.x+t.dragLimit.right+r.width/2&&(o=!0),i.y>=e.y-t.dragLimit.top-r.height/2&&i.y<=e.y+t.dragLimit.bottom+r.height/2&&(n=!0),{x:o,y:n}},i.prototype.updateLabelMargin=function(t,e,i,r,o,n,a){if(i=i||{x:e.offset,y:0},e&&i&&i.x>0&&i.x<1){var s=void 0,h=wr.getLengthFromListOfPoints(t.intermediatePoints);s=this.getPointAtLength(h*i.x,t.intermediatePoints,0);var d=this.diagram.scrollSettings.currentZoom,l=e.dragLimit;if(l.top||l.bottom||l.left||l.right){this.diagram.getWrapper(t.wrapper,e.id);var c=new xr(0,0,0,0),p=this.diagram.getWrapper(t.wrapper,e.id);c.x=p.offsetX/d+n,c.y=p.offsetY/d+a,c.width=p.bounds.width/d,c.height=p.bounds.height/d;var g=new xr(s.x-(l.left||0)-c.width/2,s.y-(l.top||0)-c.height/2,(l.left||0)+(l.right||0)+c.width,(l.top||0)+(l.bottom||0)+c.height);if(g.containsPoint(r))r=r;else for(var u=[s,r],f=0,m=this.boundsInterSects(u,g,!1);f<m.length;f++){r=m[f]}var y=this.dragLimitValue(e,s,r,c);e.margin={left:y.x?r.x-s.x:e.margin.left,top:y.y?r.y-s.y:e.margin.top,right:0,bottom:0}}else e.margin={left:r.x-s.x,top:r.y-s.y,right:0,bottom:0};e.offset=i.x,o&&(e.width=o.width,e.height=o.height)}},i.prototype.boundsInterSects=function(t,e,i){var r;if(e){var o=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height},{x:e.x,y:e.y}];r=this.intersect(t,o,i)}return r},i.prototype.intersect=function(t,e,i){for(var r=[],o=0;o<t.length-1;o++)for(var n=0;n<e.length-1;n++){var a=Oe(t[o],t[o+1],e[n],e[n+1]);0!==a.x&&0!==a.y&&r.push(a)}return r},i.prototype.getPointAtLength=function(t,e,i){for(var r,o,n=0,a={x:0,y:0},s=0;s<e.length;s++)if(o=e[s],r){var h=wr.findLength(r,o),d=void 0,l=void 0,c=void 0,p=void 0;if(n+h>=t){d=t-n,l=wr.findAngle(r,o),c=d*Math.cos(l*Math.PI/180),p=d*Math.sin(l*Math.PI/180),a={x:r.x+c,y:r.y+p},l;break}n+=h,r=o}else r=o;return a},i.prototype.getInterceptWithSegment=function(t,e){var i,r,o,n=[],a=[],s=[];o=wr.findLength({x:0,y:0},{x:this.diagram.scroller.viewPortWidth,y:this.diagram.scroller.viewPortHeight});for(var h=1;h<e.length;h++){s=[e[h-1],e[h]],a=[],r=Math.round(wr.findAngle(s[0],s[1])%360),i=Math.round(wr.findAngle(s[1],s[0])%360);var d=r>0&&r<=90||r>180&&r<=270?90:-90;a.push(wr.transform(t,r+d,o)),a.push(wr.transform(t,i+d,o));var l=Le({x1:s[0].x,y1:s[0].y,x2:s[1].x,y2:s[1].y},{x1:a[0].x,y1:a[0].y,x2:a[1].x,y2:a[1].y});l.enabled&&n.push(l.intersectPt)}return n},i.prototype.getAnnotationChanges=function(t,e){var i={};return i[ni(t,e.id,!0)]={width:e.width,height:e.height,offset:t instanceof En?{x:e.offset.x,y:e.offset.y}:e.offset,rotateAngle:e.rotateAngle,margin:{left:e.margin.left,right:e.margin.right,top:e.margin.top,bottom:e.margin.bottom},horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,alignment:t instanceof Wo?e.alignment:void 0},{annotations:i}},i.prototype.getPortChanges=function(t,e){var i={};return i[ni(t,e.id,!1)]={offset:e.offset},{ports:i}},i.prototype.labelRotate=function(t,e,i,r){var o,n;o=this.getAnnotationChanges(t,e);m(),e.rotateAngle;var a=this.diagram.getWrapper(t.wrapper,e.id),s=$({x:a.offsetX,y:a.offsetY},i)+90,h=this.snapAngle(s);if(s=0!==h?h:s,e instanceof ho&&e.segmentAngle){s-=Re(t.intermediatePoints,e,t.wrapper.bounds).angle}s=(s+360)%360,e.rotateAngle+=s-(e.rotateAngle+a.parentTransform),e.margin.bottom+="Top"===a.verticalAlignment?-e.height/2:"Bottom"===a.verticalAlignment?e.height/2:0,e.margin.right+="Left"===a.horizontalAlignment?-e.width/2:"Right"===a.horizontalAlignment?e.width/2:0,e instanceof ho?e.alignment="Center":e.horizontalAlignment=e.verticalAlignment="Center",r.wrapper.rotateAngle=r.rotateAngle=e.rotateAngle,n=this.getAnnotationChanges(t,e),t instanceof En?this.diagram.nodePropertyChange(t,o,n):this.diagram.connectorPropertyChange(t,o,n),this.diagram.updateDiagramObject(t)},i.prototype.labelResize=function(t,e,i,r,o,n){var a,s,h;a=this.getAnnotationChanges(t,e);var d=n.wrapper.children[0];if(i&&1!==i||r&&1!==r){var l=m(),c=m();b(l,-t.rotateAngle,t.offsetX,t.offsetY),b(c,-(h=(d.rotateAngle+(t instanceof En?t.rotateAngle:0)+360)%360),o.x,o.y),w(c,i,r,o.x,o.y),b(c,h,o.x,o.y);var p=y(c,{x:d.offsetX,y:d.offsetY}),g=d.actualSize.height*r,u=d.actualSize.width*i,f=this.findTarget(d,t);if(f instanceof ho)this.updatePathAnnotationOffset(t,e,0,0,p,new yr(u,g));else{var v=Wi(t.wrapper);(p=y(l,p)).x=p.x-d.margin.left+d.margin.right,p.y=p.y-d.margin.top+d.margin.bottom,p.y+="Top"===f.verticalAlignment?-g/2:"Bottom"===f.verticalAlignment?g/2:0,p.x+="Left"===f.horizontalAlignment?-u/2:"Right"===f.horizontalAlignment?u/2:0;var x=v.width/(p.x-v.x),S=v.height/(p.y-v.y);u>1&&(f.width=u,f.offset.x=1/x),g>1&&(f.height=g,f.offset.y=1/S)}}e instanceof ho&&(e.alignment="Center"),s=this.getAnnotationChanges(t,e),t instanceof En?this.diagram.nodePropertyChange(t,a,s):this.diagram.connectorPropertyChange(t,a,s),this.diagram.updateDiagramObject(t)},i.prototype.getSubProcess=function(t){var e,i={nodes:[],connectors:[]};return t instanceof En?e=t.processId:t&&t.nodes&&t.nodes.length&&t.nodes[0].processId&&(e=t.nodes[0].processId),e?(i.nodes.push(Xi(this.diagram.nameTable[e])),i):i},i.prototype.checkBoundaryConstraints=function(t,e,i){var r=this.diagram.pageSettings,o=this.diagram.pageSettings.boundaryConstraints,n=this.diagram.scroller;if("Page"===o||"Diagram"===o){var a=i?void 0:this.diagram.selectedItems.wrapper.bounds,s="Page"===o?r.width:n.viewPortWidth,h="Page"===o?r.height:n.viewPortHeight,d=i,l=(i?d.right:a.right)+(t||0),c=(i?d.left:a.left)+(t||0),p=(i?d.top:a.top)+(e||0),g=(i?d.bottom:a.bottom)+(e||0);return l<=s&&c>=0&&g<=h&&p>=0}return!0},i.prototype.dragSelectedObjects=function(t,e){var i=this.diagram.selectedItems;return this.state&&!this.state.backup&&(this.state.backup={},this.state.backup.offsetX=i.offsetX,this.state.backup.offsetY=i.offsetY),i=Jt(this.diagram,i)||i,!!this.checkBoundaryConstraints(t,e)&&(this.diagram.drag(i,t,e),!0)},i.prototype.scaleSelectedItems=function(t,e,i){var r=this.diagram.selectedItems;return this.state&&!this.state.backup&&(this.state.backup={},this.state.backup.offsetX=r.offsetX,this.state.backup.offsetY=r.offsetY,this.state.backup.width=r.width,this.state.backup.height=r.height,this.state.backup.pivot=i),r=Jt(this.diagram,r)||r,this.diagram.scale(r,t,e,i)},i.prototype.rotateSelectedItems=function(t){var e=this.diagram.selectedItems;return this.state&&!this.state.backup&&(this.state.backup={},this.state.backup.angle=e.rotateAngle),e=Jt(this.diagram,e)||e,this.diagram.rotate(e,t)},i.prototype.hasSelection=function(){return ar(this.diagram)},i.prototype.isSelected=function(t){return hr(this.diagram,t)},i.prototype.initExpand=function(t){var e=t.target||t.source,i={isExpanded:e.isExpanded};e.isExpanded=!e.isExpanded,this.diagram.nodePropertyChange(e,i,{isExpanded:e.isExpanded})},i.prototype.expandNode=function(t,e){var i,r=t.isExpanded;return this.expandCollapse(t,r,this.diagram),t.isExpanded=r,this.diagram.layout.fixedNode=t.id,this.diagram.layoutAnimateModule&&this.diagram.layout.enableAnimation&&this.diagram.organizationalChartModule&&(this.diagram.organizationalChartModule.isAnimation=!0),this.diagram.preventNodesUpdate=!0,this.diagram.preventConnectorsUpdate=!0,i=this.diagram.doLayout(),this.diagram.preventNodesUpdate=!1,this.diagram.preventConnectorsUpdate=!1,this.diagram.layoutAnimateModule&&this.diagram.layout.enableAnimation&&this.diagram.organizationalChartModule&&this.layoutAnimateModule.expand(this.diagram.organizationalChartModule.isAnimation,i,t,this.diagram),i},i.prototype.getparentexpand=function(t,e,i,r){for(var o,n=0;n<t.inEdges.length;n++){var a=e.nameTable[t.inEdges[n]],s=e.nameTable[a.sourceID];if(s.isExpanded&&!i&&s.id!==r.sourceID&&a.visible)return!1;o=!0}return o},i.prototype.expandCollapse=function(t,e,i){for(var r=0;r<t.outEdges.length;r++){var o=i.nameTable[t.outEdges[r]],n=i.nameTable[o.targetID],a=this.getparentexpand(n,i,e,o);o.visible=e;var s={visible:n.visible,style:{opacity:n.style.opacity}},h={visible:n.visible,style:{opacity:n.style.opacity}};a&&(n.isExpanded&&this.expandCollapse(n,e,i),n.visible=e,n.style.opacity=this.diagram.layoutAnimateModule&&this.diagram.layout.enableAnimation&&e?.1:n.style.opacity,i.nodePropertyChange(n,s,h)),i.connectorPropertyChange(o,s,h)}},i.prototype.updateNodeDimension=function(t,e){t instanceof En&&(t.offsetX=e.x+e.width/2,t.offsetY=e.y+e.height/2,t.width=e.width,t.height=e.height,t.wrapper.children[0].canMeasurePath=!0,this.diagram.nodePropertyChange(t,{},{width:e.width,height:e.height,offsetX:t.offsetX,offsetY:t.offsetY}),"SVG"!==this.diagram.mode&&this.diagram.refreshDiagramLayer())},i.prototype.updateConnectorPoints=function(t,e){t instanceof Wo&&(this.diagram.connectorPropertyChange(t,{},{targetPoint:t.targetPoint}),this.diagram.updateDiagramObject(t))},i.prototype.drawSelectionRectangle=function(t,e,i,r){this.diagram.drawSelectionRectangle(t,e,i,r)},i.prototype.startGroupAction=function(){this.diagram.startGroupAction()},i.prototype.endGroupAction=function(){this.diagram.endGroupAction()},i.prototype.removeChildFromBPmn=function(t,e,i){var r=this.diagram.nameTable[t.id]||t.nodes[0];if(i&&r&&r.processId&&r.processId===i.wrapper.id){var o=Xi(r);o.processId=r.processId,this.diagram.startGroupAction();for(var n=[],a=(n=n.concat(r.outEdges,r.inEdges)).length-1;a>=0;a--){var s=this.diagram.nameTable[n[a]];s&&this.diagram.remove(s)}var h=void 0;(h=this.diagram.nameTable[r.processId].shape.activity.subProcess.processes||[]).splice(h.indexOf(r.id),1),this.diagram.bpmnModule.removeChildFromBPMN(this.diagram.nameTable[r.processId].wrapper,r.id),this.diagram.nameTable[r.id].processId="",r.offsetX=r.wrapper.offsetX,r.offsetY=r.wrapper.offsetY;var d={type:"PositionChanged",redoObject:{nodes:[Xi(r)]},undoObject:{nodes:[o]},category:"Internal"};this.addHistoryEntry(d),this.diagram.endGroupAction()}},i.prototype.isDroppable=function(t,e){var i=this.diagram.nameTable[t.id]||t.nodes[0];return"TextAnnotation"===i.shape.shape||(!i||"Bpmn"!==i.shape.type||i.processId!==e.id&&i.id!==e.processId&&!e.shape.activity.subProcess.collapsed)},i.prototype.renderHighlighter=function(t,e,i){new xr;if(t.target instanceof En||e&&t.source instanceof En){var r=e?t.source:t.target,o=e?t.sourceWrapper:t.targetWrapper,n=this.findTarget(o,r,i,!0),a=void 0;if(n instanceof mn)for(var s=n.id,h=t.target,d=0,l=h.wrapper.children[0].children[0].children[2].children;d<l.length;d++){var c=l[d];if(c.id===h.id+"_"+s){a=c.children[0];break}}else a=n instanceof En?n.wrapper:e?t.sourceWrapper:t.targetWrapper;this.diagram.renderHighlighter(a)}},i.prototype.mouseOver=function(t,e,i){return!0},i.prototype.snapPoint=function(t,e,i,r){var o,n=this.diagram.selectedItems,a=e.x<t.x,s=e.y<t.y,h=o={x:i,y:r};return this.snappingModule&&(h=this.diagram.snappingModule.snapPoint(this.diagram,n,a,s,o,t,e)),h},i.prototype.removeSnap=function(){this.diagram.snapSettings.constraints&t.SnapConstraints.SnapToObject&&this.snappingModule&&this.snappingModule.removeGuidelines(this.diagram)},i.prototype.dropAnnotation=function(t,e){var i=t instanceof En?t:t.nodes[0];if(this.diagram.bpmnModule&&"Bpmn"===e.shape.type&&"TextAnnotation"===i.shape.shape){i.hasTarget=e.id,i.shape.annotation.nodeId=e.id,this.diagram.currentSymbol||(this.diagram.addTextAnnotation(i.shape.annotation,e),i.shape.annotation.nodeId="",this.diagram.remove(i)),this.diagram.refreshDiagramLayer()}},i.prototype.drop=function(t,e,i){this.diagram.bpmnModule&&(this.diagram.bpmnModule.dropBPMNchild(e,t instanceof En?t:t.nodes[0],this.diagram),this.diagram.refreshDiagramLayer())},i.prototype.addHistoryEntry=function(t){this.diagram.addHistoryEntry(t)},i.prototype.align=function(t,e,i){if(t.length>0){var r=0,o="Object"===i?_i(t[0].wrapper):this.diagram.selectedItems.wrapper.bounds,n={nodes:[],connectors:[]},a={nodes:[],connectors:[]};for(r="Object"===i?r+1:r;r<t.length;r++){var s=0,h=0,d=_i(t[r].wrapper);"Left"===e?s=o.left+d.width/2-d.center.x:"Right"===e?s=o.right-d.width/2-d.center.x:"Top"===e?h=o.top+d.height/2-d.center.y:"Bottom"===e?h=o.bottom-d.height/2-d.center.y:"Center"===e?s=o.center.x-d.center.x:"Middle"===e&&(h=o.center.y-d.center.y),n=this.storeObject(n,t[r]),this.drag(t[r],s,h),this.diagram.updateSelector(),a=this.storeObject(a,t[r])}n=Xi(n),a=Xi(a);var l={type:"Align",category:"Internal",undoObject:Xi(n),redoObject:Xi(a)};this.addHistoryEntry(l)}},i.prototype.distribute=function(t,e){if(t.length>0){var i=0,r=(new xr,0),o=0,n=0,a=0,s=0,h=0,d=0,l={nodes:[],connectors:[]},c={nodes:[],connectors:[]};for(t=ke(t),i=1;i<t.length;i++)r=r+t[i].wrapper.bounds.topRight.x-t[i-1].wrapper.bounds.topRight.x,o=o+t[i].wrapper.bounds.topLeft.x-t[i-1].wrapper.bounds.topLeft.x,n=n+t[i].wrapper.bounds.topRight.y-t[i-1].wrapper.bounds.topRight.y,a=a+t[i].wrapper.bounds.bottomRight.y-t[i-1].wrapper.bounds.bottomRight.y,s=s+t[i].wrapper.bounds.center.x-t[i-1].wrapper.bounds.center.x,h=h+t[i].wrapper.bounds.center.y-t[i-1].wrapper.bounds.center.y,d=d+t[i].wrapper.bounds.topRight.y-t[i-1].wrapper.bounds.bottomRight.y;for(i=1;i<t.length-1;i++){var p=0,g=0,u=_i(t[i-1].wrapper),f=_i(t[i].wrapper);"RightToLeft"===e||"Center"===e?p=u.center.x-f.center.x+s/(t.length-1):"Right"===e?p=u.topRight.x-f.topRight.x+r/(t.length-1):"Left"===e?p=u.topLeft.x-f.topLeft.x+o/(t.length-1):"Middle"===e?g=u.center.y-f.center.y+h/(t.length-1):"Top"===e?g=u.topRight.y-f.topRight.y+n/(t.length-1):"Bottom"===e?g=u.bottomRight.y-f.bottomRight.y+a/(t.length-1):"BottomToTop"===e&&(g=u.bottomRight.y-f.topRight.y+d/(t.length-1)),l=this.storeObject(l,t[i]),this.drag(t[i],p,g),this.diagram.updateSelector(),c=this.storeObject(c,t[i])}l=Xi(l),c=Xi(c);var m={type:"Distribute",category:"Internal",undoObject:Xi(l),redoObject:Xi(c)};this.addHistoryEntry(m)}},i.prototype.sameSize=function(t,e){if(t.length>0){var i=0,r=void 0;r={x:.5,y:.5};var o=_i(t[0].wrapper),n={nodes:[],connectors:[]},a={nodes:[],connectors:[]};for(i=1;i<t.length;i++){var s=_i(t[i].wrapper),h=1,d=1;"Width"===e?h=o.width/s.width:"Height"===e?d=o.height/s.height:"Size"===e&&(h=o.width/s.width,d=o.height/s.height),n=this.storeObject(n,t[i]),this.scale(t[i],h,d,r),a=this.storeObject(a,t[i])}this.diagram.updateSelector(),n=Xi(n),a=Xi(a);var l={type:"Sizing",category:"Internal",undoObject:Xi(n),redoObject:Xi(a)};this.addHistoryEntry(l)}},i.prototype.storeObject=function(t,e){return e instanceof En?t.nodes.push(Xi(e)):t.connectors.push(Xi(e)),t},i.prototype.scroll=function(e,i,r){var o=function(e){return e.constraints&t.DiagramConstraints.PanX}(this.diagram),n=function(e){return e.constraints&t.DiagramConstraints.PanY}(this.diagram);this.diagram.pan((e=o?e:0)*this.diagram.scroller.currentZoom,(i=n?i:0)*this.diagram.scroller.currentZoom,r)},i.prototype.drawHighlighter=function(t){this.diagram.renderHighlighter(t.wrapper)},i.prototype.removeHighlighter=function(){this.diagram.clearHighlighter()},i.prototype.renderContainerHelper=function(t){return Jt(this.diagram,t)},i.prototype.isParentAsContainer=function(t,e){return $t(this.diagram,t,e)},i.prototype.dropChildToContainer=function(t,e){ee(this.diagram,t,e)},i.prototype.checkSelection=function(t,e){var i;if(1===t.nodes.length&&0===t.connectors.length)if($t(this.diagram,t.nodes[0],!0)){i="SwimLane"===t.nodes[0].shape?t.nodes[0]:this.diagram.nameTable[t.nodes[0].parentId];var r=t.nodes[0];if("Grid"===i.container.type)if("Horizontal"===i.container.orientation&&1===r.rowIndex||"Vertical"===i.container.orientation&&r.rowIndex>0&&r.columnIndex>0){if("ResizeSouth"===e)if("SwimLane"===i.shape.type){var o=(s=i.wrapper.children[0]).rows[s.rows.length-1].cells[0];this.select(this.diagram.nameTable[o.children[0].children[0].id])}else for(var n=0;n<this.diagram.nodes.length;n++){if((h=this.diagram.nodes[n]).rowIndex===i.rows.length-1&&0===h.columnIndex){this.select(h);break}}}else if("ResizeEast"===e)if("SwimLane"===i.shape.type){var a,s=void 0;a=(s=i.wrapper.children[0]).rows[s.rows.length-1].cells[s.rows[s.rows.length-1].cells.length-1],this.select(this.diagram.nameTable[a.children[0].id])}else for(n=0;n<this.diagram.nodes.length;n++){var h;if(1===(h=this.diagram.nodes[n]).rowIndex&&h.columnIndex===i.columns.length-1){this.select(h);break}}}else if("SwimLane"===t.nodes[0].shape.type){i=t.nodes[0];s=void 0,r=void 0;var d=void 0;"ResizeSouth"===e&&"Vertical"===t.nodes[0].shape.orientation?(r=(s=i.wrapper.children[0]).rows[s.rows.length-1].cells[0],this.select(this.diagram.nameTable[r.children[0].id])):"ResizeEast"===e?(s=i.wrapper.children[0],d=t.nodes[0].shape.header?1:0,r=s.rows[d].cells[s.rows[d].cells.length-1],this.select(this.diagram.nameTable[r.children[0].id])):"ResizeSouth"===e&&"Horizontal"===t.nodes[0].shape.orientation&&(d=(s=i.wrapper.children[0]).rows.length-1,r=s.rows[d].cells[s.rows[d].cells.length-1],this.select(this.diagram.nameTable[r.children[0].id]))}},i.prototype.zoom=function(t,e,i,r){this.diagram.scroller.zoom(t,e*this.diagram.scroller.currentZoom,i*this.diagram.scroller.currentZoom,r)},i}(),Wa=function(){function e(t){this.transform={tx:0,ty:0,scale:1},this.oldCollectionObjects=[],this.removeCollection=[],this.vPortWidth=0,this.vPortHeight=0,this.currentZoomFActor=1,this.hOffset=0,this.vOffset=0,this.scrolled=!1,this.hScrollSize=0,this.vScrollSize=0,this.diagram=t,this.objects=[],this.transform=t.scroller?t.scroller.transform:{tx:0,ty:0,scale:1},this.vPortWidth=t.scrollSettings.viewPortWidth,this.vPortHeight=t.scrollSettings.viewPortHeight,this.currentZoomFActor=t.scrollSettings.currentZoom,this.hOffset=t.scrollSettings.horizontalOffset,this.vOffset=t.scrollSettings.verticalOffset}return Object.defineProperty(e.prototype,"viewPortHeight",{get:function(){return this.vPortHeight},set:function(t){this.vPortHeight=t,this.diagram.scrollSettings.viewPortHeight=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentZoom",{get:function(){return this.currentZoomFActor},set:function(t){this.currentZoomFActor=t,this.diagram.scrollSettings.currentZoom=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewPortWidth",{get:function(){return this.vPortWidth},set:function(t){this.vPortWidth=t,this.diagram.scrollSettings.viewPortWidth=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"horizontalOffset",{get:function(){return this.hOffset},set:function(e){this.hOffset=e,Math.abs(this.hOffset-this.diagram.scrollSettings.horizontalOffset)>1&&(this.diagram.realActions=this.diagram.realActions|t.RealAction.hScrollbarMoved,this.scrolled=!0),this.diagram.scrollSettings.horizontalOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"verticalOffset",{get:function(){return this.vOffset},set:function(e){this.vOffset=e,Math.abs(this.vOffset-this.diagram.scrollSettings.verticalOffset)>1&&(this.diagram.realActions=this.diagram.realActions|t.RealAction.vScrollbarMoved,this.scrolled=!0),this.diagram.scrollSettings.verticalOffset=e},enumerable:!0,configurable:!0}),e.prototype.updateScrollOffsets=function(t,e){var i=0,r=0,o=this.getPageBounds();o.x*=this.currentZoom,o.y*=this.currentZoom,o.width*=this.currentZoom,o.height*=this.currentZoom,i=Math.max(0,t-o.left),r=Math.max(0,e-o.top),void 0!==t&&void 0!==e?(this.horizontalOffset=i,this.verticalOffset=r,this.diagram.setOffset(i,r)):this.diagram.setOffset(-this.horizontalOffset-o.x,-this.verticalOffset-o.y),this.transform={tx:Math.max(this.horizontalOffset,-o.left)/this.currentZoom,ty:Math.max(this.verticalOffset,-o.top)/this.currentZoom,scale:this.currentZoom}},e.prototype.setScrollOffset=function(t,e){this.scrolled=!1;var i=this.getPageBounds();i.x*=this.currentZoom,i.y*=this.currentZoom,i.width*=this.currentZoom,i.height*=this.currentZoom;var r=-i.left,o=-i.top,n=!1,a=this.viewPortWidth*this.currentZoom,s=this.viewPortHeight*this.currentZoom,h=r-t;if(h!==this.horizontalOffset){r<this.horizontalOffset&&(this.horizontalOffset>h?this.horizontalOffset-=t:this.horizontalOffset=h,n=!0);var d=Math.max(i.right+this.vScrollSize,a);if(!n&&d<-h+this.viewPortWidth){var l=-h+a-this.vScrollSize,c=-this.horizontalOffset+a-this.vScrollSize;l<c?this.horizontalOffset=h:l-i.right>l-c?this.horizontalOffset=h:this.horizontalOffset=-(i.right+this.vScrollSize-a),n=!0}n||(this.horizontalOffset=r-t)}n=!1;var p=o-e;if(p!==this.verticalOffset){o<this.verticalOffset&&(this.verticalOffset>p?this.verticalOffset-=e:this.verticalOffset=p,n=!0);var g=Math.max(i.bottom+this.hScrollSize,s);if(!n&&g<-p+s){var u=-p+s-this.hScrollSize,f=-this.verticalOffset+s-this.hScrollSize;u<f?this.verticalOffset=p:u-i.bottom>u-f?this.verticalOffset=p:this.verticalOffset=-(i.bottom+this.hScrollSize-s),n=!0}n||(this.verticalOffset=o-e)}this.transform={tx:Math.max(this.horizontalOffset,-i.left)/this.currentZoom,ty:Math.max(this.verticalOffset,-i.top)/this.currentZoom,scale:this.currentZoom},this.setSize()},e.prototype.getObjects=function(t,e){for(var i=[],r=0;r<t.length;r++){for(var o=!1,n=0;n<e.length;n++)if(t[r]===e[n]){o=!0;break}o||i.push(t[r])}return i},e.prototype.virtualizeElements=function(){for(var t=this.viewPortWidth/this.currentZoom,e=this.viewPortHeight/this.currentZoom,i=this.diagram.spatialSearch.findObjects(new xr(-this.horizontalOffset/this.currentZoom,-this.verticalOffset/this.currentZoom,t,e)),r=[],o=0;o<i.length;o++)r.push(i[o].id);var n=this.getObjects(r,this.oldCollectionObjects);0===this.oldCollectionObjects.length&&(this.oldCollectionObjects=r);var a=this.getObjects(this.oldCollectionObjects,r);this.diagram.updateVirtualObjects(n,!1,a),this.oldCollectionObjects=r},e.prototype.setSize=function(){var t=this.getPageBounds();t.x*=this.currentZoom,t.y*=this.currentZoom,t.width*=this.currentZoom,t.height*=this.currentZoom;var e=Math.min(t.x,-this.horizontalOffset),i=Math.min(t.y,-this.verticalOffset),r=(this.horizontalOffset,this.viewPortWidth,t.right,this.verticalOffset,this.viewPortHeight,t.bottom,this.scrollerWidth),o=this.scrollerWidth;-this.verticalOffset<=t.y&&-this.verticalOffset+this.viewPortHeight>=t.bottom&&(o=0),-this.horizontalOffset<=t.x&&-this.horizontalOffset+this.viewPortWidth>=t.right&&(r=0),this.hScrollSize=r,this.vScrollSize=o;var n=this.diagramWidth,a=this.diagramHeight;this.diagramWidth=Math.max(t.right,-this.horizontalOffset+this.viewPortWidth-o)-e,this.diagramHeight=Math.max(t.bottom,-this.verticalOffset+this.viewPortHeight-r)-i,n===this.diagramWidth&&a===this.diagramHeight||this.diagram.setSize(this.diagramWidth,this.diagramHeight),this.diagram.transformLayers(),this.diagram.element.style.overflow="hidden"},e.prototype.setViewPortSize=function(t,e){this.viewPortWidth=t,this.viewPortHeight=e},e.prototype.getPageBounds=function(t,e){var i=new xr;if("Content"!==e&&null!==this.diagram.pageSettings.width&&null!==this.diagram.pageSettings.height){var r=this.diagram.pageSettings.width,o=this.diagram.pageSettings.height,n=0,a=0;if(this.diagram.pageSettings.multiplePage){if((i=this.diagram.spatialSearch.getPageBounds(0,0)).right>r){r*=s=Math.ceil(i.right/r)}if(i.bottom>o){o*=s=Math.ceil(i.bottom/o)}if(i.left<0&&Math.abs(i.left)>n){var s=Math.ceil(Math.abs(i.left)/this.diagram.pageSettings.width);n=this.diagram.pageSettings.width*s}if(i.top<0&&Math.abs(i.top)>a){s=Math.ceil(Math.abs(i.top)/this.diagram.pageSettings.height);a=this.diagram.pageSettings.height*s}}return new xr(-n,-a,r+n,o+a)}var h=t?void 0:0;return this.diagram.spatialSearch.getPageBounds(h,h)},e.prototype.getPageBreak=function(t){for(var e=0,i=0,r=-1,o=[],n=0,a=0,s=0,h=0,d=this.diagram.pageSettings.margin.left,l=this.diagram.pageSettings.margin.right,c=this.diagram.pageSettings.margin.top,p=this.diagram.pageSettings.margin.bottom,g=1,u=1,f={x1:n,y1:s,x2:a,y2:h};t.width>e;)(e+=this.diagram.pageSettings.width?this.diagram.pageSettings.width:t.width)===this.diagram.pageSettings.width&&(f={x1:t.left+d,y1:t.top+c,x2:t.left+d,y2:t.bottom-p},o[++r]=f),e<t.width&&(f={x1:n=t.topLeft.x+this.diagram.pageSettings.width*g,y1:s=t.topLeft.y+c,x2:a=t.bottomLeft.x+this.diagram.pageSettings.width*g,y2:h=t.bottomLeft.y-p},o[++r]=f,g++),t.width===e&&(f={x1:t.right-l,y1:t.top+c,x2:t.right-l,y2:t.bottom-p},o[++r]=f);for(;t.height>i;)(i+=this.diagram.pageSettings.height?this.diagram.pageSettings.height:t.height)===this.diagram.pageSettings.height&&(f={x1:t.left+d,y1:t.top+c,x2:t.right-l,y2:t.top+c},o[++r]=f),i<t.height&&(f={x1:n=t.topLeft.x+d,y1:s=t.topLeft.y+this.diagram.pageSettings.height*u,x2:a=t.topRight.x-l,y2:h=t.topRight.y+this.diagram.pageSettings.height*u},o[++r]=f,u++),t.height===i&&(f={x1:t.left+d,y1:t.bottom-p,x2:t.right-l,y2:t.bottom-p},o[++r]=f);return o},e.prototype.zoom=function(e,i,r,o){if(function(e){return e.constraints&t.DiagramConstraints.Zoom}(this.diagram)&&1!==e||function(e){return e.constraints&t.DiagramConstraints.Pan}(this.diagram)&&1===e){var n=m();if(w(n,this.currentZoom,this.currentZoom),x(n,this.horizontalOffset,this.verticalOffset),o=o||{x:this.viewPortWidth/2,y:this.viewPortHeight/2},o=y(n,o),this.currentZoom*e>=this.diagram.scrollSettings.minZoom&&this.currentZoom*e<=this.diagram.scrollSettings.maxZoom){this.currentZoom*=e;var a=this.getPageBounds();a.x*=this.currentZoom,a.y*=this.currentZoom;var s=m();w(s,e,e,o.x,o.y),x(s,i||0,r||0),S(n,s);var h=y(n,{x:0,y:0});1===e&&(h=this.applyScrollLimit(h.x,h.y)),this.transform={tx:Math.max(h.x,-a.left)/this.currentZoom,ty:Math.max(h.y,-a.top)/this.currentZoom,scale:this.currentZoom},this.horizontalOffset=h.x,this.verticalOffset=h.y,this.setSize(),"SVG"!==this.diagram.mode&&Rt(this.diagram)&&this.diagram.scroller.virtualizeElements(),"SVG"===this.diagram.mode||Rt(this.diagram)||this.diagram.refreshDiagramLayer(),this.diagram.setOffset(-this.horizontalOffset-a.x,-this.verticalOffset-a.y),ue(this.diagram)}}},e.prototype.fitToPage=function(t){var e=(t=t||{}).mode,i=t.region,r=t.margin||{},o=t.canZoomIn,n=t.customBounds;r.bottom=r.bottom||25,r.top=r.top||25,r.left=r.left||25,r.right=r.right||25;var a,s=n,h=-this.horizontalOffset,d=-this.verticalOffset;if("PageSettings"===(i=i||"PageSettings")&&this.diagram.pageSettings.width&&this.diagram.pageSettings.height||this.diagram.nodes.length>0||this.diagram.connectors.length>0){e=e||"Page","CustomBounds"!==i&&(s=this.getPageBounds(!0,i));var l={x:0,y:0};l.x=(this.viewPortWidth-(r.left+r.right))/s.width,l.y=(this.viewPortHeight-(r.top+r.bottom))/s.height,!o&&s.width-this.horizontalOffset<this.viewPortWidth&&s.height-this.verticalOffset<this.viewPortHeight&&(l.x=Math.min(1,l.x),l.y=Math.min(1,l.y));var c=void 0,p=void 0,g=void 0;switch(e){case"Width":a=(c=l.x)/this.currentZoom,h+=(p=(this.viewPortWidth-s.width*c)/2-s.x*c)+(r.left-r.right)/2*c,d-=-this.verticalOffset*a,d="CustomBounds"!==i?d:d-this.verticalOffset*a;break;case"Height":a=(c=l.y)/this.currentZoom,p=(this.viewPortWidth-s.width*c)/2-s.x*c,g=(this.viewPortHeight-s.height*c)/2-s.y*c,h+=p+(r.left-r.right)/2*c,d+=g+(r.top-r.bottom)/2*c;break;case"Page":a=(c=Math.min(l.x,l.y))/this.currentZoom,p=(this.viewPortWidth-s.width*c)/2-s.x*c,g=(this.viewPortHeight-s.height*c)/2-s.y*c,h+=p+(r.left-r.right)/2*c,d+=g+(r.top-r.bottom)/2*c}this.zoom(a,h,d,{x:0,y:0})}else a=1/this.currentZoom,this.zoom(a,h,d,{x:0,y:0})},e.prototype.bringIntoView=function(t){var e=0,i=0,r=this.currentZoom,o=t,n=-this.horizontalOffset,a=-this.verticalOffset;o=new xr(o.x*r,o.y*r,o.width*r,o.height*r);new xr(n,a,this.viewPortWidth,this.viewPortHeight).containsRect(o)||(o.right>-n+this.viewPortWidth&&(e=o.right-this.viewPortWidth),o.x<-n&&(e=o.x),o.bottom>-a+this.viewPortHeight&&(i=o.bottom-this.viewPortHeight),o.y<-a&&(i=o.y),this.zoom(1,-this.horizontalOffset-e,-this.verticalOffset-i,null))},e.prototype.bringToCenter=function(t){var e=this.currentZoom,i=new xr(t.x*e,t.y*e,t.width*e,t.height*e),r=i.x+i.width/2-this.viewPortWidth/2,o=i.y+i.height/2-this.viewPortHeight/2;this.zoom(1,-this.horizontalOffset-r,-this.verticalOffset-o,null)},e.prototype.applyScrollLimit=function(t,e){if("Infinity"!==this.diagram.scrollSettings.scrollLimit){var i=void 0;"Limited"===this.diagram.scrollSettings.scrollLimit&&(i=this.diagram.scrollSettings.scrollableArea),(i=i||this.getPageBounds(!0)).x*=this.currentZoom,i.y*=this.currentZoom,i.width*=this.currentZoom,i.height*=this.currentZoom,t*=-1,e*=-1;var r=Math.max(i.right,this.viewPortWidth);if(!(t<=i.x&&(t+this.viewPortWidth>=i.right||t>=i.right-this.viewPortWidth)||t>=i.x&&t+this.viewPortWidth<=r))if(t>=i.x)t=Math.max(i.x,Math.min(t,t-(t+this.viewPortWidth-this.vScrollSize-r)));else{var o=i.right-this.viewPortWidth;t=Math.min(o,i.x)}var n=Math.max(i.bottom,this.viewPortHeight);if(!(e<=i.y&&e+this.viewPortHeight>=i.bottom||e>=i.y&&e+this.viewPortHeight<=n))if(e>=i.y)e=Math.max(i.y,Math.min(e,e-(e+this.viewPortHeight-this.hScrollSize-n)));else{o=i.bottom-this.viewPortHeight;e=Math.min(i.y,o)}t*=-1,e*=-1}return{x:t,y:e}},e}(),_a=function(){function t(t,e,i,r,o){this.objects=[],this.left=t,this.top=e,this.width=i,this.height=r,this.spatialSearch=o}return t.prototype.findQuads=function(t,e){null!=this.first&&this.first.isIntersect(t)&&this.first.findQuads(t,e),null!=this.second&&this.second.isIntersect(t)&&this.second.findQuads(t,e),null!=this.third&&this.third.isIntersect(t)&&this.third.findQuads(t,e),null!=this.fourth&&this.fourth.isIntersect(t)&&this.fourth.findQuads(t,e),this.objects.length>0&&e.push(this)},t.prototype.isIntersect=function(t){return!(this.left+this.width<t.left||this.top+this.height<t.top||this.left>t.right||this.top>t.bottom)},t.prototype.selectQuad=function(){for(var t,e=null,i=this;null!=i;)i=(t=i.getQuad(e)).source,e=t.target||e;return e},t.prototype.getQuad=function(e){var i=this.width/2,r=this.height/2;if(i>=1e3&&r>=1e3){var o=this.left+i,n=this.top+r;if(this.spatialSearch.childRight<=o){if(this.spatialSearch.childBottom<=n){if(!this.first){(a=new t(this.left,this.top,i,r,this.spatialSearch)).parent=this,this.first=a}return{source:this.first}}if(this.spatialSearch.childTop>=n){if(!this.third){(a=new t(this.left,n,i,r,this.spatialSearch)).parent=this,this.third=a}return{source:this.third}}}else if(this.spatialSearch.childLeft>=o){if(this.spatialSearch.childBottom<=n){if(!this.second){(a=new t(o,this.top,i,r,this.spatialSearch)).parent=this,this.second=a}return{source:this.second}}if(this.spatialSearch.childTop>=n){if(!this.fourth){var a;(a=new t(o,n,i,r,this.spatialSearch)).parent=this,this.fourth=a}return{source:this.fourth}}}}return this,this.objects.push(this.spatialSearch.childNode),{target:this}},t.prototype.isContained=function(){return this.spatialSearch.childLeft>=this.left&&this.spatialSearch.childRight<=this.left+this.width&&this.spatialSearch.childTop>=this.top&&this.spatialSearch.childBottom<=this.top+this.height},t.prototype.addIntoAQuad=function(t){var e={};this.spatialSearch.setCurrentNode(t);for(var i=null;!e.isAdded;)i=(e=this.spatialSearch.parentQuad.add(i)).quad;return i},t.prototype.add=function(e){if(e=null,this.isContained())return e=this.selectQuad(),{isAdded:!0,quad:e};var i=void 0,r=!(0!==this.objects.length||this.first||this.second||this.third||this.fourth),o=2*this.width,n=2*this.height;return this.spatialSearch.childLeft<this.left?this.spatialSearch.childTop<this.top?(i=new t(this.left-this.width,this.top-this.height,o,n,this.spatialSearch),r||(i.fourth=this)):(i=new t(this.left-this.width,this.top,o,n,this.spatialSearch),r||(i.second=this)):this.spatialSearch.childTop<this.top?(i=new t(this.left,this.top-this.height,o,n,this.spatialSearch),r||(i.third=this)):(i=new t(this.left,this.top,o,n,this.spatialSearch),r||(i.first=this)),this.parent=i,this.spatialSearch.parentQuad=i,{isAdded:!1,quad:e}},t}(),Xa=function(){function t(t){this.quadSize=500,this.objectTable=t,this.parentQuad=new _a(0,0,2*this.quadSize,2*this.quadSize,this),this.pageLeft=Number.MAX_VALUE,this.pageRight=-Number.MAX_VALUE,this.pageTop=Number.MAX_VALUE,this.pageBottom=-Number.MAX_VALUE,this.quadTable={}}return t.prototype.removeFromAQuad=function(t){if(this.quadTable[t.id]){var e=this.quadTable[t.id],i=this.objectIndex(e.objects,t);-1!==i&&(e.objects.splice(i,1),this.update(e),delete this.quadTable[t.id])}},t.prototype.update=function(t){if(t.parent&&0===t.objects.length&&t.first&&t.second&&t.third&&t.fourth){var e=t.parent;e.first===t?e.first=null:e.second===t?e.second=null:e.third===t?e.third=null:e.fourth===t&&(e.fourth=null),this.update(t.parent)}else t!==this.parentQuad||t.first||t.second||t.third||t.fourth||(t.left=0,t.width=1e3,t.top=0,t.height=1e3)},t.prototype.addIntoAQuad=function(t){var e=this.parentQuad.addIntoAQuad(t);this.quadTable[t.id]=e},t.prototype.objectIndex=function(t,e){for(var i=0;i<t.length;i++)if(t[i].id===e.id)return i;return-1},t.prototype.updateQuad=function(t){this.setCurrentNode(t);var e=t.outerBounds;if(isNaN(e.x)||isNaN(e.y)||isNaN(e.width)||isNaN(e.height))return!1;if(this.quadTable[t.id]){this.quadTable[t.id].isContained()||(this.removeFromAQuad(t),this.addIntoAQuad(t))}else this.addIntoAQuad(t);if(!this.isWithinPageBounds(e)||this.leftElement===t||this.topElement===t||this.rightElement===t||this.bottomElement===t){var i=!1;return this.pageLeft===this.childLeft&&t===this.leftElement||(this.pageLeft>=this.childLeft?(this.pageLeft=this.childLeft,this.leftElement=t,i=!0):t===this.leftElement&&(this.pageLeft=Number.MAX_VALUE,this.findLeft(this.parentQuad),i=!0)),this.pageTop===this.childTop&&t===this.topElement||(this.pageTop>=this.childTop?(this.pageTop=this.childTop,this.topElement=t,i=!0):t===this.topElement&&(this.pageTop=Number.MAX_VALUE,this.findTop(this.parentQuad),i=!0)),this.pageBottom===this.childBottom&&t===this.bottomElement||(this.pageBottom<=this.childBottom?(i=!0,this.pageBottom=this.childBottom,this.bottomElement=t):t===this.bottomElement&&(this.pageBottom=-Number.MAX_VALUE,this.findBottom(this.parentQuad),i=!0)),this.pageRight===this.childRight&&t===this.rightElement||(this.pageRight<=this.childRight?(this.pageRight=this.childRight,this.rightElement=t,i=!0):t===this.rightElement&&(this.pageRight=-Number.MAX_VALUE,this.findRight(this.parentQuad),i=!0)),i}return this.setCurrentNode(null),!1},t.prototype.isWithinPageBounds=function(t){return t.left>=this.pageLeft&&t.right<=this.pageRight&&t.top>=this.pageTop&&t.bottom<=this.pageBottom},t.prototype.findQuads=function(t){var e=[];return this.parentQuad.findQuads(t,e),e},t.prototype.findObjects=function(t){for(var e=[],i=0,r=this.findQuads(t);i<r.length;i++)for(var o=0,n=r[i].objects;o<n.length;o++){var a=n[o];a.outerBounds.intersects(t)&&e.push(this.objectTable[a.id])}return e},t.prototype.updateBounds=function(t){var e=!1;return t===this.topElement&&(this.pageTop=Number.MAX_VALUE,this.topElement=null,this.findTop(this.parentQuad),e=!0),t===this.leftElement&&(this.pageLeft=Number.MAX_VALUE,this.leftElement=null,this.findLeft(this.parentQuad),e=!0),t===this.rightElement&&(this.pageRight=-Number.MAX_VALUE,this.rightElement=null,this.findRight(this.parentQuad),e=!0),t===this.bottomElement&&(this.pageBottom=-Number.MAX_VALUE,this.bottomElement=null,this.findBottom(this.parentQuad),e=!0),e},t.prototype.findBottom=function(t){t.third||t.fourth?(t.third&&this.findBottom(t.third),t.fourth&&this.findBottom(t.fourth)):(t.second&&this.findBottom(t.second),t.first&&this.findBottom(t.first));for(var e=0,i=t.objects;e<i.length;e++){var r=i[e];this.pageBottom<=r.outerBounds.bottom&&(this.pageBottom=r.outerBounds.bottom,this.bottomElement=r)}},t.prototype.findRight=function(t){t.second||t.fourth?(t.second&&this.findRight(t.second),t.fourth&&this.findRight(t.fourth)):(t.first&&this.findRight(t.first),t.third&&this.findRight(t.third));for(var e=0,i=t.objects;e<i.length;e++){var r=i[e];this.pageRight<=r.outerBounds.right&&(this.pageRight=r.outerBounds.right,this.rightElement=r)}},t.prototype.findLeft=function(t){t.first||t.third?(t.first&&this.findLeft(t.first),t.third&&this.findLeft(t.third)):(t.second&&this.findLeft(t.second),t.fourth&&this.findLeft(t.fourth));for(var e=0,i=t.objects;e<i.length;e++){var r=i[e];this.pageLeft>=r.outerBounds.left&&(this.pageLeft=r.outerBounds.left,this.leftElement=r)}},t.prototype.findTop=function(t){t.first||t.second?(t.first&&this.findTop(t.first),t.second&&this.findTop(t.second)):(t.third&&this.findTop(t.third),t.fourth&&this.findTop(t.fourth));for(var e=0,i=t.objects;e<i.length;e++){var r=i[e];this.pageTop>=r.outerBounds.top&&(this.pageTop=r.outerBounds.top,this.topElement=r)}},t.prototype.setCurrentNode=function(t){if(this.childNode=t,t){var e=t.outerBounds;this.childLeft=Number(e.left),this.childTop=Number(e.top),this.childRight=Number(e.right),this.childBottom=Number(e.bottom)}else this.childLeft=Number.MAX_VALUE,this.childTop=Number.MAX_VALUE,this.childRight=-Number.MAX_VALUE,this.childBottom=-Number.MAX_VALUE},t.prototype.getPageBounds=function(t,e){if(this.pageLeft===Number.MAX_VALUE)return new xr(0,0,0,0);var i=void 0!==t?Math.min(this.pageLeft,0):this.pageLeft,r=void 0!==e?Math.min(this.pageTop,0):this.pageTop;return new xr(Math.round(i),Math.round(r),Math.round(this.pageRight-i),Math.round(this.pageBottom-r))},t.prototype.getQuad=function(t){return this.quadTable[t.id]},t}(),Ya=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Va=function(t,e,i,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},Ua=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Ya(i,t),Va([e.Property()],i.prototype,"key",void 0),Va([e.Property()],i.prototype,"keyModifiers",void 0),i}(e.ChildProperty),Fa=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Ya(i,t),Va([e.Property("")],i.prototype,"name",void 0),Va([e.Property()],i.prototype,"canExecute",void 0),Va([e.Property()],i.prototype,"execute",void 0),Va([e.Complex({},Ua)],i.prototype,"gesture",void 0),Va([e.Property("")],i.prototype,"parameter",void 0),i}(e.ChildProperty),Ga=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Ya(i,t),Va([e.Collection([],Fa)],i.prototype,"commands",void 0),i}(e.ChildProperty),Za=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Ya(i,t),Va([e.Property()],i.prototype,"show",void 0),Va([e.Property()],i.prototype,"showCustomMenuOnly",void 0),Va([e.Property()],i.prototype,"items",void 0),i}(e.ChildProperty),qa=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Ka=function(t,e,i,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},Qa=function(i){function r(t,e){var r=i.call(this,t,e)||this;r.connectorTable={},r.groupTable={},r.activeLabel={id:"",parentId:"",isGroup:!1},r.textEditing=!1,r.isTriggerEvent=!1,r.preventNodesUpdate=!1,r.preventConnectorsUpdate=!1,r.selectionConnectorsList=[],r.deleteVirtualObject=!1,r.crudDeleteNodes=[],r.selectedObject={helperObject:void 0,actualObject:void 0},r.renderTimer=null;for(var o,n,a=0;t&&t.nodes&&a<t.nodes.length;a++)o=t.nodes[a],n=r.nodes[a],o.children&&o.children.length>0&&(o.style&&o.style.fill||(n.style.fill="transparent"),o.style&&o.style.strokeColor||(n.style.strokeColor="transparent")),o.shape&&"UmlActivity"===o.shape.type&&Pe(o,n);return r}return qa(r,i),r.prototype.clearCollection=function(t){for(var e,i=[],r=0,o=Object.keys(this.nameTable);r<o.length;r++){var n=o[r];(e=this.nameTable[n])&&(t&&e instanceof Wo||!t&&e instanceof En)&&i.push(e)}this.clearObjects(i)},r.prototype.onPropertyChanged=function(e,o){for(var n=[],a=!1,s=!1,h=0,d=Object.keys(e);h<d.length;h++){switch(d[h]){case"width":case"height":this.element.style.width=this.getSizeValue(this.width),this.element.style.height=this.getSizeValue(this.height),this.eventHandler.updateViewPortSize(this.element);for(var l=0,c=this.views;l<c.length;l++){var p=c[l],g=this.views[p];g instanceof r||g.updateView(g)}break;case"nodes":if(e.nodes.length>0&&0===o.nodes.length)this.clearCollection(),s=!0;else{for(var u=0,f=Object.keys(e.nodes);u<f.length;u++){var m=f[u],y=Number(m),v=this.nodes[y],b=e.nodes[y];a=a||void 0!==b.excludeFromLayout,this.nodePropertyChange(v,o.nodes[y],b,void 0,!0),n.push(v)}"Canvas"===this.mode&&this.refreshDiagramLayer()}break;case"connectors":if(e.connectors.length>0&&0===o.connectors.length)this.clearCollection(!0),s=!0;else{for(var w=0,x=Object.keys(e.connectors);w<x.length;w++){m=x[w],y=Number(m),v=this.connectors[y],b=e.connectors[y];this.connectorPropertyChange(v,o.connectors[y],b,!0),n.push(v)}this.updateBridging(),"Canvas"===this.mode&&this.refreshDiagramLayer()}break;case"bridgeDirection":this.updateBridging(),"Canvas"===this.mode&&this.refreshDiagramLayer();break;case"backgroundColor":this.intOffPageBackground();break;case"pageSettings":this.validatePageSize(),this.updatePage();break;case"selectedItems":if(e.selectedItems.userHandles&&this.selectedItems.wrapper&&this.selectedItems.userHandles&&this.selectedItems.userHandles.length>0){this.renderSelector(!0);break}if(e.selectedItems.constraints){this.renderSelector(!0);break}break;case"snapSettings":this.updateSnapSettings(e);break;case"commandManager":this.initCommands();break;case"layout":a=!0;break;case"dataSourceSettings":this.clear(),this.initObjects(),a=!0;break;case"tooltip":I(this);break;case"rulerSettings":this.updateRulerSettings(e);break;case"layers":this.updateLayer(e);break;case"scrollSettings":this.updateScrollSettings(e);break;case"locale":this.realActions|=t.RealAction.PreventDataInit,i.prototype.refresh.call(this),this.realActions&=~t.RealAction.PreventDataInit}}a&&this.doLayout();var S={element:n,cause:this.diagramActions,oldValue:o,newValue:e};if(this.triggerEvent(t.DiagramEvent.propertyChange,S),!s&&this.canLogChange()&&this.modelChanged(e,o)){var P={type:"PropertyChanged",undoObject:o,redoObject:e,category:"Internal"};this.addHistoryEntry(P)}this.resetDiagramActions(),s&&(this.initObjects(!0),this.refreshDiagramLayer())},r.prototype.updateSnapSettings=function(t){(void 0!==t.snapSettings.constraints||t.snapSettings.horizontalGridlines||t.snapSettings.verticalGridlines)&&this.diagramRenderer.updateGrid(this.snapSettings,Ti(this.element.id),this.scroller.transform,this.rulerSettings,this.hRuler,this.vRuler)},r.prototype.updateRulerSettings=function(t){void 0!==t.rulerSettings.dynamicGrid&&this.diagramRenderer.updateGrid(this.snapSettings,Ti(this.element.id),this.scroller.transform,this.rulerSettings,this.hRuler,this.vRuler),void 0!==t.rulerSettings.showRulers?(this.intOffPageBackground(),this.scroller.setSize(),this.renderRulers()):void 0===t.rulerSettings.horizontalRuler&&void 0===t.rulerSettings.verticalRuler||(void 0!==t.rulerSettings.horizontalRuler.thickness||void 0!==t.rulerSettings.verticalRuler.thickness?(fe(this),this.intOffPageBackground(),this.scroller.setSize(),this.renderRulers()):ue(this)),this.diagramRenderer.updateGrid(this.snapSettings,Ti(this.element.id),this.scroller.transform,this.rulerSettings,this.hRuler,this.vRuler)},r.prototype.getPersistData=function(){return this.addOnPersist(["loaded"])},r.prototype.preRender=function(){this.initializePrivateVariables(),this.isProtectedOnChange=!0,this.serviceLocator=new Kn,this.initializeServices(),this.setCulture();window.measureElement&&(window.measureElement=null),this.initDiagram(),this.initViews(),this.unWireEvents(),this.wireEvents(),this.element.classList.add("e-diagram")},r.prototype.initializePrivateVariables=function(){this.defaultLocale={Copy:"Copy",Cut:"Cut",Paste:"Paste",Undo:"Undo",Redo:"Redo",SelectAll:"Select All",Grouping:"Grouping",Group:"Group",UnGroup:"Un Group",Order:"Order",BringToFront:"Bring To Front",MoveForward:"Move Forward",SendToBack:"Send To Back",SendBackward:"Send Backward"},this.layerZIndex=-1,this.layerZIndexTable={},this.nameTable={},this.pathTable={},this.groupTable={},this.commands={},this.isLoading||(this.views=[]),this.commandHandler=new Ha(this),this.eventHandler=new ka(this,this.commandHandler),this.spatialSearch=new Xa(this.nameTable),this.scroller=new Wa(this)},r.prototype.initializeServices=function(){this.serviceLocator.register("localization",this.localeObj=new e.L10n(this.getModuleName(),this.defaultLocale,this.locale))},r.prototype.setCulture=function(){this.localeObj=new e.L10n(this.getModuleName(),this.defaultLocale,this.locale)},r.prototype.render=function(){var i=[];this.dataSourceSettings.crudAction.read&&this.renderInitialCrud(),this.initHistory(),this.diagramRenderer=new Vn(this.element.id,new Yn,"SVG"===this.mode),this.initLayers(),this.initializeDiagramLayers(),this.diagramRenderer.setLayers(),this.initObjects(!0),this.doLayout(),this.validatePageSize(),this.renderPageBreaks(),this.diagramRenderer.renderSvgGridlines(this.snapSettings,Ti(this.element.id),this.scroller.transform,this.rulerSettings,this.hRuler,this.vRuler),this.commandHandler.initSelectorWrapper(),this.notify("initial-load",{}),this.trigger("load"),this.scroller.setSize(),this.scroller.updateScrollOffsets(),this.refreshDiagramLayer(),(this.scrollSettings.verticalOffset>0||this.scrollSettings.horizontalOffset>0)&&this.updateScrollOffset(),e.Browser.isDevice&&(this.tool=t.DiagramTools.ZoomPan|t.DiagramTools.SingleSelect),this.notify("initial-end",{}),this.isProtectedOnChange=!1,this.tooltipObject=I(this),this.diagramActions=t.DiagramAction.Render;for(var r=this.nodes,o=0;o<r.length;o++)r[o].isExpanded||i.push(r[o]);if(i.length)for(o=i.length-1;o>=0;o--)this.commandHandler.expandNode(i[o],this);this.initCommands(),this.isLoading=!1},r.prototype.renderInitialCrud=function(){var t=this;if(t.dataSourceSettings.crudAction.read){(i=new e.Ajax(t.dataSourceSettings.crudAction.read,"GET",!1)).onSuccess=function(e){t.dataSourceSettings.dataManager=JSON.parse(e),t.dataBind()},i.send().then()}if(t.dataSourceSettings.connectionDataSource.crudAction.read){var i;(i=new e.Ajax(t.dataSourceSettings.connectionDataSource.crudAction.read,"GET",!1)).onSuccess=function(e){t.dataSourceSettings.connectionDataSource.dataManager=JSON.parse(e),t.dataBind()},i.send().then()}},r.prototype.getModuleName=function(){return"diagram"},r.prototype.requiredModules=function(){var e=[];return e.push({member:"Bpmn",args:[]}),e.push({member:"Bridging",args:[]}),e.push({member:"ConnectorEditingTool",args:[]}),this.constraints&t.DiagramConstraints.UndoRedo&&e.push({member:"UndoRedo",args:[]}),("OrganizationalChart"===this.layout.type||"HierarchicalTree"===this.layout.type||this.layout.enableAnimation)&&e.push({member:"LayoutAnimate",args:[]}),this.snapSettings.constraints&&e.push({member:"Snapping",args:[this]}),e.push({member:"PrintandExport",args:[this]}),this.contextMenuSettings.show&&e.push({member:"contextMenu",args:[this,this.serviceLocator]}),"OrganizationalChart"!==this.layout.type&&"HierarchicalTree"!==this.layout.type||e.push({member:"OrganizationalChart",args:[]}),"ComplexHierarchicalTree"===this.layout.type&&e.push({member:"ComplexHierarchicalTree",args:[]}),"MindMap"===this.layout.type&&e.push({member:"MindMapChart",args:[]}),"RadialTree"===this.layout.type&&e.push({member:"RadialTree",args:[]}),"SymmetricalLayout"===this.layout.type&&e.push({member:"SymmetricalLayout",args:[]}),(this.dataSourceSettings.dataManager||this.dataSourceSettings.data||this.dataSourceSettings.crudAction.read||this.dataSourceSettings.connectionDataSource.crudAction.read)&&e.push({member:"DataBinding",args:[]}),e},r.prototype.destroy=function(){if(clearInterval(this.renderTimer),this.renderTimer=null,this.hRuler&&this.vRuler&&(this.hRuler.destroy(),this.vRuler.destroy()),this.tooltipObject.destroy(),this.droppable.destroy(),this.unWireEvents(),this.notify("destroy",{}),i.prototype.destroy.call(this),document.getElementById(this.element.id)){this.element.classList.remove("e-diagram");for(var t=document.getElementsByClassName("e-tooltip-wrap");t.length>0;)t[0].parentNode.removeChild(t[0]);var e=document.getElementById(this.element.id+"content");e&&this.element.removeChild(e);var r="measureElement";window[r]&&(window[r].usageCount-=1,0===window[r].usageCount&&(window[r].parentNode.removeChild(window[r]),window[r]=null))}},r.prototype.wireEvents=function(){var t=e.Browser.touchStartEvent,i=e.Browser.touchEndEvent,r=e.Browser.touchMoveEvent,o=e.Browser.isPointer?"pointerleave":"mouseleave",n=e.Browser.isPointer,a="mozilla"===e.Browser.info.name?n?"mousewheel":"DOMMouseScroll":"mousewheel";e.EventHandler.add(this.diagramCanvas,t,this.eventHandler.mouseDown,this.eventHandler),e.EventHandler.add(this.diagramCanvas,r,this.eventHandler.mouseMove,this.eventHandler),e.EventHandler.add(this.diagramCanvas,i,this.eventHandler.mouseUp,this.eventHandler),e.EventHandler.add(this.diagramCanvas,o,this.eventHandler.mouseLeave,this.eventHandler),e.EventHandler.add(this.diagramCanvas,"keydown",this.eventHandler.keyDown,this.eventHandler),e.EventHandler.add(this.diagramCanvas,"dblclick",this.eventHandler.doubleClick,this.eventHandler),e.EventHandler.add(this.diagramCanvas,"scroll",this.eventHandler.scrolled,this.eventHandler),e.EventHandler.add(this.diagramCanvas,a,this.eventHandler.mouseWheel,this.eventHandler),e.EventHandler.add(window,"resize",this.eventHandler.windowResize,this.eventHandler),this.initDroppables()},r.prototype.unWireEvents=function(){var t=e.Browser.touchStartEvent,i=e.Browser.touchMoveEvent,r=e.Browser.isPointer?"pointerleave":"mouseleave",o=e.Browser.isPointer,n="mozilla"===e.Browser.info.name?o?"mousewheel":"DOMMouseScroll":"mousewheel",a=e.Browser.touchEndEvent;e.EventHandler.remove(this.diagramCanvas,t,this.eventHandler.mouseDown),e.EventHandler.remove(this.diagramCanvas,i,this.eventHandler.mouseMove),e.EventHandler.remove(this.diagramCanvas,a,this.eventHandler.mouseUp),e.EventHandler.remove(this.diagramCanvas,r,this.eventHandler.mouseLeave),e.EventHandler.remove(this.diagramCanvas,"keydown",this.eventHandler.keyDown),e.EventHandler.remove(this.diagramCanvas,"dblclick",this.eventHandler.doubleClick),e.EventHandler.remove(this.diagramCanvas,"scroll",this.eventHandler.scrolled),e.EventHandler.remove(this.diagramCanvas,n,this.eventHandler.mouseWheel),e.EventHandler.remove(window,"resize",this.eventHandler.windowResize)},r.prototype.select=function(t,e){null!=t&&this.commandHandler.selectObjects(t,e)},r.prototype.selectAll=function(){var t=[];t=this.getObjectsOfLayer(this.activeLayer.objects),this.select(t)},r.prototype.unSelect=function(t){t&&hr(this,t)&&this.commandHandler.unSelect(t)},r.prototype.clearSelection=function(){this.commandHandler.clearSelection(!0)},r.prototype.updateViewPort=function(){this.eventHandler.updateViewPortSize(this.element)},r.prototype.cutCommand=function(){this.cut()},r.prototype.cut=function(){this.commandHandler.cut()},r.prototype.addProcess=function(t,e){this.bpmnModule&&this.bpmnModule.addProcess(t,e,this)},r.prototype.removeProcess=function(t){this.bpmnModule&&this.bpmnModule.removeProcess(t,this)},r.prototype.pasteCommand=function(){this.paste()},r.prototype.paste=function(t){this.commandHandler.paste(t)},r.prototype.fitToPage=function(t){this.scroller.fitToPage(t)},r.prototype.bringIntoView=function(t){this.scroller.bringIntoView(t)},r.prototype.bringToCenter=function(t){this.scroller.bringToCenter(t)},r.prototype.copyCommand=function(){this.copy()},r.prototype.copy=function(){return this.commandHandler.copy()},r.prototype.group=function(){this.commandHandler.group()},r.prototype.unGroup=function(){this.commandHandler.unGroup()},r.prototype.sendToBack=function(){this.commandHandler.sendToBack()},r.prototype.setActiveLayer=function(t){var e=this.commandHandler.getLayer(t);this.activeLayer=e},r.prototype.addLayer=function(t,e){this.commandHandler.addLayer(t,e)},r.prototype.removeLayer=function(t){this.commandHandler.removeLayer(t)},r.prototype.moveObjects=function(t,e){this.commandHandler.moveObjects(t,e)},r.prototype.sendLayerBackward=function(t){this.commandHandler.sendLayerBackward(t)},r.prototype.bringLayerForward=function(t){this.commandHandler.bringLayerForward(t)},r.prototype.cloneLayer=function(t){this.commandHandler.cloneLayer(t)},r.prototype.bringToFront=function(){this.commandHandler.bringToFront()},r.prototype.moveForward=function(){this.commandHandler.sendForward()},r.prototype.sendBackward=function(){this.commandHandler.sendBackward()},r.prototype.getObject=function(t){return this.nameTable[t]},r.prototype.getActiveLayer=function(){return this.activeLayer},r.prototype.nudgeCommand=function(t,e,i){"object"!=typeof t&&this.nudge(t)},r.prototype.nudge=function(t,e,i){var r=0,o=0;"Left"===t||"Right"===t?r=("Left"===t?-1:1)*(e||1):o=("Up"===t?-1:1)*(i||1);var n=this.selectedItems,a=this.selectedItems.wrapper.children[0];a instanceof Gr?this.commandHandler.labelDrag(n.nodes[0],a,r,o):this.drag(n,r,o)},r.prototype.drag=function(e,i,r){if(this.bpmnModule&&e instanceof En){if(this.bpmnModule.updateAnnotationDrag(e,this,i,r))return}if(e instanceof Vo){if(this.preventConnectorsUpdate=!0,e.nodes&&e.nodes.length)for(var o=0,n=e.nodes;o<n.length;o++){var a=n[o];this.drag(a,i,r)}if(e.connectors&&e.connectors.length)for(var s=0,h=e.connectors;s<h.length;s++){var d=h[s];this.drag(d,i,r),-1===this.selectionConnectorsList.indexOf(d)&&this.selectionConnectorsList.push(d)}this.updateSelector()}else e instanceof En&&this.bpmnModule&&this.bpmnModule.updateAnnotationDrag(e,this,i,r),this.commandHandler.drag(e,i,r);if(e instanceof Vo){this.preventConnectorsUpdate=!1;for(var l=0,c=this.selectionConnectorsList;l<c.length;l++){var p=c[l];this.updateConnectorProperties(this.nameTable[p.id])}this.selectionConnectorsList=[]}if(this.diagramActions&t.DiagramAction.ToolAction||this.updateSelector(),"Canvas"===this.mode)for(var g=0,u=this.views;g<u.length;g++){var f=u[g],m=void 0;m=this.views[f],this.refreshCanvasDiagramLayer(m)}},r.prototype.scale=function(t,e,i,r){var o=!0;if(t instanceof Vo){if(t.nodes&&t.nodes.length)for(var n=0,a=t.nodes;n<a.length;n++){var s=a[n];o=this.commandHandler.scale(s,e,i,r,t)}if(t.connectors&&t.connectors.length)for(var h=0,d=t.connectors;h<d.length;h++){var l=d[h];this.commandHandler.scale(l,e,i,r,t)}this.updateSelector()}else this.commandHandler.scale(t,e,i,r,t.children?t:void 0);return o},r.prototype.rotate=function(t,e,i){var r;if(t)if(i=i||{x:t.wrapper.offsetX,y:t.wrapper.offsetY},t instanceof Vo){t.rotateAngle+=e,t.wrapper.rotateAngle+=e;var o=_i(t.wrapper);if(!(r=this.commandHandler.checkBoundaryConstraints(void 0,void 0,o)))return t.rotateAngle-=e,t.wrapper.rotateAngle-=e,r;var n=[];n=(n=n.concat(t.nodes)).concat(t.connectors),this.commandHandler.rotateObjects(t,n,e,i)}else this.commandHandler.rotateObjects(t,[t],e,i);return r},r.prototype.dragSourceEnd=function(t,e,i){this.commandHandler.dragSourceEnd(t,e,i)},r.prototype.dragTargetEnd=function(t,e,i){this.commandHandler.dragTargetEnd(t,e,i)},r.prototype.findObjectsUnderMouse=function(t,e){return this.eventHandler.findObjectsUnderMouse(t,e)},r.prototype.findObjectUnderMouse=function(t,e,i){return this.eventHandler.findObjectUnderMouse(t,e,i)},r.prototype.findTargetObjectUnderMouse=function(t,e,i,r,o){return this.eventHandler.findTargetUnderMouse(t,e,i,r,o)},r.prototype.findElementUnderMouse=function(t,e){return this.eventHandler.findElementUnderMouse(t,e)},r.prototype.findActionToBeDone=function(t,e,i,r){return this.eventHandler.findActionToBeDone(t,e,i,r)},r.prototype.getTool=function(t){var e,i=ir(this.getCustomTool);return i&&(e=i(t))?e:this.eventHandler.getTool(t)},r.prototype.getCursor=function(t,e){var i,r=ir(this.getCustomCursor);return r&&(i=r(t,e))?i:this.eventHandler.getCursor(t)},r.prototype.initHistory=function(){this.undoRedoModule&&this.undoRedoModule.initHistory(this)},r.prototype.addHistoryEntry=function(e){if(this.undoRedoModule&&this.constraints&t.DiagramConstraints.UndoRedo&&!this.currentSymbol){if(e.undoObject&&"helper"===e.undoObject.id)return;this.undoRedoModule.addHistoryEntry(e,this),"StartGroup"!==e.type&&"EndGroup"!==e.type&&this.historyChangeTrigger(e)}},r.prototype.historyChangeTrigger=function(e){var i={},r="oldValue",o="newValue",n=[];switch(e&&e.redoObject&&e.redoObject.nodes instanceof Array&&e.redoObject.connectors instanceof Array?n=e.redoObject.nodes.concat(e.redoObject.connectors):e.redoObject&&n.push(e.redoObject),i.type=e.type,e.type){case"PositionChanged":i[r]={offsetX:e.undoObject.offsetX,offsetY:e.undoObject.offsetY},i[o]={offsetX:e.redoObject.offsetX,offsetY:e.redoObject.offsetY};break;case"RotationChanged":i[r]={rotateAngle:e.undoObject.rotateAngle},i[o]={rotateAngle:e.redoObject.rotateAngle};break;case"SizeChanged":i[r]={offsetX:e.undoObject.offsetX,offsetY:e.undoObject.offsetY,width:e.undoObject.width,height:e.undoObject.height},i[o]={offsetX:e.redoObject.offsetX,offsetY:e.redoObject.offsetY,width:e.redoObject.width,height:e.redoObject.height};break;case"CollectionChanged":i[e.changeType]=n;break;case"ConnectionChanged":i[r]={offsetX:e.undoObject.offsetX,offsetY:e.undoObject.offsetY},i[o]={offsetX:e.redoObject.offsetX,offsetY:e.redoObject.offsetY}}var a={cause:e.category,source:n,change:i};n.length&&this.triggerEvent(t.DiagramEvent.historyChange,a)},r.prototype.startGroupAction=function(){this.addHistoryEntry({type:"StartGroup",category:"Internal"})},r.prototype.endGroupAction=function(){this.addHistoryEntry({type:"EndGroup",category:"Internal"})},r.prototype.undo=function(){this.undoRedoModule&&this.constraints&t.DiagramConstraints.UndoRedo&&this.undoRedoModule.undo(this)},r.prototype.redo=function(){this.undoRedoModule&&this.constraints&t.DiagramConstraints.UndoRedo&&this.undoRedoModule.redo(this)},r.prototype.align=function(e,i,r){i||(i=(i=[]).concat(this.selectedItems.nodes,this.selectedItems.connectors)),this.diagramActions=this.diagramActions|t.DiagramAction.PublicMethod,this.commandHandler.align(i,e,r||"Object")},r.prototype.distribute=function(e,i){i||(i=(i=[]).concat(this.selectedItems.nodes,this.selectedItems.connectors)),this.diagramActions=this.diagramActions|t.DiagramAction.PublicMethod,this.commandHandler.distribute(i,e)},r.prototype.sameSize=function(e,i){i||(i=(i=[]).concat(this.selectedItems.nodes,this.selectedItems.connectors)),this.diagramActions=this.diagramActions|t.DiagramAction.PublicMethod,this.commandHandler.sameSize(i,e)},r.prototype.zoom=function(t,e){this.scroller.zoom(t,0,0,e)},r.prototype.zoomTo=function(t){var e=t.zoomFactor?t.zoomFactor:.2;e="ZoomOut"===t.type?1/(1+e):1+e,this.scroller.zoom(e,0,0,t.focusPoint)},r.prototype.pan=function(t,e,i){this.scroller.zoom(1,t,e,i)},r.prototype.reset=function(){this.scroller.zoom(1/this.scroller.currentZoom,-this.scroller.horizontalOffset,-this.scroller.verticalOffset,{x:0,y:0})},r.prototype.triggerEvent=function(e,i){i&&this.updateEventValue(i),this.trigger(t.DiagramEvent[e],i)},r.prototype.updateEventValue=function(t){var e=t.element;t.element&&e instanceof Vo&&e.nodes.length+e.connectors.length===1&&(t.element=1===e.nodes.length?e.nodes[0]:e.connectors[0])},r.prototype.add=function(e,i){var r;if(e){var o={element:e=Xi(e),cause:this.diagramActions,state:"Changing",type:"Addition",cancel:!1};"helper"!==e.id&&this.triggerEvent(t.DiagramEvent.collectionChange,o),this.diagramActions=this.diagramActions|t.DiagramAction.PublicMethod,e.id=e.id||Hi();var n=this.activeLayer;if(!o.cancel&&!n.lock){if(n.objects.indexOf(e.id)<0&&!n.lock&&(n.visible||(n.visible=!0,this.dataBind()),n.objects.push(e.id)),_n(e)===Wo)(r=new Wo(this,"connectors",e,!0)).status="New",this.connectors.push(r),this.initObject(r),!1===e.visible&&this.updateElementVisibility(r.wrapper,r,e.visible),this.updateEdges(r);else{if(r=new En(this,"nodes",e,!0),r.parentId=e.parentId,r.umlIndex=e.umlIndex,r.status="New",this.nodes.push(r),this.initObject(r,n,void 0,i),this.bpmnModule){if(r.shape.annotations&&0!==r.shape.annotations.length)for(var a=0,s=this.bpmnModule.getTextAnnotationConn(r);a<s.length;a++){var h=s[a];this.initConnectors(h,n,!1)}r.shape.activity&&r.shape.activity.subProcess.processes&&r.shape.activity.subProcess.processes.length&&this.bpmnModule.updateDocks(r,this)}if(r.umlIndex>-1&&e.parentId&&this.nameTable[e.parentId]&&"UmlClassifier"===this.nameTable[e.parentId].shape.type){var d=this.nameTable[e.parentId];d.children.splice(r.umlIndex,0,r.id),d.wrapper.children.splice(r.umlIndex,0,r.wrapper),d.wrapper.measure(new yr),d.wrapper.arrange(d.wrapper.desiredSize),this.updateDiagramObject(d)}}if(o={element:r,cause:this.diagramActions,state:"Changed",type:"Addition",cancel:!1},"helper"!==e.id&&this.triggerEvent(t.DiagramEvent.collectionChange,o),!(this.diagramActions&t.DiagramAction.UndoRedo||this.diagramActions&t.DiagramAction.Group)){var l={type:"CollectionChanged",changeType:"Insert",undoObject:Xi(e),redoObject:Xi(e),category:"Internal"};this.addHistoryEntry(l)}"SVG"===this.mode&&(this.updateSvgNodes(r),this.updateDiagramObject(r),r.shape.activity&&r.shape.activity.subProcess.processes&&r.shape.activity.subProcess.processes.length&&this.updateProcesses(r),this.updateBridging())}}return this.resetDiagramActions(t.DiagramAction.PublicMethod),r},r.prototype.updateSvgNodes=function(t){if(t.children)for(var e=0,i=t.children;e<i.length;e++){var r=i[e];if(this.nameTable[r]&&this.nameTable[r].parentId){var o=wi(r+"_groupElement",this.element.id);o.parentNode.removeChild(o)}}},r.prototype.updateProcesses=function(t){if(this.bpmnModule&&t&&t.shape&&t.shape.activity&&t.shape.activity.subProcess.processes&&t.shape.activity.subProcess.processes.length){var e=t.shape.activity.subProcess.processes;this.moveSvgNode(t.id);for(var i=0,r=e;i<r.length;i++){var o=r[i];this.moveSvgNode(o);for(var n=[],a=(n=n.concat(this.nameTable[o].outEdges,this.nameTable[o].inEdges)).length-1;a>=0;a--)this.moveSvgNode(n[a])}for(var s=0,h=e;s<h.length;s++){o=h[s];this.nameTable[o].shape.activity.subProcess.processes&&this.nameTable[o].shape.activity.subProcess.processes.length&&this.updateProcesses(this.nameTable[o])}}else this.moveSvgNode(t.id)},r.prototype.moveSvgNode=function(t){var e=wi(t+"_groupElement",this.element.id),i=e.parentElement;e.parentNode.removeChild(e),i.appendChild(e)},r.prototype.addTextAnnotation=function(e,i){if(this.bpmnModule){var r=this.bpmnModule.addAnnotation(i,e,this);if(this.initConnectors(r,this.commandHandler.getObjectLayer(i.id),!1),this.updateDiagramObject(i),!(this.diagramActions&t.DiagramAction.UndoRedo||this.diagramActions&t.DiagramAction.Group)){var o={type:"CollectionChanged",changeType:"Insert",undoObject:Xi(e),redoObject:Xi(e),category:"Internal"};this.addHistoryEntry(o)}}},r.prototype.spliceConnectorEdges=function(t,e){var i,r=[];if(i=e?this.nameTable[t.sourceID]:this.nameTable[t.targetID])for(var o=(r=e?i.outEdges:i.inEdges).length-1;o>=0;o--)r[o]===t.id&&r.splice(o,1)},r.prototype.removeDependentConnector=function(t){for(var e,i=[],r=(i=i.concat(t.outEdges,t.inEdges)).length-1;r>=0;r--)(e=this.nameTable[i[r]])&&(this.connectorTable[e.id]=Xi(e),this.remove(e))},r.prototype.removeObjectsFromLayer=function(t){if(t.children)for(var e=0;e<t.children.length;e++){var i=this.nameTable[t.children[e]];i&&this.removeObjectsFromLayer(i)}var r=this.layers.indexOf(this.commandHandler.getObjectLayer(t.id)),o=this.layers[r].objects.indexOf(t.id);o>-1&&(hr(this,t)&&this.unSelect(t),this.layers[r].objects.splice(o,1),delete this.layers[r].zIndexTable[this.nameTable[t.id].zIndex])},r.prototype.removeElements=function(t){if("SVG"===this.mode||"Canvas"===this.mode&&"Native"===t.shape.type){var e=wi(t.id+"_groupElement",this.element.id);e&&e.parentNode.removeChild(e)}this.refreshCanvasLayers();for(var i,r=t.wrapper.children,o=0;o<r.length;o++)if(r[o]instanceof Ur||r[o].id&&r[o].id.indexOf("icon_content")>0){r[o].id.indexOf("icon_content")>0&&"SVG"===this.mode&&((i=wi(r[o].id+"_shape_groupElement",this.element.id)).parentNode.removeChild(i),(i=wi(r[o].id+"_rect_groupElement",this.element.id)).parentNode.removeChild(i));for(var n=0,a=this.views;n<a.length;n++){var s=a[n];ki(r[o].id+"_groupElement",s)}}else if(r[o]instanceof Po)for(var h=0,d=this.views;h<d.length;h++){s=d[h];ki(r[o].id+"_html_element",s)}},r.prototype.removeCommand=function(){this.remove()},r.prototype.remove=function(e){var i=[];i=i.concat(this.selectedItems.nodes,this.selectedItems.connectors);var r,o=!1;if(e){if((e=this.nameTable[e.id])&&(function(e){return e instanceof Wo?e.constraints&t.ConnectorConstraints.Delete:e.constraints&t.NodeConstraints.Delete}(e)||this.diagramActions&t.DiagramAction.Clear)&&(r={element:e,cause:this.diagramActions,state:"Changing",type:"Removal",cancel:!1},this.diagramActions&t.DiagramAction.Clear||"helper"===e.id||this.triggerEvent(t.DiagramEvent.collectionChange,r),!r.cancel)){if(this.bpmnModule&&this.bpmnModule.checkAndRemoveAnnotations(e,this))return void this.refreshCanvasLayers();if(!(this.diagramActions&t.DiagramAction.UndoRedo)&&(e instanceof En||e instanceof Wo)){var n={type:"CollectionChanged",changeType:"Remove",undoObject:Xi(e),redoObject:Xi(e),category:"Internal"};this.diagramActions&t.DiagramAction.Clear||i.length>0&&this.undoRedoModule&&!this.layout.type&&(this.historyList.startGroupAction(),o=!0),e instanceof En&&this.removeDependentConnector(e),this.diagramActions&t.DiagramAction.Clear||this.isStackChild(e)||this.addHistoryEntry(n)}e.children&&this.deleteGroup(e),e.parentId&&(this.deleteChild(e),this.nameTable[e.parentId]&&"UmlClassifier"===this.nameTable[e.parentId].shape.type&&this.updateDiagramObject(this.nameTable[e.parentId]));var a=void 0;this.diagramActions=this.diagramActions|t.DiagramAction.PublicMethod;var s=this.nameTable[e.id];s instanceof En?("Bpmn"===s.shape.type&&this.bpmnModule&&this.bpmnModule.removeBpmnProcesses(s,this),-1!==(a=this.nodes.indexOf(s))&&(this.crudDeleteNodes.push(this.nameTable[s.id]),this.nodes.splice(a,1),this.updateNodeEdges(s))):(-1!==(a=this.connectors.indexOf(s))&&(this.crudDeleteNodes.push(this.nameTable[s.id]),this.connectors.splice(a,1)),this.updateEdges(s),this.spliceConnectorEdges(e,!0),this.spliceConnectorEdges(e,!1)),o&&this.historyList.endGroupAction(),hr(this,s)&&this.unSelect(s),this.removeObjectsFromLayer(e),this.currentDrawingObject&&(this.currentDrawingObject.wrapper=void 0),delete this.nameTable[e.id],this.removeElements(s),this.updateBridging(),"SVG"!==this.mode&&this.refreshDiagramLayer(),this.diagramActions&t.DiagramAction.Clear||(this.removeFromAQuad(s),r={element:e,cause:this.diagramActions,state:"Changed",type:"Removal",cancel:!1},"helper"!==e.id&&this.triggerEvent(t.DiagramEvent.collectionChange,r),this.resetTool())}}else if(i.length>0){this.undoRedoModule&&(this.historyList.startGroupAction(),o=!0);for(var h=0;h<i.length;h++){i[h];if(this.nameTable[i[h].id]){if(i[h]instanceof Wo&&this.bpmnModule&&this.bpmnModule.textAnnotationConnectors.indexOf(i[h])>-1)return void this.remove(this.nameTable[i[h].targetID]);this.remove(i[h])}}o&&this.historyList.endGroupAction(),this.clearSelection()}},r.prototype.isStackChild=function(e){var i,r=this.nameTable[e.parentId];if(e&&e.parentId&&r.container&&"Stack"===r.container.type&&"UmlClassifier"!==this.nameTable[e.parentId].shape.type){i=!0;var o={type:"StackChildPositionChanged",redoObject:{sourceIndex:void 0,source:e,target:void 0,targetIndex:void 0},undoObject:{sourceIndex:r.wrapper.children.indexOf(e.wrapper),source:e,target:void 0,targetIndex:void 0},category:"Internal"};this.diagramActions&t.DiagramAction.UndoRedo||this.addHistoryEntry(o)}return i},r.prototype.deleteChild=function(t,e){var i;if(e=e?this.nameTable[e.id]:this.nameTable[t.parentId],i="string"==typeof t?t:t.id,e&&e.children){for(var r=0;r<e.children.length;r++)e.children[r]===i&&(e.children.splice(r,1),e.wrapper.children.splice(r,1));e.wrapper.measure(new yr),e.wrapper.arrange(e.wrapper.desiredSize)}},r.prototype.addChild=function(t,e,i){var r,o=this.nameTable[t.id];if(o.children&&("string"==typeof e?this.nameTable[e]&&(r=e):(r=e.id=e.id||Hi(),this.add(e)),r&&(!e.umlIndex||-1===e.umlIndex))){var n=this.nameTable[r];n.parentId=o.id,o.container&&"Stack"===o.container.type&&this.updateStackProperty(o,n),i?(o.children.splice(i,0,r),o.wrapper.children.splice(i,0,n.wrapper)):(o.children.push(r),o.wrapper.children.push(n.wrapper)),o.wrapper.measure(new yr),o.wrapper.arrange(o.wrapper.desiredSize),void 0!==o.container&&(n.offsetX=n.wrapper.offsetX,n.offsetY=n.wrapper.offsetY),this.updateDiagramObject(o)}},r.prototype.clear=function(){this.clearObjects()},r.prototype.clearObjects=function(e){var i=[];i=e||(i=i.concat(this.nodes)).concat(this.connectors),this.diagramActions=this.diagramActions|t.DiagramAction.Clear;for(var r=0,o=i;r<o.length;r++){var n=o[r];this.nameTable[n.id]&&this.remove(n)}this.diagramActions=this.diagramActions&~t.DiagramAction.Clear,this.spatialSearch=new Xa(this.nameTable),this.initHistory()},r.prototype.startEditCommad=function(){this.startTextEdit()},r.prototype.startTextEdit=function(i,r){if(!Bt(this)||Nt(this)){this.textEditing=!0;var o=this.scroller.transform,n=Xt(this)?o.scale:1,a=void 0,s=void 0,h=void 0,d=void 0,l=void 0;if(i||(i=this.selectedItems.nodes[0]?this.selectedItems.nodes[0]:this.selectedItems.connectors[0]),i){i.shape&&"UmlClassifier"===i.shape.type&&(i=this.nameTable[i.children[0]]);var c=!1;if(this.bpmnModule&&(l=this.bpmnModule.getTextAnnotationWrapper(i,r))&&(i=this.nameTable[i.id.split("_textannotation_")[0]]),l?c=!0:("Text"!==i.shape.type&&0===i.annotations.length&&(this.activeLabel.isGroup=!0,this.startGroupAction(),this.addLabels(i,[{id:Hi(),content:""}])),!r&&("Text"!==i.shape.type&&i.annotations.length>0||"Text"===i.shape.type)&&(r="Text"===i.shape.type?i.wrapper.children[0].id.split("_")[1]:i.annotations[0].id),r&&(l=this.getWrapper(i.wrapper,r))),i&&l&&!(l instanceof Po)&&(!function(e,i){var r=0;return r=i instanceof Wo?t.ConnectorConstraints.ReadOnly:t.NodeConstraints.ReadOnly,"Text"===i.shape.type?i.constraints&t.NodeConstraints.ReadOnly:i.constraints&r?e.constraints&t.AnnotationConstraints.InheritReadOnly?1:0:e.constraints&t.AnnotationConstraints.ReadOnly?1:0}(l,i)||c)){var p=l.style,g=void 0;g=90>(g=l.bounds.width<i.wrapper.bounds.width?l.bounds.width:i.wrapper.bounds.width)?90:g;var u=document.getElementById(this.element.id+"_editTextBoxDiv"),f=document.getElementById(this.element.id+"_editBox");a=f?f.value:l.content,u||f||(u=Oi("div",{}),f=Oi("textarea",{}),this.diagramCanvas.appendChild(u),u.appendChild(f),f.appendChild(document.createTextNode(a))),(s=yi(l.style,a,void 0,void 0,g)).isEmpty()&&(s="Text"!==i.shape.type?new yr(ii(i,l.id.split(i.id+"_")[1]).width||50,l.style.fontSize):new yr(i.width>50?50:i.width,l.style.fontSize)),i.parentId&&"UmlClassifier"===this.nameTable[i.parentId].shape.type?(s.width=i.wrapper.bounds.width-20,h=(i.wrapper.bounds.center.x+o.tx)*o.scale-s.width/2*n-2.5,d=(i.wrapper.bounds.center.y+o.ty)*o.scale-s.height/2*n-3,l.style.textAlign="Left"):(s.width=Math.max(s.width,50),h=(l.bounds.center.x+o.tx)*o.scale-s.width/2*n-2.5,d=(l.bounds.center.y+o.ty)*o.scale-s.height/2*n-3),Bi(u,{id:this.element.id+"_editTextBoxDiv",style:"position: absolute;left:"+h+"px;top:"+d+"px;width:"+(s.width+1)*n+"px;height:"+s.height*n+"px; containerName:"+i.id+";"}),Bi(f,{id:this.element.id+"_editBox",style:"width:"+(s.width+1)*n+"px;height:"+s.height*n+"px;resize: none;outline: none;overflow: hidden;;font-family:"+p.fontFamily+";font-size:"+p.fontSize*n+"px;text-align:"+l.style.textAlign.toLocaleLowerCase()+";",class:"e-diagram-text-edit"}),f.style.fontWeight=p.bold?"bold":"",f.style.fontStyle=p.italic?"italic":"",f.style.lineHeight=(1.2*p.fontSize+"px;").toString(),f.style.textDecoration=p.textDecoration?p.textDecoration:"",this.activeLabel.parentId=i.id,this.activeLabel.id=r,l.visible=!1,this.updateDiagramObject(i),this.diagramActions=this.diagramActions|t.DiagramAction.TextEdit,this.isTriggerEvent||(e.EventHandler.add(f,"input",this.eventHandler.inputChange,this.eventHandler),e.EventHandler.add(f,"focusout",this.focusOutEdit,this),f.select())}}}},r.prototype.updateNodeExpand=function(t,e){for(var i=0;i<t.outEdges.length;i++){var r=this.nameTable[t.outEdges[i]],o=this.nameTable[r.targetID];r.visible=e,e||(this.updateElementVisibility(r.wrapper,r,!1),o.isExpanded=e),this.updateNodeExpand(o,o.isExpanded),o.visible=e,e||this.updateElementVisibility(o.wrapper,o,!1)}},r.prototype.doLayout=function(){var e,i=!1,r=this.isProtectedOnChange;this.protectPropertyChange(!0);var o={x:this.scroller.viewPortWidth,y:this.scroller.viewPortHeight};if(this.organizationalChartModule?(e=this.organizationalChartModule.updateLayout(this.nodes,this.nameTable,this.layout,o,this.dataSourceSettings.id),i=!0,this.layoutAnimateModule&&e.rootNode&&!this.diagramActions&&this.updateNodeExpand(e.rootNode,e.rootNode.isExpanded)):this.mindMapChartModule?(this.mindMapChartModule.updateLayout(this.nodes,this.nameTable,this.layout,o,this.dataSourceSettings.id,this.dataSourceSettings.root),i=!0):this.radialTreeModule?(this.radialTreeModule.updateLayout(this.nodes,this.nameTable,this.layout,o),i=!0):this.symmetricalLayoutModule?(this.symmetricalLayoutModule.maxIteration=this.layout.maxIteration,this.symmetricalLayoutModule.springLength=this.layout.springLength,this.symmetricalLayoutModule.springFactor=this.layout.springFactor,this.symmetricalLayoutModule.updateLayout(this.nodes,this.connectors,this.symmetricalLayoutModule,this.nameTable,this.layout,o),i=!0):this.complexHierarchicalTreeModule&&(this.complexHierarchicalTreeModule.doLayout(this.nodes,this.nameTable,this.layout,o),i=!0),i){this.preventUpdate=!0;for(var n={},a=0,s=this.nodes;a<s.length;a++){var h=s[a];if(this.preventNodesUpdate||(this.updateIcon(h),this.updateDefaultLayoutIcons(h)),this.nodePropertyChange(h,{},{offsetX:h.offsetX,offsetY:h.offsetY},!0),h.wrapper.measure(new yr(h.wrapper.width,h.wrapper.height)),h.wrapper.arrange(h.wrapper.desiredSize),this.updateDiagramObject(h),h.inEdges.length>0)for(var d=0;d<h.inEdges.length;d++){n[(u=this.nameTable[h.inEdges[d]]).id]=u}if(h.outEdges.length>0)for(var l=0;l<h.outEdges.length;l++){var c=this.nameTable[h.outEdges[l]];n[c.id]=c}}for(var p=0,g=Object.keys(n);p<g.length;p++){var u;Qe(u=n[g[p]],this.getPoints(u)),u.wrapper.measure(new yr(void 0,void 0)),u.wrapper.arrange(u.wrapper.desiredSize),this.updateQuad(u),this.updateDiagramObject(u)}this.preventUpdate=!1,this.updatePage(),this.diagramActions&t.DiagramAction.Render&&"Canvas"!==this.mode||this.refreshDiagramLayer()}return r||this.protectPropertyChange(r),e},r.prototype.saveDiagram=function(){return We(this)},r.prototype.loadDiagram=function(t){return _e(t,this)},r.prototype.exportDiagram=function(t){if(this.printandExportModule){return this.printandExportModule.exportDiagram(t)}return""},r.prototype.print=function(t){this.printandExportModule&&this.printandExportModule.print(t)},r.prototype.addPorts=function(e,i){this.protectPropertyChange(!0);var r;i.length>1&&this.startGroupAction();for(var o=0;o<i.length;o++){if(r=new io(e,"ports",i[o],!0),e.ports.push(r),e.children){var n=e.wrapper;e.initPorts(this.getDescription,e.wrapper.children[n.children.length-1])}else{e.wrapper.children.push(e.initPortWrapper(e.ports[e.ports.length-1]))}if(!(this.diagramActions&t.DiagramAction.UndoRedo||this.diagramActions&t.DiagramAction.Group)){var a={type:"PortCollectionChanged",changeType:"Insert",undoObject:Xi(r),redoObject:Xi(e),category:"Internal"};this.addHistoryEntry(a)}}i.length>1&&this.endGroupAction(),e.wrapper.measure(new yr(e.width,e.height)),e.wrapper.arrange(e.wrapper.desiredSize),this.updateDiagramObject(e),this.protectPropertyChange(!1)},r.prototype.addConstraints=function(t,e){return t|e},r.prototype.removeConstraints=function(t,e){return t&~e},r.prototype.addLabels=function(e,i){this.protectPropertyChange(!0);var r,o=e.wrapper;i.length>1&&this.startGroupAction();for(var n=0;n<i.length;n++){if(e instanceof En)if(r=new so(e,"annotations",i[n],!0),e.annotations.push(r),e.children){for(var a=e,s=0;s<a.wrapper.children.length;s++)if("group_container"===a.wrapper.children[s].id){a.wrapper.children[s].children.push(e.initAnnotationWrapper(e.annotations[e.annotations.length-1],this.element.id))}}else o.children.push(e.initAnnotationWrapper(e.annotations[e.annotations.length-1],this.element.id));else if(e instanceof Wo){r=new ho(e,"annotations",i[n],!0),e.annotations.push(r);var h=o.children[0],d=new xr(h.offsetX-h.width/2,h.offsetY-h.height/2,h.width,h.height);o.children.push(e.getAnnotationElement(e.annotations[e.annotations.length-1],e.intermediatePoints,d,this.getDescription,this.element.id))}if(!(this.diagramActions&t.DiagramAction.UndoRedo||this.diagramActions&t.DiagramAction.Group)){var l={type:"LabelCollectionChanged",changeType:"Insert",undoObject:Xi(r),redoObject:Xi(e),category:"Internal"};this.addHistoryEntry(l)}}i.length>1&&this.endGroupAction(),e.wrapper.measure(new yr(o.width,o.height)),e.wrapper.arrange(o.desiredSize),this.updateDiagramObject(e),this.protectPropertyChange(!1)},r.prototype.removelabelExtension=function(e,i,r,o){for(var n=0;n<o.children.length;n++){var a=o.children[n];if((a instanceof Gr||a instanceof Po)&&a.id.match("_"+i[r].id+"$")){for(var s=0;s<e.annotations.length;s++)if(a.id.match("_"+e.annotations[s].id+"$")){if(!(this.diagramActions&t.DiagramAction.UndoRedo)){var h={type:"LabelCollectionChanged",changeType:"Remove",undoObject:Xi(e.annotations[s]),redoObject:Xi(e),category:"Internal"};this.addHistoryEntry(h)}e.annotations.splice(s,1)}if(o.children.splice(n,1),"SVG"===this.mode){var d=wi(a.id,this.element.id);if(d){var l=wi(a.id,this.element.id);l.parentNode.removeChild(l)}wi(a.id+"_text",this.element.id)&&(d=wi(a.id+"_text",this.element.id)).parentNode.removeChild(d);var c=wi(a.id+"_html_element",this.element.id);c&&c.parentNode.removeChild(c)}else this.refreshCanvasLayers()}}},r.prototype.removeLabels=function(t,e){e.length>1&&this.startGroupAction();for(var i=e.length-1;i>=0;i--)if(t.children&&t.children.length>0)for(var r=0;r<t.wrapper.children.length;r++)this.removelabelExtension(t,e,i,t.wrapper.children[r]);else this.removelabelExtension(t,e,i,t.wrapper);e.length>1&&this.endGroupAction()},r.prototype.removePortsExtenion=function(e,i,r,o){for(var n=0;n<o.children.length;n++){var a=o.children[n];if(a instanceof Yr&&a.id.match("_"+i[r].id+"$")){for(var s=0;s<e.ports.length;s++)if(a.id.match("_"+e.ports[s].id+"$")){if(!(this.diagramActions&t.DiagramAction.UndoRedo)){var h={type:"PortCollectionChanged",changeType:"Remove",undoObject:Xi(e.ports[s]),redoObject:Xi(e),category:"Internal"};this.addHistoryEntry(h)}e.ports.splice(s,1)}if(o.children.splice(n,1),"SVG"===this.mode){var d=wi(a.id,this.element.id);d.parentNode.removeChild(d)}else this.refreshCanvasLayers()}}},r.prototype.removePorts=function(t,e){e.length>1&&this.startGroupAction();for(var i=e.length-1;i>=0;i--)if(t.children&&t.children.length>0)for(var r=0;r<t.wrapper.children.length;r++)this.removePortsExtenion(t,e,i,t.wrapper.children[r]);else this.removePortsExtenion(t,e,i,t.wrapper);e.length>1&&this.endGroupAction()},r.prototype.getSizeValue=function(t,e){var i;if(i=t.toString().indexOf("px")>0?t.toString():t.toString().indexOf("%")>0?void 0!==e?"100%":t.toString():t.toString()+"px",e){me(this);i="calc("+i+" - "+e+"px)"}return i},r.prototype.renderRulers=function(){this.rulerSettings.showRulers?(!function(t){var e=me(t),i=Oi("div",{id:t.element.id+"_overlapRuler",style:"height:"+e.height+"px;width:"+e.width+"px;position:absolute;left:0;top:0",class:"e-ruler-overlap"});t.element.insertBefore(i,t.element.firstChild)}(this),ge(this,!0),ge(this,!1)):fe(this)},r.prototype.intOffPageBackground=function(){var t=new yr;t=me(this);var e=document.getElementById(this.element.id+"content"),i=this.getSizeValue(this.width,t.width),r=this.getSizeValue(this.height,t.height),o=this.rulerSettings.showRulers?"width:"+i+"; height:"+r+";top:"+t.height+"px;left:"+t.width+"px;overflow: scroll;position:absolute;overflow:auto;":"width:"+i+"; height:"+r+";position:absolute; left:0px;  top:0px;overflow: auto;",n={id:this.element.id+"content",tabindex:"0",style:o};e?(this.diagramCanvas=e,this.diagramCanvas.setAttribute("style",o)):(this.diagramCanvas=Oi("div",n),this.element.appendChild(this.diagramCanvas)),this.diagramCanvas.style.background=this.backgroundColor},r.prototype.initDiagram=function(){this.intOffPageBackground(),Bi(this.element,{style:"width:"+this.getSizeValue(this.width)+"; height:"+this.getSizeValue(this.height)+";position:relative;overflow:hidden;"})},r.prototype.renderBackgroundLayer=function(t,e){var i=this.createSvg(this.element.id+"_backgroundLayer_svg",t.width,t.height);i.setAttribute("style",e);var r=Ii("g",{id:this.element.id+"_backgroundImageLayer",class:"e-background-image-layer"});i.appendChild(r);var o=Ii("g",{id:this.element.id+"_backgroundLayer",class:"e-background-layer"});i.appendChild(o),this.diagramCanvas.appendChild(i)},r.prototype.renderGridLayer=function(t,e){var i=this.createSvg(this.element.id+"_gridline_svg",t.width,t.height);i.setAttribute("class","e-grid-layer");var r=Ii("g",{id:this.element.id+"_gridline",width:"100%",height:"100%"}),o=Ii("rect",{id:this.element.id+"_grid_rect",x:"0",y:"0",width:"100%",height:"100%",fill:"url(#"+this.element.id+"_pattern)"});r.appendChild(o),i.appendChild(r),this.diagramCanvas.appendChild(i),Ni(i,{style:e})},r.prototype.renderDiagramLayer=function(t,e){var i={id:this.element.id+"_diagramLayer_div",style:"width:"+t.width+"px; height:"+t.height+"px;"+e};if(this.diagramLayerDiv=Oi("div",i),"SVG"===this.mode){var r=this.createSvg(this.element.id+"_diagramLayer_svg",t.width,t.height);r.setAttribute("style"," pointer-events: none; "),r.setAttribute("class","e-diagram-layer");var o=Ii("g",{id:this.element.id+"_diagramLayer"}),n=Ii("g",{});this.diagramLayer=o,o.setAttribute("style","pointer-events: all;"),n.appendChild(o),r.appendChild(n),this.diagramLayerDiv.appendChild(r)}else this.diagramLayer=Xn.createCanvas(this.element.id+"_diagram",t.width,t.height),this.diagramLayer.setAttribute("style","position:absolute;left:0px;top:0px;"),this.diagramLayerDiv.appendChild(this.diagramLayer);this.diagramCanvas.appendChild(this.diagramLayerDiv)},r.prototype.initLayers=function(){var t="position:absolute;top:0px;left:0px;overflow:hidden;pointer-events:none;",e=document.getElementById(this.element.id).getBoundingClientRect(),i=function(){var t=Oi("div",{style:"visibility:hidden; width: 100px"});document.body.appendChild(t);var e=t.getBoundingClientRect().width;t.style.overflow="scroll";var i=Oi("div",{style:"width:100%"});t.appendChild(i);var r=i.getBoundingClientRect().width;return t.parentNode.removeChild(t),e-r}();this.scroller.scrollerWidth=i,this.scroller.setViewPortSize(e.width,e.height),this.renderRulers(),ji(),this.renderBackgroundLayer(e,t),this.renderGridLayer(e,t),this.renderDiagramLayer(e,t),this.renderHTMLLayer(e,t),this.renderPortsExpandLayer(e,t),this.renderNativeLayer(e,t),this.renderAdornerLayer(e,t)},r.prototype.renderAdornerLayer=function(t,e){var i=Oi("div",{id:this.element.id+"_diagramAdornerLayer",style:"width:"+t.width+"px;height:"+t.height+"px;"+e}),r=this.createSvg(this.element.id+"_diagramAdorner_svg",t.width,t.height);r.setAttribute("class","e-adorner-layer"),r.setAttribute("style","pointer-events:none;"),this.adornerLayer=Ii("g",{id:this.element.id+"_diagramAdorner"}),this.adornerLayer.setAttribute("style"," pointer-events: all; "),r.appendChild(this.adornerLayer),i.appendChild(r),this.diagramCanvas.appendChild(i);var o=Ii("g",{id:this.element.id+"_SelectorElement"});this.adornerLayer.appendChild(o),Ni(r,{style:"pointer-events:none;"})},r.prototype.renderPortsExpandLayer=function(t,e){var i=this.createSvg(this.element.id+"_diagramPorts_svg",t.width,t.height);i.setAttribute("class","e-ports-expand-layer");var r=Ii("g",{id:this.element.id+"_diagramPorts",class:"e-ports-layer",style:"pointer-events: all;"});i.appendChild(r);var o=Ii("g",{id:this.element.id+"_diagramExpander",class:"e-expand-layer",style:"pointer-events: all;"});i.appendChild(o),this.diagramCanvas.appendChild(i),Ni(i,{style:e})},r.prototype.renderHTMLLayer=function(t,e){this.htmlLayer=Oi("div",{id:this.element.id+"_htmlLayer",style:"width:"+t.width+"px; height:"+t.height+"px;position:absolute;top:0px;left:0px;overflow:hidden;pointer-events:none;",class:"e-html-layer"});var i=Oi("div",{id:this.element.id+"_htmlLayer_div",style:"position:absolute;top:0px;left:0px;pointer-events:all;"});this.htmlLayer.appendChild(i),this.diagramCanvas.appendChild(this.htmlLayer)},r.prototype.renderNativeLayer=function(t,e){var i=this.createSvg(this.element.id+"_nativeLayer_svg",t.width,t.height),r=Ii("g",{id:this.element.id+"_nativeLayer",style:"pointer-events:all;"});i.appendChild(r),this.diagramLayerDiv.appendChild(i),Ni(i,{class:"e-native-layer",style:e})},r.prototype.createSvg=function(t,e,i){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");return Ni(r,{id:t,width:e,height:i}),r},r.prototype.initObjects=function(t){this.isLoading||this.initData(),this.initLayerObjects(),this.updateBridging(t)},r.prototype.initLayerObjects=function(){for(var t=this.layers.length>1,e=[],i={},r={},o=[],n=0,a=this.nodes;n<a.length;n++){(y=a[n]).id=y.id||Hi(),this.addToLayer(y,t),i[y.id]=y}for(var s=0,h=this.connectors;s<h.length;s++){(y=h[s]).id=y.id||Hi(),this.addToLayer(y,t),i[y.id]=y}for(var d=0,l=this.layers;d<l.length;d++){for(var c=0,p=(S=l[d]).objects;c<p.length;c++){if(i[y=p[c]])if(i[y]instanceof Wo){if((T=i[y]).sourceID&&T.targetID){var g=i[T.sourceID],u=i[T.targetID];g&&g.wrapper&&u&&u.wrapper?this.initConnectors(i[y],S):e.push(i[y])}else this.initConnectors(i[y],S)}else i[y].children?o.push(y):i[y].shape instanceof xn&&i[y].shape.activity.subProcess.processes&&i[y].shape.activity.subProcess.processes.length>0?r[i[y].id]=y:this.initNodes(i[y],S)}if(this.bpmnModule)for(var f=0,m=this.bpmnModule.textAnnotationConnectors;f<m.length;f++){var y=m[f];this.initConnectors(y,S,!1)}}for(var v=0,b=Object.keys(r);v<b.length;v++){y=b[v];this.initObject(i[y]),this.bpmnModule.updateDocks(i[y],this)}for(var w=0,x=o;w<x.length;w++){y=x[w];var S=this.commandHandler.getObjectLayer(y);this.initNodes(i[y],S)}for(var P=0,C=e;P<C.length;P++){var T=C[P];S=this.commandHandler.getObjectLayer(T.id);this.initConnectors(T,S)}},r.prototype.addToLayer=function(t,e){var i;e&&(i=this.commandHandler.getObjectLayer(t.id)),e&&i||-1===this.activeLayer.objects.indexOf(t.id)&&this.activeLayer.objects.push(t.id),this.setZIndex(i||this.activeLayer,t)},r.prototype.updateLayer=function(t){for(var e=0,i=Object.keys(t.layers);e<i.length;e++){for(var r=i[e],o=0,n=this.layers[r].objects;o<n.length;o++){var a=n[o],s=this.nameTable[a];void 0!==t.layers[r].visible?this.updateElementVisibility(s.wrapper,s,t.layers[r].visible):!0===t.layers[r].lock&&this.unSelect(s)}void 0!==t.layers[r].lock&&(this.layers[r].lock=t.layers[r].lock)}"SVG"!==this.mode&&this.refreshDiagramLayer()},r.prototype.updateScrollSettings=function(e){var i=-this.scroller.horizontalOffset+e.scrollSettings.horizontalOffset||0,r=this.scroller.verticalOffset-e.scrollSettings.verticalOffset||0,o={VerticalOffset:this.scrollSettings.verticalOffset,HorizontalOffset:this.scrollSettings.horizontalOffset,ViewportHeight:this.scrollSettings.viewPortHeight,ViewportWidth:this.scrollSettings.viewPortWidth,CurrentZoom:this.scroller.currentZoom};0===i&&0===r||this.pan(i,r);var n={oldValue:o,newValue:{VerticalOffset:this.scrollSettings.verticalOffset,HorizontalOffset:this.scrollSettings.horizontalOffset,ViewportHeight:this.scrollSettings.viewPortHeight,ViewportWidth:this.scrollSettings.viewPortWidth,CurrentZoom:this.scroller.currentZoom},source:this};this.triggerEvent(t.DiagramEvent.scrollChange,n),"Canvas"===this.mode&&this.constraints&t.DiagramConstraints.Virtualization&&this.refreshDiagramLayer()},r.prototype.initData=function(){!this.dataBindingModule||this.realActions&t.RealAction.PreventDataInit||(this.dataSourceSettings.dataManager&&this.dataSourceSettings.connectionDataSource.dataManager?(this.nodes=this.generateData(this.dataSourceSettings.dataManager,!0),this.connectors=this.generateData(this.dataSourceSettings.connectionDataSource.dataManager,!1)):this.dataSourceSettings.dataManager&&this.dataSourceSettings.dataManager.dataSource&&void 0!==this.dataSourceSettings.dataManager.dataSource.url?this.dataBindingModule.initSource(this.dataSourceSettings,this):this.dataBindingModule.initData(this.dataSourceSettings,this))},r.prototype.generateData=function(t,e){var i,r=[];for(i=0;i<t.length;i++){var o=t[i],n=e?this.makeData(o,!0):this.makeData(o,!1);!n||!n.id||xe(r,n.id)&&xe(r,n.id)||r.push(n)}return r},r.prototype.makeData=function(t,e){var i,r=e?this.dataSourceSettings:this.dataSourceSettings.connectionDataSource,o={};if(o.id=t[r.id]?t[r.id]:Hi(),r.sourceID&&(o.sourceID=t[r.sourceID]),r.targetID&&(o.targetID=t[r.targetID]),t[r.sourcePointX]&&t[r.sourcePointY]&&(o.sourcePoint={x:Number(t[r.sourcePointX]),y:Number(t[r.sourcePointY])}),t[r.targetPointX]&&t[r.targetPointY]&&(o.targetPoint={x:Number(t[r.targetPointX]),y:Number(t[r.targetPointY])}),r.crudAction.customFields&&r.crudAction.customFields.length>0)for(i=0;i<r.crudAction.customFields.length;i++)o[r.crudAction.customFields[i]]=t[r.crudAction.customFields[i]];return o},r.prototype.initNodes=function(t,e){this.preventUpdate=!0,this.initObject(t,e),this.preventUpdate=!1},r.prototype.initConnectors=function(t,e,i){this.preventUpdate=!0,this.initObject(t,e,i),this.updateEdges(t),this.preventUpdate=!1},r.prototype.setZIndex=function(t,e){var i=t;if(-1===e.zIndex){for(;i.zIndexTable[i.objectZIndex+1];)t.objectZIndex++;e.zIndex=++i.objectZIndex}else{var r=e.zIndex;if(i.zIndexTable[r])for(var o=Object.keys(i.zIndexTable).length,n=0;n<o;n++)if(n===r){for(var a=o;a>r;a--)i.zIndexTable[a]=i.zIndexTable[a-1],this.nameTable[i.zIndexTable[a]]&&(this.nameTable[i.zIndexTable[a]].zIndex=a);i.zIndexTable[n]=e.id}}},r.prototype.initializeDiagramLayers=function(){for(var t=0,e=this.layers;t<e.length;t++){var i=e[t];i.zIndex=this.layers.indexOf(i),this.layerZIndexTable[i.zIndex]=i.id}if(0===this.layers.length){this.commandHandler.addLayer({id:"default_layer",visible:!0,lock:!1,objects:[],zIndex:0,objectZIndex:-1,zIndexTable:{}})}this.setActiveLayer(this.layers[this.layers.length-1].id)},r.prototype.resetTool=function(){this.eventHandler.resetTool()},r.prototype.initObjectExtend=function(t,e,i){if(i){if(!this.commandHandler.checkBoundaryConstraints(void 0,void 0,t.wrapper.bounds))for(var r=t instanceof En?this.nodes:this.connectors,o=0;o<=r.length;o++)r[o]&&t.id===r[o].id&&r.splice(o,1);e.zIndexTable[t.zIndex]=t.id}},r.prototype.initObject=function(t,e,i,r){if(void 0===i&&(i=!0),void 0!==t){if(i&&(e||(this.addToLayer(t,!1),e=this.activeLayer),(t instanceof En||t instanceof Wo)&&this.setZIndex(e,t)),t instanceof En){if(i){if("helper"!==t.id){if(o=ir(this.getNodeDefaults)){(n=o(t,this))&&n!==t&&Ui(n,t)}}this.initNode(t,this.element.id)}}else if(t instanceof Wo){var o;if(o=ir(this.getConnectorDefaults)){var n;(n=o(t,this))&&n!==t&&Ui(n,t),t.segments.length&&t.type!==t.segments[0].type&&(t.segments=[])}var a=this.nameTable[t.sourceID],s=this.nameTable[t.targetID];if(void 0!==a&&Et(a)&&(t.sourceWrapper=this.getEndNodeWrapper(a,t,!0),t.sourcePortID&&(t.sourcePortWrapper=this.getWrapper(a.wrapper,t.sourcePortID))),void 0!==s&&Ot(s)&&(t.targetWrapper=this.getEndNodeWrapper(s,t,!1),t.targetPortID&&(t.targetPortWrapper=this.getWrapper(s.wrapper,t.targetPortID))),!i){Qe(t,t.getConnectorPoints(t.type))}i&&t.init(this);for(var h=0;h<t.wrapper.children.length;h++)this.pathTable[t.wrapper.children[h].data]&&(t.wrapper.children[h].absoluteBounds=this.pathTable[t.wrapper.children[h].data].absoluteBounds);t.wrapper.measure(new yr(void 0,void 0)),t.wrapper.arrange(t.wrapper.desiredSize);for(var d=0;d<t.wrapper.children.length;d++)this.pathTable[t.wrapper.children[d].data]={},this.pathTable[t.wrapper.children[d].data].absoluteBounds=t.wrapper.children[d].absoluteBounds}if(t instanceof En&&t.children&&t.container)for(var l=0;l<t.children.length;l++)this.nameTable[t.children[l]].offsetX=this.nameTable[t.children[l]].wrapper.offsetX,this.nameTable[t.children[l]].offsetY=this.nameTable[t.children[l]].wrapper.offsetY;if(this.bpmnModule&&t instanceof En&&"Bpmn"===t.shape.type&&t.shape.annotations.length>0&&this.bpmnModule.updateQuad(t,this),this.initObjectExtend(t,e,i),this.nameTable[t.id]=t,t instanceof En&&t.children){r||t.container||this.updateGroupOffset(t,!0),this.groupTable[t.id]=t.children;for(l=0;l<t.children.length;l++){var c=this.nameTable[t.children[l]];c&&(c.parentId=t.id)}this.isLoading||!t.rotateAngle||t.container||this.commandHandler.rotateObjects(t,[t],t.rotateAngle,{x:t.offsetX,y:t.offsetY},!1)}this.updateQuad(t)}!1===t.visible&&this.updateElementVisibility(t.wrapper,t,!1)},r.prototype.scaleObject=function(e,i,r){var o=r?e.wrapper.actualSize.width:e.wrapper.actualSize.height,n=r?1+(i-o)/o:1,a=r?1:1+(i-o)/o;e.offsetX,e.offsetY;this.realActions|=t.RealAction.PreventDrag,this.scale(e,n,a,{x:.5,y:.5}),this.realActions&=~t.RealAction.PreventDrag},r.prototype.updateDefaultLayoutIcons=function(t){"OrganizationalChart"!==this.layout.type&&"HierarchicalTree"!==this.layout.type&&"ComplexHierarchicalTree"!==this.layout.type||(this.updateDefaultLayoutIcon(t,t.expandIcon),this.updateDefaultLayoutIcon(t,t.collapseIcon))},r.prototype.updateDefaultLayoutIcon=function(t,e){if("None"!==e.shape&&"Auto"===e.horizontalAlignment&&"Auto"===e.verticalAlignment&&.5===e.offset.x&&1===e.offset.y){var i=this.getWrapper(t.wrapper,"icon_content"),r=void 0,o=void 0;"TopToBottom"===this.layout.orientation||"BottomToTop"===this.layout.orientation?(r=.5,o="TopToBottom"===this.layout.orientation?1:0):"RightToLeft"!==this.layout.orientation&&"LeftToRight"!==this.layout.orientation||(r="LeftToRight"===this.layout.orientation?1:0,o=.5),i.setOffsetWithRespectToBounds(r,o,"Fraction"),i.horizontalAlignment="Center",i.verticalAlignment="Center",t.wrapper.measure(new yr(t.wrapper.width,t.wrapper.height)),t.wrapper.arrange(t.wrapper.desiredSize)}},r.prototype.updateGroupOffset=function(e,i){if(e.children&&e.children.length>0&&!e.container||e.processId){var r=this.nameTable[e.id];if(!(this.realActions&t.RealAction.PreventScale||this.realActions&t.RealAction.PreventDrag)){if(!r.offsetX||this.diagramActions&t.DiagramAction.ToolAction||this.diagramActions&t.DiagramAction.PublicMethod)r.offsetX=e.wrapper.offsetX;else{this.realActions|=t.RealAction.PreventScale;var o=r.offsetX-e.wrapper.offsetX;r.offsetX=e.wrapper.offsetX,this.drag(r,o,0),this.realActions&=~t.RealAction.PreventScale}if(!r.offsetY||this.diagramActions&t.DiagramAction.ToolAction)r.offsetY=e.wrapper.offsetY;else{this.realActions|=t.RealAction.PreventScale;var n=r.offsetY-e.wrapper.offsetY;r.offsetY=e.wrapper.offsetY,this.drag(r,0,n),this.realActions&=~t.RealAction.PreventScale}this.diagramActions&&(r.width=e.wrapper.actualSize.width,r.height=e.wrapper.actualSize.height)}}i&&e.children&&e.children.length>0&&(void 0!==this.nameTable[e.id].width?this.scaleObject(e,this.nameTable[e.id].width,!0):this.nameTable[e.id].width=e.wrapper.actualSize.width,void 0!==this.nameTable[e.id].height?this.scaleObject(e,this.nameTable[e.id].height,!1):this.nameTable[e.id].height=e.wrapper.actualSize.height)},r.prototype.initNode=function(t,e,i){var r,o=t.initContainer(),n=new Qr;if(o.children||(o.children=[]),t.children){if(o.measureChildren=!1,t.container&&"Grid"===t.container.type)for(var a=0;a<t.children.length;a++){var s=new Qr,h=this.nameTable[t.children[a]];s.children=[],s.children.push(h.wrapper),h&&o.addObject(h.wrapper,h.rowIndex,h.columnIndex,h.rowSpan,h.columnSpan)}else for(a=0;a<t.children.length;a++)if(this.nameTable[t.children[a]]){h=this.nameTable[t.children[a]];this.updateStackProperty(t,h,a),o.children.push(h.wrapper)}n.id="group_container",n.style.fill="none",n.style.strokeColor="none",n.horizontalAlignment="Stretch",n.verticalAlignment="Stretch",o.style=t.style,n.children=[],n.preventContainer=!0,t.container&&(n.relativeMode="Object"),t.container&&"Grid"===t.container.type||o.children.push(n)}else{var d=ir(this.setNodeTemplate);d&&(r=d(t,this)),r||(r=t.init(this)),o.children.push(r)}var l;l=ir(this.getDescription),(t.children?o:r).description=l||(t.annotations.length?t.annotations[0].content:t.id);var c=t.children?n:o;if(t.initAnnotations(this.getDescription,c,this.element.id,!!Rt(this)),t.initPorts(this.getDescription,c),t.initIcons(this.getDescription,this.layout,c,e),o.measure(new yr(t.width,t.height)),o instanceof Zo?o.arrange(o.desiredSize,!0):o.arrange(o.desiredSize),"SwimLane"===t.shape.type){var p=[],g=void 0,u="Horizontal"===t.shape.orientation;g=u?(t.shape.header?1:0)+(t.shape.phases.length>0?1:0):t.shape.header?1:0;var f=void 0;f=u?0:t.shape.phases.length>0?1:0;var m=t.wrapper.children[0];if(t.shape.lanes.length>0)for(a=0;a<t.shape.lanes.length;a++){for(var y=0;y<t.shape.lanes[a].childNodes.length;y++){var v=t.shape.lanes[a].childNodes[y];v.parentId=m.rows[g].cells[f].children[0].id,this.initObject(v),this.nodes.push(v),p.push(v);var b=v.wrapper;u&&(f=0),u&&b.actualSize.width+b.margin.left>m.rows[g].cells[0].actualSize.width&&(f++,b.margin.left=b.margin.left-m.rows[g].cells[0].actualSize.width),b.measure(new yr(v.width,v.height)),b.arrange(b.desiredSize),m.rows[g].cells[f].children[0].children.push(b)}u?g++:f++}m.measure(new yr(t.width,t.height)),m.arrange(o.desiredSize);for(a=0;a<p.length;a++)p[a].offsetX=p[a].wrapper.offsetX,p[a].offsetY=p[a].wrapper.offsetY}t instanceof En&&t.container&&(t.width<o.outerBounds.width||t.height<o.outerBounds.height)&&o.bounds.x<=o.outerBounds.x&&o.bounds.y<=o.outerBounds.y&&(t.width=o.width=o.outerBounds.width,t.height=o.height=o.outerBounds.height,o.measure(new yr(t.width,t.height)),o.arrange(o.desiredSize)),t.container&&"Grid"===t.container.type&&t.children&&t.children.length>0&&this.updateChildPosition(t)},r.prototype.updateChildPosition=function(t){for(var e=0;e<t.children.length;e++){var i=this.getObject(t.children[e]);i.offsetX=i.wrapper.offsetX,i.offsetY=i.wrapper.offsetY,i.children&&i.children.length>0&&this.updateChildPosition(i)}},r.prototype.canExecute=function(){return!0},r.prototype.updateStackProperty=function(t,e,i){t.container&&"Stack"===t.container.type&&(e.width||(e.wrapper.horizontalAlignment="Stretch",e.horizontalAlignment="Stretch"),e.height||(e.verticalAlignment="Stretch",e.wrapper.verticalAlignment="Stretch"),i&&"UmlClassifier"===t.shape.type&&(e.umlIndex=i))},r.prototype.initViews=function(){this.isLoading||(this.views.push(this.element.id),this.views[this.element.id]=this)},r.prototype.initCommands=function(){var e=this.commandManager.commands,i={copy:{execute:this.copyCommand.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:t.Keys.C,keyModifiers:t.KeyModifiers.Control}},paste:{execute:this.pasteCommand.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:t.Keys.V,keyModifiers:t.KeyModifiers.Control}},cut:{execute:this.cutCommand.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:t.Keys.X,keyModifiers:t.KeyModifiers.Control}},delete:{execute:this.removeCommand.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:t.Keys.Delete}},selectAll:{execute:this.selectAll.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:t.Keys.A,keyModifiers:t.KeyModifiers.Control}},undo:{execute:this.undo.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:t.Keys.Z,keyModifiers:t.KeyModifiers.Control}},redo:{execute:this.redo.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:t.Keys.Y,keyModifiers:t.KeyModifiers.Control}},nudgeUp:{execute:this.nudgeCommand.bind(this,"Up"),canExecute:this.canExecute.bind(this),gesture:{key:t.Keys.Up},parameter:"up"},nudgeRight:{execute:this.nudgeCommand.bind(this,"Right"),canExecute:this.canExecute.bind(this),gesture:{key:t.Keys.Right},parameter:"right"},nudgeDown:{execute:this.nudgeCommand.bind(this,"Down"),canExecute:this.canExecute.bind(this),gesture:{key:t.Keys.Down},parameter:"down"},nudgeLeft:{execute:this.nudgeCommand.bind(this,"Left"),canExecute:this.canExecute.bind(this),gesture:{key:t.Keys.Left},parameter:"left"},startEdit:{execute:this.startEditCommad.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:t.Keys.F2}},endEdit:{execute:this.endEditCommand.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:t.Keys.Escape}},focusToNextItem:{canExecute:this.canExecute.bind(this),gesture:{key:t.Keys.Tab}},focusToPreviousItem:{canExecute:this.canExecute.bind(this),gesture:{key:t.Keys.Tab,keyModifiers:t.KeyModifiers.Control}},selectFocusedItem:{execute:this.startEditCommad.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:t.Keys.Enter}}};this.initCommandManager(e,i)},r.prototype.overrideCommands=function(t,e){for(var i,r=0,o=Object.keys(e);r<o.length;r++){var n=o[r];if(i=e[n],t.gesture.key===i.gesture.key&&t.gesture.keyModifiers===i.gesture.keyModifiers){delete e[n];break}}},r.prototype.initCommandManager=function(t,e){var i=0;if(t)for(i=0;i<t.length;i++)e[t[i].name]&&t[i]?(t[i].canExecute&&(e[t[i].name].canExecute=t[i].canExecute),t[i].execute&&(e[t[i].name].execute=t[i].execute),(t[i].gesture.key||t[i].gesture.keyModifiers)&&(e[t[i].name].gesture=t[i].gesture),""!==t[i].parameter&&(e[t[i].name].parameter=t[i].parameter)):(this.overrideCommands(t[i],e),e[t[i].name]={execute:t[i].execute,canExecute:t[i].canExecute,gesture:t[i].gesture,parameter:t[i].parameter});this.commands=e},r.prototype.updateNodeEdges=function(t){for(var e=0,i=t.inEdges;e<i.length;e++){var r=i[e];this.nameTable[r]&&(this.nameTable[r].targetID="")}for(var o=0,n=t.outEdges;o<n.length;o++){r=n[o];this.nameTable[r]&&(this.nameTable[r].sourceID="")}t.inEdges=[],t.outEdges=[]},r.prototype.updateIconVisibility=function(t,e){for(var i=0;i<t.wrapper.children.length;i++){var r=t.wrapper.children[i],o=r.id.split(t.id)[1];r.id&&o&&o.match("^_icon")&&(r.visible=e,this.updateDiagramContainerVisibility(r,e))}},r.prototype.updateEdges=function(t){if(void 0!==t.sourceID&&""!==t.sourceID){(e=this.nameTable[t.sourceID])&&e.outEdges&&0===e.outEdges.length&&(e.outEdges=[]),e&&e.outEdges&&-1===e.outEdges.indexOf(t.id)&&e.outEdges.push(t.id)}if(void 0!==t.targetID&&""!==t.targetID){var e;if((e=this.nameTable[t.targetID])&&e.inEdges&&0===e.inEdges.length&&(e.inEdges=[]),e&&e.inEdges&&-1===e.inEdges.indexOf(t.id)&&e.inEdges.push(t.id),e&&e.visible&&e.outEdges){var i=0!==e.outEdges.length;this.updateIconVisibility(e,i)}}},r.prototype.refreshDiagram=function(){this.initLayerObjects(),this.doLayout(),this.updateBridging(),this.scroller.setSize()},r.prototype.updateDiagramObject=function(t){for(var e,i=0,r=this.views;i<r.length;i++){var o=r[i];if(e=this.views[o],this.diagramActions)if("SVG"===e.mode){var n=Li(this.element.id),a=document.getElementById(e.element.id+"_diagramLayer");this.diagramRenderer.updateNode(t.wrapper,a,n,void 0)}else this.refreshCanvasDiagramLayer(e)}},r.prototype.updateGridContainer=function(t){for(var e,i=Li(this.element.id),r=0,o=this.views;r<o.length;r++){var n=o[r];if("SVG"===(e=this.views[n]).mode&&this.diagramActions){var a=document.getElementById(e.element.id+"_diagramLayer");this.diagramRenderer.updateNode(t,a,i,void 0)}else this.refreshCanvasDiagramLayer(e)}},r.prototype.getObjectsOfLayer=function(t){for(var e=[],i=0,r=t;i<r.length;i++){var o=r[i];this.nameTable[o]&&e.push(this.nameTable[o])}return e},r.prototype.refreshDiagramLayer=function(){for(var t,e=0,i=this.views;e<i.length;e++){var r=i[e];switch((t=this.views[r]).mode){case"SVG":this.refreshSvgDiagramLayer(t);break;case"Canvas":this.refreshCanvasLayers(t)}}},r.prototype.refreshCanvasLayers=function(t){if(t)this.refreshCanvasDiagramLayer(t);else for(var e=0,i=this.views;e<i.length;e++){var r=i[e],o=this.views[r];this.refreshCanvasDiagramLayer(o)}},r.prototype.renderBasicElement=function(t){for(var e=Li(t.element.id),i=0;i<this.basicElements.length;i++){var r=this.basicElements[i];r instanceof _r&&(r.prevRotateAngle=0),r.measure(new yr(r.width,r.height)),r.arrange(r.desiredSize),t.diagramRenderer.renderElement(r,t.diagramLayer,e)}},r.prototype.refreshElements=function(t){if(!this.isDestroyed){this.clearCanvas(t),t instanceof r&&(t.diagramLayer.getContext("2d").setTransform(t.scroller.currentZoom,0,0,t.scroller.currentZoom,0,0),t.diagramLayer.getContext("2d").scale(1.5,1.5));var e=Li(t.element.id);this.spatialSearch.getPageBounds();this.renderDiagramElements(t.diagramLayer,t.diagramRenderer,e);for(var i=0;i<this.basicElements.length;i++){var o=this.basicElements[i];o.measure(new yr(o.width,o.height)),o.arrange(o.desiredSize),t.diagramRenderer.renderElement(o,t.diagramLayer,e)}t instanceof r&&(t.diagramLayer.style.transform="scale("+2/3+")",t.diagramLayer.style.transformOrigin="0 0"),this.renderTimer=null}},r.prototype.refreshCanvasDiagramLayer=function(e){var i=this;"SVG"===e.mode||this.isDestroyed||(this.basicElements.length>0&&this.renderBasicElement(e),!this.diagramActions||0==(this.diagramActions&t.DiagramAction.Render)||t.DiagramAction.ToolAction&this.diagramActions||Rt(this)||1!==this.scroller.currentZoom?this.refreshElements(e):this.renderTimer||(this.renderTimer=setTimeout(function(){i.refreshElements(e)},40)))},r.prototype.updatePortVisibility=function(e,i,r){var o,n=!this.drawingObject||!this.drawingObject.shape;if(e instanceof En&&n&&St(e)){for(var a=e.ports,s=!1,h=0;h<a.length;h++)o=this.getWrapper(e.wrapper,a[h].id),(i&t.PortVisibility.Hover||i&t.PortVisibility.Connect)&&ei(a[h],i)&&(o.visible=!r,s=!0);s&&this.updateDiagramObject(e)}},r.prototype.refreshSvgDiagramLayer=function(e){var i,r=document.getElementById(e.element.id+"_diagramLayer"),o=Li(e.element.id);if(Rt(this))this.scroller.virtualizeElements();else{for(var n=0;n<this.basicElements.length;n++)(i=this.basicElements[n]).measure(new yr(i.width,i.height)),i.arrange(i.desiredSize,!(this.diagramActions&t.DiagramAction.Render)),this.diagramRenderer.renderElement(i,r,o);this.renderDiagramElements(r,this.diagramRenderer,o)}},r.prototype.removeVirtualObjects=function(t){if(this.deleteVirtualObject){for(var e=0;e<this.scroller.removeCollection.length;e++){var i=this.nameTable[this.scroller.removeCollection[e]];this.removeElements(i)}this.deleteVirtualObject=!1}clearInterval(t)},r.prototype.updateTextElementValue=function(t){for(var e=0;e<t.wrapper.children.length;e++){var i=t.wrapper.children[e];i instanceof Gr&&(i.canMeasure=!0,i.measure(new yr(t.width,t.height)),i.arrange(i.desiredSize))}},r.prototype.updateVirtualObjects=function(t,e,i){var r=document.getElementById("diagram_diagramLayer"),o=Li("diagram");if("SVG"===this.mode){for(var n=0;n<t.length;n++){var a=this.scroller.removeCollection.indexOf(t[n]);a>=0&&this.scroller.removeCollection.splice(a,1);var s=this.nameTable[t[n]];this.updateTextElementValue(s),this.diagramRenderer.renderElement(s.wrapper,r,o,void 0,void 0,void 0,void 0,s.zIndex)}for(var h=0;h<i.length;h++)this.scroller.removeCollection.push(i[h]);1!==this.scroller.currentZoom&&this.eventHandler.updateVirtualization()}else this.diagramActions&&this.refreshDiagramLayer()},r.prototype.renderDiagramElements=function(e,i,r,o,n){void 0===o&&(o=!0);var a=this.scroller.getPageBounds();a.x*=this.scroller.currentZoom,a.y*=this.scroller.currentZoom,a.width*=this.scroller.currentZoom,a.height*=this.scroller.currentZoom;for(var s=-this.scroller.horizontalOffset-a.x,h=-this.scroller.verticalOffset-a.y,d=0,l=Object.keys(this.layerZIndexTable);d<l.length;d++){var c=l[d],p=this.commandHandler.getLayer(this.layerZIndexTable[c]),g=void 0,u=void 0;"Canvas"===this.mode&&Rt(this)&&!this.diagramActions&&this.scroller.virtualizeElements();for(var f="Canvas"===this.mode&&Rt(this)&&this.scroller.oldCollectionObjects.length>0?this.scroller.oldCollectionObjects:void 0,m=0,y=Object.keys(f||p.zIndexTable);m<y.length;m++){var v=y[m],b=f?this.nameTable[f[v]]:this.nameTable[p.zIndexTable[v]];if(!b.parentId&&!b.processId){var w={tx:this.scroller.transform.tx,ty:this.scroller.transform.ty,scale:this.scroller.transform.scale};if(Rt(this)){if(this.scroller.currentZoom<1){if(a.x<0||this.scroller.horizontalOffset<0){var x=this.scroller.verticalOffset<0?this.scroller.verticalOffset:0;g=(s>0?s:0)+"px",u=(this.realActions&t.RealAction.vScrollbarMoved?0:-x)+"px"}else g="0px",u="0px";this.realActions&t.RealAction.hScrollbarMoved&&(this.realActions=this.realActions&~t.RealAction.hScrollbarMoved),this.realActions&t.RealAction.vScrollbarMoved&&(this.realActions=this.realActions&~t.RealAction.vScrollbarMoved)}else g=(a.x<0?s:-this.scroller.horizontalOffset)+"px",u=(a.y<0?h:-this.scroller.verticalOffset)+"px";this.diagramLayer.style.left=g,this.diagramLayer.style.top=u,w.tx=this.scroller.horizontalOffset/w.scale,w.ty=this.scroller.verticalOffset/w.scale}var S=!0;n&&(S=!1),this.updateTextElementValue(b),i.renderElement(b.wrapper,e,r,!i.isSvgMode&&o?w:void 0,void 0,void 0,S&&!this.diagramActions)}}}},r.prototype.updateBridging=function(t){if(this.bridgingModule)for(var e=0;e<this.connectors.length;e++){var i=this.connectors[e];this.bridgingModule.updateBridging(i,this);var r=this.connectors[e].wrapper;if(r){var o=r.children[0],n=o.data;i.getSegmentElement(i,o),o.data!==n&&(r.measure(new yr),r.arrange(r.desiredSize),"SVG"!==this.mode||t||this.updateDiagramObject(i))}}},r.prototype.setCursor=function(t){this.diagramRenderer.setCursor(this.diagramCanvas,t)},r.prototype.clearCanvas=function(t){var e,i;if(e=t.contentWidth||t.diagramLayer.width/this.scroller.currentZoom,i=t.contentHeight||t.diagramLayer.height/this.scroller.currentZoom,"SVG"!==t.mode){Xn.getContext(t.diagramLayer).clearRect(0,0,e,i)}},r.prototype.updateScrollOffset=function(){this.scroller.setScrollOffset(this.diagramCanvas.scrollLeft,this.diagramCanvas.scrollTop),ue(this),Rt(this)&&this.scroller.virtualizeElements()},r.prototype.setOffset=function(t,e){var i=document.getElementById(this.element.id+"content");i&&(i.scrollLeft=t,i.scrollTop=e)},r.prototype.setSize=function(e,i){if(this.diagramLayer&&!this.preventUpdate){var r=me(this);e-=r.width,i-=r.height;var o=this.spatialSearch.getPageBounds();o.x*=this.scroller.currentZoom,o.y*=this.scroller.currentZoom,o.width*=this.scroller.currentZoom,o.height*=this.scroller.currentZoom;var n="SVG"===this.mode?1:1.5,a="SVG"===this.mode?bi(this.element.id):this.diagramLayer,s="Canvas"===this.mode&&this.constraints&t.DiagramConstraints.Virtualization?this.scroller.viewPortWidth:e,h="Canvas"===this.mode&&this.constraints&t.DiagramConstraints.Virtualization?this.scroller.viewPortHeight:i;a.setAttribute("width",(n*s).toString()),a.setAttribute("height",(n*h).toString());var d={width:e.toString(),height:i.toString()};this.diagramLayerDiv.style.width=e+"px",this.diagramLayerDiv.style.height=i+"px",Ni(Ci(this.element.id),d),Ni(function(t){return wi(t).getElementsByClassName("e-ports-expand-layer")[0]}(this.element.id),d);var l=xi(this.element.id);Ni(l,d),l.parentNode.style.width=e+"px",l.parentNode.style.height=i+"px";var c=Ti(this.element.id);Ni(c,d),this.diagramRenderer.updateGrid(this.snapSettings,c,this.scroller.transform,this.rulerSettings,this.hRuler,this.vRuler),Ni(Ai(this.element.id),d),this.htmlLayer.style.width=e+"px",this.htmlLayer.style.height=i+"px","SVG"===this.mode||Rt(this)||this.refreshDiagramLayer(),"SVG"===this.mode&&Rt(this)&&this.scroller.virtualizeElements()}},r.prototype.transformLayers=function(){var t=this.spatialSearch.getPageBounds();t.x*=this.scroller.currentZoom,t.y*=this.scroller.currentZoom,t.width*=this.scroller.currentZoom,t.height*=this.scroller.currentZoom,this.diagramRenderer.updateGrid(this.snapSettings,Ti(this.element.id),this.scroller.transform,this.rulerSettings,this.hRuler,this.vRuler),this.diagramRenderer.transformLayers(this.scroller.transform,"SVG"===this.mode),this.updateSelector(),this.renderPageBreaks(t)},r.prototype.removePageBreaks=function(){if(this.diagramLayer){var t=Mi(this.element.id);if(t&&t.childNodes)for(var e=t.childNodes.length,i=0;i<e;i++)t.removeChild(t.childNodes[0])}},r.prototype.renderPageBreaks=function(t){this.removePageBreaks();var e=Mi(this.element.id);if(e){var i=0;t=this.scroller.getPageBounds(!0);var r=(this.scroller.transform.tx+t.x)*this.scroller.currentZoom,o=(this.scroller.transform.ty+t.y)*this.scroller.currentZoom,n=t.height*this.scroller.currentZoom,a=t.width*this.scroller.currentZoom;Vn.renderSvgBackGroundImage(this.pageSettings.background,this.element,r,o,a,n);var s={id:e.id+"rect",x:r,y:o,height:n,width:a,angle:0,stroke:"",strokeWidth:1,fill:this.pageSettings.background.color,opacity:1,pivotX:0,pivotY:0,visible:!0,dashArray:"0"};if(this.diagramRenderer.drawRect(e,s),this.pageSettings.showPageBreaks){var h=this.scroller.getPageBreak(t);for(i=0;i<h.length;i++)this.diagramRenderer.drawLine(e,{class:"e-diagram-page-break",fill:"none",stroke:"#aaaaaa",strokeWidth:1,dashArray:"10 10",opacity:2,x:0,y:0,width:0,height:0,angle:0,pivotX:0,pivotY:0,visible:!0,startPoint:{x:(h[i].x1+this.scroller.transform.tx)*this.scroller.currentZoom,y:(h[i].y1+this.scroller.transform.ty)*this.scroller.currentZoom},endPoint:{x:(h[i].x2+this.scroller.transform.tx)*this.scroller.currentZoom,y:(h[i].y2+this.scroller.transform.ty)*this.scroller.currentZoom},id:h[i].y1===h[i].y2?"HorizontalLines":"VerticalLines"})}}},r.prototype.validatePageSize=function(){var t=0;"Portrait"===this.pageSettings.orientation?this.pageSettings.width>this.pageSettings.height&&(t=this.pageSettings.height,this.pageSettings.height=this.pageSettings.width,this.pageSettings.width=t):this.pageSettings.height>this.pageSettings.width&&(t=this.pageSettings.width,this.pageSettings.width=this.pageSettings.height,this.pageSettings.height=t)},r.prototype.setOverview=function(t,e){if(t)t&&(this.views.push(t.id),this.views[t.id]=t,t.renderDocument(t),t.diagramRenderer.setLayers(),t.updateView(t),this.renderNodes(t));else{for(var i=0;i<this.views.length;i++)this.views[i]===e&&(t=this.views[e]);this.views[e]=void 0;var r=this.views.indexOf(e);this.views.splice(r,1)}},r.prototype.renderNodes=function(t){if(t){var e=new Vn(t.id,new Yn,!1),i=document.getElementById(t.element.id+"_diagramLayer"),r=Li(t.element.id);this.renderDiagramElements(i,t.diagramRenderer||e,r)}},r.prototype.updateThumbConstraints=function(e,i){for(var r=e.length,o=0;o<r;o++){var n=e[o],a=!1,s=!1,h=i.thumbsConstraints;n instanceof En?(a="Bpmn"===n.shape.type&&"Activity"===n.shape.shape&&!1===n.shape.activity.subProcess.collapsed||"TextAnnotation"===n.shape.shape,s="Bpmn"===n.shape.type&&"TextAnnotation"===n.shape.shape,Mt(n)&&h&t.ThumbsConstraints.Rotate&&!a||(h&=~t.ThumbsConstraints.Rotate),Dt(n,"SouthEast")&&h&t.ThumbsConstraints.ResizeSouthEast&&!s||(h&=~t.ThumbsConstraints.ResizeSouthEast),Dt(n,"NorthWest")&&h&t.ThumbsConstraints.ResizeNorthWest&&!s||(h&=~t.ThumbsConstraints.ResizeNorthWest),Dt(n,"East")&&h&t.ThumbsConstraints.ResizeEast&&!s||(h&=~t.ThumbsConstraints.ResizeEast),Dt(n,"West")&&h&t.ThumbsConstraints.ResizeWest&&!s||(h&=~t.ThumbsConstraints.ResizeWest),Dt(n,"North")&&h&t.ThumbsConstraints.ResizeNorth&&!s||(h&=~t.ThumbsConstraints.ResizeNorth),Dt(n,"South")&&h&t.ThumbsConstraints.ResizeSouth&&!s||(h&=~t.ThumbsConstraints.ResizeSouth),Dt(n,"NorthEast")&&h&t.ThumbsConstraints.ResizeNorthEast&&!s||(h&=~t.ThumbsConstraints.ResizeNorthEast),Dt(n,"SouthWest")&&h&t.ThumbsConstraints.ResizeSouthWest&&!s||(h&=~t.ThumbsConstraints.ResizeSouthWest)):n instanceof Wo?(h|=t.ThumbsConstraints.Default,Ct(n)?h|=t.ThumbsConstraints.ConnectorSource:h&=~t.ThumbsConstraints.ConnectorSource,Tt(n)?h|=t.ThumbsConstraints.ConnectorTarget:h&=~t.ThumbsConstraints.ConnectorTarget):(h|=t.ThumbsConstraints.Default,Dt(n)||(h&=~(t.ThumbsConstraints.ResizeSouthEast|t.ThumbsConstraints.ResizeSouthWest|t.ThumbsConstraints.ResizeSouth|t.ThumbsConstraints.ResizeEast|t.ThumbsConstraints.ResizeWest|t.ThumbsConstraints.ResizeNorth|t.ThumbsConstraints.ResizeNorthEast|t.ThumbsConstraints.ResizeNorthWest)),Mt(n)||(h&=~t.ThumbsConstraints.Rotate)),i.thumbsConstraints=h}},r.prototype.renderSelector=function(e){var i=new yr,r=this.selectedItems;r.constraints;if(this.clearSelectorLayer(),this.commandHandler.hasSelection()){if(1===r.nodes.length&&0===r.connectors.length&&(r.rotateAngle=r.nodes[0].rotateAngle,r.pivot=r.nodes[0].pivot),r.wrapper.measure(i),r.wrapper.arrange(r.wrapper.desiredSize),r.width=r.wrapper.actualSize.width,r.height=r.wrapper.actualSize.height,r.offsetX=r.wrapper.offsetX,r.offsetY=r.wrapper.offsetY,0!==r.rotateAngle){for(var o=0,n=r.nodes;o<n.length;o++){var a=n[o];a.offsetX=a.wrapper.offsetX,a.offsetY=a.wrapper.offsetY}for(var s=0,h=r.connectors;s<h.length;s++)h[s]}this.spatialSearch.getPageBounds();var d=void 0;if(d=Si(this.element.id),r.thumbsConstraints=t.ThumbsConstraints.Default,r.annotation?this.updateThumbConstraints([r.annotation],r):(this.updateThumbConstraints(r.nodes,r),this.updateThumbConstraints(r.connectors,r)),r.annotation)this.renderSelectorForAnnotation(r,d);else if(r.nodes.length+r.connectors.length===1){if(r.nodes[0]instanceof En){if($t(this,r.nodes[0])){var l=r.nodes[0];"UmlClassifier"===l.shape.type||l.parentId||this.nameTable[l.parentId]&&"UmlClassifier"===this.nameTable[l.parentId].shape.type||(r.nodes[0].constraints&=~(t.NodeConstraints.Rotate|t.NodeConstraints.HideThumbs),r.thumbsConstraints&=~t.ThumbsConstraints.Rotate)}this.diagramRenderer.renderResizeHandle(r.wrapper.children[0],d,r.thumbsConstraints,this.scroller.currentZoom,r.constraints,this.scroller.transform,void 0,St(r.nodes[0]),!!(r.nodes[0].constraints&t.NodeConstraints.HideThumbs))}else if(r.connectors[0]instanceof Wo){var c=r.connectors[0];this.diagramRenderer.renderEndPointHandle(c,d,r.thumbsConstraints,r.constraints,this.scroller.transform,void 0!==c.sourceWrapper,void 0!==c.targetWrapper,!(!this.connectorEditingToolModule||!At(c)))}}else this.diagramRenderer.renderResizeHandle(r.wrapper,d,r.thumbsConstraints,this.scroller.currentZoom,r.constraints,this.scroller.transform,void 0,St(r));r.annotation||this.diagramRenderer.renderUserHandler(r,d,this.scroller.transform)}},r.prototype.updateSelector=function(){var e=new yr,i=this.selectedItems,r=i.constraints;if(this.diagramActions&t.DiagramAction.ToolAction||1!==this.selectedItems.nodes.length||(this.selectedItems.rotateAngle=this.selectedItems.nodes[0].rotateAngle,this.selectedItems.wrapper.rotateAngle=this.selectedItems.nodes[0].rotateAngle),void 0!==this.selectedItems&&(this.clearSelectorLayer(),null!==i.wrapper&&i.wrapper.children&&i.wrapper.children.length)){if(i.wrapper.measure(e),i.wrapper.arrange(i.wrapper.desiredSize),0!==i.rotateAngle||i.rotateAngle!==i.wrapper.prevRotateAngle)for(var o=0,n=i.nodes;o<n.length;o++){var a=n[o];a.offsetX=a.wrapper.offsetX,a.offsetY=a.wrapper.offsetY}i.width=i.wrapper.actualSize.width,i.height=i.wrapper.actualSize.height,i.offsetX=i.wrapper.offsetX,i.offsetY=i.wrapper.offsetY;var s=void 0;s=Si(this.element.id);var h=this.eventHandler.canHideResizers();if(i.thumbsConstraints=t.ThumbsConstraints.Default,i.annotation?this.updateThumbConstraints([i.annotation],i):(this.updateThumbConstraints(i.nodes,i),this.updateThumbConstraints(i.connectors,i)),this.selectedItems.constraints&t.SelectorConstraints.UserHandle&&!i.annotation&&this.diagramRenderer.renderUserHandler(i,s,this.scroller.transform),i.annotation)this.renderSelectorForAnnotation(i,s);else if(i.nodes.length+i.connectors.length===1){if(i.connectors[0]instanceof Wo){var d=i.connectors[0];this.diagramRenderer.renderEndPointHandle(d,s,i.thumbsConstraints,r,this.scroller.transform,void 0!==d.sourceWrapper,void 0!==d.targetWrapper,!(!this.connectorEditingToolModule||!At(d)))}else if(i.nodes[0]instanceof En){if($t(this,i.nodes[0])){var l=i.nodes[0];"UmlClassifier"===l.shape.type||l.parentId&&this.nameTable[l.parentId]&&"UmlClassifier"===this.nameTable[l.parentId].shape.type||(i.nodes[0].constraints&=~(t.NodeConstraints.HideThumbs|t.NodeConstraints.Rotate),i.thumbsConstraints&=~t.ThumbsConstraints.Rotate)}this.diagramRenderer.renderResizeHandle(i.wrapper.children[0],s,i.thumbsConstraints,this.scroller.currentZoom,i.constraints,this.scroller.transform,h,St(i.nodes[0]),!!(i.nodes[0].constraints&t.NodeConstraints.HideThumbs))}}else this.diagramRenderer.renderResizeHandle(i.wrapper,s,i.thumbsConstraints,this.scroller.currentZoom,i.constraints,this.scroller.transform,h,St(i))}},r.prototype.renderSelectorForAnnotation=function(t,e){this.diagramRenderer.renderResizeHandle(t.wrapper.children[0],e,t.thumbsConstraints,this.scroller.currentZoom,t.constraints,this.scroller.transform,void 0,St(t.annotation))},r.prototype.drawSelectionRectangle=function(t,e,i,r){this.clearSelectorLayer(),this.diagramRenderer.drawSelectionRectangle(t,e,i,r,this.adornerLayer,this.scroller.transform)},r.prototype.renderHighlighter=function(t){var e=xi(this.element.id);this.diagramRenderer.renderHighlighter(t,e,this.scroller.transform)},r.prototype.clearHighlighter=function(){var t=xi(this.element.id),e=t.getElementById(t.id+"_highlighter");e&&e.parentNode.removeChild(e)},r.prototype.getNodesConnectors=function(t){for(var e=0;e<this.nodes.length;e++){var i=this.nodes[e];t.push(i)}for(e=0;e<this.connectors.length;e++){var r=this.connectors[e];t.push(r)}return t},r.prototype.clearSelectorLayer=function(){var t=xi(this.element.id),e=(t.getElementById(t.id+"_highlighter"),t.getElementById(this.adornerLayer.id+"_selected_region"));e&&e.parentNode.removeChild(e),this.clearHighlighter();for(var i,r=Si(this.element.id).childNodes,o=r.length;o>0;o--)(i=r[o-1]).parentNode.removeChild(i)},r.prototype.getWrapper=function(t,e){var i;e=t.id+"_"+e;for(var r=t instanceof Qr?t:this.getPortContainer(this.nameTable[t.id]),o=0;o<r.children.length;o++)e===r.children[o].id&&(i=r.children[o]);return i},r.prototype.getEndNodeWrapper=function(t,e,i){if("Bpmn"===t.shape.type&&t.wrapper.children[0]instanceof Qr){if("Activity"===t.shape.shape){if(i&&"Transaction"===t.shape.activity.subProcess.type&&e.sourcePortID){var r=e.sourcePortID,o=t.wrapper.children[0].children[0].children[2];if(o.children)for(var n=0,a=o.children;n<a.length;n++){var s=a[n];if(s.visible&&s.id===t.id+"_"+r)return s.children[0]}}return t.wrapper.children[0].children[0].children[0]}return t.wrapper.children[0].children[0]}return this.containsMargin(t.wrapper.children[0])||t.children?t.wrapper:t.wrapper.children[0]},r.prototype.containsMargin=function(t){return t.margin&&(0!==t.margin.left||0!==t.margin.top||0!==t.margin.right||0!==t.margin.bottom)},r.prototype.focusOutEdit=function(){this.endEdit()},r.prototype.endEditCommand=function(){this.endEdit()},r.prototype.endEdit=function(){if(this.diagramActions&t.DiagramAction.TextEdit){var i=document.getElementById(this.element.id+"_editBox"),r=i.value;e.EventHandler.remove(i,"input",this.eventHandler.inputChange),e.EventHandler.remove(i,"focusout",this.focusOutEdit);var o=document.getElementById(this.element.id+"_editTextBoxDiv"),n={oldValue:o.textContent,newValue:r,cancel:!1},a=!1,s=void 0;o.parentNode.removeChild(o);var h=void 0;if(this.bpmnModule&&(s=this.bpmnModule.isBpmnTextAnnotation(this.activeLabel,this),h=this.bpmnModule.getTextAnnotationWrapper(s,this.activeLabel.id),(a=!!s)&&o.textContent!==r&&(this.triggerEvent(t.DiagramEvent.textEdit,n),n.cancel||this.bpmnModule.updateTextAnnotationContent(s,this.activeLabel,r,this))),!a){s=this.nameTable[this.activeLabel.parentId];var d=this.eventHandler.isAddTextNode(s,!0);d||o.textContent===r||this.triggerEvent(t.DiagramEvent.textEdit,n),h||(h=this.getWrapper(s.wrapper,this.activeLabel.id));var l=ii(s,this.activeLabel.id);if(l.content===r||n.cancel||(s.parentId&&"UmlClassifier"===this.nameTable[s.parentId].shape.type&&-1===r.indexOf(" + ")&&s.id.indexOf("")&&(r=" + "+r),l.content=r,this.dataBind(),this.updateSelector()),d&&(this.removeObjectsFromLayer(s),this.removeFromAQuad(s),delete this.nameTable[this.activeLabel.parentId],""!==r)){this.clearSelection();var c=Xi(s);s=this.add(c),this.updateDiagramObject(s),this.commandHandler.select(this.nameTable[s.id])}}h.visible=!0,this.updateDiagramObject(s),this.diagramActions=this.diagramActions&~t.DiagramAction.TextEdit,this.activeLabel.isGroup&&this.endGroupAction(),this.activeLabel={id:"",parentId:"",isGroup:!1}}},r.prototype.canLogChange=function(){return!(!(this.diagramActions&t.DiagramAction.Render)||this.diagramActions&t.DiagramAction.ToolAction||this.diagramActions&t.DiagramAction.UndoRedo||this.diagramActions&t.DiagramAction.PublicMethod)},r.prototype.modelChanged=function(t,e){return!!(t.connectors||e.connectors||t.nodes||e.connectors||t.pageSettings||e.pageSettings||t.bridgeDirection||e.bridgeDirection)},r.prototype.resetDiagramActions=function(e){var i=!!e;this.diagramActions&t.DiagramAction.UndoRedo&&(!i||e===t.DiagramAction.UndoRedo)&&(this.diagramActions=this.diagramActions&~t.DiagramAction.UndoRedo),this.diagramActions&t.DiagramAction.PublicMethod&&(!i||e===t.DiagramAction.PublicMethod)&&(this.diagramActions=this.diagramActions&~t.DiagramAction.PublicMethod)},r.prototype.removeNode=function(t){this.removeObjectsFromLayer(t),this.removeFromAQuad(this.nameTable[t.id]),delete this.nameTable[t.id],t.children&&delete this.groupTable[t.id],this.nodes.splice(this.nodes.indexOf(t),1)},r.prototype.deleteGroup=function(t){var e=[];t.children&&(e=this.commandHandler.getChildren(t,[]));for(var i=0,r=e;i<r.length;i++){var o=r[i];this.nameTable[o.id]&&this.remove(o)}},r.prototype.updateObject=function(e,i,r){if(!(this.diagramActions&t.DiagramAction.ToolAction)){var o=e.wrapper.children[0].bounds;if(!this.commandHandler.checkBoundaryConstraints(void 0,void 0,o))if(e instanceof En){for(var n=i,a=0,s=Object.keys(r);a<s.length;a++){switch(l=s[a]){case"width":e.width=n.width;break;case"height":e.height=n.height;break;case"offsetX":e.offsetX=n.offsetX;break;case"offsetY":e.offsetY=n.offsetY;break;case"rotateAngle":e.rotateAngle=n.rotateAngle}}this.nodePropertyChange(e,r,i)}else{for(var h=0,d=Object.keys(r);h<d.length;h++){var l=d[h],c=i,p=e.sourcePoint,g=e.targetPoint;switch(l){case"sourcePoint":p.x=c.sourcePoint.x||p.x,p.y=c.sourcePoint.y||p.y;break;case"targetPoint":g.x=c.targetPoint.x||g.x,g.y=c.targetPoint.y||g.y}}this.connectorPropertyChange(e,r,i)}}},r.prototype.nodePropertyChangeExtend=function(e,i,r,o){return void 0!==r.style&&"Bpmn"!==e.shape.type&&(Xe(r.style,e.wrapper.children[0]),o=!0),void 0!==r.constraints&&(i.constraints&t.NodeConstraints.Select&&!(r.constraints&t.NodeConstraints.Select)&&hr(this,e)?this.clearSelection():(this.updateThumbConstraints(this.selectedItems.nodes,this.selectedItems),this.updateSelector(),o=!0)),o},r.prototype.nodePropertyChange=function(e,i,r,o,n){var a,s=e.wrapper.outerBounds,h=e.wrapper.bounds,d=!1;if(void 0!==r.width&&(e.children?e.container?e.wrapper.width=r.width:this.scaleObject(e,r.width,!0):(e.wrapper.children[0].width=r.width,a=!0,d=!0)),void 0!==r.height&&(e.children?e.container?e.wrapper.height=r.height:this.scaleObject(e,r.height,!1):(e.wrapper.children[0].height=r.height,a=!0,d=!0)),a=this.nodePropertyChangeExtend(e,i,r,a),void 0!==r.constraints&&Lt(i)!==Lt(r)&&(e.wrapper.children[0].shadow=Lt(e)?e.shadow:null),void 0!==r.offsetX&&(e.wrapper.offsetX=r.offsetX,a=!0,d=!0),void 0!==r.offsetY&&(e.wrapper.offsetY=r.offsetY,a=!0,d=!0),void 0!==r.pivot&&(e.wrapper.pivot=r.pivot,a=!0),void 0!==r.minWidth&&(e.wrapper.minWidth=r.minWidth,a=!0,d=!0),void 0!==r.minHeight&&(e.wrapper.minHeight=r.minHeight,a=!0,d=!0),void 0!==r.maxWidth&&(e.wrapper.maxWidth=r.maxWidth,a=!0,d=!0),void 0!==r.maxHeight&&(e.wrapper.maxHeight=r.maxHeight,a=!0,d=!0),void 0!==r.rotateAngle&&(e.children&&n&&this.commandHandler.rotateObjects(e,[e],e.rotateAngle-e.wrapper.rotateAngle,{x:e.offsetX,y:e.offsetY},!1),e.wrapper.rotateAngle=r.rotateAngle,a=!0,d=!0),void 0!==r.backgroundColor&&(e.wrapper.style.fill=r.backgroundColor),void 0!==r.visible&&this.updateElementVisibility(e.wrapper,e,e.visible),void 0!==r.shape&&"Bpmn"!==e.shape.type&&(a=!0,Ue(r,e,i,this),d=!0),r.margin&&(a=!0,this.updateMargin(e,r),d=!0),(void 0!==r.shape&&void 0===r.shape.type||void 0!==r.width||void 0!==r.height||void 0!==r.style)&&"Bpmn"===e.shape.type&&this.bpmnModule&&(a=!0,d=!0,this.bpmnModule.updateBPMN(r,i,e,this)),"UmlActivity"===e.shape.type&&"FinalNode"===e.shape.shape&&(a=!0,d=!0,this.updateUMLActivity(r,i,e,this)),void 0!==r.ports)for(var l=0,c=Object.keys(r.ports);l<c.length;l++){var p=c[l],g=Number(p);a=!0;var u=r.ports[p],f=e.ports[g];this.updatePort(u,f,e.wrapper)}if(void 0!==r.annotations||void 0!==r.width)for(var m=0,y=Object.keys(r.annotations||e.annotations);m<y.length;m++){p=y[m],g=Number(p);a=!0;u=r.annotations?r.annotations[p]:e.annotations;var v=e.annotations[g];if(v){var b=!!e.width;this.updateAnnotation(u,v,e.wrapper,e,b)}}if(void 0===r.expandIcon&&void 0===r.collapseIcon&&void 0===r.isExpanded||(this.updateIcon(e),this.updateDefaultLayoutIcons(e),void 0!==r.isExpanded&&this.commandHandler.expandNode(e,this),a=!0),void 0!==r.tooltip&&this.updateTooltip(e,r),a){void 0!==this.bpmnModule&&this.bpmnModule.updateTextAnnotationProp(e,{offsetX:i.offsetX||e.offsetX,offsetY:i.offsetY||e.offsetY},this),e.wrapper.measure(new yr(e.wrapper.bounds.width,e.wrapper.bounds.height)),e.wrapper.arrange(e.wrapper.desiredSize),this.updateObject(e,i,r),this.diagramActions&t.DiagramAction.ToolAction&&!(this.diagramActions&t.DiagramAction.UndoRedo)||this.checkSelectedItem(e)&&this.updateSelector(),o?e&&e.visible&&e.outEdges&&this.updateIconVisibility(e,0!==e.outEdges.length):(this.commandHandler.connectorSegmentChange(e,h,void 0!==r.rotateAngle),d&&this.updateConnectorEdges(e)),void 0!==this.bpmnModule&&this.bpmnModule.updateDocks(e,this),this.updateGroupOffset(e),!1===s.equals(s,e.wrapper.outerBounds)&&this.updateQuad(e);var w=[];if(0===(w=w.concat(this.selectedItems.nodes,this.selectedItems.connectors)).length&&e.parentId&&this.nameTable[e.parentId]){var x=this.nameTable[e.parentId];x.wrapper.measure(new yr(x.wrapper.width,e.wrapper.height)),x.wrapper.arrange(x.wrapper.desiredSize),x.offsetX=x.wrapper.offsetX,x.offsetY=x.wrapper.offsetY}!1===h.equals(h,e.wrapper.bounds)&&(this.updateGroupSize(e),e.children&&this.updateGroupOffset(e)),this.preventNodesUpdate||this.updateDiagramObject(e),"New"!==e.status&&this.diagramActions&&(e.status="Update")}},r.prototype.updateUMLActivity=function(t,e,i,r){if(void 0!==t.width||void 0!==t.height){var o=i.wrapper.children[0].children[0];o.width=t.width,o.height=t.height;var n=i.wrapper.children[0].children[1];n.width=t.width/1.5,n.height=t.height/1.5}},r.prototype.updateConnectorProperties=function(t){if(this.preventConnectorsUpdate){-1===this.selectionConnectorsList.indexOf(t)&&this.selectionConnectorsList.push(t)}else{var e={sourcePoint:t.sourcePoint,targetPoint:t.targetPoint,sourceID:t.sourceID,targetID:t.targetID,sourcePortID:t.sourcePortID,targetPortID:t.targetPortID};this.connectorPropertyChange(t,{},e)}},r.prototype.updateConnectorEdges=function(t){if(t.inEdges.length>0)for(var e=0;e<t.inEdges.length;e++)this.updateConnectorProperties(this.nameTable[t.inEdges[e]]);if(t.outEdges.length>0)for(var i=0;i<t.outEdges.length;i++)this.updateConnectorProperties(this.nameTable[t.outEdges[i]]);t.parentId&&this.nameTable[t.parentId]&&this.updateConnectorEdges(this.nameTable[t.parentId])},r.prototype.connectorProprtyChangeExtend=function(t,e,i,r){return void 0!==i.type&&i.type!==e.type&&t.segments.length>0&&void 0===i.segments&&(t.segments=[]),void 0!==i.shape&&void 0!==t.shape&&t.shape&&"Bpmn"===t.shape.type&&this.bpmnModule&&this.bpmnModule.updateBPMNConnector(t,e,i,this),void 0!==t.constraints?(this.updateThumbConstraints(this.selectedItems.connectors,this.selectedItems),r=!0):r},r.prototype.connectorPropertyChange=function(e,i,r,o){var n=e.wrapper.bounds,a=!1,s=[];a=this.connectorProprtyChangeExtend(e,i,r,a);var h,d;if(void 0!==r.visible&&this.updateElementVisibility(e.wrapper,e,e.visible),void 0!==r.sourcePoint||void 0!==r.targetPoint||void 0!==r.sourceID||void 0!==r.targetID||void 0!==r.sourcePortID||void 0!==r.targetPortID||void 0!==r.type||void 0!==r.segments){if(void 0!==r.sourceID&&r.sourceID!==i.sourceID||r.sourcePortID){var l=this.nameTable[e.sourceID];if(d=this.findInOutConnectPorts(l,!1),(!l||Et(l)||zt(d))&&(e.sourceWrapper=l?this.getEndNodeWrapper(l,e,!0):void 0),void 0!==r.sourceID&&void 0!==i.sourceID&&""!==i.sourceID){var c=this.nameTable[i.sourceID];void 0!==c&&c.outEdges&&-1!==c.outEdges.indexOf(e.id)&&Ke(c.outEdges,e.id)}this.updateEdges(e)}if(void 0!==r.targetID&&r.targetID!==i.targetID){var p=this.nameTable[r.targetID];if(h=this.findInOutConnectPorts(p,!0),(!p||Ot(p)||It(h))&&(e.targetWrapper=p?this.getEndNodeWrapper(p,e,!1):void 0),void 0!==i&&void 0!==i.targetID&&""!==i.targetID){var g=this.nameTable[i.targetID];void 0!==g&&g.inEdges&&-1!==g.inEdges.indexOf(e.id)&&Ke(g.inEdges,e.id)}this.updateEdges(e)}if(void 0!==r.sourcePortID&&r.sourcePortID!==i.sourcePortID){var u=void 0;e.sourceID&&this.nameTable[e.sourceID]&&(u=this.nameTable[e.sourceID].wrapper),e.sourcePortWrapper=u?this.getWrapper(u,r.sourcePortID):void 0}if(void 0!==r.targetPortID&&r.targetPortID!==i.targetPortID){var f=void 0;e.targetID&&this.nameTable[e.targetID]&&(f=this.nameTable[e.targetID].wrapper),e.targetPortWrapper=f?this.getWrapper(f,r.targetPortID):void 0}s=this.getPoints(e)}if(void 0!==r.style&&Xe(r.style,e.wrapper.children[0]),(s.length>0||void 0!==r.sourceDecorator||void 0!==r.targetDecorator||void 0!==r.cornerRadius)&&(Qe(e,s.length>0?s:e.intermediatePoints),void 0!==r.type&&(a=!0),s.length>0)){if(e.wrapper.measure(new yr(e.wrapper.width,e.wrapper.height)),e.wrapper.arrange(e.wrapper.desiredSize),e.annotations.length)for(var m=0,y=e.annotations;m<y.length;m++){var v=y[m],b=void 0;b=this.getWrapper(e.wrapper,v.id),e.updateAnnotation(v,e.intermediatePoints,e.wrapper.bounds,b)}e.wrapper.measure(new yr(e.wrapper.width,e.wrapper.height)),e.wrapper.arrange(e.wrapper.desiredSize),this.updateObject(e,i,r)}(r.sourcePoint||r.targetPoint||r.segments)&&this.diagramActions===t.DiagramAction.Render&&(a=!0),o||this.updateBridging(),this.updateAnnotations(r,e),e.wrapper.measure(new yr(e.wrapper.width,e.wrapper.height)),e.wrapper.arrange(e.wrapper.desiredSize),!1===n.equals(n,e.wrapper.bounds)&&(this.updateQuad(e),this.updateGroupSize(e)),!0!==a||!this.checkSelectedItem(e)||this.diagramActions&t.DiagramAction.ToolAction&&!(this.diagramActions&t.DiagramAction.UndoRedo)||this.updateSelector(),this.preventConnectorsUpdate||this.updateDiagramObject(e),this.diagramActions&&"New"!==e.status&&(e.status="Update")},r.prototype.findInOutConnectPorts=function(t,e){var i={};return t&&(i=oi(t,e)),i},r.prototype.getPoints=function(t,e){return t.getConnectorPoints(t.type,e,"ComplexHierarchicalTree"===this.layout.type||"HierarchicalTree"===this.layout.type?this.layout.orientation:void 0)},r.prototype.updateNodeProperty=function(t,e,i){if(void 0===e)this.updateElementVisibility(t,this.nameTable[t.id],e);else{t.style.opacity=i;for(var r=0;r<t.children.length;r++)t.children[r]instanceof _r&&this.updateNodeProperty(t.children[r],void 0,i),t.children[r].style.opacity=i}},r.prototype.checkSelectedItem=function(t){var e=this.selectedItems,i=!1,r=[];return(r=r.concat(e.nodes,e.connectors)).length>0&&t.id===r[r.length-1].id&&(i=!0),i},r.prototype.updateDiagramContainerVisibility=function(t,e){if(t instanceof _r)for(var i=0;i<t.children.length;i++)this.updateDiagramContainerVisibility(t.children[i],e);t.visible=e},r.prototype.updateElementVisibility=function(e,i,r){if(void 0!==r){if(e.visible=r,i instanceof En){if(i.children)for(var o=0,n=i.children;o<n.length;o++){var a=n[o];this.updateElementVisibility(this.nameTable[a].wrapper,this.nameTable[a],r)}else e.children[0].visible=r,this.updateDiagramContainerVisibility(e.children[0],r),"Bpmn"===i.shape.type&&this.bpmnModule&&this.bpmnModule.updateElementVisibility(i,r,this);if(i.ports)for(var s=0,h=i.ports;s<h.length;s++){var d=h[s];if(d.visibility&t.PortVisibility.Visible){(m=this.getWrapper(e,d.id)).visible=r}}if(i.annotations)for(var l=0,c=i.annotations;l<c.length;l++){var p=c[l];(m=this.getWrapper(e,p.id)).visible=r}}else for(var g=0;g<3;g++)e.children[g].visible=r;if(i.annotations)for(var u=0,f=i.annotations;u<f.length;u++){p=f[u];(m=this.getWrapper(e,p.id)).visible=r}if(i.expandIcon||i.collapseIcon){var m;if(m=this.getWrapper(e,"icon_content")){for(g=0;g<m.children.length;g++)m.children[g].visible=r;m.visible=r}i&&i.visible&&i.outEdges&&this.updateIconVisibility(i,0!==i.outEdges.length)}!1===r&&this.unSelect(this.nameTable[e.id]),(i instanceof En&&!this.preventNodesUpdate||i instanceof Wo&&!this.preventConnectorsUpdate)&&this.diagramActions&&this.updateDiagramObject(this.nameTable[e.id])}},r.prototype.updateAnnotations=function(t,e){if(void 0!==t.annotations)for(var i=0,r=Object.keys(t.annotations);i<r.length;i++){var o=r[i],n=Number(o),a=t.annotations[o],s=e.annotations[n];this.updateAnnotation(a,s,e.wrapper,e)}},r.prototype.updateAnnotation=function(e,i,r,o,n){var a,s=!1;if(void 0!==(a=this.getWrapper(r,i.id))){if(void 0!==e.width&&void 0!==e.height&&(a.width=e.width,a.height=e.height,s=!0),void 0!==e.rotateAngle&&(a.rotateAngle=e.rotateAngle),!n||a instanceof Po||a.refreshTextElement(),i instanceof ho&&void 0!==e.segmentAngle&&(a.rotateAngle=i.rotateAngle),i instanceof so&&void 0!==e.offset){var h=e.offset;s=!0;var d=void 0!==h.x?h.x:i.offset.x,l=void 0!==h.y?h.y:i.offset.y;a.setOffsetWithRespectToBounds(d,l,"Fraction"),a.relativeMode="Point"}else i instanceof ho&&(void 0!==e.offset||void 0!==e.segmentAngle)&&o.updateAnnotation(i,o.intermediatePoints,o.wrapper.bounds,a);if(i instanceof ho&&e.displacement&&(void 0===e.displacement.x&&void 0===e.displacement.y||(s=!0)),void 0!==e.margin&&(s=!0,void 0!==e.margin.bottom&&(a.margin.bottom=e.margin.bottom),void 0!==e.margin.top&&(a.margin.top=e.margin.top),void 0!==e.margin.left&&(a.margin.left=e.margin.left),void 0!==e.margin.right&&(a.margin.right=e.margin.right)),(s||n)&&(a.width=i.width||o.width),void 0!==e.horizontalAlignment&&(a.horizontalAlignment=e.horizontalAlignment,s=!0),void 0!==e.verticalAlignment&&(a.verticalAlignment=e.verticalAlignment,s=!0),void 0!==e.visibility&&(a.visible=!(!r.visible||!e.visibility)),void 0!==e.constraints){var c=!1;a.constraints&t.AnnotationConstraints.Select&&!(e.constraints&t.AnnotationConstraints.Select)&&hr(this,o,!1,a)&&(c=!0),a.constraints=e.constraints,c&&this.clearSelection()}void 0!==e.style&&Xe(e.style,a),void 0!==e.hyperlink&&Ye(e.hyperlink,a,i),this.updateAnnotationContent(e,s,a,o,i,r),!0===s&&(a.measure(new yr(a.width,a.height)),a.arrange(a.desiredSize)),a instanceof Po||a.refreshTextElement()}},r.prototype.updateAnnotationContent=function(t,e,i,r,o,n){void 0!==t.content&&(i&&(!0,"UmlActivity"===r.shape.type&&"StructuredNode"===r.shape.shape?i.content="<<"+t.content+">>":i.content=t.content),i instanceof Po&&this.updateAnnotationWrapper(i,r,o,n)),void 0!==t.template&&(i.content=t.template,this.updateAnnotationWrapper(i,r,o,n))},r.prototype.updateAnnotationWrapper=function(t,e,i,r){for(var o=0,n=this.views;o<n.length;o++){var a=n[o];ki(t.id+"_groupElement",a),ki(t.id+"_html_element",a)}t=e.initAnnotationWrapper(i,this.element.id);for(var s=0;s<r.children.length;s++)t.id===r.children[s].id&&r.children.splice(s,1,t)},r.prototype.updatePort=function(e,i,r){var o,n=!1;if(void 0!==(o=this.getWrapper(r,i.id))){if(void 0!==e.offset){n=!0;var a=void 0!==e.offset.x?e.offset.x:i.offset.x,s=void 0!==e.offset.y?e.offset.y:i.offset.y;o.setOffsetWithRespectToBounds(a,s,"Fraction"),o.relativeMode="Point"}if(void 0!==e.width&&(n=!0,o.width=e.width),void 0!==e.height&&(n=!0,o.height=e.height),void 0!==e.visibility&&(o.visible=!(!r.visible||!ei(i,t.PortVisibility.Visible))),void 0!==e.margin&&(n=!0,void 0!==e.margin.bottom&&(o.margin.bottom=e.margin.bottom),void 0!==e.margin.top&&(o.margin.top=e.margin.top),void 0!==e.margin.right&&(o.margin.right=e.margin.right),void 0!==e.margin.left&&(o.margin.left=e.margin.left)),void 0!==e.horizontalAlignment&&(n=!0,o.horizontalAlignment=e.horizontalAlignment),void 0!==e.verticalAlignment&&(n=!0,o.verticalAlignment=e.verticalAlignment),void 0!==e.style&&(void 0!==e.style.fill&&(o.style.fill=e.style.fill),void 0!==e.style.opacity&&(o.style.opacity=e.style.opacity),void 0!==e.style.strokeColor&&(o.style.strokeColor=e.style.strokeColor),void 0!==e.style.strokeWidth&&(o.style.strokeWidth=e.style.strokeWidth),void 0!==e.style.strokeDashArray&&(o.style.strokeDashArray=e.style.strokeDashArray)),void 0!==e.shape&&o){var h=A(e.shape);o.data=h}void 0!==e.pathData&&(o.data=String(e.pathData),n=!0),!0===n&&(o.measure(new yr(o.width,o.height)),o.arrange(o.desiredSize))}},r.prototype.updateIcon=function(e){var i=this.getWrapper(e.wrapper,"icon_content"),r=this.diagramActions&t.DiagramAction.Render?this.element.id:void 0;if(i){if("SVG"===this.mode){var o=wi(e.wrapper.id+"_icon_content",r);if(o){var n=wi(o.id+"_rect",r),a=wi(o.id+"_shape",r),s=wi(a.id+"_native_element",r);s&&s.parentNode.removeChild(s),a.parentNode.removeChild(a),n.parentNode.removeChild(n),o.parentNode.removeChild(o)}}var h=e.wrapper.children.indexOf(i);e.wrapper.children.splice(h,1)}var d=this.getPortContainer(e);e.initIcons(this.getDescription,this.layout,d,this.element.id)},r.prototype.getPortContainer=function(t){if(t.children)for(var e=0;e<t.wrapper.children.length;e++)if("group_container"===t.wrapper.children[e].id)return t.wrapper.children[e];return t.wrapper},r.prototype.updateTooltip=function(t,e){void 0!==e.tooltip.content&&(t.tooltip.content=e.tooltip.content),void 0!==e.tooltip.position&&(t.tooltip.position=e.tooltip.position),void 0!==e.tooltip.height&&(t.tooltip.height=e.tooltip.height),void 0!==e.tooltip.width&&(t.tooltip.width=e.tooltip.width),void 0!==e.tooltip.showTipPointer&&(t.tooltip.showTipPointer=e.tooltip.showTipPointer)},r.prototype.updateQuad=function(t){this.spatialSearch.updateQuad(t.wrapper)&&!this.preventUpdate&&this.updatePage()},r.prototype.removeFromAQuad=function(t){this.spatialSearch.removeFromAQuad(t.wrapper);if(this.spatialSearch.updateBounds(t.wrapper)&&!this.preventUpdate&&this.updatePage(),t.children)for(var e=void 0,i=t.children,r=0;r<i.length;r++)(e=this.nameTable[i[r]])&&this.removeFromAQuad(e)},r.prototype.updateGroupSize=function(t){var e;t.parentId&&(e=this.nameTable[t.parentId])&&(e.parentId?this.updateGroupSize(e):(e.wrapper.measure(new yr),e.wrapper.arrange(e.wrapper.desiredSize),this.updateGroupOffset(e),this.updateDiagramObject(e)))},r.prototype.updatePage=function(){if(this.diagramActions&t.DiagramAction.Render){this.scroller.setSize(),this.scroller.updateScrollOffsets();for(var e=0,i=this.views;e<i.length;e++){var o=i[e],n=this.views[o];n instanceof r||n.updateView(n)}}},r.prototype.protectPropertyChange=function(t){this.isProtectedOnChange=t},r.prototype.updateMargin=function(t,e){void 0!==e.margin.top&&(t.margin.top=e.margin.top),void 0!==e.margin.bottom&&(t.margin.bottom=e.margin.bottom),void 0!==e.margin.left&&(t.margin.left=e.margin.left),void 0!==e.margin.right&&(t.margin.right=e.margin.right)},r.prototype.initDroppables=function(){var i,r,o=this,n={},a={};this.droppable=new e.Droppable(this.element),this.droppable.accept=".e-dragclone",this.droppable.over=function(e){if(o.currentSymbol)e.event.touches&&e.event.touches.length&&o.eventHandler.mouseMove(e.event,e.event.touches);else if(e.dragData){var s=void 0,h=void 0,d=o.eventHandler.getMousePosition(e.event),l=void 0,c=e.dragData.helper,p=c.getAttribute("paletteId");if(p){var g=document.getElementById(p).ej2_instances[0];o.droppable.sourceElement=g;var u="selectedSymbols";if(g){var f=g[u];l=Xi(g[u]),n=g.childTable;var m=f.wrapper.children[0].children[0];if(g[u]instanceof En){l.offsetX=d.x+5+(l.width||m.actualSize.width)/2,l.offsetY=d.y+(l.height||m.actualSize.height)/2;var y=new En(o,"nodes",l,!0);if("Bpmn"===y.shape.type&&y.shape.activity.subProcess.processes&&y.shape.activity.subProcess.processes.length&&(y.shape.activity.subProcess.processes=[]),"SwimLane"===y.shape.type&&y.shape.isLane){y.children=[],(i={id:"header"+Hi()}).style=y.shape.lanes[0].header.style,i=o.add(i),(r={id:"body"+Hi()}).style=y.shape.lanes[0].style,r=o.add(r);var v={id:"group"+Hi(),children:[i.id,r.id]};v.shape=y.shape,y=o.add(v)}if(y.shape.isPhase&&((h="Horizontal"===y.shape.orientation)?(y.shape.data="M20,"+y.height/2+" L"+(y.width-20)+","+y.height/2+"z",y.height=1):(y.shape.data="M"+y.width/2+",20 L"+y.width/2+","+(y.height-20)+"z",y.width=1)),s=y,l.children){var b=l;a=o.getChildren(b,{},n),hi(b,-b.offsetX,-b.offsetY,a,!0,o)}}else if(g[u]instanceof Wo){s=new Wo(o,"connectors",l,!0);var w=xr.toBounds([s.sourcePoint,s.targetPoint]),x=d.x-w.center.x,S=d.y-w.center.y;s.sourcePoint.x+=x,s.sourcePoint.y+=S,s.targetPoint.x+=x,s.targetPoint.y+=S}s.shape.isLane||(s.id+=Hi());var P={source:g,element:s,cancel:!1,diagram:o};if(o.enterObject=s,o.enterTable=a,o.triggerEvent(t.DiagramEvent.dragEnter,P),s instanceof En&&"SwimLane"===s.shape.type&&s.shape.isLane){var C=P.element,T=C.shape.lanes[0],A=void 0,M=void 0;h="Horizontal"===C.shape.orientation,A=o.nameTable[s.children[0]],M=o.nameTable[s.children[1]],h?(i.width=T.header.width,i.height=T.height,r.width=T.width-i.width,r.height=T.height,r.offsetX=T.header.width+M.width/2,r.offsetY=M.height/2):(i.width=T.width,i.height=T.header.height,r.width=T.width,r.height=T.height-i.height,r.offsetX=M.width/2,r.offsetY=T.header.height+M.height/2),i.offsetX=A.width/2,i.offsetY=A.height/2,s.width=T.width,s.height=T.height}s instanceof En&&s.shape.isPhase&&(h?s.height=1:s.width=1),o.activeLayer.lock||P.cancel||(o.preventUpdate=!0,s.children&&o.findChild(s,a),o.preventUpdate=!0,o.initObject(s,void 0,void 0,!0),o.currentSymbol=s,"SVG"!==o.mode&&o.refreshDiagramLayer(),o.commandHandler.select(s),o.eventHandler.mouseDown(e.event),o.eventHandler.mouseMove(e.event,e),o.preventUpdate=!1,o.updatePage(),c.style.opacity="0"),delete o.enterObject,delete o.enterTable}o.droppable[u]=c}}},this.droppable.drop=function(i){if(o.currentSymbol){i.event.touches&&o.eventHandler.mouseUp(i.event);var r=void 0,n={source:o.droppable.sourceElement,element:o.currentSymbol,target:o.eventHandler.hoverNode||o,cancel:!1,position:{x:o.currentSymbol.wrapper.offsetX,y:o.currentSymbol.wrapper.offsetY}};o.triggerEvent(t.DiagramEvent.drop,n);var a=void 0;if(a=Xi(o.currentSymbol),a.hasTarget=o.currentSymbol.hasTarget,o.removeFromAQuad(o.currentSymbol),o.removeObjectsFromLayer(o.nameTable[o.currentSymbol.id]),o.removeElements(o.currentSymbol),n.cancel&&o.removeChildNodes(o.currentSymbol),delete o.nameTable[o.currentSymbol.id],o.currentSymbol=null,o.protectPropertyChange(!0),!n.cancel){if(o.startGroupAction(),"Bpmn"===a.shape.type&&a.shape.annotation&&a.hasTarget){var s=a.shape.annotation.nodeId;a.shape.annotation.id=a.id,o.addTextAnnotation(a.shape.annotation,o.nameTable[s]),a.nodeId=""}a.children&&o.addChildNodes(a),n.target&&n.target instanceof En&&$t(o,n.target)&&kt(n.target)?ee(o,n.target,a):o.add(a,!0),Nt(o)&&o.select([o.nameTable[a.id]])}o.protectPropertyChange(!1),r=o.nameTable[a.id],a.hasTarget&&(a.nodeId=a.hasTarget,o.remove(a)),o.bpmnModule&&r instanceof En&&a.processId&&(r.processId=a.processId,o.bpmnModule.dropBPMNchild(o.nameTable[r.processId],r,o)),o.endGroupAction(),"SVG"!==o.mode&&o.refreshDiagramLayer(),delete o.droppable.sourceElement}e.remove(o.droppable.selectedSymbols)},this.droppable.out=function(e){if(o.currentSymbol&&!o.eventHandler.focus){o.unSelect(o.currentSymbol),o.removeFromAQuad(o.currentSymbol),"SVG"!==o.mode&&"Native"===o.currentSymbol.shape.type&&o.removeElements(o.currentSymbol),o.removeObjectsFromLayer(o.nameTable[o.currentSymbol.id]),delete o.nameTable[o.currentSymbol.id],o.triggerEvent(t.DiagramEvent.dragLeave,{element:o.currentSymbol,diagram:o}),"SVG"!==o.mode?o.refreshDiagramLayer():o.removeElements(o.currentSymbol),o.currentSymbol=null;o.droppable.selectedSymbols.style.opacity="1";delete o.droppable.sourceElement}}},r.prototype.removeChildNodes=function(t){if(t instanceof En&&t.children)for(var e=0;e<t.children.length;e++)this.nameTable[t.children[e]].children&&this.removeChildNodes(t),this.removeFromAQuad(this.nameTable[t.children[e]]),this.removeObjectsFromLayer(this.nameTable[t.children[e]]),delete this.nameTable[t.children[e]]},r.prototype.findChild=function(t,e){for(var i,r,o=0;o<t.children.length;o++)(i=e[t.children[o]])&&(i.children&&this.findChild(i,e),i.id=i.id+Hi(),e[i.id]=i,t.children[o]=i.id,r=new En(this,"nodes",i,!0),this.initObject(r,void 0,void 0,!0))},r.prototype.getChildren=function(t,e,i){for(var r,o=0;o<t.children.length;o++)(r=i[t.children[o]])&&(r.children&&(e=this.getChildren(r,e,i)),e[r.id]=Xi(r));return e},r.prototype.addChildNodes=function(t){for(var e,i=0;i<t.children.length;i++)(e=this.nameTable[t.children[i]])&&(e.children&&this.addChildNodes(e),this.add(e,!0))},r.prototype.insertData=function(t){return this.crudOperation(t,"create",this.getNewUpdateNodes("New"))},r.prototype.updateData=function(t){return this.crudOperation(t,"update",this.getNewUpdateNodes("Update"))},r.prototype.removeData=function(t){return this.crudOperation(t,"destroy",this.getDeletedNodes())},r.prototype.crudOperation=function(t,e,i){if(t){var r=this.parameterMap(t,!(t instanceof Wo));if(r){var o=t instanceof Wo?this.dataSourceSettings.connectionDataSource.crudAction[e]:this.dataSourceSettings.crudAction[e];this.raiseAjaxPost(JSON.stringify(r),o)}return r}var n=i;return this.processCrudCollection(n,this.dataSourceSettings.crudAction[e],this.dataSourceSettings.connectionDataSource.crudAction[e]),n},r.prototype.processCrudCollection=function(t,e,i){if(t.nodes){var r=[],o=void 0;for(o=0;o<t.nodes.length;o++)r.push(this.parameterMap(t.nodes[o],!0));r&&r.length>0&&this.raiseAjaxPost(JSON.stringify(r),e)}if(t.connectors){r=[],o=void 0;for(o=0;o<t.connectors.length;o++)r.push(this.parameterMap(t.connectors[o],!1));r&&r.length>0&&this.raiseAjaxPost(JSON.stringify(r),i)}},r.prototype.parameterMap=function(t,e){var i,r={},o=e?this.dataSourceSettings:this.dataSourceSettings.connectionDataSource;if(o.id&&(r[o.id]=t.id),o.sourcePointX&&o.sourcePointY&&(r[o.sourcePointX]=t.sourcePoint.x,r[o.sourcePointY]=t.sourcePoint.y),o.targetPointX&&o.targetPointY&&(r[o.targetPointX]=t.targetPoint.x,r[o.targetPointY]=t.targetPoint.y),o.sourceID&&(r[o.sourceID]=t.sourceID),o.targetID&&(r[o.targetID]=t.targetID),o.crudAction&&o.crudAction.customFields&&o.crudAction.customFields.length>0)for(i=0;i<o.crudAction.customFields.length;i++)r[o.crudAction.customFields[i]]=t[o.crudAction.customFields[i]];return r},r.prototype.getNewUpdateNodes=function(t){var e=[],i=[];for(var r in this.nameTable){var o=this.nameTable[r];o.status==t&&(o&&o instanceof Wo?(o.status="None",i.push(o)):(o.status="None",e.push(o)))}return{nodes:e,connectors:i}},r.prototype.getDeletedNodes=function(){var t,e=[],i=[];for(t=0;t<this.crudDeleteNodes.length;t++){var r=this.crudDeleteNodes[t];r&&r.segments?i.push(r):r&&e.push(r)}return this.crudDeleteNodes=[],{nodes:e,connectors:i}},r.prototype.raiseAjaxPost=function(t,i){var r=new e.Ajax(i,"POST",!0,"application/json"),o=JSON.stringify(JSON.parse(t));r.send(o).then(),r.onSuccess=function(t){}},Ka([e.Property("100%")],r.prototype,"width",void 0),Ka([e.Property("SVG")],r.prototype,"mode",void 0),Ka([e.Property("100%")],r.prototype,"height",void 0),Ka([e.Complex({},Za)],r.prototype,"contextMenuSettings",void 0),Ka([e.Property(t.DiagramConstraints.Default)],r.prototype,"constraints",void 0),Ka([e.Property(t.DiagramTools.Default)],r.prototype,"tool",void 0),Ka([e.Property("Top")],r.prototype,"bridgeDirection",void 0),Ka([e.Property("transparent")],r.prototype,"backgroundColor",void 0),Ka([e.Complex({},ta)],r.prototype,"snapSettings",void 0),Ka([e.Complex({},oa)],r.prototype,"rulerSettings",void 0),Ka([e.Complex({},Zn)],r.prototype,"pageSettings",void 0),Ka([e.Collection([],En)],r.prototype,"nodes",void 0),Ka([e.Property()],r.prototype,"drawingObject",void 0),Ka([e.Collection([],Wo)],r.prototype,"connectors",void 0),Ka([e.Property([])],r.prototype,"basicElements",void 0),Ka([e.Complex({},vo)],r.prototype,"tooltip",void 0),Ka([e.Complex({},da)],r.prototype,"dataSourceSettings",void 0),Ka([e.Property()],r.prototype,"addInfo",void 0),Ka([e.Property()],r.prototype,"getNodeDefaults",void 0),Ka([e.Property()],r.prototype,"getConnectorDefaults",void 0),Ka([e.Property()],r.prototype,"setNodeTemplate",void 0),Ka([e.Property()],r.prototype,"getDescription",void 0),Ka([e.Property()],r.prototype,"getCustomProperty",void 0),Ka([e.Property()],r.prototype,"getCustomTool",void 0),Ka([e.Property()],r.prototype,"getCustomCursor",void 0),Ka([e.Complex({},Vo)],r.prototype,"selectedItems",void 0),Ka([e.Complex({},qn)],r.prototype,"scrollSettings",void 0),Ka([e.Complex({},pa)],r.prototype,"layout",void 0),Ka([e.Complex({},Ga)],r.prototype,"commandManager",void 0),Ka([e.Event()],r.prototype,"dataLoaded",void 0),Ka([e.Event()],r.prototype,"dragEnter",void 0),Ka([e.Event()],r.prototype,"dragLeave",void 0),Ka([e.Event()],r.prototype,"dragOver",void 0),Ka([e.Event()],r.prototype,"click",void 0),Ka([e.Event()],r.prototype,"historyChange",void 0),Ka([e.Event()],r.prototype,"doubleClick",void 0),Ka([e.Event()],r.prototype,"textEdit",void 0),Ka([e.Event()],r.prototype,"scrollChange",void 0),Ka([e.Event()],r.prototype,"selectionChange",void 0),Ka([e.Event()],r.prototype,"sizeChange",void 0),Ka([e.Event()],r.prototype,"connectionChange",void 0),Ka([e.Event()],r.prototype,"sourcePointChange",void 0),Ka([e.Event()],r.prototype,"targetPointChange",void 0),Ka([e.Event()],r.prototype,"propertyChange",void 0),Ka([e.Event()],r.prototype,"positionChange",void 0),Ka([e.Event()],r.prototype,"animationComplete",void 0),Ka([e.Event()],r.prototype,"rotateChange",void 0),Ka([e.Event()],r.prototype,"collectionChange",void 0),Ka([e.Event()],r.prototype,"created",void 0),Ka([e.Event()],r.prototype,"mouseEnter",void 0),Ka([e.Event()],r.prototype,"mouseLeave",void 0),Ka([e.Event()],r.prototype,"mouseOver",void 0),Ka([e.Event()],r.prototype,"contextMenuOpen",void 0),Ka([e.Event()],r.prototype,"contextMenuBeforeItemRender",void 0),Ka([e.Event()],r.prototype,"contextMenuClick",void 0),Ka([e.Collection([],ja)],r.prototype,"layers",void 0),Ka([e.Event()],r.prototype,"drop",void 0),r}(e.Component),Ja=function(){function t(t){this.diagram=t}return t.prototype.exportDiagram=function(t){var i,r,o,n,a="data",s=[],h=t.margin||{},d=t&&t.region?t.region:"Content";n=t&&t.mode?t.mode:"Download";var l=this.getDiagramBounds(d,t);t.bounds&&(r=!0,l.x=t.bounds.x?t.bounds.x:l.x,l.y=t.bounds.y?t.bounds.y:l.y,l.width=t.bounds.width||l.width,l.height=t.bounds.height||l.height),h={top:void 0!==h.top?h.top:25,bottom:void 0!==h.bottom?h.bottom:25,right:void 0!==h.right?h.right:25,left:void 0!==h.left?h.left:25};this.diagram.nodes;"PageSettings"!==d&&(l.x-=h.left,l.y-=h.top,l.width+=h.left+h.right,l.height+=h.top+h.bottom);var c=t.fileName||"diagram";if("SVG"!==t.format){if(null!==(a=this.setCanvas(t,l,h,n,r,d,c)))return a}else{i=t.format,t.bounds=l,t.margin=h;var p=o=this.diagramAsSvg(t,h);if("Data"===n)return o;var g=(new XMLSerializer).serializeToString(p);s.push(g)}if("Download"===n&&null!==a)for(var u=0;u<s.length;u++){var f=new Blob([s[u]],{type:"application/octet-stream"});if("msie"===e.Browser.info.name)window.navigator.msSaveOrOpenBlob(f,c+"."+i);else{var m=Oi("a",{download:c+"."+i}),y=URL.createObjectURL(f);m.href=y;var v=document.createEvent("MouseEvents");v.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),m.dispatchEvent(v)}}return null},t.prototype.setCanvas=function(t,e,i,r,o,n,a){var s,h,d=this;t.bounds=e,t.region=n;var l=[];this.setScaleValueforCanvas(t,e);var c=this.diagramAsCanvas({bounds:e,margin:i,region:n,scaleX:t.scaleX,scaleY:t.scaleY},o);s=t.format||"JPG";var p=h=c.toDataURL();if("Data"===r)return h;if(t.multiplePage){if(t.pageHeight=t.pageHeight?t.pageHeight:this.diagram.pageSettings.height,t.pageWidth=t.pageWidth?t.pageWidth:this.diagram.pageSettings.width,t.pageHeight=t.pageHeight?t.pageHeight:c.width,t.pageWidth=t.pageWidth?t.pageWidth:c.height,i=t.margin||{},t.pageOrientation&&("Landscape"===t.pageOrientation&&t.pageHeight>t.pageWidth||"Portrait"===t.pageOrientation&&t.pageWidth>t.pageHeight)){var g=t.pageWidth;t.pageWidth=t.pageHeight,t.pageHeight=g}t.margin={top:isNaN(i.top)?0:i.top,bottom:isNaN(i.bottom)?0:i.bottom,left:isNaN(i.left)?0:i.left,right:isNaN(i.right)?0:i.right};var u=Oi("img",{id:this.diagram.element.id+"_printImage",src:p});u.onload=function(){l=d.getMultipleImage(u,t,!0),d.exportImage(l,a,s,p)}}else l=[p],this.exportImage(l,a,s,p);return null},t.prototype.exportImage=function(t,i,r,o){for(var n=[],a=t instanceof HTMLElement?0:t.length,s=0;s<a;s++){for(var h=t[s].replace(/^data:[a-z]*;,/,"").split(","),d=atob(h[1]),l=new ArrayBuffer(d.length),c=new Uint8Array(l),p=0;p<d.length;p++)c[p]=d.charCodeAt(p);n.push(l)}for(var g=function(t){var o=new Blob([n[t]],{type:"application/octet-stream"});if("msie"===e.Browser.info.name)window.navigator.msSaveOrOpenBlob(o,i+"."+r);else{var a=Oi("a",{download:i+"."+r}),s=URL.createObjectURL(o);a.href=s;var h=document.createEvent("MouseEvents");h.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),setTimeout(function(){a.dispatchEvent(h)},5*(t+1))}},u=0;u<n.length;u++)g(u)},t.prototype.getObjectsBound=function(t){for(var e,i=0,r=this.diagram.nodes;i<r.length;i++){var o=r[i];o.visible&&(("SVG"===t.format||o instanceof Ur||o instanceof Po)&&("SVG"!==t.format||o instanceof Po)||(e=e?e.uniteRect(o.wrapper.outerBounds):o.wrapper.outerBounds))}for(var n=0,a=this.diagram.connectors;n<a.length;n++){var s=a[n];s.visible&&(e=e?e.uniteRect(s.wrapper.outerBounds):s.wrapper.outerBounds)}return e||new xr(0,0,0,0)},t.prototype.getDiagramBounds=function(t,e){var i=this.getObjectsBound(e),r=i.left,o=i.top,n=i.right-i.left,a=i.bottom-i.top;"Content"!==t&&(this.diagram.pageSettings&&this.diagram.pageSettings.multiplePage?(r=i.left,o=i.top,this.diagram.pageSettings.width&&(r=Math.floor(r/this.diagram.pageSettings.width)*this.diagram.pageSettings.width,n=Math.ceil(i.right/this.diagram.pageSettings.width)*this.diagram.pageSettings.width-r),this.diagram.pageSettings.height&&(o=Math.floor(o/this.diagram.pageSettings.height)*this.diagram.pageSettings.height,a=Math.ceil(i.bottom/this.diagram.pageSettings.height)*this.diagram.pageSettings.height-o),0===i.width&&null!==this.diagram.pageSettings.width&&(n=this.diagram.pageSettings.width),0===i.height&&null!==this.diagram.pageSettings.height&&(a=this.diagram.pageSettings.height)):(this.diagram.pageSettings.width&&(r=0,n=this.diagram.pageSettings.width),this.diagram.pageSettings.height&&(o=0,a=this.diagram.pageSettings.height)));var s=new xr;return s.x=r,s.y=o,s.width=n,s.height=a,s},t.prototype.setScaleValueforCanvas=function(t,e){t.scaleX=1,t.scaleY=1,t.pageHeight=t.pageHeight||this.diagram.pageSettings.height,t.pageWidth=t.pageWidth||this.diagram.pageSettings.width;var i=t.pageHeight||e.height,r=t.pageWidth||e.width;"Stretch"!==t.stretch&&"Meet"!==t.stretch&&"Slice"!==t.stretch||(t.scaleX=r/e.width,t.scaleY=i/e.height,"Meet"===t.stretch?t.scaleX=t.scaleY=Math.min(t.scaleX,t.scaleY):"Slice"===t.stretch&&(t.scaleX=t.scaleY=Math.max(t.scaleX,t.scaleY)),e.width=r,e.height=i),e.x*=t.scaleX,e.y*=t.scaleY},t.prototype.diagramAsSvg=function(t,e){var i=this.diagram.createSvg(this.diagram.element.id+"_diagram_svg",t.bounds.width,t.bounds.height);document.body.appendChild(i);var r=Ii("g",{id:this.diagram.element.id+"_pageBackground"}),o=t&&t.region?t.region:"Content",n=this.getDiagramBounds(o,t),a=n.x,s=n.y,h=n.width,d=n.height;i.appendChild(r);var l={transform:"translate("+(-t.bounds.x+e.left)+", "+(-t.bounds.y+e.top)+")",x:String(a),y:String(s),width:String(h),height:String(d)};Ni(r,l);var c=document.getElementById(this.diagram.element.id+"_backgroundLayerrect").cloneNode(!0);if(l={x:0,y:0,width:String(h+e.left+e.right),height:String(d+e.top+e.bottom)},Ni(c,l),i.appendChild(c),"SVG"===this.diagram.mode){var p=bi(this.diagram.element.id);i.appendChild(p.getElementById(this.diagram.diagramLayer.id).cloneNode(!0));for(var g=0;g<i.childNodes.length;g++){var u=i.childNodes[g];"diagram_diagramLayer"===u.id&&u.setAttribute("transform","translate("+(-n.x+e.left)+", "+(-n.y+e.top)+")")}}else{r=Ii("g",{id:this.diagram.element.id+"_diagramLayer"}),i.appendChild(r),r.setAttribute("transform","translate("+(-t.bounds.x+e.left)+", "+(-t.bounds.y+e.top)+")");this.diagram.nodes;var f=new Vn("",null,!0),m=Li(this.diagram.element.id);this.diagram.renderDiagramElements(i,f,m,!1)}return document.body.removeChild(i),i},t.prototype.diagramAsCanvas=function(t,e){var i=t.bounds,r=t.margin,o=t&&t.region?t.region:"Content",n=this.getDiagramBounds(o,t),a=this.diagram.pageSettings.background.color,s=Xn.createCanvas(this.diagram.element.id+"_diagram",t.bounds.width,t.bounds.height),h=s.getContext("2d");h.translate(-i.x,-i.y),h.save(),h.fillStyle=this.diagram.pageSettings.background.color,i="Content"===o?n:i,h.fillRect(i.x,i.y,i.width,i.height);var d=this.diagram.pageSettings.background;if(d&&d.source){n=this.getDiagramBounds(o,t);var l=new Image;l.src=d.source;var c=n.width/l.width,p=n.height/l.height,g=n.x,u=n.y,f=n.width,m=n.height,y=this.isImageExportable(d);if("None"!==d.scale&&"None"!==d.align){var v="Meet"===d.scale?Math.min(c,p):Math.max(c,p);f=v*l.width,m=v*l.height,d.align.indexOf("xmid")>-1?g+=(n.width-f)/2:d.align.indexOf("xmax")>-1&&(g=g+n.width-f),d.align.indexOf("ymid")>-1?u+=(n.height-m)/2:d.align.indexOf("ymax")>-1&&(u=u+n.height-m),"none"!==this.diagram.pageSettings.background.color&&"transparent"!==this.diagram.pageSettings.background.color||(h.fillStyle="white",h.fillRect(n.x*t.scaleX,n.y*t.scaleY,n.width*t.scaleX,n.height*t.scaleY)),y&&h.drawImage(l,g,u,v*l.width,v*l.height)}else y&&h.drawImage(l,g,u,n.width,n.height)}else h.fillStyle="transparent"===a?"white":a,h.fillRect(n.x*t.scaleX-r.left,n.y*t.scaleY-r.top,n.width*t.scaleX+r.left+r.right,t.scaleY*n.height+r.top+r.bottom);var b=this.diagram.pageSettings.background.color,w=this.diagram.pageSettings.width;w&&(h.strokeStyle="none"===b?"transparent":b,h.lineWidth=w,h.strokeRect(n.x*t.scaleX,n.y*t.scaleY,n.width*t.scaleX,n.height*t.scaleY)),h.restore();var x=Li(this.diagram.element.id),S=new Vn("",null,!1);return this.diagram.renderDiagramElements(s,S,x,!1,!0),s},t.prototype.isImageExportable=function(t){var e,i=!0;if(t.source)try{var r=(e=Xn.createCanvas(this.diagram.element.id+"temp_canvas",100,100)).getContext("2d");r.save();var o=new Image;o.src=t.source,r.drawImage(o,0,0,100,100),r.restore(),e.toDataURL()}catch(t){i=!1}return i},t.prototype.getPrintCanvasStyle=function(t,e){var i=0,r=0,o=new yr;if(i=t.width,r=t.height,(e.pageHeight||e.pageWidth)&&(r=e.pageHeight?e.pageHeight:r,i=e.pageWidth?e.pageWidth:i),e.pageOrientation&&("Landscape"===e.pageOrientation&&r>i||"Portrait"===e.pageOrientation&&i>r)){var n=i;i=r,r=n}return o.height=r,o.width=i,o},t.prototype.getMultipleImage=function(t,e,i){var r,o,n=[],a=Oi("div",{}),s=this.getPrintCanvasStyle(t,e),h=e.margin,d=h.left,l=h.top,c=h.right,p=h.bottom,g=0;r=s.width+g,o=s.height+0;var u=0,f=0;if(e&&e.multiplePage&&"Content"!==e.region){a.style.height="auto",a.style.width="auto";var m=t.height,y=t.width,v=0,b=0,w=void 0,x=0,S=0,P=void 0,C=void 0;do{do{x=s.width,S=s.height,u+s.width>=y&&(x=y-u),f+s.height>=m&&(S=m-f),(P=(C=Xn.createCanvas(this.diagram.element.id+"_multiplePrint",s.width,s.height)).getContext("2d")).drawImage(t,g+u+d,0+f+l,x-c-d,S-p-l,0+d,0+l,x-c-d,S-p-l),u+s.width>=y&&(u-=u-y),w=C.toDataURL(),P.restore(),u+=r,i?n.push(w):this.printImage(a,w,v+""+b,r+"px;",o+"px;"),v++}while(u<y);b++,v=g=u=0,f+s.height>=m&&(f-=f-m),f+=o}while(f<m)}else{var T,A,M=this.getPrintCanvasStyle(t,e);T=M.width,A=M.height;P=void 0,C=void 0,w=void 0;(P=(C=Xn.createCanvas(this.diagram.element.id+"_diagram",T,A)).getContext("2d")).drawImage(t,0+d,0+l,t.width-(c+d),t.height-(l+p),0+d,0+l,T-(c+d),A-(l+p)),w=C.toDataURL(),P.restore(),this.printImage(a,w,0)}return i?n:a},t.prototype.printImage=function(t,e,i,r,o){var n={class:"e-diagram-print-page",style:"width:"+r+"height:"+o},a=Oi("img",n),s=Oi("div",n);Bi(a,n={id:this.diagram.element.id+"_multiplePrint_img"+i,style:"float:left",src:e}),s.appendChild(a),t.appendChild(s)},t.prototype.print=function(t){var e=this;t.mode="Data",t.margin={top:0,bottom:0,right:0,left:0};var i=this.exportDiagram(t),r=Oi("img",{id:this.diagram.element.id+"_printImage",src:i});r.onload=function(){var i=e.getMultipleImage(r,t),o=window.open("");null!=o&&i instanceof HTMLElement&&(o.document.write("<html><head><style> body{margin:0px;}  @media print { .e-diagram-print-page{page-break-after: left; }.e-diagram-print-page:last-child {page-break-after: avoid;}}</style><title></title></head>"),o.document.write('<BODY onload="setTimeout(function(){window.print();}, 100)">'),o.document.write("<center>"+i.innerHTML+"</center>"),o.document.close())}},t.prototype.destroy=function(){},t.prototype.getModuleName=function(){return"PrintandExport"},t}(),$a=function(){function t(){this.dataTable={}}return t.prototype.destroy=function(){},t.prototype.getModuleName=function(){return"DataBinding"},t.prototype.initData=function(t,e){var i,r=t.dataManager||{};(i=t.data||r.data||r.json||(r.dataSource?r.dataSource.json:void 0))&&i.length&&this.applyDataSource(t,i,e)},t.prototype.initSource=function(t,e){var i,o=this,n=t;if(t.dataManager instanceof r.DataManager){var a=n.dataManager.defaultQuery;t.dataManager.executeQuery(a).then(function(r){i=r.result,e.isDestroyed||(o.applyDataSource(t,i,e),e.refreshDiagram(),e.trigger("dataLoaded",{diagram:e}))})}},t.prototype.applyDataSource=function(t,e,i){this.dataTable={};var r,o,n,a,s=[],h=[];if(void 0!==e){for(var d=0;d<e.length;d++)void 0===(r=e[d])[t.parentId]||null===r[t.parentId]||"object"!=typeof r[t.parentId]?void 0!==s[r[t.parentId]]?s[r[t.parentId]].items.push(r):s[r[t.parentId]]={items:[r]}:s=this.updateMultipleRootNodes(r,s,t,e),t.root===r[t.id]&&(o={items:[r]});if(o)h.push(o);else for(var l=0,c=Object.keys(s);l<c.length;l++){var p=c[l];p&&"undefined"!==p&&"''"!==p&&"null"!==p||h.push(s[p])}for(var g=0;g<h.length;g++)for(var u=0;u<h[g].items.length;u++){n=h[g].items[u];var f=this.applyNodeTemplate(t,n,i);i.nodes.push(f),this.dataTable[n[t.id]]=f,void 0!==(a=s[f.data[t.id]])&&this.renderChildNodes(t,a,f.id,s,i)}}this.dataTable=null},t.prototype.updateMultipleRootNodes=function(t,e,i,r){for(var o,n=t[i.parentId],a=0;a<n.length;a++)e[o=n[a]]?e[o].items.push(t):e[o]={items:[t]};return e},t.prototype.applyNodeTemplate=function(t,e,i){var r={id:Hi(),data:e},o=ir(t.doBinding);o&&o(r,e,i);var n=new En(i,"nodes",r,!0);return this.collectionContains(n,i,t.id,t.parentId)?this.dataTable[e[t.id]]:n},t.prototype.renderChildNodes=function(t,e,i,r,o){for(var n,a,s,h=0;h<e.items.length;h++){n=e.items[h],s=this.applyNodeTemplate(t,n,o);var d=!1;this.collectionContains(s,o,t.id,t.parentId)?d=!0:(this.dataTable[n[t.id]]=s,o.nodes.push(s)),this.containsConnector(o,i,s.id)||o.connectors.push(this.applyConnectorTemplate(i,s.id,o)),d||void 0!==(a=r[s.data[t.id]])&&this.renderChildNodes(t,a,s.id,r,o)}},t.prototype.containsConnector=function(t,e,i){if(""!==e&&""!==i)for(var r=0;r<t.connectors.length;r++){var o=t.connectors[r];if(void 0!==o&&o.sourceID===e&&o.targetID===i)return!0}return!1},t.prototype.collectionContains=function(t,e,i,r){var o=this.dataTable[t.data[i]];return void 0!==o&&o.data[i]===t.data[i]&&o.data[r]===t.data[r]},t.prototype.applyConnectorTemplate=function(t,e,i){var r={id:Hi(),sourceID:t,targetID:e};return new Wo(i,"connectors",r,!0)},t}(),ts={content:".e-diagramcontent",copy:"e-copy",paste:"e-paste",undo:"e-undo",redo:"e-redo",cut:"e-cut",selectAll:"e-selectall",grouping:"e-grouping",group:"e-group",unGroup:"e-ungroup",bringToFront:"e-bringfront",sendToBack:"e-sendback",moveForward:"e-bringforward",sendBackward:"e-sendbackward",order:"e-order"},es=function(){function t(t,e){this.defaultItems={},this.disableItems=[],this.hiddenItems=[],this.localeText=this.setLocaleKey(),this.parent=t,this.serviceLocator=e,this.addEventListener()}return t.prototype.addEventListener=function(){this.parent.isDestroyed||this.parent.on("initial-load",this.render,this)},t.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("initial-load",this.render)},t.prototype.render=function(){this.l10n=this.serviceLocator.getService("localization"),this.element=Oi("ul",{id:this.parent.element.id+"_contextMenu"}),this.parent.element.appendChild(this.element);var t="#"+this.parent.element.id;this.contextMenu=new o.ContextMenu({items:this.getMenuItems(),enableRtl:this.parent.enableRtl,enablePersistence:this.parent.enablePersistence,locale:this.parent.locale,target:t,select:this.contextMenuItemClick.bind(this),beforeOpen:this.contextMenuBeforeOpen.bind(this),onOpen:this.contextMenuOpen.bind(this),beforeItemRender:this.BeforeItemRender.bind(this),onClose:this.contextMenuOnClose.bind(this),cssClass:"e-diagram-menu"}),this.contextMenu.appendTo(this.element)},t.prototype.getMenuItems=function(){var t=[],e=[],i=[];if(!this.parent.contextMenuSettings.showCustomMenuOnly){for(var r=0,o=this.getDefaultItems();r<o.length;r++){var n=o[r];-1!==n.toLocaleLowerCase().indexOf("group")?"grouping"!==n.toLocaleLowerCase()&&i.push(this.buildDefaultItems(n)):-1!==n.toLocaleLowerCase().indexOf("order")?"order"!==n.toLocaleLowerCase()&&e.push(this.buildDefaultItems(n)):t.push(this.buildDefaultItems(n))}if(i.length>0){(a=this.buildDefaultItems("grouping")).items=i,t.push(a)}if(e.length>0){var a;(a=this.buildDefaultItems("order")).items=e,t.push(a)}}if(this.parent.contextMenuSettings.items)for(var s=0,h=this.parent.contextMenuSettings.items;s<h.length;s++){var d=h[s];t.push(d)}return t},t.prototype.contextMenuOpen=function(){this.isOpen=!0},t.prototype.BeforeItemRender=function(t){this.parent.trigger(Tr,t)},t.prototype.contextMenuItemClick=function(t){document.getElementById(this.parent.element.id+"content").focus(),this.parent.trigger(Pr,t);var e=this.getKeyFromId(t.item.id);if(!t.cancel)switch(e){case"cut":this.parent.cut();break;case"copy":this.parent.copy();break;case"undo":this.parent.undo();break;case"redo":this.parent.redo();break;case"paste":this.parent.paste();break;case"selectAll":this.parent.selectAll();break;case"group":this.parent.group();break;case"unGroup":this.parent.unGroup();break;case"bringToFrontOrder":this.parent.bringToFront();break;case"moveForwardOrder":this.parent.moveForward();break;case"sendToBackOrder":this.parent.sendToBack();break;case"sendBackwardOrder":this.parent.sendBackward()}},t.prototype.contextMenuOnClose=function(t){t.items.length>0&&t.items[0].parentObj instanceof o.ContextMenu&&this.updateItemStatus()},t.prototype.getLocaleText=function(t){return this.l10n.getConstant(this.localeText[t])},t.prototype.updateItemStatus=function(){this.contextMenu.showItems(this.hiddenItems,!0),this.contextMenu.enableItems(this.disableItems,!1,!0),this.hiddenItems=[],this.disableItems=[],this.isOpen=!1},t.prototype.ensureItems=function(t,e){var i=this.getKeyFromId(t.id);this.defaultItems[i];-1!==this.getDefaultItems().indexOf(i)&&t.target&&e&&!this.ensureTarget(t)&&this.hiddenItems.push(t.id)},t.prototype.contextMenuBeforeOpen=function(t){var e=t;e.hiddenItems=[];for(var i=0,r=t.items;i<r.length;i++){var o=r[i];if(this.ensureItems(o,t.event),o.items.length)for(var n=0,a=o.items;n<a.length;n++){var s=a[n];this.ensureItems(s,t.event)}}if(this.eventArgs=t.event,this.parent.trigger(Cr,e),e.items.length===e.hiddenItems.length)e.cancel=!0,e.hiddenItems=[];else{this.hiddenItems=this.hiddenItems.concat(e.hiddenItems),this.contextMenu.enableItems(this.disableItems,!1,!0);var h=this;t.items.forEach(function(t){h.hiddenItems.indexOf(t.id)>-1&&h.contextMenu.hideItems([t.id],!0)})}},t.prototype.ensureTarget=function(t){var e=this.parent.selectedItems.nodes.length+this.parent.selectedItems.connectors.length,i=!1;switch(this.getKeyFromId(t.id)){case"undo":i=!(!this.parent.historyList||!this.parent.historyList.canUndo);break;case"redo":i=!(!this.parent.historyList||!this.parent.historyList.canRedo);break;case"paste":i=!!this.parent.commandHandler.clipboardData.clipObject;break;case"selectAll":i=!!(this.parent.nodes.length+this.parent.connectors.length);break;case"grouping":i=!!(e>1||this.parent.selectedItems.nodes[0]&&this.parent.selectedItems.nodes[0].children&&this.parent.selectedItems.nodes[0].children.length>1);break;case"group":i=e>1;break;case"unGroup":i=!!(this.parent.selectedItems.nodes[0]&&this.parent.selectedItems.nodes[0].children&&this.parent.selectedItems.nodes[0].children.length>1);break;case"cut":case"copy":case"order":case"bringToFrontOrder":case"moveForwardOrder":case"sendToBackOrder":case"sendBackwardOrder":i=!!e}return i},t.prototype.destroy=function(){this.contextMenu.destroy(),e.remove(this.element),this.removeEventListener()},t.prototype.getModuleName=function(){return"contextMenu"},t.prototype.generateID=function(t){return this.parent.element.id+"_contextMenu_"+t},t.prototype.getKeyFromId=function(t){return t.replace(this.parent.element.id+"_contextMenu_","")},t.prototype.buildDefaultItems=function(t){var e;switch(t){case"copy":e={target:ts.content,iconCss:ts.copy};break;case"cut":e={target:ts.content,iconCss:ts.cut};break;case"paste":e={target:ts.content,iconCss:ts.paste};break;case"undo":e={target:ts.content,iconCss:ts.undo};break;case"redo":e={target:ts.content,iconCss:ts.redo};break;case"grouping":e={target:ts.content};break;case"group":e={target:ts.content,iconCss:ts.group};break;case"unGroup":e={target:ts.content,iconCss:ts.unGroup};break;case"order":e={target:ts.content,iconCss:ts.order};break;case"bringToFrontOrder":e={target:ts.content,iconCss:ts.bringToFront};break;case"moveForwardOrder":e={target:ts.content,iconCss:ts.moveForward};break;case"sendToBackOrder":e={target:ts.content,iconCss:ts.sendToBack};break;case"sendBackwardOrder":e={target:ts.content,iconCss:ts.sendBackward};break;case"selectAll":e={target:ts.content}}return this.defaultItems[t]={text:this.getLocaleText(t),id:this.generateID(t),target:e.target,iconCss:e.iconCss?"e-icons "+e.iconCss:""},this.defaultItems[t]},t.prototype.getDefaultItems=function(){return["copy","cut","paste","undo","redo","selectAll","grouping","group","unGroup","order","bringToFrontOrder","moveForwardOrder","sendToBackOrder","sendBackwardOrder"]},t.prototype.setLocaleKey=function(){return{copy:"Copy",cut:"Cut",paste:"Paste",undo:"Undo",redo:"Redo",selectAll:"SelectAll",grouping:"Grouping",group:"Group",unGroup:"UnGroup",order:"Order",bringToFrontOrder:"BringToFront",moveForwardOrder:"MoveForward",sendToBackOrder:"SendToBack",sendBackwardOrder:"SendBackward"}},t}(),is=function(){function e(){this.annotationObjects={}}return Object.defineProperty(e.prototype,"textAnnotationConnectors",{get:function(){for(var t=[],e=0,i=Object.keys(this.annotationObjects);e<i.length;e++)for(var r=i[e],o=this.annotationObjects[r],n=0,a=Object.keys(o);n<a.length;n++){var s=a[n];t.push(o[s].connector)}return t},enumerable:!0,configurable:!0}),e.prototype.getTextAnnotationConn=function(t){var e=[];if("Bpmn"===t.shape.type&&0!==t.shape.annotations.length)for(var i=this.annotationObjects[t.id],r=0,o=Object.keys(i);r<o.length;r++){var n=o[r];e.push(i[n].connector)}return e},e.prototype.getSize=function(t,e){var i=new yr(t.width,t.height);if(void 0===i.width||void 0===i.height){if(e instanceof Yr||(i.width=i.width||50,i.height=i.height||50),e.actualSize.width&&e.actualSize.height)return e.actualSize;e.measure(new yr),i.width=i.width||e.desiredSize.width,i.height=i.height||e.desiredSize.height,void 0!==t.maxWidth&&(i.width=Math.min(i.width,t.maxWidth)),void 0!==t.maxHeight&&(i.height=Math.min(i.height,t.maxHeight)),void 0!==t.minWidth&&(i.width=Math.max(i.width,t.minWidth)),void 0!==t.minHeight&&(i.height=Math.max(i.height,t.minHeight))}return i},e.prototype.initBPMNContent=function(t,e,i){var r=e.shape;if("Event"===r.shape&&(t=this.getBPMNEventShape(e,r.event)),"Gateway"===r.shape&&(t=this.getBPMNGatewayShape(e)),"DataObject"===r.shape&&(t=this.getBPMNDataObjectShape(e)),"Message"!==r.shape&&"DataSource"!==r.shape||(t=this.getBPMNShapes(e)),"Activity"===r.shape&&(t=this.getBPMNActivityShape(e)),"TextAnnotation"===r.shape&&(t=this.renderBPMNTextAnnotation(i,e,t)),r.annotations.length>0){for(var o=0;o<r.annotations.length&&r.annotations[o].text;o++)t.children.push(this.getBPMNTextAnnotation(e,i,r.annotations[o],t));t.style.strokeDashArray="2 2 6 2"}return t},e.prototype.getBPMNShapes=function(e){var i=new Yr;this.setStyle(i,e),0!=(e.constraints&t.NodeConstraints.Shadow)&&(i.shadow=e.shadow);var r=lr(e.shape.shape);return i.data=r,i.id=e.id+"_"+e.shape.shape,void 0!==e.width&&void 0!==e.height&&(i.width=e.width,i.height=e.height),i},e.prototype.getBPMNGatewayShape=function(t){var e=new Qr,i=new Yr;i.id=t.id+"_0_gateway",i.offsetX=t.offsetX,i.offsetY=t.offsetY,i.data="M 40 20 L 20 40 L 0 20 L 20 0 L 40 20 Z",this.setStyle(i,t);var r=new Yr;r.id=t.id+"_1_gatewayType",r.style.opacity=t.style.opacity,r.horizontalAlignment="Center",r.verticalAlignment="Center",r.relativeMode="Object";var o,n=t.shape.gateway;o=pr(n.type),"EventBased"===n.type||"ExclusiveEventBased"===n.type||"ParallelEventBased"===n.type?r.style.fill="white":r.style.fill="black",r.data=o,e.style.fill="transparent",e.style.strokeColor="transparent",e.style.strokeWidth=0,e.children=[i,r];var a=this.getSize(t,i);return this.setSizeForBPMNGateway(t.shape.gateway,e,a.width,a.height),e},e.prototype.getBPMNDataObjectShape=function(t){var e=new Qr,i=t.shape.dataObject,r=new Yr;r.id=t.id+"_0_dataobj",r.data="M29.904,5 L7.853,5 L7.853,45 L42.147,45 L42.147,17.242,L29.932,5,L29.932,17.242,L42.147,17.242";var o=this.getSize(t,r);r.width=o.width,r.height=o.height,this.setStyle(r,t);var n=new Yr;n.id=t.id+"_1_type",n.width=25,n.height=20,n.margin.left=5,n.margin.top=5,n.data="M 3 9.4 l 6 0 v 2.4 l 3.6 -4 L 9 4 v 2.5 H 3 V 9.4 Z",n.style.opacity=t.style.opacity;var a=new Yr;switch(a.id=t.id+"_2_collection",a.width=7.5,a.height=15,a.style.fill="black",a.visible=!0,a.horizontalAlignment="Center",a.verticalAlignment="Bottom",a.relativeMode="Object",a.style.opacity=t.style.opacity,a.data="M 0 0 L 0.1 0 L 0.1 2 L 0 2 Z M 0.4 0 L 0.6 0 L 0.6 2 L0.4 2 Z M 0.9 0 L 1 0 L 1 2 L 0.9 2 Z",i.type){case"None":n.visible=!1;break;case"Input":n.style.fill="white";break;case"Output":n.style.fill="black"}return!1===i.collection&&(a.visible=!1),e.style.fill="transparent",e.style.strokeColor="transparent",e.style.strokeWidth=0,e.children=[r,n,a],e},e.prototype.getBPMNTaskShape=function(t){var e=t.shape.activity.task,i=new Qr,r=new Ar;r.cornerRadius=10;var o=this.getSize(t,r);r.id=t.id+"_0_task",r.width=o.width,r.height=o.height,this.setStyle(r,t),void 0!==e.call&&!0===e.call&&(r.style.strokeWidth=4),i.width=o.width,i.height=o.height;var n,a=this.getTaskChildCount(t),s=12*a,h=o.width/2-s;n=1===a?h+8:h+8*(a-1);var d,l=new Yr;"Receive"===e.type||"Send"===e.type?(l.width=18,l.height=16):(l.width=20,l.height=20),l.id=t.id+"_1_tasktType",l.margin.left=5,l.margin.top=5,d=gr(e.type),l.data=d,l.style.fill="transparent",l.style.opacity=t.style.opacity,i.style.fill="transparent",i.style.strokeColor="transparent",i.style.strokeWidth=0,i.children=[r,l];var c,p=e.loop,g=new Yr;c=ur(p),g.data=c,g.style.fill="black",g.visible="None"!==p,1===a&&(n=h+9),g.margin.left=n,!0===g.visible&&(n+=20),g.width=12,g.height=12,g.margin.bottom=5,g.id=t.id+"_2_loop",g.horizontalAlignment="Left",g.verticalAlignment="Bottom",g.setOffsetWithRespectToBounds(0,1,"Fraction"),g.relativeMode="Point",g.style.fill="transparent",l.style.opacity=t.style.opacity,i.children.push(g);var u=new Yr;return u=this.getBPMNCompensationShape(t,u),!0===e.compensation?u.visible=!0:u.visible=!1,1===a&&(n=h+9),u.margin.left=n-3,n+=18,i.children.push(u),i},e.prototype.getBPMNEventShape=function(t,e,i,r){var o,n,a,s,h=new Qr;r=r||t.id;var d="M164.1884,84.6909000000001C156.2414,84.6909000000001,149.7764,78.2259000000001,149.7764,70.2769000000001C149.7764,62.3279000000001,156.2414,55.8629000000001,164.1884,55.8629000000001C172.1354,55.8629000000001,178.6024,62.3279000000001,178.6024,70.2769000000001C178.6024,78.2259000000001,172.1354,84.6909000000001,164.1884,84.6909000000001",l=t.shape.event;if("Event"===t.shape.shape&&(o=l.event,n=l.trigger),a=e.width,s=e.height,i)a=a||20,s=s||20;else if(void 0===e.width||void 0===e.height){var c=new Yr;c.data=d;var p=this.getSize(t,c);a=p.width,s=p.height}var g=t.shape.activity;if("Activity"===t.shape.shape){g.subProcess;o=e.event,n=e.trigger}var u=new Yr;u.data=d,u.id=r+"_0_event",u.width=a,u.height=s,u.horizontalAlignment="Center",u.verticalAlignment="Center",u.relativeMode="Object",this.setStyle(u,t);var f=new Yr;f.data=d,f.id=r+"_1_event",f.style.gradient=t.style.gradient,f.horizontalAlignment="Center",f.verticalAlignment="Center",f.relativeMode="Object",f.style.strokeColor=t.style.strokeColor,f.style.opacity=t.style.opacity;var m=new Yr,y=cr(n);switch(m.data=y,m.id=r+"_2_trigger",m.horizontalAlignment="Center",m.verticalAlignment="Center",m.relativeMode="Object",m.style.strokeColor=t.style.strokeColor,m.style.opacity=t.style.opacity,o){case"Start":f.visible=!1;break;case"NonInterruptingStart":u.style.strokeDashArray="2 3",f.visible=!1;break;case"Intermediate":u.style.fill="white",u.style.gradient=null;break;case"NonInterruptingIntermediate":u.style.fill="white",u.style.gradient=null,u.style.strokeDashArray="2 3",f.style.strokeDashArray="2 3";break;case"ThrowingIntermediate":case"End":u.style.fill="End"!==o?"white":"black",u.style.gradient=null,m.style.fill="black",m.style.strokeColor=t.style.fill}return h.style.fill="transparent",h.style.strokeColor="transparent",h.style.strokeWidth=0,h.children=[u,f,m],this.setSizeForBPMNEvents(l,h,a,s),h},e.prototype.setEventVisibility=function(t,e){var i=t.shape.event.event,r=e[0],o=e[1];e[2];switch(i){case"Start":o.visible=!1;break;case"NonInterruptingStart":r.style.strokeDashArray="2 3",o.visible=!1}},e.prototype.setSubProcessVisibility=function(t){var e=t.shape.activity.subProcess,i=e.events.length,r="Transaction"===t.shape.activity.subProcess.type?2:0,o=t.wrapper.children[0].children[0];if(!1===e.adhoc&&(o.children[3+r+i].visible=!1),!1===e.compensation&&(o.children[4+r+i].visible=!1),i>0)for(var n=0;n<i;n++)this.setEventVisibility(t,o.children[2+n].children)},e.prototype.getBPMNSubProcessShape=function(e){var i,r,o,n=new Qr,a=new Yr,s=(new Qr,new Yr),h=e.shape.activity,d=h.subProcess,l=this.getSubprocessChildCount(e),c=new Ar;c.id=e.id+"_0_Subprocess",c.style.fill="transparent",c.cornerRadius=10;var p=this.getSize(e,c);c.width=p.width,c.height=p.height,n.children=[c],"Transaction"===h.subProcess.type&&this.getBPMNSubProcessTransaction(e,e.shape,n);var g=12*l,u=p.width/2;o=1===l?u-6:u-g/2-4*(l-1)/2,this.setStyle(c,e),0!=(e.constraints&t.NodeConstraints.Shadow)&&(n.shadow=e.shadow);var f=new Yr;if(f.id=e.id+"_0_collapsed",f.width=12,f.height=12,f.style.fill="black",f.margin.bottom=5,f.horizontalAlignment="Left",f.verticalAlignment="Bottom",f.setOffsetWithRespectToBounds(0,1,"Fraction"),f.relativeMode="Point",f.data=lr("collapsedShape"),f.margin.left=o,!0!==d.collapsed||d.processes?f.visible=!1:f.visible=!0,!0===f.visible&&(o+=18),n.children.push(f),"Event"===d.type){c.style.strokeWidth=1,c.style.strokeDashArray="2 2",i=d.events;for(var m=0;m<i.length;m++)r=i[m],this.getBPMNSubEvent(r,e,n)}s=this.getBPMNSubProcessLoopShape(e),1===l&&(o=u+8),s.margin.left=o,!0===s.visible&&(o+=16),n.children.push(s),c.id=e.id+"_boundary","Default"===d.boundary&&(c.style.strokeWidth=1,c.style.strokeDashArray="1 0"),"Call"===d.boundary&&(c.style.strokeWidth=4,c.style.strokeDashArray="1 0"),"Event"===d.boundary&&(c.style.strokeWidth=1,c.style.strokeDashArray="2 2"),a=this.getBPMNAdhocShape(e,a,d),1===l&&(o=u+8),a.margin.left=o,!0===a.visible&&(o+=16),n.children.push(a);var y=new Yr;return!0===d.compensation?y.visible=!0:y.visible=!1,y=this.getBPMNCompensationShape(e,y),1===l&&(o=u+8),y.margin.left=o,!0===y.visible&&(o+=16),n.children.push(y),n.style.strokeColor="transparent",n.style.strokeWidth=0,n.style.fill="transparent",n},e.prototype.getBPMNSubEvent=function(t,e,i,r){i.children=i.children||[];var o;o=this.getBPMNEventShape(e,t,!0,r),this.getBPMNSubprocessEvent(e,o,t),o.id=r||e.id+"_subprocessEvents",o.width=t.width||20,o.height=t.height||20,o.setOffsetWithRespectToBounds(t.offset.x,t.offset.y,"Fraction"),o.relativeMode="Point",o.margin=t.margin,o.horizontalAlignment=t.horizontalAlignment,o.verticalAlignment=t.verticalAlignment,o.style.fill="transparent",o.style.strokeColor="transparent",o.style.strokeWidth=0,i.children.push(o)},e.prototype.getBPMNSubProcessTransaction=function(t,e,i){var r=i.children[0].width,o=i.children[0].height,n=new Ar;n.margin={left:3,right:0,top:3,bottom:0},n.id=t.id+"_0_Subprocess_innnerRect",n.cornerRadius=10,n.width=r-6,n.height=o-6,i.children.push(n);var a=new Qr;a.id=t.id+"_transaction_events",a.style.gradient=t.style.gradient;var s=e.activity.subProcess.transaction;this.getBPMNSubEvent(s.success,t,a,t.id+"_success"),this.getBPMNSubEvent(s.cancel,t,a,t.id+"_cancel"),this.getBPMNSubEvent(s.failure,t,a,t.id+"_failure"),this.updateDiagramContainerVisibility(a.children[0],s.success.visible),this.updateDiagramContainerVisibility(a.children[1],s.cancel.visible),this.updateDiagramContainerVisibility(a.children[2],s.failure.visible),a.float=!0,a.width=r,a.height=o,a.style.fill=a.style.strokeColor="transparent",i.children.push(a)},e.prototype.getBPMNSubProcessLoopShape=function(t){var e,i,r=t.shape.activity,o=new Yr;return e=r.subProcess.loop,i=ur(e),o.visible="None"!==e,o.id=t.id+"_loop",o.data=i,o.style.fill="black",o.width=12,o.height=12,o.horizontalAlignment="Left",o.verticalAlignment="Bottom",o.setOffsetWithRespectToBounds(0,1,"Fraction"),o.relativeMode="Point",o.margin.bottom=5,o.style.fill="transparent",o},e.prototype.drag=function(t,e,i,r){var o=r.nameTable[t.processId];t.margin.top+i>=0&&r.nodePropertyChange(t,{},{margin:{top:t.margin.top+i}}),t.margin.left+e>=0&&r.nodePropertyChange(t,{},{margin:{left:t.margin.left+e}});var n=this.getChildrenBound(o,t.id,r);this.updateSubProcessess(n,t,r),o.wrapper.measure(new yr(void 0,void 0)),o.wrapper.arrange(o.wrapper.desiredSize),r.refreshCanvasLayers(),r.updateSelector(),this.updateDocks(t,r)},e.prototype.dropBPMNchild=function(t,e,i){if(e&&"Bpmn"===e.shape.type&&"TextAnnotation"!==e.shape.shape){var r=i.nameTable[t.id].shape.activity.subProcess;if(i.currentSymbol&&"Bpmn"===t.shape.type&&!r.collapsed)return void(e.processId=t.id);if(r.processes=r.processes||[],r.processes&&-1===r.processes.indexOf(e.id)&&!r.collapsed){r.processes.push(e.id);var o=Xi(e),n=i.nameTable[e.id].wrapper,a=i.nameTable[t.id].wrapper;n.margin.top=n.offsetY-n.actualSize.height/2-(t.offsetY-t.actualSize.height/2),n.margin.left=n.offsetX-n.actualSize.width/2-(t.offsetX-t.actualSize.width/2),n.margin.top=n.margin.top<0?0:n.margin.top,n.margin.left=n.margin.left<0?0:n.margin.left,i.nameTable[e.id].processId=t.id,a.children.push(i.nameTable[e.id].wrapper);var s=this.getChildrenBound(t,e.id,i);this.updateSubProcessess(s,e,i),a.measure(new yr(void 0,void 0)),a.arrange(a.desiredSize),i.refreshCanvasLayers(),i.updateSelector();for(var h=[],d=(h=h.concat(e.outEdges,e.inEdges)).length-1;d>=0;d--)-1===i.bpmnModule.textAnnotationConnectors.indexOf(i.nameTable[h[d]])&&i.remove(i.nameTable[h[d]]);var l={type:"PositionChanged",undoObject:{nodes:[o]},redoObject:{nodes:[Xi(e)]},category:"Internal"};i.addHistoryEntry(l),"SVG"===i.mode&&e.zIndex<t.zIndex&&i.updateProcesses(e),this.updateDocks(e,i)}}},e.prototype.updateDocks=function(t,e){if("Bpmn"===t.shape.type&&t.shape.activity.subProcess.processes&&!t.shape.activity.subProcess.collapsed)for(var i=0,r=t.shape.activity.subProcess.processes;i<r.length;i++){var o=r[i],n=e.nameTable[o];n&&(e.updateConnectorEdges(n),n.wrapper.measure(new yr(n.wrapper.width,n.wrapper.height)),n.wrapper.arrange(n.wrapper.desiredSize),n.shape.activity.subProcess.processes&&n.shape.activity.subProcess.processes.length&&this.updateDocks(n,e))}},e.prototype.removeBpmnProcesses=function(t,e){var i=e.nameTable[t.processId];if("Bpmn"===t.shape.type&&t.shape.activity.subProcess.processes&&t.shape.activity.subProcess.processes.length>0)for(var r=(o=t.shape.activity.subProcess.processes).length-1;r>=0;r--)e.remove(e.nameTable[o[r]]);if(i){e.removeDependentConnector(t);var o=i.shape.activity.subProcess.processes;this.removeChildFromBPMN(i.wrapper,t.id);var n=o.indexOf(t.id);o.splice(n,1)}},e.prototype.removeChildFromBPMN=function(t,e){for(var i=0,r=t.children;i<r.length;i++){var o=r[i];o.id===e?t.children.splice(t.children.indexOf(o),1):o.children&&this.removeChildFromBPMN(o,e)}},e.prototype.removeProcess=function(t,e){var i=e.nameTable[t];if(i){var r=e.nameTable[i.processId];if(r&&"Bpmn"===r.shape.type){var o=r.shape.activity.subProcess.processes;e.removeDependentConnector(i),this.removeChildFromBPMN(r.wrapper,t);var n=o.indexOf(t);o.splice(n,1),i.processId="",e.refreshDiagramLayer(),e.updateSelector()}}},e.prototype.addProcess=function(t,e,i){var r;t.id=t.id||Hi(),r=t.id;var o=i.nameTable[r];o||i.add(t),t.processId=e;var n=i.nameTable[e],a=n.shape.activity.subProcess;if(o&&n&&"Bpmn"===n.shape.type&&"Bpmn"===o.shape.type&&a.processes){o.processId=e;var s=n.shape.activity.subProcess.processes;if(s.indexOf(r)<0&&s.push(r),n.wrapper.children.push(o.wrapper),n.wrapper.measure(new yr),n.wrapper.arrange(n.wrapper.desiredSize),i.bpmnModule.updateDocks(n,i),i.refreshDiagramLayer(),"SVG"===i.mode&&o.shape&&o.shape.activity&&!o.shape.activity.subProcess.processes){wi(e+"_groupElement").appendChild(wi(t.id+"_groupElement"))}}},e.prototype.getChildrenBound=function(t,e,i){var r,o=t.shape.activity.subProcess.processes;if(o&&o.length)for(var n=0,a=o;n<a.length;n++){var s=a[n];e!==s&&(r=r?i.nameTable[s].wrapper.bounds.uniteRect(r):i.nameTable[s].wrapper.bounds)}return r||i.nameTable[e].wrapper.bounds},e.prototype.updateSubProcessess=function(t,e,i){var r,o,n,a,s=i.nameTable[e.processId],h={x:.5,y:.5};s.wrapper.bounds.left+e.margin.left+e.width>s.wrapper.bounds.right&&(n=!0),s.wrapper.bounds.top+e.margin.top+e.height>s.wrapper.bounds.bottom&&(a=!0),n&&(h.x=0),a&&(h.y=0);var d=s.wrapper.actualSize;n&&(r=(e.wrapper.margin.left+e.wrapper.bounds.width)/d.width),a&&(o=(e.wrapper.margin.top+e.wrapper.bounds.height)/d.height),(r>0||o>0)&&i.commandHandler.scale(i.nameTable[e.processId],r||1,o||1,h)},e.prototype.getBPMNCompensationShape=function(t,e){return e.id=t.id+"_0_compensation",e.width=12,e.height=12,e.margin.bottom=5,e.style.fill="transparent",e.horizontalAlignment="Left",e.verticalAlignment="Bottom",e.relativeMode="Object",e.data="M 22.462 18.754 l -6.79 3.92 l 6.79 3.92 V 22.89 l 6.415 3.705 v -7.841 l -6.415 3.705 V 18.754 Z M 28.331 19.701 v 5.947 l -5.149 -2.973 L 28.331 19.701 Z M 21.916 25.647 l -5.15 -2.973 l 5.15 -2.973 V 25.647 Z M 22.275 12.674 c -5.513 0 -9.999 4.486 -9.999 9.999 c 0 5.514 4.486 10.001 9.999 10.001 c 5.514 0 9.999 -4.486 9.999 -10.001 C 32.274 17.16 27.789 12.674 22.275 12.674 Z M 22.275 32.127  c -5.212 0 -9.453 -4.241 -9.453 -9.454 c 0 -5.212 4.241 -9.453 9.453 -9.453 c 5.212 0 9.453 4.241 9.453 9.453 C 31.728 27.887 27.487 32.127 22.275 32.127 Z",e},e.prototype.getBPMNActivityShape=function(t){var e,i=new Qr,r=t.shape.activity,o=r.activity,n=r.subProcess;r.activity;return"Task"===o&&(e=this.getBPMNTaskShape(t)),"SubProcess"===o&&n&&(e=this.getBPMNSubProcessShape(t)),i.children=[e],i.style.fill="transparent",i.style.strokeColor="transparent",i.style.strokeWidth=0,i},e.prototype.getBPMNSubprocessEvent=function(t,e,i){var r,o;if(0!==i.annotations.length)for(var n=0;n<i.annotations.length;n++){var a=i.annotations[n];(r=t.initAnnotationWrapper(a)).width=i.width,r.height=i.height,e.children.push(r)}if(0!==i.ports.length)for(n=0;n<i.ports.length;n++){var s=i.ports[n];o=t.initPortWrapper(s),e.children.push(o)}},e.prototype.getBPMNAdhocShape=function(t,e,i){return e.id=t.id+"_0_adhoc",e.width=12,e.height=8,e.style.fill="black",e.margin.bottom=5,e.horizontalAlignment="Left",e.verticalAlignment="Bottom",e.relativeMode="Object",e.data="M 49.832 76.811 v -2.906 c 0 0 0.466 -1.469 1.931 -1.5 c 1.465 -0.031 2.331 1.219 2.897 1.688 s 1.06 0.75 1.526 0.75 c 0.466 0 1.548 -0.521 1.682 -1.208 s 0.083 3.083 0.083 3.083 s -0.76 0.969 -1.859 0.969 c -1.066 0 -1.865 -0.625 -2.464 -1.438 s -1.359 -0.998 -2.064 -0.906 C 50.598 75.467 49.832 76.811 49.832 76.811 Z",i&&!0===i.adhoc?e.visible=!0:e.visible=!1,e},e.prototype.getBPMNTextAnnotation=function(e,i,r,o){r.id=r.id||Hi(),r.nodeId=e.id;var n=new Qr,a=new Yr,s=new Gr;a.id=e.id+"_"+r.id+"_path",a.width=r.width,a.height=r.height,a.relativeMode="Object",s.id=e.id+"_"+r.id+"_text",s.content=r.text;var h=e.style;s.style={fontSize:h.fontSize,italic:h.italic,gradient:null,opacity:h.opacity,bold:h.bold,textWrapping:h.textWrapping,color:h.color,fill:"white",fontFamily:h.fontFamily,whiteSpace:h.whiteSpace,textOverflow:"Wrap",strokeColor:"none",strokeWidth:0,strokeDashArray:h.strokeDashArray,textAlign:h.textAlign,textDecoration:h.textDecoration},s.horizontalAlignment="Center",s.verticalAlignment="Center",s.relativeMode="Object",s.margin={left:5,right:5,top:5,bottom:5},n.offsetX=e.offsetX+r.length*Math.cos(r.angle*(Math.PI/180)),n.offsetY=e.offsetY+r.length*Math.sin(r.angle*(Math.PI/180)),n.float=!0,n.transform=t.Transform.Self,n.id=e.id+"_textannotation_"+r.id,n.style.strokeColor="transparent",n.margin={left:10,right:10,top:10,bottom:10},n.relativeMode="Object",n.rotateAngle=0,n.children=[a,s];var d=new En(e.shape,"annotations",{id:n.id,shape:{type:"Bpmn",shape:"TextAnnotation"}},!0);d.ports=[{id:a.id+"_port",shape:"Square",offset:{x:0,y:.5}}],d.offsetX=n.offsetX,d.offsetY=n.offsetY,d.text=r.text,d.angle=r.angle,d.length=r.length,d.width=r.width,d.height=r.height,d.wrapper=n,n.children.push(d.initPortWrapper(d.ports[0]));var l=new xr(0,0,0,0),c=e.width||e.minWidth||0,p=e.height||e.minHeight||0;void 0!==c&&void 0!==p&&(l=new xr(e.offsetX-c/2,e.offsetY-p/2,c,p)),this.setAnnotationPath(l,n,{x:d.offsetX,y:d.offsetY},d,r.length,r.angle);var g={id:e.id+"_"+r.id+"_connector",constraints:t.ConnectorConstraints.Default&~(t.ConnectorConstraints.DragTargetEnd|t.ConnectorConstraints.Drag),sourceID:e.id,targetID:n.id,targetDecorator:{shape:"None"}},u=new Wo(e.shape,"annotations",g,!0);u.targetPortID=d.ports[0].id,u.init(i),u.wrapper.float=!1,u.wrapper.transform=t.Transform.Self,o.children.push(u.wrapper),u.zIndex=1e4;var f=this.annotationObjects[e.id];f||(f={}),f[r.id]||(f[r.id]={});return f[r.id].node=d,f[r.id].connector=u,this.annotationObjects[e.id]=f,i.initObject(d,void 0,!1),d.zIndex=1e4,n},e.prototype.renderBPMNTextAnnotation=function(t,e,i){e.id=e.id||Hi();var r=new Qr,o=new Yr,n=new Gr;o.id="_"+e.id+"_path",o.width=e.width,o.height=e.height,o.relativeMode="Object",n.id=e.id+"_text",n.content=e.shape.annotation.text;var a=e.style;n.style={fontSize:a.fontSize,italic:a.italic,gradient:null,opacity:a.opacity,bold:a.bold,textWrapping:a.textWrapping,color:a.color,fill:"white",fontFamily:a.fontFamily,whiteSpace:a.whiteSpace,textOverflow:"Wrap",strokeColor:"none",strokeWidth:0,strokeDashArray:a.strokeDashArray,textAlign:a.textAlign,textDecoration:a.textDecoration},n.horizontalAlignment="Left",n.verticalAlignment="Center",n.relativeMode="Object",n.margin={left:5,right:5,top:5,bottom:5},r.offsetX=e.offsetX+e.shape.annotation.length*Math.cos(e.shape.annotation.angle*(Math.PI/180)),r.offsetY=e.offsetY+e.shape.annotation.length*Math.sin(e.shape.annotation.angle*(Math.PI/180)),r.float=!0,r.id=e.id+"_textannotation_"+e.id,r.style.strokeColor="transparent",r.margin={left:10,right:10,top:10,bottom:10},r.relativeMode="Object",r.rotateAngle=0,r.children=[o,n];var s=new En(e.shape,"annotations",{id:r.id,shape:{type:"Bpmn",shape:"TextAnnotation"}},!0);s.ports=[{id:o.id+"_port",shape:"Square",offset:{x:0,y:.5}}],s.offsetX=r.offsetX,s.offsetY=r.offsetY,s.shape&&s.shape.annotation&&(s.text=e.shape.annotation.text,s.angle=e.shape.annotation.angle,s.length=e.shape.annotation.length),s.width=e.width,s.height=e.height,s.wrapper=r,r.children.push(s.initPortWrapper(s.ports[0]));var h=new xr(0,0,0,0),d=e.width||0,l=e.height||0;return void 0!==d&&void 0!==l&&(h=new xr(e.offsetX-d/2,e.offsetY-l/2,d,l)),this.setAnnotationPath(h,r,{x:s.offsetX,y:s.offsetY},s,e.length,e.angle),r},e.prototype.getTextAnnotationWrapper=function(t,e){if(t&&"Bpmn"===t.shape.type){if("TextAnnotation"===t.shape.shape)return t.wrapper.children[1];if(this.annotationObjects[t.id]&&this.annotationObjects[t.id][e]){var i=this.annotationObjects[t.id][e].node;return this.getTextAnnotationWrapper(i,e)}}return null},e.prototype.addAnnotation=function(t,e,i){var r=t.wrapper.children[0],o=t.shape;e.nodeId=t.id;var n=new wn(o,"annotations",e,!0);return o.annotations.push(n),r.children.push(this.getBPMNTextAnnotation(t,i,e,r)),t.wrapper.measure(new yr),t.wrapper.arrange(t.wrapper.desiredSize),this.annotationObjects[t.id][e.id].connector},e.prototype.clearAnnotations=function(t,e){var i=t.shape;if(i.annotations.length)for(var r=i.annotations.length-1;r>=0;r--){var o=i.annotations[r];this.removeAnnotationObjects(t,o,e)}delete this.annotationObjects[t.id]},e.prototype.checkAndRemoveAnnotations=function(t,e){if("Bpmn"===t.shape.type)if("TextAnnotation"===t.shape.shape)for(var i=t.id.split("_"),r=i[i.length-1],o=i[i.length-3]||i[0],n=e.nameTable[o],a=n.shape,s=0,h=a.annotations;s<h.length;s++){var d=h[s];if(d.id===r){if(-1!==a.annotations.indexOf(d))return e.removeDependentConnector(t),this.removeAnnotationObjects(n,d,e),!0}}else t.shape.annotations&&t.shape.annotations.length&&this.clearAnnotations(t,e);return!1},e.prototype.removeAnnotationObjects=function(e,i,r){var o=e.shape,n=o.annotations.indexOf(i);if(-1!==n){if(!(r.diagramActions&t.DiagramAction.UndoRedo||r.diagramActions&t.DiagramAction.Group)){var a={type:"CollectionChanged",changeType:"Remove",undoObject:Xi(i),redoObject:Xi(i),category:"Internal"};r.addHistoryEntry(a)}o.annotations.splice(n,1);var s=this.annotationObjects[e.id];if(s&&s[i.id]){var h=s[i.id].node,d=s[i.id].connector;r.removeElements(h),r.removeElements(d);var l=e.wrapper.children[0];n=l.children.indexOf(h.wrapper),l.children.splice(n,1),n=l.children.indexOf(d.wrapper),l.children.splice(n,1),r.removeFromAQuad(h),r.removeFromAQuad(d),delete r.nameTable[h.id],delete r.nameTable[d.id],delete s[i.id]}}},e.prototype.setAnnotationPath=function(t,e,i,r,o,n){var a=this.getAnnotationPathAngle(i,t),s="",h=e.children[0],d=e.children[2],l=e.children[1];h.horizontalAlignment="Stretch",h.verticalAlignment="Stretch",l.margin.left=l.margin.right=5,l.margin.top=l.margin.bottom=5;var c,p;0===a?(s="M10,20 L0,20 L0,0 L10,0",h.width=10,h.horizontalAlignment="Left",d.setOffsetWithRespectToBounds(0,.5,"Fraction"),l.margin.top=l.margin.bottom=10,c=t.middleRight,p={x1:t.right,y1:t.top,x2:t.right,y2:t.bottom}):180===a?(s="M0,0 L10,0 L10,20 L0,20",h.width=10,h.horizontalAlignment="Right",d.setOffsetWithRespectToBounds(1,.5,"Fraction"),l.margin.top=l.margin.bottom=10,c=t.middleLeft,p={x1:t.left,y1:t.top,x2:t.left,y2:t.bottom}):90===a?(s="M20,10 L20,0 L0,0 L0,10",h.height=10,h.verticalAlignment="Top",d.setOffsetWithRespectToBounds(.5,0,"Fraction"),l.margin.left=l.margin.right=10,c=t.bottomCenter,p={x1:t.right,y1:t.bottom,x2:t.left,y2:t.bottom}):(s="M0,0 L0,10 L20,10 L20,0",h.height=10,h.verticalAlignment="Bottom",d.setOffsetWithRespectToBounds(.5,1,"Fraction"),l.margin.left=l.margin.right=10,c=t.topCenter,p={x1:t.right,y1:t.top,x2:t.left,y2:t.top});var g=t.center;c=ot(p,[g,wr.transform(i,n,Math.max(t.width,t.height))],0,g),h.data=s,void 0!==o&&void 0!==n&&(c=wr.transform(c,n,o),e.offsetX=r.offsetX=c.x,e.offsetY=r.offsetY=c.y)},e.prototype.isBpmnTextAnnotation=function(t,e){if(this.annotationObjects){var i=t.parentId,r=t.id,o=e.nameTable[i];return o&&"Bpmn"===o.shape.type&&this.annotationObjects[i]&&this.annotationObjects[i][r]?o:null}return null},e.prototype.updateTextAnnotationContent=function(t,e,i,r){var o=e.parentId,n=e.id;if(this.annotationObjects[o]&&this.annotationObjects[o][n])for(var a=0,s=t.shape.annotations;a<s.length;a++){var h=s[a];if(h.id===n){h.text=i;var d=this.annotationObjects[o][n].node.wrapper.children[1];d.content=i,d.visible=!0,t.wrapper.measure(new yr),t.wrapper.arrange(t.wrapper.desiredSize)}}},e.prototype.updateQuad=function(t,e){var i,r=t.shape.annotations;if(r&&r.length>0)for(var o=0;o<r.length;o++)i=this.annotationObjects[t.id][r[o].id].node,e.updateQuad(i)},e.prototype.updateTextAnnotationProp=function(t,e,i){if("Bpmn"===t.shape.type){var r=t.shape.annotations;if(r&&r.length>0)for(var o=0;o<t.wrapper.children[0].children.length;o++)for(var n=0;n<r.length;n++){var a=t.wrapper.children[0].children[o].id.split("_");if(a[a.length-1]===r[n].id){var s=this.annotationObjects[t.id][r[n].id].node,h=this.annotationObjects[t.id][r[n].id].connector,d=(gt(h.targetPoint,t.wrapper.bounds,t.wrapper.bounds),h.sourcePoint);d={x:h.sourcePoint.x+t.offsetX-e.offsetX,y:h.sourcePoint.y+t.offsetY-e.offsetY},d=wr.transform(d,r[n].angle,r[n].length),t.wrapper.children[0].children[o].offsetX=s.offsetX=d.x,t.wrapper.children[0].children[o].offsetY=s.offsetY=d.y,i.updateQuad(s)}}}},e.prototype.getSubprocessChildCount=function(t){var e,i=0,r=t.shape.activity.subProcess;return void 0!==(e=r.loop)&&"None"!==e&&i++,void 0!==r.compensation&&!0===r.compensation&&i++,void 0!==r.collapsed&&!0===r.collapsed&&i++,void 0!==r.adhoc&&!0===r.adhoc&&i++,i},e.prototype.getTaskChildCount=function(t){var e=0,i=t.shape.activity.task;return void 0!==i.compensation&&!0===i.compensation&&e++,void 0!==i.loop&&"None"!==i.loop&&e++,e},e.prototype.setStyle=function(e,i){e.style.fill=i.style.fill,e.style.strokeColor=i.style.strokeColor,e.style.strokeWidth=i.style.strokeWidth,e.style.strokeDashArray=i.style.strokeDashArray,e.style.opacity=i.style.opacity,e.style.gradient=i.style.gradient,0!=(i.constraints&t.NodeConstraints.Shadow)&&(e.shadow=i.shadow)},e.prototype.updateBPMN=function(t,e,i,r){var o=t.shape||{},n=i.wrapper.children[0],a=i.shape.shape,s=void 0!==t.width||void 0!==t.height;if("Gateway"===o.shape&&o.gateway)i.wrapper.children[0]=this.getBPMNGatewayShape(i);else if("DataObject"===o.shape&&o.dataObject)i.wrapper.children[0]=this.getBPMNDataObjectShape(i);else if("Activity"===o.shape&&o.activity)i.wrapper.children[0]=this.getBPMNActivityShape(i);else if("Event"===o.shape&&o.event){var h=o.event;i.wrapper.children[0]=this.getBPMNEventShape(i,h)}else"Message"===o.shape||"DataSource"===o.shape?i.wrapper.children[0]=this.getBPMNShapes(i):void 0!==o.gateway||"Gateway"===a&&s?this.updateBPMNGateway(i,t):void 0!==o.dataObject||"DataObject"===a&&s?this.updateBPMNDataObject(i,t,e):void 0!==o.activity||"Activity"===a&&s?this.updateBPMNActivity(i,t,e,r):(void 0!==o.event||"Event"===a&&s)&&this.updateBPMNEvent(i,t,e);t.style&&Xe(t.style,n instanceof _r?"Activity"===i.shape.shape?n.children[0].children[0]:n.children[0]:n)},e.prototype.updateBPMNGateway=function(t,e){var i=t.shape,r=t.wrapper.children[0];if(i){Xe(t.style,r.children[0]);var o=pr(i.gateway.type);r.children[1].data=o}void 0===e.width&&void 0===e.height||this.setSizeForBPMNGateway(t.shape.gateway,r,e.width||t.width,e.height||t.height)},e.prototype.updateBPMNDataObject=function(t,e,i){var r=e.shape,o=t.wrapper.children[0];if(r){var n=o.children[1],a=o.children[2];if(void 0!==e.style&&(Xe(e.style,o.children[0]),n.style.opacity=t.style.opacity,a.style.opacity=t.style.opacity),r.dataObject){switch(r.dataObject.type){case"None":n.visible=!1;break;case"Input":n.style.fill="white";break;case"Output":n.style.fill="black"}"None"===i.shape.dataObject.type&&(n.visible=!0),void 0!==e.shape.dataObject.collection&&(a.visible=r.dataObject.collection)}}void 0===e.width&&void 0===e.height||this.setSizeForBPMNDataObjects(t.shape.dataObject,o,e.width||t.width,e.height||t.height)},e.prototype.getEvent=function(t,e,i,r,o,n){switch(i){case"Start":o.visible=!1,r.style.strokeDashArray="",n.style.fill="white",n.style.strokeColor="black",r.style.fill="white";break;case"NonInterruptingStart":r.style.strokeDashArray="2 3",n.style.fill="white",r.style.fill="white",n.style.strokeColor="black",o.visible=!1;break;case"Intermediate":r.style.strokeDashArray="",r.style.fill="white",o.style.strokeDashArray="",r.style.gradient=null,n.style.fill="white",n.style.strokeColor="black",this.updateEventVisibility(e,o);break;case"NonInterruptingIntermediate":r.style.fill="white",r.style.gradient=null,n.style.fill="white",n.style.strokeColor="black",r.style.strokeDashArray="2 3",o.style.strokeDashArray="2 3",this.updateEventVisibility(e,o);break;case"ThrowingIntermediate":case"End":r.style.fill="End"!==i?"white":"black",r.style.strokeDashArray="",o.style.strokeDashArray="",r.style.gradient=null,n.style.fill="black",this.updateEventVisibility(e,o),n.style.strokeColor=t.style.fill}},e.prototype.updateEventVisibility=function(t,e){t.shape.activity&&t.shape.activity.subProcess&&t.shape.activity.subProcess.events&&void 0!==t.shape.activity.subProcess.events[0]&&void 0!==t.shape.activity.subProcess.events[0].event?"NonInterruptingStart"!==t.shape.activity.subProcess.events[0].event&&"Start"!==t.shape.activity.subProcess.events[0].event||(e.visible=!0):void 0!==t.shape.event&&("NonInterruptingStart"!==t.shape.event.event&&"Start"!==t.shape.event.event||(e.visible=!0))},e.prototype.updateBPMNEvent=function(t,e,i){var r=e.shape,o=t.wrapper.children[0];if(r){var n,a=o.children[0],s=o.children[1],h=o.children[2],d=void 0;void 0!==e.style&&(Xe(t.style,o.children[0]),void 0===e.style.opacity&&void 0===e.style.strokeColor||(s.style.opacity=t.style.opacity,s.style.strokeColor=t.style.strokeColor)),n=r.event.event,d=r.event.trigger,void 0!==n&&this.getEvent(t,i,n,a,s,h),void 0!==d&&this.updateBPMNEventTrigger(t,e)}void 0===e.width&&void 0===e.height||this.setSizeForBPMNEvents(t.shape.event,o,e.width||t.width,e.height||t.height)},e.prototype.updateBPMNEventTrigger=function(t,e){var i=t.shape,r=t.wrapper.children[0].children[2];!e.style||void 0===e.style.strokeColor&&void 0===e.style.opacity||Xe(t.style,r);var o=cr(i.event.trigger);r.data=o},e.prototype.updateBPMNActivity=function(t,e,i,r){var o=e.shape,n=t.wrapper.children[0],a=this.getSize(t,n.children[0].children[0]);if(o){var s=i.shape.activity.activity,h=t.shape.activity.activity;if("SubProcess"!==s&&"Task"!==s||"SubProcess"!==h&&"Task"!==h){if("Task"===h&&void 0!==o.activity.task){this.updateBPMNActivityTask(t,e);var d=this.getTaskChildCount(t),l=void 0,c=12*d,p=a.width/2-c;l=1===d?p+8:p+8*(d-1),void 0!==o.activity.task.loop&&this.updateBPMNActivityTaskLoop(t,e,l,d,p,2)}"SubProcess"===h&&void 0!==o.activity.subProcess&&this.updateBPMNActivitySubProcess(t,e,i,r)}else r.removeElements(t),t.wrapper.children[0]=this.getBPMNActivityShape(t);this.setSizeForBPMNActivity(t.shape.activity,n,e.width||a.width,e.height||a.height,t)}void 0===e.width&&void 0===e.height||this.setSizeForBPMNActivity(t.shape.activity,n,e.width||a.width,e.height||a.height,t)},e.prototype.updateBPMNActivityTask=function(t,e){var i=e.shape,r=t.wrapper.children[0].children[0],o=i.activity.task;if("Receive"===o.type||"Send"===o.type?r.children[1].height=14:r.children[1].height=20,void 0!==o.type){var n=gr(o.type);r.children[1].data=n}void 0!==i.activity.task.call&&(!1!==i.activity.task.call?r.children[0].style.strokeWidth=4:r.children[0].style.strokeWidth=1),void 0!==i.activity.task.compensation&&(!0===i.activity.task.compensation?r.children[3].visible=!0:r.children[3].visible=!1)},e.prototype.updateBPMNActivityTaskLoop=function(t,e,i,r,o,n){var a,s,h=e.shape,d=t.wrapper.children[0].children[0],l=h.activity,c=0;if(void 0!==l.subProcess){var p=l.subProcess;c="Transaction"===l.subProcess.type?2:0,s=ur(a=p.loop),d.children[2+c].data=s,d.children[2+c].visible="None"!==a}else void 0!==l.task&&void 0!==l.task.loop&&(s=ur(l.task.loop),d.children[2].data=s,d.children[2].visible="None"!==l.task.loop);this.updateChildMargin(d,r,o,i,n+c)},e.prototype.updateChildMargin=function(t,e,i,r,o){if(1===e)for(var n=o;n<t.children.length;n++)2!==n&&!0===t.children[n].visible&&(t.children[n].margin.left=r,r=i+8);else{r=i+8*(e-1);for(n=o;n<t.children.length;n++)2!==n&&!0===t.children[n].visible&&(t.children[n].margin.left=r,r+=20)}},e.prototype.updateBPMNActivitySubProcess=function(t,e,i,r){var o,n=e.shape,a=t.wrapper.children[0],s=this.getSize(t,a.children[0].children[0]),h=n.activity.subProcess,d=this.getSubprocessChildCount(t),l=12*d,c=s.width/2-l;o=1===d?c+8:c+8*(d-1),Xe(t.style,a.children[0].children[0]),void 0!==h.events&&this.updateBPMNSubProcessEvent(t,e,i,r),void 0!==h.adhoc&&this.updateBPMNSubProcessAdhoc(t,i,h,o,d,c),void 0!==h.boundary&&this.updateBPMNSubProcessBoundary(t,h),void 0!==h.collapsed&&this.updateBPMNSubProcessCollapsed(t,i,h,o,d,c,r),void 0!==h.compensation&&this.updateBPMNSubProcessCompensation(t,i,h,o,d,c),void 0!==h.loop&&this.updateBPMNSubProcessLoop(t,i,h,o,d,c),void 0!==h.transaction&&this.updateBPMNSubProcessTransaction(t,e,i,r)},e.prototype.updateBPMNSubProcessEvent=function(t,e,i,r){for(var o=e.shape,n=t.wrapper.children[0],a=n.children[0],s=(n.children[0].children.length,o.activity.subProcess),h=0,d=Object.keys(s.events);h<d.length;h++){var l=d[h],c=Number(l),p=a.children[c+2],g=t.shape.activity.subProcess.events[c];this.updateBPMNSubEvent(t,s.events[c],g,p,e,i,r)}},e.prototype.updateBPMNSubEvent=function(t,e,i,r,o,n,a){var s,h,d=t.wrapper.children[0],l=o.shape,c=r.children[0],p=r.children[1],g=r.children[2];if(o.style&&(void 0===o.style.strokeColor&&void 0===o.style.opacity||(d.children[0].children[1].style.strokeColor=o.style.strokeColor,d.children[0].children[1].style.opacity=o.style.opacity)),void 0!==l.activity.subProcess&&(s=e.event,h=e.trigger),void 0!==s&&this.getEvent(o,n,s,c,p,g),void 0!==h){o.style&&Xe(o.style,d.children[0]);var u=cr(h);r.children[2].data=u}if(void 0===e.height&&void 0===e.width||this.getEventSize(e,r),void 0!==e.id&&(r.id=e.id),void 0!==e.margin&&(r.margin=e.margin),void 0!==e.horizontalAlignment&&(r.horizontalAlignment=e.horizontalAlignment),void 0!==e.verticalAlignment&&(r.verticalAlignment=e.verticalAlignment),void 0!==e.offset&&(r.setOffsetWithRespectToBounds(i.offset.x,i.offset.y,"Fraction"),r.relativeMode="Point"),void 0!==e.annotations){var f=void 0,m=d.children[0].children[2];r.children[3]&&r.children.length>3&&(f=r.children[3],a.updateAnnotation(e.annotations[0],f,m))}if(void 0!==e.ports){var y=void 0,v=d.children[0].children[2];r.children[4]&&r.children.length>4&&(y=r.children[4],a.updatePort(e.ports[0],y,v))}void 0!==e.visible&&this.updateDiagramContainerVisibility(r,e.visible)},e.prototype.updateBPMNSubProcessTransaction=function(t,e,i,r){var o,n=e.shape.activity.subProcess.transaction,a=t.wrapper.children[0].children[0].children[2];void 0!==n.success&&(o=t.shape.activity.subProcess.transaction.success,this.updateBPMNSubEvent(t,n.success,o,a.children[0],e,i,r)),void 0!==n.cancel&&(o=t.shape.activity.subProcess.transaction.cancel,this.updateBPMNSubEvent(t,n.cancel,o,a.children[1],e,i,r)),void 0!==n.failure&&(o=t.shape.activity.subProcess.transaction.failure,this.updateBPMNSubEvent(t,n.failure,o,a.children[2],e,i,r));for(var s=0,h=t.outEdges;s<h.length;s++){var d=h[s],l=r.nameTable[d];switch(l.sourcePortID){case"success":n.success&&void 0!==n.success.visible&&r.connectorPropertyChange(l,{},{sourcePortID:"success"});break;case"cancel":n.cancel&&void 0!==n.cancel.visible&&r.connectorPropertyChange(l,{},{sourcePortID:"cancel"});break;case"failure":n.failure&&void 0!==n.failure.visible&&r.connectorPropertyChange(l,{},{sourcePortID:"failure"})}}},e.prototype.getEventSize=function(t,e){void 0!==t.height&&(e.height=t.height,e.children[0].height=t.height,e.children[1].height=.85*t.height,e.children[2].height=.54*t.height),void 0!==t.width&&(e.width=t.width,e.children[0].width=t.width,e.children[1].width=.85*t.width,e.children[2].width=.54*t.width)},e.prototype.updateBPMNSubProcessAdhoc=function(t,e,i,r,o,n){t.shape;var a=t.wrapper.children[0].children[0],s="Transaction"===t.shape.activity.subProcess.type?2:0;!1===i.adhoc?a.children[3+s].visible=!1:a.children[3+s].visible=!0,this.updateChildMargin(a,o,n,r,3+s)},e.prototype.updateBPMNSubProcessBoundary=function(t,e){t.shape;var i=t.wrapper.children[0].children[0].children[0];"Default"===e.boundary&&(i.style.strokeWidth=1,i.style.strokeDashArray="1 0"),"Call"===e.boundary&&(i.style.strokeWidth=4,i.style.strokeDashArray="1 0"),"Event"===e.boundary&&(i.style.strokeWidth=1,i.style.strokeDashArray="2 2")},e.prototype.updateElementVisibility=function(t,e,i){if(t.shape.activity.subProcess.processes&&t.shape.activity.subProcess.processes.length>0)for(var r=t.shape.activity.subProcess.processes,o=r.length-1;o>=0;o--){var n=i.nameTable[r[o]];n.visible=e,i.updateElementVisibility(n.wrapper,n,e),e&&("Event"===n.shape.shape&&this.setEventVisibility(n,n.wrapper.children[0].children),"SubProcess"===n.shape.activity.activity&&this.setSubProcessVisibility(n));for(var a=n.inEdges.concat(n.outEdges),s=a.length-1;s>=0;s--){var h=i.nameTable[a[s]];h.visible=e,i.updateElementVisibility(h.wrapper,h,e)}}e&&("Event"===t.shape.shape&&this.setEventVisibility(t,t.wrapper.children[0].children),"SubProcess"===t.shape.activity.activity&&this.setSubProcessVisibility(t),"Task"===t.shape.activity.activity&&"Activity"===t.shape.shape&&"None"===t.shape.activity.subProcess.loop&&(t.wrapper.children[0].children[0].children[3].visible=!1))},e.prototype.updateBPMNSubProcessCollapsed=function(t,e,i,r,o,n,a){var s=t.shape.activity.subProcess.events.length,h=t.wrapper.children[0].children[0],d="Transaction"===t.shape.activity.subProcess.type?3:1;!1===i.collapsed?(this.updateElementVisibility(t,!0,a),h.children[d+s].visible=!1):(this.updateElementVisibility(t,!1,a),h.children[d+s].visible=!0),this.updateChildMargin(h,o,n,r,3+s)},e.prototype.updateBPMNSubProcessCompensation=function(t,e,i,r,o,n){var a=t.wrapper.children[0].children[0],s="Transaction"===t.shape.activity.subProcess.type?2:0;!1===i.compensation?a.children[4+s].visible=!1:a.children[4+s].visible=!0,this.updateChildMargin(a,o,n,r,4+s)},e.prototype.updateBPMNSubProcessLoop=function(t,e,i,r,o,n){this.updateBPMNActivityTaskLoop(t,t,r,o,n,1)},e.prototype.updateBPMNConnector=function(t,e,i,r){var o=i.shape;return void 0!==o.sequence&&(t=this.getSequence(t,e,i,r)),void 0!==o.association&&(t=this.getAssociation(t,e,i,r)),void 0!==o.message&&(t=this.getMessage(t,e,i,r)),t},e.prototype.getSequence=function(e,i,r,o){if("Normal"===r.shape.sequence&&(o.connectorPropertyChange(e,i,{type:"Straight",targetDecorator:{shape:"Arrow",style:{fill:"black"}}}),e.wrapper.children[3].visible=!1),"Default"===r.shape.sequence){o.connectorPropertyChange(e,i,{type:"Straight",targetDecorator:{shape:"Arrow",style:{fill:"black"}},sourceDecorator:{shape:"None"}});var n=new Yr,a=(new Yr,void 0);n=e.getSegmentElement(e,n);for(var s=e.intermediatePoints,h=0;h<s.length-1;h++)length+=e.distance(s[h],s[h+1]),a=e.findPath(s[h],s[h+1]);e.wrapper.children[3].data=a[0],e.wrapper.children[3].id=e.id+"_"+r.shape.sequence,e.wrapper.children[3].offsetX=a[1].x,e.wrapper.children[3].offsetY=a[1].y,e.wrapper.children[3].rotateAngle=45,e.wrapper.children[3].transform=t.Transform.Self}return"Conditional"===r.shape.sequence&&(o.connectorPropertyChange(e,i,{type:"Straight",targetDecorator:{shape:"Arrow",style:{fill:"black"}},sourceDecorator:{shape:"Diamond",width:20,height:10,style:{fill:"white"}}}),e.wrapper.children[3].visible=!1),e},e.prototype.getAssociation=function(t,e,i,r){return"Default"===i.shape.association&&r.connectorPropertyChange(t,e,{type:"Straight",style:{strokeDashArray:"None"},targetDecorator:{shape:"Arrow",style:{fill:"black"}},sourceDecorator:{shape:"None"}}),"Directional"===i.shape.association&&r.connectorPropertyChange(t,e,{type:"Straight",style:{strokeDashArray:"2 2"},targetDecorator:{shape:"Arrow",style:{fill:"black"}},sourceDecorator:{shape:"None"}}),"BiDirectional"===i.shape.association&&r.connectorPropertyChange(t,e,{type:"Straight",style:{strokeDashArray:"2 2"},targetDecorator:{shape:"Arrow",style:{fill:"black"}},sourceDecorator:{shape:"Arrow",width:5,height:10,style:{fill:"white"}}}),t},e.prototype.getMessage=function(e,i,r,o){var n,a;if("Default"===i.shape.message){if(void 0!==r.shape.message){if("InitiatingMessage"===r.shape.message||"NonInitiatingMessage"===r.shape.message){var s=new Yr;s=e.getSegmentElement(e,s);for(var h=e.intermediatePoints,d=0;d<h.length-1;d++){length+=e.distance(h[d],h[d+1]);var l=.5*length;length>=l&&(n=$(h[d],h[d+1]),a=wr.transform(h[d],n,l))}}e.wrapper.children[3].id=e.id+"_"+r.shape.message,e.wrapper.children[3].width=25,e.wrapper.children[3].height=15,e.wrapper.children[3].data="M0,0 L19.8,12.8 L40,0 L0, 0 L0, 25.5 L40, 25.5 L 40, 0",e.wrapper.children[3].horizontalAlignment="Center",e.wrapper.children[3].verticalAlignment="Center",e.wrapper.children[3].transform=t.Transform.Self,e.wrapper.children[3].style.fill="NonInitiatingMessage"===r.shape.message?"lightgrey":"white",e.wrapper.children[3].offsetX=a.x,e.wrapper.children[3].offsetY=a.y}}else"NonInitiatingMessage"===i.shape.message&&"InitiatingMessage"===i.shape.message||("Default"!==r.shape.message?e.wrapper.children[3].style.fill="NonInitiatingMessage"===r.shape.message?"lightgrey":"white":e.wrapper.children[3].visible=!1);return e},e.prototype.setSizeForBPMNEvents=function(t,e,i,r){e.children[0].width=i,e.children[0].height=r;var o=e.children[1];o.width=.85*i,o.height=.85*r;var n=e.children[2];"Message"===t.trigger?(n.width=.54*i,n.height=.4*r):(n.width=.5*i,n.height=.5*r)},e.prototype.updateAnnotationDrag=function(t,e,i,r){var o=t.id.split("_");if("textannotation"===o[1])for(var n=void 0,a=0;a<t.inEdges.length;a++){var s=e.nameTable[t.inEdges[a]];s&&(n=e.nameTable[s.sourceID]);var h={x:t.offsetX+i,y:t.offsetY+r},d=s.sourcePoint,l=wr.findLength(h,d),c=wr.findAngle(d,h);if(n.shape.annotations)for(var p=0;p<n.shape.annotations.length;p++)if(n.shape.annotations[p].id===o[o.length-1])return n.shape.annotations[p].length=l,n.shape.annotations[p].angle=c,this.setAnnotationPath(n.wrapper.bounds,t.wrapper,h,t),!1}return!!t.processId&&(this.drag(t,i,r,e),!0)},e.prototype.getAnnotationPathAngle=function(t,e){var i=0;switch(gt(t,e,e)){case"Right":i=0;break;case"Left":i=180;break;case"Bottom":i=90;break;case"Top":i=270}return i},e.prototype.setSizeForBPMNGateway=function(t,e,i,r){e.children[0].width=i,e.children[0].height=r,e.children[1].width=.45*i,e.children[1].height=.45*r},e.prototype.setSizeForBPMNDataObjects=function(t,e,i,r){e.children[0].width=i,e.children[0].height=r},e.prototype.setSizeForBPMNActivity=function(t,e,i,r,o){e.children[0].width=i,e.children[0].height=r,e.children[0].children[0].width=i,e.children[0].children[0].height=r,"Transaction"===t.subProcess.type&&(e.children[0].children[1].width=Math.max(i-6,1),e.children[0].children[1].height=Math.max(r-6,1),e.children[0].children[2].width=i,e.children[0].children[2].height=r);var n,a,s=new Ar,h=this.getSize(o,s),d=12*(a="Task"===t.activity?this.getTaskChildCount(o):this.getSubprocessChildCount(o)),l=(i||h.width)/2;n=1===a?l-6:l-d/2-4*(a-1)/2;for(var c=0;c<e.children[0].children.length;c++)e.children[0].children[c].visible&&(e.children[0].children[c].id.indexOf("_loop")>-1||e.children[0].children[c].id.indexOf("_0_compensation")>-1||e.children[0].children[c].id.indexOf("_0_adhoc")>-1||e.children[0].children[c].id.indexOf("_0_collapsed")>-1)&&(e.children[0].children[c].margin.left=n,n+=e.children[0].children[c].actualSize.width+4)},e.prototype.updateDiagramContainerVisibility=function(t,e){if(t instanceof _r)for(var i=0;i<t.children.length;i++)this.updateDiagramContainerVisibility(t.children[i],e);t.visible=e},e.prototype.destroy=function(){},e.prototype.getModuleName=function(){return"Bpmn"},e}(),rs={Event:"M80.5,12.5 C80.5,19.127417 62.59139,24.5 40.5,24.5 C18.40861,24.5 0.5,19.127417 0.5,12.5C0.5,5.872583 18.40861,0.5 40.5,0.5 C62.59139,0.5 80.5,5.872583 80.5,12.5 z",Message:"M0,0L19.8,12.8L40,0L0,0L0,25.5L40,25.5L40,0z",DataSource:"M 0 10.6 c 0 5.9 16.8 10.6 37.5 10.6 S 75 16.4 75 10.6 v 0 v 68.9 v -0.1 C 75 85.3 58.2 90 37.5 90 S 0 85.3 0 79.4 l 0 0.1 V 56 V 40.6 L 0 10.6 C 0 4.7 16.8 0 37.5 0 S 75 4.7 75 10.6 S 58.2 21.2 37.5 21.2S 0 16.5 0 10.6 l 0 6.7 v -0.2 c 0 5.9 16.8 10.6 37.5 10.6 S 75 22.9 75 17.1 v 6.8 v -0.1 c 0 5.9 -16.8 10.6 -37.5 10.6 S 0 29.6 0 23.8",SubProcess:"M100,100 h200 a20,20 0 0 1 20,20 v200 a20,20 0 0 1 -20,20 h-200 a20,20 0 0 1 -20,-20 v-200 a20,20 0 0 1 20,-20 z",collapsedShape:"M 8.13789 15 H 0 V 0 H 8.13789 V 15 Z M 0.625991 13.75 H 7.51189 V 1.25 H 0.625991 V 13.75 Z M 2.18095 7.03125 L 5.95631 7.03125 L 5.95631 7.46875 L 2.18095 7.46875 Z M 3.8342 3.73 L 4.30369 3.73 L 4.30369 11.2687 L 3.8342 11.2687 Z"},os={Message:"M0,0 L19.8,12.8 L40,0 L0, 0 L0, 25.5 L40, 25.5 L 40, 0",Timer:"M40,20c0,8.654-5.496,16.024-13.189,18.81C24.685,39.58,22.392,40,20,40C8.954,40,0,31.046,0,20S8.954,0,20,0S40,8.954,40,20z M20,0 L20,2.583 L20,5.283 M10.027,2.681L11.659,5.507 L12.669,7.257 M2.731,9.989 L6.014,11.885 L7.307,12.631 M0.067,19.967 L2.667,19.967 L5.35,19.967M2.748,29.939 L5.731,28.217 L7.323,27.298 M10.056,37.236 L11.292,35.095 L12.698,32.66 M20.033,39.9 L20.033,36.417 L20.033,34.617M30.006,37.219 L28.893,35.292 L27.364,32.643 M37.302,29.911 L34.608,28.355 L32.727,27.269M39.967,19.933 L37.417,19.933 L34.683,19.933 M37.286,9.961 L34.583,11.521 L32.71,12.602 M29.977,2.664 L28.653,4.957 L27.336,7.24 M22.104,8.5 L19.688,20 L24.75,20 L31.604,20 L24.75,20 L19.688,20z",Error:"M 23.77 18.527 l -7.107 27.396 l 8.507 -17.247 L 36.94 40.073 l 6.394 -25.997 l -8.497 15.754 L 23.77 18.527 Z",Escalation:"M 30.001 8.098 L 11.842 43.543 l 18.159 -18.882 l 18.162 18.882 L 30.001 8.098 Z ",Cancel:"M 3.5 16 L 0 12.6 L 4.6 8 L 0 3.5 L 3.4 0 L 8 4.6 l 4.5 -4.5 L 16 3.5 L 11.5 8 l 4.5 4.5 l -3.4 3.5 L 8 11.4 L 3.5 16 Z",Compensation:"M 25.7086 0 L 0 25 L 25.7086 50 V 26.3752 L 50 50 V 0 L 25.7086 23.6248 V 0 Z ",Conditional:"M 0 0 H 16 V 16 H 0 z M 1.14 3.2 H 14.85 M 1.14 6.4 H 14.85 M 1.14 9.6 H 14.85 M 1.14 12.8 H 14.85",Link:"M 32.014 19.258 v 5.992 H 9.373 v 9.504 h 22.641 v 5.988 L 50.622 30 L 32.014 19.258 Z",Signal:"M 50 50 H 0 L 25.0025 0 L 50 50 Z",Terminate:"M 25 50 C 11.21 50 0 38.79 0 25 C 0 11.21 11.21 0 25 0 C 38.78 0 50 11.21 50 25 C 50 38.79 38.78 50 25 50",Multiple:"M 17.784 48.889 H 42.21 l 7.548 -23.23 L 29.997 11.303 L 10.236 25.658 L 17.784 48.889 Z",Parallel:"M 27.276 49.986 h 5.58 v -17.15 h 17.146 V 27.17 h -17.15 l 0.004 -17.15 h -5.58 l -0.004 17.15 H 9.994 v 5.666 h 17.278 L 27.276 49.986 Z"},ns={None:"",Exclusive:"M 11.196 29.009 l 6.36 -9.712 l -5.764 -8.899 h 4.393 l 3.732 5.979 l 3.656 -5.979 h 4.354 l -5.789 9.039l 6.36 9.572 h -4.532 l -4.126 -6.437 l -4.139 6.437 H 11.196 Z",Inclusive:"M 20.323 31.333 c -6.625 0 -12.015 -5.39 -12.015 -12.015 s 5.39 -12.015 12.015 -12.015 s 12.016 5.39 12.016 12.015 S 26.948 31.333 20.323 31.333 Z M 20.323 9.303 c -5.522 0 -10.015 4.493 -10.015 10.015 s 4.492 10.015 10.015 10.015 s 10.016 -4.493 10.016 -10.015 S 25.846 9.303 20.323 9.303 Z",Parallel:"M 18.394 29.542 v -8.833 H 9.626 v -3.691 h 8.768 V 8.251 h 3.734 v 8.767 h 8.768 v 3.691 h -8.768 v 8.833 H 18.394 Z",Complex:"M29.198,19.063L23.089,19.063L27.794,14.358L26.38,12.944L21.223,18.101L21.223,10.443L19.223,10.443L19.223,17.976L14.022,12.776L12.608,14.19L17.48,19.063L10.365,19.063L10.365,21.063L18.261,21.063L12.392,26.932L13.806,28.346L19.223,22.929L19.223,30.225L21.223,30.225L21.223,22.805L25.925,27.507L27.339,26.093L22.309,21.063L29.198,21.063z",EventBased:"M 20.322 29.874 c -5.444 0 -9.873 -4.43 -9.873 -9.874 s 4.429 -9.874 9.873 -9.874 s 9.874 4.429 9.874 9.874 S 25.767 29.874 20.322 29.874 Z M 20.322 32.891 c -7.107 0 -12.89 -5.783 -12.89 -12.891 c 0 -7.107 5.782 -12.89 12.89 -12.89 c 7.108 0 12.891 5.783 12.891 12.89 C 33.213 27.108 27.431 32.891 20.322 32.891 Z M 24.191 25.386 h -7.984 l -2.469 -7.595 l 6.461 -4.693 l 6.461 4.693 L 24.191 25.386 Z",ExclusiveEventBased:"M 30 15 C 30 23.28 23.28 30 15 30 S 0 23.28 0 15 S 6.72 0 15 0 S 30 6.72 30 15 z M 15 5 L 5 12.5 L 8 22.5 H 22 L 25 12.5 z",ParallelEventBased:"M 35 17.5 C 35 27.16 27.16 35 17.5 35 S 0 27.16 0 17.5 S 7.84 0 17.5 0 S 35 7.84 35 17.5 z M 14.58 5.83 V 14.58 H 5.83 V 20.42 H 14.58 V 29.17 H 20.42 V 20.42 H 29.17 V 14.58 H 20.42 V 5.83 z"},as={None:"",Service:"M 32.699 20.187 v -4.005 h -3.32 c -0.125 -0.43 -0.292 -0.83 -0.488 -1.21 l 2.373 -2.375 l -2.833 -2.83 l -2.333 2.333 c -0.44 -0.253 -0.9 -0.448 -1.387 -0.595 v -3.32 h -4.003 v 3.32 c -0.46 0.137 -0.890.322 -1.3 0.537 l -2.285 -2.275 l -2.833 2.83 l 2.285 2.278 c -0.235 0.42 -0.41 0.847 -0.547 1.307 h -3.33 v 4.005 h 3.33 c 0.148 0.488 0.343 0.955 0.588 1.395 l -2.325 2.325 l 2.822 2.832 l 2.373 -2.382 c 0.392 0.205 0.792 0.37 1.212 0.497 v 3.33 h 4.003 v -3.33 c 0.46 -0.138 0.89 -0.323 1.3 -0.547 l 2.43 2.432 l 2.822 -2.832 l -2.42 -2.422 c 0.222 -0.41 0.4 -0.85 0.535-1.297 H 32.699 Z M 22.699 21.987 c -2.1 0 -3.803 -1.703 -3.803 -3.803 c 0 -2.1 1.703 -3.803 3.803 -3.803 c 2.1 0 3.803 1.703 3.803 3.803 C 26.502 20.285 24.8 21.987 22.699 21.987 Z",Receive:"M 12.217 12.134 v 13.334 h 20 V 12.134 H 12.217 Z M 30.44 13.007 l -8.223 5.35 l -8.223 -5.35 H 30.44 Z M 13.09 24.594 V 13.459 l 9.127 5.94 l 9.127 -5.94 v 11.135 H 13.09 Z",Send:"M 45.7256 3.16055 L 25 23.4017 L 4.27442 3.16055 H 45.7256 Z M 47.8963 46.8413 H 2.10375 V 4.80813 L 25 27.1709 L 47.8963 4.80813 V 46.8413 Z",InstantiatingReceive:"M 16.306 17.39 v 8.79 h 13.198 v -8.79 H 16.306 Z M 28.375 17.946 l -5.47 3.558 l -5.47 -3.558 H 28.375 Z M 28.948 25.625 H 16.861 v -7.389 l 6.043 3.931 l 6.043 -3.931 V 25.625 Z M 22.905 11.785c -5.514 0 -9.999 4.486 -9.999 10 c 0 5.514 4.485 10 9.999 10 s 9.999 -4.486 9.999 -10 C 32.904 16.272 28.419 11.785 22.905 11.785 Z M 22.905 31.239 c -5.212 0 -9.453 -4.241 -9.453 -9.454c 0 -5.212 4.241 -9.453 9.453 -9.453 s 9.452 4.241 9.452 9.453 C 32.357 26.998 28.117 31.239 22.905 31.239 Z",Manual:"M 13.183 15.325 h 2.911 c 0.105 0 0.207 -0.043 0.281 -0.117 c 0.078 -0.074 0.117 -0.176 0.117 -0.281c 0 -0.753 0.718 -1.362 1.596 -1.362 h 2.579 c -0.117 0.227 -0.191 0.48 -0.195 0.757 c 0 0.433 0.168 0.851 0.46 1.144 c 0.008 0.004 0.015 0.011 0.019 0.015 c -0.289 0.285 -0.475 0.691 -0.479 1.148 c 0 0.433 0.168 0.846 0.46 1.139 c 0.011 0.012 0.023 0.02 0.035 0.032 c -0.301 0.281 -0.491 0.694 -0.495 1.155 c 0 0.432 0.168 0.847 0.46 1.143c 0.265 0.266 0.612 0.414 0.975 0.414 h 0.839 c 0.027 0.004 0.051 0.012 0.074 0.012 h 8.443 c 0.352 0 0.636 0.344 0.636 0.761 c 0 0.414 -0.285 0.753 -0.636 0.753 h -6.687 c -0.019 0 -0.035 -0.008 -0.051 -0.008h -2.27 c -0.121 -0.835 -0.667 -1.187 -1.795 -1.187 h -2.158 c -0.223 0 -0.402 0.18 -0.402 0.403c 0 0.219 0.179 0.398 0.402 0.398 h 2.158 c 0.972 0 1.019 0.203 1.019 0.784 c 0 0.219 0.179 0.399 0.402 0.399 c 0.008 0 0.016 -0.004 0.027 -0.004 c 0.028 0.004 0.055 0.016 0.082 0.016 h 2.56 c 0.34 0.015 0.616 0.343 0.616 0.752c 0 0.418 -0.285 0.757 -0.636 0.761 h -0.004 h -6.442 c -0.878 0 -1.595 -0.639 -1.595 -1.427 v -0.683 c 0 -0.109 -0.043 -0.211 -0.114 -0.285 c -0.078 -0.074 -0.179 -0.117 -0.285 -0.117 h -0.004 l -2.989 0.027 c -0.223 0 -0.398 0.184 -0.398 0.402 c 0 0.219 0.179 0.395 0.398 0.395 h 0.004 l 2.591 -0.02 v 0.282 c 0 1.229 1.073 2.223 2.391 2.223 h 3.895 c 0.004 0 0.007 0.004 0.011 0.004 h 2.536 c 0.792 0 1.436 -0.698 1.436 -1.561 c 0 -0.273 -0.07 -0.53 -0.188 -0.752 h 5.49 c 0.792 0 1.436 -0.695 1.436 -1.553 c 0 -0.858 -0.644 -1.557 -1.436 -1.557h -3.566 c 0.121 -0.226 0.199 -0.487 0.199 -0.768 c 0 -0.468 -0.195 -0.882 -0.495 -1.167c 0.301 -0.285 0.495 -0.698 0.495 -1.163 c 0 -0.456 -0.191 -0.866 -0.483 -1.152 c 0.293 -0.285 0.483 -0.694 0.483 -1.151c 0 -0.858 -0.647 -1.557 -1.439 -1.557 h -8.373 c -1.167 0 -2.142 0.757 -2.352 1.76 l -2.548 -0.004 c -0.219 0 -0.399 0.18 -0.399 0.403 C 12.784 15.145 12.964 15.325 13.183 15.325 L 13.183 15.325 Z M 21.907 19.707 c -0.191 0 -0.328 -0.094 -0.41 -0.176 c -0.144 -0.145 -0.226 -0.355 -0.226 -0.577 c 0.003 -0.418 0.289 -0.753 0.643 -0.753 h 4.468 c 0.008 0 0.015 -0.004 0.027 -0.008 h 0.051 c 0.351 0 0.636 0.344 0.636 0.761 c 0 0.414 -0.286 0.753 -0.636 0.753 H 21.907 Z M 27.097 16.629 c 0 0.414 -0.286 0.753 -0.64 0.753 h -4.464 c -0.004 0 -0.004 0 -0.004 0 h -0.082c -0.191 0 -0.328 -0.098 -0.414 -0.18 c -0.14 -0.145 -0.222 -0.352 -0.222 -0.573 c 0 -0.413 0.285 -0.749 0.631 -0.753h 3.434 c 0 0 0 0 0.004 0 h 1.116 c 0.008 0 0.012 -0.004 0.02 -0.004 C 26.819 15.887 27.097 16.215 27.097 16.629L 27.097 16.629 Z M 27.097 14.322 c 0 0.41 -0.278 0.737 -0.62 0.749 c -0.008 0 -0.012 0 -0.016 0 h -3.637 c -0.008 0 -0.015 0.004 -0.023 0.004 h -0.886 c -0.004 0 -0.008 0 -0.012 0 c -0.187 0 -0.324 -0.094 -0.406 -0.176c -0.144 -0.144 -0.226 -0.355 -0.226 -0.577 c 0.003 -0.414 0.293 -0.753 0.643 -0.753 h 4.468 c 0.008 0 0.015 -0.004 0.027 -0.004 h 0.051 C 26.811 13.565 27.097 13.905 27.097 14.322 L 27.097 14.322 Z M 27.097 14.322",BusinessRule:"M 32.844 13.245 h -0.089 v 0 H 13.764 v -0.015 h -1.009 v 16.989 h 0.095 v 0.011 h 19.716 v -0.011 h 0.278 V 13.245 Z M 31.844 14.229 v 4.185 h -18.08 v -4.185 H 31.844 Z M 18.168 25.306 v 3.938 h -4.404 v -3.938 H 18.168 Z M 13.764 24.322 v -4.923 h 4.404 v 4.923 H 13.764 Z M 19.177 25.306 h 12.667 v 3.938 H 19.177 V 25.306 Z M 19.177 24.322v -4.923 h 12.667 v 4.923 H 19.177 Z",User:"M 21.762 21.935 c 2.584 0 4.687 -2.561 4.687 -5.703 c 0 -3.147 -2.103 -5.703 -4.687 -5.703 c -1.279 0 -2.475 0.61-3.363 1.721 c -0.855 1.071 -1.327 2.484 -1.324 3.983 C 17.075 19.374 19.178 21.935 21.762 21.935 L 21.762 21.935 ZM 21.762 11.779 c 1.894 0 3.436 1.995 3.436 4.452 c 0 2.453 -1.541 4.452 -3.436 4.452 c -1.895 0 -3.44 -1.999 -3.44 -4.452C 18.323 13.774 19.864 11.779 21.762 11.779 L 21.762 11.779 Z M 25.699 21.309 c -0.348 0 -0.626 0.277 -0.626 0.626 c 0 0.344 0.277 0.622 0.626 0.622 c 2.136 0 3.875 1.74 3.875 3.879 c 0 0.272 -0.227 0.498 -0.501 0.498 H 14.447 c -0.274 0 -0.497 -0.223 -0.497 -0.498 c 0 -2.139 1.736 -3.879 3.872 -3.879 c 0.344 0 0.625 -0.277 0.625 -0.622 c 0 -0.348 -0.28 -0.626-0.625 -0.626 c -2.826 0 -5.124 2.297 -5.124 5.126 c 0 0.965 0.784 1.749 1.748 1.749 h 14.626 c 0.964 0 1.748 -0.7841.748 -1.749 C 30.822 23.606 28.524 21.309 25.699 21.309 L 25.699 21.309 Z M 22.217 9.832 c 0.448 -0.263 0.924 -0.396 1.419 -0.396 c 1.895 0 3.436 1.995 3.436 4.452 c 0 0.439 -0.048 0.873 -0.143 1.284 c -0.08 0.336 0.128 0.672 0.464 0.751 c 0.048 0.012 0.098 0.019 0.143 0.019 c 0.284 0 0.541 -0.195 0.608 -0.483 c 0.119 -0.506 0.18 -1.034 0.18 -1.571c 0 -3.147 -2.102 -5.703 -4.687 -5.703 c -0.711 0 -1.419 0.198 -2.054 0.573 c -0.296 0.174 -0.397 0.559 -0.219 0.855C 21.536 9.911 21.921 10.009 22.217 9.832 L 22.217 9.832 Z M 27.697 18.81 c -0.345 0 -0.626 0.277 -0.626 0.622 c 0 0.348 0.281 0.626 0.626 0.626 c 2.137 0 3.75 1.782 3.75 3.918 c 0 0.07 -0.013 0.141 -0.043 0.205 c -0.14 0.314 0.0030.684 0.318 0.823 c 0.082 0.037 0.167 0.055 0.253 0.055 c 0.241 0 0.466 -0.141 0.57 -0.373 c 0.101 -0.226 0.153 -0.464 0.153-0.714 C 32.699 21.15 30.523 18.81 27.697 18.81 L 27.697 18.81 Z M 27.697 18.81",Script:"M 22.453 15.04 c 0 0 -1.194 -3.741 2.548 -3.774 c 0 0 2.497 0.126 1.766 4.321 c -0.008 0.043 -0.015 0.086 -0.024 0.13c -0.806 4.323 -2.516 8.42 -3.193 10.581 h 3.904 c 0 0 0.983 4.581 -2.549 4.968 H 13.292 c 0 0 -3.097 -1.42 -1.517 -5.323 l 3 -10.839 H 11.84 c 0 0 -1.129 -2.902 1.709 -3.806 l 11.425 -0.032 l -0.73 0.355 l -1.193 1.726 L 22.453 15.04 Z M 22.409 12.597 c 0 0 -0.242 0.483 -0.278 0.98 h -9.098 c 0 0 -0.06 -0.871 0.714 -1.041 L 22.409 12.597 Z M 26.341 27.734c 0 0 -0.13 2.678 -2.226 1.871 c 0 0 -0.823 -0.565 -0.758 -1.855 L 26.341 27.734 Z M 22.905 15.008 c 0 0 0.653 -0.258 0.709-1.501 c 0 0 0.145 -1.144 1.483 -0.693 c 0 0 0.808 0.355 0.259 2.404 c 0 0 -2.226 8.5 -3.032 10.339 c 0 0 -1.064 2.646 0.096 4.226 h -8.581 c 0 0 -1.806 -0.452 -0.741 -3.613 c 0 0 2.935 -9.549 3.193 -11.162 L 22.905 15.008 Z"},ss={None:"",Standard:"M 52.002 73.379 c -2.494 -2.536 -6.55 -2.534 -9.043 0 c -1.208 1.228 -1.874 2.861 -1.874 4.598 c 0 1.225 0.337 2.395 0.957 3.411 l -1.167 1.186 l 2.071 0.458 l 2.071 0.458 l -0.45 -2.106 l -0.45 -2.106 l -1.292 1.314c -1.119 -2.065 -0.842 -4.709 0.877 -6.458 c 2.084 -2.119 5.475 -2.117 7.557 0 c 2.083 2.119 2.083 5.565 0 7.685c -0.976 0.992 -2.272 1.557 -3.65 1.59 l 0.025 1.068 c 1.65 -0.041 3.2 -0.716 4.368 -1.903 c 1.208 -1.228 1.874 -2.861 1.874 -4.597 C 53.875 76.24 53.209 74.607 52.002 73.379 Z",ParallelMultiInstance:"M 51.5,69.5 L52.5,69.5 L52.5,84.5 L51.5 84.5 Z M 46.5,69.5 L47.5,69.5 L47.5,84.5 L46.5 84.5 Z M 41.5,69.5 L42.5,69.5 L42.5,84.5 L41.5 84.5 Z  ",SequenceMultiInstance:"M 40.375,71.5 L 55.375,71.5 L 55.375,72.5 L 40.375,72.5 Z M 40.375,76.5 L 55.375,76.5 L 55.375,77.5 L 40.375,77.5 Z M 40.375,76.5 L 55.375,76.5 L 55.375,77.5 L 40.375,77.5 Z M 40.375,81.5 L 55.375,81.5L 55.375,82.5 L 40.375,82.5 Z"},hs=function(){function e(){}return e.prototype.updateBridging=function(e,i){var r,o=[];if(e.bridges=[],function(e,i){return e.constraints&t.ConnectorConstraints.Bridging?e.constraints&t.ConnectorConstraints.Bridging:e.constraints&t.ConnectorConstraints.InheritBridging?i.constraints&t.DiagramConstraints.Bridging:0}(e,i)){var n=this.getPoints(e);r=xr.toBounds(n);for(var a=e.bridgeSpace,s=i.bridgeDirection,h=-1,d=i.connectors,l=0;l<d.length;l++){var c=d[l];if(e&&c&&e.id!==c.id){var p=this.getPoints(c),g=xr.toBounds(p);if(this.intersectsRect(r,g)){var u=this.intersect(n,p,!1,s,!0);if(u.length>0)for(var f=0;f<u.length;f++){var m=0,y=0,v=0,b=this.getLengthAtFractionPoint(e,u[f]);if(-1!==b.pointIndex){m=b.lengthFractionIndex,b.fullLength,y=b.segmentIndex,v=b.pointIndex;var w=this.getPointAtLength(m-a/2,n),x=this.getPointAtLength(m+a/2,n);this.isEmptyPoint(x)&&(x=w);var S=void 0,P=void 0;S=e.sourcePoint,P="Straight"===e.type?e.targetPoint:e.intermediatePoints[v];var C=this.angleCalculation(S,P);if(o.length){var T=void 0;T=e.sourcePoint;var A=Math.abs(this.lengthCalculation(T,x)),M=0,L=-1;h=-1;for(var O=0;O<o[y].bridges.length;O++){h++;var I=o[y].bridges[O];if(M=Math.abs(this.lengthCalculation(T,I.endPoint)),A<M){L=h;break}}if(L>=0){var E=void 0;(E=this.createSegment(w,x,C,s,v,e,i)).target=c.id,o[y].bridges.splice(L,0,E),o[y].bridges.join(),o[y].bridgeStartPoint.splice(L,0,w),o[y].bridgeStartPoint.join(),o[y].segmentIndex=y}else{E=void 0;(E=this.createSegment(w,x,C,s,v,e,i)).target=c.id,o[y].bridges.push(E),o[y].bridgeStartPoint.push(w),o[y].segmentIndex=y}}else if(!isNaN(w.x)&&!isNaN(w.y)&&!this.isEmptyPoint(x)){var z=void 0,D={bridges:[],bridgeStartPoint:[],segmentIndex:y};(z=this.createSegment(w,x,C,s,v,e,i)).target=c.id;var k=[];k.push(w),[].push(x),o[y]=D,o[y].bridges.push(z),o[y].bridgeStartPoint=k,o[y].segmentIndex=y}}}}}}0!==o.length&&this.firstBridge(o,e,a)}},e.prototype.firstBridge=function(t,e,i){for(var r=0;r<t.length;r++){for(var o=t[r],n=1;n<o.bridges.length;n++)if(wr.findLength(o.bridges[n].endPoint,o.bridges[n-1].endPoint)<i){o.bridges[n-1].endPoint=o.bridges[n].endPoint;var a=o.bridges[n-1],s=this.createBridgeSegment(a.startPoint,a.endPoint,a.angle,i,a.sweep);o.bridges[n-1].path=s,o.bridges.splice(n,1),o.bridgeStartPoint.splice(n,1),n--}e.sourcePoint;for(var h=0;h<o.bridges.length;h++){(a=o.bridges[h]).endPoint,e.bridges.push(a)}}},e.prototype.createSegment=function(t,e,i,r,o,n,a){var s,h,d={angle:0,endPoint:{x:0,y:0},target:"",path:"",segmentPointIndex:-1,startPoint:{x:0,y:0},sweep:1,rendered:!1};return h=this.sweepDirection(i,r,n,a),s=this.createBridgeSegment(t,e,i,n.bridgeSpace,h),d.path=s,d.startPoint=t,d.endPoint=e,d.angle=i,d.segmentPointIndex=o,d.sweep=h,d},e.prototype.createBridgeSegment=function(t,e,i,r,o){return"A "+r/2+" "+r/2+" "+i+" , 1 "+o+" "+e.x+","+e.y},e.prototype.sweepDirection=function(t,e,i,r){var o,n=Math.abs(t);switch(e){case"Top":case"Bottom":o=1,n>=0&&n<=90&&(o=0);break;case"Left":case"Right":o=1,t<0&&t>=-180&&(o=0)}return"Right"!==e&&"Bottom"!==e||(o=0===o?1:0),o},e.prototype.getPointAtLength=function(t,e){for(var i,r=0,o={x:0,y:0},n=0;n<e.length;n++){var a=e[n];if(i){var s=this.lengthCalculation(i,a);if(r+s>t){var h=t-r,d=wr.findAngle(i,a),l=h*Math.cos(d*Math.PI/180),c=h*Math.sin(d*Math.PI/180);o={x:i.x+l,y:i.y+c};break}r+=s,i=a}else i=a}return o},e.prototype.getPoints=function(t){var e=[];if(t.intermediatePoints&&("Straight"===t.type||"Orthogonal"===t.type))for(var i=0;i<t.intermediatePoints.length;i++)e.push(t.intermediatePoints[i]);return e},e.prototype.intersectsRect=function(t,e){return e.x<t.x+t.width&&t.x<e.x+e.width&&e.y<t.y+t.height&&t.y<e.y+e.height},e.prototype.intersect=function(t,e,i,r,o){i&&e.length>=2&&(e.splice(0,1),e.splice(0,1));for(var n=[],a=0;a<t.length-1;a++){var s=this.inter1(t[a],t[a+1],e,o,r);if(s.length>0)for(var h=0;h<s.length;h++)n.push(s[h]);i&&e.length>=1&&e.splice(0,1)}return n},e.prototype.inter1=function(t,e,i,r,o){for(var n=[],a=0;a<i.length-1;a++){var s=Oe(t,e,i[a],i[a+1]);if(!this.isEmptyPoint(s)){var h=this.angleCalculation(t,e),d=this.angleCalculation(i[a],i[a+1]);switch(h=this.checkForHorizontalLine(h),d=this.checkForHorizontalLine(d),o){case"Left":case"Right":h>d&&n.push(s);break;case"Top":case"Bottom":h<d&&n.push(s)}h===d&&r&&n.push(s)}}return n},e.prototype.checkForHorizontalLine=function(t){var e=Math.abs(t);return e>90?180-e:e},e.prototype.isEmptyPoint=function(t){return 0===t.x&&0===t.y},e.prototype.getLengthAtFractionPoint=function(t,e){for(var i=100,r=-1,o=0,n=-1,a=0,s=0,h=t.sourcePoint,d=h,l=[],c=0;c<t.intermediatePoints.length;c++){var p=t.intermediatePoints[c];l.push(p)}for(var g=0;g<l.length;g++){var u=l[g],f=this.getSlope(u,h,e,t);f<i&&(i=f,s=o+this.lengthCalculation(e,d),n=a,r=g),o+=wr.findLength(u,h),h=u,d=u}return a++,{lengthFractionIndex:s,fullLength:o,segmentIndex:n,pointIndex:r}},e.prototype.getSlope=function(t,e,i,r){var o=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y),a=(i.y-t.y)/(e.y-t.y),s=(i.x-t.x)/(e.x-t.x);if(!isFinite(a)||!isFinite(s)||isNaN(a)||isNaN(s)){if(t.x===e.x){if(t.y===e.y)return 1e4;if(t.y>i.y&&i.y>e.y||t.y<i.y&&i.y<e.y)return Math.abs(t.x-i.x)}else if(t.y===e.y&&(t.x>i.x&&i.x>e.x||t.x<i.x&&i.x<e.x))return Math.abs(t.y-i.y)}else if((t.x>=i.x&&i.x>=e.x||t.x<=i.x&&i.x<=e.x||o<3)&&(t.y>=i.y&&i.y>=e.y||t.y<=i.y&&i.y<=e.y||n<3))return Math.abs(a-s);return 1e4},e.prototype.angleCalculation=function(t,e){var i=t.x-e.x,r=t.y-e.y;return Math.atan2(r,i)*(180/Math.PI)},e.prototype.lengthCalculation=function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},e.prototype.destroy=function(){},e.prototype.getModuleName=function(){return"Bridging"},e}(),ds=function(){function e(t){this.line=[],this.diagram=t}return e.prototype.canSnap=function(){return 0!=(this.diagram.snapSettings.constraints&(t.SnapConstraints.SnapToObject|t.SnapConstraints.SnapToLines))},e.prototype.snapPoint=function(e,i,r,o,n,a,s){var h=this.diagram.snapSettings,d={x:0,y:0},l=_i(i.wrapper),c={snapped:!1,offset:0},p={snapped:!1,offset:0};if(this.diagram.snapSettings.constraints&t.SnapConstraints.SnapToObject){var g=void 0;(g=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id","_SnappingLines"),g.setAttribute("shapeRendering","crispEdges"),this.getAdornerLayerSvg().appendChild(g),this.snapObject(e,i,g,c,p,n,a===s)}var u=l.x+n.x,f=l.y+n.y,m=l.x+l.width+n.x,y=l.y+l.height+n.y,v=h.verticalGridlines.scaledIntervals,b=this.round(m,v,1),w=this.round(u,v,1);v=h.horizontalGridlines.scaledIntervals;var x=this.round(f,v,1),S=this.round(y,v,1),P=l.x+l.width,C=l.y+l.height;return c.snapped?this.diagram.snapSettings.constraints&t.SnapConstraints.SnapToObject?d.x=c.offset:d.x=s.x-a.x:this.diagram.snapSettings.constraints&t.SnapConstraints.SnapToVerticalLines?Math.abs(n.x)>=1&&(r?Math.abs(b-P)>Math.abs(w-l.x)?d.x+=w-l.x:d.x+=b-P:Math.abs(b-P)<Math.abs(w-l.x)?d.x+=b-P:d.x+=w-l.x):d.x=s.x-a.x,p.snapped?d.y=p.offset:this.diagram.snapSettings.constraints&t.SnapConstraints.SnapToHorizontalLines?Math.abs(n.y)>=1&&(o?Math.abs(S-C)>Math.abs(x-l.y)?d.y+=x-l.y:d.y+=S-C:Math.abs(S-C)<Math.abs(x-l.y)?d.y+=S-C:d.y+=x-l.y):d.y=s.y-a.y,d},e.prototype.round=function(t,e,i){i=i>1?Math.pow(2,Math.floor(Math.log(i)/Math.log(2))):Math.pow(2,Math.ceil(Math.log(i)/Math.log(2)));var r=0,o=0;for(o=0;o<e.length;o++)r+=e[o];var n=t%(r/=i),a=Math.floor(Math.abs(t)/r)*r;if(a!==t)if(t>=0)for(o=0;o<e.length;o++){if(n<=e[o]/i)return a+(n<e[o]/(2*i)?0:e[o]/i);a+=e[o]/i,n-=e[o]/i}else for(a*=-1,o=e.length-1;o>=0;o--){if(Math.abs(n)<=e[o]/i)return a-(Math.abs(n)<e[o]/(2*i)?0:e[o]/i);a-=e[o]/i,n+=e[o]/i}return t},e.prototype.snapObject=function(t,e,i,r,o,n,a){var s,h,d,l=null,c=this.diagram.scroller,p=this.diagram.snapSettings,g=[],u=[],f=[],m=[],y=_i(e.wrapper),v=t.scroller.currentZoom,b=-c.horizontalOffset,w=-c.verticalOffset,x=p.snapObjectDistance/v,S=new xr(0,0,c.viewPortWidth,c.viewPortHeight),P=new xr(b/v,y.y-x-5,S.width/v,y.height+2*x+10),C=new xr(y.x-x-5,w/v,y.width+2*x+10,S.height/v);S=new xr(b/v,w/v,S.width/v,S.height/v);var T,A,M,L=this.findNodes(t.spatialSearch,e,C,S),O=t.nameTable;for(T=0;T<L.length;T++)A=L[T],this.canBeTarget(t,A)&&(this.diagram.nameTable[A.id]instanceof Wo||!this.canConsider(O,e,A)||((M=A.bounds).height+M.y<n.y+y.y?f.push({obj:A,distance:Math.abs(y.y+n.y-M.y-M.height)}):M.y>y.y+n.y+y.height&&m.push({obj:A,distance:Math.abs(y.y+n.y+y.height-M.y)}),(null==l||l>Math.abs(M.y-y.y-n.y))&&(Math.abs(M.x+M.width/2-(y.x+y.width/2+n.x))<=x?(h=this.createSnapObject(M,y,"centerX"),l=Math.abs(M.y-y.y)):Math.abs(M.x+M.width-(y.x+y.width+n.x))<=x?(h=this.createSnapObject(M,y,"right"),l=Math.abs(M.y-y.y)):Math.abs(M.x-(y.x+n.x))<=x?(h=this.createSnapObject(M,y,"left"),l=Math.abs(M.y-y.y)):Math.abs(M.x-(y.x+y.width+n.x))<=x?(h=this.createSnapObject(M,y,"rightLeft"),l=Math.abs(M.y-y.y)):Math.abs(M.x+M.width-(y.x+n.x))<=x&&(h=this.createSnapObject(M,y,"leftRight"),l=Math.abs(M.y-y.y)))));L=this.findNodes(t.spatialSearch,e,P,S);for(var I=0;I<L.length;I++)A=L[I],this.canBeTarget(t,A)&&(this.diagram.nameTable[A.id]instanceof Wo||!this.canConsider(O,e,A)||((M=A.bounds).x+M.width<y.x+n.x&&(g[g.length]={obj:A,distance:Math.abs(y.x+n.x-M.x-M.width)}),M.x>y.x+n.x+y.width&&(u[u.length]={obj:A,distance:Math.abs(y.x+n.x+y.width-M.x)}),(null==s||s>Math.abs(M.x-y.x-n.x))&&(Math.abs(M.y+M.height/2-(y.y+y.height/2+n.y))<=x?(d=this.createSnapObject(M,y,"centerY"),s=Math.abs(M.x-y.x)):Math.abs(M.y-y.y-n.y)<=x?(d=this.createSnapObject(M,y,"top"),s=Math.abs(M.x-y.x)):Math.abs(M.y+M.height-(y.y+y.height+n.y))<=x?(d=this.createSnapObject(M,y,"bottom"),s=Math.abs(M.x-y.x)):Math.abs(M.y+M.height-y.y-n.y)<=x?(d=this.createSnapObject(M,y,"topBottom"),s=Math.abs(M.x-y.x)):Math.abs(M.y-(y.y+y.height+n.y))<=x&&(d=this.createSnapObject(M,y,"bottomTop"),s=Math.abs(M.x-y.x)))));this.createGuidelines(t,h,d,i,r,o,a),r.snapped||this.createHSpacingLines(t,i,e,g,u,r,o,a,n,x),o.snapped||this.createVSpacingLines(t,i,e,f,m,r,o,a,n,x)},e.prototype.snapConnectorEnd=function(e){var i=this.diagram.snapSettings;return i.constraints&t.SnapConstraints.SnapToLines&&(e.x=this.round(e.x,i.verticalGridlines.scaledIntervals,1),e.y=this.round(e.y,i.horizontalGridlines.scaledIntervals,1)),e},e.prototype.canBeTarget=function(t,e){return e=this.diagram.nameTable[e.id],!hr(this.diagram,e,!1)},e.prototype.snapSize=function(t,e,i,r,o,n,a,s){var h,d,l,c,p=this.diagram.snapSettings,g=this.diagram.scroller,u=_i(a.wrapper),f=t.nameTable,m=[],y=[],v=t.scroller.currentZoom,b=-g.horizontalOffset,w=-g.verticalOffset,x=p.snapObjectDistance/v,S=new xr(0,0,g.viewPortWidth,g.viewPortHeight),P=new xr(b/v,(u.y-5)/v,S.width/v,(u.height+10)/v),C=new xr((u.x-5)/v,w/v,(u.width+10)/v,S.height/v);S=new xr(b/v,w/v,S.width/v,S.height/v);var T,A,M,L=[],O=this.findNodes(t.spatialSearch,a,C,S,L);for(T=0;T<O.length;T++)A=O[T],!this.canConsider(f,a,A)||this.diagram.nameTable[A.id]instanceof Wo||(M=A.bounds,(null==h||h>Math.abs(M.y-u.y))&&(e.left?Math.abs(u.x+o-M.x)<=x?(l=this.createSnapObject(M,u,"left"),h=Math.abs(M.y-u.y)):Math.abs(u.x+o-M.x-M.width)<=x&&(l=this.createSnapObject(M,u,"leftRight"),h=Math.abs(M.y-u.y)):e.right&&(Math.abs(u.x+o+u.width-M.x-M.width)<=x?(l=this.createSnapObject(M,u,"right"),h=Math.abs(M.y-u.y)):Math.abs(u.x+o+u.width-M.x)<=x&&(l=this.createSnapObject(M,u,"rightLeft"),h=Math.abs(M.y-u.y)))));O=this.findNodes(t.spatialSearch,a,P,S);for(var I=0;I<O.length;I++){var E=O[I];if(this.canConsider(f,a,E)&&!(this.diagram.nameTable[E.id]instanceof Wo)){var z=E.bounds;(null==d||d>Math.abs(z.x-u.x))&&(i.top?Math.abs(u.y+n-z.y)<=x?(c=this.createSnapObject(z,u,"top"),d=Math.abs(z.x-u.x)):Math.abs(u.y+n-z.y-z.height)<=x&&(c=this.createSnapObject(z,u,"topBottom"),d=Math.abs(z.x-u.x)):i.bottom&&(Math.abs(u.y+u.height+n-z.y-z.height)<=x?(c=this.createSnapObject(z,u,"bottom"),d=Math.abs(z.x-u.x)):Math.abs(u.y+u.height+n-z.y)<=x&&(c=this.createSnapObject(z,u,"bottomTop"),d=Math.abs(z.x-u.x))))}}for(T=0;T<L.length;T++)if(A=L[T],this.canConsider(f,a,A)){var D=A.bounds,k=e.left?-o:o,R=Math.abs(u.width+k-D.width),N=void 0;R<=x&&(N=e.left?-D.width+u.width:D.width-u.width,m[m.length]={source:A,difference:R,offset:N}),k=i.top?-n:n;var B=Math.abs(u.height+k-D.height);B<=x&&(N=i.top?-D.height+u.height:D.height-u.height,y[y.length]={source:A,difference:B,offset:N})}if(!t.getTool)this.createGuidelines(t,l,c,r,e,i,s);!e.snapped&&m.length>0&&(e.left||e.right)&&this.addSameWidthLines(t,r,m,e,s,a),!i.snapped&&y.length>0&&(i.top||i.bottom)&&this.addSameHeightLines(t,r,y,i,s,a)},e.prototype.snapTop=function(e,i,r,o,n,a,s,h){var d=n;i.top=!0;var l;e.left=e.right=!1;if(this.diagram.snapSettings.constraints&t.SnapConstraints.SnapToObject&&!a.rotateAngle&&(l=h.y-h.height*a.pivot.y+n-(a.offsetY-a.height*a.pivot.y),this.snapSize(this.diagram,e,i,r,o,l,this.diagram.selectedItems,s)),i.snapped)d=n-l+i.offset;else if(this.diagram.snapSettings.constraints&t.SnapConstraints.SnapToHorizontalLines){var c=h.y-h.height*a.pivot.y,p=c+n;d=this.round(p,this.diagram.snapSettings.horizontalGridlines.scaledIntervals,1)-c}return d},e.prototype.snapRight=function(e,i,r,o,n,a,s,h){var d,l=o;e.right=!0,i.top=i.bottom=!1;if(this.diagram.snapSettings.constraints&t.SnapConstraints.SnapToObject&&!a.rotateAngle&&(d=h.x+h.width*(1-a.pivot.x)+o-(a.offsetX+a.width*(1-a.pivot.x)),this.snapSize(this.diagram,e,i,r,d,n,this.diagram.selectedItems,s)),e.snapped)l=o-d+e.offset;else if(this.diagram.snapSettings.constraints&t.SnapConstraints.SnapToVerticalLines){var c=h.x+h.width*(1-a.pivot.x),p=c+o;l=this.round(p,this.diagram.snapSettings.verticalGridlines.scaledIntervals,1)-c}return l},e.prototype.snapLeft=function(e,i,r,o,n,a,s,h){var d=o,l=0;e.left=!0,i.top=i.bottom=!1;if(this.diagram.snapSettings.constraints&t.SnapConstraints.SnapToObject&&!a.rotateAngle&&(l=h.x-h.width*a.pivot.x+o-(a.offsetX-a.width*a.pivot.x),this.snapSize(this.diagram,e,i,r,l,n,this.diagram.selectedItems,s)),e.snapped)d=o-l+e.offset;else if(this.diagram.snapSettings.constraints&t.SnapConstraints.SnapToVerticalLines){var c=h.x-h.width*a.pivot.x,p=c+o;d=this.round(p,this.diagram.snapSettings.horizontalGridlines.scaledIntervals,1)-c}return d},e.prototype.snapBottom=function(e,i,r,o,n,a,s,h){var d=n;i.bottom=!0,e.left=e.right=!1;var l=0;this.diagram.snapSettings.constraints&t.SnapConstraints.SnapToObject&&!a.rotateAngle&&(l=h.y+h.height*(1-a.pivot.y)+n-(a.offsetY+a.height*(1-a.pivot.y)),this.snapSize(this.diagram,e,i,r,o,l,this.diagram.selectedItems,s));if(_i(a instanceof Gr||a instanceof Po?a:a.wrapper),i.snapped)d=n-l+i.offset;else if(this.diagram.snapSettings.constraints&t.SnapConstraints.SnapToHorizontalLines){var c=h.y+h.height*(1-a.pivot.y),p=c+n;d=this.round(p,this.diagram.snapSettings.horizontalGridlines.scaledIntervals,1)-c}return d},e.prototype.createGuidelines=function(t,e,i,r,o,n,a){return e&&(o.offset=e.offsetX,o.snapped=!0,a||(e.type,this.renderAlignmentLines(e.start,e.end,r,t.scroller.transform))),i&&(n.offset=i.offsetY,n.snapped=!0,a||(i.type,this.renderAlignmentLines(i.start,i.end,r,t.scroller.transform))),r},e.prototype.renderAlignmentLines=function(t,e,i,r){t={x:(t.x+r.tx)*r.scale,y:(t.y+r.ty)*r.scale},e={x:(e.x+r.tx)*r.scale,y:(e.y+r.ty)*r.scale};var o={stroke:"#07EDE1",strokeWidth:1,startPoint:{x:t.x,y:t.y},endPoint:{x:e.x,y:e.y},fill:"#07EDE1",dashArray:"",width:1,x:0,y:0,height:0,angle:0,pivotX:0,pivotY:0,visible:!0,opacity:1,id:Hi()},n=0;for(this.line.push(o),n=0;n<this.line.length;n++)this.diagram.diagramRenderer.drawLine(i,this.line.pop())},e.prototype.createHSpacingLines=function(t,e,i,r,o,n,a,s,h,d){var l=0;this.sortByDistance(r,"distance",!0),this.sortByDistance(o,"distance",!0);var c,p,g,u,f=[],m=_i(i.wrapper);if(r.length>0&&(f[f.length]=r[0],l=(c=r[0].obj.bounds).y,r.length>1?(g=r[1].obj.bounds,u=c.x-g.x-g.width,Math.abs(u-r[0].distance)<=d?l=this.findEquallySpacedNodesAtLeft(r,u,l,f):u=r[0].distance):u=r[0].distance),this.sortByDistance(f,"distance"),f[f.length]={obj:i,distance:0},l=m.y<l||!l?m.y:l,o.length>0){var y=void 0;if(p=o[0].obj.bounds,l=p.y<l?p.y:l,o.length>1&&(y=(g=o[1].obj.bounds).x-p.x-p.width),r.length>0)if(Math.abs(o[0].distance-r[0].distance)<=d){var v=Math.abs(o[0].distance-r[0].distance)/2;o[0].distance<r[0].distance?u-=v:u+=v,f[f.length]=o[0]}else 1===r.length&&(c=void 0,f.splice(0,1),f[f.length]=o[0],u=y);else u=y,f[f.length]=o[0];o.length>1&&p.x+p.width<g.x&&(l=this.findEquallySpacedNodesAtRight(o,y,l,f,d))}if(f.length>2){this.addHSpacingLines(t,e,f,s,l);var b=0;s&&(b=h.x),c?n.offset=u-Math.abs(m.x+b-c.x-c.width)+b:p&&(n.offset=Math.abs(m.x+m.width+b-p.x)-u+b),n.snapped=!0}},e.prototype.createVSpacingLines=function(t,e,i,r,o,n,a,s,h,d){var l=0;this.sortByDistance(r,"distance",!0),this.sortByDistance(o,"distance",!0);var c,p,g,u,f=[],m=_i(i.wrapper);r.length>0&&(f[f.length]=r[0],l=(c=r[0].obj.bounds).x+c.width,r.length>1?(g=r[1].obj.bounds,u=c.y-g.y-g.height,Math.abs(u-r[0].distance)<=d?l=this.findEquallySpacedNodesAtTop(r,u,l,f):u=r[0].distance):u=r[0].distance),this.sortByDistance(f,"distance"),f[f.length]={obj:i,distance:0},l=m.x+m.width>l||!l?m.x+m.width:l;var y;if(o.length>0){if(p=o[0].obj.bounds,l=p.x+p.width>l?p.x+p.width:l,o.length>1&&(y=(g=o[1].obj.bounds).y-p.y-p.height),r.length>0)if(Math.abs(o[0].distance-r[0].distance)<=d){var v=Math.abs(o[0].distance-r[0].distance)/2;o[0].distance<r[0].distance?u-=v:u+=v,f[f.length]=o[0]}else 1===r.length&&(c=void 0,f.splice(0,1),f[f.length]=o[0],u=y);else u=y,f[f.length]=o[0];o.length>1&&g.y>p.y+p.height&&(l=this.findEquallySpacedNodesAtBottom(o,y,l,f,d))}if(f.length>2){this.addVSpacingLines(t,e,f,s,l);var b=0;s&&(b=h.y),c?a.offset=u-Math.abs(m.y+b-c.y-c.height)+b:p&&(a.offset=Math.abs(m.y+m.height+b-p.y)-u+b),a.snapped=!0}},e.prototype.addHSpacingLines=function(t,e,i,r,o){var n,a,s;if(!r)for(n=0;n<i.length-1;n++){var h=i[n].obj instanceof Vo?_i(i[n].obj.wrapper):i[n].obj.bounds,d=i[n+1].obj instanceof Vo?_i(i[n+1].obj.wrapper):i[n+1].obj.bounds;a={x:h.x+h.width,y:o-15},s={x:d.x,y:o-15},this.renderSpacingLines(a,s,e,this.getAdornerLayerSvg(),t.scroller.transform)}},e.prototype.addVSpacingLines=function(t,e,i,r,o){var n,a;if(!r)for(var s=0;s<i.length-1;s++){var h=i[s].obj instanceof Vo?_i(i[s].obj.wrapper):i[s].obj.bounds,d=i[s+1].obj instanceof Vo?_i(i[s+1].obj.wrapper):i[s+1].obj.bounds;n={x:o+15,y:h.y+h.height},a={x:o+15,y:d.y},this.renderSpacingLines(n,a,e,this.getAdornerLayerSvg(),t.scroller.transform)}},e.prototype.addSameWidthLines=function(t,e,i,r,o,n){this.sortByDistance(i,"offset");var a,s,h=_i(n.wrapper),d=i[0],l=d.source.bounds,c=[];c.push(i[0]);var p;for(p=1;p<i.length;p++)i[p].source.bounds.width===l.width&&c.push(i[p]);if(!o)for(a={x:h.x+d.offset,y:h.y-15},s={x:h.x+h.width+d.offset,y:h.y-15},this.renderSpacingLines(a,s,e,this.getAdornerLayerSvg(),t.scroller.transform),p=0;p<c.length;p++)a={x:(h=c[p].source.bounds).x,y:h.y-15},s={x:h.x+h.width,y:h.y-15},this.renderSpacingLines(a,s,e,this.getAdornerLayerSvg(),t.scroller.transform);r.offset=d.offset,r.snapped=!0},e.prototype.addSameHeightLines=function(t,e,i,r,o,n){this.sortByDistance(i,"offset");var a,s,h=_i(n.wrapper),d=i[0],l=d.source.bounds,c=[];c.push(i[0]);var p;for(p=0;p<i.length;p++)i[p].source.bounds.height===l.height&&c.push(i[p]);if(!o)for(a={x:h.x+h.width+15,y:h.y+d.offset},s={x:h.x+h.width+15,y:h.y+d.offset+h.height},this.renderSpacingLines(a,s,e,this.getAdornerLayerSvg(),t.scroller.transform),p=0;p<c.length;p++)a={x:(h=c[p].source.bounds).x+h.width+15,y:h.y},s={x:h.x+h.width+15,y:h.y+h.height},this.renderSpacingLines(a,s,e,this.getAdornerLayerSvg(),t.scroller.transform);r.offset=d.offset,r.snapped=!0},e.prototype.renderSpacingLines=function(t,e,i,r,o){var n,a,s=new Yr,h={};t={x:(t.x+o.tx)*o.scale,y:(t.y+o.ty)*o.scale},e={x:(e.x+o.tx)*o.scale,y:(e.y+o.ty)*o.scale},t.x===e.x?(n="M"+(t.x-5)+" "+(t.y+5)+"L"+t.x+" "+t.y+"L"+(t.x+5)+" "+(t.y+5)+"zM"+(e.x-5)+" "+(e.y-5)+" L"+e.x+" "+e.y+" L"+(e.x+5)+" "+(e.y-5)+"z",a={startPoint:{x:t.x-8,y:t.y-1},endPoint:{x:t.x+8,y:t.y-1},stroke:"#07EDE1",strokeWidth:1,fill:"#07EDE1",dashArray:"",width:1,x:0,y:0,height:0,angle:0,pivotX:0,pivotY:0,visible:!0,opacity:1,id:Hi()},s.data=n,h.data=s.data,h.angle=0,h.pivotX=0,h.pivotY=0,h.x=0,h.y=0,h.height=0,h.width=1,h.id=Hi(),this.diagram.diagramRenderer.drawPath(i,h),this.line.push(a),this.diagram.diagramRenderer.drawLine(i,this.line.pop()),a={startPoint:{x:e.x-8,y:e.y+1},endPoint:{x:e.x+8,y:e.y+1},stroke:"#07EDE1",strokeWidth:1,fill:"#07EDE1",dashArray:"",width:1,x:0,y:0,height:0,angle:0,pivotX:0,pivotY:0,visible:!0,opacity:1,id:this.getAdornerLayerSvg().id+"spacing"},this.line.push(a),this.diagram.diagramRenderer.drawLine(i,this.line.pop())):(n="M"+(t.x+5)+" "+(t.y+5)+" L"+t.x+" "+t.y+" L"+(t.x+5)+" "+(t.y-5)+"zM"+(e.x-5)+" "+(e.y-5)+" L"+e.x+" "+e.y+" L"+(e.x-5)+" "+(e.y+5)+"z",s.data=n,h.data=n,h.angle=0,h.pivotX=0,h.pivotY=0,h.x=0,h.y=0,h.height=0,h.width=1,h.id=Hi(),this.diagram.diagramRenderer.drawPath(i,h),a={visible:!0,opacity:1,id:Hi(),startPoint:{x:t.x-1,y:t.y-8},endPoint:{x:t.x-1,y:t.y+8},stroke:"#07EDE1",strokeWidth:1,fill:"#07EDE1",dashArray:"0",width:1,x:0,y:0,height:0,angle:0,pivotX:0,pivotY:0},this.line.push(a),this.diagram.diagramRenderer.drawLine(i,this.line.pop()),a={width:1,x:0,y:0,height:0,angle:0,pivotX:0,pivotY:0,visible:!0,opacity:1,id:Hi(),startPoint:{x:e.x+1,y:e.y-8},endPoint:{x:e.x+1,y:e.y+8},stroke:"#07EDE1",strokeWidth:1,fill:"#07EDE1",dashArray:"0"},this.line.push(a),this.diagram.diagramRenderer.drawLine(i,this.line.pop())),a={startPoint:{x:t.x,y:t.y},endPoint:{x:e.x,y:e.y},stroke:"#07EDE1",strokeWidth:1,fill:"#07EDE1",dashArray:"0",width:1,x:0,y:0,height:0,angle:0,pivotX:0,pivotY:0,visible:!0,opacity:1,id:Hi()},this.line.push(a),this.diagram.diagramRenderer.drawLine(i,this.line.pop())},e.prototype.createSnapObject=function(t,e,i){var r;switch(i){case"left":r={start:{x:t.x,y:Math.min(t.y,e.y)},end:{x:t.x,y:Math.max(t.y+t.height,e.y+e.height)},offsetX:t.x-e.x,offsetY:0,type:"sideAlign"};break;case"right":r={type:"sideAlign",start:{x:t.x+t.width,y:Math.min(t.y,e.y)},offsetX:t.x+t.width-e.x-e.width,offsetY:0,end:{x:t.x+t.width,y:Math.max(t.y+t.height,e.y+e.height)}};break;case"top":r={offsetY:t.y-e.y,offsetX:0,type:"sideAlign",start:{x:Math.min(t.x,e.x),y:t.y},end:{x:Math.max(t.x+t.width,e.x+e.width),y:t.y}};break;case"bottom":r={type:"sideAlign",offsetY:t.y+t.height-e.y-e.height,offsetX:0,end:{x:Math.max(t.x+t.width,e.x+e.width),y:t.y+t.height},start:{x:Math.min(t.x,e.x),y:t.y+t.height}};break;case"topBottom":r={start:{x:Math.min(t.x,e.x),y:t.y+t.height},end:{x:Math.max(t.x+t.width,e.x+e.width),y:t.y+t.height},offsetY:t.y+t.height-e.y,offsetX:0,type:"sideAlign"};break;case"bottomTop":r={start:{x:Math.min(t.x,e.x),y:t.y},end:{x:Math.max(t.x+t.width,e.x+e.width),y:t.y},offsetY:t.y-e.y-e.height,offsetX:0,type:"sideAlign"};break;case"leftRight":r={start:{x:t.x+t.width,y:Math.min(t.y,e.y)},end:{x:t.x+t.width,y:Math.max(t.y+t.height,e.y+e.height)},offsetX:t.x+t.width-e.x,offsetY:0,type:"sideAlign"};break;case"rightLeft":r={start:{x:t.x,y:Math.min(t.y,e.y)},end:{x:t.x,y:Math.max(t.y+t.height,e.y+e.height)},offsetX:t.x-e.x-e.width,offsetY:0,type:"sideAlign"};break;case"centerX":r={start:{x:t.x+t.width/2,y:Math.min(t.y,e.y)},end:{x:t.x+t.width/2,y:Math.max(t.y+t.height,e.y+e.height)},offsetX:t.x+t.width/2-(e.x+e.width/2),offsetY:0,type:"centerAlign"};break;case"centerY":r={start:{x:Math.min(t.x,e.x),y:t.y+t.height/2},end:{x:Math.max(t.x+t.width,e.x+e.width),y:t.y+t.height/2},offsetY:t.y+t.height/2-(e.y+e.height/2),offsetX:0,type:"centerAlign"}}return r},e.prototype.snapAngle=function(t,e){var i=this.diagram.snapSettings.snapAngle,r=e%(i||0);return r>=i/2?e+i-r:e-r},e.prototype.canConsider=function(t,e,i){return!this.diagram.selectedItems.nodes.length||this.diagram.selectedItems.nodes[0].id!==i.id},e.prototype.findNodes=function(t,e,i,r,o){for(var n,a,s=[],h=t.findQuads(o?r:i),d=0;d<h.length;d++){var l=h[d];if(l.objects.length>0)for(var c=0;c<l.objects.length;c++)n=l.objects[c],this.diagram.nameTable[n.id]instanceof Wo||!n.visible||(a=_i(n),-1===s.indexOf(n)&&this.intersectsRect(i,a)&&s.push(n),o&&o.indexOf(n)&&this.intersectsRect(r,a)&&o.push(n))}return s},e.prototype.intersectsRect=function(t,e){return e.x<t.x+t.width&&t.x<e.x+e.width&&e.y<t.y+t.height&&t.y<e.y+e.height},e.prototype.getAdornerLayerSvg=function(){return this.diagram.diagramRenderer.adornerSvgLayer},e.prototype.removeGuidelines=function(t){var e=this.getAdornerLayerSvg().getElementById("_SnappingLines"),i=this.getAdornerLayerSvg().getElementById("pivotLine");e&&e.parentNode.removeChild(e),i&&i.parentNode.removeChild(i)},e.prototype.sortByDistance=function(t,e,i){var r,o,n;if(i)for(r=0;r<t.length;r++)for(o=r+1;o<t.length;o++)t[r][e]>t[o][e]&&(n=t[r],t[r]=t[o],t[o]=n);else for(r=0;r<t.length;r++)for(o=r+1;o<t.length;o++)t[r][e]<t[o][e]&&(n=t[r],t[r]=t[o],t[o]=n)},e.prototype.findEquallySpacedNodesAtLeft=function(t,e,i,r){var o,n,a,s;for(s=1;s<t.length&&(o=t[s-1].obj.bounds,n=t[s].obj.bounds,a=o.x-n.x-n.width,Math.abs(a-e)<=1);s++)r[r.length]=t[s],n.y<i&&(i=n.y);return i},e.prototype.findEquallySpacedNodesAtRight=function(t,e,i,r,o){var n,a,s,h,d=t[0].distance;if(Math.abs(e-d)<=o)for(var l=0;l<t.length-1&&(n=t[l].obj,a=t[l+1].obj.bounds,s=n.bounds,h=a.x-s.x-s.width,Math.abs(h-e)<=1);l++)r[r.length]=t[l+1],s.y<i&&(i=s.y);return i},e.prototype.findEquallySpacedNodesAtTop=function(t,e,i,r){for(var o,n,a,s=1;s<t.length&&(o=t[s-1].obj.bounds,n=t[s].obj.bounds,a=o.y-n.y-n.height,Math.abs(a-e)<=1);s++)r[r.length]=t[s],n.x+n.width>i&&(i=n.x+n.width);return i},e.prototype.findEquallySpacedNodesAtBottom=function(t,e,i,r,o){var n,a,s,h,d=t[0].distance;if(Math.abs(e-d)<=o)for(var l=0;l<t.length-1&&(n=t[l].obj,a=t[l+1].obj.bounds,s=n.bounds,h=a.y-s.y-s.height,Math.abs(h-e)<=1);l++)r[r.length]=t[l+1],s.x+s.width>i&&(i=s.x+s.width);return i},e.prototype.getLayer=function(){var e;return this.diagram.snapSettings.constraints&t.SnapConstraints.SnapToObject&&((e=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id","_SnappingLines"),e.setAttribute("shapeRendering","crispEdges"),this.getAdornerLayerSvg().appendChild(e)),e},e.prototype.destroy=function(){},e.prototype.getModuleName=function(){return"Snapping"},e}(),ls=function(){function e(){this.groupUndo=!1,this.childTable=[]}return e.prototype.initHistory=function(t){t.historyList={canRedo:!1,canUndo:!1,currentEntry:null,push:t.addHistoryEntry.bind(t),undo:Function,redo:Function,startGroupAction:t.startGroupAction.bind(t),endGroupAction:t.endGroupAction.bind(t),canLog:null,undoStack:[],redoStack:[]}},e.prototype.addHistoryEntry=function(t,e){var i=null;if(e.historyList.canLog){if(!0===e.historyList.canLog(t).cancel)return}e.historyList&&e.historyList.canUndo&&e.historyList.currentEntry&&((i=e.historyList.currentEntry).next?i.previous&&(i.next.previous=null,i.next=t,t.previous=i):(i.next=t,t.previous=i)),e.historyList.currentEntry=t,this.getHistoryList(e),e.historyList.canUndo=!0,e.historyList.canRedo=!1},e.prototype.undo=function(t){var e=this.getUndoEntry(t),i=0;e&&("Internal"===e.category?("EndGroup"===e.type?(i++,this.groupUndo=!0):this.undoEntry(e,t),this.groupUndo&&(this.undoGroupAction(e,t,i),this.groupUndo=!1)):t.historyList.undo(e))},e.prototype.getHistoryList=function(t){var e,i,r=[],o=[],n=t.historyList.currentEntry;for(n=t.historyList.currentEntry,t.historyList.canUndo||0===t.historyList.undoStack.length?this.getHistroyObject(r,n):this.getHistroyObject(o,n);n&&n.previous;)e=n.previous,this.getHistroyObject(r,e),n=n.previous;for(n=t.historyList.currentEntry;n&&n.next;)i=n.next,this.getHistroyObject(o,i),n=n.next;t.historyList.undoStack=r,t.historyList.redoStack=o},e.prototype.getHistroyObject=function(t,e){e&&"StartGroup"!==e.type&&"EndGroup"!==e.type&&t.push({redoObject:e.redoObject?e.redoObject:null,undoObject:e.undoObject?e.undoObject:null,type:e.type?e.type:null,category:e.category?e.category:null})},e.prototype.undoGroupAction=function(t,e,i){for(;0!==i;)this.undoEntry(t,e),"StartGroup"===(t=this.getUndoEntry(e)).type?i--:"EndGroup"===t.type&&i++;i=0},e.prototype.undoEntry=function(e,i){var r;if("PropertyChanged"!==e.type&&"CollectionChanged"!==e.type&&"LabelCollectionChanged"!==e.type&&(r=e.undoObject),"StartGroup"!==e.type&&"EndGroup"!==e.type&&i.historyList.undoStack.length>0){var o=i.historyList.undoStack.splice(0,1);i.historyList.redoStack.splice(0,0,o[0])}switch(i.protectPropertyChange(!0),i.diagramActions|=t.DiagramAction.UndoRedo,e.type){case"PositionChanged":case"Align":case"Distribute":this.recordPositionChanged(r,i);break;case"SizeChanged":case"Sizing":this.recordSizeChanged(r,i,e);break;case"RotationChanged":this.recordRotationChanged(r,i,e);break;case"ConnectionChanged":this.recordConnectionChanged(r,i);break;case"PropertyChanged":this.recordPropertyChanged(e,i,!1);break;case"CollectionChanged":e.isUndo=!0,this.recordCollectionChanged(e,i),e.isUndo=!1;break;case"LabelCollectionChanged":e.isUndo=!0,this.recordLabelCollectionChanged(e,i),e.isUndo=!1;break;case"PortCollectionChanged":e.isUndo=!0,this.recordPortCollectionChanged(e,i),e.isUndo=!1;break;case"Group":this.unGroup(e,i);break;case"UnGroup":this.group(e,i);break;case"SegmentChanged":this.recordSegmentChanged(r,i);break;case"PortPositionChanged":this.recordPortChanged(e,i,!1);break;case"AnnotationPropertyChanged":this.recordAnnotationChanged(e,i,!1);break;case"ChildCollectionChanged":this.recordChildCollectionChanged(e,i,!1);break;case"StackChildPositionChanged":this.recordStackPositionChanged(e,i,!1)}i.diagramActions&=~t.DiagramAction.UndoRedo,i.protectPropertyChange(!1),i.historyChangeTrigger(e)},e.prototype.group=function(t,e){e.add(t.undoObject)},e.prototype.unGroup=function(t,e){t.redoObject=Xi(t.undoObject);var i=t.undoObject;e.commandHandler.unGroup(i)},e.prototype.ignoreProperty=function(t){return"zIndex"===t||"wrapper"===t},e.prototype.getProperty=function(t,e){for(var i=0,r=Object.keys(e);i<r.length;i++){var o=r[i];this.ignoreProperty(o)||(e[o]instanceof Object?this.getProperty(t[o],e[o]):t[o]=e[o])}},e.prototype.recordAnnotationChanged=function(t,e,i){var r=i?t.redoObject:t.undoObject,o=ii(r,t.objectId),n=e.commandHandler.getAnnotationChanges(e.nameTable[r.id],o),a=e.nameTable[r.id],s=ii(a,t.objectId);s.offset=o.offset,s.margin=o.margin,s.width=o.width,s.height=o.height,s.rotateAngle=o.rotateAngle,s.margin=o.margin,a instanceof En?e.nodePropertyChange(a,{},n):e.connectorPropertyChange(a,{},n)},e.prototype.recordChildCollectionChanged=function(t,e,i){var r,o=i?t.redoObject:t.undoObject,n=e.nameTable[o.id];n.parentId&&((r=e.nameTable[n.parentId]).children.splice(r.children.indexOf(n.id),1),r.wrapper.children.splice(r.wrapper.children.indexOf(n.wrapper),1)),""!==o.parentId&&((r=e.nameTable[o.parentId]).children.push(o.id),r.wrapper.children.push(n.wrapper)),n.parentId=o.parentId,e.updateDiagramObject(n)},e.prototype.recordStackPositionChanged=function(t,e,i){var r=i?t.redoObject:t.undoObject;if(r.source){var o=e.nameTable[r.source.parentId];o&&(r.target?(o.wrapper.children.splice(r.targetIndex,1),o.wrapper.children.splice(r.sourceIndex,0,r.source.wrapper)):void 0!==r.sourceIndex?(e.nameTable[r.source.id]||e.add(r.source),o.wrapper.children.splice(r.sourceIndex,0,e.nameTable[r.source.id].wrapper),e.nameTable[r.source.id].parentId=o.id):(o.wrapper.children.splice(o.wrapper.children.indexOf(e.nameTable[r.source.id].wrapper),1),e.nameTable[r.source.id].parentId=""),i&&"UmlClassifier"===o.shape.type&&e.remove(r.source),o.wrapper.measure(new yr),o.wrapper.arrange(o.wrapper.desiredSize),e.updateDiagramObject(o),e.updateSelector())}},e.prototype.recordPortChanged=function(t,e,i){var r=i?t.redoObject.nodes[0]:t.undoObject.nodes[0],o=ri(r,t.objectId),n=e.commandHandler.getPortChanges(e.nameTable[r.id],o),a=e.nameTable[r.id];ri(a,t.objectId).offset=o.offset,e.nodePropertyChange(a,{},n)},e.prototype.recordPropertyChanged=function(e,i,r){var o=e.redoObject,n=e.undoObject;this.getProperty(i,r?o:n),r?i.onPropertyChanged(o,n):i.onPropertyChanged(n,o),i.diagramActions=i.diagramActions|t.DiagramAction.UndoRedo},e.prototype.recordSegmentChanged=function(t,e){var i,r=0;if(t.connectors&&t.connectors.length>0)for(r=0;r<t.connectors.length;r++)i=t.connectors[r],this.segmentChanged(i,e)},e.prototype.segmentChanged=function(t,e){var i=e.nameTable[t.id];i.segments=t.segments,e.commandHandler.updateEndPoint(i)},e.prototype.recordPositionChanged=function(t,e){var i,r,o=0;if(t.nodes&&t.nodes.length>0)for(o=0;o<t.nodes.length;o++)i=t.nodes[o],this.positionChanged(i,e);if(t.connectors&&t.connectors.length>0)for(o=0;o<t.connectors.length;o++)r=t.connectors[o],this.connectionChanged(r,e)},e.prototype.positionChanged=function(t,e,i){var r=e.nameTable[t.id];if(t.processId&&!r.processId&&e.addProcess(t,t.processId),!t.processId&&r.processId&&e.removeProcess(t.id),r.processId){var o=t.margin.left-r.margin.left,n=t.margin.top-r.margin.top;e.drag(r,o,n)}else{o=t.offsetX-r.wrapper.offsetX,n=t.offsetY-r.wrapper.offsetY;e.drag(r,o,n)}e.bpmnModule&&e.bpmnModule.updateDocks(r,e)},e.prototype.recordSizeChanged=function(t,e,i){var r,o,n=0;if(t&&t.nodes&&t.nodes.length>0)for(n=0;n<t.nodes.length;n++)if((o=t.nodes[n]).children&&!o.container)for(var a=e.commandHandler.getAllDescendants(o,[]),s=0;s<a.length;s++){var h=i.childTable[a[s].id];_n(h)===En?(this.sizeChanged(h,e,i),this.positionChanged(h,e,i)):this.connectionChanged(h,e,i)}else this.sizeChanged(o,e),this.positionChanged(o,e);if(t&&t.connectors&&t.connectors.length>0){var d=t.connectors;for(n=0;n<d.length;n++)r=d[n],this.connectionChanged(r,e)}},e.prototype.sizeChanged=function(t,e,i){var r=e.nameTable[t.id],o=t.wrapper.actualSize.width/r.wrapper.actualSize.width,n=t.wrapper.actualSize.height/r.wrapper.actualSize.height;i&&i.childTable&&(i.childTable[t.id]=Xi(r)),e.scale(r,o,n,{x:t.wrapper.offsetX/r.wrapper.offsetX,y:t.wrapper.offsetY/r.wrapper.offsetY})},e.prototype.recordRotationChanged=function(t,e,i){var r,o,n=0,a=e.selectedItems;if(a.rotateAngle=t.rotateAngle,a&&a.wrapper&&(a.wrapper.rotateAngle=t.rotateAngle),t&&t.nodes&&t.nodes.length>0)for(n=0;n<t.nodes.length;n++)r=t.nodes[n],this.rotationChanged(r,e),this.positionChanged(r,e);if(t&&t.connectors&&t.connectors.length>0)for(n=0;n<t.connectors.length;n++)o=t.connectors[n],this.connectionChanged(o,e)},e.prototype.rotationChanged=function(t,e){var i=e.nameTable[t.id];e.rotate(i,t.rotateAngle-i.rotateAngle)},e.prototype.recordConnectionChanged=function(t,e){var i=t.connectors[0];this.connectionChanged(i,e)},e.prototype.connectionChanged=function(t,e,i){var r=e.nameTable[t.id];t.sourcePortID!==r.sourcePortID&&(r.sourcePortID=t.sourcePortID,e.connectorPropertyChange(r,{},{sourcePortID:t.sourcePortID})),t.targetPortID!==r.targetPortID&&(r.targetPortID=t.targetPortID,e.connectorPropertyChange(r,{},{targetPortID:t.targetPortID})),t.sourceID!==r.sourceID&&(""===t.sourceID?Ke(e.nameTable[r.sourceID].outEdges,t.id):e.nameTable[t.sourceID].outEdges.push(t.id),r.sourceID=t.sourceID,e.connectorPropertyChange(r,{},{sourceID:t.sourceID})),t.targetID!==r.targetID&&(""===t.targetID?Ke(e.nameTable[r.targetID].inEdges,t.id):e.nameTable[t.targetID].inEdges.push(t.id),r.targetID=t.targetID,e.connectorPropertyChange(r,{},{targetID:t.targetID})),i&&i.childTable&&(i.childTable[t.id]=Xi(r));var o=t.sourcePoint.x-r.sourcePoint.x,n=t.sourcePoint.y-r.sourcePoint.y;0===o&&0===n||e.dragSourceEnd(r,o,n);var a=t.targetPoint.x-r.targetPoint.x,s=t.targetPoint.y-r.targetPoint.y;0===a&&0===s||e.dragTargetEnd(r,a,s),e.updateSelector(),"SVG"!==e.mode&&e.refreshDiagramLayer()},e.prototype.recordCollectionChanged=function(t,e){var i=t.undoObject;if(t&&t.changeType){if("Remove"===(t.isUndo?"Insert"===t.changeType?"Remove":"Insert":t.changeType))i.nodeId?e.remove(e.nameTable[i.nodeId+"_textannotation_"+i.id]):(e.remove(i),e.clearSelectorLayer());else{if(e.clearSelectorLayer(),i.parentId){var r=e.nameTable[i.parentId];r?e.addChild(r,i):e.add(i)}else i.nodeId?e.addTextAnnotation(i,e.nameTable[i.nodeId]):e.nameTable[i.id]||e.add(i);i.processId&&e.nameTable[i.processId]&&e.addProcess(i,i.processId)}"SVG"!==e.mode&&e.refreshDiagramLayer()}},e.prototype.recordLabelCollectionChanged=function(t,e){var i=t.undoObject,r=t.redoObject,o=e.nameTable[r.id];if(t&&t.changeType){"Remove"===(t.isUndo?"Insert"===t.changeType?"Remove":"Insert":t.changeType)?(e.removeLabels(o,[i]),e.clearSelectorLayer()):(e.clearSelectorLayer(),e.addLabels(o,[i])),"SVG"!==e.mode&&e.refreshDiagramLayer()}},e.prototype.recordPortCollectionChanged=function(t,e){var i=t.undoObject,r=t.redoObject,o=e.nameTable[r.id];if(t&&t.changeType){"Remove"===(t.isUndo?"Insert"===t.changeType?"Remove":"Insert":t.changeType)?(e.removePorts(o,[i]),e.clearSelectorLayer()):(e.clearSelectorLayer(),e.addPorts(o,[i])),"SVG"!==e.mode&&e.refreshDiagramLayer()}},e.prototype.redo=function(t){var e=this.getRedoEntry(t),i=0;e&&("Internal"===e.category?("StartGroup"===e.type?(i++,this.groupUndo=!0):this.redoEntry(e,t),this.groupUndo&&(this.redoGroupAction(e,t,i),this.groupUndo=!1)):t.historyList.redo(e))},e.prototype.redoGroupAction=function(t,e,i){for(;0!==i;)this.redoEntry(t,e),"EndGroup"===(t=this.getRedoEntry(e)).type?i--:"StartGroup"===t.type&&i++;i=0},e.prototype.redoEntry=function(e,i){var r;if("PropertyChanged"!==e.type&&"CollectionChanged"!==e.type&&(r=e.redoObject),i.diagramActions|=t.DiagramAction.UndoRedo,"StartGroup"!==e.type&&"EndGroup"!==e.type&&i.historyList.redoStack.length>0){var o=i.historyList.redoStack.splice(0,1);i.historyList.undoStack.splice(0,0,o[0])}switch(i.protectPropertyChange(!0),e.type){case"PositionChanged":case"Align":case"Distribute":this.recordPositionChanged(r,i);break;case"SizeChanged":case"Sizing":this.recordSizeChanged(r,i,e);break;case"RotationChanged":this.recordRotationChanged(r,i,e);break;case"ConnectionChanged":this.recordConnectionChanged(r,i);break;case"PropertyChanged":this.recordPropertyChanged(e,i,!0);break;case"CollectionChanged":this.recordCollectionChanged(e,i);break;case"LabelCollectionChanged":this.recordLabelCollectionChanged(e,i);break;case"PortCollectionChanged":this.recordPortCollectionChanged(e,i);break;case"Group":this.group(e,i);break;case"UnGroup":this.unGroup(e,i);break;case"SegmentChanged":this.recordSegmentChanged(r,i);break;case"PortPositionChanged":this.recordPortChanged(e,i,!0);break;case"AnnotationPropertyChanged":this.recordAnnotationChanged(e,i,!0);break;case"ChildCollectionChanged":this.recordChildCollectionChanged(e,i,!0);break;case"StackChildPositionChanged":this.recordStackPositionChanged(e,i,!0)}i.protectPropertyChange(!1),i.diagramActions&=~t.DiagramAction.UndoRedo,i.historyChangeTrigger(e)},e.prototype.getUndoEntry=function(t){var e,i=null,r=t.historyList;return r.canUndo&&(i=r.currentEntry,(e=r.currentEntry.previous)?(r.currentEntry=e,r.canRedo||(r.canRedo=!0)):(r.canRedo=!0,r.canUndo=!1)),i},e.prototype.getRedoEntry=function(t){var e,i=null,r=t.historyList;return r.canRedo&&((e=r.currentEntry.previous||r.canUndo?r.currentEntry.next:r.currentEntry)&&(r.currentEntry=e,r.canUndo||(r.canUndo=!0),e.next||(r.canRedo=!1,r.canUndo=!0)),i=r.currentEntry),i},e.prototype.destroy=function(){},e.prototype.getModuleName=function(){return"UndoRedo"},e}(),cs=function(){function e(){this.protectChange=!1}return e.prototype.expand=function(t,e,i,r){var o=this,n={},a=0;if(n[0]=setInterval(function(){return a++,o.layoutAnimation(e,n,6===a,r)},20),i.isExpanded){var s=.2;this.protectChange=r.isProtectedOnChange,r.protectPropertyChange(!1);var h={};this.updateOpacity(i,s,r),h[0]=setInterval(function(){s<=1?o.updateOpacity(i,s,r):clearInterval(h[0]),s+=.2},20)}},e.prototype.layoutAnimation=function(e,i,r,o){if(!r)for(var n=0;n<e.objects.length;n++){var a=o.nameTable[e.objects[n].id];a.offsetX+=e.objects[n].differenceX/5,a.offsetY+=e.objects[n].differenceY/5}r&&(clearInterval(i[0]),o.protectPropertyChange(!0),o.triggerEvent(t.DiagramEvent.animationComplete,void 0),o.organizationalChartModule.isAnimation=!1,o.layout.fixedNode="",o.protectPropertyChange(this.protectChange))},e.prototype.updateOpacity=function(t,e,i){for(var r=0;r<t.outEdges.length;r++){var o=i.nameTable[t.outEdges[r]],n=i.nameTable[o.targetID];o.style.opacity=e;for(var a=0;a<o.wrapper.children.length;a++)o.wrapper.children[a].style.opacity=e,n.style.opacity=e,n.wrapper instanceof _r&&i.updateNodeProperty(n.wrapper,void 0,e);this.updateOpacity(n,e,i)}},e.prototype.destroy=function(){},e.prototype.getModuleName=function(){return"LayoutAnimate"},e}(),ps=function(){function t(){this.isAnimation=!1}return t.prototype.destroy=function(){},t.prototype.getModuleName=function(){return"OrganizationalChart"},t.prototype.updateLayout=function(t,e,i,r,o){var n={type:i.type,nameTable:e,anchorX:0,anchorY:0,firstLevelNodes:[],centerNode:null,levels:[],maxLevel:0,graphNodes:{},orientation:i.orientation,horizontalSpacing:i.horizontalSpacing,verticalSpacing:i.verticalSpacing,verticalAlignment:i.verticalAlignment,horizontalAlignment:i.horizontalAlignment,fixedNode:i.fixedNode,getLayoutInfo:ir(i.getLayoutInfo),margin:i.margin,bounds:i.bounds,objects:[],root:i.root};return this.doLayout(n,t,r,o),n},t.prototype.doLayout=function(t,e,i,r){var o,n,a=[];for(t.nameTable[t.root]&&t.firstLevelNodes.push(t.nameTable[t.root]),n=0;n<e.length;n++)(o=e[n]).excludeFromLayout||((t.graphNodes[o.id]=this.setUpLayoutInfo(t,o)).tree.hasSubTree=!1,t.nameTable[t.root]||o.inEdges&&o.inEdges.length||(a.push(o),o.data&&String(o.data[r])===t.root&&t.firstLevelNodes.push(o)));for(0===t.firstLevelNodes.length&&(t.firstLevelNodes=a),n=0;n<t.firstLevelNodes.length;n++)o=t.firstLevelNodes[n],this.updateEdges(t,o,1);if(t.firstLevelNodes.length>0){t.rootNode=t.firstLevelNodes[0];var s=0,h=0,d=void 0,l=void 0,c=void 0,p=void 0,g=void 0;for(n=0;n<t.firstLevelNodes.length;n++){g=this.updateTree(t,s,h,t.firstLevelNodes[n],0,t.firstLevelNodes[n-1]);var u=t.graphNodes[t.firstLevelNodes[n].id];g.y=Math.min(g.y,u.y),g.x=Math.min(g.x,u.x),-1!==t.orientation.indexOf("Left")?h=g.right+t.horizontalSpacing:s=g.right+t.horizontalSpacing,0===n?(d=g.x,p=g.y,c=g.right,l=g.bottom):(d=Math.min(d,g.x),p=Math.min(p,g.y),c=Math.max(c,g.right),l=Math.max(l,g.bottom))}for(this.updateAnchor(t,{x:d,y:p,right:c,bottom:l},i),n=0;n<t.firstLevelNodes.length;n++)this.updateNodes(t,t.firstLevelNodes[n],0);for(n=0;n<t.firstLevelNodes.length;n++)this.updateConnectors(t,t.firstLevelNodes[n],1)}},t.prototype.getBounds=function(t){var e=t.offsetX-t.actualSize.width*t.pivot.x,i=t.offsetY-t.actualSize.height*t.pivot.y;return new xr(e,i,t.actualSize.width,t.actualSize.height)},t.prototype.updateTree=function(t,e,i,r,o,n,a){var s,h,d,l,c={};if(s=this.getDimensions(t,r,e,i,o),c=t.graphNodes[r.id],t.maxLevel=Math.max(t.maxLevel,o),h=o,(l=this.hasChild(t,r))||c.tree.assistants.length){var p=void 0,g=void 0,u=void 0,f=void 0,m=void 0,y=void 0;y=s.y+s.height+t.verticalSpacing,c.tree.assistants.length&&(h=(d=this.setDepthSpaceForAssitants(t,r,y,s.height,o,t.verticalSpacing)).level,y=d.bottom),c.tree.assistants.length||"Horizontal"===c.tree.orientation||(y=s.y+s.height+t.verticalSpacing/2),c.tree.children.length&&(p="Horizontal"!==c.tree.orientation||"Balanced"===c.tree.type&&1!==c.tree.children.length?"Balanced"===c.tree.type?this.updateHorizontalTreeWithMultipleRows(t,r,n,s.x,y,h):this.updateVerticalTree(t,r,s.x,y,h,a):this.updateHorizontalTree(t,r,n,s.x,y,h)),c.y&&c.y>s.y||(c.y=s.y),e&&e>c.mid||(e=c.mid),c.tree.assistants.length&&(m=void 0!==e?e:s.x,f=this.setBreadthSpaceForAssistants(t,r,s,m,y,o),l||(e=((g=p=f).x+g.right)/2-s.width/2,p=g),u=f?f.canMoveBy:void 0),c.x=e,c.translate||(c.treeWidth=p.right-p.x);var v={layout:t,shape:r,shapeBounds:{x:e,y:s.y,right:e+s.width,bottom:s.y+s.height},treeBounds:p,dim:s,level:o};return this.translateSubTree(v,u,void 0!==n,a),c.firstChild&&"string"!=typeof c.firstChild&&(c.firstChild.x+=c.subTreeTranslation),r.treeBounds=p,p}return r.treeBounds=this.updateLeafNode(t,r,n,s,o,a),r.treeBounds},t.prototype.updateLeafNode=function(t,e,i,r,o,n){var a,s=t.graphNodes[e.id];s.x=r.x,s.y&&s.y>r.y||(s.y=r.y,s.maxLevel=Math.max(o,s.maxLevel||0)),a={x:r.x,y:r.y,right:r.x+r.width,bottom:r.y+r.height},s.maxLevel=Math.max(s.maxLevel||0,o);var h={layout:t,shape:e,shapeBounds:a,treeBounds:a,dim:r,level:o};return this.translateSubTree(h,void 0,void 0!==i,n),{x:s.x,y:s.y,right:s.x+r.width,bottom:s.y+r.height}},t.prototype.setUpLayoutInfo=function(t,e){var i={};return i.subTreeTranslation=0,"OrganizationalChart"===t.type?i.tree={orientation:"Vertical",type:"Alternate",offset:20,enableRouting:!0}:i.tree={orientation:"Horizontal",type:"Center",enableRouting:!0},i.tree.children=[],i.tree.assistants=[],i.tree.level=0,i.translate=!0,i},t.prototype.translateSubTree=function(t,e,i,r){var o=t.layout,n=t.shape,a=t.shapeBounds,s=t.treeBounds,h=t.level,d=t.dim,l=o.graphNodes[n.id],c=o.nameTable[l.firstChild?l.firstChild.child:l.tree.children[0]],p=c?o.graphNodes[c.id]:null,g=this.hasChild(o,n),u=this.findIntersectingLevels(o,a,h,l.actualLevel),f=this.findIntersectingLevels(o,s,h,l.actualLevel),m=[];u.length&&l.translate?(l.intersect=u,this.spaceLeftFromPrevSubTree(o,n,a),l.canMoveBy=l.diff,void 0!==e&&(l.canMoveBy=Math.min(e,l.canMoveBy)),c&&void 0!==p.canMoveBy&&(p.canMoveBy>=l.canMoveBy&&(l.translated=!0),l.canMoveBy=Math.min(l.canMoveBy,p.canMoveBy)),i&&(l.x-=l.canMoveBy,l.subTreeTranslation-=l.canMoveBy,g&&(this.shiftSubordinates(o,f,l.canMoveBy),s.x=Math.min(s.x,l.x),s.right=Math.max(s.right,l.x+d.width),s.bottom=Math.max(s.bottom,l.y+d.height),s.x-=l.canMoveBy,s.right-=l.canMoveBy),c&&p.canMoveBy>l.canMoveBy?l.canMoveBy=p.canMoveBy-l.canMoveBy:c&&void 0!==l.canMoveBy&&(l.canMoveBy=0))):(g&&(s.x=Math.min(s.x,a.x),s.right=Math.max(s.right,a.x+d.width),s.bottom=Math.max(s.bottom,l.y+d.height)),l.translate||(l.canMoveBy=0,l.subTreeTranslation=0)),r||(a={x:l.x,y:d.y,right:l.x+d.width,bottom:d.y+d.height},m.push({rBounds:a}),this.updateRearBounds(o,n,m,h))},t.prototype.updateRearBounds=function(t,e,i,r,o){var n,a,s,h,d,l,c=!0,p={};if(e&&(o=(p=t.graphNodes[e.id]).intersect,c=!p.tree.children.length&&!p.tree.assistants.length),h=i[0].rBounds,d=i[i.length-1].rBounds,o&&o.length){for(l=(n=t.levels[o[0]].rBounds).bottom,n.y<h.y&&(n.bottom=h.y,i.splice(0,0,{rBounds:n})),l>d.bottom?i.push({rBounds:{x:n.x,right:n.right,y:h.bottom,bottom:l}}):(n=t.levels[o[o.length-1]].rBounds,c&&n.bottom>d.bottom&&(n.y=d.bottom,i.push({rBounds:n}))),a=o[0],s=i.length-1;s>=0;s--)t.levels.splice(a,0,i[s]);a+=i.length,t.levels.splice(a,o.length)}else for(a=this.findLevel(t,i[i.length-1].rBounds,r),s=i.length-1;s>=0;s--)t.levels.splice(a,0,i[s])},t.prototype.shiftSubordinates=function(t,e,i){var r;if(0!==i)for(r=0;r<e.length;r++)t.levels[e[r]].rBounds&&(t.levels[e[r]].rBounds.x-=i,t.levels[e[r]].rBounds.right-=i)},t.prototype.setDepthSpaceForAssitants=function(t,e,i,r,o,n){var a,s,h,d,l=t.graphNodes[e.id],c={};for(d=i,s=0;s<l.tree.assistants.length;s++)(c=t.graphNodes[l.tree.assistants[s]])&&(c.tree.children=c.tree.assistants=[],c.y=i,a=(h=t.nameTable[l.tree.assistants[s]]).actualSize.height,-1!==t.orientation.indexOf("Left")&&(a=h.actualSize.width),d=i+a+n/2,t.maxLevel=o+1,s%2==1&&s!==l.tree.assistants.length-1&&(i=d,o++));return{level:t.maxLevel,bottom:i+a+n}},t.prototype.setBreadthSpaceForAssistants=function(t,e,i,r,o,n){var a,s,h,d,l,c,p,g,u={},f=t.graphNodes[e.id],m=n;for(d=0;d<f.tree.assistants.length;d++)(u=t.graphNodes[f.tree.assistants[d]])&&(a=(h=t.nameTable[f.tree.assistants[d]]).actualSize.width,-1!==t.orientation.indexOf("Left")&&(a=h.actualSize.height),l=d%2==0?r+i.width/2-20-a:r+i.width/2+20,s=this.updateTree(t,l,u.y,t.nameTable[f.tree.assistants[d]],m+1),this.hasChild(t,e)||(0===d?g=s:this.uniteRects(g,s)),d%2==0&&u.prevBounds&&(c=void 0===c?u.canMoveBy:Math.min(c,u.canMoveBy)),d%2!=1&&d!==f.tree.assistants.length-1||(p=this.findIntersectingLevels(t,s,m+1),this.updateRearBounds(t,null,[{rBounds:s}],m+1,p),m++));return g&&(g.canMoveBy=c),g},t.prototype.getDimensions=function(t,e,i,r,o){var n;n=e.actualSize.width;var a;if(a=e.actualSize.height,-1!==t.orientation.indexOf("Left")){if(!o){var s=void 0;s=i,i=r,r=s}a=e.actualSize.width,n=e.actualSize.height}return{x:i,y:r,width:n,height:a}},t.prototype.hasChild=function(t,e){var i=t.graphNodes[e.id];return i.tree.children&&i.tree.children.length},t.prototype.updateHorizontalTree=function(t,e,i,r,o,n){var a;a=this.getDimensions(t,e,r,o,n);var s,h={},d=(h=t.graphNodes[e.id]).tree.type;s=n;var l=0;l=r;var c;c=o;var p,g,u,f,m,y,v,b,w,x,S,P,C,T;if(t.levels.slice(0,t.levels.length),this.hasChild(t,e)){var A=void 0;for(A=-1!==t.orientation.indexOf("Left"),P=0;P<h.tree.children.length;P++){if(u=t.nameTable[h.tree.children[P]],p=u.actualSize.width,g=u.actualSize.height,m=A?g:p,y=A?p:g,t.levels[s+1]?t.levels[s+1].rBounds:null,f=this.updateTree(t,l,c,u,s+1,t.nameTable[h.tree.children[P-1]]),C=t.graphNodes[u.id],h.maxLevel=Math.max(h.maxLevel||0,C.maxLevel||0),b={x:C.x,y:C.y,right:C.x+m,bottom:C.y+y},0===P&&(v={x:Math.min(C.x,f.x),y:Math.min(C.y,f.y),right:f.right,bottom:f.bottom},T=C),S?(S.x=b.x,S.y=b.y,b.right>S.right&&(S.right=b.right),S.bottom=b.bottom):S=b,0===P&&(h.firstChild={x:C.x,canMoveBy:C.canMoveBy,child:u.id}),this.hasChild(t,u))if(!h.firstChild||h.firstChild.x>=C.firstChild.x){C.firstChild&&h.firstChild.canMoveBy<C.canMoveBy&&(h.firstChild.canMoveBy=x,C.canMoveBy=x,x=h.firstChild.canMoveBy,t.graphNodes[h.firstChild.child].canMoveBy=x);var M=void 0!==x?x:C.canMoveBy;h.firstChild={x:C.firstChild.x,canMoveBy:M,child:u.id}}else C.firstChild&&C.translated&&h.firstChild.canMoveBy>C.canMoveBy&&(h.firstChild.canMoveBy=t.graphNodes[h.firstChild.child].canMoveBy=C.canMoveBy);w=w?Math.max(C.maxLevel,w):C.maxLevel,this.uniteRects(v,f),l=0!==P&&!this.hasChild(t,u)&&C.subTreeTranslation<0?f.right-C.subTreeTranslation+t.horizontalSpacing:f.right+t.horizontalSpacing}isNaN(void 0)||(T.canMoveBy=void 0),h.mid=(T.x+S.right)/2-a.width/2,"Left"===d?h.mid=b.right-a.width:"Right"===d&&(h.mid=r)}return v},t.prototype.updateHorizontalTreeWithMultipleRows=function(t,e,i,r,o,n){var a,s,h,d,l,c,p,g,u,f,m,y=this.getDimensions(t,e,r,o,n),v=t.graphNodes[e.id],b=(v.tree.type,n),w=r,x=o,S=(t.levels.slice(0,t.levels.length),0);if(this.hasChild(t,e)){var P=-1!==t.orientation.indexOf("Left"),C=void 0,T=this.splitChildrenInRows(t,e),A=5===v.tree.children.length&&3===T[0].length,M=[],L=[];A?L=T:this.splitRows(T,M,L);var O={leftTree:M,rows:T,rightTree:L,dimensions:y},I=this.updateLeftTree(t,O,e,r,x,b);l=O.bounds;var E=void 0,z=(I||0)+(void 0!==I?t.horizontalSpacing/2:0);void 0!==I&&(v.mid=z-y.width/2,E=I+t.horizontalSpacing),x=o;var D=void 0;for(D=[],u=0;u<L.length;u++)for(w=T[u].length%2==1&&u===L.length-1||A?r:E||r,0!==u&&(x=D[u-1].bottom+t.verticalSpacing),g=0;g<L[u].length;g++)c=(a=t.nameTable[L[u][g]]).actualSize.width,p=a.actualSize.height,d=P?p:c,(s=t.graphNodes[a.id]).actualLevel=b+1+u,0===g&&M[u]&&M[u].length&&(s.translate=!1),A&&1===u&&(0===g&&f+d+t.horizontalSpacing<=m&&(C=!0,w=f-d/2),C&&1===g&&(w=m-d/2)),h=this.updateTree(t,w,x,a,b+1,t.nameTable[L[u][g-1]]),A&&g<=2&&0===u&&1===g&&(f=h.x-t.horizontalSpacing/2,m=h.x+d+t.horizontalSpacing/2),0===g?D[u]={x:h.x,y:h.y,right:h.right,bottom:h.bottom}:this.uniteRects(D[u],h),l||(l={x:D[u].x,y:D[u].y,right:D[u].right,bottom:D[u].bottom}),this.uniteRects(l,D[u]),w=h.right+t.horizontalSpacing,(!v.firstChild||(u===L.length-1&&T[u].length%2==1||A)&&0===g&&void 0!==s.canMoveBy&&S>s.canMoveBy)&&(S=Math.min(S,s.canMoveBy||0),v.firstChild={x:s.x,child:a.id,canMoveBy:s.canMoveBy}),O.leftCenter=f,O.rightCenter=m,O.align=C,O.level=b,O.rightBounds=D,this.alignRowsToCenter(t,u,e,O,E)}return l},t.prototype.updateLeftTree=function(t,e,i,r,o,n){for(var a,s,h,d,l,c=e.leftTree,p=t.graphNodes[i.id],g=[],u=-1!==t.orientation.indexOf("Left"),f=0;f<c.length&&c[f].length;f++){a=r,g[f-1]&&(o=g[f-1].bottom+t.verticalSpacing);for(var m=0;m<c[f].length;m++){var y=t.nameTable[c[f][m]],v=(u?y.actualSize.height:y.actualSize.width,u?y.actualSize.width:y.actualSize.height,t.graphNodes[y.id]);v.actualLevel=n+1+f,d=this.updateTree(t,a,o,y,n+1,t.nameTable[c[f][m-1]]),0===m?g[f]={x:d.x,y:d.y,right:d.right,bottom:d.bottom}:this.uniteRects(g[f],d),0===f&&0===m?(s=v.canMoveBy,p.firstChild={x:v.x,child:y.id,canMoveBy:v.canMoveBy}):0===m&&void 0!==v.canMoveBy&&s>v.canMoveBy&&(s=Math.min(s,v.canMoveBy||0),p.firstChild={x:v.x,child:y.id,canMoveBy:v.canMoveBy}),a=d.right+t.horizontalSpacing}h=0===f?g[f].right:Math.max(h,g[f].right)}for(f=0;f<c.length&&c[f].length;f++){if(h!==g[f].right){var b=h-g[f].right;for(m=0;m<c[f].length;m++){t.nameTable[c[f][m]];t.graphNodes[c[f][m]].x+=b}}0===f?l={x:g[0].x,y:g[0].y,right:g[0].right,bottom:g[0].bottom}:this.uniteRects(l,g[f])}return e.bounds=l,h},t.prototype.alignRowsToCenter=function(t,e,i,r,o){var n,a,s,h=t.graphNodes[i.id],d=r.rows,l=r.rightTree,c=r.leftCenter,p=r.rightCenter,g=r.align,u=r.rightBounds,f=r.dimensions,m=r.level,y=5===h.tree.children.length&&3===d[0].length;if(y&&1===e&&(n=u[0].right-u[0].x>=u[1].right-u[1].x?0:1),e===d.length-1&&(d[e].length%2==1||y&&1===e)){a=l[e][Math.floor(l[e].length/2)];var v=void 0;v=t.nameTable[a];var b=void 0,w=t.graphNodes[a].x,x=t.graphNodes[a].y;b=this.getDimensions(t,v,w,x,m+1),s=void 0,!g&&y?(1===n&&(e=0),s=(u[n].x+u[n].right)/2-(u[e].x+u[e].right)/2,0===e&&(h.mid+=s)):y||void 0===o||(s=o-t.horizontalSpacing/2-(w+b.width/2)),void 0!==s&&this.updateRearBoundsOfTree(t,l[e],s,f),y&&(h.mid=(p+c)/2+(0===e?s:0)-f.width/2),void 0===h.mid&&t.graphNodes[a]&&(h.mid=w),g=!1,e++}},t.prototype.updateRearBoundsOfTree=function(t,e,i,r){for(var o=0;o<e.length;o++){var n=t.graphNodes[e[o]];t.nameTable[e[o]];if(n.x+=i,n.canMoveBy+=i,o===e.length-1){var a={x:n.x,y:n.y,right:n.x+r.width,bottom:n.y+r.height},s=this.findIntersectingLevels(t,a,n.actualLevel);this.updateRearBounds(t,null,[{rBounds:a}],n.actualLevel,s)}}},t.prototype.splitRows=function(t,e,i){for(var r=0;r<t.length;r++){e[r]=[],i[r]=[];var o=void 0;if(o=t[r].length,t[r].length%2!=1){o=Math.ceil(t[r].length/2);for(var n=0;n<o;n++)e[r].push(t[r][n])}for(var a=e[r].length;a<t[r].length;a++)i[r].push(t[r][a])}},t.prototype.updateVerticalTree=function(t,e,i,r,o,n){this.getDimensions(t,e,i,r,o);var a,s,h,d,l,c,p,g,u,f,m,y=t.graphNodes[e.id],v=t.nameTable[y.tree.children[0]],b=-1!==t.orientation.indexOf("Left"),w="Left"===y.tree.type?-1:0,x=i,S=r;m=o;var P,C,T,A,M=[],L=[];for(P=0;P<y.tree.children.length;P++){if("Alternate"===y.tree.type&&(T=P%2==0&&y.tree.children.length>2?"Left":"Right",w=P%2==0&&y.tree.children.length>2?-1:0),x=i+this.findOffset(t,e,y,T),a=t.nameTable[y.tree.children[P]],d=b?a.actualSize.height:a.actualSize.width,l=b?a.actualSize.width:a.actualSize.height,h=this.updateTree(t,x+w*d,S,a,o+1,void 0,!0),s=t.graphNodes[a.id],g={x:s.x,y:s.y,right:s.x+d,bottom:s.y+l},0===P?(this.uniteRects(h,g),p=h):this.uniteRects(p,h),!s.prevBounds||"Alternate"===y.tree.type&&P%2==1&&y.tree.children.length>2||(A=void 0!==A?Math.min(s.canMoveBy,A):s.canMoveBy),y.maxLevel=Math.max(y.maxLevel||0,s.maxLevel||0),"Alternate"===y.tree.type&&y.tree.children.length>2&&P%2==0?(0!==P&&(S=c.bottom+t.verticalSpacing/2),L.push({rBounds:g}),s.levelBounds&&(L=L.concat(s.levelBounds))):(S="Alternate"===y.tree.type&&y.tree.children.length>2?Math.max(h.bottom,c.bottom)+t.verticalSpacing/2:h.bottom+t.verticalSpacing/2,o=y.maxLevel,M.push({rBounds:g}),f?this.uniteRects(f,g):f={x:s.x,y:s.y,right:s.x+d,bottom:s.y+l},s.levelBounds&&(M=M.concat(s.levelBounds))),0===P&&(y.firstChild={x:s.x,canMoveBy:s.canMoveBy,child:a.id}),this.hasChild(t,a))if(!y.firstChild||y.firstChild.x>=s.firstChild.x){if(s.firstChild&&y.firstChild.canMoveBy<s.canMoveBy){var O=y.firstChild.canMoveBy;s.canMoveBy=O,t.graphNodes[y.firstChild.child].canMoveBy=O,y.firstChild.canMoveBy=O}y.firstChild={x:s.firstChild.x,canMoveBy:void 0!==A?A:s.canMoveBy,child:a.id}}else s.firstChild&&s.translated&&y.firstChild.canMoveBy>s.canMoveBy&&(y.firstChild.canMoveBy=t.graphNodes[y.firstChild.child].canMoveBy=s.canMoveBy);c=g}return n?y.levelBounds=M:("Alternate"===y.tree.type&&y.tree.children.length>2&&(u={x:L[0].rBounds.x,y:L[0].rBounds.y,right:L[L.length-1].rBounds.right,bottom:L[L.length-1].rBounds.bottom},C=this.findIntersectingLevels(t,u,m+1),this.updateRearBounds(t,null,L,m+1,C)),C=this.findIntersectingLevels(t,f||p,m+1),this.updateRearBounds(t,null,f?M:[{rBounds:p}],m+1,C)),isNaN(A)||(t.graphNodes[v.id].canMoveBy=A),y.childBounds=p,y.mid=i,p},t.prototype.splitChildrenInRows=function(t,e){var i,r;r=4;var o,n=[];o=(i=t.graphNodes[e.id]).tree.children.length;var a=this.extend(i.tree.children);if(i.tree.rows){var s=void 0;s=i.tree.children.length;var h=void 0;r=(h=Math.ceil(s/i.tree.rows))%2==0?h:h+1}else 3===i.tree.children.length||4===i.tree.children.length?r=2:5===i.tree.children.length&&(r=3);for(;o>0;)n[n.length]=a.splice(0,r),(o-=r)<r&&(r=o);return n},t.prototype.extend=function(t){var e,i=[];for(e=0;e<t.length;e++)i[e]=t[e];return i},t.prototype.findOffset=function(t,e,i,r){var o=0,n=-1!==t.orientation.indexOf("Left")?e.actualSize.height:e.actualSize.width,a=r||i.tree.type;switch(o=i.tree.offset||20,"Alternate"===i.tree.type&&o>=t.horizontalSpacing&&(o=t.horizontalSpacing/2),a){case"Left":o=n/2-o;break;case"Right":o+=n/2}return o},t.prototype.uniteRects=function(t,e){t.x=Math.min(t.x,e.x),t.right=Math.max(t.right,e.right),t.bottom=Math.max(t.bottom,e.bottom)},t.prototype.spaceLeftFromPrevSubTree=function(t,e,i){var r;r=t.graphNodes[e.id];var o,n,a,s;for(s=t.horizontalSpacing,a=0;a<r.intersect.length;a++)n=t.levels[r.intersect[a]].rBounds,o=i.x-(n.right+s),(void 0===r.diff||o<r.diff)&&(r.diff=o,r.prevBounds=t.levels[r.intersect[a]].rBounds)},t.prototype.findIntersectingLevels=function(t,e,i,r){var o;(o={x:e.x,y:e.y,right:e.right,bottom:e.bottom}).y-=t.verticalSpacing/2,o.bottom+=t.verticalSpacing/2;var n;n=[];var a,s;s=void 0!==r?r:i,a=t.levels[s]?t.levels[s].rBounds:null;do{if(a&&(o.y<a.y&&o.bottom>a.y||o.y<a.bottom&&a.bottom<o.bottom||o.y>=a.y&&o.bottom<=a.bottom||o.y<a.y&&o.bottom>a.bottom)){n.splice(0,0,s)}else if(a&&a.bottom<o.y)break;s--,a=t.levels[s]?t.levels[s].rBounds:null}while(s>=0);s=(void 0!==r?r:i)+1,a=t.levels[s]?t.levels[s].rBounds:null;do{if(a&&(o.y<a.y&&o.bottom>a.y||o.y<a.bottom&&a.bottom<o.bottom||o.y>=a.y&&o.bottom<=a.bottom||o.y<a.y&&o.bottom>a.bottom))n.push(s);else if(a&&a.y>o.bottom)break;s++,a=t.levels[s]?t.levels[s].rBounds:null}while(s<=t.levels.length);return n},t.prototype.findLevel=function(t,e,i){var r;r=e;var o;o=0;var n;for(n=t.levels[o]?t.levels[o].rBounds:null;o<t.levels.length;){if(n&&r.bottom<n.y)return o;o++,n=t.levels[o]?t.levels[o].rBounds:null}return o},t.prototype.getParentNode=function(t,e){return t.nameTable[t.nameTable[e.inEdges[0]].sourceID]},t.prototype.updateEdges=function(t,e,i){var r;r=t.graphNodes[e.id];var o;if(e.outEdges&&e.outEdges.length&&(e.isExpanded||!this.isAnimation))for(o=0;o<e.outEdges.length;o++){var n=void 0;(n=t.nameTable[t.nameTable[e.outEdges[o]].targetID]).excludeFromLayout||(-1===r.tree.children.indexOf(n.id)&&r.tree.children.push(n.id),n.outEdges&&n.outEdges.length&&n.isExpanded&&(r.tree.hasSubTree=!0),this.updateEdges(t,n,i+1))}r.tree.level=i,r.tree.hasSubTree&&(r.tree.orientation="Horizontal",r.tree.type="Center"),t.getLayoutInfo&&"OrganizationalChart"===t.type&&(t.getLayoutInfo(e,r.tree),"Balanced"===r.tree.type&&r.tree.hasSubTree&&(r.tree.type="Center",r.tree.orientation="Horizontal")),t.level&&"Alternate"!==r.tree.type&&i>=t.level&&(r.tree.hasSubTree=!1)},t.prototype.updateAnchor=function(t,e,i){var r,o,n,a=0,s=0,h=0,d=new xr(0,0,i.x,i.y);n=t.bounds?t.bounds:d;var l=t.orientation;if(t.fixedNode){a=(o=t.nameTable[t.fixedNode]).actualSize.width,s=o.actualSize.height,t.anchorX=o.offsetX,t.anchorY=o.offsetY;var c=o.pivot;for(t.anchorX+="RightToLeft"===t.orientation?a*c.x:-a*c.x,t.anchorY+="BottomToTop"===t.orientation?s*c.y:-s*c.y,r=o,h=0;r.inEdges.length;)r=this.getParentNode(t,r),h+=t.graphNodes[r.id].subTreeTranslation||0;-1!==t.orientation.indexOf("Left")?(t.anchorX-=t.graphNodes[o.id].y,t.anchorY-=t.graphNodes[o.id].x+h):(t.anchorX-=t.graphNodes[o.id].x+h,t.anchorY-=t.graphNodes[o.id].y)}else if("TopToBottom"===l||"BottomToTop"===l){switch(t.horizontalAlignment){case"Left":t.anchorX=n.x-e.x+t.margin.left;break;case"Right":t.anchorX=n.x+n.width-t.margin.right-e.right;break;case"Auto":case"Center":t.anchorX=n.x+n.width/2-(e.x+e.right)/2}switch(t.verticalAlignment){case"Auto":case"Top":var p;p=n.y+t.margin.top,t.anchorY="TopToBottom"===l?p:e.bottom+p;break;case"Bottom":var g=void 0;g=n.y+n.height-t.margin.bottom,t.anchorY="TopToBottom"===l?g-e.bottom:g;break;case"Center":var u=void 0;u=n.y+n.height/2,t.anchorY="TopToBottom"===t.orientation?u-(e.y+e.bottom)/2:u+(e.y+e.bottom)/2}}else{switch(t.horizontalAlignment){case"Auto":case"Left":var f=void 0;f=n.x+t.margin.left,t.anchorX="LeftToRight"===l?f:e.bottom+f;break;case"Right":var m=void 0;m=n.x+n.width-t.margin.right,t.anchorX="LeftToRight"===l?m-e.bottom:m;break;case"Center":u=void 0;u=n.width/2+n.x,t.anchorX="LeftToRight"===t.orientation?u-(e.y+e.bottom)/2:u+(e.y+e.bottom)/2}switch(t.verticalAlignment){case"Top":t.anchorY=n.y+t.margin.top-e.x;break;case"Auto":case"Center":t.anchorY=n.y+n.height/2-(e.right+e.x)/2;break;case"Bottom":t.anchorY=n.y+n.height-t.margin.bottom-e.right}}},t.prototype.updateConnectors=function(t,e,i){var r,o,n,a;if(o=t.graphNodes[e.id],e.outEdges.length)for(r=0;r<e.outEdges.length;r++)(a=t.nameTable[e.outEdges[r]]).points=[],n=t.nameTable[a.targetID],a.visible&&(a.visited=!0,t.getConnectorSegments?t.getConnectorSegments(a):o&&-1!==o.tree.children.indexOf(a.targetID)&&(a.segments=[],"OrganizationalChart"===t.type&&"Orthogonal"===a.type&&this.updateSegments(t,a,e,n,r)),n&&(n.isExpanded||this.hasChild(t,n))&&this.updateConnectors(t,n,i+1));if(o&&o.tree.assistants.length)for(r=0;r<o.tree.assistants.length;r++)n=t.nameTable[o.tree.assistants[r]],a=t.nameTable[n.inEdges[0]],this.get3Points(t,e,n,a),(n.isExpanded||this.hasChild(t,n))&&this.updateConnectors(t,n,i+1)},t.prototype.updateSegments=function(t,e,i,r,o){var n=t.graphNodes[i.id];n.tree.assistants.length?this.updateSegmentsForHorizontalOrientation(t,i,r,e):"Horizontal"===n.tree.orientation&&"Balanced"===n.tree.type?this.updateSegmentsForBalancedTree(t,e,i,r,o):"Horizontal"===n.tree.orientation?this.updateSegmentsForHorizontalOrientation(t,i,r,e):n.tree.offset<5?this.get5Points(t,i,r,e):this.get3Points(t,i,r,e)},t.prototype.updateSegmentsForBalancedTree=function(t,e,i,r,o){var n,a=t.graphNodes[i.id];if(5===a.tree.children.length&&o>2){n=a.tree.children[1],isNaN(t.graphNodes[n].treeWidth)&&(t.graphNodes[n].treeWidth=t.nameTable[n].actualSize.width);var s=3!==o?1:-1;-1!==t.orientation.indexOf("Left")?t.nameTable[n].offsetY-t.graphNodes[n].treeWidth/2-t.verticalSpacing*s/2:t.nameTable[n].offsetX+t.graphNodes[n].treeWidth/2+t.horizontalSpacing*s/2,this.getSegmentsForMultipleRows(t,i,r,e)}else a.tree.children.length>5?o<4?this.getSegmentsForMultipleRows(t,i,r,e):this.updateSegmentsForHorizontalOrientation(t,i,r,e):4===a.tree.children.length?o<2?this.getSegmentsForMultipleRows(t,i,r,e):this.updateSegmentsForHorizontalOrientation(t,i,r,e):this.getSegmentsForMultipleRows(t,i,r,e)},t.prototype.get3Points=function(t,e,i,r){var o=[],n=this.getBounds(e),a=this.getBounds(i);if(-1!==t.orientation.indexOf("Top")){var s=0===t.orientation.indexOf("Top")?n.bottomCenter:n.topCenter,h=e.offsetX>i.offsetX?a.middleRight:a.middleLeft;o.push(s,{x:n.bottomCenter.x,y:h.y},h)}else{s=0===t.orientation.indexOf("Left")?n.middleRight:n.middleLeft,h=e.offsetY>i.offsetY?a.bottomCenter:a.topCenter;o.push(s,{x:a.bottomCenter.x,y:n.middleRight.y},h)}this.getSegmentsFromPoints(o,r)},t.prototype.get5Points=function(t,e,i,r){var o,n,a,s,h=[],d=this.getBounds(e),l=this.getBounds(i);t.graphNodes[e.id];-1!==t.orientation.indexOf("Top")?(o=e.offsetY<i.offsetY?d.bottomCenter:d.topCenter,s=t.verticalSpacing/4*(e.offsetY<i.offsetY?1:-1),a=t.horizontalSpacing/2*(e.offsetX>i.offsetX?1:-1),n=e.offsetX>i.offsetX?l.middleRight:l.middleLeft,h.push(o,{x:o.x,y:o.y+s},{x:n.x+a,y:o.y+s},{x:n.x+a,y:n.y},n)):(o=e.offsetX>i.offsetX?d.middleLeft:d.middleRight,n=e.offsetY>i.offsetY?l.bottomCenter:l.topCenter,a=t.horizontalSpacing/4*(e.offsetX<i.offsetX?1:-1),s=t.verticalSpacing/2*(e.offsetY>i.offsetY?1:-1),h.push(o,{x:o.x+a,y:o.y},{x:o.x+a,y:o.y+s},{x:n.x,y:o.y+s},n)),this.getSegmentsFromPoints(h,r)},t.prototype.getSegmentsFromPoints=function(t,e){for(var i,r=[],o=0;o<t.length-2;o++)(i=new No(e,"segments",{type:"Orthogonal"},!0)).direction=wr.direction(t[o],t[o+1]),i.length=wr.distancePoints(t[o],t[o+1]),r.push(i);e.segments=r},t.prototype.getSegmentsForMultipleRows=function(t,e,i,r){var o,n,a=[],s=this.getBounds(i),h=this.getBounds(e);switch(t.orientation){case"TopToBottom":o={x:h.bottomCenter.x,y:h.bottomCenter.y+t.verticalSpacing/4},(n=new No(r,"segments",{type:"Orthogonal"},!0)).direction=wr.direction(h.bottomCenter,o),n.length=wr.distancePoints(h.bottomCenter,o),a.push(n);break;case"BottomToTop":o={x:h.bottomCenter.x,y:h.topCenter.y-t.verticalSpacing/4},(n=new No(r,"segments",{type:"Orthogonal"},!0)).direction=wr.direction(h.topCenter,o),n.length=wr.distancePoints(h.topCenter,o),a.push(n);break;case"LeftToRight":if(o={x:h.middleRight.x+t.verticalSpacing/4,y:h.middleRight.y},n=new No(r,"segments",{type:"Orthogonal"},!0),n.direction=wr.direction(h.middleRight,o),n.length=wr.distancePoints(h.middleRight,o),a.push(n),s.center.y!==h.center.y){var d={x:h.middleRight.x+t.verticalSpacing/4,y:s.middleLeft.y};(n=new No(r,"segments",{type:"Orthogonal"},!0)).direction=wr.direction(o,d),n.length=wr.distancePoints(o,d),a.push(n)}break;case"RightToLeft":if(o={x:h.middleLeft.x-t.verticalSpacing/4,y:h.middleRight.y},n=new No(r,"segments",{type:"Orthogonal"},!0),n.direction=wr.direction(h.middleLeft,o),n.length=wr.distancePoints(h.middleLeft,o),a.push(n),s.center.y!==h.center.y){var l={x:h.middleLeft.x-t.verticalSpacing/4,y:s.middleLeft.y};(n=new No(r,"segments",{type:"Orthogonal"},!0)).direction=wr.direction(l,l),n.length=wr.distancePoints(l,l),a.push(n)}}r.segments=a},t.prototype.updateSegmentsForHorizontalOrientation=function(t,e,i,r){var o,n,a=[],s=this.getBounds(e),h=this.getBounds(i);switch(t.orientation){case"TopToBottom":o={x:s.bottomCenter.x,y:h.topCenter.y-t.verticalSpacing/2},(n=new No(r,"segments",{type:"Orthogonal"},!0)).direction=wr.direction(s.bottomCenter,o),n.length=wr.distancePoints(s.bottomCenter,o),a.push(n);break;case"BottomToTop":o={x:s.topCenter.x,y:h.bottomCenter.y+t.verticalSpacing/2},(n=new No(r,"segments",{type:"Orthogonal"},!0)).direction=wr.direction(s.topCenter,o),n.length=wr.distancePoints(s.topCenter,o),a.push(n);break;case"LeftToRight":if(o={x:h.middleLeft.x-t.verticalSpacing/2,y:s.middleRight.y},n=new No(r,"segments",{type:"Orthogonal"},!0),n.direction=wr.direction(s.middleRight,o),n.length=wr.distancePoints(s.middleRight,o),a.push(n),h.center.y!==s.center.y){var d={x:h.middleLeft.x-t.verticalSpacing/2,y:h.middleLeft.y};(n=new No(r,"segments",{type:"Orthogonal"},!0)).direction=wr.direction(o,d),n.length=wr.distancePoints(o,d),a.push(n)}break;case"RightToLeft":if(o={x:h.middleRight.x+t.verticalSpacing/2,y:s.middleRight.y},n=new No(r,"segments",{type:"Orthogonal"},!0),n.direction=wr.direction(s.middleLeft,o),n.length=wr.distancePoints(s.middleLeft,o),a.push(n),h.center.y!==s.center.y){var l={x:h.middleRight.x+t.verticalSpacing/2,y:h.middleLeft.y};(n=new No(r,"segments",{type:"Orthogonal"},!0)).direction=wr.direction(o,l),n.length=wr.distancePoints(o,l),a.push(n)}}return r.segments=a,[]},t.prototype.updateNodes=function(t,e,i,r,o,n){var a,s,h,d,l,c;if(h=e.actualSize.width,d=e.actualSize.height,!e.excludeFromLayout){l=t.anchorX,c=t.anchorY,"LeftToRight"===t.orientation?(l+=t.graphNodes[e.id].y+h/2,c+=t.graphNodes[e.id].x+i+d/2):"RightToLeft"===t.orientation?(l-=t.graphNodes[e.id].y+h/2,c+=t.graphNodes[e.id].x+i+d/2):"TopToBottom"===t.orientation?(l+=t.graphNodes[e.id].x+i+h/2,c+=t.graphNodes[e.id].y+d/2):(l+=t.graphNodes[e.id].x+i+h/2,c-=t.graphNodes[e.id].y+d/2),t.graphNodes&&(l+=o=o||0,c+=n=n||0,this.isAnimation||(e.offsetX=l,e.offsetY=c));var p={id:e.id,differenceX:l-e.offsetX,differenceY:c-e.offsetY};t.objects.push(p);var g=void 0;if(g=[],this.hasChild(t,e))for(a=0;a<t.graphNodes[e.id].tree.children.length;a++)s=t.nameTable[t.graphNodes[e.id].tree.children[a]],this.updateNodes(t,s,i+(t.graphNodes[e.id].subTreeTranslation||0),r,o,n),g.push(s);if(t.graphNodes[e.id].tree.assistants.length)for(a=0;a<t.graphNodes[e.id].tree.assistants.length;a++)s=t.nameTable[t.graphNodes[e.id].tree.assistants[a]],this.updateNodes(t,s,i+(t.graphNodes[e.id].subTreeTranslation||0),null,o,n)}},t}(),gs=function(){function t(){this.isAnimation=!1}return t.prototype.destroy=function(){},t.prototype.getModuleName=function(){return"MindMapChart"},t.prototype.updateLayout=function(t,e,i,r,o,n){var a;if(a=this.checkRoot(t,i,o,n,e))i.fixedNode=a;else for(var s=0,h=t;s<h.length;s++){if(!((m=h[s]).excludeFromLayout||m.inEdges&&m.inEdges.length)){i.fixedNode=m.id;break}}var d=e[i.fixedNode],l=this.findFirstLevelNodes(d,i,e),c=[],p=[],g=ir(i.getBranch);g=g||ir(this.getBranch);for(var u=0,f=l;u<f.length;u++){var m;"Left"===g(m=f[u],l)?c.push(m):p.push(m)}var y=new xr(0,0,r.x,r.y);e[i.fixedNode].offsetX=y.x+y.width/2,e[i.fixedNode].offsetY=y.y+y.height/2,c.length&&this.updateMindMapBranch(t,p,e,i,r,o,"Left"),p.length&&this.updateMindMapBranch(t,c,e,i,r,o,"Right")},t.prototype.checkRoot=function(t,e,i,r,o){for(var n=0,a=t;n<a.length;n++){var s=a[n];if(!s.excludeFromLayout){if(s.data&&(s.data[i].toString()===r||s.data[i].toString()===e.root))return s.id;if(!s.data&&s.id===e.root)return s.id}}return""},t.prototype.updateMindMapBranch=function(t,e,i,r,o,n,a){var s;(s={type:"HierarchicalTree",horizontalSpacing:r.verticalSpacing,verticalSpacing:r.horizontalSpacing,verticalAlignment:r.verticalAlignment,horizontalAlignment:r.horizontalAlignment,fixedNode:r.fixedNode,getLayoutInfo:ir(r.getLayoutInfo),margin:r.margin,root:r.fixedNode}).orientation="Left"===a?"LeftToRight":"RightToLeft",this.excludeFromLayout(e,i,!0);(new ps).updateLayout(t,i,s,o,n),this.excludeFromLayout(e,i,!1)},t.prototype.getBranch=function(t,e){return e.indexOf(t)%2==0?"Left":"Right"},t.prototype.excludeFromLayout=function(t,e,i){for(var r=0,o=t;r<o.length;r++){e[o[r].id].excludeFromLayout=i}},t.prototype.findFirstLevelNodes=function(t,e,i){var r=[];if(t&&t.outEdges.length)for(var o=0,n=t.outEdges;o<n.length;o++){var a=n[o];r.push(i[i[a].targetID])}return r},t}(),us=function(){function t(){}return t.prototype.destroy=function(){},t.prototype.getModuleName=function(){return"RadialTree"},t.prototype.updateLayout=function(t,e,i,r){var o={type:i.type,nameTable:e,anchorX:0,anchorY:0,firstLevelNodes:[],centerNode:null,levels:[],maxLevel:0,graphNodes:{},layoutNodes:[],orientation:i.orientation,horizontalSpacing:i.horizontalSpacing,verticalSpacing:i.verticalSpacing,verticalAlignment:i.verticalAlignment,horizontalAlignment:i.horizontalAlignment,fixedNode:i.fixedNode,margin:i.margin,bounds:i.bounds,objects:[],root:i.root};this.doLayout(o,t,e,r)},t.prototype.doLayout=function(t,e,i,r){for(var o,n=0;n<e.length;n++)(o=e[n]).excludeFromLayout||(t.graphNodes[o.id]=this.setUpLayoutInfo(t,o),o.inEdges&&o.inEdges.length||t.firstLevelNodes.push(o));t.root&&i[t.root]?t.centerNode=i[t.root]:t.firstLevelNodes.length&&(t.centerNode=t.firstLevelNodes[0],t.root=t.centerNode.id),t.centerNode&&(this.updateEdges(t,t.centerNode,0,i),this.depthFirstAllignment(t,t.centerNode,0,0),this.populateLevels(t),this.transformToCircleLayout(t),this.updateAnchor(t,r),this.updateNodes(t,t.centerNode,i))},t.prototype.updateEdges=function(t,e,i,r){var o=t.graphNodes[e.id];t.layoutNodes.push(o),o.level=i,o.visited=!0,t.maxLevel=Math.max(t.maxLevel,i);for(var n=0;n<e.outEdges.length;n++){var a=r[r[e.outEdges[n]].targetID];a.excludeFromLayout||a.visited||(o.children.push(a),this.updateEdges(t,a,i+1,r))}},t.prototype.depthFirstAllignment=function(t,e,i,r){var o,n=t.graphNodes[e.id];if(n.children.length){r+=300;for(var a=0;a<n.children.length;a++)i=(o=this.depthFirstAllignment(t,n.children[a],i,r)).x,r=o.y;n.children=n.children.sort(function(e,i){return t.graphNodes[e.id].x-t.graphNodes[i.id].x});var s=t.graphNodes[n.children[0].id].min,h=t.graphNodes[n.children[n.children.length-1].id].max;if(n.x=s+(h-s)/2,i=h+t.horizontalSpacing,n.segmentOffset=h+t.horizontalSpacing,n.x-=n.width/2,n.y-=n.height/2,n.min=s,n.max=h,n.x<s&&n.visited){n.x=s,i=n.x+n.width/2-(h-s)/2,n.visited=!1;for(a=0;a<n.children.length;a++)o=this.depthFirstAllignment(t,n.children[a],i,r);n.visited=!0,i=n.x+n.width+t.horizontalSpacing}i=i<(h=t.graphNodes[n.children[n.children.length-1].id].segmentOffset)?h:i,r-=300,n.y=r}else n.x=i,n.y=r,n.min=i,n.max=i+n.width,i+=n.width+t.horizontalSpacing;return{x:i,y:r}},t.prototype.populateLevels=function(t){var e=[],i=Math.min.apply(Math,t.layoutNodes.map(function(t){return t.x})),r=Math.max.apply(Math,t.layoutNodes.map(function(e){return e.x+e.width+t.horizontalSpacing}))-i;t.levels=[];for(var o=function(o){var n={};e=(e=t.layoutNodes.filter(function(t){return t.level===o?t:null})).sort(function(t,e){return t.x-e.x}),n.min=e[0].x,n.max=e[e.length-1].x+e[e.length-1].width+t.horizontalSpacing,n.actualCircumference=0,n.height=0;for(var a=0;a<e.length;a++)e[a].height>n.height&&(n.height=e[a].height),n.actualCircumference+=Math.max(e[a].width,e[a].height),a!==e.length-1&&(n.actualCircumference+=t.horizontalSpacing);n.circumference=n.max-n.min,n.actualCircumference<n.circumference&&(n.circumference=(n.circumference+n.actualCircumference)/2),n.radius=n.circumference/(2*Math.PI)+n.height,n.nodes=[],o>1&&t.levels[o-1].radius+t.levels[o-1].height>=n.radius&&(n.radius=t.levels[o-1].radius+t.levels[o-1].height);for(var s=0;s<e.length;s++)e[s].ratio=Math.abs(e[s].x+e[s].width/2-i)/r,n.nodes.push(e[s]);t.levels.push(n)},n=0;n<=t.maxLevel;n++)o(n)},t.prototype.transformToCircleLayout=function(t){var e=t.graphNodes[t.centerNode.id];e.x=0,e.y=0;for(var i=1;i<t.levels.length;i++)for(var r=0;r<t.levels[i].nodes.length;r++){var o=t.levels[i].nodes[r];o.x=Math.cos(360*o.ratio*Math.PI/180)*(t.levels[i].radius+t.verticalSpacing*i),o.y=Math.sin(360*o.ratio*Math.PI/180)*(t.levels[i].radius+t.verticalSpacing*i),t.anchorX=Math.min(t.anchorX,o.x),t.anchorY=Math.min(t.anchorY,o.y)}},t.prototype.updateAnchor=function(t,e){t.anchorX=t.centerNode.offsetX||e.x/2,t.anchorY=t.centerNode.offsetY||e.y/2},t.prototype.updateNodes=function(t,e,i){var r=t.graphNodes[e.id],o=r.x+t.anchorX,n=r.y+t.anchorY;e.offsetX+=o,e.offsetY+=n;for(var a=0;a<r.children.length;a++){var s=r.children[a];this.updateNodes(t,i[s.id],i)}},t.prototype.setUpLayoutInfo=function(t,e){var i={};return i.name=e.id,i.x=0,i.y=0,i.min=0,i.max=0,i.width=e.actualSize.width,i.height=e.actualSize.height,i.children=[],i.level=0,i.ratio=0,i.visited=!1,i},t}(),fs=function(){function t(t){this.velocityX=0,this.velocityY=0,this.nodes=[],this.graphNode=t;var e=fr(this.graphNode);this.location=e.center,this.nodes=[],t.treeInfo.parents||(t.treeInfo.parents=[]),t.treeInfo.children||(t.treeInfo.children=[]),this.nodes=t.treeInfo.parents.concat(t.treeInfo.children)}return t.prototype.applyChanges=function(){this.graphNode.treeInfo.center=this.location},t}(),ms=function(){function t(){this.cdCOEF=.442,this.cfMAXVELOCITY=50,this.cnMAXITERACTION=1e3,this.cnSPRINGLENGTH=100,this.mszMaxForceVelocity={width:this.cfMAXVELOCITY,height:this.cfMAXVELOCITY},this.springLength=0,this.springFactor=this.cdCOEF,this.maxIteration=this.cnMAXITERACTION,this.springLength=this.cnSPRINGLENGTH}return t.prototype.destroy=function(){},t.prototype.getModuleName=function(){return"SymmetricalLayout"},t.prototype.doGraphLayout=function(t){var e=this.selectedNode;e.treeInfo.Bounds=t.getModelBounds(t.nodes);var i=e.treeInfo.GraphNodes,r=this.convertGraphNodes(i),o=r.length;o=Math.min(this.maxIteration,o*o*o),this.preLayoutNodes(r,e.treeInfo.Bounds);for(var n=0,a=o;n<a;n++)this.makeSymmetricLayout(r),this.appendForces(r);this.resetGraphPosition(r,e)},t.prototype.preLayoutNodes=function(t,e){for(var i=Math.max(e?e.width:25,e?e.height:25),r=i/2,o=i/2,n=2*Math.PI/t.length,a=n,s=0;s<t.length;s++){var h=t[s];this.getForceNode(h).location={x:r+i*Number(Math.cos(a).toFixed(2)),y:o+i*Number(Math.sin(a).toFixed(2))},a-=n}},t.prototype.doLayout=function(t){this.selectedNode=t.selectedNode,this.doGraphLayout(t)},t.prototype.makeSymmetricLayout=function(t){for(var e,i,r=0;r<t.length;r++){for(var o=t[r],n=(e=this.getForceNode(o)).nodes,a=0;a<n.length;a++){mr((u=n[a]).id,t)&&this.calcNodesForce(e,this.getForceNode(u))}for(var s=0,h=n.length;s<h&&!(h<2);s++){var d=this.getForceNode(n[s]),l=s+1>=h?this.getForceNode(n[0]):this.getForceNode(n[s+1]),c=360/n.length/2*Math.PI/180,p=2*this.springLength*Math.sin(c);this.calcRelatesForce(d,l,p)}for(var g=0;g<t.length;g++){var u;mr((u=t[g]).id,n)||u.id===o.id||(i=this.getForceNode(u),this.updateNeigbour(e,i))}}},t.prototype.appendForces=function(t){for(var e=null,i=0;i<t.length;i++){var r=t[i],o=(e=this.getForceNode(r)).location;o.x+=Math.min(e.velocityX,this.mszMaxForceVelocity.width),o.y+=Math.min(e.velocityY,this.mszMaxForceVelocity.height),e.velocityX=0,e.velocityY=0,e.location=o}},t.prototype.resetGraphPosition=function(t,e){for(var i,r={width:Number.MAX_VALUE,height:Number.MAX_VALUE},o=null,n=0;n<t.length;n++){i=t[n];var a={x:(o=this.getForceNode(i)).location.x-i.actualSize.width/2,y:o.location.y-i.actualSize.height/2};r.width=Math.min(r.width,a.x),r.height=Math.min(r.height,a.y)}for(n=0;n<t.length;n++){i=t[n];(a=(o=this.getForceNode(i)).location).x-=r.width-(e.treeInfo.location?e.treeInfo.location.x:0),a.y-=r.height-(e.treeInfo.location?e.treeInfo.location.y:0),o.location=a,o.applyChanges()}},t.prototype.convertGraphNodes=function(t){for(var e=[],i=0,r=Object.keys(t);i<r.length;i++){var o=r[i];if(t[o]){var n=t[o],a=new fs(n);n.treeInfo.tag=a,e.push(n)}}return e},t.prototype.getForceNode=function(t){return t.treeInfo.tag},t.prototype.updateNeigbour=function(t,e){if(null!=e&&null!=t){var i=this.pointDistance(t.location,e.location),r=this.lineAngle(t.location,e.location),o=.9*this.springLength;i<o&&this.calcForce(i,o,r,e)}},t.prototype.lineAngle=function(t,e){var i=0,r=e.x-t.x,o=e.y-t.y;return 0===r?i=o<=0?3*Math.PI/2:Math.PI/2:0===o?i=r<0?Math.PI:0:(i=Math.atan(o/r),r<0&&o>0?i=Math.PI+i:r<0&&o<0?i=Math.PI+i:r>0&&o<0&&(i=2*Math.PI+i)),i},t.prototype.pointDistance=function(t,e){var i=0,r=e.x-t.x,o=e.y-t.y,n=r*r+o*o;return n>0&&(i=Math.sqrt(n)),i},t.prototype.calcRelatesForce=function(t,e,i){var r=this.pointDistance(t.location,e.location),o=this.lineAngle(t.location,e.location);r<i&&this.calcForce(r,i,o,e)},t.prototype.updateLayout=function(t,e,i,r,o,n){(new ys).updateLayout(t,e,i,r,o,n)},t.prototype.calcNodesForce=function(t,e){var i=this.pointDistance(t.location,e.location),r=this.lineAngle(t.location,e.location);(i>this.springLength||i<this.springLength)&&this.calcForce(i,this.springLength,r,e)},t.prototype.calcForce=function(t,e,i,r){var o=r.nodes.length,n=t-e,a=this.springFactor/(o*o)*Math.sqrt(o);if(0!==n){var s=n*a,h=Math.cos(i)*s,d=Math.sin(i)*s;r.velocityX-=h,r.velocityY-=d}},t}(),ys=function(){function t(){this.visitedStack=[],this.cycleEdgesCollection=[],this.graphObjects=[],this.passedNodes=[]}return t.prototype.updateLayout=function(t,e,i,r,o,n){this.nameTable=r,this.nodes=t,this.connectors=e;var a=t;a.length>0&&(this.mhelperSelectedNode=Xi(a[0]));for(var s=0,h=t;s<h.length;s++){var d=void 0;(d=f=h[s]).treeInfo={},d.treeInfo.graphType="Node",this.graphObjects.push(d)}for(var l=0,c=e;l<c.length;l++){var p=void 0;(p=c[l]).treeInfo={},p.treeInfo.graphType="Connector",this.graphObjects.push(p)}this.updateLayout1(this.graphObjects,i);for(var g=this.getModelBounds(a),u=0;u<a.length;u++){var f=a[u],m=(n.x-g.width)/2,y=o.margin||{};y.left=y.left||0,y.right=y.right||0,y.top=y.top||0,y.bottom=y.bottom||0,o.margin.left&&(y.left=o.margin.left),o.margin.top&&(y.top=o.margin.top);var v=f.treeInfo.tag.location.x-(f.offsetX-f.actualSize.width/2)-g.x+m+y.left,b=f.treeInfo.tag.location.y-(f.offsetY-f.actualSize.height/2)-g.y+y.top;f.offsetX+=v,f.offsetY+=b,delete f.treeInfo}return!0},t.prototype.getModelBounds=function(t){t=t.slice();for(var e,i=null,r=null,o=0;o<t.length;o++){var n=fr(e=t[o]);i=new xr(e.treeInfo.tag?e.treeInfo.tag.location.x:n.x,e.treeInfo.tag?e.treeInfo.tag.location.y:n.y,e.actualSize.width,e.actualSize.height),r=r?r.uniteRect(i):i}return r},t.prototype.updateLayout1=function(t,e){this.detectCyclesInGraph(t);var i=t.length;if(i>0){for(var r=[],o=[],n=[],a=0;a<t.length;a++){var s=t[a];void 0===s.treeInfo.isCycleEdge&&(s.treeInfo.isCycleEdge=!1),"Connector"!==s.treeInfo.graphType||s.treeInfo.isCycleEdge?"Connector"===s.treeInfo.graphType?r.push(s):n.push(s):o.push(s)}for(o=o.concat(n),o=r.concat(o);i>this.dictionaryLength(this.passedNodes);)if(this.getNodesToPosition(o),null!=this.selectedNode){e.doLayout(this),this.selectedNode=null,this.visitedStack=[];for(var h=0,d=this.cycleEdgesCollection;h<d.length;h++){d[h].treeInfo.isCycleEdge=!1}}this.passedNodes=null,this.selectedNode=null}return!1},t.prototype.getNodesToPosition=function(t){for(var e=0;e<t.length;e++){var i=t[e];if(!mr(i.id,this.passedNodes)){i&&this.selectNodes(i);break}}},t.prototype.selectNodes=function(t){var e=t;"Connector"===t.treeInfo.graphType?this.exploreGraphEdge(t):null!=e&&this.addNode(t,"passed")&&(this.addNode(t,"selected"),this.isConnectedToAnotherNode(e)?(this.selectedNode={treeInfo:{}},this.selectedNode.treeInfo.LeftMargin=10,this.selectedNode.treeInfo.TopMargin=10,this.selectConnectedNodes(e)):this.selectedNode=t)},t.prototype.selectConnectedNodes=function(t){var e=this.selectedNode;e.treeInfo.GraphNodes||(e.treeInfo.GraphNodes={});var i=t;if(null!=i&&this.addNode(i,"passed")){var r=i.id;if(this.dictionaryContains(e.treeInfo.GraphNodes,i)){var o=e.treeInfo.GraphNodes[r];o.treeInfo.Added&&(o.treeInfo.Added=!1,this.getConnectedRelatives(o),this.exploreRelatives(t))}else{var n=this.addGraphNode(i);this.getConnectedRelatives(n),this.exploreRelatives(t)}}},t.prototype.exploreRelatives=function(t){this.exploreRelatives1(t,"Parents"),this.exploreRelatives1(t,"Children")},t.prototype.exploreRelatives1=function(t,e){var i=[];"Parents"===e?i=t.inEdges:"Children"===e&&(i=t.outEdges);for(var r=0;r<i.length;r++){var o=this.nameTable[i[r]];if(this.addNode(o,"passed")){var n=this.nameTable[o.sourceID],a=this.nameTable[o.targetID];"Parents"===e&&null!=n&&mr(n.id,this.nodes)?this.selectConnectedNodes(this.nameTable[o.sourceID]):"Children"===e&&null!=a&&mr(a.id,this.nodes)&&this.selectConnectedNodes(this.nameTable[o.targetID])}}},t.prototype.getConnectedRelatives=function(t){this.getConnectedParents(t),this.getConnectedChildren(t)},t.prototype.dictionaryContains=function(t,e){for(var i=Object.keys(t),r=0;r<i.length;r++)if(i[r]===e.id)return!0;return!1},t.prototype.dictionaryLength=function(t){return Object.keys(t).length},t.prototype.getConnectedChildren=function(t){for(var e=this.selectedNode,i=t,r=0;r<i.outEdges.length;r++){var o=this.nameTable[i.outEdges[r]];if(!o.treeInfo.isCycleEdge){var n=this.nameTable[o.targetID];if(mr(n.id,this.nodes)&&null!=n&&n.visible){var a=void 0;this.dictionaryContains(e.treeInfo.GraphNodes,n)?a=e.treeInfo.GraphNodes[n.id]:(a=this.addGraphNode(n)).treeInfo.Added=!0,t.treeInfo.children||(t.treeInfo.children=[]),a.treeInfo.parents||(a.treeInfo.parents=[]),this.setNode(a.treeInfo.parents,t),this.findNode(t.treeInfo.children,a.id)<0&&t.treeInfo.children.push(a)}}}},t.prototype.getConnectedParents=function(t){for(var e=this.selectedNode,i=t,r=0;r<i.inEdges.length;r++){var o=this.nameTable[i.inEdges[r]];if(!o.treeInfo.isCycleEdge){var n=this.nameTable[o.sourceID];if(mr(n.id,this.nodes)&&null!=n&&n.visible){var a=void 0;this.dictionaryContains(e.treeInfo.GraphNodes,n)?a=e.treeInfo.GraphNodes[n.id]:(a=this.addGraphNode(n)).treeInfo.Added=!0,t.treeInfo.parents||(t.treeInfo.parents=[]),a.treeInfo.children||(a.treeInfo.children=[]),this.setNode(a.treeInfo.children,t),this.findNode(t.treeInfo.parents,a.id)<0&&t.treeInfo.parents.push(a)}}}},t.prototype.setNode=function(t,e){var i=this.findNode(t,e.id);i>=0&&i<t.length?t[i]=e:t.push(e)},t.prototype.findNode=function(t,e){var i=-1;if(null!=t&&""!==e)for(var r=0,o=t.length;r<o;r++){var n=t[r];if("string"==typeof n&&n===e){i=r;break}if(null!=n&&n.id===e){i=r;break}}return i},t.prototype.addGraphNode=function(t){var e=this.selectedNode;e.treeInfo.GraphNodes||(e.treeInfo.GraphNodes={});var i=t;if(null!=e){e.treeInfo.GraphNodes[i.id]=i;var r=this.mhelperSelectedNode;null!=r&&t.id===r.id&&(this.mhelperSelectedNode=i)}return i},t.prototype.isConnectedToAnotherNode=function(t){var e=!1;return t.inEdges.concat(t.outEdges).length>0&&(null!=t.inEdges&&t.inEdges.length>0&&(e=this.searchEdgeCollection(t.inEdges,"FromNode")),!e&&null!=t.outEdges&&t.outEdges.length>0&&(e=this.searchEdgeCollection(t.outEdges,"ToNode"))),e},t.prototype.searchEdgeCollection=function(t,e){for(var i=!1,r=0;r<t.length-1;r++){var o=this.nameTable[t[r]];if(this.addNode(o,"passed")&&(!o.treeInfo.isCycleEdge&&("FromNode"===e&&null!=this.nameTable[o.sourceID]||"ToNode"===e&&null!=this.nameTable[o.targetID]))){i=!0;break}}return i},t.prototype.exploreGraphEdge=function(t){var e=t;if(null!=e&&!e.treeInfo.isCycleEdge&&this.addNode(t,"passed")){this.addNode(t,"selected");var i=this.nameTable[e.sourceID],r=this.nameTable[e.targetID];null!=i?this.selectNodes(i):null!=r?this.selectNodes(r):this.selectedNode=t}},t.prototype.addNode=function(t,e){var i=t;return"passed"!==e&&i.visible||this.dictionaryContains(this.passedNodes,i)||(this.passedNodes[i.id]=i),!!i.visible},t.prototype.detectCyclesInGraph=function(t){for(var e=[],i=[],r=0;r<t.length;r++)"Connector"!==t[r].treeInfo.graphType&&e.push(t[r]);if(e.length>0)for(i.push(e[0]),this.visitedStack.push(e[0]);i.length>0;){var o=i[i.length-1],n=this.getUnVisitedChildNodes(o);if(n.length>0){var a=n[0],s=n[n.length-1];mr(a.id,this.visitedStack)?(s.treeInfo.isCycleEdge=!0,this.cycleEdgesCollection.push(s)):(i.push(a),this.visitedStack.splice(0,0,a))}else i.pop()}},t.prototype.getUnVisitedChildNodes=function(t){var e=[];if(t.outEdges.length>0){for(var i=0;i<t.outEdges.length;i++){var r=this.nameTable[t.outEdges[i]];if(!mr(r.id,this.visitedStack)){var o=this.nameTable[r.targetID];return null!=o&&e.push(o),e.push(r),this.visitedStack.splice(0,0,r),e}}return e}return e},t}(),vs=function(){function t(){}return t.prototype.destroy=function(){},t.prototype.getModuleName=function(){return"ComplexHierarchicalTree"},t.prototype.doLayout=function(t,e,i,r){(new bs).doLayout(t,e,i,r)},t}(),bs=function(){function t(){this.nameTable={},this.crossReduction=new xs}return t.prototype.createVertex=function(t,e,i,r,o,n){return{value:e,geometry:{x:i,y:r,width:o,height:n},name:e,vertex:!0,inEdges:t.inEdges.slice(),outEdges:t.outEdges.slice()}},t.prototype.getEdges=function(t){var e=[];if(t){for(var i=0;t.inEdges.length>0&&i<t.inEdges.length;i++)e.push(this.nameTable[t.inEdges[i]]);for(i=0;t.outEdges.length>0&&i<t.outEdges.length;i++)e.push(this.nameTable[t.outEdges[i]])}return e},t.prototype.findRoots=function(t){for(var e=[],i=null,r=-1e5,o=0,n=Object.keys(t);o<n.length;o++){for(var a=t[n[o]],s=this.getEdges(a),h=0,d=0,l=0;l<s.length;l++){this.getVisibleTerminal(s[l],!0).name===a.name?h++:d++}0===d&&h>0&&e.push(a);var c=h-d;c>r&&(r=c,i=a)}return 0===e.length&&null!=i&&e.push(i),e},t.prototype.getVisibleTerminal=function(t,e){var i=this.nameTable[t.targetID];e&&(i=this.nameTable[t.sourceID]);for(var r=0;r<this.vertices.length;r++)if(this.vertices[r].name===i.id)return this.vertices[r];return null},t.prototype.traverse=function(t,e,i,r,o,n){if(null!=t){var a=t.name;if(null==n||null!=n[a]){null==r[a]&&(r[a]=t),null!=n&&delete n[a];for(var s=this.getEdges(t),h=[],d=0;d<s.length;d++)h[d]=this.getVisibleTerminal(s[d],!0)===t;for(d=0;d<s.length;d++)if(!e||h[d]){for(var l=this.getVisibleTerminal(s[d],!h[d]),c=1,p=0;p<s.length;p++)if(p!==d){var g=h[p];this.getVisibleTerminal(s[p],!g)===l&&(g?c++:c--)}c>=0&&(r=this.traverse(l,e,s[d],r,o,n))}}else if(null==r[a])for(d=0;d<o.length;d++){var u=o[d];if(null!=u[a]){for(var f=0,m=Object.keys(u);f<m.length;f++){var y=m[f];r[y]=u[y]}return o.splice(d,1),r}}}return r},t.prototype.getModelBounds=function(t){t=t.slice();for(var e=null,i=null,r=0;r<t.length;r++)if(e=t[r].geometry,i){var o=Math.max(i.x+i.width,e.x+e.width),n=Math.max(i.y+i.height,e.y+e.height);i.x=Math.min(i.x,e.x),i.y=Math.min(i.y,e.y),i.width=o-i.x,i.height=n-i.y}else i={x:e.x,y:e.y,width:e.width,height:e.height};return i},t.prototype.doLayout=function(t,e,i,r){this.nameTable=e;var o={horizontalSpacing:i.horizontalSpacing,verticalSpacing:i.verticalSpacing,orientation:i.orientation,marginX:i.margin.left,marginY:i.margin.top};"BottomToTop"===o.orientation?o.marginY=-i.margin.top:"RightToLeft"===o.orientation&&(o.marginX=-i.margin.left),this.vertices=[];for(var n={},a=0;a<t.length;a++){var s=this.createVertex(t[a],t[a].id,0,0,t[a].actualSize.width,t[a].actualSize.height);this.vertices.push(s),n[s.name]=s}var h,d=[];h=this.findRoots(n);for(a=0;a<h.length;a++){var l={};d.push(l),this.traverse(h[a],!0,null,l,d,n)}var c={marginX:0,marginY:0};for(a=0;a<d.length;a++){l=d[a];for(var p=[],g=0,u=Object.keys(l);g<u.length;g++){var f=u[g];p.push(l[f])}var m=new ws(this,p,h,o);this.cycleStage(m),this.layeringStage(m),this.crossingStage(m),c=this.placementStage(m,c.marginX,c.marginY)}var y=this.getModelBounds(this.vertices),v=(r.x-y.width)/2;for(a=0;a<this.vertices.length;a++){var b=this.vertices[a];if(b){var w=this.nameTable[b.name];w.offsetX=0,w.offsetY=0;var x=b.geometry.x-(w.offsetX-w.actualSize.width/2)+o.marginX,S=b.geometry.y-(w.offsetY-w.actualSize.height/2)+o.marginY,P=x,C=S;"BottomToTop"===o.orientation?C=y.height-S:"RightToLeft"===o.orientation&&(P=y.width-x),P+=v,w.offsetX+=P-w.offsetX,w.offsetY+=C-w.offsetY}}},t.prototype.placementStage=function(t,e,i){var r=this.coordinateAssignment(e,i,parent,t);return r.model=t,r.widestRankValue=null,this.placementStageExecute(r),{marginX:r.marginX+t.layout.horizontalSpacing,marginY:r.marginY+t.layout.verticalSpacing}},t.prototype.coordinateAssignment=function(t,e,i,r){var o={};return"TopToBottom"===r.layout.orientation||"BottomToTop"===r.layout.orientation?(o.horizontalSpacing=r.layout.horizontalSpacing,o.verticalSpacing=r.layout.verticalSpacing):(o.horizontalSpacing=r.layout.verticalSpacing,o.verticalSpacing=r.layout.horizontalSpacing),o.orientation="north",o.marginX=o.marginX=t,o.marginY=o.marginY=e,o},t.prototype.calculateWidestRank=function(t,e,i){var r=!1;"LeftToRight"!==t.model.layout.orientation&&"RightToLeft"!==t.model.layout.orientation||(r=!0);var o=-t.verticalSpacing,n=0;t.rankSizes=[],t.rankOffset=[];for(var a=i.maxRank;a>=0;a--){for(var s=0,h=i.ranks[a],d=r?t.marginY:t.marginX,l=0;l<h.length;l++){var c=h[l];if(this.crossReduction.isVertex(c)){var p=c;if(p.cell&&(p.cell.inEdges||p.cell.outEdges)){var g=this.nameTable[p.cell.name];p.width=g.actualSize.width,p.height=g.actualSize.height,s=Math.max(s,r?p.width:p.height)}}else if(c){var u=c,f=1;null!=u.edges&&(f=u.edges.length),c.width=10*(f-1)}r&&(c.height||(c.height=0)),d+=(r?c.height:c.width)/2,this.setXY(c,a,d,!!r),this.setTempVariable(c,a,d),(d+=(r?c.height:c.width)/2+t.horizontalSpacing)>t.widestRankValue&&(t.widestRankValue=d,t.widestRank=a),t.rankSizes[a]=d}t.rankOffset[a]=o;var m=s/2+n/2+t.verticalSpacing;n=s,"north"===t.orientation||"west"===t.orientation?o+=m:o-=m;for(l=0;l<h.length;l++){var y=h[l];this.setXY(y,a,o,!r)}}},t.prototype.setTempVariable=function(t,e,i){this.crossReduction.isVertex(t)?t.temp[0]=i:t.temp[e-t.minRank-1]=i},t.prototype.setXY=function(t,e,i,r){t&&t.cell&&(t.cell.inEdges||t.cell.outEdges?r?t.y[0]=i:t.x[0]=i:r?t.y[e-t.minRank-1]=i:t.x[e-t.minRank-1]=i)},t.prototype.rankCoordinates=function(t,e,i,r){var o=!1;"LeftToRight"!==t.model.layout.orientation&&"RightToLeft"!==t.model.layout.orientation||(o=!0);for(var n=r.ranks[e],a=0,s=(o?t.marginY:t.marginX)+(t.widestRankValue-t.rankSizes[e])/2,h=0;h<n.length;h++){var d=n[h];if(this.crossReduction.isVertex(d)){var l=this.nameTable[d.cell.name];d.width=l.actualSize.width,d.height=l.actualSize.height,a=Math.max(a,d.height)}else{var c=d,p=1;null!=c.edges&&(p=c.edges.length),o?d.height=10*(p-1):d.width=10*(p-1)}var g=(o?d.height:d.width)/2;s+=g,this.setXY(d,e,s,!!o),this.setTempVariable(d,e,s),s+=g+t.horizontalSpacing}},t.prototype.initialCoords=function(t,e,i){this.calculateWidestRank(t,e,i);for(var r=t.widestRank;r>=0;r--)r<i.maxRank&&this.rankCoordinates(t,r,e,i);for(r=t.widestRank+1;r<=i.maxRank;r++)r>0&&this.rankCoordinates(t,r,e,i)},t.prototype.isAncestor=function(t,e){if(null!=e&&null!=t.hashCode&&null!=e.hashCode&&t.hashCode.length<e.hashCode.length){if(t.hashCode===e.hashCode)return!0;if(null==t.hashCode||null==t.hashCode)return!1;for(var i=0;i<t.hashCode.length;i++)if(t.hashCode[i]!==e.hashCode[i])return!1;return!0}return!1},t.prototype.weightedCellSorter=function(t,e){var i={};return i.cell=t||null,i.weightedValue=e||0,i.visited=!1,i.rankIndex=null,i},t.prototype.minNode=function(t,e){for(var i=[],r={map:{}},o=[],n=0;n<=e.maxRank;n++){o[n]=e.ranks[n];for(var a=0;a<o[n].length;a++){var s=o[n][a],h=this.weightedCellSorter(s,n);h.rankIndex=a,h.visited=!0,i.push(h),e.setDictionaryForSorter(r,s,h,!0)}}for(var d=10*i.length,l=0;i.length>0&&l<=d;){var c=i.shift(),p=c.cell,g=c.weightedValue,u=c.rankIndex,f=this.crossReduction.getConnectedCellsOnLayer(p,g),m=this.crossReduction.getConnectedCellsOnLayer(p,g,!0),y=f.length,v=m.length,b=this.medianXValue(t,f,g+1),w=this.medianXValue(t,m,g-1),x=y+v,S=this.crossReduction.getTempVariable(p,g),P=S;x>0&&(P=(b*y+w*v)/x);var C=!1,T=void 0;if(P<S-1)if(0===u)T=P,C=!0;else{var A=o[g][u-1],M=this.crossReduction.getTempVariable(A,g);(M=M+A.width/2+t.intraCellSpacing+p.width/2)<P?(T=P,C=!0):M<this.crossReduction.getTempVariable(p,g)-1&&(T=M,C=!0)}else if(P>S+1){if(u===o[g].length-1)T=P,C=!0;else{var L=o[g][u+1],O=this.crossReduction.getTempVariable(L,g);(O=O-L.width/2-t.intraCellSpacing-p.width/2)>P?(T=P,C=!0):O>this.crossReduction.getTempVariable(p,g)+1&&(T=O,C=!0)}}C&&(this.setTempVariable(p,g,T),this.updateNodeList(i,r,f,e),this.updateNodeList(i,r,m,e)),this.crossReduction.isVertex(c.cell)&&(c.visited=!1),l++}},t.prototype.updateNodeList=function(t,e,i,r){for(var o=0;o<i.length;o++){var n=i[o],a=r.getDictionaryForSorter(e,n);null!=a&&!1===a.visited&&(a.visited=!0,t.push(a))}},t.prototype.medianXValue=function(t,e,i){if(0===e.length)return 0;for(var r=[],o=0;o<e.length;o++)r[o]=this.crossReduction.getTempVariable(e[o],i);if(r.sort(function(t,e){return t-e}),e.length%2==1)return r[Math.floor(e.length/2)];var n=e.length/2;return(r[n-1]+r[n])/2},t.prototype.placementStageExecute=function(t){var e=!1;"LeftToRight"!==t.model.layout.orientation&&"RightToLeft"!==t.model.layout.orientation||(e=!0),t.jettyPositions={};var i=t.model;e?t.currentYDelta=0:t.currentXDelta=0,this.initialCoords(t,{model:i},i),this.minNode(t,i);var r=1e8;t.maxIterations||(t.maxIterations=8);for(var o=0;o<t.maxIterations;o++){if((e?t.currentYDelta:t.currentXDelta)<r){for(var n=0;n<i.ranks.length;n++)for(var a=i.ranks[n],s=0;s<a.length;s++){var h=a[s];this.setXY(h,n,this.crossReduction.getTempVariable(h,n),!!e)}r=e?t.currentYDelta:t.currentXDelta}e?t.currentYDelta=0:t.currentXDelta=0}this.setCellLocations(t,i)},t.prototype.setCellLocations=function(t,e){for(var i=this.getValues(e.vertexMapper),r=0;r<i.length;r++)this.setVertexLocation(t,i[r])},t.prototype.garphModelsetVertexLocation=function(t,e,i,r){t.model;var o=e.geometry,n=null;return null!=o&&(n={x:i,y:r,width:o.width,height:o.height},o.x===i&&o.y===r||(e.geometry=n)),n},t.prototype.setVertexLocation=function(t,e){var i=!1;"LeftToRight"!==t.model.layout.orientation&&"RightToLeft"!==t.model.layout.orientation||(i=!0);var r=e.cell,o=e.x[0]-e.width/2,n=e.y[0]-e.height/2;this.garphModelsetVertexLocation(t,r,o,n),i?(t.marginY||(t.marginY=0),t.marginY=Math.max(t.marginY,n+e.height)):(t.marginX||(t.marginX=0),t.marginX=Math.max(t.marginX,o+e.width))},t.prototype.getValues=function(t){var e=[];if(t.map)for(var i=0,r=Object.keys(t.map);i<r.length;i++){var o=r[i];e.push(t.map[o])}return e},t.prototype.crossingStage=function(t){this.crossReduction.execute(t)},t.prototype.layeringStage=function(t){this.initialRank(t),this.fixRanks(t)},t.prototype.initialRank=function(t){for(var e=t.startNodes,i=t.getDictionaryValues(t.vertexMapper),r=e.slice();e.length>0;){for(var o=(c=e[0]).connectsAsTarget,n=c.connectsAsSource,a=!0,s=1e8,h=0;h<o.length;h++){if(5270620!==(u=o[h]).temp[0]){a=!1;break}var d=u.source;s=Math.min(s,d.temp[0]-1)}if(a){if(c.temp[0]=s,t.maxRank||(t.maxRank=1e8),t.maxRank=Math.min(t.maxRank,s),null!=n)for(h=0;h<n.length;h++){(u=n[h]).temp[0]=5270620;-1===(d=u.target).temp[0]&&(e.push(d),d.temp[0]=-2)}e.shift()}else{var l=e.shift();if(e.push(c),l===c&&1===e.length)break}}for(h=0;h<i.length;h++)i[h].temp[0]-=t.maxRank;for(h=0;h<r.length;h++)for(var c,p=0,g=(o=(c=r[h]).connectsAsSource,0);g<o.length;g++){var u;d=(u=o[g]).target;c.temp[0]=Math.max(p,d.temp[0]+1),p=c.temp[0]}t.maxRank=1e8-t.maxRank},t.prototype.fixRanks=function(t){t.fixRanks()},t.prototype.cycleStage=function(t){var e={};t.startNodes=[];for(var i=t.getDictionaryValues(t.vertexMapper),r=[],o=0;o<i.length;o++)i[o].temp[0]=-1,r[i[o].id]=i[o];var n=null;if(null!=t.roots){var a=t.roots;n=[];for(o=0;o<a.length;o++)n[o]=t.getDictionary(t.vertexMapper,a[o]),null!=n[o]&&t.startNodes.push(n[o])}t.visit("removeParentConnection",n,!0,null,{seenNodes:e,unseenNodes:r});var s=t.clone(e,null,!0);t.visit("removeNodeConnection",r,!0,s,{seenNodes:e,unseenNodes:r})},t.prototype.remove=function(t,e){var i=e.indexOf(t);return-1!==i&&e.splice(i,1),t},t.prototype.invert=function(t,e){var i=t.source;t.source=t.target,t.target=i,t.isReversed=!t.isReversed},t.prototype.getEdgesBetween=function(t,e,i){i=null!=i&&i;for(var r=this.getEdges(t),o=[],n=0;n<r.length;n++){var a=this.getVisibleTerminal(r[n],!0),s=this.getVisibleTerminal(r[n],!1);(a===t&&s===e||!i&&a===e&&s===t)&&o.push(r[n])}return o},t}(),ws=function(){function t(t,e,i,r){this.multiObjectIdentityCounter=0,this.dfsCount=0,this.hierarchicalUtil=new bs,this.roots=i,this.vertexMapper={map:{}};var o=[];this.layout=r,this.maxRank=1e8,this.hierarchicalLayout=t,this.createInternalCells(t,e,o);for(var n=0;n<e.length;n++){for(var a=o[n].connectsAsSource,s=0;s<a.length;s++){var h=a[s],d=h.edges;if(null!=d&&d.length>0){var l=d[0],c=t.getVisibleTerminal(l,!1),p=this.getDictionary(this.vertexMapper,c);o[n]===p&&(c=t.getVisibleTerminal(l,!0),p=this.getDictionary(this.vertexMapper,c)),null!=p&&o[n]!==p&&(h.target=p,0===p.connectsAsTarget.length&&(p.connectsAsTarget=[]),p.connectsAsTarget.indexOf(h)<0&&p.connectsAsTarget.push(h))}}o[n].temp[0]=1}}return t.prototype.createInternalCells=function(t,e,i){for(var r=0;r<e.length;r++){i[r]={x:[],y:[],temp:[],cell:e[r],id:e[r].name,connectsAsTarget:[],connectsAsSource:[]},this.setDictionary(this.vertexMapper,e[r],i[r]);var o=t.getEdges(e[r]);i[r].connectsAsSource=[];for(var n=0;n<o.length;n++){var a=t.getVisibleTerminal(o[n],!1);if(a!==e[r]){var s=t.getEdgesBetween(e[r],a,!1),h=t.getEdgesBetween(e[r],a,!0);if(null!=s&&s.length>0&&2*h.length>=s.length){for(var d={x:[],y:[],temp:[],edges:s,ids:[]},l=0;l<s.length;l++)d.ids.push(s[l].id);d.source=i[r],i[r].connectsAsSource||(i[r].connectsAsSource=[]),i[r].connectsAsSource.indexOf(d)<0&&i[r].connectsAsSource.push(d)}}}i[r].temp[0]=0}},t.prototype.fixRanks=function(){var t=[];this.ranks=[];for(var e=0;e<this.maxRank+1;e++)t[e]=[],this.ranks[e]=t[e];var i=null;if(null!=this.roots){var r=this.roots;i=[];for(e=0;e<r.length;e++){var o=r[e],n=this.getDictionary(this.vertexMapper,o);i[e]=n}}this.visit("updateMinMaxRank",i,!1,null,{seenNodes:null,unseenNodes:null,rankList:t})},t.prototype.updateMinMaxRank=function(t,e,i){i.seenNodes,i.unseenNodes;var r=i.parent,o=i.root,n=i.edge,a=i.rankList;if(o.maxRank||0===o.maxRank||(o.maxRank=-1),o.minRank||0===o.minRank||(o.minRank=-1),0===e&&o.maxRank<0&&o.minRank<0&&(a[o.temp[0]].push(o),o.maxRank=o.temp[0],o.minRank=o.temp[0],o.temp[0]=a[o.maxRank].length-1),null!=r&&null!=n){if(r.maxRank-o.maxRank>1){n.maxRank=r.maxRank,n.minRank=o.maxRank,n.temp=[],n.x=[],n.y=[];for(var s=n.minRank+1;s<n.maxRank;s++)a[s].push(n),this.hierarchicalUtil.setTempVariable(n,s,a[s].length-1)}}},t.prototype.setDictionary=function(t,e,i){var r=e.name,o=t.map[r];return t.map[r]=i,o},t.prototype.setDictionaryForSorter=function(t,e,i,r){var o=e.id,n=t.map[o];return t.map[o]=i,n},t.prototype.getDictionary=function(t,e){this.multiObjectIdentityCounter||0===this.multiObjectIdentityCounter||(this.multiObjectIdentityCounter=0);var i=e.name;return i?t.map[i]:e.layoutObjectId?t.map[e.layoutObjectId]:(e.layoutObjectId="graphHierarchyNode#"+this.multiObjectIdentityCounter++,e.layoutObjectId)},t.prototype.getDictionaryForSorter=function(t,e){this.multiObjectIdentityCounter||0===this.multiObjectIdentityCounter||(this.multiObjectIdentityCounter=0);var i=e.id;return i?t.map[i]:e.layoutObjectId?t.map[e.layoutObjectId]:(e.layoutObjectId="graphHierarchyNode#"+this.multiObjectIdentityCounter++,e.layoutObjectId)},t.prototype.getDictionaryValues=function(t){for(var e=[],i=0,r=Object.keys(t.map);i<r.length;i++){var o=r[i];e.push(t.map[o])}return e},t.prototype.visit=function(t,e,i,r,o){o.seenNodes,o.unseenNodes,o.rankList;if(null!=e){for(var n=0;n<e.length;n++){var a=e[n];null!=a&&(null==r&&(r=new Object),o.parent=null,o.root=a,o.edge=null,i?(a.hashCode=[],a.hashCode[0]=this.dfsCount,a.hashCode[1]=n,this.extendedDfs(t,r,n,0,o)):this.depthFirstSearch(t,r,0,o))}this.dfsCount++}},t.prototype.depthFirstSearch=function(t,e,i,r){r.seenNodes,r.unseenNodes,r.rankList,r.parent;var o=r.root;r.edge;if(null!=o){var n=o.id;if(null==e[n]){e[n]=o,this.updateConnectionRank(t,i,0,r);for(var a=o.connectsAsSource.slice(),s=0;s<a.length;s++){var h=a[s],d=h.target;r.parent=o,r.root=d,r.edge=h,this.depthFirstSearch(t,e,i+1,r)}}else this.updateConnectionRank(t,i,1,r)}},t.prototype.updateConnectionRank=function(t,e,i,r){var o=r.parent,n=r.root,a=r.edge;if("removeParentConnection"===t||"removeNodeConnection"===t){var s="removeNodeConnection"===t;this.removeConnectionEdge(o,n,a,e,r,s)}"updateMinMaxRank"===t&&this.updateMinMaxRank(e,i,r)},t.prototype.removeConnectionEdge=function(t,e,i,r,o,n){var a=o.seenNodes,s=o.unseenNodes;o.rankList;this.hierarchicalUtil.isAncestor(e,t)&&(this.hierarchicalUtil.invert(i,0),this.hierarchicalUtil.remove(i,t.connectsAsSource),n?(e.connectsAsSource.push(i),t.connectsAsTarget.push(i),this.hierarchicalUtil.remove(i,e.connectsAsTarget)):(t.connectsAsTarget.push(i),this.hierarchicalUtil.remove(i,e.connectsAsTarget),e.connectsAsSource.push(i))),a[e.id]=e,delete s[e.id]},t.prototype.extendedDfs=function(t,e,i,r,o){o.seenNodes,o.unseenNodes,o.rankList;var n=o.parent,a=o.root;o.edge;if(null!=a){if(null!=n&&(null==a.hashCode||a.hashCode[0]!==n.hashCode[0])){var s=n.hashCode.length+1;a.hashCode=n.hashCode.slice(),a.hashCode[s-1]=i}var h=a.id;if(null==e[h]){e[h]=a,this.updateConnectionRank(t,r,0,o);for(var d=a.connectsAsSource.slice(),l=0;l<d.length;l++){var c=d[l],p=c.target;o.parent=a,o.root=p,o.edge=c,this.extendedDfs(t,e,l,r+1,o)}}else this.updateConnectionRank(t,r,1,o)}},t.prototype.clone=function(t,e,i){if(i=null!=i&&i,null!=t&&"function"==typeof t.constructor){for(var r=t.constructor(),o=0,n=Object.keys(t);o<n.length;o++){var a=n[o];"layoutObjectId"!==a&&(null==e||e.indexOf(a)<0)&&(i||"object"!=typeof t[a])&&(r[a]=t[a])}return r}return null},t}(),xs=function(){function t(){}return t.prototype.calculateCrossings=function(t){for(var e=t.ranks.length,i=0,r=1;r<e;r++)i+=this.calculateRankCrossing(r,t);return i},t.prototype.getTempVariable=function(t,e){return t?this.isVertex(t)?t.temp[0]:t.temp[e-t.minRank-1]:0},t.prototype.calculateRankCrossing=function(t,e){for(var i=0,r=e.ranks[t],o=e.ranks[t-1],n=[],a=0;a<r.length;a++){for(var s=r[a],h=this.getTempVariable(s,t),d=this.getConnectedCellsOnLayer(s,t,!0),l=[],c=0;c<d.length;c++){var p=d[c],g=this.getTempVariable(p,t-1);l.push(g)}l.sort(function(t,e){return t-e}),n[h]=l}var u=[];for(a=0;a<n.length;a++)u=u.concat(n[a]);for(var f=1;f<o.length;)f<<=1;var m=2*f-1;f-=1;var y=[];for(a=0;a<m;++a)y[a]=0;for(a=0;a<u.length;a++){var v=u[a]+f;for(++y[v];v>0;)v%2&&(i+=y[v+1]),++y[v=v-1>>1]}return i},t.prototype.execute=function(t){this.nestedBestRanks=[];for(var e=0;e<t.ranks.length;e++)this.nestedBestRanks[e]=t.ranks[e].slice();var i=0,r=this.calculateCrossings(t);for(e=0;e<24&&i<2;e++){this.weightedMedian(e,t);var o=this.calculateCrossings(t);if(o<r){r=o,i=0;for(var n=0;n<this.nestedBestRanks.length;n++)for(var a=t.ranks[n],s=0;s<a.length;s++){var h=a[s];this.nestedBestRanks[n][h.temp[0]]&&(this.nestedBestRanks[n][h.temp[0]]=h)}}else{i++;for(n=0;n<this.nestedBestRanks.length;n++)for(a=t.ranks[n],s=0;s<a.length;s++){h=a[s];this.setTempVariable(h,n,s)}}if(0===r)break}var d=[],l=[];for(e=0;e<t.maxRank+1;e++)l[e]=[],d[e]=l[e];for(e=0;e<this.nestedBestRanks.length;e++)for(n=0;n<this.nestedBestRanks[e].length;n++)l[e].push(this.nestedBestRanks[e][n]);t.ranks=d},t.prototype.isVertex=function(t){return!(!t||!t.cell||!t.cell.inEdges&&!t.cell.outEdges)},t.prototype.weightedMedian=function(t,e){var i=t%2==0;if(i)for(var r=e.maxRank-1;r>=0;r--)this.medianRank(r,i);else for(r=1;r<e.maxRank;r++)this.medianRank(r,i)},t.prototype.getConnectedCellsOnLayer=function(t,e,i){void 0===i&&(i=!1);var r="nextLayerConnectedCells",o="connectsAsTarget";if(i&&(r="previousLayerConnectedCells",o="connectsAsSource"),t){if(this.isVertex(t)){if(null==t[r]){t[r]=[],t[r][0]=[];for(var n=0;n<t[o].length;n++){var a=t[o][n];void 0===a.maxRank&&(a.maxRank=-1),-1===a.maxRank||(i?a.minRank===e-1:a.maxRank===e+1)?t[r][0].push(i?a.target:a.source):t[r][0].push(a)}}return t[r][0]}if(null==t[r]){t[r]=[];for(n=0;n<t.temp.length;n++)t[r][n]=[],n===(i?0:t.temp.length-1)?t[r][n].push(i?t.target:t.source):t[r][n].push(t)}return t[r][e-t.minRank-1]}return null},t.prototype.medianValue=function(t,e){for(var i=[],r=0,o=0;o<t.length;o++){var n=t[o];i[r++]=this.getTempVariable(n,e)}if(i.sort(function(t,e){return t-e}),r%2==1)return i[Math.floor(r/2)];if(2===r)return(i[0]+i[1])/2;var a=r/2,s=i[a-1]-i[0],h=i[r-1]-i[a];return(i[a-1]*h+i[a]*s)/(s+h)},t.prototype.setTempVariable=function(t,e,i){t&&(t.temp[0]=i)},t.prototype.medianRank=function(t,e){for(var i=this.nestedBestRanks[t].length,r=[],o=[],n=0;n<i;n++){var a=this.nestedBestRanks[t][n],s={medianValue:0};s.cell=a;var h=void 0;h=e?this.getConnectedCellsOnLayer(a,t):this.getConnectedCellsOnLayer(a,t,!0);var d=void 0;d=e?t+1:t-1,null!=h&&0!==h.length?(s.medianValue=this.medianValue(h,d),r.push(s)):o[this.getTempVariable(a,t)]=!0}r.sort(this.compare);for(n=0;n<i;n++)if(null==o[n]){a=r.shift().cell;this.setTempVariable(a,t,n)}},t.prototype.compare=function(t,e){if(null!=t&&null!=e){if(e.medianValue>t.medianValue)return-1;if(e.medianValue<t.medianValue)return 1}return 0},t}(),Ss=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Ps=function(t,e,i,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},Cs=function(t){var e=t;return e.sourcePoint||e.targetPoint||e.sourceID||e.targetID||e.sourcePortID||e.targetPortID||e.sourceDecorator||e.targetDecorator?Wo:(t.shape&&(t.shape instanceof on||t.shape.type),En)},Ts=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Ss(i,t),Ps([e.Property("")],i.prototype,"id",void 0),Ps([e.Property()],i.prototype,"height",void 0),Ps([e.Property(!0)],i.prototype,"expanded",void 0),Ps([e.Property("")],i.prototype,"iconCss",void 0),Ps([e.Property("")],i.prototype,"title",void 0),Ps([e.CollectionFactory(Cs)],i.prototype,"symbols",void 0),i}(e.ChildProperty),As=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Ss(i,t),Ps([e.Property()],i.prototype,"width",void 0),Ps([e.Property()],i.prototype,"height",void 0),Ps([e.Complex({},wr)],i.prototype,"offset",void 0),i}(e.ChildProperty),Ms=function(i){function r(t,e){var r=i.call(this,t,e)||this;r.symbolTable={},r.childTable={},r.info="info",r.laneTable={},r.helper=function(t){var e,i=t.sender.target.id.split("_container")[0],o=r.symbolTable[i];if(o&&r.selectedSymbol){r.selectedSymbols=r.selectedSymbol.id===o.id?o:r.selectedSymbol;r.getMousePosition(t.sender);(e=r.getSymbolPreview(r.selectedSymbols,t.sender,r.element)).setAttribute("paletteId",r.element.id)}return e};for(var o,n,a=0;r&&r.palettes&&a<r.palettes.length;a++)for(var s=0;s<r.palettes[a].symbols.length;s++)o=r.palettes[a].symbols[s],n=t.palettes[a].symbols[s],o&&"UmlActivity"===o.shape.type&&Pe(n,o);return r}return Ss(r,i),r.prototype.onPropertyChanged=function(t,e){for(var i=!1,r=0,o=Object.keys(t);r<o.length;r++){switch(o[r]){case"width":this.element.style.width=this.width.toString();break;case"height":this.element.style.height=this.height.toString();break;case"symbolPreview":break;case"symbolWidth":case"symbolHeight":case"getSymbolInfo":i=!0;break;case"enableSearch":if(t.enableSearch)this.createTextbox();else{var n=document.getElementById(this.element.id+"_search");n&&n.parentNode.removeChild(n)}break;case"palettes":for(var a=0,s=Object.keys(t.palettes);a<s.length;a++){var h=s[a],d=Number(h);this.accordionElement.items[d]||(this.accordionElement.items[d]={header:t.palettes[d].title||"",expanded:t.palettes[d].expanded,iconCss:t.palettes[d].iconCss||""}),void 0!==t.palettes[d].iconCss&&(this.accordionElement.items[d].iconCss=t.palettes[d].iconCss||"",i=!0),void 0!==t.palettes[d].expanded&&(this.palettes[d].isInteraction?this.palettes[d].isInteraction=!1:(this.accordionElement.items[d].expanded=t.palettes[d].expanded,i=!0))}break;case"enableAnimation":this.enableAnimation?this.accordionElement.animation={expand:{duration:400},collapse:{duration:400}}:this.accordionElement.animation={expand:{duration:0},collapse:{duration:0}};break;case"expandMode":this.accordionElement.expandMode=this.expandMode,i=!0}}i&&this.refreshPalettes()},r.prototype.getPersistData=function(){return this.addOnPersist(["loaded"])},r.prototype.preRender=function(){var t=this;this.element.style.overflow="auto",this.element.style.height=this.height.toString(),this.element.style.width=this.width.toString(),this.enableSearch&&this.createTextbox();var e=Oi("div",{id:this.element.id+"_container"});this.accordionElement=new o.Accordion({expandMode:this.expandMode}),this.enableAnimation||(this.accordionElement.animation={expand:{duration:0},collapse:{duration:0}}),this.accordionElement.expanded=function(e){var i=t.accordionElement.items.indexOf(e.item);t.palettes[i].expanded=e.isExpanded,t.palettes[i].isInteraction=!0},this.element.appendChild(e);window.measureElement&&(window.measureElement=null),ji(),this.unWireEvents(),this.wireEvents()},r.prototype.render=function(){this.diagramRenderer=new Vn(this.element.id,new Yn,!1),this.svgRenderer=new Vn(this.element.id,new Yn,!0),this.updatePalettes(),this.accordionElement.appendTo("#"+this.element.id+"_container")},r.prototype.getModuleName=function(){return"SymbolPalette"},r.prototype.requiredModules=function(){var t=[];return t.push({member:"Bpmn",args:[]}),t},r.prototype.destroy=function(){if(this.allowDrag){this.draggable.destroy(),this.unWireEvents(),this.notify("destroy",{}),i.prototype.destroy.call(this);var t=document.getElementById(this.element.id+"_container");if(t){this.element.removeChild(t);var e="measureElement";window[e]&&(window[e].usageCount-=1,0===window[e].usageCount&&(window[e].parentNode.removeChild(window[e]),window[e]=null))}(t=document.getElementById(this.element.id+"_search"))&&t.parentNode.removeChild(t),this.element.classList.remove("e-symbolpalette")}},r.prototype.initSymbols=function(t){for(var e=[],i=0,r=0,o=0,n=t.symbols;o<n.length;o++){if("SwimLane"===(P=n[o]).shape.type){var a=P,s=P.shape,h="Horizontal"===s.orientation;if(s.isLane){i=h?this.symbolHeight-this.symbolHeight/2:this.symbolHeight-this.symbolHeight/4,r=h?this.symbolWidth-this.symbolWidth/4:this.symbolWidth-this.symbolWidth/2,this.laneTable[P.id]={height:i,width:r};var d=s.lanes[0].header,l=s.lanes[0].style,c=d.style,p={id:"header"+Hi(),shape:{type:"Basic",shape:"Rectangle"},width:h?d.width:a.width,height:h?a.height:d.height,style:c,annotations:[{content:d.content.content}]};p.offsetX=p.width/2,p.offsetY=p.height/2,this.addPaletteItem(t.id,p);var g={id:"lane"+Hi(),shape:{type:"Basic",shape:"Rectangle"},width:h?a.width-d.width:a.width,height:h?a.height:a.height-d.height,style:l};g.offsetX=h?p.width+g.width/2:g.width/2,g.offsetY=h?g.height/2:p.height+g.height/2,this.addPaletteItem(t.id,g),a.children=[p.id,g.id]}else s.isPhase&&(i=a.height?a.height:this.symbolHeight,r=a.width?a.width:this.symbolWidth,P.shape.type="Path",P.shape.data=h?"M20,"+i/2+" L"+(r-20)+","+i/2+"z":"M"+r/2+",20 L"+r/2+","+(i-20)+"z")}if(P instanceof En){var u=ir(this.getNodeDefaults);u&&u(P,this)}else if(P instanceof Wo){var f=ir(this.getConnectorDefaults);f&&f(P,this)}this.symbolTable[P.id]=P,P instanceof En&&P.children&&e.push(P)}for(var m=0;m<e.length;m++)for(var y=void 0,v=0;v<e[m].children.length;v++)(y=this.symbolTable[e[m].children[v]])&&(this.childTable[y.id]=y,y.parentId=e[m].id);for(var b=0,w=t.symbols;b<w.length;b++){(P=w[b])instanceof En&&P.children||this.prepareSymbol(P)}for(var x=0,S=e;x<S.length;x++){var P=S[x];this.prepareSymbol(P)}},r.prototype.renderPalette=function(t){var e="display:none;overflow:auto;";t.height&&(e+="height:"+t.height+"px");var i=Oi("div",{id:t.id,style:e});this.element.appendChild(i);var r={header:t.title,expanded:t.expanded,content:"#"+t.id,iconCss:t.iconCss};this.accordionElement.items.push(r),this.renderSymbols(t,i)},r.prototype.addPaletteItem=function(t,e){for(var i=0;i<this.palettes.length;i++){var r=this.palettes[i];if(-1!==r.id.indexOf(t)){for(var o=[void 0,r,"symbols",{},!0],n=new(Function.prototype.bind.apply(Cs(e),o)),a=0;a<Object.keys(e).length;a++)n[Object.keys(e)[a]]=e[Object.keys(e)[a]];r.symbols.push(n),n.children||this.prepareSymbol(n),this.symbolTable[n.id]=n;var s=document.getElementById(r.id);s&&s.appendChild(this.getSymbolContainer(n,s));break}}},r.prototype.removePaletteItem=function(t,e){for(var i,r=0;r<this.palettes.length;r++){var o=this.palettes[r];if(-1!==o.id.indexOf(t))for(var n=0,a=o.symbols;n<a.length;n++){var s=a[n];if(-1!==s.id.indexOf(e)){var h=o.symbols.indexOf(s);if(o.symbols.splice(h,1),s.children)for(var d=s.children,l=0;l<d.length;l++)delete this.symbolTable[d[l]];delete this.symbolTable[s.id];var c=document.getElementById(s.id+"_container");c.parentNode.removeChild(c),i=!0;break}}if(i)break}},r.prototype.prepareSymbol=function(t){var e,i,r,o,n,a=new Fo,s=t,h=new Qr,d=t instanceof En?t.initContainer():null;d&&!d.children&&(d.children=[]);var l=ir(this.getSymbolTemplate);if(l&&(n=l(t)),n||(s.children?n=this.getContainer(s,d):(n=t.init(this),t instanceof En&&t.parentId&&d.children.push(n))),!t.parentId){var c={width:this.symbolWidth,height:this.symbolHeight},p=ir(this.getSymbolInfo);if(p&&(c=p(t)),c=c||{},n.relativeMode="Object",n.horizontalAlignment=n.verticalAlignment="Center",h.style.strokeColor=h.style.fill="none",h.children=[n],n.measure(new yr),n.arrange(n.desiredSize),e=c.width=c.width||(void 0!==s.width?n.actualSize.width:void 0)||this.symbolWidth,r=c.height=c.height||(void 0!==s.height?n.actualSize.height:void 0)||this.symbolHeight,void 0!==e&&void 0!==r){var g=e,u=r,f=!!t.shape.isLane;void 0!==this.symbolWidth?g=f?this.laneTable[s.id].width:this.symbolWidth-this.symbolMargin.left-this.symbolMargin.right:e+=s.style.strokeWidth,void 0!==this.symbolHeight?u=f?this.laneTable[s.id].height:this.symbolHeight-this.symbolMargin.top-this.symbolMargin.bottom:r+=s.style.strokeWidth,c.description&&""!==c.description.text&&(u-=20),i=g/(n.width||e),o=u/(n.height||r),c.fit&&(i=g/c.width,o=u/c.height),e=g,r=u,i=o=Math.min(i,o),h.width=e,h.height=r,n.width=c.width,n.height=c.height,this.scaleSymbol(t,h,i,o,e,r)}else{var m=void 0;t instanceof Wo&&(m=ut(t)),n.width=t.width||m?m.width:n.actualSize.width,n.height=t.height||m?m.height:n.actualSize.height}t.wrapper=a,a.children=[h],n.pivot=a.pivot={x:0,y:0},a.id=n.id+"_symbol",a.style.fill=a.style.strokeColor="transparent",a.offsetX=t.style.strokeWidth/2,a.offsetY=t.style.strokeWidth/2,this.getSymbolDescription(c,e,a),a.measure(new yr),a.arrange(a.desiredSize),c.width=c.width||n.actualSize.width,c.height=c.height||n.actualSize.height,t[this.info]=c}t.parentId&&(d.measure(new yr(s.width,s.height)),d.arrange(d.desiredSize))},r.prototype.getContainer=function(t,e){e.measureChildren=!1;var i,r=t.children;e.children=[];for(var o=0;o<r.length;o++)this.symbolTable[r[o]]&&e.children.push(this.symbolTable[r[o]].wrapper);return e.measure(new yr(t.width,t.height)),e.arrange(e.desiredSize),0===e.bounds.x&&0===e.bounds.y||(hi(t,(i=e.bounds).x,i.y,this.symbolTable,!1,this),e=this.getContainer(t,e)),e},r.prototype.getSymbolDescription=function(t,e,i){if(t&&t.description&&t.description.text){var r=new Gr;t.description.overflow=t.description.overflow||"Ellipsis",t.description.wrap=t.description.wrap||"WrapWithOverflow",r.content=t.description.text,r.width=e,r.height=20,r.style.strokeColor="transparent",r.style.fill="transparent",r.style.strokeWidth=0,r.style.textWrapping=t.description.wrap,r.style.textOverflow=t.description.overflow,r.margin={left:0,right:0,top:0,bottom:5},i.children.push(r)}},r.prototype.renderSymbols=function(t,e){for(var i=0,r=t.symbols;i<r.length;i++){var o=r[i];o.parentId||this.getSymbolContainer(o,e)}},r.prototype.getSymbolPreview=function(t,e,i){var r,o,n,a=t.wrapper.children[0].desiredSize.width+t.style.strokeWidth,s=t.wrapper.children[0].desiredSize.height+t.style.strokeWidth,h=t.wrapper.children[0].children[0];if(void 0!==this.symbolPreview.width||void 0!==this.symbolPreview.height){a=(this.symbolPreview.width||a)-t.style.strokeWidth,s=(this.symbolPreview.height||s)-t.style.strokeWidth,o=a/h.actualSize.width,n=s/h.actualSize.height,o=n=Math.min(o,n);var d=h.actualSize.width*o,l=h.actualSize.height*n;t.wrapper.children[0].width=a,t.wrapper.children[0].height=s,this.measureAndArrangeSymbol(h,t instanceof En),this.scaleSymbol(t,t.wrapper.children[0],o,n,d,l,!0),a=d,s=l}var c={x:h.offsetX,y:h.offsetY};h.offsetX=h.offsetY=t.style.strokeWidth/2,h.pivot={x:0,y:0},this.measureAndArrangeSymbol(h,t instanceof En);var p,g=Oi("div",{draggable:"true",class:"e-dragclone",style:"pointer-events:none"});document.body.appendChild(g);var u="margin:5px;";if("Native"===t.shape.type){r=Ii("svg",{id:t.id+"_preview",width:Math.ceil(a)+1,height:Math.ceil(s)+1});var f=Ii("g",{id:t.id+"_g"});r.appendChild(f),g.appendChild(r),this.svgRenderer.renderElement(h,f,void 0,void 0,r)}else if("HTML"===t.shape.type)p=this.getHtmlSymbol(t,r,g,s,a,!0);else if(t.children&&t.children.length>0&&Ae(t,"HTML",this.childTable))p=this.getGroupParent(t,r,g,t.wrapper.actualSize.height,t.wrapper.actualSize.width,!0);else{r=Xn.createCanvas(t.id+"_preview",2*(Math.ceil(a)+t.style.strokeWidth+1),2*(Math.ceil(s)+t.style.strokeWidth+1)),g.appendChild(r),u+="transform:scale(0.5);",r.setAttribute("transform-origin","0 0");var m=2;t instanceof Wo&&(m=1.9),r.getContext("2d").setTransform(m,0,0,m,0,0),this.diagramRenderer.renderElement(h,r,void 0)}return(p&&("HTML"===t.shape.type||t.children&&t.children.length>0)?p:r).setAttribute("style",u),h.offsetX=c.x,h.offsetY=c.y,g},r.prototype.measureAndArrangeSymbol=function(e,i){e.children&&!i&&(e.children[0].transform=t.Transform.Self),e.measure(new yr),e.arrange(e.desiredSize),e.children&&(e.children[0].transform=t.Transform.Parent)},r.prototype.updateSymbolSize=function(t,e,i){var r=t.wrapper.children[0].children[0],o=t.style.strokeWidth;r.width=(e||r.width)-(o+1),r.height=(i||r.height)-(o+1),t.wrapper.measure(new yr),t.wrapper.arrange(t.wrapper.desiredSize)},r.prototype.getSymbolContainer=function(t,e,i){var r=this.symbolTable[t.id][this.info],o=this.getSymbolSize(t,r),n=o.width+1,a=o.height+1,s=Oi("div",{id:t.id+"_container",style:"width:"+n+"px;height:"+a+"px;float:left;overflow:hidden",title:r.description?r.description.text:t.id});e.appendChild(s);var h,d,l;if("Native"===t.shape.type)h=Ii("svg",{id:t.id,width:Math.ceil(t.wrapper.actualSize.width)+1,height:Math.ceil(t.wrapper.actualSize.height)+1}),d=Ii("g",{id:t.id+"_g"}),h.appendChild(d),s.appendChild(h),this.updateSymbolSize(t),this.svgRenderer.renderElement(t.wrapper,d,void 0,void 0,h);else if("HTML"===t.shape.type)l=this.getHtmlSymbol(t,h,s,t.wrapper.actualSize.height,t.wrapper.actualSize.width,!1);else if(t.children&&t.children.length>0&&Ae(t,"HTML",this.childTable))l=this.getGroupParent(t,h,s,t.wrapper.actualSize.height,t.wrapper.actualSize.width,!1);else{h=Xn.createCanvas(t.id,Math.ceil(2*(t.wrapper.actualSize.width+t.style.strokeWidth))+1,Math.ceil(2*(t.wrapper.actualSize.height+t.style.strokeWidth))+1),s.appendChild(h);var c=2;t instanceof Wo&&(c=1.9),h.getContext("2d").setTransform(c,0,0,c,0,0),this.diagramRenderer.renderElement(t.wrapper,d||h,void 0,void 0,void 0,void 0,!0)}if(!i){var p=t.wrapper.actualSize.width+t.style.strokeWidth,g=t.wrapper.actualSize.height+t.style.strokeWidth,u="margin-left:"+Math.max(this.symbolMargin.left,(n-p)/2)+"px;margin-top:"+Math.max(this.symbolMargin.top,(a-g)/2)+"px;pointer-events:none;transform-origin:0 0;overflow:hidden;";return h instanceof HTMLCanvasElement&&(u+="transform:scale(.5,.5);"),(l&&("HTML"===t.shape.type||t.children&&t.children.length>0)?l:h).setAttribute("style",u),s.classList.add("e-symbol-draggable"),s}return h},r.prototype.getGroupParent=function(t,e,i,r,o,n){var a=Oi("div",{id:t.id+(n?"_html_div_preview":"_html_div")}),s=Oi("div",{id:t.id+(n?"_htmlLayer_preview":"_htmlLayer"),style:"width:"+Math.ceil(o+1)+"px;height:"+Math.ceil(r+1)+"px;position:absolute",class:"e-html-layer"}),h=Oi("div",{id:t.id+(n?"_htmlLayer_div_preview":"_htmlLayer_div"),style:"width:"+Math.ceil(o+1)+"px;height:"+Math.ceil(r+1)+"px;position:absolute"});return s.appendChild(h),a.appendChild(s),e=Xn.createCanvas(n?t.id+"_preview":t.id,Math.ceil(o)+1,Math.ceil(r)+1),a.appendChild(e),i.appendChild(a),this.diagramRenderer.renderElement(t.wrapper.children[0].children[0],e,s),a},r.prototype.getHtmlSymbol=function(t,e,i,r,o,n){var a=Oi("div",{id:t.id+(n?"_html_div_preview":"_html_div")}),s=Oi("div",{id:t.id+(n?"_htmlLayer_preview":"_htmlLayer"),style:"width:"+Math.ceil(o+1)+"px;height:"+Math.ceil(r+1)+"px;position:absolute",class:"e-html-layer"}),h=Oi("div",{id:t.id+(n?"_htmlLayer_div_preview":"_htmlLayer_div"),style:"width:"+Math.ceil(o+1)+"px;height:"+Math.ceil(r+1)+"px;position:absolute"});return s.appendChild(h),a.appendChild(s),e=Xn.createCanvas(t.id,Math.ceil(2*(t.wrapper.actualSize.width+t.style.strokeWidth))+1,Math.ceil(2*(t.wrapper.actualSize.height+t.style.strokeWidth))+1),i.appendChild(e),e.getContext("2d").setTransform(2,0,0,2,0,0),a.appendChild(e),i.appendChild(a),this.diagramRenderer.renderElement(t.wrapper.children[0].children[0],e,s),a},r.prototype.getSymbolSize=function(t,e){var i=t.wrapper.actualSize.width,r=t.wrapper.actualSize.height;return this.symbolWidth||this.symbolHeight?(i=this.symbolWidth,r=Math.max(this.symbolHeight,r)):(i+=this.symbolMargin.left+this.symbolMargin.right+t.style.strokeWidth,r+=this.symbolMargin.top+this.symbolMargin.bottom+t.style.strokeWidth),new yr(i,r)},r.prototype.getMousePosition=function(t){var e,i,r;if(-1!==t.type.indexOf("touch")){var o=(r=t).changedTouches[0].clientY,n=r.changedTouches[0].clientX;e=o-this.element.offsetTop,i=n-this.element.offsetLeft}else e=t.clientY-this.element.offsetTop,i=t.clientX-this.element.offsetLeft;return{x:i,y:e}},r.prototype.mouseMove=function(t,e){!this.highlightedSymbol||this.selectedSymbol&&this.selectedSymbol.id+"_container"===this.highlightedSymbol.id||(this.highlightedSymbol.classList.remove("e-symbol-hover"),this.highlightedSymbol.style.backgroundColor="",this.highlightedSymbol=null);var i=t.target.id.split("_container")[0];if(this.symbolTable[i]){var r=document.getElementById(i+"_container");r.classList.add("e-symbol-hover"),this.highlightedSymbol=r}t.preventDefault()},r.prototype.mouseUp=function(t){if(t&&t.target)if("iconSearch"===t.srcElement.id){var e=document.getElementById("iconSearch");e.classList.contains("e-clear-searchtext")&&(e.className="e-input-group-icon e-search e-icons",document.getElementById("textEnter").value="",this.searchPalette(""))}else{var i=t.target.id.split("_container")[0];if(i&&this.selectedSymbol){var r={oldValue:this.selectedSymbol.id,newValue:i};this.trigger("paletteSelectionChange",r),t.preventDefault()}}},r.prototype.keyUp=function(t){var e=this;if(this.enableSearch){var i=this;document.getElementById("iconSearch").className="e-input-group-icon e-clear-searchtext e-icons",!t||"Enter"!==t.key&&13!==t.keyCode?(this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){t.target instanceof HTMLInputElement&&(i.searchPalette(t.target.value),e.timer=null)},500)):t.target instanceof HTMLInputElement&&this.searchPalette(t.target.value)}},r.prototype.mouseDown=function(t){var e=t.target.id.split("_container")[0];if(this.selectedSymbol){var i=document.getElementById(this.selectedSymbol.id+"_container");e!==this.selectedSymbol.id&&i&&i.classList.remove("e-symbol-selected");(r=document.getElementById(this.selectedSymbol.id+"_container"))&&(r.style.backgroundColor=""),this.selectedSymbol=null}if(this.symbolTable[e]){var r;(r=document.getElementById(e+"_container")).classList.add("e-symbol-selected"),this.selectedSymbol=this.symbolTable[e],t.preventDefault()}},r.prototype.initDraggable=function(){this.allowDrag&&(this.draggable=new e.Draggable(this.element,{dragTarget:".e-symbol-draggable",helper:this.helper,dragStart:this.dragStart,dragStop:this.dragStop,drag:function(t){var e=Ei(t.target,"e-droppable");if(e&&e.classList.contains("e-diagram")){e.ej2_instances[0].droppable.over(t)}},cursorAt:{left:this.symbolPreview.offset.x,top:this.symbolPreview.offset.y}}))},r.prototype.dragStart=function(t){var e=this.helper[0];e&&e.setAttribute("paletteId",this.element.id)},r.prototype.dragStop=function(t){Ei(t.target,"e-diagram")||e.remove(t.helper)},r.prototype.scaleSymbol=function(t,e,i,r,o,n,a){if(t instanceof Wo){var s=t.wrapper;t.wrapper=e.children[0];for(var h=t.scale(i,r,o,n,e.children[0]),d=o/2-e.children[0].children[0].offsetX+h.x/2,l=n/2-e.children[0].children[0].offsetY+h.y/2,c=0,p=e.children[0].children;c<p.length;c++){var g=p[c];g.offsetX+=d,g.offsetY+=l,g.staticSize=!1}t.wrapper=s}else if(t.shape instanceof xn&&this.bpmnModule){s=t.wrapper;t.wrapper=e,e.children[0].width=o,e.children[0].height=n,this.bpmnModule.updateBPMN({width:o,height:n},t,t,null),t.wrapper=s}else if(t.children){var u=t.children,f=0,m=0;if(!a)for(var y=void 0,v=void 0,b=0;b<u.length;b++)(v=e.children[0].children[b])&&(v.children[0].children&&this.measureChild(v),y=this.symbolTable[v.id],v.width=y.width,v.height=y.height,v.measure(new yr),v.arrange(v.children[0].desiredSize));if(f=o/e.children[0].desiredSize.width,m=n/e.children[0].desiredSize.height,e.children[0].measure(new yr),e.children[0].arrange(e.children[0].desiredSize),!a){var w=void 0;for(b=0;b<u.length;b++)(w=e.children[0].children[b])&&(w.children[0].children&&this.scaleChildren(w,f,m,t),this.scaleGroup(w,f,m,t))}if(a){y=void 0;var x=void 0,S=void 0;for(w=void 0,b=0;b<u.length;b++)y=this.symbolTable[u[b]],x=o/t.wrapper.children[0].desiredSize.width,S=n/t.wrapper.children[0].desiredSize.height,(w=e.children[0].children[b])&&(w.children[0].children&&this.scaleChildren(w,x,S,t,!0),this.scaleGroup(w,x,S,t,!0));t.wrapper.children[0].measure(new yr),t.wrapper.children[0].arrange(t.wrapper.children[0].desiredSize)}}else si(e.children[0],i,r,e)},r.prototype.scaleChildren=function(t,e,i,r,o){for(var n,a=0;a<t.children.length;a++)(n=t.children[a]).children[0].children?this.scaleChildren(n,e,i,r,o):this.scaleGroup(n,e,i,r,o)},r.prototype.measureChild=function(t){for(var e,i,r=0;r<t.children.length;r++)(e=t.children[r]).children[0].children?this.measureChild(e):(i=this.symbolTable[e.id],e.width=i.width,e.height=i.height,e.measure(new yr),e.arrange(e.children[0].desiredSize))},r.prototype.scaleGroup=function(t,e,i,r,o){t.width=t.width*e,t.height=t.height*i,t.offsetX=o?t.offsetX*e-r.style.strokeWidth:t.offsetX*e+r.style.strokeWidth/2,t.offsetY=o?t.offsetY*i-r.style.strokeWidth:t.offsetY*i+r.style.strokeWidth/2,t.measure(new yr),t.arrange(t.children[0].desiredSize)},r.prototype.refreshPalettes=function(){this.accordionElement.items=[],this.updatePalettes(),this.accordionElement.dataBind()},r.prototype.updatePalettes=function(){for(var t=0;t<this.palettes.length;t++){var e=this.palettes[t];this.initSymbols(e),this.renderPalette(e)}},r.prototype.createTextbox=function(){var t=Oi("div",{id:this.element.id+"_search"});t.setAttribute("style","backgroundColor:white;height:30px"),t.className="e-input-group",this.element.appendChild(t);var e=Oi("input",{});e.placeholder="Search Shapes",e.id="textEnter",e.setAttribute("style","width:100%;height:auto"),e.className="e-input",t.appendChild(e);var i=Oi("span",{id:"iconSearch",className:"e-input-group-icon e-search e-icons"});t.appendChild(i)},r.prototype.searchPalette=function(t){var e,i=[],r=document.getElementById("SearchPalette");if(r)for(var o=r.children.length-1;o>=0;o--)r.removeChild(r.children[o]);for(var n=0;n<this.palettes.length;n++)for(var a=this.palettes[n],s=0;s<a.symbols.length;s++){var h=a.symbols[s];""!==t&&-1!==h.id.toLowerCase().indexOf(t.toLowerCase())&&i.push(h)}var d=ir(this.filterSymbols);if(d&&(i=d(i)||[]),r||(r=e=this.createSearchPalette(e)),i.length>0)for(var l=0,c=i;l<c.length;l++){var p=c[l];this.getSymbolContainer(p,r)}else if(""!==t){var g=Oi("div",{id:"EmptyDiv",style:"text-align:center;font-style:italic"});g.innerHTML="No Items To Display",r.appendChild(g)}else{document.getElementById("iconSearch").className="e-input-group-icon e-search e-icons",this.accordionElement.removeItem(0)}},r.prototype.createSearchPalette=function(t){t=Oi("div",{id:"SearchPalette",style:"display:none;overflow:auto;"}),this.element.appendChild(t);return this.accordionElement.addItem({header:"Search Results",expanded:!0,content:"#SearchPalette"},0),t},r.prototype.wireEvents=function(){var t=e.Browser.touchStartEvent,i=e.Browser.touchEndEvent,r=e.Browser.touchMoveEvent;e.EventHandler.add(this.element,t,this.mouseDown,this),e.EventHandler.add(this.element,r,this.mouseMove,this),e.EventHandler.add(this.element,i,this.mouseUp,this),e.EventHandler.add(this.element,"keyup",this.keyUp,this),this.initDraggable()},r.prototype.unWireEvents=function(){var t=e.Browser.touchStartEvent,i=e.Browser.touchEndEvent,r=e.Browser.touchMoveEvent;e.Browser.isPointer;e.EventHandler.remove(this.element,t,this.mouseDown),e.EventHandler.remove(this.element,r,this.mouseMove),e.EventHandler.remove(this.element,i,this.mouseUp),e.EventHandler.remove(this.element,"keyup",this.keyUp)},Ps([e.Property("S")],r.prototype,"accessKey",void 0),Ps([e.Property("100%")],r.prototype,"width",void 0),Ps([e.Property("100%")],r.prototype,"height",void 0),Ps([e.Collection([],Ts)],r.prototype,"palettes",void 0),Ps([e.Property()],r.prototype,"getSymbolInfo",void 0),Ps([e.Property()],r.prototype,"filterSymbols",void 0),Ps([e.Property()],r.prototype,"getSymbolTemplate",void 0),Ps([e.Property()],r.prototype,"symbolWidth",void 0),Ps([e.Property()],r.prototype,"symbolHeight",void 0),Ps([e.Complex({left:10,right:10,top:10,bottom:10},Er)],r.prototype,"symbolMargin",void 0),Ps([e.Property(!0)],r.prototype,"allowDrag",void 0),Ps([e.Complex({},As)],r.prototype,"symbolPreview",void 0),Ps([e.Property(!1)],r.prototype,"enableSearch",void 0),Ps([e.Property(!0)],r.prototype,"enableAnimation",void 0),Ps([e.Property("Multiple")],r.prototype,"expandMode",void 0),Ps([e.Event()],r.prototype,"paletteSelectionChange",void 0),Ps([e.Property()],r.prototype,"getNodeDefaults",void 0),Ps([e.Property()],r.prototype,"getConnectorDefaults",void 0),r}(e.Component),Ls=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Os=function(t,e,i,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},Is=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.mode="Canvas",r.id="overview",r.actionName="",r.startPoint=null,r.currentPoint=null,r.prevPoint=null,r.scale=null,r.inAction=!1,r.viewPortRatio=1,r.horizontalOffset=0,r.verticalOffset=0,r.model={},r.event=!0,r.model={width:r.width,height:r.height},r}return Ls(i,t),i.prototype.onPropertyChanged=function(t,e){for(var i=0,r=Object.keys(t);i<r.length;i++){switch(r[i]){case"sourceID":this.setParent(t.sourceID);break;case"width":case"height":this.renderCanvas(),this.setParent(this.sourceID)}}},i.prototype.getPersistData=function(){return this.addOnPersist(["loaded"])},i.prototype.preRender=function(){this.element.style.background="transparent",this.unWireEvents(),this.wireEvents()},i.prototype.render=function(){this.diagramRenderer=new Vn(this.element.id,new Yn,!1),this.renderCanvas(),this.setParent(this.sourceID)},i.prototype.getSizeValue=function(t){return t.toString().indexOf("px")>0||t.toString().indexOf("%")>0?t.toString():t.toString()+"px"},i.prototype.renderCanvas=function(t){var e=document.getElementById(this.element.id+"_canvas");e||(e=Oi("div",{}),this.element.appendChild(e));Bi(e,{id:this.element.id+"_canvas",class:"drawing",style:"position:relative; height:"+this.getSizeValue(this.model.height)+"; width:"+this.getSizeValue(this.model.width)+";style:-ms-touch-action: none;touch-action: none;"}),this.element.setAttribute("tabindex",String(0)),this.element.style.overflow="hidden",this.element.style.height=String(this.model.height),this.element.style.width=String(this.model.width),this.canvas=e},i.prototype.setParent=function(t){var e=document.getElementById(t);if(this.parent){var i=this.parent;this.parent=null,i.setOverview(null,this.element.id),this.removeDocument(this)}this.parent=this.getDiagram(e,"ej2_instances"),this.parent&&this.parent.setOverview(this)},i.prototype.getDiagram=function(t,e){for(var i,r=t[e].length,o=0;o<r;o++)if(zi(t[e][o].element,"e-diagram")){i=t[e][o];break}return i},i.prototype.unWireEvents=function(){var t=e.Browser.touchStartEvent,i=e.Browser.touchMoveEvent,r=e.Browser.isPointer?"pointerleave":"mouseleave",o=e.Browser.isPointer,n=(e.Browser.info.name,e.Browser.touchEndEvent);e.EventHandler.remove(this.element,t,this.mouseDown),e.EventHandler.remove(this.element,i,this.mouseMove),e.EventHandler.remove(this.element,n,this.mouseUp),e.EventHandler.remove(this.element,r,this.documentMouseUp),e.EventHandler.remove(window,"resize",this.windowResize);var a=document.getElementById(this.sourceID+"content");a&&e.EventHandler.remove(a,"scroll",this.scrolled)},i.prototype.wireEvents=function(){var t=e.Browser.touchStartEvent,i=e.Browser.touchEndEvent,r=e.Browser.touchMoveEvent,o=e.Browser.isPointer?"pointerleave":"mouseleave",n=e.Browser.isPointer;e.Browser.info.name;e.EventHandler.add(this.element,t,this.mouseDown,this),e.EventHandler.add(this.element,r,this.mouseMove,this),e.EventHandler.add(this.element,i,this.mouseUp,this),e.EventHandler.add(this.element,o,this.documentMouseUp,this),e.EventHandler.add(window,"resize",this.windowResize,this);var a=document.getElementById(this.sourceID+"content");a&&e.EventHandler.add(a,"scroll",this.scrolled,this)},i.prototype.renderDocument=function(t){t.canvas=this.canvas;var e=document.getElementById(this.canvas.id+"_svg");e&&e.parentNode.removeChild(e);var i=Ii("svg",{id:this.canvas.id+"_svg",version:"1.1",xlink:"http://www.w3.org/1999/xlink",class:"overview_svg"});this.svg=i,t.svg=i,t.canvas.appendChild(i);var r=document.getElementById(this.element.id),o=r.clientWidth,n=r.clientHeight,a=r.getBoundingClientRect(),s=window.screenX<0?-1*window.screenX:window.screenX,h=window.screenY<0?-1*window.screenY:window.screenY;0===o&&(o=Math.floor(window.innerWidth-s-Math.floor(a.left))),0===n&&(n=Math.floor(window.innerHeight-h-Math.floor(a.top))),i.setAttribute("width",String(o)),i.setAttribute("height",String(n)),this.model.width=o,this.model.height=n;var d;if(!t.diagramLayerDiv){t.diagramLayerDiv=Oi("div",{});document.getElementById(this.element.id);t.diagramLayer=Xn.createCanvas(this.element.id+"_diagramLayer",this.model.width,this.model.height),t.diagramLayer.setAttribute("style","position:absolute; left:0px;  top:0px "),t.diagramLayerDiv.appendChild(t.diagramLayer),t.canvas.appendChild(t.diagramLayerDiv)}d={id:this.element.id+"_diagramLayer_div",style:"width:"+this.model.width+"px; height:"+this.model.height+"px;position:absolute;top:0px;left:0px"},Bi(t.diagramLayerDiv,d),this.renderHtmlLayer(t.canvas),this.renderNativeLayer(t.canvas,t),this.addOverviewRectPanel(t)},i.prototype.removeDocument=function(t){var e=document.getElementById(this.canvas.id+"_svg");this.canvas.removeChild(e);var i=document.getElementById(this.element.id+"_htmlLayer");this.canvas.removeChild(i);var r=document.getElementById(this.element.id+"_diagramLayer_div");this.canvas.removeChild(r),t.diagramLayerDiv=null,t.diagramLayer=null},i.prototype.renderHtmlLayer=function(t){var e=Oi("div",{id:this.element.id+"_htmlLayer",class:"e-html-layer",style:"pointer-events:none;position:absolute;top:0px;left:0px;"}),i=Oi("div",{id:this.element.id+"_htmlLayer_div",style:"position:absolute;top:0px;left:0px;"});return e.appendChild(i),t.appendChild(e),e},i.prototype.renderNativeLayer=function(t,e){var i=this.parent.createSvg(this.element.id+"_nativeLayer_svg",this.model.width,this.model.height),r=Ii("g",{id:this.element.id+"_nativeLayer"});i.appendChild(r),e.diagramLayerDiv.appendChild(i),Ni(i,{class:"e-native-layer"})},i.prototype.addOverviewRectPanel=function(t){var e=document.getElementById(this.canvas.id+"_overviewsvg");e&&e.parentNode.removeChild(e);e=Ii("svg",{id:this.canvas.id+"_overviewsvg",version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:"position:absolute;left:0px;top:0px; aria-label:Specifies overview",width:this.model.width,height:this.model.height}),t.canvas.appendChild(e);var i=Ii("g",{id:this.element.id+"_overviewlayer",style:"pointer-events:none"});e.appendChild(i);var r=Ii("rect",{fill:"transparent",width:"100%",height:"100%",class:"overviewbackrect",id:this.canvas.id+"overviewbackrect"});r.setAttribute("style"," pointer-events: none; "),i.appendChild(r);var o=Ii("g",{id:this.canvas.id+"overviewhandle",style:"pointer-events:all"});i.appendChild(o);var n=Ii("rect",{id:this.canvas.id+"overviewrect",fill:"transparent"});o.appendChild(n),this.renderOverviewCorner("left",o),this.renderOverviewCorner("right",o),this.renderOverviewCorner("top",o),this.renderOverviewCorner("bottom",o),this.renderOverviewCorner("topleft",o),this.renderOverviewCorner("topright",o),this.renderOverviewCorner("bottomleft",o),this.renderOverviewCorner("bottomright",o)},i.prototype.renderOverviewCorner=function(t,e){this.svg;var i,r=Ii(i="top"===t||"bottom"===t||"right"===t||"left"===t?"rect":"circle",{id:this.canvas.id+"visible"+t});e.appendChild(r);var o=Ii(i,{id:this.canvas.id+t,class:"overviewresizer",fill:"transparent"});e.appendChild(o)},i.prototype.updateOverviewRectangle=function(){var t=this.currentPoint.x-this.prevPoint.x,e=this.currentPoint.y-this.prevPoint.y,i=new yr;i.width=0,i.height=0;var r=0,o=0;switch(this.resizeDirection){case"left":i.width-=t,i.height-=t/this.viewPortRatio,r=t,o=t/this.viewPortRatio,o/=2;break;case"right":i.width+=t,i.height+=t/this.viewPortRatio,o=t/this.viewPortRatio,o/=-2;break;case"top":i.height-=e,i.width-=e*this.viewPortRatio,o=e,r=e*this.viewPortRatio,r/=2;break;case"bottom":i.height+=e,i.width+=e*this.viewPortRatio,r=e*this.viewPortRatio,r/=-2;break;case"topleft":Math.abs(e)>Math.abs(t)?t=e*this.viewPortRatio:e=t/this.viewPortRatio,i.width-=t,i.height-=e,r=t,o=e;break;case"topright":Math.abs(e)>Math.abs(t)?t=-e*this.viewPortRatio:e=-t/this.viewPortRatio,o=e,i.width+=t,i.height-=e;break;case"bottomleft":Math.abs(e)>Math.abs(t)?t=-e*this.viewPortRatio:e=-t/this.viewPortRatio,r=t,i.width-=t,i.height+=e;break;case"bottomright":Math.abs(e)>Math.abs(t)?t=e*this.viewPortRatio:e=t/this.viewPortRatio,i.width+=t,i.height+=e}this.updateHelper(r,o,i,void 0,void 0)},i.prototype.updateHelper=function(t,e,i,r,o){var n,a,s,h=this.element.getElementsByTagName("svg")[2].getElementById("helper");if(i)n=(s=h.getBBox()).x+t,a=s.y+e,r=s.width+i.width,o=s.height+i.height;else{var d;d=this.currentPoint.x>this.startPoint.x?this.currentPoint.x-this.prevPoint.x:this.prevPoint.x-this.currentPoint.x;var l;l=this.currentPoint.y>this.startPoint.y?this.currentPoint.y-this.prevPoint.y:this.prevPoint.y-this.currentPoint.y,Math.abs(l)>Math.abs(d)?d=this.viewPortRatio*l:l=d/this.viewPortRatio,s=h.getBBox(),n=this.startPoint.x>this.currentPoint.x?s.x-d:s.x,a=this.startPoint.y>this.currentPoint.y?s.y-l:s.y,r=s.width+d,o=s.height+l}Ni(this.helper,{id:this.helper.id,x:n,y:a,width:Math.max(0,r),height:Math.max(0,o)})},i.prototype.updateOverviewrect=function(t,e,i,r){Bi(document.getElementById(this.canvas.id+"overviewrect"),{x:t,y:e,width:Math.max(1,i),height:Math.max(1,r)}),this.updateOverviewCorner("top",t+8,e-2,Math.max(0,i-16),2),this.updateOverviewCorner("bottom",t+8,e+r,Math.max(0,i-16),2),this.updateOverviewCorner("left",t-2,e+8,2,Math.max(0,r-16)),this.updateOverviewCorner("right",t+i,e+8,2,Math.max(0,r-16)),this.updateOverviewCorner("topleft",t,e,5,5),this.updateOverviewCorner("topright",t+i,e,5,5),this.updateOverviewCorner("bottomleft",t,e+r,5,5),this.updateOverviewCorner("bottomright",t+i,e+r,5,5)},i.prototype.updateOverviewCorner=function(t,e,i,r,o){var n,a,s="visible"+t,h=document.getElementById(this.canvas.id+s);"top"===t||"bottom"===t||"right"===t||"left"===t?(n={x:e,y:i,width:r,height:o,fill:"#ED1C24"},a={x:e-2,y:i-2,width:2===r?4:r,height:2===o?4:o}):(n={cx:e,cy:i,r:4,fill:"#ED1C24"},a={cx:e,cy:i,r:6,fill:"transparent"}),Bi(h,n);Bi(document.getElementById(this.canvas.id+t),a)},i.prototype.translateOverviewRectangle=function(){var t=Number(this.model.width),e=Number(this.model.height),i=this.currentPoint.x-this.prevPoint.x,r=this.currentPoint.y-this.prevPoint.y,o=(Math.min(this.parent.scroller.viewPortWidth/t,this.parent.scroller.viewPortHeight/e),this.element.getElementsByTagName("svg")[2].getElementById(this.canvas.id+"overviewrect").getBBox()),n=o.x+i,a=o.y+r,s=o.width,h=o.height;this.updateOverviewrect(n,a,s,h),this.updateParentView(this.parent.scroller.currentZoom,n,a,s,h,null)},i.prototype.renderOverviewRect=function(t,e,i,r){var o=Number(this.model.width),n=Number(this.model.height),a=i/o*this.contentWidth,s=r/n*this.contentHeight,h=Math.max(this.parent.scroller.viewPortWidth/a,this.parent.scroller.viewPortHeight/s);if(h>=.25&&h<=30){this.updateParentView(h,t,e,i,r,{x:0,y:0});var d=this.scrollOverviewRect(this.parent.scroller.horizontalOffset,this.parent.scroller.verticalOffset,this.parent.scroller.currentZoom,!0);if(this.helper){var l=this.element.getElementsByTagName("rect")[10].getBBox();d.x=l.x,d.y=l.y}this.updateOverviewrect(d.x,d.y,d.width,d.height)}},i.prototype.scrollOverviewRect=function(t,e,i,r){if(!this.actionName||r){var o=Number(this.model.width),n=Number(this.model.height),a=Math.min(this.contentWidth/o,this.contentHeight/n),s=new xr,h=s.x=t/i/a,d=s.y=e/i/a,l=s.width=this.parent.scroller.viewPortWidth/i/a,c=s.height=this.parent.scroller.viewPortHeight/i/a;this.parent.scroller.viewPortWidth,this.parent.scroller.viewPortHeight;if(r){var p=new xr;return p.x=h,p.y=d,p.width=l,p.height=c,p}this.updateOverviewrect(-h,-d,l,c)}return null},i.prototype.updateParentView=function(t,e,i,r,o,n){var a,s,h=Number(this.model.width),d=Number(this.model.height),l=e*(this.contentWidth/h)*t,c=i*(this.contentHeight/d)*t;this.parent.scroller.getPageBounds();1===t&&"pan"!==this.actionName||(a=-l-this.parent.scroller.horizontalOffset,s=-c-this.parent.scroller.verticalOffset),"scale"===this.actionName||"draw"===this.actionName?this.parent.scroller.zoom(t/this.parent.scroller.currentZoom,a,s,n):this.parent.pan(a,s,n)},i.prototype.updateView=function(t){var e,i,r=this.parent.scroller.getPageBounds();e=r.width,i=r.height;var o,n=Number(this.model.width),a=Number(this.model.height),s=Math.max(e,this.parent.scroller.viewPortWidth),h=Math.max(i,this.parent.scroller.viewPortHeight);this.contentWidth=s=Math.max(s,n/a*h),this.contentHeight=h=Math.max(h,a/n*s),o=Math.min(n/s,a/h);var d=document.getElementById(this.element.id+"_htmlLayer");d.style.webkitTransform="scale("+o+") translate("+-r.x+"px,"+-r.y+"px)",d.style.transform="scale("+o+") translate("+-r.x+"px,"+-r.y+"px)";document.getElementById(this.element.id+"_overviewlayer").setAttribute("transform","translate("+-r.x*o+","+-r.y*o+")"),this.horizontalOffset=r.x*o,this.verticalOffset=r.y*o;var l=document.getElementById(this.element.id+"_diagramLayer"),c=function(t){return Ci(t).getElementById(t+"_nativeLayer")}(this.element.id),p=l.getContext("2d"),g=Number(this.model.width)/this.contentWidth,u=Number(this.model.height)/this.contentHeight;g=Math.min(g,u),c.setAttribute("transform","translate(0,0),scale("+g+")"),p.setTransform(g,0,0,g,0,0),p.fillStyle="red",this.scrollOverviewRect(this.parent.scroller.horizontalOffset,this.parent.scroller.verticalOffset,this.parent.scroller.currentZoom)},i.prototype.scrolled=function(t){if(this.event){var e=this.scrollOverviewRect(this.parent.scroller.horizontalOffset,this.parent.scroller.verticalOffset,this.parent.scroller.currentZoom,!0);this.updateOverviewrect(-e.x,-e.y,e.width,e.height)}},i.prototype.updateCursor=function(t){if(zi(t.target,"overviewresizer"))switch(t.target.id){case this.canvas.id+"left":this.canvas.style.cursor="w-resize";break;case this.canvas.id+"right":this.canvas.style.cursor="e-resize";break;case this.canvas.id+"top":this.canvas.style.cursor="n-resize";break;case this.canvas.id+"bottom":this.canvas.style.cursor="s-resize";break;case this.canvas.id+"topleft":this.canvas.style.cursor="nw-resize";break;case this.canvas.id+"topright":this.canvas.style.cursor="ne-resize";break;case this.canvas.id+"bottomleft":this.canvas.style.cursor="sw-resize";break;case this.canvas.id+"bottomright":this.canvas.style.cursor="se-resize"}else this.canvas.style.cursor="default"},i.prototype.mouseMove=function(t){if(this.event=!1,this.updateCursor(t),this.currentPoint=this.mousePosition(t),this.actionName)switch(this.actionName){case"draw":this.inAction||this.startPoint.x===this.currentPoint.x&&this.startPoint.y===this.currentPoint.y||(this.initHelper(),this.inAction=!0),this.inAction&&this.updateHelper();break;case"scale":this.inAction||(this.initHelper(),this.inAction=!0),this.updateOverviewRectangle();break;case"pan":(this.startPoint.x!==this.currentPoint.x||this.startPoint.y===this.currentPoint.y||this.inAction)&&(this.inAction=!0,this.translateOverviewRectangle())}this.prevPoint=this.currentPoint},i.prototype.documentMouseUp=function(t){this.inAction=!1,this.actionName="",this.helper&&(this.helper.parentNode.removeChild(this.helper),this.helper=null),this.event=!0,document.getElementById(this.canvas.id+"overviewhandle").style.pointerEvents="all"},i.prototype.windowResize=function(t){var e=this;return this.resizeTo&&clearTimeout(this.resizeTo),this.resizeTo=setTimeout(function(){var t=document.getElementById(e.element.id).getBoundingClientRect();e.model.width=t.width,e.model.height=t.height,e.renderCanvas(),e.setParent(e.sourceID)},10),!1},i.prototype.mouseDown=function(t){if(t.target.id===this.canvas.id+"_overviewsvg"&&(this.actionName="draw"),t.target.id===this.canvas.id+"overviewrect"&&(this.actionName="pan"),zi(t.target,"overviewresizer"))switch(this.actionName="scale",t.target.id){case this.canvas.id+"left":this.resizeDirection="left";break;case this.canvas.id+"right":this.resizeDirection="right";break;case this.canvas.id+"top":this.resizeDirection="top";break;case this.canvas.id+"bottom":this.resizeDirection="bottom";break;case this.canvas.id+"topleft":this.resizeDirection="topleft";break;case this.canvas.id+"topright":this.resizeDirection="topright";break;case this.canvas.id+"bottomleft":this.resizeDirection="bottomleft";break;case this.canvas.id+"bottomright":this.resizeDirection="bottomright"}this.startPoint=this.prevPoint=this.mousePosition(t),this.viewPortRatio=this.parent.scroller.viewPortWidth/this.parent.scroller.viewPortHeight;document.getElementById(this.canvas.id+"overviewhandle").style.pointerEvents="none"},i.prototype.mouseUp=function(t){this.currentPoint=this.mousePosition(t);Number(this.model.width),Number(this.model.height);if(this.actionName)if(this.startPoint.x!==this.currentPoint.x||this.startPoint.y!==this.currentPoint.y){if("pan"===this.actionName);else if(this.helper){var e=this.element.getElementsByTagName("rect")[10].getBBox();this.resizeDirection=this.resizeDirection||"";var i=e.x,r=e.y,o=e.width,n=e.height;"topleft"===this.resizeDirection||"topright"===this.resizeDirection||"bottomleft"===this.resizeDirection||this.resizeDirection;this.renderOverviewRect(i,r,o,n)}}else if(t.target.id===this.canvas.id+"_overviewsvg"||"helper"===t.target.id){o=(e=this.element.getElementsByTagName("svg")[2].getElementById(this.canvas.id+"overviewrect").getBBox()).width,n=e.height;this.inAction=!0,this.actionName="pan",this.renderOverviewRect(this.currentPoint.x-o/2,this.currentPoint.y-n/2,o,n),this.inAction=!1}this.helper&&(this.helper.parentNode.removeChild(this.helper),this.helper=null),this.actionName="",this.startPoint=null,this.currentPoint=null,this.prevPoint=null,this.helper=null,this.viewPortRatio=1,this.resizeDirection="",this.inAction=!1,this.event=!0,document.getElementById(this.canvas.id+"overviewhandle").style.pointerEvents="all"},i.prototype.initHelper=function(){var t=this.element.getElementsByTagName("svg")[2],e=(this.parent.scroller.currentZoom,this.startPoint.x),i=this.startPoint.y,r=1,o=1;if("scale"===this.actionName){var n=t.getElementById(this.canvas.id+"overviewrect").getBBox();e=n.x,i=n.y,r=n.width,o=n.height}var a=Ii("rect",{id:"helper",x:e,y:i,width:r,height:o,fill:"transparent",stroke:"gray","stroke-dasharray":"2 2","shape-rendering":"crispEdges"});t.getElementById(this.element.id+"_overviewlayer").appendChild(a),this.helper=a},i.prototype.mousePosition=function(t){var e,i,r;if(-1!==t.type.indexOf("touch")){var o=(e=t).changedTouches[0].clientX,n=e.changedTouches[0].clientY;i=o-this.element.offsetLeft,r=n-this.element.offsetTop}else i=t.clientX,r=t.clientY;var a=this.element.getBoundingClientRect();return i-=a.left,r-=a.top,{x:i+this.horizontalOffset,y:r+this.verticalOffset}},i.prototype.destroy=function(){if(this.unWireEvents(),this.notify("destroy",{}),t.prototype.destroy.call(this),document.getElementById(this.element.id)){this.element.classList.remove("e-overview");var e=document.getElementById(this.element.id+"_canvas");e&&this.element.removeChild(e)}this.parent.views.splice(this.parent.views.indexOf(this.element.id),1),this.diagramLayerDiv=null,this.canvas=null,this.parent=null},i.prototype.getModuleName=function(){return"Overview"},Os([e.Property("100%")],i.prototype,"width",void 0),Os([e.Property("100%")],i.prototype,"height",void 0),Os([e.Property("")],i.prototype,"sourceID",void 0),Os([e.Event()],i.prototype,"created",void 0),i}(e.Component);t.Diagram=Qa,t.PrintAndExport=Ja,t.Size=yr,t.Rect=xr,t.Matrix=Sr,t.identityMatrix=m,t.transformPointByMatrix=y,t.transformPointsByMatrix=v,t.rotateMatrix=b,t.scaleMatrix=w,t.translateMatrix=x,t.multiplyMatrix=S,t.Point=wr,t.contextMenuClick=Pr,t.contextMenuOpen=Cr,t.contextMenuBeforeItemRender=Tr,t.Thickness=Ir,t.Margin=Er,t.Shadow=zr,t.Stop=Dr,t.Gradient=kr,t.LinearGradient=Rr,t.RadialGradient=Nr,t.ShapeStyle=Br,t.StrokeStyle=jr,t.TextStyle=Hr,t.DiagramElement=Ar,t.PathElement=Yr,t.ImageElement=qr,t.TextElement=Gr,t.Container=_r,t.Canvas=Qr,t.GridPanel=Zo,t.RowDefinition=qo,t.ColumnDefinition=Ko,t.GridRow=Qo,t.GridCell=Jo,t.StackPanel=Fo,t.findConnectorPoints=R,t.swapBounds=V,t.findAngle=$,t.findPoint=tt,t.getIntersection=it,t.getIntersectionPoints=ot,t.orthoConnection2Segment=ht,t.getPortDirection=gt,t.getOuterBounds=ut,t.getOppositeDirection=ft,t.processPathData=n,t.parsePathData=a,t.getRectanglePath=s,t.getPolygonPath=h,t.pathSegmentCollection=d,t.transformPath=l,t.updatedSegment=c,t.scalePathData=p,t.splitArrayCollection=g,t.getPathString=u,t.getString=f,t.randomId=Hi,t.cornersPointsBeforeRotation=Wi,t.getBounds=_i,t.cloneObject=Xi,t.getInternalProperties=Yi,t.cloneArray=Vi,t.extendObject=Ui,t.extendArray=Fi,t.textAlignToString=Gi,t.wordBreakToString=Zi,t.bBoxText=qi,t.middleElement=Ki,t.overFlow=Qi,t.whiteSpaceToString=Ji,t.rotateSize=$i,t.rotatePoint=tr,t.getOffset=er,t.getFunction=ir,t.completeRegion=we,t.findNodeByName=xe,t.findObjectType=Se,t.setUMLActivityDefaults=Pe,t.findNearestPoint=Ce,t.isDiagramChild=Te,t.groupHasType=Ae,t.isPointOverConnector=Me,t.intersect3=Le,t.intersect2=Oe,t.getLineSegment=Ie,t.getPoints=Ee,t.getTooltipOffset=ze,t.sort=ke,t.getAnnotationPosition=Re,t.getOffsetOfConnector=Ne,t.getAlignedPosition=Be,t.alignLabelOnSegments=je,t.getBezierDirection=He,t.serialize=We,t.deserialize=_e,t.updateStyle=Xe,t.updateHyperlink=Ye,t.updateShapeContent=Ve,t.updateShape=Ue,t.updateContent=Fe,t.updateUmlActivityNode=Ge,t.getUMLFinalNode=Ze,t.getUMLActivityShapes=qe,t.removeItem=Ke,t.updateConnector=Qe,t.getUserHandlePosition=Je,t.canResizeCorner=$e,t.canShowCorner=ti,t.checkPortRestriction=ei,t.findAnnotation=ii,t.findPort=ri,t.getInOutConnectPorts=oi,t.findObjectIndex=ni,t.getObjectFromCollection=ai,t.scaleElement=si,t.arrangeChild=hi,t.insertObject=di,t.getElement=li,t.getPoint=pi,t.getObjectType=_n,t.CanvasRenderer=Xn,t.DiagramRenderer=Vn,t.DataBinding=$a,t.getBasicShape=T,t.getPortShape=A,t.getDecoratorShape=M,t.getIconShape=L,t.getFlowShape=O,t.Hyperlink=no,t.Annotation=ao,t.ShapeAnnotation=so,t.PathAnnotation=ho,t.Port=eo,t.PointPort=io,t.menuClass=ts,t.DiagramContextMenu=es,t.Shape=on,t.Path=nn,t.Native=an,t.Html=sn,t.Image=hn,t.Text=dn,t.BasicShape=ln,t.FlowShape=cn,t.BpmnGateway=pn,t.BpmnDataObject=gn,t.BpmnTask=un,t.BpmnEvent=fn,t.BpmnSubEvent=mn,t.BpmnTransactionSubProcess=yn,t.BpmnSubProcess=vn,t.BpmnActivity=bn,t.BpmnAnnotation=wn,t.BpmnShape=xn,t.UmlActivityShape=Sn,t.MethodArguments=Pn,t.UmlClassAttribute=Cn,t.UmlClassMethod=Tn,t.UmlClass=An,t.UmlInterface=Mn,t.UmlEnumerationMember=Ln,t.UmlEnumeration=On,t.UmlClassifierShape=In,t.Node=En,t.Header=zn,t.Lane=Dn,t.Phase=kn,t.SwimLane=Rn,t.ChildContainer=Nn,t.BpmnDiagrams=is,t.getBpmnShapePathData=lr,t.getBpmnTriggerShapePathData=cr,t.getBpmnGatewayShapePathData=pr,t.getBpmnTaskShapePathData=gr,t.getBpmnLoopShapePathData=ur,t.Decorator=Lo,t.Vector=Oo,t.ConnectorShape=Io,t.ActivityFlow=Eo,t.BpmnFlow=zo,t.ConnectorSegment=Do,t.StraightSegment=ko,t.BezierSegment=Ro,t.OrthogonalSegment=No,t.getDirection=mt,t.isEmptyVector=yt,t.getBezierPoints=vt,t.getBezierBounds=bt,t.bezierPoints=wt,t.MultiplicityLabel=Bo,t.ClassifierMultiplicity=jo,t.RelationShip=Ho,t.Connector=Wo,t.ConnectorBridging=hs,t.Snapping=ds,t.UndoRedo=ls,t.DiagramTooltip=vo,t.initTooltip=I,t.updateTooltip=D,t.LayoutAnimation=cs,t.UserHandle=Yo,t.Selector=Vo,t.ToolBase=fa,t.SelectTool=ma,t.ConnectTool=ya,t.MoveTool=va,t.RotateTool=ba,t.ResizeTool=wa,t.NodeDrawingTool=xa,t.ConnectorDrawingTool=Sa,t.TextDrawingTool=Pa,t.ZoomPanTool=Ca,t.ExpandTool=Ta,t.LabelTool=Aa,t.PolygonDrawingTool=Ma,t.PolyLineDrawingTool=La,t.LabelDragTool=Oa,t.LabelResizeTool=Ia,t.LabelRotateTool=Ea,t.DiagramEventHandler=ka,t.CommandHandler=Ha,t.findToolToActivate=rr,t.findPortToolToActivate=or,t.contains=nr,t.hasSelection=ar,t.hasSingleConnection=sr,t.isSelected=hr,t.getCursor=dr,t.ConnectorEditing=Da,t.updateCanvasBounds=qt,t.findBounds=Kt,t.createHelper=Qt,t.renderContainerHelper=Jt,t.checkParentAsContainer=$t,t.checkChildNodeInContainer=te,t.addChildToContainer=ee,t.renderStackHighlighter=ie,t.moveChildInStack=re,t.initSwimLane=oe,t.addObjectToGrid=ne,t.headerDefine=ae,t.phaseDefine=se,t.laneCollection=he,t.createRow=de,t.createColumn=le,t.initGridRow=ce,t.initGridColumns=pe,t.CrudAction=sa,t.ConnectionDataSource=ha,t.DataSource=da,t.Gridlines=$n,t.SnapSettings=ta,t.KeyGesture=Ua,t.Command=Fa,t.CommandManager=Ga,t.ContextMenuSettings=Za,t.Layout=pa,t.MindMap=gs,t.HierarchicalTree=ps,t.RadialTree=us,t.GraphForceNode=fs,t.SymmetricLayout=ms,t.GraphLayoutManager=ys,t.ComplexHierarchicalTree=vs,t.Palette=Ts,t.SymbolPreview=As,t.SymbolPalette=Ms,t.Ruler=Hn,t.Overview=Is,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ej2-diagrams.umd.min.js.map
