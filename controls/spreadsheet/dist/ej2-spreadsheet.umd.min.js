!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@syncfusion/ej2-base"),require("@syncfusion/ej2-data"),require("@syncfusion/ej2-navigations"),require("@syncfusion/ej2-splitbuttons"),require("@syncfusion/ej2-popups"),require("@syncfusion/ej2-buttons"),require("@syncfusion/ej2-inputs"),require("@syncfusion/ej2-dropdowns"),require("@syncfusion/ej2-lists")):"function"==typeof define&&define.amd?define(["exports","@syncfusion/ej2-base","@syncfusion/ej2-data","@syncfusion/ej2-navigations","@syncfusion/ej2-splitbuttons","@syncfusion/ej2-popups","@syncfusion/ej2-buttons","@syncfusion/ej2-inputs","@syncfusion/ej2-dropdowns","@syncfusion/ej2-lists"],t):t(e.ej={},e.ej2Base,e.ej2Data,e.ej2Navigations,e.ej2Splitbuttons,e.ej2Popups,e.ej2Buttons,e.ej2Inputs,e.ej2Dropdowns,e.ej2Lists)}(this,function(e,t,r,n,i,s,o,a,l,h){"use strict";function p(e){var t,r=[];return(e=-1===e.indexOf(":")?e+":"+e:e).split(":").forEach(function(e){t=c(e),r.push(t[0]),r.push(t[1])}),r}function c(e){return[parseInt(e.match(/\d+/)[0],10)-1,function(e){for(var t=0,r=(e=e.split("").reverse().join("")).length-1;r>=0;r--)t+=(e[r].charCodeAt(0)-64)*Math.pow(26,r);return t-1}(e.match(/[A-Z]+/i)[0])]}function u(e,t){return f(t+1)+(e+1)}function d(e){return u(e[0],e[1])+":"+u(e[2],e[3])}function f(e){return e/26>1?f(e%26==0?e/26-1:Math.floor(e/26))+String.fromCharCode(e%26==0?"Z".charCodeAt(0):64+e%26):String.fromCharCode(64+e)}function m(e){return p(g(e))}function g(e){return e.split("!")[1]||e}function y(e){var t=e.slice();return e[0]>e[2]&&v(t,0,2),e[1]>e[3]&&v(t,1,3),t}function v(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function C(e){return e[0]===e[2]&&e[1]===e[3]}function b(e,t,r,n,i){return new Ie(e,t,r,n,i)}function S(e){var t=e.toString();if(e===parseInt(t,10))return parseInt(t,10)+"  ";var r=t.indexOf(".")>-1?t.split(".")[1]:0,n=Math.pow(10,r.toString().replace("-","").length),i=Math.abs(E(r,n));return r/i+"/"+n/i}function E(e,t){return e=Number(e),(t=Number(t))?E(t,e%t):e}function x(e){return e=Number(e),(e=e>0&&e<1?1+e:0===e?1:e)>60&&(e-=1),new Date(864e5*(e-1)+new Date("01/01/1900").getTime())}function w(e,t){var r=new Date("01/01/1900"),n=((I(e)?e:new Date(e)).getTime()-r.getTime())/864e5+1;return t?n+1:parseInt(n.toString(),10)+2}function I(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.valueOf())}function F(e){return e-parseFloat(e)>=0}function N(e,r){var n=t.getDefaultDateObject(),i=n.dateTimeFormats.availableFormats,s={dateObj:null,isCustom:!1,type:""};"string"==typeof e&&(e=e.toUpperCase());for(var o=0,a=Object.keys(n.dateFormats);o<a.length;o++){var l=a[o];if(s.dateObj=r.parseDate(e,{format:n.dateFormats[l],skeleton:l}),s.dateObj){s.type="date",s.isCustom=!1;break}}if(t.isNullOrUndefined(s.dateObj))for(var h=0,p=Object.keys(i);h<p.length;h++){l=p[h];if(s.dateObj=r.parseDate(e,{format:i[l],skeleton:l}),s.dateObj){s.type=e.toString().indexOf(":")>-1?"time":"datetime",s.isCustom=!0;break}}if(t.isNullOrUndefined(s.dateObj))for(var c=0,u=Object.keys(n.timeFormats);c<u.length;c++){l=u[c];if(s.dateObj=r.parseDate(e,{format:n.timeFormats[l],skeleton:l}),s.dateObj){s.type="time",s.isCustom=!1;break}}return"#DIV/0!"===e||s.dateObj||"Invalid Date"===new Date(e).toString()||(s.dateObj=new Date(e)),s}function T(e){var t="General";switch(e.split(" ").join("")){case"Number":t="0.00";break;case"Currency":t="$#,##0.00";break;case"Accounting":t='_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)';break;case"ShortDate":t="mm-dd-yyyy";break;case"LongDate":t="dddd, mmmm dd, yyyy";break;case"Time":t="h:mm:ss AM/PM";break;case"Percentage":t="0.00%";break;case"Fraction":t="# ?/?";break;case"Scientific":t="0.00E+00";break;case"Text":t="@"}return t}function D(e){var t="General";switch(e){case"0.00":t="Number";break;case"$#,##0.00":case"$#,##0_);[Red]($#,##0)":case"$#,##0.00_);[Red]($#,##0.00)":case"$#,##0.00_);($#,##0.00)":case"$#,##0_);($#,##0)":t="Currency";break;case'_($*#,##0.00_);_($*(#,##0.00);_($*"-"??_);_(@_)':case'_($*#,##0.00_);_($* (#,##0.00);_($*"-"??_);_(@_)':case'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)':t="Accounting";break;case"mm-dd-yyyy":case"dd-mm-yyyy":case"dd-mm-yy":case"mm-dd-yy":t="ShortDate";break;case"dddd, mmmm dd, yyyy":t="LongDate";break;case"h:mm:ss AM/PM":t="Time";break;case"0.00%":case"0%":t="Percentage";break;case"# ?/?":case"# ??/??":case"# ???/???":t="Fraction";break;case"0.00E+00":t="Scientific";break;case"@":t="Text"}return t}function k(e){var t=[];return e.includeBasicFormulas&&t.push({member:"basic-formulas",args:[e]}),t}function A(e,r){for(var n=r,i=e.replace(/\[/g,".").replace(/\]/g,"").split("."),s=0;s<i.length&&!t.isUndefined(n);s++)n=n[i[s]];return n}function O(e,r,n){var i,s,o=e.replace(/\[/g,".").replace(/\]/g,"").split("."),a=n||{},l=a,h=o.length;for(i=0;i<h;i++)s=o[i],i+1===h?l[s]=void 0===r?{}:r:t.isNullOrUndefined(l[s])&&(l[s]={}),l=l[s];return a}function R(e){for(var t=[],r=0;e>0&&r<9;){e--;var n="A".charCodeAt(0);t[r]=String.fromCharCode(e%26+n),e=parseInt((e/26).toString(),10),r++}for(var i=[],s=0;s<r;s++)i[r-s-1]=t[s];return i.join("")}function L(e,t){return void 0===t&&(t=[]),t.push({member:"workbookBasic",args:[]}),t.push({member:"workbookAll",args:[]}),t.push({member:"dataBind",args:[e]}),e.allowSave&&t.push({member:"workbookSave",args:[e]}),e.allowOpen&&t.push({member:"workbookOpen",args:[e]}),e.allowEditing&&(t.push({member:"workbookEdit",args:[e]}),t.push({member:"workbookFormula",args:[e]})),e.allowNumberFormatting&&t.push({member:"workbookNumberFormat",args:[e]}),e.allowCellFormatting&&t.push({member:"workbookcellformat",args:[e]}),e.allowSorting&&t.push({member:"workbookSort",args:[e]}),t}function H(e){return e&&"="===e[0]&&e.length>1}function _(e,t,r,n){var i=V(r,e);if(!i||!i.cells){if(!n)return null;i?r.rows[e].cells=[]:r.rows[e]={cells:[]}}return r.rows[e].cells[t]}function M(e,r,n,i,s){n.rows[e]?n.rows[e].cells||(n.rows[e].cells=[]):n.rows[e]={cells:[]},s&&n.rows[e].cells[r]?t.extend(n.rows[e].cells[r],i,null,!0):n.rows[e].cells[r]=i}function P(e,t){var r,n=0,i=0;for(r=0;r<t[0];r++)n+=z(e,r);for(r=0;r<t[1];r++)i+=G(e,r);return{top:n,left:i}}function B(e,t){var r={fontFamily:"Calibri",verticalAlign:"bottom",textIndent:"0pt",backgroundColor:"#ffffff",color:"#000000",textAlign:"left",fontSize:"11pt",fontWeight:"normal",fontStyle:"normal",textDecoration:"none"},n={};return Object.keys(t?r:e).forEach(function(t){e[t]!==r[t]&&(n[t]=e[t])}),n}function V(e,t){return e.rows[t]}function j(e,t){return e&&e.rows&&e.rows[t]&&(e.rows[t].height||e.rows[t].customHeight)?e.rows[t].height:20}function U(e,t,r){e&&e.rows&&(e.rows[t]||(e.rows[t]={}),e.rows[t].height=r)}function z(e,t,r){void 0===r&&(r=t);var n,i=0;t>r&&(n=t,t=r,r=n);for(var s=t;s<=r;s++)i+=j(e,s);return i}function q(e,t){return e.columns?e.columns[t]||(e.columns[t]={}):(e.columns=[],e.columns[t]={}),e.columns[t]}function W(e,t){return e&&e.columns&&e.columns[t]&&(e.columns[t].width||e.columns[t].customWidth)?e.columns[t].width:64}function G(e,t,r){void 0===r&&(r=t);var n=0;if(t>r){var i=t;t=r,r=i}for(var s=t;s<=r;s++)n+=W(e,s);return n}function K(e,t){return new Promise(function(r,n){r(function(){var r,n,i=new Map,s=ee(e,$(e,Z(t))),o=m(t),a=o[0],l={sheet:s,indexes:o,promise:new Promise(function(e,t){e(void 0)})};return e.notify("updateSheetFromDataSource",l),l.promise.then(function(){for(;a<=o[2];){for(n=V(s,a),r=o[1];r<=o[3];)i.set(u(a,r),n?_(a,r,s):null),r++;a++}return i})}())})}function X(e,t,r){for(var n,i,s,o=e.length,a=0;a<o;a++){if(s=i=e[a].index-a,e[a].index=null,i>0){for(n=0;i--;)t?(r.createSheet(a+n),n++):e.splice(a,0,null);a+=s,o+=s}t&&(e[a].id=re(r.sheets),e[a].name||(e[a].name="Sheet"+te(r)))}t&&r.setProperties({sheets:r.sheets},!0)}function Y(e,r,n,i){for(var s,o,a=ee(e,n-1),l=m(r),h=l[0],p=l[2];h<=p;h++)for(s=l[1],o=l[3];s<=o;s++){var c=_(h,s,a);!t.isNullOrUndefined(c)&&i&&(delete c.value,t.isNullOrUndefined(c.formula)||delete c.formula)}}function $(e,t){for(var r,n=0;n<e.sheets.length;n++)if(e.sheets[n].name===t){r=n;break}return r}function J(e,t){for(var r,n=0;n<e.sheets.length;n++)if(e.sheets[n].id===t){r=n;break}return r+1}function Z(e){return e.split("!")[0]}function Q(e,t,r){void 0===r&&(r={}),r.selectedRange=t,e.setProperties({sheets:e.sheets},!0)}function ee(e,t){return e.sheets[t]}function te(e){var t=[];e.sheets.forEach(function(e){t.push(e.name.toLowerCase())});for(var r=0;r<t.length;r++){if(!(t.indexOf("sheet"+e.sheetNameCount)>-1))return e.sheetNameCount++;e.sheetNameCount++}return e.sheetNameCount++}function re(e){var t=0;return e.forEach(function(e){t=Math.max(e.id,t)}),t+1}function ne(e){e.sheets.forEach(function(e){X(e.columns),function(e){e.forEach(function(e){e.cells&&X(e.cells)}),X(e)}(e.rows)}),X(e.sheets,!0,e)}function ie(e,t){return void 0===t&&(t=e.activeSheetTab),ee(e,t-1).name}function se(e){var t=[];return function(e,t){t.push({member:"basic",args:[]}),t.push({member:"all",args:[]}),e.showRibbon&&t.push({member:"ribbon",args:[e]});e.showFormulaBar&&t.push({member:"formulaBar",args:[e]});e.showSheetTabs&&t.push({member:"sheetTabs",args:[e]});e.allowEditing&&(t.push({member:"edit",args:[e]}),t.push({member:"formula",args:[e]}),t.push({member:"workbookFormula",args:[e]}),t.push({member:"workbookEdit",args:[e]}));e.allowOpen&&t.push({member:"open",args:[e]});e.allowSave&&t.push({member:"save",args:[e]});e.enableContextMenu&&t.push({member:"contextMenu",args:[e]});"None"!==e.selectionSettings.mode&&t.push({member:"selection",args:[e]});e.enableKeyboardNavigation&&t.push({member:"keyboardNavigation",args:[e]});e.allowNumberFormatting&&t.push({member:"numberFormat",args:[e]});e.enableKeyboardShortcut&&t.push({member:"keyboardShortcut",args:[e]});e.enableClipboard&&t.push({member:"clipboard",args:[e]});e.allowCellFormatting&&t.push({member:"cellformat",args:[e]});e.allowSorting&&t.push({member:"sort",args:[e]});e.allowResizing&&t.push({member:"resize",args:[e]})}(e,t),L(e,t),t}function oe(e){requestAnimationFrame(function(){e()})}function ae(e,t){for(;e.firstChild;)e.removeChild(e.firstChild)}function le(e){var t=30;return e.toString().length>3&&(t=10*e.toString().length),t}function he(){if(null!==Rr)return Rr;var e=document.createElement("div"),t=0;return e.style.cssText="width:100px;height: 100px;overflow: scroll;position: absolute;top: -9999px;",document.body.appendChild(e),t=e.offsetWidth-e.clientWidth|0,document.body.removeChild(e),Rr=t}function pe(e,t){void 0===t&&(t=Lr);return ce(e,"previous",t)+ce(e,"next",t)}function ce(e,t,r){for(var n=e[t+"ElementSibling"],i=0;n;)r.some(function(e){return n.classList.contains(e)})&&(i+=n.offsetHeight),n=n[t+"ElementSibling"];return i}function ue(e,t,r){if(e.scrollSettings.enableVirtualization){var n=e.viewport.topIndex,i=e.viewport.leftIndex,s=n+e.viewport.rowCount+2*e.getThreshold("row"),o=i+e.viewport.colCount+2*e.getThreshold("col"),a=n<=t[0]&&s>=t[2]&&i<=t[1]&&o>=t[3];if(a)return!0;if(r){if(t[0]<n&&t[2]<n||t[0]>s&&t[2]>s)return!1;if(t[0]<n&&t[2]>n&&(t[0]=n,a=!0),t[2]>s&&(t[2]=s,a=!0),t[1]<i&&t[3]<i||t[1]>o&&t[3]>o)return!1;t[1]<i&&t[3]>i&&(t[1]=i,a=!0),t[3]>o&&(t[3]=o,a=!0)}return a}return!0}function de(e,t,r,n){var i=y(t),s=P(r,i),o={top:(0===i[0]?s.top:s.top-1)+"px",height:z(r,t[0],t[2])+(0===i[0]?0:1)+"px",width:G(r,t[1],t[3])+(0===i[1]?0:1)+"px"};o[n?"right":"left"]=(0===i[1]?s.left:s.left-1)+"px",fe([{element:e,attrs:o}])}function fe(e){requestAnimationFrame(function(){e.forEach(function(e){t.setStyleAttribute(e.element,e.attrs)})})}function me(){return t.Browser.isPointer?"pointerdown":"mousedown touchstart"}function ge(){return t.Browser.isPointer?"pointermove":"mousemove touchmove"}function ye(){return t.Browser.isPointer?"pointerup":"mouseup touchend"}function ve(e){return"touchstart"===e.type||"pointerdown"===e.type&&"touch"===e.pointerType}function Ce(e){return"touchmove"===e.type||"pointermove"===e.type&&"touch"===e.pointerType}function be(e){return"touchend"===e.type||"pointerup"===e.type&&"touch"===e.pointerType}function Se(e){return e.changedTouches?e.changedTouches[0].clientX:e.clientX}function Ee(e){return e.changedTouches?e.changedTouches[0].clientY:e.clientY}function xe(e,t){Object.keys(t).forEach(function(r){e&&e.setAttribute(Hr[r],t[r])})}function we(e,r){if(e){var n=t.getComponent(e,r);n&&n.destroy()}}var Ie=function(){function e(e,t,r,n,i){this.preventCallback=!1,this.context=e,this.workerTask=t,this.defaultListener=r,this.workerData=n,i&&(this.preventCallback=!0),this.initWorker()}return e.prototype.terminate=function(){this.worker.terminate(),URL.revokeObjectURL(this.workerUrl)},e.prototype.initWorker=function(){var e=new Blob([this.getFnCode()],{type:"text/javascript"});this.workerUrl=URL.createObjectURL(e),this.worker=new Worker(this.workerUrl),this.worker.onmessage=this.messageFromWorker.bind(this),this.worker.onerror=this.onError.bind(this),this.worker.postMessage(this.workerData)},e.prototype.messageFromWorker=function(e){this.terminate(),this.defaultListener.apply(this.context,[e.data])},e.prototype.onError=function(e){throw this.terminate(),e.message||e},e.prototype.getFnCode=function(){var e,t,r="";if("function"==typeof this.workerTask)r+="self.workerTask = function "+this.workerTask.toString()+"; \n";else if("object"==typeof this.workerTask)for(t=Object.keys(this.workerTask),e=0;e<t.length;e++)r+=(0===e?"self.workerTask":t[e])+"= function "+this.workerTask[t[e]].toString()+"; \n";return r+="self.onmessage = function "+(this.preventCallback?this.getMessageFn.toString():this.getCallbackMessageFn.toString())+"; \n"},e.prototype.getCallbackMessageFn=function(e){postMessage(this.workerTask.apply(this,e.data))},e.prototype.getMessageFn=function(e){this.workerTask.apply(this,e.data)},e}(),Fe="workbookDestroyed",Ne="workbookOpen",Te="beginSave",De="saveCompleted",ke="applyNumber",Ae="getFormattedCell",Oe="refreshCellElem",Re="setCellFormat",Le="textDecorationUpdate",He="applyCellFormat",_e="updateUsedRange",Me="workbookFormulaOperation",Pe="workbookEditOperation",Be="checkDateFormat",Ve="getFormattedBarText",je="activeCellChanged",Ue="openSuccess",ze="openFailure",qe="sheetCreated",We="sheetsDestroyed",Ge="aggregateComputation",Ke="beforeSort",Xe="initiateSort",Ye="sortComplete",$e="sortRangeAlert",Je=function(){function e(e){this.parent=e,this.localeObj=t.getNumericObject(this.parent.locale),this.decimalSep=this.localeObj.decimal,this.groupSep=this.localeObj.group,this.addEventListener()}return e.prototype.numberFormatting=function(e){for(var t,r=this.parent.activeSheetTab,n=this.parent.sheets[r-1],i=p(e.range||n.selectedRange),s=i[0];s<=i[2];s++)for(var o=i[1];o<=i[3];o++)M(s,o,n,{format:e.format},!0),t=_(s,o,n,!0),this.parent.setProperties({sheets:this.parent.sheets},!0),this.getFormattedCell({type:D(t.format),value:t.value,format:t.format,rowIndex:s,colIndex:o,sheetIndex:r,cell:t})},e.prototype.getFormattedCell=function(e){var r=t.isNullOrUndefined(e.value)?"":e.value,n=this.parent.getActiveSheet(),i=p(n.activeCell),s=e.cell?e.cell:_(i[0],i[1],n),o=!1,a=t.getNumberDependable(this.parent.locale,"USD"),l={range:i,format:e.format,requestType:"numberFormat",value:e.value};if(this.parent.trigger("beforeCellFormat",l),""===e.format||"General"===e.format){s=s||{};var h={value:e.value,rowIndex:i[0],colIndex:i[1],sheetIndex:this.parent.activeSheetTab,updatedVal:e.value,isDate:!1,isTime:!1};this.checkDateFormat(h),h.isDate?(o=!0,s.value=e.value=h.updatedVal,s.format=e.format=T("ShortDate")):h.isTime&&(o=!0,s.value=e.value=h.updatedVal,s.format=e.format=T("Time"))}e.type=e.format?D(e.format):"General";var c=this.processFormats(e,r,o,s);return e.onLoad||this.parent.notify(Oe,{isRightAlign:c.rightAlign,result:c.fResult||e.value,rowIndex:e.rowIndex,colIndex:e.colIndex,sheetIndex:e.sheetIndex,type:e.type,curSymbol:a,value:e.value||""}),!e.onLoad&&(e.rowIndex>n.usedRange.rowIndex||e.colIndex>n.usedRange.colIndex)&&(this.parent.setUsedRange(e.rowIndex,e.colIndex),this.parent.setProperties({sheets:this.parent.sheets},!0)),e.formattedText=c.fResult||e.value,e.isRightAlign=c.rightAlign,e.curSymbol=a,e.formattedText},e.prototype.processFormats=function(e,r,n,i){var s,o=new t.Internationalization,a=t.getNumberDependable(this.parent.locale,"USD");if(e.format=e.format?e.format:"General",""!==r)switch(e.type){case"General":r=(s=this.autoDetectGeneralFormat({args:e,currencySymbol:a,fResult:r,intl:o,isRightAlign:n,curCode:"USD",cell:i})).fResult,n=s.isRightAlign;break;case"Number":F(r)&&(r=this.applyNumberFormat(e,o),n=!0);break;case"Currency":F(r)&&(r=this.currencyFormat(e,o),n=!0);break;case"Percentage":F(r)&&(r=this.percentageFormat(e,o),n=!0);break;case"Accounting":F(r)&&(r=this.accountingFormat(e,o),n=!0);break;case"ShortDate":n=!!(r=this.shortDateFormat(e,o));break;case"LongDate":n=!!(r=this.longDateFormat(e,o));break;case"Time":n=!!(r=this.timeFormat(e,o));break;case"Fraction":F(r)&&(r=this.fractionFormat(e),n=!0);break;case"Scientific":F(r)&&(r=this.scientificFormat(e),n=!0);break;case"Text":n=!1}return{fResult:r,rightAlign:n}},e.prototype.autoDetectGeneralFormat=function(e){if(F(e.fResult)&&(e.args.format&&""!==e.args.format&&(e.args.format.toString().indexOf("%")>-1?e.fResult=this.percentageFormat(e.args,e.intl):e.args.format.toString().indexOf(e.currencySymbol)>-1?e.fResult=this.currencyFormat(e.args,e.intl):e.fResult=this.applyNumberFormat(e.args,e.intl)),e.fResult&&e.fResult.toString().split(this.decimalSep)[0].length>11&&(e.fResult=this.scientificFormat(e.args)),e.isRightAlign=!0),!t.isNullOrUndefined(e.fResult)){var r=e.fResult.toString();r.indexOf("%")>-1&&""!==r.split("%")[0]&&""===r.split("%")[1].trim()&&"NaN"!==Number(r.split("%")[0].split(this.groupSep).join("")).toString()?(e.args.value=Number(r.split("%")[0].split(this.groupSep).join("")),e.cell.format=e.args.format=T("Percentage"),e.fResult=this.percentageFormat(e.args,e.intl),e.cell.value=e.args.value.toString(),e.isRightAlign=!0):r.indexOf(e.currencySymbol)>-1&&""!==r.split(e.currencySymbol)[1]&&"NaN"!==Number(r.split(e.currencySymbol)[1].split(this.groupSep).join("")).toString()&&(e.args.value=Number(r.split(e.currencySymbol)[1].split(this.groupSep).join("")),e.cell.format=e.args.format=T("Currency"),e.fResult=this.currencyFormat(e.args,e.intl),e.cell.value=e.args.value.toString(),e.isRightAlign=!0),this.parent.setProperties({sheets:this.parent.sheets},!0)}return{isRightAlign:e.isRightAlign,fResult:e.fResult}},e.prototype.findSuffix=function(e,t){var r=e.length-t.length;return e.substr(0,r<0?0:r)+t},e.prototype.applyNumberFormat=function(e,r){e.format=""===e.format?T("Number"):e.format,e.format=e.format.toString().split("_)").join(" ").split("_(").join(" ").split("[Red]").join("");var n=e.format.toString().split(";");return Number(e.value)>=0?e.format=n[0]:e.format=t.isNullOrUndefined(n[1])?n[0]:n[1].split("*").join(" "),r.formatNumber(Number(e.value),{format:e.format})},e.prototype.currencyFormat=function(e,r){e.format=""===e.format?T("Currency"):e.format,e.format=e.format.toString().split("_(").join(" ").split("_)").join(" ").split("[Red]").join("");var n=e.format.toString().split(";");return Number(e.value)>=0?e.format=n[0]:e.format=t.isNullOrUndefined(n[1])?n[0]:n[1].split("*").join(" "),r.formatNumber(Number(e.value),{format:e.format,currency:"USD"})},e.prototype.percentageFormat=function(e,t){return e.format=""===e.format?T("Percentage"):e.format,t.formatNumber(Number(e.value),{format:e.format})},e.prototype.accountingFormat=function(e,r){e.format=""===e.format?T("Accounting"):e.format,e.format=e.format.split("_(").join(" ").split("_)").join(" ").split("[Red]").join("");var n=t.getNumberDependable(this.parent.locale,"USD"),i=e.format.split(";");return Number(e.value)>=0?e.format=i[0]:e.format=i[1].split("*").join(" "),0===Number(e.value)?n+"- ":r.formatNumber(Number(e.value),{format:e.format,currency:"USD"}).split("-").join("")},e.prototype.shortDateFormat=function(e,t){var r,n=x(e.value),i=""===e.format||"General"===e.format?T("ShortDate"):e.format.toString();return i===T("ShortDate")?(i="M/d/yy",r={type:"date",skeleton:"yMd"}):r={type:"date",format:i},t.formatDate(n,r)},e.prototype.longDateFormat=function(e,t){var r=x(e.value),n=""===e.format||"General"===e.format?T("LongDate"):e.format.toString();return n===T("LongDate")&&(n="EEEE, MMMM d, y"),t.formatDate(r,{type:"date",format:n})},e.prototype.timeFormat=function(e,r){if(t.isNullOrUndefined(e.value))return"";t.isNullOrUndefined(e.value.toString().split(this.decimalSep)[1])||(e.value=parseFloat("1"+this.decimalSep+e.value.split(this.decimalSep)[1])||e.value);var n=x(e.value),i=""===e.format||"General"===e.format?T("Time"):e.format.toString();return i===T("Time")&&(i="h:mm:ss a"),r.formatDate(n,{type:"time",skeleton:"medium",format:i})},e.prototype.scientificFormat=function(e){e.format=""===e.format?T("Scientific"):e.format;var t=e.format.split("+")[1],r=this.findDecimalPlaces(e.format,"Scientific"),n=Number(e.value).toExponential(r);return n.indexOf("e+")>-1?n=n.split("e+")[0]+"E+"+this.findSuffix(t,n.split("e+")[1]):n.indexOf("e-")>-1&&(n=n.split("e-")[0]+"E-"+ +this.findSuffix(t,n.split("e-")[1])),n},e.prototype.fractionFormat=function(e){e.format=""===e.format?T("Fraction"):e.format;var t,r="";return e.value.toString().indexOf(this.decimalSep)>-1&&F(e.value)?(r=e.value.toString().split(this.decimalSep)[0],t=S(Number(e.value)),0===Number(r)?" "+t:r+" "+t):r},e.prototype.findDecimalPlaces=function(e,t){switch(t){case"Scientific":var r=e.toUpperCase().indexOf("E"),n=e.indexOf(this.decimalSep);if(r>-1)return e.substring(n+1,r).length}return 2},e.prototype.checkDateFormat=function(e){var r,n=new t.Internationalization,i=t.isNullOrUndefined(e.value)?"":e.value.toString(),s=_(e.rowIndex,e.colIndex,ee(this.parent,(e.sheetIndex||this.parent.activeSheetTab)-1));(i&&i.indexOf("/")>-1||i.indexOf("-")>-1||i.indexOf(":")>-1)&&(r=N(i,n),t.isNullOrUndefined(r.dateObj)||"Invalid Date"===r.dateObj.toString()||(s=s||{},i=w(r.dateObj,i.indexOf(":")>-1).toString(),s.format&&""!==s.format||("time"===r.type?s.format=T("Time"):s.format=T("ShortDate")),this.parent.setProperties({sheets:this.parent.sheets},!0),e.isDate="date"===r.type||"datetime"===r.type,e.isTime="time"===r.type)),e.updatedVal=i},e.prototype.formattedBarText=function(e){var r=D(e.cell?e.cell.format:""),n=new t.Internationalization,i=e.value,s=T("ShortDate"),o=T("Time");switch(r){case"ShortDate":case"LongDate":e.value=this.shortDateFormat({type:r,value:e.value,format:s},n);break;case"Time":e.value=this.shortDateFormat({type:r,value:e.value,format:s},n)+" "+this.timeFormat({type:r,value:e.value,format:o},n)}(!e.value||e.value&&e.value.toString().indexOf("null")>-1)&&(e.value=i)},e.prototype.addEventListener=function(){this.parent.on(ke,this.numberFormatting,this),this.parent.on(Ae,this.getFormattedCell,this),this.parent.on(Be,this.checkDateFormat,this),this.parent.on(Ve,this.formattedBarText,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ke,this.numberFormatting),this.parent.off(Ae,this.getFormattedCell),this.parent.off(Be,this.checkDateFormat),this.parent.off(Ve,this.formattedBarText))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"workbookNumberFormat"},e}(),Ze=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on("updateSheetFromDataSource",this.updateSheetFromDataSourceHandler,this),this.parent.on("dataSourceChanged",this.dataSourceChangedHandler,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("updateSheetFromDataSource",this.updateSheetFromDataSourceHandler),this.parent.off("dataSourceChanged",this.dataSourceChangedHandler))},e.prototype.updateSheetFromDataSourceHandler=function(e){var t,n,i,s,o,a,l,h,c,u,d=this,f=[],m=[],g=new r.Deferred;if(e.promise=g.promise,e.sheet&&e.sheet.rangeSettings.length)for(var y=function(y){var C=e.indexes[0],b=e.indexes[2],S=e.sheet.rangeSettings[y];h=p(S.startCell)[0],a=S.dataSource instanceof r.DataManager?S.dataSource:S.dataSource?new r.DataManager(S.dataSource):new r.DataManager,o=o||a.dataSource.url,e.sheet.isLocalData=!a.dataSource.url,h<=C?C-=h:h<=b?(b-=h,C=0):C=-1,S.showFieldAsHeader&&0!==C&&(C-=1);var E=!1;v.initRangeInfo(S);var x=v.getMaxCount(S);if(u=v.getLoadedInfo(C,b,S),C=u.unloadedRange[0],b=u.unloadedRange[1],C>x?E=!0:b>x&&(b=x),C>=0&&u.isNotLoaded&&!E){m[y]=C,f.push(!1);var w=(S.query?S.query:new r.Query).clone();a.executeQuery(w.range(C,b>=x?b:b+1).requiresCount()).then(function(r){d.parent&&!d.parent.isDestroyed&&((s=r.result&&r.result.result?r.result.result:r.result).length&&(S.info.count=r.count,n=Object.keys(s[0]),S.info.fldLen=n.length,i=p(S.startCell),h=i[0],c=i[1],0===m[y]&&S.showFieldAsHeader&&n.forEach(function(r,n){(t=_(h+m[y],c+n,e.sheet,!0))?t.value||(t.value=r):e.sheet.rows[h+m[y]].cells[c+n]={value:r}}),s.forEach(function(r,i){for(var s=0;s<n.length;s++)l=h+m[y]+i+(S.showFieldAsHeader?1:0),(t=_(l,c+s,e.sheet,!0))?t.value||M(l,c+s,e.sheet,d.getCellDataFromProp(r[n[s]]),!0):e.sheet.rows[l].cells[c+s]=d.getCellDataFromProp(r[n[s]]),d.checkDataForFormat({args:e,cell:t,colIndex:c+s,rowIndex:l,i:i,j:s,k:y,range:S,sRanges:m,value:r[n[s]]})})),e.sheet.usedRange.rowIndex=Math.max(h+(x||r.count)+(S.showFieldAsHeader?1:0),e.sheet.usedRange.rowIndex),e.sheet.usedRange.colIndex=Math.max(c+n.length-1,e.sheet.usedRange.colIndex),S.info.loadedRange.push([C,b]),f[y]=!0,-1===f.indexOf(!1)&&(o&&d.updateSheetFromDataSourceHandler({sheet:e.sheet,indexes:[0,0,e.sheet.usedRange.rowIndex,e.sheet.usedRange.colIndex],promise:new Promise(function(e){e(void 0)})}),g.resolve()))})}else 0===y&&-1===f.indexOf(!1)&&g.resolve()},v=this,C=e.sheet.rangeSettings.length-1;C>=0;C--)y(C);else g.resolve()},e.prototype.getCellDataFromProp=function(e){var t={};return"[object Object]"===Object.prototype.toString.call(e)?e.formula?t.formula=e.formula:e.value&&(t.value=e.value):H(e)?t.formula=e:t.value=e,t},e.prototype.checkDataForFormat=function(e){if(""!==e.value){var t={value:e.value,rowIndex:e.rowIndex,colIndex:e.colIndex,isDate:!1,updatedVal:e.value,isTime:!1};this.parent.notify(Be,t),t.isDate?e.cell?(e.cell.format=T("ShortDate"),e.cell.value=t.updatedVal):(e.args.sheet.rows[e.rowIndex].cells[e.colIndex].format=T("ShortDate"),e.args.sheet.rows[e.rowIndex].cells[e.colIndex].value=t.updatedVal):t.isTime&&(e.cell?(e.cell.format=T("Time"),e.cell.value=t.updatedVal):(e.args.sheet.rows[e.rowIndex].cells[e.colIndex].format=T("Time"),e.args.sheet.rows[e.rowIndex].cells[e.colIndex].value=t.updatedVal))}},e.prototype.getLoadedInfo=function(e,t,r){var n=!0;return r.info.loadedRange.forEach(function(r){r[0]<=e&&e<=r[1]?r[0]<=t&&t<=r[1]?n=!1:e=r[1]+1:r[0]<=t&&t<=r[1]&&(t=r[0]-1)}),{isNotLoaded:n,unloadedRange:[e,t]}},e.prototype.getMaxCount=function(e){if(e.query)for(var t=e.query.queries,r=0;r<t.length;r++)if("onTake"===t[r].fn)return Math.min(t[r].e.nos,e.info.count||t[r].e.nos);return e.info.count},e.prototype.initRangeInfo=function(e){e.info||(e.info={loadedRange:[]})},e.prototype.dataSourceChangedHandler=function(e){var t,r=e.oldProp.sheets[e.sheetIdx],n=this.parent.sheets[e.sheetIdx],i=r&&r.rangeSettings&&r.rangeSettings[e.rangeIdx];if(i){var s=p(i.startCell);n.rangeSettings[e.rangeIdx].info.loadedRange=[],i.info.loadedRange.forEach(function(e){for(var r=e[0];r<e[1];r++){t=n.rows[r+s[0]];for(var o=s[1];o<s[1]+i.info.fldLen;o++)t.cells[o].value=""}})}this.parent.notify("data-refresh",{sheetIdx:e.sheetIdx})},e.prototype.getModuleName=function(){return"dataBind"},e}(),Qe=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.open=function(e){var t=this;if(this.parent.allowOpen){var r=new FormData;if(e.file){r.append("file",e.file);var n={file:e.file||null,cancel:!1,requestData:{method:"POST",body:r}};this.parent.trigger("beforeOpen",n),n.cancel||fetch(this.parent.openUrl,n.requestData).then(function(e){return e.ok?e.json():Promise.reject({status:e.status,statusText:e.statusText,url:e.url})}).then(function(e){return t.fetchSuccess(e)}).catch(function(e){return t.fetchFailure(e)})}else this.parent.isOpen=!1}},e.prototype.fetchFailure=function(e){t.isUndefined(e.status)&&t.isUndefined(e.statusText)&&(e.statusText="Improper response"),this.parent.notify(ze,e),this.parent.isOpen=!1},e.prototype.fetchSuccess=function(e){var t=("string"==typeof e?JSON.parse(e):e).Workbook;["UnsupportedFile","InvalidUrl"].indexOf(t)>-1?this.parent.notify(Ue,{context:this,data:t}):(this.updateModel(t),this.parent.notify(Ue,this),this.parent.isOpen=!1)},e.prototype.updateModel=function(e){var t=this;this.parent.notify(Me,{action:"unRegisterSheet"}),this.parent.sheetNameCount=1,this.parent.sheets=[],this.parent.notify(We,{}),e.activeSheetTab=e.activeSheetTab||1,this.parent.setProperties({sheets:e.sheets,activeSheetTab:e.activeSheetTab,definedNames:e.definedNames||[]},!0),this.parent.notify(qe,null),this.parent.sheets.forEach(function(e){e.id=re(t.parent.sheets)}),this.parent.notify(Me,{action:"registerSheet"}),this.parent.notify(Me,{action:"initiateDefinedNames"})},e.prototype.addEventListener=function(){this.parent.on(Ne,this.open.bind(this))},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Ne,this.open.bind(this))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"workbookOpen"},e}(),et=function(){function e(e){this.parent=e}return e.prototype.processSheet=function(e,t){return[t,JSON.parse(e,function(e,t){if(!Array.isArray(t)&&"string"!=typeof t||t.length)return t})]},e.prototype.processSave=function(e,t,r){var n,i=new FormData,s=Object.keys(t);for(i.append("JSONData",JSON.stringify(e)),n=0;n<s.length;n++)i.append(s[n],t[s[n]]);for(s=Object.keys(r),n=0;n<s.length;n++)i.append(s[n],r[s[n]]);fetch(t.url,{method:"POST",body:i}).then(function(e){return e.ok?e.blob():Promise.reject({message:e.statusText})}).then(function(e){postMessage(e)}).catch(function(e){postMessage({error:e.message})})},e}(),tt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),rt=function(e){function r(t){var r=e.call(this,t)||this;return r.isProcessCompleted=!1,r.saveJSON={},r.isFullPost=!1,r.needBlobData=!1,r.customParams=null,r.addEventListener(),r}return tt(r,e),r.prototype.getModuleName=function(){return"workbookSave"},r.prototype.destroy=function(){this.removeEventListener(),this.parent=null},r.prototype.addEventListener=function(){this.parent.on(Te,this.initiateSave,this)},r.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Te,this.initiateSave)},r.prototype.initiateSave=function(e){var t=e.saveSettings;this.saveSettings={saveType:t.saveType,url:t.url,fileName:t.fileName||"Sample"},this.isFullPost=e.isFullPost,this.needBlobData=e.needBlobData,this.needBlobData&&(this.isFullPost=!1),this.customParams=e.customParams,this.updateBasicSettings(),this.processSheets()},r.prototype.updateBasicSettings=function(){var e=this.getStringifyObject(this.parent,["sheets","_isScalar","observers","closed","isStopped","hasError","__isAsync","beforeCellFormat","beforeCellRender","beforeDataBound","beforeOpen","beforeSave","beforeSelect","beforeSort","cellEdit","cellEditing","cellSave","contextMenuItemSelect","contextMenuBeforeClose","contextMenuBeforeOpen","created","dataBound","fileItemSelect","fileMenuBeforeClose","fileMenuBeforeOpen","openFailure","saveComplete","sortComplete","select"]),t=JSON.parse(e);this.parent.sheets.length&&(t.sheets=[]),this.saveJSON=t},r.prototype.processSheets=function(){for(var e=0,t=this.parent.sheets.length;e<t;)b(this,this.processSheet,this.updateSheet,[this.getStringifyObject(this.parent.sheets[e]),e]),e++},r.prototype.updateSheet=function(e){this.saveJSON.sheets[e[0]]=e[1],this.isProcessCompleted=this.getSheetLength(this.saveJSON.sheets)===this.parent.sheets.length,this.isProcessCompleted&&this.save(this.saveSettings)},r.prototype.getSheetLength=function(e){var t=0;return e.forEach(function(e){e&&t++}),t},r.prototype.save=function(e){this.isFullPost?this.initiateFullPostSave():b(this,{workerTask:this.processSave},this.updateSaveResult,[this.saveJSON,e,this.customParams],!0),this.saveJSON={}},r.prototype.updateSaveResult=function(e){var t={status:"Success",message:"",url:this.saveSettings.url,fileName:this.saveSettings.fileName,saveType:this.saveSettings.saveType,blobData:null};"object"==typeof e&&e.error?(t.status="Failure",t.message=e.error.toString()):this.needBlobData?t.blobData=e:this.ClientFileDownload(e,this.saveSettings.fileName),this.parent.trigger("saveComplete",t),this.parent.notify(De,t)},r.prototype.ClientFileDownload=function(e,t){var r=this.parent.createElement("a",{attrs:{download:this.getFileNameWithExtension()}}),n=URL.createObjectURL(e);r.href=n,document.body.appendChild(r),r.click(),URL.revokeObjectURL(n),document.body.removeChild(r)},r.prototype.initiateFullPostSave=function(){var e,r=Object.keys(this.saveSettings),n=this.parent.createElement("form",{attrs:{method:"POST",action:this.saveSettings.url}}),i=this.parent.createElement("input",{attrs:{type:"hidden",name:"JSONData"}});for(i.value=JSON.stringify(this.saveJSON),n.appendChild(i),e=0;e<r.length;e++)(i=this.parent.createElement("input",{attrs:{type:"hidden",name:r[e]}})).value=this.saveSettings[r[e]],n.appendChild(i);for(r=Object.keys(this.customParams),e=0;e<r.length;e++)(i=this.parent.createElement("input",{attrs:{type:"hidden",name:r[e]}})).value=this.customParams[r[e]],n.appendChild(i);document.body.appendChild(n),n.submit(),t.detach(n),this.parent.notify(De,{})},r.prototype.getStringifyObject=function(e,t){return void 0===t&&(t=[]),JSON.stringify(e,function(e,r){return t.indexOf(e)>-1?void 0:r&&"object"==typeof r&&r.hasOwnProperty("properties")?r.properties:null!==r?r:void 0})},r.prototype.getFileNameWithExtension=function(e){e||(e=this.saveSettings.fileName);var t=this.getFileExtension(),r=e.lastIndexOf(".");return r>-1&&(e=e.substr(0,r)),e+t},r.prototype.getFileExtension=function(){return"."+this.saveSettings.saveType.toLowerCase()},r}(et),nt=function(){function e(e){this.parent=e}return e.prototype.getModuleName=function(){return"calc-common"},e}(),it=function(){function e(e){this.loadedModules=[],this.parent=e}return e.prototype.inject=function(e,t){var r=e.length;if(0!==r){this.loadedModules.length&&this.clearUnusedModule(e);for(var n=0;n<r;n++)for(var i=e[n],s=0,o=t;s<o.length;s++){var a=o[s],l=i.member;if(a.prototype.getModuleName()===i.member&&!this.isModuleLoaded(l)){var h=this.createInstance(a,i.args),p=this.getMemberName(l);i.isProperty?O(p,a,this.parent):O(p,h,this.parent);var c=i;c.member=p,this.loadedModules.push(c)}}}else this.clean()},e.prototype.createInstance=function(e,t){var r=t;return r.unshift(void 0),new(Function.prototype.bind.apply(e,r))},e.prototype.clean=function(){for(var e=0,t=this.loadedModules;e<t.length;e++){var r=t[e];r.isProperty||A(r.member,this.parent).destroy()}this.loadedModules=[]},e.prototype.clearUnusedModule=function(e){for(var t=this,r=e.map(function(e){return t.getMemberName(e.member)}),n=0,i=this.loadedModules.filter(function(e){return-1===r.indexOf(e.member)});n<i.length;n++){var s=i[n];s.isProperty||A(s.member,this.parent).destroy(),this.loadedModules.splice(this.loadedModules.indexOf(s),1),this.deleteObject(this.parent,s.member)}},e.prototype.getMemberName=function(e){return e[0].toLowerCase()+e.substring(1)+"Module"},e.prototype.deleteObject=function(e,t){delete e[t]},e.prototype.isModuleLoaded=function(e){for(var t=0,r=this.loadedModules;t<r.length;t++){if(r[t].member===this.getMemberName(e))return!0}return!1},e}();!function(e){e[e.na=0]="na",e[e.value=1]="value",e[e.ref=2]="ref",e[e.divzero=3]="divzero",e[e.num=4]="num",e[e.name=5]="name",e[e.null=6]="null"}(e.CommonErrors||(e.CommonErrors={})),function(e){e[e.operators_cannot_start_with_expression=0]="operators_cannot_start_with_expression",e[e.reservedWord_And=1]="reservedWord_And",e[e.reservedWord_Xor=2]="reservedWord_Xor",e[e.reservedWord_If=3]="reservedWord_If",e[e.number_contains_2_decimal_points=4]="number_contains_2_decimal_points",e[e.reservedWord_Else=5]="reservedWord_Else",e[e.reservedWord_Not=6]="reservedWord_Not",e[e.invalid_char_in_number=7]="invalid_char_in_number",e[e.invalid_characters_following_with_operator=6]="invalid_characters_following_with_operator",e[e.mismatched_parentheses=8]="mismatched_parentheses",e[e.unknown_formula_name=9]="unknown_formula_name",e[e.requires_a_single_argument=10]="requires_a_single_argument",e[e.requires_3_args=11]="requires_3_args",e[e.invalid_Math_argument=12]="invalid_Math_argument",e[e.requires_2_args=13]="requires_2_args",e[e.bad_index=14]="bad_index",e[e.too_complex=15]="too_complex",e[e.circular_reference=16]="circular_reference",e[e.missing_formula=17]="missing_formula",e[e.improper_formula=18]="improper_formula",e[e.invalid_expression=19]="invalid_expression",e[e.cell_empty=20]="cell_empty",e[e.bad_formula=21]="bad_formula",e[e.empty_expression=22]="empty_expression",e[e.virtual_mode_required=23]="virtual_mode_required",e[e.mismatched_tics=24]="mismatched_tics",e[e.wrong_number_arguments=25]="wrong_number_arguments",e[e.invalid_arguments=26]="invalid_arguments",e[e.iterations_do_not_converge=27]="iterations_do_not_converge",e[e.calculation_overflow=29]="calculation_overflow",e[e.already_registered=28]="already_registered",e[e.missing_sheet=30]="missing_sheet",e[e.cannot_parse=31]="cannot_parse",e[e.expression_cannot_end_with_an_operator=32]="expression_cannot_end_with_an_operator"}(e.FormulasErrorsStrings||(e.FormulasErrorsStrings={}));var st=function(){function r(e){this.formulas=[{formulaName:"SUM",category:"Math & Trig",description:"Sums individual values, cell references or ranges."},{formulaName:"SUMIFS",category:"Math & Trig",description:"Sums the cells specified by a given set of conditionsor criteria."},{formulaName:"ABS",category:"Math & Trig",description:"Returns the absolute value of a number."},{formulaName:"RAND",category:"Math & Trig",description:"Return a random number between 0 and 1."},{formulaName:"FLOOR",category:"Math & Trig",description:"Returns the round a number down to the nearest integer."},{formulaName:"CEILING",category:"Math & Trig",description:"Returns a number rounded up to a multiple of another number."},{formulaName:"SUMIF",category:"Math & Trig",description:"It will sum up cells that meet the given criteria."},{formulaName:"PRODUCT",category:"Math & Trig",description:"Multiplies all the numbers given as arguments and returns the product."},{formulaName:"AVERAGE",category:"Statistical",description:"The sum of the numbers divided by how many numbers are being averaged."},{formulaName:"AVERAGEIF",category:"Statistical",description:"Computes the average of the numbers in a range that meet the supplied criteria."},{formulaName:"COUNT",category:"Statistical",description:"Counts the numbers in the list of arguments, exclude text entries."},{formulaName:"COUNTA",category:"Statistical",description:"Counts the non-empty values in the list of arguments."},{formulaName:"COUNTIF",category:"Statistical",description:"Counts the number of cells in a range that meet a specified condition."},{formulaName:"COUNTIFS",category:"Statistical",description:"Counts the number of times each cells in all the ranges that meet the specific conditions."},{formulaName:"AVERAGEA",category:"Statistical",description:"Calculates the average of values in the list of arguments.Arguments can be numbers, names, arrays or references."},{formulaName:"AVERAGEIFS",category:"Statistical",description:"Conditionally returns the average of the contents of cells for the set of ranges."},{formulaName:"MIN",category:"Statistical",description:"Returns the smaller number in set of arguments."},{formulaName:"MAX",category:"Statistical",description:"Returns the largest number in set of arguments."},{formulaName:"DATE",category:"Date",description:"Returns the date, given the year, month and day of the month."},{formulaName:"DAY",category:"Date",description:"Returns the day of a given date."},{formulaName:"DAYS",category:"Date",description:"Returns the number of days between two dates."},{formulaName:"IF",category:"Logical",description:"Returns one value if a logical expression is TRUE and another if it is FALSE"},{formulaName:"AND",category:"Logical",description:"Returns TRUE if all the arguments are considered TRUE, and FALSE otherwise."},{formulaName:"IFS",category:"Logical",description:"Checks multiple conditions and returns a value corresponding to the first TRUE result."},{formulaName:"IFERROR",category:"Logical",description:"Returns a value you specify if a formula evaluates to an error; otherwise, it returns the result of the formula."},{formulaName:"CHOOSE",category:"Lookup & Reference",description:"Returns a value from a list, given an index number."},{formulaName:"INDEX",category:"Lookup & Reference",description:"Returns a value from a table, given a row and column number."},{formulaName:"FIND",category:"Text",description:"Returns the position of a string of text within another string."},{formulaName:"CONCATENATE",category:"Text",description:" Used to join two or more strings together."},{formulaName:"CONCAT",category:"Text",description:"Concatenates a list or range of text strings."},{formulaName:"SUBTOTAL",category:"Lookup & Reference",description:"Returns a subtotal in a list or database."},{formulaName:"RADIANS",category:"Math & Trig",description:"Converts degrees to radians."},{formulaName:"OR",category:"Logical",description:"Returns TRUE if any arguments considered TRUE, and all the arguments are FALSE it will return FALSE."},{formulaName:"MATCH",category:"Lookup & Reference",description:"Returns the relative position of an checked item in range that matches a specified value in a specified order"},{formulaName:"RANDBETWEEN",category:"Math & Trig",description:"Returns an integer random number in a specified range."}],this.isConcat=!1,this.parent=e,this.init()}return r.prototype.init=function(){for(var e,r=0;r<this.formulas.length;r++)e=t.getValue("Compute"+this.formulas[r].formulaName,this).bind(this),this.addFormulaCollection(this.formulas[r].formulaName.toUpperCase(),e,this.formulas[r].category,this.formulas[r].description)},r.prototype.addFormulaCollection=function(e,t,r,n){this.parent.libraryFormulas={fName:e,handler:t,category:r,description:n}},r.prototype.ComputeSUM=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var i,s,o=0;if(!t.isNullOrUndefined(r))for(var a=r,l=0;l<a.length;l++){var h=a[l].toString();if(h.indexOf(":")>-1&&this.parent.isCellReference(h))for(var p=this.parent.getCellCollection(h.split(this.parent.tic).join("")),c=0;c<p.length;c++){if(i=this.parent.getValueFromArg(p[c]),this.parent.getErrorStrings().indexOf(i)>-1)return i;t.isNullOrUndefined(i[0])||isNaN(this.parent.parseFloat(i))||(o+=this.parent.parseFloat(i))}else{if(a[l].split(this.parent.tic).join("")===this.parent.trueValue&&(a[l]="1"),a[l].split(this.parent.tic).join("")===this.parent.falseValue&&(a[l]="0"),s=this.parent.getValueFromArg(a[l].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(s)>-1)return s;if(t.isNullOrUndefined(s)||isNaN(this.parent.parseFloat(s)))continue;s.length>0&&(o+=this.parent.parseFloat(s+""))}}return o},r.prototype.ComputeCOUNT=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var i,s,o,a=r,l=0,h=0;h<a.length;h++)if((i=a[h]).indexOf(":")>-1&&this.parent.isCellReference(i)){s=this.parent.getCellCollection(i.split(this.parent.tic).join(""));for(var p=0;p<s.length;p++)o=this.parent.getValueFromArg(s[p]),isNaN(this.parent.parseFloat(o))||i.length>0&&""!==i&&" "!==i&&l++}else i=i.split(this.parent.tic).join(""),isNaN(this.parent.parseFloat(this.parent.getValueFromArg(i)))||i.length>0&&""!==i&&" "!==i&&l++;return l},r.prototype.ComputeDATE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var i=r;if(3!==i.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var s=0;s<i.length;++s)i[s]=this.parent.getValueFromArg(i[s]);i[0]="TRUE"===i[0].split(this.parent.tic).join("")?"1":"FALSE"===i[0].split(this.parent.tic).join("")?"0":i[0],i[1]="TRUE"===i[1].split(this.parent.tic).join("")?"1":"FALSE"===i[1].split(this.parent.tic).join("")?"0":i[1],i[2]="TRUE"===i[2].split(this.parent.tic).join("")?"1":"FALSE"===i[2].split(this.parent.tic).join("")?"0":i[2];var o=this.parent.parseFloat(i[0].split(this.parent.tic).join("")),a=this.parent.parseFloat(i[1].split(this.parent.tic).join("")),l=this.parent.parseFloat(i[2].split(this.parent.tic).join("")),h=0;if(isNaN(o)||isNaN(a)||isNaN(l))return this.parent.getErrorStrings()[e.CommonErrors.value].toString();if(o<0)return this.parent.getErrorStrings()[e.CommonErrors.num].toString();for(;a>12;)a-=12,o++;if(0===(h=this.parent.getSerialDateFromDate(o,a,l)))return this.parent.getErrorStrings()[e.CommonErrors.num].toString();var p=this.parent.fromOADate(h);return"Invalid Date"!==p.toString()?p.getFullYear()+"/"+this.parent.calculateDate((p.getMonth()+1).toString())+"/"+this.parent.calculateDate(p.getDate().toString()):h.toString()},r.prototype.ComputeFLOOR=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var i,s,o=r,a=o.length,l=o[1].split(this.parent.tic).join(""),h=[];if(2!==a)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];if(h.push(i=this.parent.parseFloat(this.parent.getValueFromArg(o[0].split(this.parent.tic).join("")))),o[1]=l===this.parent.trueValue?"1":l===this.parent.falseValue?"0":o[1],h.push(s=this.parent.parseFloat(this.parent.getValueFromArg(o[1].split(this.parent.tic).join("")))),i>0&&s<0)return this.parent.getErrorStrings()[e.CommonErrors.num];if(i>0&&0===s)return this.parent.getErrorStrings()[e.CommonErrors.divzero];for(var p=0;p<o.length;p++)if(o[p].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.value];return isNaN(i)?this.parent.getErrorStrings()[e.CommonErrors.name]:Math.floor(i/s)*s},r.prototype.ComputeCEILING=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var i,s,o=r,a=[],l=o.length,h=o[1].split(this.parent.tic).join("");if(2!==l)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];if(a.push(i=this.parent.parseFloat(this.parent.getValueFromArg(o[0].split(this.parent.tic).join("")))),o[1]=h===this.parent.trueValue?"1":h===this.parent.falseValue?"0":o[1],a.push(s=this.parent.parseFloat(this.parent.getValueFromArg(o[1].split(this.parent.tic).join("")))),i>0&&s<0)return this.parent.getErrorStrings()[e.CommonErrors.num];for(var p=0;p<o.length;p++)if(o[p].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.value];return isNaN(i)?this.parent.getErrorStrings()[e.CommonErrors.name]:0===s?0:Math.ceil(i/s)*s},r.prototype.ComputeDAY=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,s=r;if(t.isNullOrUndefined(s)||1===s.length&&""===s[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];if(s.length>1)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var o=this.parent.getValueFromArg(s[0].split(this.parent.tic).join(""));return isNaN(this.parent.parseFloat(o))?(o=o,i=this.parent.parseDate(o),"[object Date]"===Object.prototype.toString.call(i)&&(i=i.getDate()),i):this.parent.getErrorStrings()[e.CommonErrors.name]},r.prototype.ComputeIF=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];if(this.parent.getErrorStrings().indexOf(r[0])>0)return r[0];var i,s,o=r;if(o.length>3||1===o.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];if(o.length<=3){if(i=this.parent.getValueFromArg(o[0]),this.parent.getErrorStrings().indexOf(i)>-1)return i;if(i===this.parent.trueValue||this.parent.parseFloat(i)>0||this.parent.parseFloat(i)<0)s=this.parent.getValueFromArg(o[1]);else{if(i!==this.parent.falseValue&&0!==this.parent.parseFloat(i))return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.requires_3_args];if(t.isNullOrUndefined(o[2]))return this.parent.falseValue;s=this.parent.getValueFromArg(o[2])}}return s.indexOf(this.parent.tic)>-1?s.split(this.parent.tic).join(""):s},r.prototype.ComputeIFERROR=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var i,s=r;return 2!==s.length?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments]:(i=this.parent.getValueFromArg(s[0]))===this.parent.trueValue||i===this.parent.falseValue?i:(i[0]===this.parent.arithMarker&&(i=i.replace(this.parent.arithMarker," ")),"#"===(i=this.parent.getValueFromArg(i).toUpperCase().split(this.parent.tic).join(""))[0]||i.indexOf("Infinity")>-1||this.parent.getErrorStrings().indexOf(i)>-1?this.parent.getValueFromArg(s[1]).split(this.parent.tic).join(""):i)},r.prototype.ComputePRODUCT=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var i,s,o=1,a=0;if(!t.isNullOrUndefined(r))for(var l=r,h=0;h<l.length;h++){var p=l[h];if(p.indexOf(":")>-1&&this.parent.isCellReference(p)){a=0;for(var c=this.parent.getCellCollection(p),u=0;u<c.length;u++){if(i=this.parent.getValueFromArg(c[u].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(i)>-1)return i;i="TRUE"===i.split(this.parent.tic).join("")?"1":"FALSE"===i.split(this.parent.tic).join("")?"0":i,t.isNullOrUndefined(i)||isNaN(this.parent.parseFloat(i))?(a+=1)===c.length&&(o=0):o*=this.parent.parseFloat(i)}}else{if(s=this.parent.getValueFromArg(l[h].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(s)>-1)return s;if(s="TRUE"===s.split(this.parent.tic).join("")?"1":"FALSE"===s.split(this.parent.tic).join("")?"0":s,t.isNullOrUndefined(s)||isNaN(this.parent.parseFloat(s))){(a+=1)===l.length&&(o=0);continue}if(this.parent.getErrorStrings().indexOf(s)>-1)return s;s.length>0&&(o*=this.parent.parseFloat(s+""))}}return o.toString()},r.prototype.ComputeDAYS=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i;if(t.isNullOrUndefined(r)&&1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];if(2!==r.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var s=r;s[0].split(this.parent.tic).join("")===this.parent.trueValue&&(s[0]="1"),s[0].split(this.parent.tic).join("")===this.parent.falseValue&&(s[0]="0");var o=this.parent.getValueFromArg(s[0].split(this.parent.tic).join("")),a=this.parent.getValueFromArg(s[1].split(this.parent.tic).join(""));if(a=""===a||null==a?new Date(Date.parse("1899-12-31")).toDateString():a,"#"===(o=""===o||null==o?new Date(Date.parse("1899-12-31")).toDateString():o)[0])return o;if("#"===a[0])return a;var l=this.parent.parseDate(o),h=this.parent.parseDate(a);return"#"===l.toString()[0]?l.toString():"#"===h.toString()[0]?h.toString():"[object Date]"!==Object.prototype.toString.call(l)||"[object Date]"!==Object.prototype.toString.call(h)?this.parent.getErrorStrings()[e.CommonErrors.value]:(i=Math.ceil(l.getTime()-h.getTime())/864e5,Math.round(i))},r.prototype.ComputeCHOOSE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];if(r.length<2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var i=r;if(i[0].indexOf(":")>-1&&this.parent.isCellReference(i[0])){if(1!==(l=this.parent.getCellCollection(i[0])).length)return this.parent.getErrorStrings()[e.CommonErrors.value];i[0]=l[0]}var s=this.parent.getValueFromArg(i[0]);if(this.parent.getErrorStrings().indexOf(s)>-1)return s;var o=this.parent.parseFloat(this.parent.getValueFromArg(i[0].split(this.parent.tic).join("")));if(o<1)return this.parent.getErrorStrings()[e.CommonErrors.value];o=Math.floor(o);var a;if(t.isNullOrUndefined(i[o]))return this.parent.getErrorStrings()[e.CommonErrors.value];if(""===(a=i[o])&&(a="0"),a.indexOf(":")>-1&&this.parent.isCellReference(a)){var l;if(1!==(l=this.parent.getCellCollection(i[0].split(this.parent.tic).join(""))).length)return this.parent.getErrorStrings()[e.CommonErrors.value];i[0]=l[0]}return this.parent.getValueFromArg(a).split(this.parent.tic).join("")},r.prototype.ComputeSUMIF=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;if(n[0].indexOf(":")<0&&!this.parent.isCellReference(n[0]))return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.improper_formula];var i=this.parent.computeSumIfAndAvgIf(t);return"string"==typeof i&&(this.parent.formulaErrorStrings.indexOf(i)||this.parent.getErrorStrings().indexOf(i))?i:i[0]},r.prototype.ComputeABS=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i=t,s="";if(0===t.length||t.length>1)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];if(""===i[0].toString().split(this.parent.tic).join("").trim()||i[0].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.value];if(this.parent.isCellReference(i[0])){if(""===(s=this.parent.getValueFromArg(i[0])))return this.parent.getErrorStrings()[e.CommonErrors.name];if(n=this.parent.parseFloat(s),isNaN(n))return this.parent.getErrorStrings()[e.CommonErrors.value]}else if(n=this.parent.parseFloat(i[0]),isNaN(n))return this.parent.getErrorStrings()[e.CommonErrors.name];return Math.abs(n)},r.prototype.ComputeAVERAGE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];for(var i=r,s=0;s<i.length;s++)if(i[s].indexOf(":")>-1&&i[s].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.value];return this.parent.calculateAvg(i)},r.prototype.ComputeAVERAGEIF=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;if(n[0].indexOf(":")<0&&!this.parent.isCellReference(n[0]))return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.improper_formula];var i=this.parent.computeSumIfAndAvgIf(t);return"string"==typeof i&&(this.parent.formulaErrorStrings.indexOf(i)||this.parent.getErrorStrings().indexOf(i))?i:this.parent.parseFloat(i[0])/this.parent.parseFloat(i[1])},r.prototype.ComputeCONCATENATE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];for(var i=r,s="",o="",a=0;a<i.length;a++){if(i[a].indexOf(":")>-1&&this.parent.isCellReference(i[a])){if(!this.isConcat)return this.parent.getErrorStrings()[e.CommonErrors.value];for(var l=this.parent.getCellCollection(i[a]),h=0;h<l.length;h++)s+=o=this.parent.getValueFromArg(l[h])}else{if(1===i.length&&i[0].indexOf(this.parent.tic)<0)return this.parent.getErrorStrings()[e.CommonErrors.name];s+=o=this.parent.getValueFromArg(i[a])}if(this.parent.getErrorStrings().indexOf(o)>-1)return o}return s.split(this.parent.tic).join("")},r.prototype.ComputeCONCAT=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.isConcat=!0,this.ComputeCONCATENATE.apply(this,e)},r.prototype.ComputeMAX=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeMinMax(e,"max")},r.prototype.ComputeMIN=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeMinMax(e,"min")},r.prototype.ComputeRAND=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return 1===t.length&&""===t[0]&&(t.length=0),t.length>0?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments]:Math.random().toString()},r.prototype.ComputeAND=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeAndOr(e,"and")},r.prototype.ComputeOR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeAndOr(e,"or")},r.prototype.ComputeFIND=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var i=r;if(i.length>3)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var s=this.parent.removeTics(this.parent.getValueFromArg(i[0])),o=this.parent.removeTics(this.parent.getValueFromArg(i[1]));if(this.parent.getErrorStrings().indexOf(s)>-1||this.parent.getErrorStrings().indexOf(o)>-1)return this.parent.getErrorStrings()[e.CommonErrors.name];var a,l=1;if(3===i.length){if(l=this.parent.removeTics(this.parent.getValueFromArg(i[2])),this.parent.getErrorStrings().indexOf(l)>-1)return l;l=this.parent.parseFloat(l),isNaN(l)&&(l=1)}return l<=0||l>o.length?this.parent.getErrorStrings()[e.CommonErrors.value]:(a=o.indexOf(s,l-1))<0?this.parent.getErrorStrings()[e.CommonErrors.value]:(Number(a)+Number(1)).toString()},r.prototype.ComputeINDEX=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r,s=i.length;if(t.isNullOrUndefined(r)||1===i.length&&""===i[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];if(s>3)return this.parent.getErrorStrings()[e.CommonErrors.ref];var o="",a=[];if(s>2)for(var l=0;l<s;l++){if(this.parent.isCellReference(i[l])&&i[l].indexOf(":")<0)return this.parent.getErrorStrings()[e.CommonErrors.ref];this.parent.isCellReference(i[l])&&(a[l]=i[l])}if(o=i[0],i[1]=""===i[1]?"1":i[1],i[1]=this.parent.getValueFromArg(i[1]),this.parent.getErrorStrings().indexOf(i[1])>-1)return i[1];if(!t.isNullOrUndefined(i[2])){if(i[2]=""===i[2]?"1":i[2],i[2]=this.parent.getValueFromArg(i[2]),this.parent.getErrorStrings().indexOf(i[2])>-1)return i[2];if("0"===i[2])return this.parent.getErrorStrings()[e.CommonErrors.value]}var h=parseFloat(i[1]);h=isNaN(h)?-1:h;var p=parseFloat(i[2]?i[2]:"1");if(p=isNaN(p)?-1:p,-1===h||-1===p)return this.parent.getErrorStrings()[e.CommonErrors.value];var c=i[0].indexOf(":"),u=this.parent.rowIndex(o.substring(0,c)),d=this.parent.rowIndex(o.substring(c+1)),f=this.parent.colIndex(o.substring(0,c)),m=this.parent.colIndex(o.substring(c+1));if(h>d-u+1||p>m-f+1)return this.parent.getErrorStrings()[e.CommonErrors.ref];h=u+h-1,p=f+p-1;var g=""+this.parent.convertAlpha(p)+h,y=this.parent.getValueFromArg(g);return""===y?0:y},r.prototype.ComputeIFS=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r;if(t.isNullOrUndefined(r)||1===i.length&&""===i[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var s="",o="",a=0;a<i.length;a++){if((s=this.parent.getValueFromArg(i[a]))!==this.parent.trueValue&&s!==this.parent.falseValue)return this.parent.getErrorStrings()[e.CommonErrors.value];if(s===this.parent.trueValue)return i[a+1].indexOf(this.parent.arithMarker)>-1?this.parent.trueValue:(o=this.parent.isCellReference(i[a+1].split(this.parent.tic).join(""))?this.parent.getValueFromArg(i[a+1]):i[a+1].indexOf(this.parent.tic)>-1?i[a+1].split(this.parent.tic).join(""):this.parent.getErrorStrings()[e.CommonErrors.name],a+=1,o);s===this.parent.falseValue&&(a+=1)}return this.parent.getErrorStrings()[e.CommonErrors.na]},r.prototype.ComputeCOUNTA=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var i,s=r,o=0,a=0;a<s.length;a++)if(s[a].indexOf(":")>-1&&this.parent.isCellReference(s[a])){i=this.parent.getCellCollection(s[a].split(this.parent.tic).join(""));for(var l=0;l<i.length;l++)this.parent.getValueFromArg(i[l]).length>0&&o++}else{this.parent.getValueFromArg(s[a].split(this.parent.tic).join("")).length>0&&o++}return o},r.prototype.ComputeAVERAGEA=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var i,s,o=r,a=0,l=0,h=0;h<o.length;h++)if(o[h].indexOf(":")>-1&&this.parent.isCellReference(o[h])){i=this.parent.getCellCollection(o[h].split(this.parent.tic).join(""));for(var p=0;p<i.length;p++){if((s=this.parent.getValueFromArg(i[p])).toUpperCase()===this.parent.trueValue)s="1";else if(s.toUpperCase()===this.parent.falseValue||""===s)s="0";else if(isNaN(parseFloat(s)))return this.parent.getErrorStrings()[e.CommonErrors.name];s.length>0&&(a+=parseFloat(s))}l=i.length}else{o[h]===this.parent.trueValue&&(o[h]="1"),o[h]!==this.parent.falseValue&&""!==o[h]||(o[h]="0");var c=this.parent.getValueFromArg(o[h].split(this.parent.tic).join(""));if(o[h].indexOf(this.parent.tic)>-1){if(isNaN(parseFloat(o[h].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[e.CommonErrors.value];if(isNaN(parseFloat(c)))return this.parent.getErrorStrings()[e.CommonErrors.name];c.length>0&&(a+=parseFloat(c)),l+=1}}return a/l},r.prototype.ComputeCOUNTIF=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r;if(t.isNullOrUndefined(r)||""===r[0]||i.length<2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var s,o,a=0,l=[],h="equal",p=i[1].split(this.parent.tic).join("");if(p.startsWith("<=")?(h="lessEq",p=p.substring(2)):p.startsWith(">=")?(h="greaterEq",p=p.substring(2)):p.startsWith("<>")?(h="notEq",p=p.substring(2)):p.startsWith("<")?(h="less",p=p.substring(1)):p.startsWith(">")?(h="greater",p=p.substring(1)):p.startsWith("=")&&(h="equal",p=p.substring(1)),i[0].indexOf(":")>-1&&this.parent.isCellReference(i[0])){s=this.parent.getCellCollection(i[0].split(this.parent.tic).join(""));for(var c=0;c<s.length;c++)o=this.parent.getValueFromArg(s[c]),(p.indexOf("*")>-1||p.indexOf("?")>-1)&&(o=this.parent.findWildCardValue(p,o)),l.push(o),l.push(p),this.parent.processLogical(l,h)===this.parent.trueValue&&a++}return a},r.prototype.ComputeSUMIFS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeIfsFormulas(e,this.parent.falseValue)},r.prototype.ComputeCOUNTIFS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeIfsFormulas(e,this.parent.trueValue)},r.prototype.ComputeAVERAGEIFS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeIfsFormulas(e,this.parent.falseValue,this.parent.trueValue)},r.prototype.ComputeMATCH=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r;if(t.isNullOrUndefined(i)||1===i.length&&""===i[0]||i.length<2||i.length>3)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var s,o=[],a=i[0].split(this.parent.tic).join("");i[2]=t.isNullOrUndefined(i[2])?"1":i[2].split(this.parent.tic).join(""),i[2].split(this.parent.tic).join("")===this.parent.trueValue&&(i[2]="1"),i[2].split(this.parent.tic).join("")===this.parent.falseValue&&(i[2]="0");var l=parseFloat(i[2]);if(-1!==l&&0!==l&&1!==l)return this.parent.getErrorStrings()[e.CommonErrors.na];var h=0,p="";if(i[1].indexOf(":")>-1||this.parent.isCellReference(i[1])){s=this.parent.getCellCollection(i[1].split(this.parent.tic).join(""));for(var c=0;c<s.length;c++)o[c]=this.parent.getValueFromArg(s[c]).split(this.parent.tic).join("");for(var u=0;u<o.length;u++)if(1===l){if(a===o[u])return u+1;a>o[u]&&(p?o[u]>p&&(h=u+1,p=o[u]):(h=u+1,p=o[u]))}else if(0===l){if((a.indexOf("*")>-1||a.indexOf("?")>-1)&&(o[u]=this.parent.findWildCardValue(a,o[u])),a===o[u])return u+1;if(this.parent.parseFloat(a)===this.parent.parseFloat(o[u]))return u+1}else if(-1===l){if(a===o[u])return u+1;a<o[u]&&(p?o[u]<p&&(h=u+1,p=o[u]):(h=u+1,p=o[u]))}}return h||this.parent.getErrorStrings()[e.CommonErrors.na]},r.prototype.ComputeLOOKUP=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r;return t.isNullOrUndefined(i)||1===i.length&&""===i[0]||i.length<2||i.length>3?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments]:this.parent.computeLookup(i)},r.prototype.ComputeVLOOKUP=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r;return t.isNullOrUndefined(i)||1===i.length&&""===i[0]||i.length<3||i.length>4?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments]:this.parent.computeVLookup(i)},r.prototype.ComputeSUBTOTAL=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t,i="";if(n.length<2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var s=this.parent.parseFloat(this.parent.getValueFromArg(n[0].split(this.parent.tic).join("")));isNaN(s)&&this.parent.getErrorStrings()[e.CommonErrors.value],(s<1||s>11)&&(s<101||s>111)&&this.parent.getErrorStrings()[e.CommonErrors.value];var o=n.slice(1,n.length);switch(s){case 1:case 101:i=this.ComputeAVERAGE.apply(this,o);break;case 2:case 102:i=this.ComputeCOUNT.apply(this,o);break;case 3:case 103:i=this.ComputeCOUNTA.apply(this,o);break;case 4:case 104:i=this.ComputeMAX.apply(this,o);break;case 5:case 105:i=this.ComputeMIN.apply(this,o);break;case 6:case 106:i=this.ComputePRODUCT.apply(this,o);break;case 7:case 107:i=this.ComputeDAY.apply(this,o);break;case 8:case 108:i=this.ComputeCONCAT.apply(this,o);break;case 9:case 109:i=this.ComputeSUM.apply(this,o);break;case 10:case 110:i=this.ComputeAVERAGEA.apply(this,o);break;case 11:case 111:i=this.ComputeABS.apply(this,o);break;default:i=this.parent.getErrorStrings()[e.CommonErrors.value]}return i},r.prototype.ComputeRADIANS=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;if(""===n[0]||n.length>1)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];if(n[0].indexOf(":")>-1||""===n[0].split(this.parent.tic).join(""))return this.parent.getErrorStrings()[e.CommonErrors.value];var i=n[0].split(this.parent.tic).join("");n[0]=isNaN(this.parent.parseFloat(i))?n[0]:i;var s=this.parent.getValueFromArg(n[0]),o=this.parent.parseFloat(s);return isNaN(o)?s.indexOf(this.parent.tic)>-1?this.parent.getErrorStrings()[e.CommonErrors.value]:this.parent.getErrorStrings()[e.CommonErrors.name]:Math.PI*o/180},r.prototype.ComputeRANDBETWEEN=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i,s,o=t.length;if(2!==o)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var a=0;a<o;a++){if(""===t[a])return this.parent.getErrorStrings()[e.CommonErrors.na];if(t[a].indexOf(this.parent.tic)>-1){if(isNaN(parseFloat(t[a].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[e.CommonErrors.value];t[a]=t[a].split(this.parent.tic).join("")}if(s=parseFloat(this.parent.getValueFromArg(t[a])),this.parent.isCellReference(t[a])){if(s=""===this.parent.getValueFromArg(t[a])?0:s,0===a?n=s:i=s,0===n&&0===i)return"0";if(isNaN(s))return this.parent.getErrorStrings()[e.CommonErrors.value]}else{if(isNaN(s))return this.parent.getErrorStrings()[e.CommonErrors.name];0===a?n=s:i=s}}return i<n?this.parent.getErrorStrings()[e.CommonErrors.num]:0===n?Math.floor(Math.random()*(i-(n-1)))+n:i-n==1?Math.round(Math.random()*(i-n)+n):Math.floor(Math.random()*(i-(n-1)))+n},r.prototype.getModuleName=function(){return"basic-formulas"},r}(),ot=function(){function r(e){this.emptyStr="",this.storedStringText=this.emptyStr,this.sheetToken="!",this.tokenAdd="a",this.tokenSubtract="s",this.tokenMultiply="m",this.tokenDivide="d",this.tokenLess="l",this.charEm="r",this.charEp="x",this.tokenGreater="g",this.tokenEqual="e",this.tokenLessEq="k",this.tokenGreaterEq="j",this.tokenNotEqual="o",this.tokenAnd="c",this.tokenEm="v",this.tokenEp="t",this.tokenOr=String.fromCharCode(126),this.charAnd="i",this.charLess="<",this.charGreater=">",this.charEqual="=",this.charLessEq="f",this.charGreaterEq="h",this.charNoEqual="z",this.stringGreaterEq=">=",this.stringLessEq="<=",this.stringNoEqual="<>",this.stringAnd="&",this.stringOr="^",this.charOr="w",this.charAdd="+",this.charSubtract="-",this.charMultiply="*",this.charDivide="/",this.fixedReference="$",this.spaceString=" ",this.ignoreBracet=!1,this.isError=!1,this.isFormulaParsed=!1,this.findNamedRange=!1,this.stringsColl=new Map,this.tokens=[this.tokenAdd,this.tokenSubtract,this.tokenMultiply,this.tokenDivide,this.tokenLess,this.tokenGreater,this.tokenEqual,this.tokenLessEq,this.tokenGreaterEq,this.tokenNotEqual,this.tokenAnd,this.tokenOr],this.charNOTop=String.fromCharCode(167),this.specialSym=["~","@","#","?","%"],this.isFailureTriggered=!1,this.parent=e}return r.prototype.parse=function(r,n){if(this.parent.isTextEmpty(r))return r;this.parent.getFormulaCharacter()!==String.fromCharCode(0)&&this.parent.getFormulaCharacter()===r[0]&&(r=r.substring(1)),(this.parent.namedRanges.size>0||this.parent.storedData.size>0)&&(r=this.checkForNamedRangeAndKeyValue(r),this.findNamedRange=!1),r=(r=(r=(r=r.split("-+").join("-")).split("--").join("+")).split("+-").join("-")).split("-(-").join("(");var i=this.storeStrings(r);r=this.storedStringText;var s=0;if(t.isNullOrUndefined(i)&&(r=r.split(" ").join("")),r=r.split("=>").join(">="),(r=r.split("=<").join("<="))[r.length-1]===this.parent.arithMarker&&this.indexOfAny(r,this.tokens)===r.length-2||(r=r.toUpperCase()),r.indexOf(this.sheetToken)>-1){var o=this.parent.getSheetFamilyItem(this.parent.grid);if(null!=o.sheetNameToParentObject&&o.sheetNameToParentObject.size>0){r[0]!==this.sheetToken.toString()&&(r=this.parent.setTokensForSheets(r));var a=this.parent.getSheetToken(r.split(this.parent.tic).join(this.emptyStr)),l=this.checkScopedRange(r.split('"').join(this.emptyStr).split(this.sheetToken).join(""));t.isNullOrUndefined(a)&&""!==a&&this.parent.namedRanges.size>0&&""!==l&&(r=l)}}r=this.markLibraryFormulas(r);try{r=this.formulaAutoCorrection(r)}catch(t){if(!(c={message:t.message,exception:t,isForceCalculable:t.formulaCorrection,computeForceCalculate:!1}).isForceCalculable)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_expression];if(this.isFailureTriggered||(this.parent.trigger("onFailure",c),this.isFailureTriggered=!0),!c.isForceCalculable||!c.computeForceCalculate)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_expression];r=this.formulaAutoCorrection(r,c),this.parent.storedData.get(n).formulaText="="+r}if(!this.ignoreBracet)for(s=r.indexOf(")");s>-1;){var h=r.substring(0,s).lastIndexOf("(");if(-1===h)throw new pt(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.mismatched_parentheses]);if(h===s-1)throw new pt(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.empty_expression]);var p=this.emptyStr;p=this.ignoreBracet?this.parent.substring(r,h,s-h+1):this.parent.substring(r,h+1,s-h-1);try{r=r.substring(0,h)+this.parseSimple(p)+r.substring(s+1)}catch(e){var c=this.exceptionArgs(e);this.isFailureTriggered||(this.parent.trigger("onFailure",c),this.isFailureTriggered=!0);var u="string"==typeof c.exception?c.exception:c.message;return(this.parent.getErrorLine(e)?"":"#"+this.parent.getErrorLine(e)+": ")+u}s=r.indexOf(")")}if(!this.ignoreBracet&&r.indexOf("(")>-1)throw new pt(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.mismatched_parentheses]);return r=this.parseSimple(r),null!==i&&i.size>0&&(r=this.setStrings(r,i)),r},r.prototype.exceptionArgs=function(e){return{message:e.message,exception:e,isForceCalculable:e.formulaCorrection,computeForceCalculate:!1}},r.prototype.formulaAutoCorrection=function(r,n){var i=["*","+","-","/","^","&"],s=[">","=","<"],o=0,a="",l="",h="",p="",c="",u="",d="",f=0;if(this.parent.formulaErrorStrings.indexOf(r)>-1)return r;if(this.indexOfAny(r,this.specialSym)>-1)throw new pt(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_expression],!1);for(;o<r.length;)if(r.indexOf("&")>-1||this.parent.isDigit(r[o])&&r.length>o+1&&this.indexOfAny(r[o+1],i)>-1&&r.length>o+2&&!t.isNullOrUndefined(r[o+2])&&this.indexOfAny(r[o+2],i)>-1){if(t.isNullOrUndefined(n))throw new pt(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_expression],!0);if(!n.computeForceCalculate)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.improper_formula];this.parent.isDigit(r[o])?(f<1?(u=r[o],h=r[o+1],t.isNullOrUndefined(h)&&(h=this.emptyStr),f+=1,a=a+u+(h="&"===h?"":h)):f<2&&(d=r[o],p=r[o-1],c=r[o+1],f=0,a="-"===p?a+p+d+(c="&"===(c=t.isNullOrUndefined(c)?this.emptyStr:c)?"":c):a+d+(c=t.isNullOrUndefined(c)?this.emptyStr:c)),o+=2):(a="-"===r[o]?a+r[o]:a,o+=1)}else if((this.parent.isDigit(r[o])||r[o]===this.parent.rightBracket||this.parent.storedData.has(r[o].toUpperCase()))&&(t.isNullOrUndefined(r[o+1])||this.indexOfAny(r[o+1],i))>-1)l="&"===(l=t.isNullOrUndefined(r[o+1])?this.emptyStr:r[o+1])?"":l,a="-"===r[o-1]?a+r[o-1]+r[o]+l:a+r[o]+l,o+=2;else if(this.indexOfAny(r[o],s)>-1&&!t.isNullOrUndefined(r[o-1])&&!t.isNullOrUndefined(r[o+1]))a+=r[o],o+=1;else if("q"===r[o])for(;r[o]!==this.parent.leftBracket;)a+=r[o],o+=1;else r[o]===this.parent.leftBracket||r[o]===this.parent.rightBracket||"{"===r[o]||"}"===r[o]||"("===r[o]||")"===r[o]?(a+=r[o],o+=1):this.parent.isUpperChar(r[o])||r[o].indexOf(":")>-1||r[o]===this.parent.getParseArgumentSeparator()||"%"===r[o]&&this.parent.isDigit(r[o-1])?(a+=r[o],o+=1):r[o]===this.parent.tic||" "===r[o]||"."===r[o]||r[o]===this.sheetToken||"$"===r[o]?(a+=r[o],o+=1):(this.parent.isDigit(r[o])&&(a="-"===r[o-1]?a+r[o-1]+r[o]:a+r[o]),"-"===r[o]&&(a=(a+=r[o]).split("++").join("+").split("+-").join("-").split("-").join("-")),o+=1);return a=a===this.emptyStr?r:a,this.indexOfAny(a[a.length-1],i)>-1&&(a=a.substring(0,a.length-1)),a=a.split("--").join("-").split("-+").join("-").split("+-").join("-")},r.prototype.checkScopedRange=function(e){var r=this,n=this.emptyStr,i="NaN",s=this.parent.getSheetID(this.parent.grid),o=this.parent.getSheetFamilyItem(this.parent.grid);if(e[0]===this.sheetToken.toString()){var a=e.indexOf(this.sheetToken,1),l=parseInt(e.substr(1,a-1),10);a>1&&!this.parent.isNaN(l)&&(e=e.substring(a+1),s=l)}var h="!"+s.toString()+"!";return null===o||null==o.sheetNameToToken?i:(o.sheetNameToToken.forEach(function(s,a){if(o.sheetNameToToken.get(a).toString()===h){var l=r.emptyStr;r.parent.namedRanges.forEach(function(s,a){l=t.isNullOrUndefined(r.parent.parentObject)?o.sheetNameToToken.get(a).toUpperCase():(r.parent.parentObject.getActiveSheet().name+r.sheetToken+e).toUpperCase(),r.parent.getNamedRanges().has(l)&&(n=r.parent.getNamedRanges().get(l).toUpperCase(),i=n)})}}),i)},r.prototype.storeStrings=function(t){var r,n=0,i=0,s=0,o="",a=null,l=t.indexOf(this.parent.tic),h=t.indexOf(this.parent.singleTic);if(l>-1||h>-1)for(n=(t=t.split(this.parent.singleTic).join(this.parent.tic)).indexOf(this.parent.tic);n>-1&&t.length>0;){if(null===a&&(a=this.stringsColl),-1===(i=n+1<t.length?t.indexOf(this.parent.tic,n+1):-1))throw new pt(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.mismatched_tics]);r=this.parent.substring(t,n,i-n+1),o=this.parent.tic+this.spaceString+s.toString()+this.parent.tic,a=a.set(o,r),t=t.substring(0,n)+o+t.substring(i+1),(n+=o.length)<t.length&&(n=t.indexOf(this.parent.tic,n)),s++}return this.storedStringText=t,a},r.prototype.setStrings=function(e,t){for(var r=0;r<t.size;r++)t.forEach(function(t,r){e=e.split(r).join(t)});return e},r.prototype.parseSimple=function(e){var t=e;if(t.length>0&&"+"===t[0]&&(t=t.substring(1)),"#DIV/0!"===t)return"#DIV/0!";if("#NAME?"===t)return"#NAME?";if(""===t)return t;if(this.parent.formulaErrorStrings.indexOf(t)>-1)return t;t=(t=(t=(t=(t=(t=t.split(this.stringLessEq).join(this.charLessEq)).split(this.stringGreaterEq).join(this.charGreaterEq)).split(this.stringNoEqual).join(this.charNoEqual)).split(this.stringAnd).join(this.charAnd)).split(this.stringOr).join(this.charOr)).split(this.fixedReference).join(this.emptyStr);var r=[this.tokenEp,this.tokenEm],n=[this.tokenMultiply,this.tokenDivide],i=[this.tokenAdd,this.tokenSubtract],s=[this.charMultiply,this.charDivide],o=[this.charAdd,this.charSubtract],a=[this.tokenLess,this.tokenGreater,this.tokenEqual,this.tokenLessEq,this.tokenGreaterEq,this.tokenNotEqual],l=[this.charLess,this.charGreater,this.charEqual,this.charLessEq,this.charGreaterEq,this.charNoEqual],h=[this.charEp,this.charEm],p=[this.tokenAnd],c=[this.charAnd],u=[this.charOr],d=[this.tokenOr];return t=this.parseSimpleOperators(t,r,h),t=this.parseSimpleOperators(t,d,u),t=this.parseSimpleOperators(t,n,s),t=this.parseSimpleOperators(t,i,o),t=this.parseSimpleOperators(t,a,l),t=this.parseSimpleOperators(t,p,c)},r.prototype.parseSimpleOperators=function(t,r,n){if(this.parent.getErrorStrings().indexOf(t)>-1)return t;for(var i=t,s=0,o="",a=0;a<n.length;a++)o+=n[a];(i=(i=i.split("---").join("-").split("--").join("+").split(this.parent.getParseArgumentSeparator()+"-").join(this.parent.getParseArgumentSeparator()+"u").split(this.parent.leftBracket+"-").join(this.parent.leftBracket+"u").split("=-").join("=u")).split(",+").join(",").split(this.parent.leftBracket+"+").join(this.parent.leftBracket).split("=+").join("=").split(">+").join(">").split("<+").join("<").split("/+").join("/").split("*+").join("*").split("++").join("+").split("*-").join("*u").toString()).length>0&&"-"===i[0]?(i="0-"+(i=i.substring(1).split("-").join(this.tokenOr)),i=(i=this.parseSimpleOperators(i,[this.tokenSubtract],[this.charSubtract])).split(this.tokenOr).join("-")):i.length>0&&"+"===i[0]?i=i.substring(1):i.length>0&&"+"===i[i.length-1]&&(i=i.substring(0,i.length-1));try{if(this.indexOfAny(i,n)>-1)for(s=this.indexOfAny(i,n);s>-1;){var l="",h="",p=0,c=0,u=0;if(i[s]===this.charNOTop)p=s;else if(u=s-1,i[u]===this.parent.arithMarker){if((f=this.findLeftMarker(i.substring(0,u-1)))<0)throw new pt(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.cannot_parse]);l=this.parent.substring(i,f+1,u-f-1),p=f+1}else if(i[u]===this.parent.rightBracket){for(var d=0,f=u-1;f>0&&("q"!==i[f]||0!==d);)"q"===i[f]?d--:i[f]===this.parent.rightBracket&&d++,f--;if(f<0)throw new pt(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.cannot_parse]);l=this.parent.substring(i,f,u-f+1),p=f}else if(i[u]===this.parent.tic[0]){var m=i.substring(0,u-1).lastIndexOf(this.parent.tic);if(m<0)throw new pt(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.cannot_parse]);l=this.parent.substring(i,m,u-m+1),p=m}else{for(var g=!1;u>-1&&(this.parent.isDigit(i[u])||!g&&i[u]===this.parent.getParseDecimalSeparator());)i[u]===this.parent.getParseDecimalSeparator()&&(g=!0),u-=1;if(u>-1&&g&&i[u]===this.parent.getParseDecimalSeparator())throw new pt(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.number_contains_2_decimal_points]);if(0===(u+=1)||u>0&&!this.parent.isUpperChar(i[u-1]))l="n"+this.parent.substring(i,u,s-u),p=u;else{for(u-=1;u>-1&&(this.parent.isUpperChar(i[u])||this.parent.isDigit(i[u]));)u-=1;if(u>-1&&i[u]===this.sheetToken){for(u-=1;u>-1&&i[u]!==this.sheetToken;)u-=1;u>-1&&i[u]===this.sheetToken&&(u-=1)}u+=1,l=this.parent.substring(i,u,s-u),this.parent.updateDependentCell(l),p=u}(this.parent.namedRanges.size>0&&this.parent.namedRanges.has(l.toUpperCase())||this.parent.storedData.has(l.toUpperCase()))&&(l="n"+this.checkForNamedRangeAndKeyValue(l))}if(s===i.length-1)throw new pt(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.expression_cannot_end_with_an_operator]);var y="u"===i[u=s+1];if(y&&(u+=1),i[u]===this.parent.tic[0]){if((f=i.substring(u+1).indexOf(this.parent.tic))<0)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.cannot_parse];h=this.parent.substring(i,u,f+2),c=f+u+2}else if(i[u]===this.parent.arithMarker){if((f=this.findRightMarker(i.substring(u+1)))<0)throw new pt(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.cannot_parse]);h=this.parent.substring(i,u+1,f),c=f+u+2}else if("q"===i[u]){for(d=0,f=u+1;f<i.length&&(i[f]!==this.parent.rightBracket||0!==d);)i[f]===this.parent.rightBracket?d++:"q"===i[f]&&d--,f++;if(f===i.length)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.cannot_parse];h=this.parent.substring(i,u,f-u+1),y&&(h="u"+h),c=f+1}else if(this.parent.isDigit(i[u])||i[u]===this.parent.getParseDecimalSeparator()){g=i[u]===this.parent.getParseDecimalSeparator();for(u+=1;u<i.length&&(this.parent.isDigit(i[u])||!g&&i[u]===this.parent.getParseDecimalSeparator());)i[u]===this.parent.getParseDecimalSeparator()&&(g=!0),u+=1;if(u<i.length&&"%"===i[u]&&(u+=1),g&&u<i.length&&i[u]===this.parent.getParseDecimalSeparator())throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.number_contains_2_decimal_points];h="n"+this.parent.substring(i,s+1,u-s-1),c=u}else if(this.parent.isUpperChar(i[u])||i[u]===this.sheetToken||"u"===i[u]){if(i[u]===this.sheetToken)for(u+=1;u<i.length&&i[u]!==this.sheetToken;)u+=1;u+=1;for(var v=0,C=!1;u<i.length&&(this.parent.isUpperChar(i[u])||"_"===i[u]||"."===i[u]||"["===i[u]||"]"===i[u]||"#"===i[u]||" "===i[u]||"%"===i[u]||i[u]===this.parent.getParseDecimalSeparator()&&C);)u!==i.length-1&&"["===i[u]&&"["===i[u+1]&&(C=!0),u!==i.length-1&&"]"===i[u]&&"]"===i[u+1]&&(C=!1),u++,v++;u===i.length||this.parent.isDigit(i[u]);if(v>1){for(;u<i.length&&(this.parent.isUpperChar(i[u])||this.parent.isDigit(i[u])||" "===i[u]||"_"===i[u]);)u++;!0}for(;u<i.length&&this.parent.isDigit(i[u]);)u+=1;if(u<i.length&&":"===i[u]){if((u+=1)<i.length&&i[u]===this.sheetToken){for(u++;u<i.length&&i[u]!==this.sheetToken;)u+=1;u<i.length&&i[u]===this.sheetToken&&u++}for(;u<i.length&&this.parent.isUpperChar(i[u]);)u+=1;for(;u<i.length&&this.parent.isDigit(i[u]);)u+=1;u-=1,h=this.parent.substring(i,s+1,u-s)}else u-=1,h=this.parent.substring(i,s+1,u-s),(y="u"===i[u])&&(h="u"+h);!this.parent.isCellReference(h)||this.parent.updateDependentCell(h),(this.parent.namedRanges.size>0&&this.parent.namedRanges.has(h.toUpperCase())||this.parent.storedData.has(h.toUpperCase()))&&(h="n"+this.checkForNamedRangeAndKeyValue(h)),c=u+1}var b=o.indexOf(i[s]),S=this.parent.arithMarker+l+h+r[b]+this.parent.arithMarker;p>0&&(S=i.substring(0,p)+S),c<i.length&&(S+=i.substring(c)),i=S=S.split(this.parent.arithMarker2).join(this.parent.arithMarker.toString()),s=this.indexOfAny(i,n)}else if(i.length>0&&(this.parent.isUpperChar(i[0])||i[0]===this.sheetToken)){var E=!0,x=!0,w=!1,I=i.length;for(f=0;f<I;++f)if(i[f]===this.sheetToken){if(f>0&&!w)throw this.parent.getErrorStrings()[e.CommonErrors.ref];for(w=!0,f++;f<I&&this.parent.isDigit(i[f]);)f++;if(f===I||i[f]!==this.sheetToken){E=!1;break}}else{if(!x&&this.parent.isChar(i[f])){E=!1;break}if(!this.parent.isChar(i[f])&&!this.parent.isDigit(i[f])&&i[f]!==this.sheetToken){E=!1;break}x=this.parent.isUpperChar(i[f])}E&&this.parent.updateDependentCell(i)}return i}catch(e){return e}},r.prototype.indexOfAny=function(e,t){for(var r=0;r<e.length;r++)if(t.indexOf(e[r])>-1)return r;return-1},r.prototype.findLeftMarker=function(e){var t=-1;if(e.indexOf(this.parent.arithMarker)>-1)for(var r=0,n=e.length-1;n>=0;--n)if(e[n]===this.parent.rightBracket)r--;else if(e[n]===this.parent.leftBracket)r++;else if(e[n]===this.parent.arithMarker&&0===r){t=n;break}return t},r.prototype.findRightMarker=function(e){var t=-1;if(e.indexOf(this.parent.arithMarker)>-1)for(var r=0,n=0;n<e.length;++n)if(e[n]===this.parent.rightBracket)r--;else if(e[n]===this.parent.leftBracket)r++;else if(e[n]===this.parent.arithMarker&&0===r){t=n;break}return t},r.prototype.parseFormula=function(e,r){e.length>0&&e[0]===this.parent.getFormulaCharacter()&&(e=e.substring(1)),e.length>0&&"+"===e[0]&&(e=e.substring(1));try{this.isFailureTriggered=!1,this.isError=!1,e=this.parse(e.trim(),r),this.isFormulaParsed=!0}catch(r){var n=this.exceptionArgs(r);this.isFailureTriggered||(this.parent.trigger("onFailure",n),this.isFailureTriggered=!0);var i="string"==typeof n.exception?n.exception:n.message;e=(t.isNullOrUndefined(this.parent.getErrorLine(r))?"":"#"+this.parent.getErrorLine(r)+": ")+i,this.isError=!0}return e},r.prototype.markLibraryFormulas=function(r){var n=0,i=r.indexOf(")");if(-1===i)r=this.markNamedRanges(r);else for(;i>-1;){for(var s=0,o=i-1;o>-1&&("("!==r[o]||0!==s);)")"===r[o]?s++:")"===r[o]&&s--,o--;if(-1===o)throw new pt(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.mismatched_parentheses]);for(var a=o-1;a>-1&&this.parent.isChar(r[a]);)a--;var l=o-a-1,h=this.parent.substring(r,a+1,l);if(l>0&&!t.isNullOrUndefined(this.parent.getFunction(h))){"AREAS"===this.parent.substring(r,a+1,l)?this.ignoreBracet=!0:this.ignoreBracet=!1;var p=this.parent.substring(r,o,i-o+1);try{var c=void 0;p=p.split("(").join("").split(")").join(""),p="("+this.formulaAutoCorrection(p,c)+")"}catch(t){if(!(c={message:t.message,exception:t,isForceCalculable:t.formulaCorrection,computeForceCalculate:!1}).isForceCalculable)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.improper_formula];if(this.isFailureTriggered||(this.parent.trigger("onFailure",c),this.isFailureTriggered=!0,n+=1),c.computeForceCalculate=n>0||c.computeForceCalculate,!c.isForceCalculable)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.improper_formula];if(!c.computeForceCalculate)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.improper_formula];p=p.split("(").join("").split(")").join(""),p="("+this.formulaAutoCorrection(p,c)+")"}p=this.markNamedRanges(p),p=this.swapInnerParens(p);-1===(p=this.addParensToArgs(p)).lastIndexOf(this.parent.getParseArgumentSeparator())&&p.length>2&&"("===p[0]&&")"===p[p.length-1]&&"{"!==p[1]&&"("!==p[1]&&(p=(p=p.substring(0,p.length-1)+"}"+p.substring(p.length-1))[0]+"{"+p.substring(1)),r=r.substring(0,a+1)+"q"+this.parent.substring(r,a+1,l)+p.split("(").join(this.parent.leftBracket).split(")").join(this.parent.rightBracket)+r.substring(i+1)}else{if(l>0)return this.parent.getErrorStrings()[e.CommonErrors.name];var u=this.emptyStr;o>0&&(u=r.substring(0,o)),u=u+"{"+this.parent.substring(r,o+1,i-o-1)+"}",i<r.length&&(u+=r.substring(i+1)),r=u=this.markNamedRanges(u)}i=r.indexOf(")")}return r=r.split("{").join("(").split("}").join(")")},r.prototype.swapInnerParens=function(e){return e.length>2&&(e=e[0]+e.substr(1,e.length-2).split("(").join("{").split(")").join("}")+e[e.length-1]),e},r.prototype.addParensToArgs=function(e){if(0===e.length)return this.emptyStr;var t=[];t.push(this.parent.getParseArgumentSeparator()),t.push(this.parent.rightBracket);var r=e.lastIndexOf(this.parent.getParseArgumentSeparator()),n=0;if(-1===r){if(e.length>2&&"("===e[0]&&")"===e[e.length-1])if("{"!==e[1]&&"("!==e[1])e=(e=e.substring(0,e.length-1)+"}"+e.substring(e.length-1))[0]+"{"+e.substring(1);else{r=this.lastIndexOfAny(e,["+","-","*","/"]),0===n&&")"===e[e.length-1]&&(n=e.length-1),n>0&&"{"!==e[r+1]&&"}"===e[r-1]&&(e=(e=e.substr(0,n)+"}"+e.substr(n)).substr(0,r+1)+"{"+e.substr(r+1))}}else for(var i=!0;r>-1;){var s=this.indexOfAny(e.substring(r+1,e.length),t);s>=0?s=r+s+1:-1===s&&")"===e[e.length-1]&&(s=e.length-1),s>0&&"{"!==e[r+1]&&"}"!==e[s-1]&&(e=(e=e.substr(0,s)+"}"+e.substr(s)).substr(0,r+1)+"{"+e.substr(r+1)),r=e.substr(0,r).lastIndexOf(this.parent.getParseArgumentSeparator()),i&&-1===r&&"("===e[0]&&(r=0,i=!1)}return e=e.split("{}").join(this.emptyStr)},r.prototype.lastIndexOfAny=function(e,t){for(var r=e.length-1;r>-1;r--)if(t.indexOf(e[r])>-1)return r;return-1},r.prototype.markNamedRanges=function(e){var r=[")",this.parent.getParseArgumentSeparator(),"}","+","-","*","/","<",">","=","&"],n=e.length>0&&("("===e[0]||"{"===e[0])?1:0;e.indexOf("#N/A")>-1&&(e=e.split("#N/A").join("#N~A")),e.indexOf("#DIV/0!")>-1&&(e=e.split("#DIV/0!").join("#DIV~0!"));for(var i=this.indexOfAny(e.substring(n),r);i>-1&&i+n<e.length;){var s=this.emptyStr,o=null;if(this.parent.substring(e,n,i).indexOf("[")>-1?o=this.getTableRange(this.parent.substring(e,n,i)):this.parent.storedData.has(this.parent.substring(e,n,i))?o=this.checkForNamedRangeAndKeyValue(this.parent.substring(e,n,i)):this.parent.namedRanges.has(this.parent.substring(e,n,i))&&(o=this.checkForNamedRangeAndKeyValue(this.parent.substring(e,n,i))),t.isNullOrUndefined(o)){if("NaN"!==(s=this.checkScopedRange(this.parent.substring(e,n,i))))this.findNamedRange=!0,o=s;else if(this.parent.substring(e,n,i).startsWith(this.sheetToken.toString()))this.parent.substring(e,n,i).indexOf(this.sheetToken,1);!t.isNullOrUndefined(o)&&this.findNamedRange&&o.indexOf(this.fixedReference)>-1&&(o=o.split(this.fixedReference).join(this.emptyStr))}if(t.isNullOrUndefined(o)||(o=o.toUpperCase(),o=this.parent.setTokensForSheets(o),o=this.markLibraryFormulas(o)),t.isNullOrUndefined(o)||o===this.emptyStr)for(n+=i+1;n<e.length&&!this.parent.isUpperChar(e[n])&&e[n]!==this.sheetToken;)n++;else e=e.substring(0,n)+o+e.substring(n+i),n+=o.length+1;for(i=n,n<e.length-1&&"{"===e[n]&&(n+=1),i=this.indexOfAny(e.substring(n),r);0===i&&n<e.length-1;)n++,i=this.indexOfAny(e.substring(n),r);if((-1===i||e.substring(n).indexOf("[")>-1)&&n<e.length){if(o=e.substring(n).indexOf("[")>-1?this.getTableRange(e.substring(n)):this.parent.storedData.has(e.substring(n))?this.parent.storedData.size>0?this.checkForNamedRangeAndKeyValue(e.substring(n)):o:this.parent.namedRanges.size>0?this.checkForNamedRangeAndKeyValue(e.substring(n)):o,t.isNullOrUndefined(o)&&"NaN"!==(s=this.checkScopedRange(e.substring(n)))&&(o=s),!t.isNullOrUndefined(o)&&o!==this.emptyStr&&(o=o.toUpperCase(),o=this.parent.setTokensForSheets(o),null!=(o=this.markLibraryFormulas(o)))){var a=e.substring(n);e=")"===a[a.length-1]?e.substring(0,n)+o+")":e.substring(0,n)+o,n+=o.toString().length+1}i=n<e.length?this.indexOfAny(e.substring(n),r):-1}}return e.indexOf("#N~A")>-1&&(e=e.split("#N~A").join("#N/A")),e.indexOf("#DIV~0!")>-1&&(e=e.split("#DIV~0!").join("#DIV/0!")),e},r.prototype.checkForNamedRangeAndKeyValue=function(e){var r=this.emptyStr;if(e.indexOf("[")>-1){var n=this.getTableRange(e);t.isNullOrUndefined(n)||(this.findNamedRange=!0,e=n)}if("NaN"!==(r=this.checkScopedRange(e)))this.findNamedRange=!0,e=r;else{if(e.indexOf(this.sheetToken)>-1){var i=this.parent.getSheetFamilyItem(this.parent.grid),s=e.split('"').join(this.emptyStr);if(s=s.substr(0,s.indexOf(this.sheetToken)),i.sheetNameToToken.has(s.toUpperCase()))parseInt(i.sheetNameToToken.get(s.toUpperCase()).split(this.sheetToken).join(this.emptyStr))}this.parent.storedData.size>0&&this.parent.storedData.has(e)&&(e="A"+this.parent.colIndex(e)),this.parent.namedRanges.size>0&&this.parent.namedRanges.has(e.toUpperCase())&&(t.isNullOrUndefined(this.parent.parentObject)?(e=this.parse(this.parent.namedRanges.get(e.toUpperCase())),(e=this.parent.setTokensForSheets(e)).indexOf(this.fixedReference)>-1&&e.split(this.fixedReference).join(this.emptyStr),this.findNamedRange=!0):e=this.parse(this.parent.namedRanges.get(e.toUpperCase()))),this.findNamedRange&&"!"!==e[0]&&"q"!==e[0]&&"bq"!==e[0]&&(e=this.parent.setTokensForSheets(e)).indexOf(this.fixedReference)>-1&&(e=e.split(this.fixedReference).join(this.emptyStr))}return e},r.prototype.getTableRange=function(e){var t=(e=e.replace(" ",this.emptyStr).toUpperCase()).replace("]",this.emptyStr).replace("#DATA",this.emptyStr);t.indexOf(this.parent.getParseArgumentSeparator())>-1&&(t.substring(0,t.indexOf(this.parent.getParseArgumentSeparator())).replace("[",this.emptyStr),t=t.replace("[",this.emptyStr).replace(this.parent.getParseArgumentSeparator(),"_"));this.emptyStr;return t.toUpperCase()},r.prototype.findNextEndIndex=function(e,t){for(var r=0,n=t,i=!1;!i&&t<e.length;)"["===e[n]?r++:"]"===e[n]&&0===--r&&(i=!0),t++;return t-=n},r}(),at=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),lt=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},ht=function(r){function n(e){var n=r.call(this,null,null)||this;n.lFormulas=new Map,n.storedData=new Map,n.keyToRowsMap=new Map,n.rowsToKeyMap=new Map,n.rightBracket=String.fromCharCode(161),n.leftBracket=String.fromCharCode(162),n.sheetToken="!",n.emptyString="",n.leftBrace="{",n.rightBrace="}",n.cell=n.emptyString,n.cellPrefix="!0!A",n.treatEmptyStringAsZero=!1,n.tic='"',n.singleTic="'",n.trueValue="TRUE",n.falseValue="FALSE",n.parseDecimalSeparator=".",n.arithMarker=String.fromCharCode(180),n.arithMarker2=n.arithMarker+n.arithMarker,n.dependentCells=null,n.dependentFormulaCells=null,n.minValue=Number.MIN_SAFE_INTEGER,n.maxValue=Number.MAX_SAFE_INTEGER,n.categoryCollection=["All"],n.dependencyLevel=0,n.refreshedCells=new Map,n.computedValues=null,n.randomValues=new Map,n.isRandomVal=!1,n.randCollection=[],n.formulaErrorStrings=["binary operators cannot start an expression","cannot parse","bad library","invalid char in front of","number contains 2 decimal points","expression cannot end with an operator","invalid characters following an operator","invalid character in number","mismatched parentheses","unknown formula name","requires a single argument","requires 3 arguments","invalid Math argument","requires 2 arguments","#NAME?","too complex","circular reference: ","missing formula","improper formula","invalid expression","cell empty","bad formula","empty expression","","mismatched string quotes","wrong number of arguments","invalid arguments","iterations do not converge","Control is already registered","Calculation overflow","Missing sheet","cannot_parse","expression_cannot_end_with_an_operator"],n.errorStrings=null,n.parseArgumentSeparator=",",n.dateTime1900=new Date(1900,0,1,0,0,0),n.isParseDecimalSeparatorChanged=!1,n.isArgumentSeparatorChanged=!1,n.sheetFamilyID=0,n.defaultFamilyItem=null,n.sheetFamiliesList=null,n.modelToSheetID=null,n.tokenCount=0,n.sortedSheetNames=null,n.tempSheetPlaceHolder=String.fromCharCode(133),n.namedRanges=new Map,n.formulaInfoTable=null,n.oaDate=new Date(1899,11,30),n.millisecondsOfaDay=864e5,n.parseDateTimeSeparator="/";var s=new it(n);return n.includeBasicFormulas&&i.Inject(st),n.injectedModules&&n.injectedModules.length&&s.inject(n.requiredModules(),n.injectedModules),n.parentObject=t.isNullOrUndefined(e)?n:e,n.grid=n.parentObject,n.parser=new ot(n),n}at(n,r),i=n,Object.defineProperty(n.prototype,"libraryFormulas",{get:function(){return this.lFormulas},set:function(e){this.lFormulas.set(e.fName,{handler:e.handler,category:e.category,description:e.description})},enumerable:!0,configurable:!0}),n.prototype.getParseArgumentSeparator=function(){return this.isArgumentSeparatorChanged||","===this.parseArgumentSeparator||(this.parseArgumentSeparator=","),this.parseArgumentSeparator},n.prototype.setParseArgumentSeparator=function(e){this.parseArgumentSeparator=e,this.isArgumentSeparatorChanged=!0},n.prototype.getParseDateTimeSeparator=function(){return this.parseDateTimeSeparator},n.prototype.setTreatEmptyStringAsZero=function(e){this.treatEmptyStringAsZero=e},n.prototype.getTreatEmptyStringAsZero=function(){return this.treatEmptyStringAsZero},n.prototype.setParseDateTimeSeparator=function(e){this.parseDateTimeSeparator=e},n.prototype.requiredModules=function(){return k(this)},n.Inject=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.prototype.injectedModules||(this.prototype.injectedModules=[]);for(var r=0;r<e.length;r++)-1===this.prototype.injectedModules.indexOf(e[r])&&this.prototype.injectedModules.push(e[r])},n.prototype.getInjectedModules=function(){return this.injectedModules},n.prototype.onPropertyChanged=function(e,t){},n.prototype.getModuleName=function(){return"calculate"},n.prototype.getFormulaCharacter=function(){return"="},n.prototype.isUpperChar=function(e){var t=e.charCodeAt(0);return t>64&&t<91},n.prototype.resetKeys=function(){this.storedData.clear(),this.keyToRowsMap.clear(),this.rowsToKeyMap.clear()},n.prototype.updateDependentCell=function(e){var t=this.getSheetFamilyItem(this.grid),r=this.cell;if(null!==t.sheetNameToParentObject){var n=t.parentObjectToToken.get(this.grid);-1===r.indexOf(this.sheetToken)&&(r=n+r),-1===e.indexOf(this.sheetToken)&&(e=n+e)}if(this.getDependentCells().has(e)){var i=this.getDependentCells().get(e);i.indexOf(r)<0&&i.push(r)}else this.getDependentCells().set(e,[r])},n.prototype.getDependentCells=function(){if(this.isSheetMember()){var e=this.getSheetFamilyItem(this.grid);return null==e.sheetDependentCells&&(e.sheetDependentCells=new Map),e.sheetDependentCells}return null==this.dependentCells&&(this.dependentCells=new Map),this.dependentCells},n.prototype.getDependentFormulaCells=function(){if(this.isSheetMember()){var e=this.getSheetFamilyItem(this.grid);return null==e.sheetDependentFormulaCells&&(e.sheetDependentFormulaCells=new Map),e.sheetDependentFormulaCells}return null==this.dependentFormulaCells&&(this.dependentFormulaCells=new Map),this.dependentFormulaCells},n.prototype.getLibraryFormulas=function(){return this.lFormulas},n.prototype.getFunction=function(e){return this.getLibraryFormulas().has(e.toUpperCase())?this.getLibraryFormulas().get(e.toUpperCase()).handler:null},n.prototype.getFormulaInfoTable=function(){if(this.isSheetMember()){var e=this.getSheetFamilyItem(this.grid);return null===e.sheetFormulaInfotable&&(e.sheetFormulaInfotable=new Map),e.sheetFormulaInfotable}return null===this.formulaInfoTable&&(this.formulaInfoTable=new Map),this.formulaInfoTable},n.prototype.getFormula=function(e){return e=e.toUpperCase(),this.storedData.has(e)?this.storedData.get(e).getFormulaText():""},n.prototype.getParseDecimalSeparator=function(){return this.isParseDecimalSeparatorChanged||"."===this.parseDecimalSeparator||(this.parseDecimalSeparator="."),this.parseDecimalSeparator},n.prototype.setParseDecimalSeparator=function(e){this.parseDecimalSeparator=e,this.isParseDecimalSeparatorChanged=!0},n.prototype.getSheetToken=function(t){var r=0,n=this.emptyString;if(r<t.length&&t[r]===this.sheetToken){for(r++;r<t.length&&t[r]!==this.sheetToken;)r++;n=t.substring(0,r+1)}if(r<t.length)return n;throw this.formulaErrorStrings[e.FormulasErrorsStrings.bad_index]},n.prototype.getSheetID=function(e){var t=this.getSheetFamilyItem(e);if(null!=t.sheetNameToParentObject&&t.sheetNameToParentObject.size>0){var r=t.parentObjectToToken.get(e);r=r.split(this.sheetToken).join(this.emptyString);var n=this.parseFloat(r);if(!this.isNaN(n))return n}return-1},n.prototype.parseFloat=function(e){return Number(e)},n.prototype.rowIndex=function(t){var r,n=0,i=!1;if(n<t.length&&t[n]===this.sheetToken){for(n++;n<t.length&&t[n]!==this.sheetToken;)n++;n++}for(;n<t.length&&this.isChar(t[n]);)i=!0,n++;if(r=parseInt(t.substring(n),10),n<t.length&&!this.isNaN(r))return r;if(i)return-1;throw this.formulaErrorStrings[e.FormulasErrorsStrings.bad_index]},n.prototype.colIndex=function(e){var t=0,r=0;if(e=e.toUpperCase(),t<e.length&&e[t]===this.sheetToken){for(t++;t<e.length&&e[t]!==this.sheetToken;)t++;t++}for(;t<e.length&&this.isChar(e[t]);){r=26*r+e[t].charCodeAt(0)-64,t++}return 0===r?-1:r},n.prototype.getErrorStrings=function(){return null===this.errorStrings&&(this.errorStrings=["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!"]),this.errorStrings},n.prototype.substring=function(e,t,r){return e.substring(t,r+t)},n.prototype.isChar=function(e){return e.charCodeAt(0)>=65&&e.charCodeAt(0)<=90||e.charCodeAt(0)>=97&&e.charCodeAt(0)<=122},n.prototype.getSheetFamilyItem=function(e){if(0===this.sheetFamilyID)return null==this.defaultFamilyItem&&(this.defaultFamilyItem=new ut),this.defaultFamilyItem;null==this.sheetFamiliesList&&(this.sheetFamiliesList=new Map);var t=this.modelToSheetID.get(e);return this.sheetFamiliesList.has(t)||this.sheetFamiliesList.set(t,new ut),this.sheetFamiliesList.get(t)},n.prototype.setKeyValue=function(e,t){e=e.toUpperCase();var r=t.toString().trim();this.storedData.get(e)&&0!==r.indexOf(this.leftBrace)||(this.storedData.set(e,new ct),this.keyToRowsMap.set(e,this.keyToRowsMap.size+1),this.rowsToKeyMap.set(this.rowsToKeyMap.size+1,e));var n=this.storedData.get(e);if(null!=n.getFormulaText()&&n.getFormulaText().length>0&&n.getFormulaText()!==r){var i=this.cellPrefix+this.keyToRowsMap.get(e).toString();null!=this.getDependentFormulaCells().get(i)&&this.clearFormulaDependentCells(i)}r.length>0&&r[0]===this.getFormulaCharacter()?n.setFormulaText(r):n.getFormulaValue()!==r&&(n.setFormulaText(""),n.setParsedFormula(""),n.setFormulaValue(r))},n.prototype.clearFormulaDependentCells=function(e){var t=this,r=this.getDependentFormulaCells().get(e);null!=r&&(r.forEach(function(r,n){var i=n,s=t.getDependentCells().get(i);t.arrayRemove(s,e),0===s.length&&t.getDependentCells().delete(i)}),this.getDependentFormulaCells().delete(e))},n.prototype.arrayRemove=function(e,t){for(var r=null;-1!==r;)r=e.indexOf(t),e.splice(r,1);return e},n.prototype.getKeyValue=function(e){if(e=e.toUpperCase(),null!==this.storedData.has(e)){var r=this.storedData.get(e),n=r.getFormulaText();if(n.length>0&&n[0]===this.getFormulaCharacter()){this.cell=this.cellPrefix+this.keyToRowsMap.get(e).toString(),n=n.substring(1);try{r.setParsedFormula(this.parser.parseFormula(n,e))}catch(t){var i={message:t.message,exception:t,isForceCalculable:!1,computeForceCalculate:!1};return this.trigger("onFailure",i),r.setFormulaValue(i.message),this.storedData.get(e).getFormulaValue()}try{r.setFormulaValue(this.computeFormula(r.getParsedFormula()))}catch(e){i={message:e.message,exception:e,isForceCalculable:!1,computeForceCalculate:!1};this.trigger("onFailure",i);var s="string"==typeof i.exception?i.exception:i.message;return(t.isNullOrUndefined(this.getErrorLine(e))?"":"#"+this.getErrorLine(e)+": ")+s}}return this.storedData.get(e).getFormulaValue()}return this.emptyString},n.prototype.getNamedRanges=function(){return this.namedRanges},n.prototype.addNamedRange=function(e,t){var r=e.split(this.sheetToken);if(r.length>1){if(!this.getSheetFamilyItem(this.grid).parentObjectToToken.get(r[0]))return!1;e=r[0]+this.sheetToken+r[1].toUpperCase()}else e=e.toUpperCase();return this.namedRanges.set(e,t),!0},n.prototype.removeNamedRange=function(e){return e=e.toUpperCase(),null!=this.namedRanges.get(e)&&(this.namedRanges.delete(e),!0)},n.prototype.convertAlpha=function(e){for(var t=[],r=0;e>0;){e--;var n="A".charCodeAt(0);t[r]=String.fromCharCode(e%26+n),e=parseInt((e/26).toString(),10),r++}return t.join("")},n.prototype.getCellCollection=function(e){if(e.indexOf(":")<0&&!this.isCellReference(e))return e.split(this.getParseArgumentSeparator());var t,r,n,i,s=e.indexOf(":");if(s>0&&this.isChar(e[s-1]))for(var o=s-2;o>=0&&this.isDigit(e[o]);)o--;t=this.rowIndex(this.substring(e,0,s)),r=this.rowIndex(this.substring(e,s+1,s+e.length-s-1)),n=this.colIndex(this.substring(e,0,s)),i=this.colIndex(this.substring(e,s+1,s+e.length-s-1)),t>r&&(s=r,r=t,t=s),n>i&&(s=i,i=n,n=s);var a,l=[],h=0;for(s=t;s<=r;s++)for(a=n;a<=i;a++)l[h]=this.emptyString+this.convertAlpha(a)+s.toString(),h++;return l},n.prototype.computeFormula=function(r){var n,i,s,o,a=!1;if(this.parser.isError)return r;n=this.parser.isFormulaParsed?r:this.parser.parseFormula(r),this.parser.isFormulaParsed=!1;try{if((i=this.findLastIndexOfq(n))>0&&(a=!0),n!==this.emptyString&&i>-1)for(var l=i+1;l>-1;)if(n[l]===this.rightBracket){var h=n.substring(i,l+1),p=h.split(this.leftBracket)[0].split("q").join(this.emptyString),c=h.substring(h.indexOf(this.leftBracket)+1,h.indexOf(this.rightBracket)).split(this.getParseArgumentSeparator());if(s=t.isNullOrUndefined(this.getFunction(p))?this.getErrorStrings()[e.CommonErrors.name]:this.getFunction(p).apply(void 0,c),!a)break;o=this.processNestedFormula(n,h,s);var u=this.findLastIndexOfq(o);0===u&&(a=!1),-1===u&&(s=this.computeValue(o)),i=l=u,n=o}else l++;else this.formulaErrorStrings.indexOf(n)>-1?s=n:n!==this.emptyString&&-1===i&&(s=this.computeValue(n))}catch(e){c={message:e.message,exception:e,isForceCalculable:!1,computeForceCalculate:!1};this.trigger("onFailure",c);var d="string"==typeof c.exception?c.exception:c.message;s=(t.isNullOrUndefined(this.getErrorLine(e))?"":"#"+this.getErrorLine(e)+": ")+d}return s},n.prototype.computeSumIfAndAvgIf=function(r){if(t.isNullOrUndefined(r)||r[0]===this.emptyString||0===r.length)return this.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var n=r,i=n.length;if(2!==i&&3!==i&&0===i)return this.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var s=n[0],o=i>2?n[2].trim():n[1].trim();if((o=o.split(this.tic).join(this.emptyString)).length>255)return this.getErrorStrings()[e.CommonErrors.value];var a=this.parser.tokenEqual;o.startsWith("<=")?(a=this.parser.tokenLessEq,o=o.substring(2)):o.startsWith(">=")?(a=this.parser.tokenGreaterEq,o=o.substring(2)):o.startsWith("<>")?(a=this.parser.tokenNotEqual,o=o.substring(2)):o.startsWith("<")?(a=this.parser.tokenLess,o=o.substring(1)):o.startsWith(">")?(a=this.parser.tokenGreater,o=o.substring(1)):o.startsWith("=")&&(a=this.parser.tokenEqual,o=o.substring(1));var l=this.parseFloat(o),h=2===i?s:n[1],p=this.getCellCollection(n[0]),c=this.getCellCollection(h),u=this.getComputeSumIfValue(c,p,o,l,a);return[u[0],u[1]]},n.prototype.computeLookup=function(t){if(0===t.length)return this.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var r=[],n=[],i=t,s=i.length,o=i[0].split(this.tic).join(this.emptyString),a=i[1],l=2===s?a:i[2],h=this.getCellCollection(i[1]),p=this.getCellCollection(l),c=0;c<h.length;c++)n[c]=this.getValueFromArg(h[c]).split(this.tic).join("");for(var u=n.toString().split(this.getParseArgumentSeparator()),d=this.parseFloat(u[u.sort().length-1]),f=this.parseFloat(u[0]),m=0;m<h.length;m++){if(r[m]=this.getValueFromArg(h[m]).split(this.tic).join(""),o===r[m])return this.getValueFromArg(p[m]).split(this.tic).join("");if(this.parseFloat(o)===this.parseFloat(r[m]))return this.getValueFromArg(p[m]).split(this.tic).join("");if(this.parseFloat(o)<f)return this.getErrorStrings()[e.CommonErrors.na];if(this.parseFloat(o)>d){var g=n.indexOf(d.toString());return this.getValueFromArg(p[g]).split(this.tic).join("")}}if(n.indexOf(o)<0){for(var y=[],v=0;v<u.length;v++)this.parseFloat(o)>this.parseFloat(u[v])&&y.push(u[v]);g=n.indexOf(y[y.length-1]);return this.getValueFromArg(p[g]).split(this.tic).join("")}return this.getErrorStrings()[e.CommonErrors.na]},n.prototype.computeVLookup=function(r){var n=r,i=[],s=n[0].split(this.tic).join("");if(s.indexOf(":")>-1)return this.getErrorStrings()[e.CommonErrors.value];if(this.isCellReference(s)&&(s=this.getValueFromArg(s)),n[1].indexOf(":")<-1)return this.getErrorStrings()[e.CommonErrors.na];var o=[],a="",l="";if(this.isCellReference(n[1])&&(o=this.getCellCollection(n[1]),n[1].indexOf(":")>-1)){for(var h=n[1].indexOf(":"),p=0;p<h;p++){a+=this.isChar(n[1][p])?n[1][p]:""}for(var c=h;c<n[1].length;c++){l+=this.isChar(n[1][c])?n[1][c]:""}}var u=this.colIndex(a)+this.parseFloat(n[2]);if(u>this.colIndex(l))return this.getErrorStrings()[e.CommonErrors.na];if(u===this.colIndex(a))return this.getErrorStrings()[e.CommonErrors.na];var d=this.convertAlpha(u);n[3]=t.isNullOrUndefined(n[3])?this.trueValue:n[3].split(this.tic).join("");var f="";for(p=0;p<o.length;p++)i[p]=this.getValueFromArg(o[p]).split(this.tic).join("");var m=i.toString().split(this.getParseArgumentSeparator()),g=this.parseFloat(m[m.sort().length-1]),y=this.parseFloat(m[0]);for(c=0;c<o.length;c++){if(f=this.getValueFromArg(o[c]),n[3].toUpperCase()===this.trueValue){if(s===f)return this.getValueFromArg(d+c).split(this.tic).join("");if(this.parseFloat(s)===this.parseFloat(f))return this.getValueFromArg(d+c).split(this.tic).join("");if(this.parseFloat(s)<y)return this.getErrorStrings()[e.CommonErrors.na];if(this.parseFloat(s)>g){h=i.indexOf(g.toString());return this.getValueFromArg(d+h).split(this.tic).join("")}}if(n[3]===this.falseValue&&s===f)return this.getValueFromArg(d+c)}return this.getErrorStrings()[e.CommonErrors.na]},n.prototype.findWildCardValue=function(e,t){var r="";if(e.indexOf("?")>-1){var n=e[(o=e.indexOf("?"))-1],i=e[o+1];if(t.indexOf(n)>-1&&t.indexOf(i)>-1){var s=t.indexOf(n);r=t[s]===n&&t[s+2]===i?e:t}else r=t}else if(e.indexOf("*")>-1){for(var o=e.indexOf("*"),a="",l="",h=this.falseValue,p=this.falseValue,c=o-1;c>=0;c--)a+=e[c],p=this.trueValue;for(c=o+1;c<e.length;c++)l+=e[c],h=this.trueValue;var u=""===a?-1:t.indexOf(a.split("").reverse().join("")),d=""===l?-1:t.indexOf(l);u>-1||d>-1?p===this.trueValue?r=a.split("").reverse().join("")===t.substr(0,a.length)?e:t:h===this.trueValue&&(r=l===t.substring(t.length-l.length,t.length)?e:t):r=t}return r},n.prototype.getComputeSumIfValue=function(e,t,r,n,i){var s=0,o=0;switch(i){case this.parser.tokenEqual:for(var a=0;a<e.length;a++){var l=this.getValueFromArg(e[a].split(this.tic).join("")),h=this.parseFloat(l);if(l===r&&h===n){var p=this.getValueFromArg(t[a].split(this.tic).join(""));s+=this.parseFloat(p),o+=1}}break;case this.parser.tokenLess:for(a=0;a<e.length;a++){l=this.getValueFromArg(e[a].split(this.tic).join(""));if((h=this.parseFloat(l))<n){p=this.getValueFromArg(t[a].split(this.tic).join(""));s+=this.parseFloat(p),o+=1}}break;case this.parser.tokenGreater:for(a=0;a<e.length;a++){l=this.getValueFromArg(e[a].split(this.tic).join(""));if((h=this.parseFloat(l))>n){p=this.getValueFromArg(t[a].split(this.tic).join(""));s+=this.parseFloat(p),o+=1}}break;case this.parser.tokenLessEq:for(a=0;a<e.length;a++){l=this.getValueFromArg(e[a].split(this.tic).join(""));if((h=this.parseFloat(l))<=n){p=this.getValueFromArg(t[a].split(this.tic).join(""));s+=this.parseFloat(p),o+=1}}break;case this.parser.tokenGreaterEq:for(a=0;a<e.length;a++){l=this.getValueFromArg(e[a].split(this.tic).join(""));if((h=this.parseFloat(l))>=n){p=this.getValueFromArg(t[a].split(this.tic).join(""));s+=this.parseFloat(p),o+=1}}break;case this.parser.tokenNotEqual:for(a=0;a<e.length;a++){l=this.getValueFromArg(e[a].split(this.tic).join("")),h=this.parseFloat(l);if(l!==r&&h!==n){p=this.getValueFromArg(t[a].split(this.tic).join(""));s+=this.parseFloat(p),o+=1}}}return[s,o]},n.prototype.computeAndOr=function(t,r){var n,i,s="and"===r;if(0===t.length)return this.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var o=0,a=t.length;o<a;o++)if(t[o].split(this.tic).join("").trim()===this.emptyString)return this.getErrorStrings()[e.CommonErrors.value];for(var l=t,h=0;h<l.length;h++){if(l[h]===this.tic)return this.getErrorStrings()[e.CommonErrors.value];if(l[h].indexOf(":")>-1&&this.isCellReference(l[h]))for(var p=this.getCellCollection(l[h]),c=0;c<p.length;c++){if(this.getErrorStrings().indexOf(p[c])>-1)return p[c];if(p[c][0]===this.tic)return this.getErrorStrings()[e.CommonErrors.name];if(""===(n=this.getValueFromArg(p[c]))&&(n=this.trueValue),this.getErrorStrings().indexOf(n)>-1)return n;i=this.parseFloat(n)}else{if(n=this.getValueFromArg(l[h]).split(this.tic).join("").toUpperCase(),this.getErrorStrings().indexOf(n)>-1)return n;var u=Date.parse(n.split(this.tic).join(""));if(isNaN(u)){if(n!==this.trueValue&&n!==this.falseValue)return this.getErrorStrings()[e.CommonErrors.value].toString()}else s=!0;i=this.parseFloat(n)}s="and"===r?s&&(n===this.trueValue||!isNaN(i)):s||n===this.trueValue||!isNaN(i)}return s?this.trueValue:this.falseValue},n.prototype.removeTics=function(e){return e.length>1&&e[0]===this.tic[0]&&e[e.length-1]===this.tic[0]&&(e=this.substring(e,1,e.length-2)),e},n.prototype.computeValue=function(t){try{var r=[],n=0,i="";for(r.length=0;n<t.length;){var s="u"===t[n];if(t[n]!==this.arithMarker){if(this.isDigit(t[n])){for(var o=this.emptyString;n<t.length&&this.isDigit(t[n]);)o+=t[n],n+=1;r.push(o)}if(t[n]===this.sheetToken){for(i=t[n],n+=1;n<t.length&&t[n]!==this.sheetToken;)i+=t[n],n+=1;n<t.length&&(i+=t[n],n+=1)}else if(this.isUpperChar(t[n])){o=this.emptyString;for(var a="";n<t.length&&this.isUpperChar(t[n]);)o+=t[n],n+=1;for(;n<t.length&&this.isDigit(t[n]);)o+=t[n],n+=1;if(o=i+o,"string"==typeof(a=this.getParentObjectCellValue(o).toString())&&this.getErrorStrings().indexOf(a)>-1)return a;r.push(a)}else if("q"===t[n]){var l=t.substring(n+1).indexOf(this.leftBracket),h=t.substring(n+l+1).indexOf(this.rightBracket);t=this.substring(t,n+l+2,h-1)}else if(t[n]===this.tic[0]){o=t[n].toString();for(n+=1;n<t.length&&t[n]!==this.tic[0];)o+=t[n],n+=1;r.push(o.split(this.tic).join(this.emptyString)),n+=1}else if("%"===t[n]&&r.length>0){var p=r[0],c=this.parseFloat(p);this.isNaN(c)||(r.pop(),r.push((c/100).toString())),n+=1}else if(0===t.substring(n).indexOf(this.trueValue))r.push(this.trueValue),n+=this.trueValue.length;else if(0===t.substring(n).indexOf(this.falseValue))r.push(this.falseValue),n+=this.falseValue.length;else if(t[n]===this.tic[0]||"|"===t[n]){o=t[n].toString();for(n++;n<t.length&&t[n]!==this.tic[0];)o+=t[n],n+=1;r.push(o+this.tic),n+=1}else switch(t[n]){case"#":var u=0;this.getErrorStrings().indexOf(t.substring(n))>-1?(u=-1===t.indexOf("!")||-1===t.substring(n).indexOf("!")?t.indexOf("#N/A")>-1?t.indexOf("#N/A")+4+n:t.indexOf("?")+1+n:t.indexOf("!")+1+n,r.push(this.substring(t,n,u-n))):(u=n+1,r.push(this.substring(t,n,u-n))),n=u;break;case"n":n+=1;o="";if(0===t.substring(n).indexOf("Infinity"))n+=(o="Infinity").length;else for(("u"===t[n]||s)&&(o="-",s?s=!1:n+=1);n<t.length&&this.isDigit(t[n])||t[n]===this.getParseDecimalSeparator();)o+=t[n],n+=1;r.push(o);break;case this.parser.tokenAdd:this.getValArithmetic(r,"add"),n+=1;break;case this.parser.tokenSubtract:this.getValArithmetic(r,"sub"),n+=1;break;case this.parser.tokenMultiply:this.getValArithmetic(r,"mul"),n+=1;break;case this.parser.tokenDivide:this.getValArithmetic(r,"div"),n+=1;break;case this.parser.tokenLess:this.processLogical(r,"less"),n+=1;break;case this.parser.tokenGreater:this.processLogical(r,"greater"),n+=1;break;case this.parser.tokenGreaterEq:this.processLogical(r,"greaterEq"),n+=1;break;case this.parser.tokenLessEq:this.processLogical(r,"lessEq"),n+=1;break;case this.parser.tokenNotEqual:this.processLogical(r,"notEq"),n+=1;break;case this.parser.tokenOr:this.processLogical(r,"or"),n+=1;break;case this.parser.tokenAnd:this.processLogical(r,"and"),n+=1;break;case this.parser.tokenEqual:this.processLogical(r,"equal"),n+=1;break;default:return this.getErrorStrings()[e.CommonErrors.value]}}else n+=1}if(0===r.length)return this.emptyString;o=this.emptyString;for(var d=r.length;d>0;){if((o=r.pop()+o)===this.emptyString&&this.isCellReference(t)&&this.getTreatEmptyStringAsZero())return"0";d--}return o}catch(t){if(this.getErrorStrings().indexOf(t)>-1||this.formulaErrorStrings.indexOf(t)>-1)throw t;throw new pt(this.formulaErrorStrings[e.FormulasErrorsStrings.invalid_expression])}},n.prototype.getValArithmetic=function(t,r){var n=t.pop();n=n===this.emptyString?"0":n;var i=parseInt(n,10);if(this.isNaN(i))throw this.getErrorStrings()[e.CommonErrors.value];var s=t.pop();if(s=s===this.emptyString?"0":s,i=parseInt(s,10),this.isNaN(i))throw this.getErrorStrings()[e.CommonErrors.value];"add"===r&&t.push((Number(s)+Number(n)).toString()),"sub"===r&&t.push((Number(s)-Number(n)).toString()),"mul"===r&&t.push((Number(s)*Number(n)).toString()),"div"===r&&(this.isNaN(this.parseFloat(n))||this.isNaN(this.parseFloat(s))?t.push(this.getErrorStrings()[e.CommonErrors.value]):0===this.parseFloat(n)?t.push(this.getErrorStrings()[e.CommonErrors.divzero]):t.push((Number(s)/Number(n)).toString()))},n.prototype.processLogical=function(e,t){var r,n,i,s;"and"!==t&&"equal"!==t&&(r=e.pop(),n=e.pop(),i=r.indexOf(this.tic)>-1?r:this.parseFloat(r),s=n.indexOf(this.tic)>-1?n:this.parseFloat(n));var o;return"less"===t&&(o=this.isNaN(i)||this.isNaN(s)?n.toUpperCase().split(this.tic).join("").localeCompare(r.toUpperCase().split(this.tic).join(""))<0?this.trueValue:this.falseValue:s<i?this.trueValue:this.falseValue),"greater"===t&&(o=this.isNaN(i)||this.isNaN(s)?n.toUpperCase().split(this.tic).join("").localeCompare(r.toUpperCase().split(this.tic).join(""))>0?this.trueValue:this.falseValue:s>i?this.trueValue:this.falseValue),"lessEq"===t&&(o=this.isNaN(i)||this.isNaN(s)?n.toUpperCase().split(this.tic).join("").localeCompare(r.toUpperCase().split(this.tic).join(""))<=0?this.trueValue:this.falseValue:s<=i?this.trueValue:this.falseValue),"greaterEq"===t&&(o=this.isNaN(i)||this.isNaN(s)?n.toUpperCase().split(this.tic).join("").localeCompare(r.toUpperCase().split(this.tic).join(""))>=0?this.trueValue:this.falseValue:s>=i?this.trueValue:this.falseValue),"notEq"===t&&(o=n!==r?this.trueValue:this.falseValue),"and"===t&&(r=e.pop().toString(),n="",e.length>0&&(n=e.pop().toString()),o=(o=this.emptyString+n+r+this.emptyString).split(this.tic).join("")),"equal"===t&&(o=(r=e.pop().toString())===(n=e.pop().toString())?this.trueValue:this.falseValue),"or"===t&&(o=Math.pow(this.parseFloat(s),this.parseFloat(i)).toString()),e.push(o),o},n.prototype.computeStoreCells=function(e){for(var t=e.cellValue,r=e.cellRange,n=e.criteria,i=e.argArray,s=e.isCriteria,o=e.storedCells,a=e.isCountIfS,l=e.countVal,h=s===this.trueValue?o:t,p=[],c=0;c<h.length;c++){var u=[],d=this.getValueFromArg(t[c]),f=void 0,m="";if(f=i[2].split(this.tic).join(this.emptyString),(s=a===this.trueValue?this.trueValue:s)===this.trueValue){var g="",y=0,v=0;for(o[c]=a===this.trueValue&&0===l?t[c]:o[c],g=o[c];!this.isDigit(g[y]);)y+=1;if(this.isCellReference(r[l])&&r[l].indexOf(":")>-1){var C=r[l].indexOf(":");for(m=this.substring(r[l],C);!this.isDigit(m[v]);)v+=1}var b=this.substring(g,y),S=this.substring(m,v);m=o[c].split(b).join(S),d=this.getValueFromArg(m),f=a===this.trueValue?n[l].split(this.tic).join(this.emptyString):n[l-1].split(this.tic).join(this.emptyString)}var E="equal";f.startsWith("<=")?(E="lessEq",f=f.substring(2)):f.startsWith(">=")?(E="greaterEq",f=f.substring(2)):f.startsWith("<>")?(E="notEq",f=f.substring(2)):f.startsWith("<")?(E="less",f=f.substring(1)):f.startsWith(">")?(E="greater",f=f.substring(1)):f.startsWith("=")&&(E="equal",f=f.substring(1)),(f.indexOf("*")>-1||f.indexOf("?")>-1)&&(d=this.findWildCardValue(f,d)),u.push(d.toLowerCase()),u.push(f.toLowerCase()),this.processLogical(u,E)===this.trueValue&&(s===this.falseValue?p.push(t[c]):p.push(m))}return o=p,p=[],o},n.prototype.computeIfsFormulas=function(r,n,i){if(t.isNullOrUndefined(r)||""===r[0]||0===r.length)return this.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var s=r,o=s.length;if(o<2||o>127)return this.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var a=[],l=[],h=[],p=0,c=0;c<s.length;c++)s[c].indexOf(":")>-1&&this.isCellReference(s[c])?a.push(s[c]):l.push(s[c]);a=(a=a.toString().split(",,").join(",")).split(this.getParseArgumentSeparator());var u,d;if(n===this.falseValue){d=this.falseValue;var f={cellValue:u=this.getCellCollection(a[1]),cellRange:a,criteria:l,argArray:s,isCriteria:d,storedCells:h,isCountIfS:n};if(h=this.computeStoreCells(f),0===h.length)return 0}for(c=n===this.trueValue?0:2;c<a.length;c++){d=this.trueValue,d=n===this.trueValue&&0===c?this.falseValue:this.trueValue;f={cellValue:u=this.getCellCollection(a[c]),cellRange:a,criteria:l,argArray:s,isCriteria:d,storedCells:h,isCountIfS:n,countVal:c};if(h=this.computeStoreCells(f),0===h.length)return 0}for(var m=0;m<h.length;m++){var g="",y="",v=0,C=0;for(g=h[m];!this.isDigit(g[v]);)v+=1;if(this.isCellReference(a[0])&&a[0].indexOf(":")>-1){var b=a[0].indexOf(":");for(y=this.substring(a[0],b);!this.isDigit(y[C]);)C+=1}var S=this.substring(g,v),E=this.substring(y,C);if(u=h[m].split(S).join(E),n===this.trueValue)p+=1;else{var x=this.getValueFromArg(u);p+=parseFloat(""===x?"0":x)}}return i===this.trueValue&&(p/=u.length),p},n.prototype.processNestedFormula=function(e,t,r){this.findLastIndexOfq(e);return e.split(t).join("n"+r)},n.prototype.isNaN=function(e){return"NaN"===e.toString()||"string"==typeof e},n.prototype.fromOADate=function(e){var t=new Date;return t.setTime(e*this.millisecondsOfaDay+Date.parse(this.oaDate.toString())),t},n.prototype.getSerialDateFromDate=function(e,t,r){var n=0;e<1900&&(e+=1900);for(var i=!1;!i;){for(;t>12;)e++,t-=12;i=!0;for(var s=new Date(e,t,1,-1).getDate();r>s;)s=new Date(e,t,1,-1).getDate(),t++,r-=s,i=!1;r<1&&(t--,r=(s=new Date(e,t,1,-1).getDate())-r)}var o=Date.parse(e.toString()+this.getParseDateTimeSeparator()+t.toString()+this.getParseDateTimeSeparator()+r.toString());return this.isNaN(o)||(n=this.toOADate(new Date(o))),n},n.prototype.toOADate=function(e){return(e.getTime()-Date.parse(this.oaDate.toString()))/this.millisecondsOfaDay},n.prototype.calculateDate=function(e){return this.parseFloat(e)<10?"0"+e:e},n.prototype.isTextEmpty=function(e){return null===e||""===e},n.prototype.isDigit=function(e){var t=e.charCodeAt(0);return t>47&&t<58},n.prototype.findLastIndexOfq=function(e){return e.lastIndexOf("q")},n.prototype.getValueFromArg=function(r){var n=r=r.trim(),i=this.dateTime1900,s=n;if(t.isNullOrUndefined(n)||this.isTextEmpty(n))return n;if(r[0]===this.tic||r[0]===this.singleTic)return i=this.isDate(r.split(this.tic).join("")),this.isNaN(this.parseFloat(r.split(this.tic).join("")))&&!t.isNullOrUndefined(i)&&!this.isNaN(i.getDate())&&this.dateTime1900<=i?this.toOADate(i).toString():r;if(r=r.split("u").join("-"),!this.isUpperChar(n[0])&&(this.isDigit(n[0])||n[0]===this.getParseDecimalSeparator()||"-"===n[0]||"n"===n[0]))return"n"===n[0]&&(n=n.substring(1)),n;if(-1===this.parser.indexOfAny(n,["+","-","/","*",")",")","{"])&&this.isUpperChar(n[0])||n[0]===this.sheetToken){if(n!==this.trueValue&&n!==this.falseValue&&this.isCellReference(n)){var o=this.getSheetFamilyItem(this.grid);if(null!==o.sheetNameToParentObject&&o.sheetNameToParentObject.size>0&&-1===n.indexOf(this.sheetToken)){n=o.parentObjectToToken.get(this.grid)+n}}if(n===this.cell){var a=this.getDependentCells().get(n);throw null!=a&&a.indexOf(n)>-1&&this.arrayRemove(a,n),this.getDependentFormulaCells().has(this.cell)||this.clearFormulaDependentCells(this.cell),this.formulaErrorStrings[e.FormulasErrorsStrings.circular_reference]+n}return s=this.getParentObjectCellValue(n),this.updateDependentCell(n),s.toString()}return this.getErrorStrings().indexOf(r)>-1?r:this.computeValue(s.toString())},n.prototype.isDate=function(e){if("object"==typeof e||null!==Date.parse(e)){var t=new Date(Date.parse(e));return t>=this.dateTime1900?t:null}return null},n.prototype.isValidCellReference=function(e){var r=0,n=0,i=[89,71,69],s=this.emptyString;if(this.namedRanges.has(e))return!1;for(var o=0;o<e.length;o++)this.isChar(e[o])&&r++;if((s=e.substring(0,r)).length<4){for(;n<s.length;){if(t.isNullOrUndefined(s[n])||!(s[n].charCodeAt(0)<i[n])){if(t.isNullOrUndefined(s[n])&&n>0)break;return!1}n++}if(this.parseFloat(e.substring(r,e.length))<1048576)return!0}return!1},n.prototype.parseDate=function(t){if(!this.isNaN(t)){if(t instanceof Date)return new Date(t);var r=parseInt(t,10);return r<0?this.getErrorStrings()[e.CommonErrors.num]:r<=60?new Date(this.dateTime1900.getTime()+864e5*(r-1)):new Date(this.dateTime1900.getTime()+864e5*(r-2))}return"string"!=typeof t||(t=new Date(t),this.isNaN(t))?this.getErrorStrings()[e.CommonErrors.value]:t},n.prototype.isCellReference=function(e){if(e===this.emptyString)return!1;e=e.trim(),e=this.setTokensForSheets(e);var t=this.getSheetToken(e),r=!1;""!==t&&(e=e.split(t).join(this.emptyString));var n=!1,i=!1;if(e.indexOf(":")!==e.lastIndexOf(":"))return!1;for(var s=e.split("").join(this.getParseArgumentSeparator()).split(this.getParseArgumentSeparator()),o=0;o<s.length;o++)if(this.isChar(s[o]))n=!0;else if(this.isDigit(s[o]))i=!0;else{if(":"!==s[o])return!1;n&&i&&(r=!0),n=!1,i=!1}return e.indexOf(":")>-1&&-1===e.indexOf(this.tic)?!!(r&&n&&i)||!(!(n&&!i||!n&&i)||r):!(!n||!i||-1!==e.indexOf(this.tic))},n.prototype.setTokensForSheets=function(e){var t=this.getSheetFamilyItem(this.grid),r=this.getSortedSheetNames();if(null!=r)for(var n=0;n<r.length;n++){var i=t.sheetNameToToken.get(r[n]);i=i.split(this.sheetToken).join(this.tempSheetPlaceHolder);var s='"'+r[n].toUpperCase()+'"'+this.sheetToken;-1===e.indexOf(s)&&(s=r[n].toUpperCase()+this.sheetToken),e=e.split("SHEET"+s).join(i),s=r[n].toUpperCase()+this.sheetToken,e=e.split(s).join(i)}return e=e.split(this.tempSheetPlaceHolder).join(this.sheetToken)},n.prototype.getParentObjectCellValue=function(t){if(t===this.trueValue||t===this.falseValue)return t;var r=t.lastIndexOf(this.sheetToken),n=0,i=0,s=this.grid,o=this.getSheetFamilyItem(s);if(r>-1&&null!==o.tokenToParentObject)this.grid=o.tokenToParentObject.get(t.substring(0,r+1)),n=this.rowIndex(t),i=this.colIndex(t);else if(-1===r){for(var a=0;a<t.length&&this.isChar(t[a]);)a++;if(a===t.length)return t=t.toLowerCase(),this.getErrorStrings()[e.CommonErrors.name];n=this.rowIndex(t),i=this.colIndex(t),o.isSheetMember&&null!=o.parentObjectToToken&&(t=o.parentObjectToToken.get(this.grid)+t)}var l=""===this.cell||null===this.cell?"":this.cell;if(this.cell=t,l===this.cell)throw this.formulaErrorStrings[e.FormulasErrorsStrings.circular_reference];var h=this.getParentCellValue(n,i,this.grid);return this.grid=s,this.cell=l,h},n.prototype.getParentCellValue=function(e,r,n){var i;return void 0!==this.parentObject.getValueRowCol?(i=this.parentObject.getValueRowCol(this.getSheetID(n)+1,e,r),t.isNullOrUndefined(i)?this.emptyString:i.toString()):(""!==(i=this.getValueRowCol(this.getSheetID(n)+1,e,r))&&void 0!==i||(i=""),i)},n.prototype.getValueRowCol=function(e,t,r){var n=this.rowsToKeyMap.get(t).toString(),i=this.getKeyValue(n).toString();if(null!=i&&"%"===i[i.length-1]&&i.length>1){var s=this.parseFloat(i.substring(0,i.length-1));this.isNaN(s)&&(i=(Number(s)/100).toString())}return i},n.prototype.defineFunction=function(e,r){"string"==typeof r&&(r=t.getValue(r,window)),e=e.toUpperCase(),this.libraryFormulas.set(e,{handler:r,isCustom:!0})},n.prototype.valueChanged=function(e,r,n){var i=e;this.grid=e;var s=!0,o=!0,a=this.getSheetFamilyItem(i),l=R(r.getColIndex())+r.getRowIndex().toString();if(null!==a.sheetNameToParentObject&&a.sheetNameToParentObject.size>0){l=a.parentObjectToToken.get(i)+l}var h=r.getValue().toUpperCase();if(h.indexOf("=RAND()")>-1||h.indexOf("RAND()")>-1||h.indexOf("=RANDBETWEEN(")>-1||h.indexOf("RANDBETWEEN(")>-1||this.randomValues.has(l)){var p=this.randCollection.toString();this.randomValues.has(l)?this.randomValues.has(l)&&(h.indexOf("=RAND()")>-1||h.indexOf("RAND()")>-1||h.indexOf("=RANDBETWEEN(")>-1||h.indexOf("RANDBETWEEN(")>-1?this.randomValues.set(l,r.getValue()):r.getValue().toUpperCase()!==this.randomValues.get(l.toUpperCase())&&(this.randomValues.delete(l),p=p.split(l+this.parseArgumentSeparator).join("").split(this.parseArgumentSeparator+l).join("").split(l).join(""),this.randCollection=p.split(this.parseArgumentSeparator)),0===this.randomValues.size&&this.randCollection.length&&(this.isRandomVal=!1,this.randomValues.clear(),this.randCollection=[])):(this.randomValues.set(l,r.getValue()),this.randCollection.push(l),this.isRandomVal=!0)}if(r.getValue()&&r.getValue()[0]===this.getFormulaCharacter()){this.cell=l;var c=void 0;if(t.isNullOrUndefined(o)||(o=n),this.getFormulaInfoTable().has(l)){if(c=this.getFormulaInfoTable().get(l),r.getValue()!==c.getFormulaText()||null==c.getParsedFormula()){c.setFormulaText(r.getValue()),this.getDependentFormulaCells().has(this.cell)&&this.clearFormulaDependentCells(this.cell);try{c.setParsedFormula(this.parser.parseFormula(r.getValue()))}catch(e){c.setFormulaValue(e),o=!1}}if(o){this.parser.isFormulaParsed=!0;var u=this.computeFormula(c.getParsedFormula());s=u!==c.getFormulaValue(),c.setFormulaValue(u)}}else{(c=new ct).setFormulaText(r.getValue()),this.getDependentFormulaCells().has(l)||this.getDependentFormulaCells().set(l,new Map);try{c.setParsedFormula(this.parser.parseFormula(r.getValue()))}catch(e){c.setFormulaValue(e),o=!1}o&&c.setFormulaValue(this.computeFormula(c.getParsedFormula())),this.getFormulaInfoTable().has(l),this.getFormulaInfoTable().set(l,c)}o&&(void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(i)+1,c.getFormulaValue(),r.getRowIndex(),r.getColIndex()):this.parentObject.setValueRowCol(this.getSheetID(i)+1,c.getFormulaValue(),r.getRowIndex(),r.getColIndex()))}else this.getFormulaInfoTable().has(l)&&(this.getFormulaInfoTable().delete(l),this.getDependentFormulaCells().has(l)&&this.clearFormulaDependentCells(l));o&&s&&this.getDependentCells().has(l)&&this.getDependentCells().get(l).toString()!==l&&(this.getComputedValue().clear(),this.refresh(l))},n.prototype.getComputedValue=function(){return null===this.computedValues&&(this.computedValues=new Map),this.computedValues},n.prototype.setValueRowCol=function(e,t,r,n){},n.prototype.getSortedSheetNames=function(){var e=this.getSheetFamilyItem(this.grid);if(null!=e&&null!=e.sheetNameToToken){var t=[];e.sheetNameToToken.forEach(function(e,r){t.push(r),t.sort()}),this.sortedSheetNames=t,this.sortedSheetNames.sort()}return this.sortedSheetNames},n.prototype.getErrorLine=function(e){var t=e.stack?e.stack.split("\n")[1].split(":"):null;return t?t[t.length-2]:null},n.prototype.createSheetFamilyID=function(){return this.sheetFamilyID===Number.MAX_SAFE_INTEGER&&(this.sheetFamilyID=Number.MIN_SAFE_INTEGER),this.sheetFamilyID++},n.prototype.computeMinMax=function(r,n){var i,s,o=0;if(t.isNullOrUndefined(r)||0===r.length)return this.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var a=0,l=r.length;a<l;a++)if(r[a].split(this.tic).join("").trim()===this.emptyString)return this.getErrorStrings()[e.CommonErrors.value];i="max"===n?this.minValue:this.maxValue;var h=r;if(h.length>255)return this.getErrorStrings()[e.CommonErrors.value];for(var p=0;p<h.length;p++)if(h[p].indexOf(":")>-1&&this.isCellReference(h[p]))for(var c=this.getCellCollection(h[p]),u=0;u<c.length;u++){if(s=this.getValueFromArg(c[u]),this.getErrorStrings().indexOf(s)>-1)return s;var d=this.parseFloat(s);""===s||this.isNaN(this.parseFloat(d))?(o+=1)===c.length&&(i=0):i="max"===n?Math.max(i,d):Math.min(i,d)}else{var f=void 0;if(f=this.getValueFromArg(h[p]),this.getErrorStrings().indexOf(f)>-1)return f;d=this.parseFloat(f);if(""===f||this.isNaN(this.parseFloat(d))){(o+=1)===s.length&&(i=0);continue}i="max"===n?Math.max(i,d):Math.min(i,d)}return i.toString()},n.prototype.calculateAvg=function(r){for(var n=0,i=r,s=[],o=0,a=0,l=0;l<i.length;l++)if(i[l].indexOf(":")>-1&&this.isCellReference(i[l])){a=0,s=this.getCellCollection(i[l]),o=0;for(var h=0;h<s.length;h++){var p=this.getValueFromArg(s[h]);t.isNullOrUndefined(p)||isNaN(this.parseFloat(p))||(o+=this.parseFloat(p),a+=1)}if(0===a)return this.getErrorStrings()[e.CommonErrors.divzero];n=(o/=a)+n}else{if(i[l].indexOf(this.tic)>-1&&isNaN(parseFloat(i[l].split(this.tic).join(""))))return this.getErrorStrings()[e.CommonErrors.value];0===i[l].length&&(i[l]="1");p=this.getValueFromArg(i[l].split(this.tic).join(""));if(t.isNullOrUndefined(p)||isNaN(this.parseFloat(p)))return this.getErrorStrings()[e.CommonErrors.name];n+=this.parseFloat(p)}return(n/(i.length-0)).toString()},n.prototype.registerGridAsSheet=function(e,r,n){t.isNullOrUndefined(this.modelToSheetID)&&(this.modelToSheetID=new Map),t.isNullOrUndefined(this.modelToSheetID.get(r))&&this.modelToSheetID.set(r,n);var i=this.getSheetFamilyItem(r);i.isSheetMember=!0;var s=e.toUpperCase();if(0===i.parentObjectToToken.size&&(i.parentObjectToToken=new Map),0===i.sheetNameToParentObject.size&&(i.sheetNameToParentObject=new Map),0===i.sheetNameToToken.size&&(i.sheetNameToToken=new Map),0===i.tokenToParentObject.size&&(i.tokenToParentObject=new Map),t.isUndefined(i.sheetNameToParentObject.get(s))){o=this.sheetToken+this.tokenCount.toString()+this.sheetToken;this.tokenCount++,i.tokenToParentObject.set(o,r),i.parentObjectToToken.set(r,o),i.sheetNameToToken.set(s,o),i.sheetNameToParentObject.set(s,r)}else{var o=i.sheetNameToToken.get(s);i.tokenToParentObject.set(o,r),i.parentObjectToToken.set(r,o)}return e},n.prototype.unregisterGridAsSheet=function(e,t){var r=this.getSheetFamilyItem(t),n=e.toUpperCase();if(null!=r.sheetNameToParentObject&&r.sheetNameToParentObject.has(n)){r.sheetNameToParentObject.delete(n);var i=r.sheetNameToToken.get(n);r.sheetNameToToken.delete(n),r.tokenToParentObject.delete(i),r.parentObjectToToken.delete(t)}},n.prototype.isSheetMember=function(){var e=this.getSheetFamilyItem(this.grid);return!t.isNullOrUndefined(e)&&e.isSheetMember},n.prototype.dispose=function(){this.resetKeys(),this.namedRanges.clear(),this.lFormulas.clear()},n.prototype.refreshRandValues=function(e){var t,r,n,i,s="",o=this.randCollection.toString();this.randomValues.has(e)&&(this.randomValues.delete(e),o=o.split(e+this.parseArgumentSeparator).join("").split(this.parseArgumentSeparator+e).join("").split(e).join(""),0===this.randomValues.size&&""===o?(this.randomValues.clear(),this.randCollection=[]):this.randCollection=o.split(this.parseArgumentSeparator));for(var a=0;a<this.randomValues.size;a++)t=this.rowIndex(this.randCollection[a]),r=this.colIndex(this.randCollection[a]),s=(parseFloat(this.getSheetToken(this.randCollection[a]).split(this.sheetToken).join(""))+1).toString(),i=this.getSheetFamilyItem(s),this.grid=i.sheetNameToParentObject.get(s),n=this.randomValues.get(this.randCollection[a]),n=this.computeFormula(n),void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(this.grid)+1,n,t,r):this.parentObject.setValueRowCol(this.getSheetID(this.grid)+1,n,t,r)},n.prototype.refresh=function(e){if(0===this.dependencyLevel&&this.refreshedCells.clear(),this.getDependentCells().has(e)&&null!==this.getDependentCells().get(e)){var t=this.getSheetFamilyItem(this.grid);this.dependencyLevel=this.dependencyLevel+1;try{var r=this.getDependentCells().get(e),n=void 0;for(n=0;n<r.length;n++){var i=r[n],s=this.getSheetToken(i);s.length&&(this.grid=t.tokenToParentObject.get(s));try{var o=this.rowIndex(i),a=this.colIndex(i),l=this.getFormulaInfoTable().get(i),h=void 0;l&&(this.cell=i,this.getComputedValue().has(i)?h=this.getComputedValue().get(i):(h=this.computeFormula(l.getFormulaText()),this.computedValues.set(i,h)),l.setFormulaValue(h)),void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(this.grid)+1,l.getFormulaValue(),o,a):this.parentObject.setValueRowCol(this.getSheetID(this.grid)+1,l.getFormulaValue(),o,a),this.refreshedCells.has(i)||(this.refreshedCells.set(i,[]),this.refresh(i))}catch(e){continue}}}finally{this.grid=t.tokenToParentObject.get(this.getSheetToken(e)),this.dependencyLevel--,0===this.dependencyLevel&&this.refreshedCells.clear()}}};var i;return lt([t.Property(!0)],n.prototype,"includeBasicFormulas",void 0),lt([t.Event()],n.prototype,"onFailure",void 0),n=i=lt([t.NotifyPropertyChanges],n)}(t.Base),pt=function(){return function(e,t){this.formulaCorrection=!1,this.message=e,this.formulaCorrection=t}}(),ct=function(){function e(){this.calcID=Number.MIN_VALUE+1,this.calcID1=Number.MIN_VALUE+1}return e.prototype.getFormulaText=function(){return this.formulaText},e.prototype.setFormulaText=function(e){this.formulaText=e},e.prototype.getFormulaValue=function(){return this.formulaValue},e.prototype.setFormulaValue=function(e){this.formulaValue=e},e.prototype.getParsedFormula=function(){return this.parsedFormula},e.prototype.setParsedFormula=function(e){this.parsedFormula=e},e}(),ut=function(){return function(){this.isSheetMember=!1,this.parentObjectToToken=new Map,this.sheetDependentCells=new Map,this.sheetDependentFormulaCells=new Map,this.sheetNameToParentObject=new Map,this.sheetNameToToken=new Map,this.tokenToParentObject=new Map,this.sheetFormulaInfotable=new Map}}(),dt=function(){return function(e,t,r){return this.row=e,this.col=t,this.value=r,this.getRowIndex=function(){return e},this.setRowIndex=function(t){e=t},this.getColIndex=function(){return t},this.setColIndex=function(e){t=e},this.getValue=function(){return r},this.setValue=function(e){e=e},this}}(),ft=function(){function e(e){this.parent=e,this.init()}return e.prototype.init=function(){this.addEventListener(),this.initCalculate(),this.registerSheet(),this.initiateDefinedNames()},e.prototype.destroy=function(){this.removeEventListener(),this.calculateInstance.dispose(),this.calculateInstance=null,this.parent=null},e.prototype.addEventListener=function(){this.parent.on(Me,this.performFormulaOperation,this),this.parent.on(Ge,this.aggregateComputation,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Me,this.performFormulaOperation),this.parent.off(Ge,this.aggregateComputation))},e.prototype.getModuleName=function(){return"workbookFormula"},e.prototype.initCalculate=function(){this.calculateInstance=new ht(this.parent),this.calcID=this.calculateInstance.createSheetFamilyID(),this.calculateInstance.setTreatEmptyStringAsZero(!0),this.calculateInstance.grid=this.parent.getActiveSheet().id.toString()},e.prototype.performFormulaOperation=function(e){var t=e.action,r=this.calculateInstance.getLibraryFormulas(),n=Array.from(r.values());switch(t){case"getLibraryFormulas":e.formulaCollection=Array.from(r.keys());break;case"getFormulaCategory":for(var i=["All"],s=1;s<Array.from(r.values()).length;s++)i.indexOf(n[s].category)<0&&i.push(n[s].category);e.categoryCollection=i;break;case"dropDownSelectFormulas":for(s=0;s<Array.from(r.values()).length;s++)e.selectCategory===n[s].category&&(e.formulaCollection[s]=Array.from(r.keys())[s]);break;case"getFormulaDescription":for(s=0;s<Array.from(r.values()).length;s++)e.selectedList===Array.from(r.keys())[s]&&(e.description=n[s].description);break;case"registerSheet":this.registerSheet(e.sheetIndex,e.sheetCount);break;case"unRegisterSheet":this.unRegisterSheet(e.sheetIndex,e.sheetCount);break;case"refreshCalculate":e.value=this.autoCorrectFormula(e.value),this.refreshCalculate(e.rowIndex,e.colIndex,e.value,e.isFormula,e.sheetIndex);break;case"getArgumentSeparator":e.argumentSeparator=this.calculateInstance.getParseArgumentSeparator();break;case"addDefinedName":e.isAdded=this.addDefinedName(e.definedName);break;case"removeDefinedName":e.isRemoved=this.removeDefinedName(e.definedName,e.scope);break;case"initiateDefinedNames":this.initiateDefinedNames()}},e.prototype.registerSheet=function(e,t){void 0===e&&(e=0),void 0===t&&(t=this.parent.sheets.length);for(var r;e<t;)r=ee(this.parent,e).id+"",this.calculateInstance.registerGridAsSheet(r,r,this.calcID),e++},e.prototype.unRegisterSheet=function(e,t){void 0===e&&(e=0),void 0===t&&(t=this.parent.sheets.length);var r;for(this.calculateInstance.tokenCount=0;e<t;)r=ee(this.parent,e).id+"",this.calculateInstance.unregisterGridAsSheet(r,r),e++},e.prototype.refreshCalculate=function(e,r,n,i,s){s||(s=this.parent.activeSheetTab),s--;var o=ee(this.parent,s).id+"";if(i){var a=new dt(e+1,r+1,n);this.calculateInstance.valueChanged(o,a,!0);var l=this.calculateInstance.randCollection;if(!0===this.calculateInstance.isRandomVal){var h=void 0,p=void 0,c="";if(this.calculateInstance.randomValues.size>1&&this.calculateInstance.randomValues.size===l.length)for(var u=0;u<this.calculateInstance.randomValues.size;u++){h=this.calculateInstance.rowIndex(l[u]),p=this.calculateInstance.colIndex(l[u]),c=this.calculateInstance.randomValues.get(l[u]),o=(parseFloat(this.calculateInstance.getSheetToken(l[u]).split(this.calculateInstance.sheetToken).join(""))+1).toString();var d=new dt(h,p,c);this.calculateInstance.valueChanged(o,d,!0)}}}else{var m=this.calculateInstance.getSheetFamilyItem(o),g=f(r+1)+(e+1);m.isSheetMember&&!t.isNullOrUndefined(m.parentObjectToToken)&&(g=m.parentObjectToToken.get(o)+g),this.calculateInstance.getFormulaInfoTable().has(g)&&(this.calculateInstance.getFormulaInfoTable().delete(g),this.calculateInstance.getDependentCells().has(g)&&this.calculateInstance.clearFormulaDependentCells(g)),this.calculateInstance.getComputedValue().clear(),this.calculateInstance.refresh(g),this.calculateInstance.refreshRandValues(g)}},e.prototype.autoCorrectFormula=function(e){return 2===e.split("(").length&&e.indexOf(")")<0&&(e+=")"),e},e.prototype.initiateDefinedNames=function(){for(var e=this.parent.definedNames,t=e.length,r=0;r<t;){var n=e[r];this.addDefinedName(n),r++}},e.prototype.addDefinedName=function(e){var t=!0,r=null,n=e.name,i=e.refersTo;return e.scope?(r=$(this.parent,e.scope))&&(n=ie(this.parent,r-1)+"!"+n):e.scope="",e.comment||(e.comment=""),this.checkIsNameExist(e.name,e.scope)?t=!1:(this.calculateInstance.addNamedRange(n,"="===i[0]?i.substr(1):i),"="!==i[0]&&(e.refersTo="="+i),this.parent.definedNames.push(e)),t},e.prototype.removeDefinedName=function(e,t){var r=!1,n=this.getIndexFromNameColl(e,t);if(n>-1){var i=e;if(t){var s=$(this.parent,t);s&&(i=ie(this.parent,s-1)+"!"+e)}this.calculateInstance.removeNamedRange(i),this.parent.definedNames.splice(n,1),r=!0}return r},e.prototype.checkIsNameExist=function(e,t){return this.parent.definedNames.some(function(r){return r.name===e&&(t?r.scope===t:""===r.scope)})},e.prototype.getIndexFromNameColl=function(e,t){void 0===t&&(t="");var r=-1;return this.parent.definedNames.filter(function(n,i){n.name===e&&n.scope===t&&(r=i)}),r},e.prototype.toFixed=function(e){var t=Number(e);return Math.round(t)!==t&&(e=t.toFixed(2)),e},e.prototype.aggregateComputation=function(e){var t=this.parent.getActiveSheet(),r=t.selectedRange,n=p(r.split(":")[1]);n[0]+1===t.rowCount&&n[1]+1===t.colCount&&(r="A1:"+u(t.usedRange.rowIndex,t.usedRange.colIndex)),e.Count=this.calculateInstance.getFunction("COUNTA")(r),e.Count&&(e.Sum=this.toFixed(this.calculateInstance.getFunction("SUM")(r)),e.Avg=this.toFixed(this.calculateInstance.getFunction("AVERAGE")(r)),e.Min=this.toFixed(this.calculateInstance.getFunction("MIN")(r)),e.Max=this.toFixed(this.calculateInstance.getFunction("MAX")(r)))},e}(),mt=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(Xe,this.initiateSortHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Xe,this.initiateSortHandler)},e.prototype.initiateSortHandler=function(e){var n=this,i=e.args,s=new r.Deferred,o=this.parent.getActiveSheet(),a=y(m(i.range)),l=i.sortOptions||{sortDescriptors:{},containsHeader:!0},h=!1;if(e.promise=s.promise,a[0]>o.usedRange.rowIndex-1||a[1]>o.usedRange.colIndex)s.reject("Select a cell or range inside the used range and try again.");else{var p=l.containsHeader;a[0]===a[2]&&a[2]-a[0]==0&&(a[0]=0,a[1]=0,a[2]=o.usedRange.rowIndex-1,a[3]=o.usedRange.colIndex,h=!0,p=!!t.isNullOrUndefined(l.containsHeader)||l.containsHeader);var u=p?a[0]+1:a[0];!t.isNullOrUndefined(i.sortOptions)&&!t.isNullOrUndefined(i.sortOptions.containsHeader)||h||t.isNullOrUndefined(_(a[0],a[1],o))||t.isNullOrUndefined(_(a[0]+1,a[1],o))||(typeof _(a[0],a[1],o).value==typeof _(a[0]+1,a[1],o).value?(u=a[0],p=!1):(u=a[0]+1,p=!0));var g,v,C="Column "+f(c(o.activeCell)[1]+1),b=l.sortDescriptors;this.getDataRange(a,o,p).then(function(e){var t=new r.DataManager(e),l=new r.Query;if(Array.isArray(b)){b&&0!==b.length||(b=[{field:C}]);for(var h=b.length,p=h-1;p>-1;p--)if(b[h-1].field||(b[h-1].field=C),b[p].field){var c=b[p].sortComparer||n.sortComparer.bind(n,b[p]);l.sortBy(b[p].field,c)}}else{b||(b={field:C}),b.field||(b.field=C);c=b.sortComparer||n.sortComparer.bind(n,b);l.sortBy(b.field,c)}t.executeQuery(l).then(function(e){var t,r={};Array.prototype.forEach.call(e.result,function(e){for(g=a[1],v=a[3];g<=v;g++)t="Column "+f(g+1),r=e[t],M(u,g,o,r);u++});var n={range:d(a),sortOptions:i.sortOptions};s.resolve(n)})})}},e.prototype.sortComparer=function(e,t,n){if(!(t?t.value:t)&&!(n?n.value:n))return-1;var i=e.order||"";return r.DataUtil.fnSort(i)(t?t.value:t,n?n.value:n)},e.prototype.getDataRange=function(e,t,r){var n,i,s=[],o=r?e[0]+1:e[0],a=e[2],l=0,h=t,p={sheet:h,indexes:[0,0,t.rowCount-1,t.colCount-1],promise:new Promise(function(e,t){e(void 0)})};return!h.isLocalData||0!==e[0]&&1!==e[0]||e[2]!==t.rowCount-1||this.parent.notify("updateSheetFromDataSource",p),p.promise.then(function(){for(;o<=a;o++){n=e[1],i=e[3];for(var r={};n<=i;n++)r["Column "+f(n+1)]=_(o,n,t),s[l.toString()]=r;l++}return s})},e.prototype.getModuleName=function(){return"workbookSort"},e}(),gt=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.format=function(e){var t=this.parent.getActiveSheet();void 0===e.range&&(e.range=t.selectedRange);for(var r=4===e.range.length?e.range:y(p(e.range)),n=r[0];n<=r[2];n++)for(var i=r[1];i<=r[3];i++)M(n,i,t,{style:e.style},!0),this.parent.notify(He,{style:e.style,rowIdx:n,colIdx:i,lastCell:i===r[3],isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:e.onActionUpdate});this.parent.setUsedRange(r[2],r[3]),e.refreshRibbon&&this.parent.notify(je,p(t.activeCell)),this.parent.setProperties({sheets:this.parent.sheets},!0)},e.prototype.textDecorationActionUpdate=function(e){var t,r=this.parent.getActiveSheet(),n=y(p(r.selectedRange)),i=e.style.textDecoration,s=i,o=p(r.activeCell),a=this.parent.getCellStyleValue(["textDecoration"],o).textDecoration,l=!1;"underline"===a?s="underline"===i?"none":"underline line-through":"line-through"===a?s="line-through"===i?"none":"underline line-through":"underline line-through"===a&&(s="underline"===i?"line-through":"underline",l=!0),"none"===s&&(l=!0),this.format({style:{textDecoration:s},range:o,refreshRibbon:e.refreshRibbon,onActionUpdate:!0});for(var h=n[0];h<=n[2];h++)for(var c=n[1];c<=n[3];c++)if(h!==o[0]||c!==o[1]){if(t={},"none"===(a=this.parent.getCellStyleValue(["textDecoration"],[h,c]).textDecoration)){if(l)continue;t.textDecoration=i}else if("underline"===a||"line-through"===a)if(l){if(i!==a)continue;t.textDecoration="none"}else t.textDecoration=i!==a?"underline line-through":i;else if("underline line-through"===a){if(!l)continue;t.textDecoration="underline"===i?"line-through":"underline"}this.format({style:t,range:[h,c,h,c],refreshRibbon:e.refreshRibbon,onActionUpdate:!0})}},e.prototype.addEventListener=function(){this.parent.on(Re,this.format,this),this.parent.on(Le,this.textDecorationActionUpdate,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Re,this.format),this.parent.off(Le,this.textDecorationActionUpdate))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"workbookcellformat"},e}(),yt=function(){function e(e){this.parent=e,this.localeObj=t.getNumericObject(this.parent.locale),this.decimalSep=this.localeObj.decimal,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(Pe,this.performEditOperation,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Pe,this.performEditOperation)},e.prototype.getModuleName=function(){return"workbookEdit"},e.prototype.performEditOperation=function(e){switch(e.action){case"updateCellValue":this.updateCellValue(e.address,e.value,e.sheetIndex,e.isValueOnly)}},e.prototype.checkDecimalPoint=function(e){if(Number(e)){var t=e.toString().indexOf(this.decimalSep)+1;e=e.toString().substr(t).length<=6?t<7?e:parseFloat(e).toFixed(0):t>7?parseFloat(e).toFixed(0):parseFloat(e).toFixed(6-t+2)}return e},e.prototype.updateCellValue=function(e,r,n,i){void 0===i&&(i=!1),n||(n=this.parent.activeSheetTab);var s;s="string"==typeof e?p(e):e;var o=ee(this.parent,n-1);o.rows[s[0]]||(o.rows[s[0]]={},o.rows[s[0]].cells=[]),o.rows[s[0]].cells[s[1]]||(o.rows[s[0]].cells[s[1]]={});var a=_(s[0],s[1],o);if(i)r.toString().indexOf(this.decimalSep)>-1&&(r=this.checkDecimalPoint(r)),a.value=r,this.parent.setProperties({sheets:this.parent.sheets},!0);else{var l=H(r);l||(a.formula="",a.value=r);var h={action:"refreshCalculate",value:r,rowIndex:s[0],colIndex:s[1],sheetIndex:n,isFormula:l};this.parent.notify(Me,h),l&&(a.formula=h.value,r=a.value);var c={value:r,rowIndex:s[0],colIndex:s[1],sheetIndex:n,updatedVal:""};this.parent.notify(Be,c),t.isNullOrUndefined(c.updatedVal)||(a.value=c.updatedVal,this.parent.setProperties({sheets:this.parent.sheets},!0))}this.parent.setUsedRange(s[0],s[1])},e}(),vt=function(){function e(){jt.Inject(Ze,rt,Qe,Je,gt,yt,ft,mt)}return e.prototype.getModuleName=function(){return"workbookBasic"},e.prototype.destroy=function(){},e}(),Ct=function(){function e(){jt.Inject(Ze,rt,Je,gt,yt,ft,Qe,mt)}return e.prototype.getModuleName=function(){return"workbook-all"},e.prototype.destroy=function(){},e}(),bt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),St=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},Et=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return bt(r,e),St([t.Property("Calibri")],r.prototype,"fontFamily",void 0),St([t.Property("bottom")],r.prototype,"verticalAlign",void 0),St([t.Property("left")],r.prototype,"textAlign",void 0),St([t.Property("0pt")],r.prototype,"textIndent",void 0),St([t.Property("#000000")],r.prototype,"color",void 0),St([t.Property("#ffffff")],r.prototype,"backgroundColor",void 0),St([t.Property("normal")],r.prototype,"fontWeight",void 0),St([t.Property("normal")],r.prototype,"fontStyle",void 0),St([t.Property("11pt")],r.prototype,"fontSize",void 0),St([t.Property("none")],r.prototype,"textDecoration",void 0),r}(t.ChildProperty),xt=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return bt(r,e),St([t.Property("")],r.prototype,"name",void 0),St([t.Property("")],r.prototype,"scope",void 0),St([t.Property("")],r.prototype,"comment",void 0),St([t.Property("")],r.prototype,"refersTo",void 0),r}(t.ChildProperty),wt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),It=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},Ft=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return wt(r,e),It([t.Property("")],r.prototype,"value",void 0),It([t.Property("")],r.prototype,"formula",void 0),It([t.Property(0)],r.prototype,"index",void 0),It([t.Property("General")],r.prototype,"format",void 0),It([t.Complex({},Et)],r.prototype,"style",void 0),r}(t.ChildProperty),Nt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Tt=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},Dt=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Nt(r,e),Tt([t.Collection([],Ft)],r.prototype,"cells",void 0),Tt([t.Property(0)],r.prototype,"index",void 0),Tt([t.Property(20)],r.prototype,"height",void 0),Tt([t.Property(!1)],r.prototype,"customHeight",void 0),r}(t.ChildProperty),kt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),At=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},Ot=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return kt(r,e),At([t.Property(0)],r.prototype,"index",void 0),At([t.Property(64)],r.prototype,"width",void 0),At([t.Property(!1)],r.prototype,"customWidth",void 0),r}(t.ChildProperty),Rt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Lt=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},Ht=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Rt(r,e),Lt([t.Property(null)],r.prototype,"dataSource",void 0),Lt([t.Property("A1")],r.prototype,"startCell",void 0),Lt([t.Property(null)],r.prototype,"query",void 0),Lt([t.Property(!0)],r.prototype,"showFieldAsHeader",void 0),r}(t.ChildProperty),_t=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Rt(r,e),Lt([t.Property(0)],r.prototype,"rowIndex",void 0),Lt([t.Property(0)],r.prototype,"colIndex",void 0),r}(t.ChildProperty),Mt=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Rt(r,e),Lt([t.Property(0)],r.prototype,"id",void 0),Lt([t.Collection([],Dt)],r.prototype,"rows",void 0),Lt([t.Collection([],Ot)],r.prototype,"columns",void 0),Lt([t.Collection([],Ht)],r.prototype,"rangeSettings",void 0),Lt([t.Property(0)],r.prototype,"index",void 0),Lt([t.Property("")],r.prototype,"name",void 0),Lt([t.Property(100)],r.prototype,"rowCount",void 0),Lt([t.Property(100)],r.prototype,"colCount",void 0),Lt([t.Property("A1")],r.prototype,"selectedRange",void 0),Lt([t.Property("A1")],r.prototype,"activeCell",void 0),Lt([t.Complex({},_t)],r.prototype,"usedRange",void 0),Lt([t.Property("A1")],r.prototype,"topLeftCell",void 0),Lt([t.Property(!0)],r.prototype,"showHeaders",void 0),Lt([t.Property(!0)],r.prototype,"showGridLines",void 0),r}(t.ChildProperty),Pt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Bt=function(){return(Bt=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)},Vt=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},jt=function(e){function r(t){var r=e.call(this,t)||this;return r.sheetNameCount=1,n.Inject(Ze,rt,Qe,Je,gt,yt,ft,mt),r.commonCellStyle={},t&&t.cellStyle&&(r.commonCellStyle=t.cellStyle),"workbook"===r.getModuleName()&&(r.dataBind(),r.initEmptySheet()),r}Pt(r,e),n=r,r.prototype.preRender=function(){Object.keys(this.commonCellStyle).length||(this.commonCellStyle=B(this.cellStyle,!0)),"spreadsheet"===this.getModuleName()&&this.initEmptySheet()},r.prototype.render=function(){},r.prototype.requiredModules=function(){return L(this)},r.prototype.getPersistData=function(){return this.addOnPersist([])},r.prototype.cellFormat=function(e,t){var r=this.getActiveSheet();t=t||r.selectedRange,this.notify(Re,{style:e,range:t,refreshRibbon:t.indexOf(r.activeCell)>-1})},r.prototype.getCellStyleValue=function(e,t){var r=this,n=_(t[0],t[1],this.getActiveSheet()),i={};return e.forEach(function(e){i[e]=r.cellStyle[e],n&&n.style&&n.style[e]&&(i[e]=n.style[e])}),i},r.prototype.numberFormat=function(e,t){this.notify(ke,{format:e,range:t})},r.prototype.createSheet=function(e){var t=new Mt(this,"sheets",{id:re(this.sheets),name:"Sheet"+te(this)},!0);e>-1?this.sheets.splice(e,0,t):this.sheets.push(t),this.setProperties({sheet:this.sheets},!0),this.notify(qe,{sheetIndex:0|e}),this.notify(Me,{action:"registerSheet",sheetIndex:this.sheets.length-1})},r.prototype.removeSheet=function(e){this.sheets.splice(e,1)},r.prototype.destroy=function(){this.notify(Fe,null),e.prototype.destroy.call(this)},r.prototype.onPropertyChanged=function(e,r){for(var n=0,i=Object.keys(e);n<i.length;n++){switch(i[n]){case"cellStyle":t.merge(this.commonCellStyle,B(e.cellStyle))}}},r.prototype.appendTo=function(t){e.prototype.appendTo.call(this,t)},r.prototype.initEmptySheet=function(){this.sheets.length?ne(this):this.createSheet()},r.prototype.getActiveSheet=function(){return this.sheets[this.activeSheetTab-1]},r.prototype.setUsedRange=function(e,t){var r=this.getActiveSheet();e>r.usedRange.rowIndex&&(r.usedRange.rowIndex=e,this.setProperties({sheets:this.sheets},!0),this.notify(_e,{index:e,update:"row"})),t>r.usedRange.colIndex&&(r.usedRange.colIndex=t,this.setProperties({sheets:this.sheets},!0),this.notify(_e,{index:t,update:"col"}))},r.prototype.getRangeData=function(e,t){var r;r=t?ee(this,t-1):this.getActiveSheet();var n=e[0],i=e[1],s="";return r.rows[n]&&r.rows[n].cells[i]&&(s=r.rows[n].cells[i].value),s},r.prototype.getData=function(e){return K(this,e)},r.prototype.getModuleName=function(){return"workbook"},r.prototype.getValueRowCol=function(e,t,r){var n=_(t-1,r-1,ee(this,(e=J(this,e))-1));return n&&n.value||""},r.prototype.setValueRowCol=function(e,t,r,n){e=J(this,e),this.notify(Pe,{action:"updateCellValue",address:[r-1,n-1],value:t,sheetIndex:e,isValueOnly:!0})},r.prototype.open=function(e){this.notify(Ne,e)},r.prototype.save=function(e){if(void 0===e&&(e={}),this.allowSave){var t={url:this.saveUrl,fileName:e.fileName||"Sample",saveType:"Xlsx"},r=Bt({},t,e,{customParams:{},isFullPost:!0,needBlobData:!1,cancel:!1});this.trigger("beforeSave",r),r.cancel||this.notify(Te,{saveSettings:r,isFullPost:r.isFullPost,needBlobData:r.needBlobData,customParams:r.customParams})}},r.prototype.sort=function(e,t){if(!this.allowSorting)return Promise.reject();var r={args:{range:t||this.getActiveSheet().selectedRange,sortOptions:e||{sortDescriptors:{}},cancel:!1},promise:new Promise(function(e,t){e(void 0)})};return this.notify(Xe,r),r.promise},r.prototype.updateCell=function(e,t){var r=m(t),n=$(this,t.split("!")[0])||this.activeSheetTab-1;M(r[0],r[1],this.sheets[n],e)},r.prototype.addDefinedName=function(e){var t={action:"addDefinedName",isAdded:!1,definedName:e};return this.notify(Me,t),t.isAdded},r.prototype.removeDefinedName=function(e,t){void 0===t&&(t="");var r={action:"removeDefinedName",isRemoved:!1,definedName:e,scope:t};return this.notify(Me,r),r.isRemoved},r.prototype.clearRange=function(e,t,r){void 0===r&&(r=!0),Y(this,e=e||this.getActiveSheet().selectedRange,t=t||this.activeSheetTab,r)};var n;return Vt([t.Collection([],Mt)],r.prototype,"sheets",void 0),Vt([t.Property(1)],r.prototype,"activeSheetTab",void 0),Vt([t.Property("100%")],r.prototype,"height",void 0),Vt([t.Property("100%")],r.prototype,"width",void 0),Vt([t.Property(!0)],r.prototype,"showRibbon",void 0),Vt([t.Property(!0)],r.prototype,"showFormulaBar",void 0),Vt([t.Property(!0)],r.prototype,"showSheetTabs",void 0),Vt([t.Property(!0)],r.prototype,"allowEditing",void 0),Vt([t.Property(!0)],r.prototype,"allowOpen",void 0),Vt([t.Property(!0)],r.prototype,"allowSave",void 0),Vt([t.Property(!0)],r.prototype,"allowSorting",void 0),Vt([t.Property(!0)],r.prototype,"allowNumberFormatting",void 0),Vt([t.Property(!0)],r.prototype,"allowCellFormatting",void 0),Vt([t.Complex({},Et)],r.prototype,"cellStyle",void 0),Vt([t.Property("")],r.prototype,"openUrl",void 0),Vt([t.Property("")],r.prototype,"saveUrl",void 0),Vt([t.Collection([],xt)],r.prototype,"definedNames",void 0),Vt([t.Event()],r.prototype,"beforeOpen",void 0),Vt([t.Event()],r.prototype,"openFailure",void 0),Vt([t.Event()],r.prototype,"beforeSave",void 0),Vt([t.Event()],r.prototype,"saveComplete",void 0),Vt([t.Event()],r.prototype,"beforeCellFormat",void 0),r=n=Vt([t.NotifyPropertyChanges],r)}(t.Component),Ut="ribbon",zt="formulaBar",qt="sheetTabs",Wt="refreshSheetTabs",Gt="dataRefresh",Kt="initialLoad",Xt="contentLoaded",Yt="mouseDown",$t="spreadsheetDestroyed",Jt="editOperation",Zt="formulaOperation",Qt="formulaBarOperation",er="keyUp",tr="keyDown",rr="verticalScroll",nr="horizontalScroll",ir="beforeContentLoaded",sr="beforeVirtualContentLoaded",or="virtualContentLoaded",ar="cellNavigate",lr="mouseUpAfterSelection",hr="selectionComplete",pr="contextmenuBeforeOpen",cr="addSheetTab",ur="removeSheetTab",dr="renameSheetTab",fr="ribboClick",mr="enableRibbonItems",gr="tabSwitch",yr="selectRange",vr="paste",Cr="clearCopy",br="addContextMenuItems",Sr="removeContextMenuItems",Er="enableContextMenuItems",xr="beforeRibbonCreate",wr="rowHeightChanged",Ir="colWidthChanged",Fr="beforeHeaderLoaded",Nr="onContentScroll",Tr="deInitProperties",Dr="activeSheetChanged",kr="renameSheet",Ar="enableToolbar",Or="initiateCustomSort",Rr=null,Lr=["e-ribbon","e-formula-bar-panel","e-sheet-tab-panel","e-header-toolbar"],Hr={role:"role",selected:"aria-selected",multiselectable:"aria-multiselectable",busy:"aria-busy",colcount:"aria-colcount"},_r=function(){function e(e){this.parent=e,this.init(),this.addEventListener()}return e.prototype.init=function(){this.parent.element.appendChild(this.parent.createElement("input",{className:"e-clipboard",attrs:{contenteditable:"true"}}))},e.prototype.addEventListener=function(){var e=this.getClipboardEle();this.parent.on("cut",this.cut,this),this.parent.on("copy",this.copy,this),this.parent.on(vr,this.paste,this),this.parent.on(Cr,this.clearCopiedInfo,this),this.parent.on(gr,this.tabSwitchHandler,this),this.parent.on(pr,this.cMenuBeforeOpenHandler,this),this.parent.on(fr,this.ribbonClickHandler,this),this.parent.on(Xt,this.initCopyIndicator,this),this.parent.on(wr,this.rowHeightChanged,this),t.EventHandler.add(e,"cut",this.cut,this),t.EventHandler.add(e,"copy",this.copy,this),t.EventHandler.add(e,"paste",this.paste,this)},e.prototype.removeEventListener=function(){var e=this.getClipboardEle();this.parent.isDestroyed||(this.parent.off("cut",this.cut),this.parent.off("copy",this.copy),this.parent.off(vr,this.paste),this.parent.off(Cr,this.clearCopiedInfo),this.parent.off(gr,this.tabSwitchHandler),this.parent.off(pr,this.cMenuBeforeOpenHandler),this.parent.off(fr,this.ribbonClickHandler),this.parent.off(Xt,this.initCopyIndicator),this.parent.off(wr,this.rowHeightChanged)),t.EventHandler.remove(e,"cut",this.cut),t.EventHandler.remove(e,"copy",this.copy),t.EventHandler.remove(e,"paste",this.paste)},e.prototype.ribbonClickHandler=function(e){var t=this.parent.element.id;switch(e.item.id){case t+"_cut":this.cut({isClick:!0});break;case t+"_copy":this.copy({isClick:!0})}this.parent.element.focus()},e.prototype.tabSwitchHandler=function(e){1!==e.idx||this.copiedInfo||this.hidePaste()},e.prototype.cMenuBeforeOpenHandler=function(e){if("Content"===e.target||"Header"===e.target){var t=this.parent.serviceLocator.getService(un);this.parent.enableContextMenuItems([t.getConstant("Paste"),t.getConstant("PasteSpecial")],!!this.copiedInfo)}},e.prototype.rowHeightChanged=function(e){if(this.copiedInfo&&this.copiedInfo.range[0]>e.rowIdx){var t=this.parent.element.getElementsByClassName("e-copy-indicator")[0];t.style.top=parseInt(t.style.top,10)+e.threshold+"px"}},e.prototype.cut=function(e){this.setCopiedInfo(e,!0)},e.prototype.copy=function(e){this.setCopiedInfo(e,!1)},e.prototype.paste=function(e){if(this.parent.isEdit&&e&&e.type)return e.preventDefault(),void document.getElementById(this.parent.element.id+"_edit").focus();var t=!this.copiedInfo&&(e&&e.clipboardData||window.clipboardData),r=this.getCopiedIdx();if(this.copiedInfo||t){var n=void 0,i=void 0,s=e&&e.sIdx>-1?e.sIdx:this.parent.activeSheetTab-1,o=ee(this.parent,s),a=ee(this.parent,t?s:r),l=y(e&&e.range||p(o.selectedRange)),h=t&&this.getExternalCells(e);if(t&&!h.length)return;for(var c=l[0],u=t?[0,0,h.length-1,h[0].cells.length-1]:y(this.copiedInfo.range),d=(l[2]-l[0]+1)%(u[2]-u[0]+1)==0&&(l[3]-l[1]+1)%(u[3]-u[1]+1)==0,f=d?l:[l[0],l[1]].concat([l[0]+u[2]-u[0],l[1]+u[3]-u[1]||l[1]]),m=u[0],g=0;m<=u[2];m++,g++){for(var v=u[1],C=0;v<=u[3];v++,C++){if((n=t?h[m].cells[v]:Object.assign({},_(m,v,a)))&&e&&e.type){switch(e.type){case"Formats":n={format:n.format,style:n.style};break;case"Values":n={value:n.value}}i=["Formats","Values"].indexOf(e.type)>-1}if(!this.parent.scrollSettings.isFinite&&(u[2]-u[0]>1048575-l[0]||u[3]-u[1]>16383-l[1])||this.parent.scrollSettings.isFinite&&(u[2]-u[0]>o.rowCount-1-l[0]||u[3]-u[1]>o.colCount-1-l[1]))return void this.showDialog();if(d)for(var b=l[0];b<=l[2];b+=u[2]-u[0]+1)for(var S=l[1];S<=l[3];S+=u[3]-u[1]+1)this.setCell(b+g,S+C,o,n,i);else this.setCell(c,l[1]+C,o,n,i);!t&&this.copiedInfo.isCut&&this.setCell(m,v,a,_(m,v,a),!1,!0)}c++}this.parent.setUsedRange(f[2],f[3]),s===this.parent.activeSheetTab-1&&(this.parent.serviceLocator.getService("cell").refreshRange(f),this.parent.notify(yr,f)),!t&&this.copiedInfo.isCut&&(r===this.parent.activeSheetTab-1&&this.parent.serviceLocator.getService("cell").refreshRange(u),this.clearCopiedInfo()),(t||e&&e.isClick)&&this.parent.element.focus()}else this.getClipboardEle().select()},e.prototype.setCell=function(e,r,n,i,s,o){M(e,r,n,o?null:i,s),i&&i.formula&&this.parent.notify(Me,{action:"refreshCalculate",value:o?"":i.formula,rowIndex:e,colIndex:r,sheetIndex:this.parent.activeSheetTab,isFormula:!0}),o&&i&&i.style&&this.parent.notify(He,{style:t.extend({},this.getEmptyStyle(i.style),this.parent.commonCellStyle),rowIdx:e,colIdx:r,cell:null,lastCell:null,row:null,hRow:null,isHeightCheckNeeded:!0,manualUpdate:!1})},e.prototype.getEmptyStyle=function(e){var t={};return Object.keys(e).forEach(function(e){t[e]=""}),t},e.prototype.getCopiedIdx=function(){if(this.copiedInfo){for(var e=0;e<this.parent.sheets.length;e++)if(this.parent.sheets[e].id===this.copiedInfo.sId)return e;this.clearCopiedInfo()}return-1},e.prototype.setCopiedInfo=function(e,r){var n=this;if(!this.parent.isEdit){var i=this.parent.getActiveSheet(),s=e&&e.range||p(i.selectedRange),o={sheet:i,indexes:[0,0,i.rowCount-1,i.colCount-1],promise:new Promise(function(e,t){e(void 0)})};!i.isLocalData||e&&e.clipboardData||0!==s[0]||s[2]!==i.rowCount-1||(this.parent.showSpinner(),this.parent.notify("updateSheetFromDataSource",o)),o.promise.then(function(){e&&e.clipboardData||(n.copiedInfo&&n.clearCopiedInfo(),n.copiedInfo={range:s,sId:e&&e.sId?e.sId:i.id,isCut:r},n.hidePaste(!0),n.initCopyIndicator(),t.Browser.isIE||n.getClipboardEle().select(),e&&e.isClick&&document.execCommand(r?"cut":"copy"),n.parent.hideSpinner()),t.Browser.isIE&&n.setExternalCells(e)}),e&&e.clipboardData&&(this.setExternalCells(e),this.parent.element.focus())}},e.prototype.clearCopiedInfo=function(){this.copiedInfo&&(this.parent.getActiveSheet().id===this.copiedInfo.sId&&t.detach(this.parent.getMainContent().getElementsByClassName("e-copy-indicator")[0]),this.copiedInfo=null,this.hidePaste())},e.prototype.initCopyIndicator=function(){if(this.copiedInfo&&this.parent.getActiveSheet().id===this.copiedInfo.sId){var e=this.parent.createElement("div",{className:"e-copy-indicator"});e.appendChild(this.parent.createElement("div",{className:"e-top"})),e.appendChild(this.parent.createElement("div",{className:"e-bottom"})),e.appendChild(this.parent.createElement("div",{className:"e-left"})),e.appendChild(this.parent.createElement("div",{className:"e-right"})),de(e,this.copiedInfo.range,this.parent.getActiveSheet()),this.parent.getMainContent().appendChild(e)}},e.prototype.showDialog=function(){this.parent.serviceLocator.getService(dn).show({header:"Spreadsheet",target:this.parent.element,height:205,width:340,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(un).getConstant("PasteAlert")})},e.prototype.hidePaste=function(e){this.parent.notify(mr,{id:this.parent.element.id+"_paste",isEnable:e||!1})},e.prototype.setExternalCells=function(e){for(var r,n="",i=this.copiedInfo.range,s=this.parent.getActiveSheet(),o='<html><body><table xmlns="http://www.w3.org/1999/xhtml"><tbody>',a=i[0];a<=i[2];a++){o+="<tr>";for(var l=i[1];l<=i[3];l++){if(o+='<td style="white-space:nowrap;vertical-align:bottom;',(r=_(a,l,s))&&r.style&&Object.keys(r.style).forEach(function(e){var t=e.match(/[A-Z]/);o+=("backgroundColor"===e?"background":t?e.replace(t[0],"-"+t[0].toLowerCase()):e)+":"+("backgroundColor"===e||"color"===e?r.style[e].slice(0,7):r.style[e])+";"}),o+='">',r&&r.value){var h={formattedText:r.value,value:r.value,format:r.format,onLoad:!0};r.format&&this.parent.notify(Ae,h),o+=h.formattedText,n+=h.formattedText}o+="</td>",n+=l===i[3]?"":"\t"}o+="</tr>",n+=a===i[2]?"":"\n"}o+="</tbody></table></body></html>",t.Browser.isIE?window.clipboardData.setData("text",n):(e.clipboardData.setData("text/html",o),e.clipboardData.setData("text/plain",n),e.preventDefault())},e.prototype.getExternalCells=function(e){var r,n,i,s=this,o=[],a=[],l=this.parent.createElement("span");return t.Browser.isIE?n=window.clipboardData.getData("text"):(r=e.clipboardData.getData("text/html"),n=e.clipboardData.getData("text/plain"),l.innerHTML=r),l.querySelector("table")?l.querySelectorAll("tr").forEach(function(e){e.querySelectorAll("td").forEach(function(e,t){a[t]={value:e.textContent,style:s.getStyle(e,l)}}),o.push({cells:a}),a=[]}):n&&(r&&[].slice.call(l.children).forEach(function(e){e.getAttribute("style")&&(i=s.getStyle(e,l))}),n.trim().split("\n").forEach(function(e){e.split("\t").forEach(function(e,t){a[t]={style:i},H(e)?a[t].formula=e:a[t].value=e}),o.push({cells:a}),a=[]})),setTimeout(function(){s.getClipboardEle().innerHTML=""},0),o},e.prototype.getStyle=function(e,t){var r=[],n={};return(e.classList.length||e.getAttribute("style"))&&(e.classList.length&&r.push(t.querySelector("style").innerHTML.split(e.classList[0])[1].split("{")[1].split("}")[0]),e.getAttribute("style")&&r.push(e.getAttribute("style")),r.forEach(function(e){e.split(";").forEach(function(e){var t=e.split(":")[0].trim();if(["font-family","vertical-align","text-align","text-indent","color","background","font-weight","font-style","font-size","text-decoration"].indexOf(t)>-1){var r=(t="background"===t?"backgroundColor":t).match(/-[a-z]/);n[r?t.replace(r[0],r[0].charAt(1).toUpperCase()):t]=e.split(":")[1]}})})),n},e.prototype.getClipboardEle=function(){return this.parent.element.getElementsByClassName("e-clipboard")[0]},e.prototype.getModuleName=function(){return"clipboard"},e.prototype.destroy=function(){this.removeEventListener();var e=this.getClipboardEle();t.detach(e),this.parent=null},e}(),Mr=function(){function e(e){this.editorElem=null,this.editCellData={},this.isEdit=!1,this.isCellEdit=!0,this.isNewValueEdit=!0,this.keyCodes={BACKSPACE:8,SPACE:32,TAB:9,DELETE:46,ESC:27,ENTER:13,FIRSTALPHABET:65,LASTALPHABET:90,FIRSTNUMBER:48,LASTNUMBER:59,FIRSTNUMPAD:96,LASTNUMPAD:111,SYMBOLSETONESTART:186,SYMBOLSETONEEND:192,SYMBOLSETTWOSTART:219,SYMBOLSETTWOEND:222,FIREFOXEQUALPLUS:61,FIREFOXMINUS:173,F2:113},this.parent=e,this.init()}return e.prototype.init=function(){this.addEventListener()},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null,this.editorElem=null},e.prototype.addEventListener=function(){t.EventHandler.add(this.parent.element,"dblclick",this.dblClickHandler,this),this.parent.on(Yt,this.mouseDownHandler,this),this.parent.on(er,this.keyUpHandler,this),this.parent.on(tr,this.keyDownHandler,this),this.parent.on(Jt,this.performEditOperation,this)},e.prototype.removeEventListener=function(){t.EventHandler.remove(this.parent.element,"dblclick",this.dblClickHandler),this.parent.isDestroyed||(this.parent.off(Yt,this.mouseDownHandler),this.parent.off(er,this.keyUpHandler),this.parent.off(tr,this.keyDownHandler),this.parent.off(Jt,this.performEditOperation))},e.prototype.getModuleName=function(){return"edit"},e.prototype.performEditOperation=function(e){switch(e.action){case"renderEditor":this.renderEditor();break;case"refreshEditor":this.refreshEditor(e.value,e.refreshFormulaBar,e.refreshEditorElem,e.isAppend,e.trigEvent),e.refreshCurPos&&this.setCursorPosition();break;case"startEdit":this.isEdit||(this.isNewValueEdit=e.isNewValueEdit,this.startEdit(e.address,e.value,e.refreshCurPos));break;case"endEdit":this.isEdit&&this.endEdit(e.refreshFormulaBar);break;case"cancelEdit":this.isEdit&&this.cancelEdit(e.refreshFormulaBar);break;case"getCurrentEditValue":e.editedValue=this.editCellData.value;break;case"refreshDependentCellValue":this.refreshDependentCellValue(e.rowIdx,e.colIdx,e.sheetIdx);break;case"getPosition":e.position=this.editorElem.getBoundingClientRect();break;case"focusEditorElem":this.editorElem.focus()}},e.prototype.keyUpHandler=function(e){this.isEdit&&this.isCellEdit&&this.editCellData.value!==this.editorElem.textContent&&this.refreshEditor(this.editorElem.textContent,this.isCellEdit)},e.prototype.keyDownHandler=function(e){var r=e.target,n=e.keyCode;if(this.isEdit)switch(this.isCellEdit&&this.refreshEditor(this.editorElem.textContent,this.isCellEdit),n){case this.keyCodes.ENTER:t.Browser.isWindows&&e.preventDefault(),this.endEdit();break;case this.keyCodes.TAB:this.hasFormulaSuggSelected()||this.endEdit();break;case this.keyCodes.ESC:this.cancelEdit()}else if(!this.isEdit&&(r.classList.contains("e-spreadsheet")||t.closest(r,".e-sheet-panel"))){var i=n>=this.keyCodes.FIRSTALPHABET&&n<=this.keyCodes.LASTALPHABET,s=n>=this.keyCodes.FIRSTNUMBER&&n<=this.keyCodes.LASTNUMBER,o=n>=this.keyCodes.FIRSTNUMPAD&&n<=this.keyCodes.LASTNUMPAD,a=n>=this.keyCodes.SYMBOLSETONESTART&&n<=this.keyCodes.SYMBOLSETONEEND;a||(a=n>=this.keyCodes.SYMBOLSETTWOSTART&&n<=this.keyCodes.SYMBOLSETTWOEND);var l=n===this.keyCodes.FIREFOXEQUALPLUS||n===this.keyCodes.FIREFOXMINUS,h=!e.shiftKey&&!e.ctrlKey&&n===this.keyCodes.F2,p=n===this.keyCodes.BACKSPACE;(!e.ctrlKey&&!e.altKey&&(!e.shiftKey&&n===this.keyCodes.SPACE||i||s||o||a||"mozilla"===t.Browser.info.name&&l)||h||p)&&(h&&(this.isNewValueEdit=!1),this.startEdit()),n===this.keyCodes.DELETE&&this.editingHandler("delete")}},e.prototype.renderEditor=function(){if(!this.editorElem||!this.parent.element.querySelector("#"+this.parent.element.id+"_edit")){var e=void 0;(e=this.parent.createElement("div",{id:this.parent.element.id+"_edit",className:"e-spreadsheet-edit"})).contentEditable="true",e.spellcheck=!1,this.editorElem=e,this.parent.element.querySelector(".e-main-content").appendChild(this.editorElem)}this.parent.notify(Zt,{action:"renderAutoComplete"})},e.prototype.refreshEditor=function(e,t,r,n,i){void 0===i&&(i=!0),n?e=this.editCellData.value=this.editCellData.value+e:this.editCellData.value=e,r&&(this.editorElem.textContent=e),t&&this.parent.notify(Qt,{action:"refreshFormulabar",value:e}),i&&this.editCellData.value===this.editorElem.textContent&&this.triggerEvent("cellEditing")&&this.cancelEdit()},e.prototype.startEdit=function(e,t,r){void 0===r&&(r=!0),this.updateEditCellDetail(e,t),this.initiateEditor(r),this.positionEditor(),this.parent.isEdit=this.isEdit=!0,this.parent.notify(Cr,null),this.parent.notify(Ar,{enable:!1})},e.prototype.setCursorPosition=function(){var e=this.editorElem,t=e.textContent.length;if(t){var r=document.getSelection(),n=document.createRange();n.setStart(e.firstChild,t),n.collapse(!0),r.removeAllRanges(),r.addRange(n)}e.focus()},e.prototype.hasFormulaSuggSelected=function(){var e=document.getElementById(this.parent.element.id+"_ac_popup");return e&&"visible"===e.style.visibility&&e.querySelectorAll(".e-item-focus").length>0},e.prototype.editingHandler=function(e){switch(e){case"delete":var t=this.parent.getActiveSheet().selectedRange,r=m(t);this.parent.clearRange(t,null,!0),this.parent.serviceLocator.getService("cell").refreshRange(r),this.parent.notify(hr,{})}},e.prototype.mouseDownHandler=function(e){if(this.isEdit){var r=e.target;this.isCellEdit=r.classList.contains("e-spreadsheet-edit"),(r.classList.contains("e-cell")||r.classList.contains("e-header-cell")||r.classList.contains("e-selectall")||t.closest(r,".e-toolbar-item.e-active"))&&this.endEdit()}},e.prototype.dblClickHandler=function(e){var r=e.target;(r.classList.contains("e-active-cell")||r.classList.contains("e-cell")||t.closest(r,".e-main-content"))&&(this.isEdit?this.endEdit():(this.isNewValueEdit=!1,this.startEdit()))},e.prototype.updateEditCellDetail=function(e,t){var r,n;this.editCellData.sheetIndex||(r=e&&e.split("!").length>1?$(this.parent,Z(e)):this.parent.activeSheetTab),this.editCellData.addr||(n=ee(this.parent,r-1),e=e?g(e):n.activeCell);var i=p(e),s=i[0],o=i[1],a=this.parent.getCell(s,o),l=P(n,i);this.editCellData={addr:e,fullAddr:ie(this.parent,r)+"!"+e,rowIndex:s,colIndex:o,sheetIndex:r,element:a,value:t||"",position:l}},e.prototype.initiateEditor=function(e){var t=this;this.parent.getData(this.editCellData.fullAddr).then(function(r){r.forEach(function(r,n){var i={cell:r,value:r?r.value:""};t.parent.notify(Ve,i);var s=r?i.value:"";r&&r.formula&&(s=r.formula),t.editCellData.oldValue=s,t.editCellData.value?s=t.editCellData.value:t.editCellData.value=s,t.isNewValueEdit?s="":t.isNewValueEdit=!0,s&&t.refreshEditor(s,!1,!0,!1,!1),e&&t.setCursorPosition(),t.triggerEvent("cellEdit")&&t.cancelEdit(!0,!1)})})},e.prototype.positionEditor=function(){var e=this.editCellData.element;e.classList.add("e-ss-edited");var t=this.editCellData.position.left+1,r=this.editCellData.position.top+1,n=this.editCellData.element.offsetHeight-3,i=this.editCellData.element.offsetWidth-3,s=this.parent.getMainContent().offsetWidth-t-28,o="display:block;top:"+r+"px;"+(this.parent.enableRtl?"right:":"left:")+t+"px;min-width:"+i+"px;max-width:"+s+"px;height:"+n+"px;";o+=e.style.cssText,this.editorElem.setAttribute("style",o),e.classList.contains("e-right-align")?this.editorElem.classList.add("e-right-align"):e.classList.contains("e-center-align")&&this.editorElem.classList.add("e-center-align")},e.prototype.updateEditedValue=function(e){void 0===e&&(e=!0);var t=this.editCellData.oldValue,r=t?t.toString().toUpperCase():"";if(t!==this.editCellData.value||r.indexOf("=RAND()")>-1||r.indexOf("RAND()")>-1||r.indexOf("=RANDBETWEEN(")>-1||r.indexOf("RANDBETWEEN(")>-1){var n=p(this.parent.getActiveSheet().activeCell);this.parent.notify(Pe,{action:"updateCellValue",address:this.editCellData.addr,value:this.editCellData.value});var i=_(n[0],n[1],this.parent.getActiveSheet(),!0),s=this.getRefreshNodeArgs(i);this.editCellData.value=s.result,e&&this.parent.refreshNode(this.editCellData.element,s)}},e.prototype.refreshDependentCellValue=function(e,t,r){if(e&&t&&(e--,t--,(this.editCellData.rowIndex!==e||this.editCellData.colIndex!==t)&&this.parent.activeSheetTab===r)){var n=this.parent.getCell(e,t);if(n){var i=_(e,t,ee(this.parent,r-1)),s=this.getRefreshNodeArgs(i);this.parent.refreshNode(n,s)}}},e.prototype.getRefreshNodeArgs=function(e){var t=(e=e||{})&&e.format?e.format:"",r={value:e.value,format:t,onLoad:!0,formattedText:"",isRightAlign:!1,type:"General"};return this.parent.notify(Ae,r),{isRightAlign:r.isRightAlign,result:r.formattedText,type:r.type,value:r.value,curSymbol:r.curSymbol}},e.prototype.endEdit=function(e){void 0===e&&(e=!1),e&&this.refreshEditor(this.editCellData.oldValue,!1,!0,!1,!1),this.updateEditedValue(),this.triggerEvent("cellSave"),this.resetEditState(),this.focusElement()},e.prototype.cancelEdit=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0),this.refreshEditor(this.editCellData.oldValue,e,!1,!1,!1),t&&this.triggerEvent("cellSave"),this.resetEditState(),this.focusElement()},e.prototype.focusElement=function(){this.parent.element.focus(),this.parent.notify(Ar,{enable:!0})},e.prototype.triggerEvent=function(e){var t={element:this.editCellData.element,value:this.editCellData.value,oldValue:this.editCellData.oldValue,address:this.editCellData.fullAddr};return"cellSave"!==e&&(t.cancel=!1),this.parent.trigger(e,t),t.cancel},e.prototype.altEnter=function(){var e,t,r,n,i=window.getSelection(),s=i.anchorNode,o=document.createRange();n=3===s.nodeType?i.anchorOffset:s.textContent.length,t=(e=s.textContent).slice(0,n),r=e.slice(n)||" ",s.textContent=t+"\n"+r,o=document.createRange(),3===s.nodeType?(o.setStart(s,n+1),o.setEnd(s,n+1)):1===s.nodeType&&(o.setStart(s.firstChild,n+1),o.setEnd(s.firstChild,n+1)),i.removeAllRanges(),i.addRange(o)},e.prototype.resetEditState=function(e){void 0===e&&(e=!0),e&&(this.editCellData.element.classList.remove("e-ss-edited"),this.editorElem.textContent="",this.editorElem.removeAttribute("style"),this.editorElem.classList.remove("e-right-align")),this.editCellData={},this.parent.isEdit=this.isEdit=!1,this.isCellEdit=!0,this.parent.notify(Zt,{action:"endEdit"})},e}(),Pr=function(){function e(e){this.parent=e,this.addEventListener(),this.mouseMoveEvt=this.mouseMoveHandler.bind(this)}return e.prototype.addEventListener=function(){this.parent.on(Xt,this.init,this),this.parent.on(Yt,this.mouseDownHandler,this),this.parent.on(or,this.virtualContentLoadedHandler,this),this.parent.on(ar,this.cellNavigateHandler,this),this.parent.on(yr,this.selectRange,this),this.parent.on(wr,this.rowHeightChanged,this),this.parent.on(Ir,this.colWidthChanged,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Xt,this.init),this.parent.off(Yt,this.mouseDownHandler),this.parent.off(or,this.virtualContentLoadedHandler),this.parent.off(ar,this.cellNavigateHandler),this.parent.off(yr,this.selectRange),this.parent.off(wr,this.rowHeightChanged),this.parent.off(Ir,this.colWidthChanged))},e.prototype.rowHeightChanged=function(e){var t=this;oe(function(){var r=t.getActiveCell(),n=c(t.parent.getActiveSheet().activeCell)[0];if(n===e.rowIdx&&r?r.style.height=parseInt(r.style.height,10)+e.threshold+"px":n>e.rowIdx&&r&&(r.style.top=parseInt(r.style.top,10)+e.threshold+"px"),r=t.getSelectionElement()){var i=y(p(t.parent.getActiveSheet().selectedRange)),s=i[0],o=i[2];s<=e.rowIdx&&o>=e.rowIdx&&r?r.style.height=parseInt(r.style.height,10)+e.threshold+"px":s>e.rowIdx&&r&&(r.style.top=parseInt(r.style.top,10)+e.threshold+"px")}})},e.prototype.colWidthChanged=function(e){var t=this;oe(function(){var r=t.getActiveCell(),n=c(t.parent.getActiveSheet().activeCell)[1];n===e.colIdx&&r?r.style.width=parseInt(r.style.width,10)+e.threshold+"px":n>e.colIdx&&r&&(r.style.left=parseInt(r.style.left,10)+e.threshold+"px"),r=t.getSelectionElement();var i=y(p(t.parent.getActiveSheet().selectedRange)),s=i[1],o=i[3];s<=e.colIdx&&o>=e.colIdx&&r?r.style.width=parseInt(r.style.width,10)+e.threshold+"px":s>e.colIdx&&r&&(r.style.left=parseInt(r.style.left,10)+e.threshold+"px")})},e.prototype.selectRange=function(e){this.selectRangeByIdx("Single"===this.parent.selectionSettings.mode?e.slice(0,2).concat(e.slice(0,2)):e)},e.prototype.init=function(){var e=p(this.parent.getActiveSheet().selectedRange),t=y(e),r=c(this.parent.getActiveSheet().activeCell),n=t[0]<=r[0]&&t[2]>=r[0]&&t[1]<=r[1]&&t[3]>=r[1];this.createSelectionElement(),this.selectRangeByIdx(e,null,null,n)},e.prototype.createSelectionElement=function(){var e=this.parent.getMainContent(),t=this.parent.createElement("div",{className:"e-selection"}),r=this.parent.createElement("div",{className:"e-active-cell"});e.appendChild(t),e.appendChild(r)},e.prototype.mouseDownHandler=function(e){if(!this.parent.isEdit&&this.getSheetElement().contains(e.target)&&!e.target.classList.contains("e-colresize")&&!e.target.classList.contains("e-rowresize")){var r=this.parent.getActiveSheet(),n=this.parent.selectionSettings.mode,i=this.getRowIdxFromClientY(Ee(e)),s=this.getColIdxFromClientX(Se(e)),o=c(r.activeCell),a=r.showHeaders&&this.parent.getRowHeaderContent().contains(e.target),l=r.showHeaders&&this.parent.getColumnHeaderContent().contains(e.target);if(3===e.which&&this.isSelected(i,s))return;if("Multiple"===n&&(!be(e)&&(!ve(e)||ve(e)&&o[0]===i&&o[1]===s)||l||a)&&(document.addEventListener(ge().split(" ")[0],this.mouseMoveEvt),t.Browser.isPointer||document.addEventListener(ge().split(" ")[1],this.mouseMoveEvt,{passive:!1})),be(e)||t.EventHandler.add(document,ye(),this.mouseUpHandler,this),ve(e)&&!l&&!a)return void(this.touchEvt=e);a?(this.isRowSelected=!0,e.shiftKey&&"Single"!==n||(this.startCell=[i,0]),this.selectRangeByIdx([this.startCell[0],0,i,r.colCount-1],e)):l?(this.isColSelected=!0,e.shiftKey&&"Single"!==n||(this.startCell=[0,s]),this.selectRangeByIdx([0,this.startCell[1],r.rowCount-1,s],e)):e.target.classList.contains("e-selectall")?(this.startCell=[0,0],this.selectRangeByIdx([].concat(this.startCell,[r.rowCount-1,r.colCount-1]),e)):e.target.classList.contains("e-main-content")||(e.shiftKey&&"Single"!==n||(this.startCell=[i,s]),this.selectRangeByIdx([].concat(this.startCell?this.startCell:c(r.activeCell),[i,s]),e)),this.parent.isMobileView()&&(this.parent.element.classList.add("e-mobile-focused"),this.parent.renderModule.setSheetPanelSize())}},e.prototype.mouseMoveHandler=function(e){var t=this;Ce(e)&&e.preventDefault();var r=this.parent.getActiveSheet(),n=this.getScrollContent(),i=n.getBoundingClientRect(),s=Se(e),o=Ee(e),a=this.isRowSelected?r.colCount-1:this.getColIdxFromClientX(Math.min(s,i.right)),l=this.isColSelected?r.rowCount-1:this.getRowIdxFromClientY(Math.min(o,i.bottom)),h=o>i.bottom&&l<r.rowCount,p=o<i.top&&l>=0&&!this.isColSelected,u=s>i.right&&a<r.colCount,d=s<i.left&&a>=0&&!this.isRowSelected;this.clearInterval(),h||p||u||d?this.scrollInterval=setInterval(function(){if((h||p)&&!t.isColSelected){if((l=t.getRowIdxFromClientY(h?i.bottom:i.top))>=r.rowCount)return void t.clearInterval();n.scrollTop+=(h?1:-1)*j(r,l)}if((u||d)&&!t.isRowSelected){if((a=t.getColIdxFromClientX(u?i.right:i.left))>=r.colCount)return void t.clearInterval();n.scrollLeft+=(u?1:-1)*W(r,a)}t.selectRangeByIdx([].concat(t.startCell,[l,a]),e)},100):this.selectRangeByIdx([].concat(this.startCell?this.startCell:c(r.activeCell),[l,a]),e)},e.prototype.mouseUpHandler=function(e){var r=this.getRowIdxFromClientY(Ee(e)),n=this.getColIdxFromClientX(Se(e));this.clearInterval(),!be(e)||this.isColSelected||this.isRowSelected||this.getRowIdxFromClientY(Ee(this.touchEvt))!==r||this.getColIdxFromClientX(Se(this.touchEvt))!==n||this.mouseDownHandler(e),this.parent.trigger("select",{range:this.parent.getActiveSheet().selectedRange}),document.removeEventListener(ge().split(" ")[0],this.mouseMoveEvt),t.Browser.isPointer||document.removeEventListener(ge().split(" ")[1],this.mouseMoveEvt),t.EventHandler.remove(document,ye(),this.mouseUpHandler),this.parent.notify(lr,e)},e.prototype.isSelected=function(e,t){var r=y(p(this.parent.getActiveSheet().selectedRange));return r[0]<=e&&e<=r[2]&&r[1]<=t&&t<=r[3]},e.prototype.virtualContentLoadedHandler=function(){var e=this.parent.getActiveSheet(),t=p(e.selectedRange);this.isColSelected&&this.isRowSelected?this.selectRangeByIdx([0,0,e.rowCount-1,e.colCount-1],null,!0):this.isColSelected?this.selectRangeByIdx([0,t[1],e.rowCount-1,t[3]],null,!0):this.isRowSelected?this.selectRangeByIdx([t[0],0,t[2],e.colCount-1],null,!0):this.highlightHdr(t,t[0]>=this.parent.viewport.topIndex||t[2]>=this.parent.viewport.topIndex,t[1]>=this.parent.viewport.leftIndex||t[3]>=this.parent.viewport.leftIndex)},e.prototype.clearInterval=function(){clearInterval(this.scrollInterval),this.scrollInterval=null},e.prototype.getScrollContent=function(){return this.parent.getMainContent()},e.prototype.getScrollLeft=function(){return this.parent.scrollModule?this.parent.scrollModule.prevScroll.scrollLeft:0},e.prototype.cellNavigateHandler=function(e){this.selectRangeByIdx(e.range.concat(e.range))},e.prototype.getColIdxFromClientX=function(e){for(var t=0,r=this.parent.getActiveSheet(),n=this.parent.getMainContent().getBoundingClientRect(),i=(this.parent.enableRtl?n.right-e:e-n.left)+this.getScrollLeft(),s=0;;s++)if(t+=G(r,s),i<t)return s},e.prototype.getRowIdxFromClientY=function(e){for(var t=0,r=this.parent.getActiveSheet(),n=e-this.parent.getMainContent().getBoundingClientRect().top+this.parent.getMainContent().scrollTop,i=0;;i++)if(t+=j(r,i),n<t)return i},e.prototype.selectRangeByIdx=function(e,r,n,i){var s=this.getSelectionElement(),o=this.parent.getActiveSheet(),a={range:d(e),cancel:!1};this.parent.trigger("beforeSelect",a),!0!==a.cancel&&(C(e)?s.classList.add("e-hide"):(s.classList.remove("e-hide"),de(s,e,o,this.parent.enableRtl)),Q(this.parent,d(e),o),this.UpdateRowColSelected(e),this.highlightHdr(e),n||r&&("mousemove"===r.type||Ce(r))||this.updateActiveCell(i?c(o.activeCell):e),t.isNullOrUndefined(r)&&(r={type:"mousedown"}),this.parent.notify(hr,r))},e.prototype.UpdateRowColSelected=function(e){var t=this.parent.getActiveSheet();this.isRowSelected=0===e[1]&&e[3]===t.colCount-1,this.isColSelected=0===e[0]&&e[2]===t.rowCount-1},e.prototype.updateActiveCell=function(e){var t=this.parent.getActiveSheet(),r=p(t.topLeftCell),n=this.isColSelected?r[0]:e[0],i=this.isRowSelected?r[1]:e[1];t.activeCell=u(n,i),this.parent.setProperties({sheets:this.parent.sheets},!0),de(this.getActiveCell(),p(t.activeCell),t,this.parent.enableRtl),this.parent.notify(je,[n,i])},e.prototype.getSelectionElement=function(){return this.parent.element.getElementsByClassName("e-selection")[0]},e.prototype.getActiveCell=function(){return this.parent.getMainContent().getElementsByClassName("e-active-cell")[0]},e.prototype.getSheetElement=function(){return document.getElementById(this.parent.element.id+"_sheet")},e.prototype.highlightHdr=function(e,r,n){if(void 0===r&&(r=!0),void 0===n&&(n=!0),this.parent.getActiveSheet().showHeaders){var i=[],s=[],o=y(e);o=this.getHdrIndexes(o);var a=this.parent.element.getElementsByClassName("e-select-all-cell")[0];t.removeClass(this.getSheetElement().querySelectorAll(".e-highlight"),"e-highlight"),t.removeClass(this.getSheetElement().querySelectorAll(".e-prev-highlight"),"e-prev-highlight"),t.removeClass([a],["e-prev-highlight-right","e-prev-highlight-bottom"]),r&&(i=[].slice.call(this.parent.getRowHeaderContent().querySelectorAll("td")).slice(o[0],o[2]+1)),n&&(s=[].slice.call(this.parent.getColumnHeaderContent().querySelectorAll("th")).slice(o[1],o[3]+1)),t.addClass([].concat(i,s),"e-highlight"),i.length&&i[0].parentElement.previousElementSibling&&i[0].parentElement.previousElementSibling.classList.add("e-prev-highlight"),s.length&&s[0].previousElementSibling&&s[0].previousElementSibling.classList.add("e-prev-highlight"),this.isRowSelected&&this.isColSelected&&document.getElementById(this.parent.element.id+"_select_all").classList.add("e-highlight"),0===o[0]&&a.classList.add("e-prev-highlight-bottom"),0===o[1]&&a.classList.add("e-prev-highlight-right")}},e.prototype.getHdrIndexes=function(e){if(this.parent.scrollSettings.enableVirtualization){var t=[];return t[0]=this.isColSelected?e[0]:e[0]-this.parent.viewport.topIndex<0?0:e[0]-this.parent.viewport.topIndex,t[1]=this.isRowSelected?e[1]:e[1]-this.parent.viewport.leftIndex<0?0:e[1]-this.parent.viewport.leftIndex,t[2]=this.isColSelected?this.parent.viewport.rowCount+2*this.parent.getThreshold("row"):0===t[0]?e[2]-this.parent.viewport.topIndex:e[2]-e[0]+t[0],t[3]=this.isRowSelected?this.parent.viewport.colCount+2*this.parent.getThreshold("col"):0===t[1]?e[3]-this.parent.viewport.leftIndex:e[3]-e[1]+t[1],t}return e},e.prototype.getModuleName=function(){return"selection"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e}(),Br=function(){function e(e){this.parent=e,this.addEventListener(),this.initProps()}return e.prototype.getModuleName=function(){return"scroll"},e.prototype.onContentScroll=function(e){var t,r,n=this.parent.getMainContent(),i=e.scrollLeft||n.scrollLeft,s=e.scrollTop||n.scrollTop,o=this.parent.enableRtl?this.initScrollValue-i:i;if(this.prevScroll.scrollLeft!==o){var a=o>this.prevScroll.scrollLeft;r=this.offset.left.size,this.offset.left=this.getColOffset(o,r,a),this.parent.getActiveSheet().showHeaders&&(this.parent.getColumnHeaderContent().scrollLeft=i),t={cur:this.offset.left,prev:{idx:this.leftIndex,size:r},increase:a,preventScroll:e.preventScroll},this.parent.notify(nr,t),this.updateTopLeftCell(),this.parent.scrollSettings.enableVirtualization||!a||this.parent.scrollSettings.isFinite||this.updateNonVirtualCols(),this.leftIndex=t.prev.idx,this.prevScroll.scrollLeft=o}if(this.prevScroll.scrollTop!==s){var l=s>this.prevScroll.scrollTop;r=this.offset.top.size,this.offset.top=this.getRowOffset(s,l),this.parent.getActiveSheet().showHeaders&&(this.parent.getRowHeaderContent().scrollTop=s),t={cur:this.offset.top,prev:{idx:this.topIndex,size:r},increase:l,preventScroll:e.preventScroll},this.parent.notify(rr,t),this.updateTopLeftCell(),this.parent.scrollSettings.enableVirtualization||!l||this.parent.scrollSettings.isFinite||this.updateNonVirtualRows(),this.topIndex=t.prev.idx,this.prevScroll.scrollTop=s}},e.prototype.updateNonVirtualRows=function(){var e=this.parent.getActiveSheet(),t=this.parent.getThreshold("row");this.offset.top.idx>e.rowCount-(this.parent.viewport.rowCount+t)&&(this.parent.renderModule.refreshUI({colIndex:0,direction:"first",refresh:"RowPart"},u(e.rowCount,0)+":"+u(e.rowCount+t-1,e.colCount-1)),e.rowCount+=t,this.parent.setProperties({sheets:this.parent.sheets},!0))},e.prototype.updateNonVirtualCols=function(){var e=this.parent.getActiveSheet(),t=this.parent.getThreshold("col");this.offset.left.idx>e.colCount-(this.parent.viewport.colCount+t)&&(this.parent.renderModule.refreshUI({rowIndex:0,colIndex:e.colCount,direction:"first",refresh:"ColumnPart"},u(0,e.colCount)+":"+u(e.rowCount-1,e.colCount+t-1)),e.colCount+=t,this.parent.setProperties({sheets:this.parent.sheets},!0))},e.prototype.updateTopLeftCell=function(){this.parent.getActiveSheet().topLeftCell=u(this.offset.top.idx,this.offset.left.idx),this.parent.setProperties({sheets:this.parent.sheets},!0)},e.prototype.getRowOffset=function(e,t){var r,n=this.offset.top.size,i=this.parent.getActiveSheet(),s=t?this.offset.top.idx+1:this.offset.top.idx?this.offset.top.idx-1:0;if(this.parent.scrollSettings.isFinite){if(r=i.rowCount,t&&s+this.parent.viewport.rowCount+this.parent.getThreshold("row")>=r)return{idx:this.offset.top.idx,size:this.offset.top.size}}else r=1/0;for(;s<r;)if(t){if((n+=j(i,s-1))===e)return{idx:s,size:n};if(n>e)return{idx:s-1,size:n-j(i,s-1)};s++}else{if(0===n)return{idx:0,size:0};if((n-=j(i,s))===e)return{idx:s,size:n};if(n<e)return(n+=j(i,s))>e?{idx:s,size:n-j(i,s)}:{idx:s+1,size:n};s--}return{idx:this.offset.top.idx,size:this.offset.top.size}},e.prototype.getColOffset=function(e,t,r){var n,i=t,s=this.parent.getActiveSheet(),o=r?this.offset.left.idx+1:this.offset.left.idx-1;if(this.parent.scrollSettings.isFinite){if(n=s.colCount,r&&o+this.parent.viewport.colCount+this.parent.getThreshold("col")>=n)return{idx:this.offset.left.idx,size:this.offset.left.size}}else n=1/0;for(;o<n;)if(r){if((i+=W(s,o-1))===e)return{idx:o,size:i};if(i>e)return{idx:o-1,size:i-W(s,o-1)};o++}else{if(0===i)return{idx:0,size:0};if((i-=W(s,o))===e)return{idx:o,size:i};if(i<e)return(i+=W(s,o))>e?{idx:o,size:i-W(s,o)}:{idx:o+1,size:i};o--}return{idx:this.offset.left.idx,size:this.offset.left.size}},e.prototype.wireEvents=function(){this.onScroll=this.onContentScroll.bind(this),t.EventHandler.add(this.parent.getMainContent(),"scroll",this.onScroll,this),this.parent.enableRtl&&(this.initScrollValue=this.parent.getMainContent().scrollLeft)},e.prototype.initProps=function(){this.topIndex=0,this.leftIndex=0,this.prevScroll={scrollLeft:0,scrollTop:0},this.offset={left:{idx:0,size:0},top:{idx:0,size:0}}},e.prototype.getThreshold=function(){return"mozilla"===t.Browser.info.name?.5:1},e.prototype.setPadding=function(){if(this.parent.allowScrolling){var e=this.parent.getColumnHeaderContent(),t=this.parent.getRowHeaderContent(),r=he()-this.getThreshold(),n=this.parent.enableRtl?{padding:"paddingLeft",border:"borderLeftWidth"}:{padding:"paddingRight",border:"borderRightWidth"};r>0&&(e.parentElement.style[n.padding]=r+"px",e.style[n.border]="1px",t.style.marginBottom=r+"px")}},e.prototype.addEventListener=function(){this.parent.on(Xt,this.wireEvents,this),this.parent.on(Nr,this.onContentScroll,this),this.parent.on(Tr,this.initProps,this),this.parent.on($t,this.destroy,this)},e.prototype.destroy=function(){t.EventHandler.remove(this.parent.getMainContent(),"scroll",this.onScroll),this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Xt,this.wireEvents),this.parent.off(Nr,this.onContentScroll),this.parent.off(Tr,this.initProps),this.parent.off($t,this.destroy))},e}(),Vr=function(){function e(e){this.scroll=[],this.parent=e,this.addEventListener()}return e.prototype.getModuleName=function(){return"virtualscroll"},e.prototype.createVirtualElement=function(e){var r=this.parent.getActiveSheet(),n=this.parent.getMainContent();this.content=this.parent.createElement("div",{className:"e-virtualable"}),this.content.appendChild(n.querySelector(".e-table")),n.appendChild(this.content);var i,s,o,a,l=n.appendChild(this.parent.createElement("div",{className:"e-virtualtrack"}));this.parent.sheets.length>this.scroll.length&&this.initScroll();var h=this.parent.viewport.rowCount+1+2*this.parent.getThreshold("row");r.rowCount>h||r.usedRange.rowIndex>h?(r.rowCount<r.usedRange.rowIndex&&(r.rowCount=r.usedRange.rowIndex),this.setScrollCount(r.rowCount,"row"),o=z(r,h,this.scroll[this.parent.activeSheetTab-1].rowCount-1)):(this.scroll[this.parent.activeSheetTab-1].rowCount=r.rowCount=h,o=1);var p=G(r,0,(h=this.parent.viewport.colCount+1+2*this.parent.getThreshold("col"))-1);r.colCount>h?(r.colCount<r.usedRange.colIndex&&(r.colCount=r.usedRange.colIndex),this.setScrollCount(r.colCount,"col"),a=p+G(r,h,this.scroll[this.parent.activeSheetTab-1].colCount-1)):(r.colCount=h,a=p),this.parent.setProperties({sheets:this.parent.sheets},!0),e.startColIdx&&(p=G(r,e.startColIdx,e.startColIdx+h-1)),t.isNullOrUndefined(this.translateX)&&(this.parent.viewport.leftIndex=0,this.translateX=0),t.isNullOrUndefined(this.translateY)&&(this.parent.viewport.topIndex=0,this.translateY=0),r.showHeaders&&(n=this.parent.getRowHeaderContent(),this.rowHeader=this.content.cloneNode(),this.rowHeader.appendChild(n.querySelector(".e-table")),n.appendChild(this.rowHeader),s=n.appendChild(l.cloneNode()),this.rowHeader.style.transform="translate(0px, "+this.translateY+"px)",n=this.parent.getColumnHeaderContent(),this.colHeader=this.content.cloneNode(),this.colHeader.appendChild(n.querySelector(".e-table")),n.appendChild(this.colHeader),i=n.appendChild(l.cloneNode()),this.colHeader.style.width=p+"px",s.style.height=o+"px",i.style.width=a+"px",this.colHeader.style.transform="translate("+this.translateX+"px, 0px)"),this.content.style.transform="translate("+this.translateX+"px, "+this.translateY+"px)",this.content.style.width=p+"px",l.style.height=o+"px",l.style.width=a+"px"},e.prototype.initScroll=function(){for(var e=0;e<this.parent.sheets.length;)this.scroll[e]||this.scroll.push({rowCount:0,colCount:0}),e++},e.prototype.setScrollCount=function(e,t){var r=this.parent.activeSheetTab-1;this.scroll[r][t+"Count"]||(this.scroll[r][t+"Count"]=e)},e.prototype.getAddress=function(e){return u(e[0],this.parent.viewport.leftIndex)+":"+u(e[1],this.parent.viewport.leftIndex+this.parent.viewport.colCount+2*this.parent.getThreshold("col"))},e.prototype.getColAddress=function(e){return u(this.parent.viewport.topIndex,e[0])+":"+u(this.parent.viewport.topIndex+this.parent.viewport.rowCount+2*this.parent.getThreshold("row"),e[1])},e.prototype.updateScrollCount=function(e,t,r){void 0===r&&(r=e);var n=this.parent.getActiveSheet(),i=e+this.parent.viewport[t+"Count"]+1+r,s=this.scroll[this.parent.activeSheetTab-1][t+"Count"];if(i<s){if(n[t+"Count"]===s)return;i=s}this.parent.scrollSettings.isFinite||(n[t+"Count"]=i,this.parent.setProperties({sheets:this.parent.sheets},!0))},e.prototype.onVerticalScroll=function(e){var t=e.cur.idx,r=e.cur.size,n=e.prev.idx,i=Math.abs(t-n),s=this.parent.getThreshold("row");if(i>Math.round(s/2)){if(t<=s&&(e.increase||(this.updateScrollCount(s,"row"),this.translateY&&n>s&&(this.translateY=0,this.parent.viewport.topIndex=n-s,e.preventScroll||(i<this.parent.viewport.rowCount+s?this.parent.renderModule.refreshUI({colIndex:this.parent.viewport.leftIndex,direction:"last",refresh:"RowPart"},this.getAddress([0,this.parent.viewport.topIndex-1])):this.parent.renderModule.refreshUI({rowIndex:0,colIndex:this.parent.viewport.leftIndex,refresh:"Row"})),this.parent.viewport.topIndex=0))),n<s&&(i=Math.abs(t-s)),t>s&&(this.updateScrollCount(e.cur.idx,"row",s),this.parent.viewport.topIndex=t-s,this.translateY=r-this.getThresholdHeight(this.parent.viewport.topIndex,s),!e.preventScroll))if(i<this.parent.viewport.rowCount+s)if(e.increase){var o=this.parent.viewport.topIndex+this.parent.viewport.rowCount+2*s;this.parent.renderModule.refreshUI({colIndex:this.parent.viewport.leftIndex,direction:"first",refresh:"RowPart"},this.getAddress([o-i+1,this.checkLastIdx(o,"row")]))}else this.parent.renderModule.refreshUI({colIndex:this.parent.viewport.leftIndex,direction:"last",refresh:"RowPart"},this.getAddress([this.parent.viewport.topIndex,this.parent.viewport.topIndex+i-1]));else this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Row"});e.prev.idx=t}},e.prototype.checkLastIdx=function(e,t){if(this.parent.scrollSettings.isFinite){var r=this.parent.getActiveSheet()[t+"Count"]-1;e>r&&(e=r)}return e},e.prototype.onHorizontalScroll=function(e){var t=e.cur.idx,r=e.cur.size,n=e.prev.idx,i=Math.abs(t-n),s=this.parent.getThreshold("col");if(i>Math.round(s/2)){if(t<=s&&(e.increase||(this.updateScrollCount(s,"col"),this.translateX&&n>s&&(this.translateX=0,this.parent.viewport.leftIndex=n-s,i<this.parent.viewport.rowCount+s?this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:0,direction:"last",refresh:"ColumnPart"},this.getColAddress([0,this.parent.viewport.leftIndex-1])):this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:0,refresh:"Column"}),this.parent.viewport.leftIndex=0))),n<s&&(i=Math.abs(t-s)),t>s&&(this.updateScrollCount(e.cur.idx,"col",s),this.parent.viewport.leftIndex=t-s,this.translateX=r-this.getThresholdWidth(this.parent.viewport.leftIndex,s),!e.preventScroll))if(i<this.parent.viewport.colCount+s)if(e.increase){var o=this.parent.viewport.leftIndex+this.parent.viewport.colCount+2*s;this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:o-i+1,direction:"first",refresh:"ColumnPart"},this.getColAddress([o-i+1,this.checkLastIdx(o,"col")]))}else this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,direction:"last",refresh:"ColumnPart"},this.getColAddress([this.parent.viewport.leftIndex,this.parent.viewport.leftIndex+i-1]));else this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Column"});e.prev.idx=t}},e.prototype.getThresholdHeight=function(e,t){for(var r=0,n=this.parent.getActiveSheet(),i=e;i<e+t;i++)r+=j(n,i);return r},e.prototype.getThresholdWidth=function(e,t){for(var r=0,n=this.parent.getActiveSheet(),i=e;i<e+t;i++)r+=W(n,i);return r},e.prototype.translate=function(e){var t=this.parent.getActiveSheet();if("Row"!==e.refresh&&"RowPart"!==e.refresh||(this.content.style.transform="translate("+this.translateX+"px, "+this.translateY+"px)",t.showHeaders&&(this.rowHeader.style.transform="translate(0px, "+this.translateY+"px)")),"Column"===e.refresh||"ColumnPart"===e.refresh){var r=this.parent.enableRtl?-this.translateX:this.translateX;this.content.style.transform="translate("+r+"px, "+this.translateY+"px)",t.showHeaders&&(this.colHeader.style.transform="translate("+r+"px, 0px)")}},e.prototype.updateColumnWidth=function(e){if("Column"===e.refresh){this.content.style.width="";var t=this.content.querySelector("tr").getBoundingClientRect().width;this.parent.getActiveSheet().showHeaders&&(this.colHeader.style.width=t+"px"),this.content.style.width=t+"px"}},e.prototype.updateUsedRange=function(e){if(this.scroll.length){var t=this.parent.getActiveSheet();if("row"===e.update){if(e.index>this.scroll[this.parent.activeSheetTab-1].rowCount){var r=this.getVTrackHeight("height");r+=z(t,this.scroll[this.parent.activeSheetTab-1].rowCount,e.index),this.scroll[this.parent.activeSheetTab-1].rowCount=e.index+1,this.updateVTrack(this.rowHeader,r,"height"),this.scroll[this.parent.activeSheetTab-1].rowCount>t.rowCount&&(t.rowCount=this.scroll[this.parent.activeSheetTab-1].rowCount)}}else if(e.index>this.scroll[this.parent.activeSheetTab-1].colCount){var n=this.getVTrackHeight("width");n+=G(t,this.scroll[this.parent.activeSheetTab-1].colCount,e.index),this.scroll[this.parent.activeSheetTab-1].colCount=e.index+1,this.updateVTrack(this.colHeader,n,"width"),this.scroll[this.parent.activeSheetTab-1].colCount>t.colCount&&(t.colCount=this.scroll[this.parent.activeSheetTab-1].colCount)}}},e.prototype.createHeaderElement=function(e){this.rowHeader=this.content.cloneNode(),this.colHeader=this.rowHeader.cloneNode(),this.rowHeader.style.width="",this.rowHeader.style.transform="translate(0px, "+this.translateY+"px)",this.colHeader.style.transform="translate("+(this.parent.enableRtl?-this.translateX:this.translateX)+"px, 0px)",this.rowHeader.appendChild(e.element.querySelector("table")),e.element.appendChild(this.rowHeader);var t=this.parent.getColumnHeaderContent();this.colHeader.appendChild(t.querySelector("table")),t.appendChild(this.colHeader);var r=this.content.nextElementSibling.cloneNode(),n=r.cloneNode();r.style.width="",n.style.height="",e.element.appendChild(r),t.appendChild(n)},e.prototype.getVTrackHeight=function(e){return parseInt(this.content.nextElementSibling.style[e],10)},e.prototype.updateVTrackHeight=function(e){var t=this.parent.viewport.rowCount+1+2*this.parent.getThreshold("row");e.rowIdx>=t&&e.rowIdx<this.scroll[this.parent.activeSheetTab-1].rowCount&&this.updateVTrack(this.rowHeader,this.getVTrackHeight("height")+e.threshold,"height")},e.prototype.updateVTrackWidth=function(e){if(e.colIdx<this.parent.getActiveSheet().colCount){var t=this.parent.getColumnHeaderContent().getElementsByClassName("e-virtualtrack")[0];t.style.width=parseInt(t.style.width,10)+e.threshold+"px";var r=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0];r.style.width=parseInt(r.style.width,10)+e.threshold+"px";var n=this.parent.getColumnHeaderContent().getElementsByClassName("e-virtualable")[0];n.style.width=parseInt(n.style.width,10)+e.threshold+"px";var i=this.parent.getMainContent().getElementsByClassName("e-virtualable")[0];i.style.width=parseInt(i.style.width,10)+e.threshold+"px"}},e.prototype.updateVTrack=function(e,t,r){this.parent.getActiveSheet().showHeaders&&(e.nextElementSibling.style[r]=t+"px"),this.content.nextElementSibling.style[r]=t+"px"},e.prototype.deInitProps=function(){this.parent.viewport.leftIndex=null,this.parent.viewport.topIndex=null,this.translateX=null,this.translateY=null},e.prototype.updateScrollProps=function(e){void 0===e&&(e={sheetIndex:0}),0===this.scroll.length?this.initScroll():this.scroll.splice(e.sheetIndex,0,{rowCount:0,colCount:0})},e.prototype.sliceScrollProps=function(e){t.isNullOrUndefined(e.sheetIndex)?this.scroll.length=0:this.scroll.splice(e.sheetIndex,1)},e.prototype.addEventListener=function(){this.parent.on(ir,this.createVirtualElement,this),this.parent.on(sr,this.translate,this),this.parent.on(or,this.updateColumnWidth,this),this.parent.on(rr,this.onVerticalScroll,this),this.parent.on(nr,this.onHorizontalScroll,this),this.parent.on(_e,this.updateUsedRange,this),this.parent.on(wr,this.updateVTrackHeight,this),this.parent.on(Ir,this.updateVTrackWidth,this),this.parent.on(Fr,this.createHeaderElement,this),this.parent.on(Tr,this.deInitProps,this),this.parent.on(We,this.sliceScrollProps,this),this.parent.on(qe,this.updateScrollProps,this),this.parent.on($t,this.destroy,this)},e.prototype.destroy=function(){this.removeEventListener(),this.rowHeader=null,this.colHeader=null,this.content=null,this.parent=null,this.scroll.length=0,this.translateX=null,this.translateY=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ir,this.createVirtualElement),this.parent.off(sr,this.translate),this.parent.off(or,this.updateColumnWidth),this.parent.off(rr,this.onVerticalScroll),this.parent.off(nr,this.onHorizontalScroll),this.parent.off(_e,this.updateUsedRange),this.parent.off(wr,this.updateVTrackHeight),this.parent.off(Ir,this.updateVTrackWidth),this.parent.off(Fr,this.createHeaderElement),this.parent.off(We,this.sliceScrollProps),this.parent.off(qe,this.updateScrollProps),this.parent.off($t,this.destroy))},e}(),jr=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(tr,this.keyDownHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(tr,this.keyDownHandler)},e.prototype.keyDownHandler=function(e){if(!this.parent.isEdit&&(document.activeElement.classList.contains("e-spreadsheet")||t.closest(document.activeElement,".e-sheet"))){var r=void 0,n=this.parent.enableRtl,i=this.parent.getActiveSheet(),s=c(this.parent.getActiveSheet().activeCell);if([9,37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault(),!e.shiftKey&&(!n&&37===e.keyCode||n&&39===e.keyCode)||e.shiftKey&&9===e.keyCode)if(s[1]>0)s[1]-=1,r=!0;else{var o=this.parent.getMainContent();0===s[1]&&o.scrollLeft&&!n&&(o.scrollLeft=0)}else if(!e.shiftKey&&38===e.keyCode||e.shiftKey&&13===e.keyCode)if(s[0]>0)s[0]-=1,r=!0;else{o=this.parent.getMainContent();0===s[0]&&o.scrollTop&&(o.scrollTop=0)}else!e.shiftKey&&(!n&&39===e.keyCode||n&&37===e.keyCode)||9===e.keyCode?s[1]<i.colCount-1&&(s[1]+=1,r=!0):(!e.shiftKey&&40===e.keyCode||13===e.keyCode)&&s[0]<i.rowCount-1&&(s[0]+=1,r=!0);r&&(this.scrollNavigation(s,!1),i.activeCell=d(s),this.parent.setProperties({sheets:this.parent.sheets},!0),this.parent.notify(ar,{range:s}))}e.target.classList.contains("e-sheet-rename")&&(32===e.keyCode?e.stopPropagation():13!==e.keyCode&&27!==e.keyCode||this.parent.notify(kr,e))},e.prototype.scrollNavigation=function(e,t){var r=this.parent.enableRtl?-1:1,n=this.parent.getMainContent(),i=this.parent.getActiveSheet(),s=(c(i.activeCell),c(i.topLeftCell));this.getBottomIdx(s)<=e[0]||t?n.scrollTop+=j(i,e[0]):s[0]>e[0]&&(n.scrollTop-=j(i,e[0])),this.getRightIdx(s)<=e[1]||t?n.scrollLeft+=W(i,e[1])*r:s[1]>e[1]&&(n.scrollLeft-=W(i,e[1])*r)},e.prototype.getBottomIdx=function(e){for(var t=0,r=this.parent.getActiveSheet(),n=e[0];;n++)if((t+=j(r,n))>=this.parent.viewport.height-17)return n},e.prototype.getRightIdx=function(e){for(var t=0,r=this.parent.getActiveSheet(),n=this.parent.getMainContent().offsetWidth,i=e[1];;i++)if((t+=W(r,i))>=n-17)return i},e.prototype.getModuleName=function(){return"keyboardNavigation"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e}(),Ur=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(tr,this.keyDownHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(tr,this.keyDownHandler)},e.prototype.keyDownHandler=function(e){if(e.ctrlKey)if([79,83,65].indexOf(e.keyCode)>-1&&e.preventDefault(),79===e.keyCode)this.parent.element.querySelector("#"+this.parent.element.id+"_fileUpload").click();else if(83===e.keyCode)this.parent.saveUrl&&this.parent.allowSave&&this.parent.save();else if(88===e.keyCode)this.parent.notify("cut",null);else if(67===e.keyCode)this.parent.notify("copy",null);else if(86===e.keyCode)this.parent.notify(vr,null);else if(66===e.keyCode){e.preventDefault();t="bold"===(t=this.parent.getCellStyleValue(["fontWeight"],c(this.parent.getActiveSheet().activeCell)).fontWeight)?"normal":"bold",this.parent.notify(Re,{style:{fontWeight:t},onActionUpdate:!0,refreshRibbon:!0})}else if(73===e.keyCode){e.preventDefault();var t;t="italic"===(t=this.parent.getCellStyleValue(["fontStyle"],c(this.parent.getActiveSheet().activeCell)).fontStyle)?"normal":"italic",this.parent.notify(Re,{style:{fontStyle:t},onActionUpdate:!0,refreshRibbon:!0})}else 85===e.keyCode?(e.preventDefault(),this.parent.notify(Le,{style:{textDecoration:"underline"},refreshRibbon:!0})):53===e.keyCode&&(e.preventDefault(),this.parent.notify(Le,{style:{textDecoration:"line-through"},refreshRibbon:!0}));27===e.keyCode&&this.parent.notify(Cr,null)},e.prototype.getModuleName=function(){return"keyboardShortcut"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e}(),zr=function(){function e(e){this.checkHeight=!1,this.parent=e,this.row=e.createElement("tr",{className:"e-row"}),this.addEventListener()}return e.prototype.applyCellFormat=function(e){var r=Object.keys(e.style);if(!e.lastCell||this.row.childElementCount||r.length){var n=e.cell||this.parent.getCell(e.rowIdx,e.colIdx);if(n){if(Object.assign(n.style,e.style),e.isHeightCheckNeeded)if(e.manualUpdate){var i=void 0;this.parent.scrollSettings.enableVirtualization&&(i=e.rowIdx-this.parent.viewport.topIndex),this.checkHeight||(this.checkHeight=this.isHeightCheckNeeded(e.style,e.onActionUpdate)),t.isNullOrUndefined(this.parent.getActiveSheet().rows[i])||t.isNullOrUndefined(this.parent.getActiveSheet().rows[i].customHeight)?this.updateRowHeight(n,e.rowIdx,e.lastCell,e.onActionUpdate):n.parentElement.style.lineHeight=parseInt(n.parentElement.style.height,10)-1+"px"}else{if(this.isHeightCheckNeeded(e.style)){var s=n.cloneNode(!0);s.innerHTML||(s.textContent="Test"),this.row.appendChild(s)}if(e.lastCell&&this.row.childElementCount){var o=this.parent.getActiveSheet(),a=this.parent.getRow(e.rowIdx)||e.row,l=j(o,e.rowIdx),h=this.getRowHeightOnInit();h>l&&(a.style.height=h+"px",o.showHeaders&&((this.parent.getRow(e.rowIdx,this.parent.getRowHeaderTable())||e.hRow).style.height=h+"px"),U(o,e.rowIdx,h)),this.row.innerHTML=""}}}else this.updateRowHeight(n,e.rowIdx,!0,e.onActionUpdate)}},e.prototype.updateRowHeight=function(e,t,r,n){if(this.checkHeight&&r){this.checkHeight=!1;var i=this.parent.getActiveSheet(),s=this.parent.getRow(t);if(!s)return;e||(e=s.lastElementChild);var o=!1;s.style.height="",e.innerHTML||(e.textContent="test",o=!0);var a=Math.ceil(s.getBoundingClientRect().height);o&&(e.textContent=""),a=a<20?20:a;var l=j(i,t);(n?a!==l:a>l)?(s.style.height=a+"px",i.showHeaders&&(this.parent.getRow(t,this.parent.getRowHeaderTable()).style.height=a+"px"),U(i,t,a),this.parent.notify(wr,{rowIdx:t,threshold:a-l})):s.style.height=l+"px"}},e.prototype.isHeightCheckNeeded=function(e,t){var r=Object.keys(e);return(t?r.indexOf("fontSize")>-1:r.indexOf("fontSize")>-1&&Number(e.fontSize.split("pt")[0])>12)||r.indexOf("fontFamily")>-1},e.prototype.getRowHeightOnInit=function(){var e=this.parent.createElement("table",{className:"e-table e-test-table"});e.appendChild(this.parent.createElement("tbody")).appendChild(this.row),this.parent.element.appendChild(e);var t=Math.round(this.row.getBoundingClientRect().height);return this.parent.element.removeChild(e),t<20?20:t},e.prototype.addEventListener=function(){this.parent.on(He,this.applyCellFormat.bind(this))},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.on(He,this.applyCellFormat.bind(this))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null,this.row=null,this.checkHeight=null},e.prototype.getModuleName=function(){return"cellformat"},e}(),qr=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(Xt,this.wireEvents,this)},e.prototype.wireEvents=function(){var e=this.parent.getRowHeaderContent(),r=this.parent.getColumnHeaderContent();t.EventHandler.add(r,"dblclick",this.dblClickHandler,this),t.EventHandler.add(e,"dblclick",this.dblClickHandler,this),t.EventHandler.add(this.parent.getColumnHeaderContent(),"mousedown",this.mouseDownHandler,this),t.EventHandler.add(this.parent.getRowHeaderContent(),"mousedown",this.mouseDownHandler,this),this.wireResizeCursorEvent(e,r)},e.prototype.wireResizeCursorEvent=function(e,r){t.EventHandler.add(e,"mousemove",this.setTarget,this),t.EventHandler.add(r,"mousemove",this.setTarget,this)},e.prototype.unWireResizeCursorEvent=function(){t.EventHandler.remove(this.parent.getRowHeaderContent(),"mousemove",this.setTarget),t.EventHandler.remove(this.parent.getColumnHeaderContent(),"mousemove",this.setTarget)},e.prototype.unwireEvents=function(){t.EventHandler.remove(this.parent.getColumnHeaderContent(),"dblclick",this.dblClickHandler),t.EventHandler.remove(this.parent.getRowHeaderContent(),"dblclick",this.dblClickHandler),t.EventHandler.remove(this.parent.getColumnHeaderContent(),"mousedown",this.mouseDownHandler),t.EventHandler.remove(this.parent.getRowHeaderContent(),"mousedown",this.mouseDownHandler),this.unWireResizeCursorEvent()},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Xt,this.wireEvents)},e.prototype.mouseMoveHandler=function(e){var t=this.parent.element.getElementsByClassName("e-sheet-panel")[0],r=this.parent.element.getElementsByClassName("e-colresize-handler")[0],n=this.parent.element.getElementsByClassName("e-rowresize-handler")[0];(r||n)&&(r?e.x>this.trgtEle.parentElement.firstChild.getBoundingClientRect().left&&(r.style.left=e.clientX-this.parent.element.getBoundingClientRect().left+"px"):n&&e.y>=this.trgtEle.parentElement.parentElement.firstChild.getBoundingClientRect().top&&(n.style.top=e.clientY-t.getBoundingClientRect().top+"px"))},e.prototype.mouseDownHandler=function(e){this.event=e,this.trgtEle=e.target,this.updateTarget(e,this.trgtEle);var r=this.trgtEle,n=r.classList.contains("e-colresize")?"e-colresize-handler":r.classList.contains("e-rowresize")?"e-rowresize-handler":"";this.createResizeHandler(r,n),this.unWireResizeCursorEvent(),t.EventHandler.add(this.parent.element,"mousemove",this.mouseMoveHandler,this),t.EventHandler.add(document,"mouseup",this.mouseUpHandler,this)},e.prototype.mouseUpHandler=function(e){var r=this.parent.element.getElementsByClassName("e-colresize-handler")[0],n=this.parent.element.getElementsByClassName("e-rowresize-handler")[0];this.resizeOn(e);var i=r||n;i&&(this.parent.element.getElementsByClassName("e-sheet-panel")[0].removeChild(i),this.updateCursor(e)),t.EventHandler.remove(document,"mouseup",this.mouseUpHandler),t.EventHandler.remove(this.parent.element,"mousemove",this.mouseMoveHandler),this.wireResizeCursorEvent(this.parent.getRowHeaderContent(),this.parent.getColumnHeaderContent())},e.prototype.dblClickHandler=function(e){this.trgtEle=e.target,this.updateTarget(e,this.trgtEle);var t=this.trgtEle;if(t.classList.contains("e-colresize")||t.classList.contains("e-rowresize")){var r=parseInt(t.getAttribute("aria-colindex"),10)-1,n=parseInt(this.trgtEle.parentElement.getAttribute("aria-rowindex"),10)-1;t.classList.contains("e-colresize")?this.setAutofit(r,!0):t.classList.contains("e-rowresize")&&this.setAutofit(n,!1)}},e.prototype.setTarget=function(e){var r,n,i,s,o=e.target;if(t.closest(o,".e-header-row")?(i=e.offsetX,n=o.offsetWidth,s="e-colresize",t.isNullOrUndefined(o.previousElementSibling)||(r=o.previousElementSibling)):t.closest(o,".e-row")&&(i=e.offsetY,n=o.offsetHeight,s="e-rowresize",t.isNullOrUndefined(o.parentElement.previousElementSibling)||(r=o.parentElement.previousElementSibling.firstElementChild)),n-2<8&&i!==Math.ceil((n-2)/2))i<Math.ceil((n-2)/2)?(o.classList.add(s),r.classList.add(s)):i>Math.ceil((n-2)/2)&&o.classList.add(s);else if(n-5<i&&i<=n&&n>=10)o.classList.add(s);else if(i<5&&r&&n>=10)o.classList.add(s),r.classList.add(s);else for(var a="e-colresize"===s?o.parentElement.getElementsByClassName(s):this.parent.getRowHeaderTable().getElementsByClassName(s),l=0;l<a.length;l++)a[l].classList.remove(s)},e.prototype.updateTarget=function(e,r){t.closest(r,".e-header-row")?(r.offsetWidth<10&&e.offsetX<Math.ceil((r.offsetWidth-2)/2)||e.offsetX<5&&r.offsetWidth>=10&&r.classList.contains("e-colresize")&&r.previousElementSibling)&&(this.trgtEle=r.previousElementSibling):t.closest(r,".e-row")&&(r.offsetHeight<10&&e.offsetY<Math.ceil((r.offsetHeight-2)/2)||e.offsetY<5&&r.offsetHeight>=10&&r.classList.contains("e-rowresize")&&r.parentElement.previousElementSibling)&&(this.trgtEle=r.parentElement.previousElementSibling.getElementsByClassName("e-header-cell")[0])},e.prototype.setAutofit=function(e,t){var r,n=e;this.parent.scrollSettings.enableVirtualization&&(e=t?e-this.parent.viewport.leftIndex:e-this.parent.viewport.topIndex);var i,s=this.parent.getActiveSheet(),o=this.parent.getMainContent(),a=t?o.getElementsByTagName("col")[e].style.width:o.getElementsByTagName("tr")[e].style.height,l=t?this.parent.getColHeaderTable():this.parent.getRowHeaderTable(),h=o.getElementsByClassName("e-row"),p=[],c=o.getElementsByClassName("e-content-table")[0],u=l.getElementsByTagName("tr");if(t)for(i=u[0].getElementsByClassName("e-header-cell")[e].cloneNode(!0),r=0;r<h.length;r++)p[r]=h[r].getElementsByTagName("td")[e].cloneNode(!0);else for(i=u[e].getElementsByClassName("e-header-cell")[0].cloneNode(!0),r=0;r<h[e].getElementsByTagName("td").length;r++)p[r]=h[e].getElementsByTagName("td")[r].cloneNode(!0);var d=this.findMaxValue(l,[i],t),f=this.findMaxValue(c,p,t),m=d<f?f:d,g=parseInt(a,10)>m?-(parseInt(a,10)-m):m-parseInt(a,10);t?(q(s,e).width=m>0?m:0,this.parent.notify(Ir,{threshold:g,colIdx:n})):(U(s,e,m>0?m:0),this.parent.notify(wr,{threshold:g,rowIdx:n})),this.setResize(e,m+"px",t)},e.prototype.findMaxValue=function(e,t,r){var n=this.parent.createElement("div",{className:this.parent.element.className}),i=this.parent.createElement("table",{className:e.className+"e-resizetable",styles:"width: auto;height: auto"}),s=this.parent.createElement("tr");r?t.forEach(function(e){var t=s.cloneNode();t.appendChild(e),i.appendChild(t)}):(t.forEach(function(e){s.appendChild(e.cloneNode(!0))}),i.appendChild(s)),n.appendChild(i),document.body.appendChild(n);var o=i.getBoundingClientRect().width,a=i.getBoundingClientRect().height;return document.body.removeChild(n),r?Math.ceil(o):Math.ceil(a)},e.prototype.createResizeHandler=function(e,t){var r=this.parent.createElement("div",{className:t});e.classList.contains("e-colresize")?(r.style.height=this.parent.getMainContent().clientHeight+e.offsetHeight+"px",r.style.left=this.event.clientX-this.parent.element.getBoundingClientRect().left+"px",r.style.top="0px"):e.classList.contains("e-rowresize")&&(r.style.width=this.parent.getMainContent().clientWidth+e.offsetWidth+"px",r.style.left="0px",r.style.top=this.event.clientY-this.parent.element.getElementsByClassName("e-sheet-panel")[0].getBoundingClientRect().top+"px"),this.parent.element.getElementsByClassName("e-sheet-panel")[0].appendChild(r),this.updateCursor(this.event)},e.prototype.setColWidth=function(e,t){var r=this.parent.getActiveSheet(),n=parseInt(this.parent.getMainContent().getElementsByTagName("col")[e].style.width,10),i=t,s=parseInt(i,10)-n;s<0&&n<-s&&(s=-n);var o=parseInt(this.trgtEle.getAttribute("aria-colindex"),10)-1;this.parent.notify(Ir,{threshold:s,colIdx:o}),this.setResize(e,i,!0),q(r,e).width=parseInt(i,10)>0?parseInt(i,10):0,r.columns[e].customWidth=!0,this.parent.setProperties({sheets:this.parent.sheets},!0)},e.prototype.setRowHeight=function(e,t){var r=parseInt(this.parent.getMainContent().getElementsByTagName("tr")[e].style.height,10),n=t,i=parseInt(n,10)-r;i<0&&r<-i&&(i=-r);var s=parseInt(this.trgtEle.parentElement.getAttribute("aria-rowindex"),10)-1;this.parent.notify(wr,{threshold:i,rowIdx:s}),this.setResize(e,n,!1),U(this.parent.getActiveSheet(),e,parseInt(n,10)>0?parseInt(n,10):0),this.parent.getActiveSheet().rows[e].customHeight=!0,this.parent.setProperties({sheets:this.parent.sheets},!0)},e.prototype.resizeOn=function(e){var t;if(this.trgtEle.classList.contains("e-rowresize")){t=parseInt(this.trgtEle.parentElement.getAttribute("aria-rowindex"),10)-1,this.parent.scrollSettings.enableVirtualization&&(t-=this.parent.viewport.topIndex);var r=e.clientY-this.event.clientY+parseInt(this.parent.getMainContent().getElementsByClassName("e-row")[t].style.height,10)+"px";this.setRowHeight(t,r)}else if(this.trgtEle.classList.contains("e-colresize")){t=parseInt(this.trgtEle.getAttribute("aria-colindex"),10)-1,this.parent.scrollSettings.enableVirtualization&&(t-=this.parent.viewport.leftIndex);var n=e.clientX-this.event.clientX+parseInt(this.parent.getMainContent().getElementsByTagName("col")[t].style.width,10)+"px";this.setColWidth(t,n)}},e.prototype.setWidthAndHeight=function(e,t,r){r?e.style.width=parseInt(e.style.width,10)+t+"px":e.style.height=parseInt(e.style.height,10)+t+"px"},e.prototype.setResize=function(e,t,r){var n,i,s,o,a,l,h,p;this.parent.getActiveSheet();if(r)n=this.parent.element.getElementsByClassName("e-column-header")[0].getElementsByTagName("th")[e],i=this.parent.element.getElementsByClassName("e-column-header")[0].getElementsByTagName("col")[e],s=this.parent.element.getElementsByClassName("e-main-content")[0].getElementsByTagName("col")[e];else{n=this.parent.element.getElementsByClassName("e-row-header")[0].getElementsByTagName("tr")[e],i=this.parent.element.getElementsByClassName("e-row-header")[0].getElementsByTagName("tr")[e],s=this.parent.element.getElementsByClassName("e-main-content")[0].getElementsByTagName("tr")[e],i.style.height=parseInt(t,10)>0?t:"2px",s.style.height=parseInt(t,10)>0?t:"0px";var c=this.parent.getRowHeaderContent().getElementsByClassName("e-row"),u=[];u[0]=c[e].getElementsByTagName("td")[0].cloneNode(!0);for(var d=this.findMaxValue(this.parent.getRowHeaderTable(),u,!1)+1,f=this.parent.getMainContent().getElementsByClassName("e-row"),m=[],g=0;g<f[e].getElementsByTagName("td").length;g++)m[g]=f[e].getElementsByTagName("td")[g].cloneNode(!0);var y=this.findMaxValue(this.parent.getContentTable(),m,!1)+1,v=d>=y?d:y;parseInt(s.style.height,10)<v||n.classList.contains("e-reach-fntsize")&&parseInt(s.style.height,10)===v?(n.classList.add("e-reach-fntsize"),i.style.lineHeight=parseInt(t,10)>=4?parseInt(t,10)-4+"px":parseInt(t,10)>0?parseInt(t,10)-1+"px":"0px",s.style.lineHeight=parseInt(t,10)>0?parseInt(t,10)-1+"px":"0px"):(i.style.removeProperty("line-height"),s.style.removeProperty("line-height"),n.classList.contains("e-reach-fntsize")&&n.classList.remove("e-reach-fntsize"))}if(o=n.previousElementSibling,h=n.nextElementSibling,o&&(o=n.previousElementSibling,a=i.previousElementSibling,l=s.previousElementSibling),h&&(h=n.nextElementSibling,p=i.nextElementSibling,s.nextElementSibling),parseInt(t,10)<=0&&!n.classList.contains("e-zero")&&!n.classList.contains("e-zero-start")){if(o&&h)if(r?(i.style.width="2px",s.style.width="0px"):(i.style.height="2px",s.style.height="0px"),o.classList.contains("e-zero-start")?(n.classList.add("e-zero-start"),s.classList.add("e-zero-start")):(n.classList.add("e-zero"),s.classList.add("e-zero")),h.classList.contains("e-zero")||h.classList.contains("e-zero-last")||(n.classList.add("e-zero-last"),s.classList.add("e-zero-last")),o.classList.contains("e-zero-last")&&(o.classList.remove("e-zero-last"),l.classList.remove("e-zero-last")),o.classList.contains("e-zero")?(n.classList.contains("e-zero-end"),this.setWidthAndHeight(a,-2,r)):this.setWidthAndHeight(a,-1,r),o.classList.contains("e-zero-start")&&this.setWidthAndHeight(i,-1,r),h.classList.contains("e-zero"))if(n.classList.contains("e-zero-start"))for(;h;){if(h.classList.contains("e-zero")&&0!==parseInt(p.style.height,10)&&!r||0!==parseInt(p.style.width,10)&&r){r?(i.style.width=parseInt(i.style.width,10)-1+"px",p.style.width=parseInt(p.style.width,10)-1+"px"):(i.style.height=parseInt(i.style.height,10)-1+"px",p.style.height=parseInt(p.style.height,10)-1+"px"),h.classList.remove("e-zero"),h.classList.add("e-zero-start");break}var C=void 0;h.classList.remove("e-zero"),h.classList.add("e-zero-start"),r?(C=parseInt(h.getAttribute("aria-colindex"),10)-1,h=this.parent.getColHeaderTable().getElementsByTagName("th")[C+1],p=this.parent.getColHeaderTable().getElementsByTagName("col")[C+1]):(C=parseInt(h.getAttribute("aria-rowindex"),10)-1,h=this.parent.getRowHeaderTable().getElementsByTagName("tr")[C+1],p=this.parent.getRowHeaderTable().getElementsByTagName("tr")[C+1])}else this.setWidthAndHeight(i,-2,r);else h.classList.contains("e-zero-end")?r?i.style.width="0px":i.style.height="0px":this.setWidthAndHeight(p,-1,r);else if(o)r?(i.style.width="1px",s.style.width="0px"):(i.style.height="1px",s.style.height="0px"),n.classList.add("e-zero-end"),s.classList.add("e-zero-end"),n.classList.add("e-zero-last"),s.classList.add("e-zero-last"),o.classList.contains("e-zero")?this.setWidthAndHeight(a,-2,r):this.setWidthAndHeight(a,-1,r);else if(h)if(n.classList.add("e-zero-start"),s.classList.add("e-zero-start"),h.classList.contains("e-zero")||(n.classList.add("e-zero-last"),s.classList.add("e-zero-last")),r?(i.style.width="1px",s.style.width="0px"):(i.style.height="1px",s.style.height="0px"),h.classList.contains("e-zero"))for(;h;){if(h.classList.contains("e-zero")&&0!==parseInt(p.style.width,10)&&r||0!==parseInt(p.style.height,10)&&!r){r?(p.style.width=parseInt(p.style.width,10)-1+"px",i.style.width=parseInt(i.style.width,10)-1+"px"):(p.style.height=parseInt(p.style.height,10)-1+"px",i.style.height=parseInt(i.style.height,10)-1+"px"),h.classList.add("e-zero-start"),h.classList.remove("e-zero");break}C=void 0;h.classList.add("e-zero-start"),h.classList.remove("e-zero"),r?(C=parseInt(h.getAttribute("aria-colindex"),10)-1,p=this.parent.getColHeaderTable().getElementsByTagName("col")[C+1],h=this.parent.getColHeaderTable().getElementsByTagName("th")[C+1]):(C=parseInt(h.getAttribute("aria-rowindex"),10)-1,p=this.parent.getRowHeaderTable().getElementsByTagName("tr")[C+1],h=this.parent.getRowHeaderTable().getElementsByTagName("tr")[C+1])}else this.setWidthAndHeight(p,-1,r)}else parseInt(t,10)>0&&(r?(i.style.width=t,s.style.width=t):(i.style.height=t,s.style.height=t),o&&h?(o.classList.contains("e-zero")?n.classList.contains("e-zero")?r?(a.style.width=parseInt(a.style.width,10)+2+"px",i.style.width=parseInt(i.style.width,10)-1+"px"):(a.style.height=parseInt(a.style.height,10)+2+"px",i.style.height=parseInt(i.style.height,10)-1+"px"):this.setWidthAndHeight(i,-1,r):n.classList.contains("e-zero")?this.setWidthAndHeight(a,1,r):n.classList.contains("e-zero-start")&&(r?(a.style.width=parseInt(a.style.width,10)+1+"px",i.style.width=parseInt(i.style.width,10)-1+"px"):(a.style.height=parseInt(a.style.height,10)+1+"px",i.style.height=parseInt(i.style.height,10)-1+"px")),h.classList.contains("e-zero")?this.setWidthAndHeight(i,-1,r):(n.classList.contains("e-zero")||n.classList.contains("e-zero-start"))&&this.setWidthAndHeight(p,1,r),n.classList.contains("e-zero")&&n.classList.remove("e-zero"),n.classList.contains("e-zero-start")&&n.classList.remove("e-zero-start"),s.classList.contains("e-zero")&&s.classList.remove("e-zero"),s.classList.contains("e-zero-start")&&s.classList.remove("e-zero-start"),n.classList.contains("e-zero-last")&&n.classList.remove("e-zero-last"),s.classList.contains("e-zero-last")&&s.classList.remove("e-zero-last"),(o.classList.contains("e-zero")||o.classList.contains("e-zero-start"))&&(o.classList.add("e-zero-last"),l.classList.add("e-zero-last"))):o?(o.classList.contains("e-zero")?n.classList.contains("e-zero")?r?(i.style.width=parseInt(i.style.width,10)-1+"px",a.style.width=parseInt(a.style.width,10)+2+"px"):(i.style.height=parseInt(i.style.height,10)-1+"px",a.style.height=parseInt(a.style.height,10)+2+"px"):this.setWidthAndHeight(i,-1,r):n.classList.contains("e-zero")?this.setWidthAndHeight(a,1,r):this.setWidthAndHeight(i,-1,r),n.classList.contains("e-zero")&&n.classList.remove("e-zero"),n.classList.contains("e-zero-end")&&n.classList.remove("e-zero-end"),s.classList.contains("e-zero")&&s.classList.remove("e-zero"),s.classList.contains("e-zero-end")&&s.classList.remove("e-zero-end")):h&&(h.classList.contains("e-zero")?this.setWidthAndHeight(i,-1,r):n.classList.contains("e-zero-start")&&(this.setWidthAndHeight(p,1,r),n.classList.remove("e-zero-start")),n.classList.contains("e-zero")&&n.classList.remove("e-zero"),s.classList.contains("e-zero")&&s.classList.remove("e-zero"),n.classList.contains("e-zero-start")&&n.classList.remove("e-zero-start"),s.classList.contains("e-zero-start")&&s.classList.remove("e-zero-start")))},e.prototype.updateCursor=function(e){this.parent.element.getElementsByClassName("e-colresize-handler")[0]?this.parent.element.classList.add("e-col-resizing"):this.parent.element.classList.contains("e-col-resizing")&&this.parent.element.classList.remove("e-col-resizing"),this.parent.element.getElementsByClassName("e-rowresize-handler")[0]?this.parent.element.classList.add("e-row-resizing"):this.parent.element.classList.contains("e-row-resizing")&&this.parent.element.classList.remove("e-row-resizing")},e.prototype.destroy=function(){this.unwireEvents(),this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"resize"},e}(),Wr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Gr=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},Kr=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Wr(r,e),Gr([t.Complex({},n.Header)],r.prototype,"header",void 0),Gr([t.Collection([],n.Item)],r.prototype,"content",void 0),Gr([t.Property({})],r.prototype,"cssClass",void 0),Gr([t.Property(!1)],r.prototype,"disabled",void 0),Gr([t.Property("Tab")],r.prototype,"type",void 0),Gr([t.Collection([],n.MenuItem)],r.prototype,"menuItems",void 0),r}(t.ChildProperty),Xr=function(e){function r(t,r){return e.call(this,t)||this}return Wr(r,e),r.prototype.preRender=function(){},r.prototype.render=function(){this.renderRibbon()},r.prototype.destroy=function(){this.destroyComponent(this.element.querySelector(".e-file-menu"),n.Menu);var t=this.tabObj.element.querySelector(".e-drop-icon");t&&t.removeEventListener("click",this.ribbonExpandCollapse.bind(this)),this.toolbarObj.destroy(),this.tabObj.destroy(),e.prototype.destroy.call(this)},r.prototype.getTabItems=function(){var e=this,t=[];return this.items.forEach(function(r){switch(r.type){case"Menu":t.push({header:{text:e.initMenu(r.menuItems)},content:e.toolbarObj.element});break;case"Tab":t.push({header:r.header,content:e.toolbarObj.element})}}),t},r.prototype.initMenu=function(e){var r=this,i=this.createElement("ul");this.element.appendChild(i);var s=new n.Menu({cssClass:"e-file-menu",items:e,showItemOnClick:!0,beforeOpen:function(t){t.parentItem.text===e[0].text&&(s.showItemOnClick=!1),r.trigger("beforeOpen",t)},select:function(e){r.trigger("fileItemSelect",e)},beforeClose:function(n){"mouseover"!==n.event.type||t.closest(n.event.target,".e-menu-popup")?(r.trigger("beforeClose",n),n.parentItem&&n.parentItem.text!==e[0].text||requestAnimationFrame(function(){return s.setProperties({showItemOnClick:!0},!0)})):n.cancel=!0},beforeItemRender:function(e){r.trigger("beforeFileItemRender",e)}});return s.createElement=this.createElement,s.appendTo(i),i.parentElement},r.prototype.renderRibbon=function(){var e=this,r=this.createElement("div"),i=this.createElement("div");this.toolbarObj=new n.Toolbar({clicked:function(t){e.trigger("clicked",t)}}),this.toolbarObj.createElement=this.createElement,this.toolbarObj.appendTo(i),this.tabObj=new n.Tab({selectedItem:1,animation:{next:{duration:0},previous:{duration:0}},items:this.getTabItems(),selecting:function(r){"Menu"===e.items[r.selectingIndex].type?r.cancel=!0:(e.toolbarObj.items=e.items[r.selectingIndex].content,e.toolbarObj.dataBind(),e.element.classList.contains("e-collapsed")&&t.EventHandler.remove(r.selectedItem,"click",e.ribbonExpandCollapse)),e.trigger("selecting",r)},selected:function(){e.element.classList.contains("e-collapsed")&&(e.element.classList.remove("e-collapsed"),e.trigger("expandCollapse",{element:e.toolbarObj.element,expanded:!0}))},created:function(){var t=e.createElement("span",{className:"e-drop-icon e-icons"});t.addEventListener("click",e.ribbonExpandCollapse.bind(e)),e.tabObj.element.querySelector(".e-tab-header").appendChild(t),e.toolbarObj.refreshOverflow()}}),this.element.appendChild(r),this.tabObj.createElement=this.createElement,this.tabObj.appendTo(r)},r.prototype.ribbonExpandCollapse=function(e){var r,n={element:this.toolbarObj.element,expanded:!0};this.element.classList.contains("e-collapsed")?(r=this.tabObj.element.querySelector(".e-tab-header").getElementsByClassName("e-toolbar-item")[this.tabObj.selectedItem],this.element.classList.remove("e-collapsed"),r.classList.add("e-active"),t.EventHandler.remove(r,"click",this.ribbonExpandCollapse),this.trigger("expandCollapse",n)):(r=this.tabObj.element.querySelector(".e-tab-header .e-toolbar-item.e-active"),this.element.classList.add("e-collapsed"),n.expanded=!1,r.classList.remove("e-active"),t.EventHandler.add(r,"click",this.ribbonExpandCollapse,this),this.trigger("expandCollapse",n))},r.prototype.enableItems=function(e,t){t?this.toolbarObj.enableItems(t,e):this.toolbarObj.disable(!e)},r.prototype.getModuleName=function(){return"ribbon"},r.prototype.getPersistData=function(){return this.addOnPersist([])},r.prototype.onPropertyChanged=function(e,t){},r.prototype.destroyComponent=function(e,r){if(e){var n=t.getComponent(e,r);n&&n.destroy()}},Gr([t.Property("")],r.prototype,"cssClass",void 0),Gr([t.Collection([],Kr)],r.prototype,"items",void 0),Gr([t.Event()],r.prototype,"selecting",void 0),Gr([t.Event()],r.prototype,"fileItemSelect",void 0),Gr([t.Event()],r.prototype,"beforeFileItemRender",void 0),Gr([t.Event()],r.prototype,"beforeOpen",void 0),Gr([t.Event()],r.prototype,"beforeClose",void 0),Gr([t.Event()],r.prototype,"selectFormat",void 0),Gr([t.Event()],r.prototype,"clicked",void 0),Gr([t.Event()],r.prototype,"created",void 0),Gr([t.Event()],r.prototype,"expandCollapse",void 0),r=Gr([t.NotifyPropertyChanges],r)}(t.Component),Yr=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.render=function(){var e=this,r=this.parent.element.id,n=this.parent.createElement("input",{attrs:{type:"color"}}),i=new a.ColorPicker({value:"#000000ff",mode:"Palette",showButtons:!1,presetColors:fn,enableOpacity:!1,beforeClose:function(t){return e.beforeCloseHandler(i)},open:this.openHandler.bind(this),beforeModeSwitch:function(t){return e.beforeModeSwitch(i,t)},change:function(t){var r=i.getValue(t.currentValue.rgba);e.updateSelectedColor(r,i.element),e.parent.cellFormat({color:r}),e.parent.element.focus()},created:function(){return e.wireFocusEvent(i.element,"#000000")}});i.createElement=this.parent.createElement,this.parent.element.appendChild(n),i.appendTo(n),n.parentElement.id=r+"_font_color_picker",t.addClass([n.nextElementSibling.getElementsByClassName("e-selected-color")[0]],["e-icons","e-font-color"]),n=this.parent.createElement("input",{attrs:{type:"color"}});var s=new a.ColorPicker({value:"#ffff00ff",mode:"Palette",presetColors:mn,showButtons:!1,enableOpacity:!1,open:this.openHandler.bind(this),beforeClose:function(t){return e.beforeCloseHandler(s)},beforeModeSwitch:function(t){return e.beforeModeSwitch(s,t)},change:function(t){var r=s.getValue(t.currentValue.rgba);e.updateSelectedColor(r,s.element),e.parent.cellFormat({backgroundColor:r}),e.parent.element.focus()},created:function(){return e.wireFocusEvent(s.element,"#ffff00")}});s.createElement=this.parent.createElement,this.parent.element.appendChild(n),s.appendTo(n),n.parentElement.id=r+"_fill_color_picker",t.addClass([n.nextElementSibling.getElementsByClassName("e-selected-color")[0]],["e-icons","e-fill-color"])},e.prototype.updateSelectedColor=function(e,t){t.nextElementSibling.querySelector(".e-selected-color").style.borderBottomColor=e},e.prototype.wireFocusEvent=function(e,t){var r=this;this.updateSelectedColor(t,e),(e=e.parentElement.querySelector(".e-split-colorpicker")).addEventListener("focus",function(){r.parent.element.focus()})},e.prototype.openHandler=function(e){e.element.querySelector(".e-mode-switch-btn").title=this.parent.serviceLocator.getService(un).getConstant("MoreColors")},e.prototype.beforeCloseHandler=function(e){e.modeSwitcher||e.setProperties({modeSwitcher:!0},!0),e.showButtons&&e.setProperties({showButtons:!1},!0)},e.prototype.beforeModeSwitch=function(e,t){var r=this.parent.serviceLocator.getService(un);"Picker"===t.mode?(e.showButtons=!0,e.dataBind(),t.element.querySelector(".e-apply").title=r.getConstant("Apply"),t.element.querySelector(".e-cancel").title=r.getConstant("Cancel"),t.element.querySelector(".e-mode-switch-btn").title=r.getConstant("StandardColors")):(e.showButtons=!1,e.dataBind(),t.element.querySelector(".e-mode-switch-btn").title=r.getConstant("MoreColors"))},e.prototype.destroy=function(){this.removeEventListener();var e=this.parent.element.id;this.destroyColorPicker(e+"_font_color_picker"),this.destroyColorPicker(e+"_fill_color_picker"),this.parent=null},e.prototype.destroyColorPicker=function(e){var t=document.getElementById(e);t&&we(t.firstElementChild,a.ColorPicker)},e.prototype.addEventListener=function(){this.parent.on(xr,this.render,this),this.parent.on($t,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(xr,this.render),this.parent.off($t,this.destroy))},e}(),$r=function(){function e(e){this.fontNameIndex=5,this.numPopupWidth=0,this.activeTab=1,this.parent=e,this.addEventListener(),new Yr(e)}return e.prototype.getModuleName=function(){return"ribbon"},e.prototype.initRibbon=function(e){this.parent.showRibbon||!this.ribbon?(this.parent.notify(xr,{}),this.parent.isMobileView()?this.createMobileView():this.createRibbon(e)):this.destroy()},e.prototype.getRibbonItems=function(){var e=this.parent.element.id,t=this.parent.serviceLocator.getService(un),r=[{type:"Menu",menuItems:[{text:this.parent.isMobileView()?"":t.getConstant("File"),iconCss:this.parent.isMobileView()?"e-icons e-file-menu-icon":null,items:[{text:t.getConstant("New"),id:"New",iconCss:"e-new e-icons"},{text:t.getConstant("Open"),id:"Open",iconCss:"e-open e-icons"},{text:t.getConstant("SaveAs"),iconCss:"e-save e-icons",items:[{text:t.getConstant("ExcelXlsx"),id:"Xlsx",iconCss:"e-xlsx e-icons"},{text:t.getConstant("ExcelXls"),id:"Xls",iconCss:"e-xls e-icons"},{text:t.getConstant("CSV"),id:"Csv",iconCss:"e-csv e-icons"}]}]}]},{header:{text:t.getConstant("Home")},content:[{prefixIcon:"e-cut-icon",tooltipText:t.getConstant("Cut")+" (Ctrl+X)",id:e+"_cut"},{prefixIcon:"e-copy-icon",tooltipText:t.getConstant("Copy")+" (Ctrl+C)",id:e+"_copy"},{tooltipText:t.getConstant("Paste")+" (Ctrl+V)",template:this.getPasteBtn(e)},{type:"Separator"},{template:this.getNumFormatDDB(e),tooltipText:t.getConstant("NumberFormat")},{type:"Separator"},{template:this.getFontNameDDB(e),tooltipText:t.getConstant("Font")},{type:"Separator"},{template:this.getFontSizeDDB(e),tooltipText:t.getConstant("FontSize")},{type:"Separator"},{template:this.getBtn(e,"bold"),tooltipText:t.getConstant("Bold")+" (Ctrl+B)"},{template:this.getBtn(e,"italic"),tooltipText:t.getConstant("Italic")+" (Ctrl+I)"},{template:this.getBtn(e,"line-through"),tooltipText:t.getConstant("Strikethrough")+" (Ctrl+5)"},{template:this.getBtn(e,"underline"),tooltipText:t.getConstant("Underline")+" (Ctrl+U)"},{template:document.getElementById(e+"_font_color_picker"),tooltipText:t.getConstant("TextColor")},{type:"Separator"},{template:document.getElementById(e+"_fill_color_picker"),tooltipText:t.getConstant("FillColor")},{type:"Separator"},{template:this.getTextAlignDDB(e),tooltipText:t.getConstant("HorizontalAlignment")},{template:this.getVerticalAlignDDB(e),tooltipText:t.getConstant("VerticalAlignment")}]},{header:{text:t.getConstant("Formulas")},content:[{prefixIcon:"e-insert-function",text:t.getConstant("InsertFunction"),id:e+"_insert_function"}]},{header:{text:"View"},content:[{prefixIcon:"e-hide-headers",text:this.getLocaleText(t,"Headers"),id:e+"_headers"},{type:"Separator"},{prefixIcon:"e-hide-gridlines",text:this.getLocaleText(t,"GridLines"),id:e+"_gridlines"}]}];return this.parent.allowSorting&&r.find(function(e){return e.header&&e.header.text===t.getConstant("Home")}).content.push({type:"Separator"},{template:this.getSortingDDB(e),tooltipText:t.getConstant("Sort")}),r},e.prototype.getPasteBtn=function(e){var t=this,r=this.parent.element.appendChild(this.parent.createElement("button",{id:e+"_paste"})),n=this.parent.serviceLocator.getService(un),s=new i.SplitButton({iconCss:"e-icons e-paste-icon",items:[{text:n.getConstant("All"),id:"All"},{text:n.getConstant("Values"),id:"Values"},{text:n.getConstant("Formats"),id:"Formats"}],select:function(e){t.parent.notify(vr,{type:e.item.id})},click:function(){t.parent.notify(vr,null)},close:function(){t.parent.element.focus()}});return s.createElement=this.parent.createElement,s.appendTo(r),r.parentElement},e.prototype.getLocaleText=function(e,t,r){var n;return this.parent.getActiveSheet()["show"+t]?(r&&this.parent.getMainContent().classList.remove("e-hide-"+t.toLowerCase()),n=e.getConstant("Hide"+t)):(r&&this.parent.getMainContent().classList.add("e-hide-"+t.toLowerCase()),n=e.getConstant("Show"+t)),n},e.prototype.createRibbon=function(e){var t=this.parent.createElement("div");if(this.ribbon=new Xr({items:this.getRibbonItems(),fileItemSelect:this.fileItemSelect.bind(this),beforeOpen:this.fileMenuBeforeOpen.bind(this),beforeClose:this.fileMenuBeforeClose.bind(this),clicked:this.toolbarClicked.bind(this),created:this.ribbonCreated.bind(this),selecting:this.tabSelecting.bind(this),expandCollapse:this.expandCollapseHandler.bind(this),beforeFileItemRender:this.beforeRenderHandler.bind(this)}),this.ribbon.createElement=this.parent.createElement,e&&e.uiUpdate){var r=this.parent.element.querySelector(".e-formula-bar-panel")||document.getElementById(this.parent.element.id+"_sheet_panel");this.parent.element.insertBefore(t,r)}else this.parent.element.appendChild(t);this.ribbon.appendTo(t)},e.prototype.tabSelecting=function(e){e.selectingIndex&&e.selectingIndex!==this.activeTab&&(this.activeTab=e.selectingIndex,this.refreshRibbonContent(),this.parent.notify(gr,{idx:e.selectingIndex}))},e.prototype.beforeRenderHandler=function(e){var t=this.parent.serviceLocator.getService(un);e.item.text!==t.getConstant("Open")||this.parent.openUrl&&this.parent.allowOpen||e.element.classList.add("e-disabled"),e.item.text!==t.getConstant("SaveAs")||this.parent.saveUrl&&this.parent.allowSave||e.element.classList.add("e-disabled")},e.prototype.getNumFormatDDB=function(e){var t=this,r=this.parent.createElement("button",{id:e+"_number_format"});return r.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text",innerHTML:"General"})),this.numFormatDDB=new i.DropDownButton({items:this.getNumFormatDdbItems(e),content:"",select:function(e){return t.numDDBSelect(e)},open:function(e){return t.numDDBOpen(e)},beforeItemRender:function(e){return t.previewNumFormat(e)},close:function(){return t.parent.element.focus()},cssClass:"e-flat e-numformat-ddb",beforeOpen:this.tBarDdbBeforeOpen.bind(this)}),this.numFormatDDB.createElement=this.parent.createElement,this.numFormatDDB.appendTo(r),r},e.prototype.getFontSizeDDB=function(e){var t=this;return this.fontSizeDdb=new i.DropDownButton({cssClass:"e-font-size-ddb",content:"11",items:[{text:"8"},{text:"9"},{text:"10"},{text:"11"},{text:"12"},{text:"14"},{text:"16"},{text:"18"},{text:"20"},{text:"22"},{text:"24"},{text:"26"},{text:"28"},{text:"36"},{text:"48"},{text:"72"}],beforeOpen:function(e){t.tBarDdbBeforeOpen(e),t.refreshSelected(t.fontSizeDdb,e.element,"content","text")},select:function(e){t.fontSizeDdb.content=e.item.text,t.fontSizeDdb.dataBind(),t.parent.notify(Re,{style:{fontSize:e.item.text+"pt"},onActionUpdate:!0})},close:function(){return t.parent.element.focus()}}),this.fontSizeDdb.createElement=this.parent.createElement,this.fontSizeDdb.appendTo(this.parent.createElement("button",{id:e+"_font_size"})),this.fontSizeDdb.element},e.prototype.getFontNameDDB=function(e){var t=this,r=this.parent.createElement("button",{id:e+"_font_name"});return r.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text",innerHTML:"Calibri"})),this.fontNameDdb=new i.DropDownButton({cssClass:"e-font-family",items:this.getFontFamilyItems(),select:function(e){t.refreshFontNameSelection(e.item.text),t.parent.notify(Re,{style:{fontFamily:e.item.text},onActionUpdate:!0})},close:function(){return t.parent.element.focus()},beforeOpen:this.tBarDdbBeforeOpen.bind(this)}),this.fontNameDdb.createElement=this.parent.createElement,this.fontNameDdb.appendTo(r),r},e.prototype.getBtn=function(e,t){var r=new o.Button({iconCss:"e-icons e-"+t+"-icon",isToggle:!0});return r.createElement=this.parent.createElement,r.appendTo(this.parent.createElement("button",{id:e+"_"+t})),r.element.addEventListener("click",this.toggleBtnClicked.bind(this)),r.element},e.prototype.getTextAlignDDB=function(e){var t=this;return this.textAlignDdb=new i.DropDownButton({cssClass:"e-align-ddb",iconCss:"e-icons e-left-icon",items:[{iconCss:"e-icons e-left-icon"},{iconCss:"e-icons e-center-icon"},{iconCss:"e-icons e-right-icon"}],beforeItemRender:this.alignItemRender.bind(this),beforeOpen:function(e){t.refreshSelected(t.textAlignDdb,e.element,"iconCss")},select:function(e){t.textAlignDdb.iconCss=e.item.iconCss,t.textAlignDdb.dataBind(),t.parent.notify(Re,{style:{textAlign:e.item.iconCss.split(" e-")[1].split("-icon")[0]},onActionUpdate:!0})},close:function(){return t.parent.element.focus()}}),this.textAlignDdb.createElement=this.parent.createElement,this.textAlignDdb.appendTo(this.parent.createElement("button",{id:e+"_text_align"})),this.textAlignDdb.element},e.prototype.getVerticalAlignDDB=function(e){var t=this;return this.verticalAlignDdb=new i.DropDownButton({cssClass:"e-align-ddb",iconCss:"e-icons e-bottom-icon",items:[{iconCss:"e-icons e-top-icon"},{iconCss:"e-icons e-middle-icon"},{iconCss:"e-icons e-bottom-icon"}],beforeItemRender:this.alignItemRender.bind(this),beforeOpen:function(e){t.refreshSelected(t.verticalAlignDdb,e.element,"iconCss")},select:function(e){t.verticalAlignDdb.iconCss=e.item.iconCss,t.verticalAlignDdb.dataBind(),t.parent.notify(Re,{style:{verticalAlign:e.item.iconCss.split(" e-")[1].split("-icon")[0]},onActionUpdate:!0})},close:function(){return t.parent.element.focus()}}),this.verticalAlignDdb.createElement=this.parent.createElement,this.verticalAlignDdb.appendTo(this.parent.createElement("button",{id:e+"_vertical_align"})),this.verticalAlignDdb.element},e.prototype.getSortingDDB=function(e){var t=this,r=this.parent.serviceLocator.getService(un);return this.sortingDdb=new i.DropDownButton({cssClass:"e-sort-ddb",iconCss:"e-icons e-sort-icon",items:[{text:r.getConstant("SortAscending"),iconCss:"e-icons e-sort-asc"},{text:r.getConstant("SortDescending"),iconCss:"e-icons e-sort-desc"},{text:r.getConstant("CustomSort")+"...",iconCss:"e-icons e-sort-custom"}],beforeOpen:function(e){t.refreshSelected(t.sortingDdb,e.element,"iconCss")},select:function(e){if(e.item.text===r.getConstant("CustomSort")+"...")t.parent.notify(Or,null);else{var n=e.item.text===r.getConstant("SortAscending")?"Ascending":"Descending";t.sortingDdb.iconCss=e.item.iconCss,t.sortingDdb.dataBind(),t.parent.sort({sortDescriptors:{order:n}})}},close:function(){return t.parent.element.focus()}}),this.sortingDdb.createElement=this.parent.createElement,this.sortingDdb.appendTo(this.parent.createElement("button",{id:e+"_sorting"})),this.sortingDdb.element},e.prototype.ribbonCreated=function(){this.parent.enableClipboard&&this.enableRibbonItems({id:this.parent.element.id+"_paste",isEnable:!1}),this.ribbon.element.querySelector(".e-drop-icon").title=this.parent.serviceLocator.getService(un).getConstant("CollapseToolbar")},e.prototype.alignItemRender=function(e){var t=e.item.iconCss.split(" e-")[1].split("-icon")[0];t=t[0].toUpperCase()+t.slice(1,t.length),e.element.title=this.parent.serviceLocator.getService(un).getConstant("Align"+t)},e.prototype.toggleBtnClicked=function(e){var r,n,i=t.closest(e.target,".e-btn"),s=this.parent.element.id,o=i.id,a=Re;switch(o){case s+"_bold":r={fontWeight:"normal"},n={fontWeight:"bold"};break;case s+"_italic":r={fontStyle:"normal"},n={fontStyle:"italic"};break;case s+"_line-through":a=Le,n=r={textDecoration:"line-through"};break;case s+"_underline":a=Le,n=r={textDecoration:"underline"}}i.classList.contains("e-active")?this.parent.notify(a,{style:n,onActionUpdate:!0}):this.parent.notify(a,{style:r,onActionUpdate:!0}),this.parent.element.focus()},e.prototype.getCellStyleValue=function(e,t){var r=_(t[0],t[1],this.parent.getActiveSheet()),n=this.parent.cellStyle[e];return r&&r.style&&r.style[e]&&(n=r.style[e]),n},e.prototype.refreshSelected=function(e,t,r,n){void 0===n&&(n=r);for(var i=0;i<e.items.length;i++)if(e.items[i][n]===e[r]){t.children[i].classList.add("e-selected");break}},e.prototype.expandCollapseHandler=function(e){var t=this.ribbon.element.querySelector(".e-drop-icon"),r=this.parent.serviceLocator.getService(un);e.expanded?t.title=r.getConstant("CollapseToolbar"):t.title=r.getConstant("ExpandToolbar"),this.parent.setPanelSize()},e.prototype.getNumFormatDdbItems=function(e){var t=this.parent.serviceLocator.getService(un);return[{id:e+"item1",text:t.getConstant("General")},{id:e+"item2",text:t.getConstant("Number")},{id:e+"item3",text:t.getConstant("Currency")},{id:e+"item4",text:t.getConstant("Accounting")},{id:e+"item5",text:t.getConstant("ShortDate")},{id:e+"item6",text:t.getConstant("LongDate")},{id:e+"item7",text:t.getConstant("Time")},{id:e+"item8",text:t.getConstant("Percentage")},{id:e+"item9",text:t.getConstant("Fraction")},{id:e+"item10",text:t.getConstant("Scientific")},{id:e+"item11",text:t.getConstant("Text")}]},e.prototype.getFontFamilyItems=function(){return[{text:"Arial"},{text:"Arial Black"},{text:"Axettac Demo"},{text:"Batang"},{text:"Book Antiqua"},{text:"Calibri",iconCss:"e-icons e-selected-icon"},{text:"Courier"},{text:"Courier New"},{text:"Din Condensed"},{text:"Georgia"},{text:"Helvetica"},{text:"Helvetica New"},{text:"Roboto"},{text:"Tahoma"},{text:"Times New Roman"},{text:"Verdana"}]},e.prototype.enableToolbar=function(e){this.ribbon.enableItems(e.enable)},e.prototype.numDDBSelect=function(e){this.parent.notify(ke,{format:T(e.item.text),range:this.parent.getActiveSheet().selectedRange}),this.parent.notify(hr,{type:"mousedown"}),this.refreshNumFormatSelection(e.item.text)},e.prototype.tBarDdbBeforeOpen=function(e){var t=this.parent.viewport.height;parseInt(getComputedStyle(e.element.firstElementChild).height,10)*e.items.length+2*parseInt(getComputedStyle(e.element).paddingTop,10)>t&&(e.element.style.height=t+"px",e.element.style.overflowY="auto")},e.prototype.numDDBOpen=function(e){this.numPopupWidth=0;for(var t=e.element.querySelectorAll("span.e-numformat-preview-text"),r=0,n=t.length;r<n;r++)this.numPopupWidth<t[r].offsetWidth&&(this.numPopupWidth=t[r].offsetWidth);var i=this.numPopupWidth+160;document.querySelector(".e-numformat-ddb.e-dropdown-popup").style.width=i+"px"},e.prototype.previewNumFormat=function(e){var t=c(this.parent.getActiveSheet().activeCell),r=_(t[0],t[1],this.parent.getActiveSheet()),n={type:e.item.text,formattedText:"",value:r&&r.value?r.value:"",format:T(e.item.text),sheetIndex:this.parent.activeSheetTab,onLoad:!0},i=this.parent.createElement("div",{className:"e-numformat-text",styles:"width:100%",innerHTML:e.element.innerHTML});e.element.innerHTML="",this.parent.notify(Ae,n);var s=this.parent.createElement("span",{className:"e-numformat-preview-text",styles:"float:right;",innerHTML:n.formattedText.toString()});i.appendChild(s),e.element.appendChild(i)},e.prototype.refreshRibbonContent=function(){switch(this.activeTab){case 1:this.refreshFirstTabContent(c(this.parent.getActiveSheet().activeCell));break;case 2:break;case 3:this.refreshThirdTabContent()}},e.prototype.refreshFirstTabContent=function(e){var r=this;t.isNullOrUndefined(document.getElementById(this.parent.element.id+"_number_format"))||(this.numFormatDDB=t.getComponent(document.getElementById(this.parent.element.id+"_number_format"),i.DropDownButton));var n=c(this.parent.getActiveSheet().activeCell),s=this.parent.serviceLocator.getService(un),o=_(n[0],n[1],this.parent.getActiveSheet(),!0),a=D((o=o||{}).format?o.format:"General");if(this.numFormatDDB&&this.refreshNumFormatSelection(s.getConstant(a)),this.fontNameDdb&&this.refreshFontNameSelection(this.getCellStyleValue("fontFamily",e)),this.fontSizeDdb){var l=this.getCellStyleValue("fontSize",e).split("pt")[0];l!==this.fontSizeDdb.content&&(this.fontSizeDdb.content=l,this.fontSizeDdb.dataBind())}if(this.textAlignDdb){var h="e-icons e-"+this.getCellStyleValue("textAlign",e).toLowerCase()+"-icon";h!==this.textAlignDdb.iconCss&&(this.textAlignDdb.iconCss=h,this.textAlignDdb.dataBind())}if(this.verticalAlignDdb){var p="e-icons e-"+this.getCellStyleValue("verticalAlign",e).toLowerCase()+"-icon";p!==this.verticalAlignDdb.iconCss&&(this.verticalAlignDdb.iconCss=p,this.verticalAlignDdb.dataBind())}var u,d=this.parent.element.id,f=["fontWeight","fontStyle","textDecoration","textDecoration"];["bold","italic","line-through","underline"].forEach(function(t,n){(u=document.getElementById(d+"_"+t))&&(r.getCellStyleValue(f[n],e).toLowerCase().indexOf(t)>-1?u.classList.add("e-active"):u.classList.contains("e-active")&&u.classList.remove("e-active"))})},e.prototype.refreshFontNameSelection=function(e){if(e!==this.fontNameDdb.items[this.fontNameIndex].text){this.fontNameDdb.element.firstElementChild.textContent=e;for(var t=0;t<this.fontNameDdb.items.length;t++)if(this.fontNameDdb.items[t].text===e){this.fontNameDdb.items[t].iconCss="e-icons e-selected-icon",this.fontNameDdb.items[this.fontNameIndex].iconCss="",this.fontNameDdb.setProperties({items:this.fontNameDdb.items},!0),this.fontNameIndex=t;break}}},e.prototype.refreshNumFormatSelection=function(e){this.parent.serviceLocator.getService(un);for(var t=0;t<this.numFormatDDB.items.length;t++)""!==this.numFormatDDB.items[t].iconCss&&(this.numFormatDDB.items[t].iconCss=""),this.numFormatDDB.items[t].text===e&&(this.numFormatDDB.items[t].iconCss="e-icons e-selected-icon");this.numFormatDDB.element.firstElementChild.textContent=e,this.numFormatDDB.setProperties({items:this.numFormatDDB.items},!0)},e.prototype.fileItemSelect=function(e){var r=this,n=t.extend({cancel:!1},e);if(this.parent.trigger("fileItemSelect",n),!n.cancel)switch(e.item.id){case"Open":this.parent.element.querySelector("#"+this.parent.element.id+"_fileUpload").click();break;case"Xlsx":case"Xls":case"Csv":this.parent.save({saveType:e.item.id});break;case"New":var i=this.parent.serviceLocator.getService(dn);i.show({height:200,width:400,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(un).getConstant("DestroyAlert"),beforeOpen:function(){return r.parent.element.focus()},buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(un).getConstant("Ok"),isPrimary:!0},click:function(){r.parent.sheets.length=0,r.parent.createSheet(),i.hide(),r.parent.activeSheetTab=r.parent.sheets.length,r.parent.setProperties({activeSheetTab:r.parent.sheets.length},!0),r.parent.notify(Wt,{}),r.parent.notify(We,{}),r.parent.renderModule.refreshSheet()}}]})}},e.prototype.toolbarClicked=function(e){var t,r=this.parent.element.id,n=this.parent.serviceLocator.getService(un),i=this.parent.getActiveSheet();switch(e.item.id){case r+"_headers":i.showHeaders=!i.showHeaders,this.parent.setProperties({sheets:this.parent.sheets},!0),this.parent.serviceLocator.getService("sheet").showHideHeaders(),t=this.getLocaleText(n,"Headers",!1),e.item.text=t,this.ribbon.items[3].content[0].text=t,this.updateToggleText("headers",t),this.parent.element.focus();break;case r+"_gridlines":i.showGridLines=!i.showGridLines,this.parent.setProperties({sheets:this.parent.sheets},!0),t=this.getLocaleText(n,"GridLines",!0),e.item.text=t,this.ribbon.items[3].content[2].text=t,this.updateToggleText("gridlines",t),this.parent.element.focus()}this.parent.notify(fr,e)},e.prototype.updateToggleText=function(e,t){var r=this;oe(function(){r.ribbon.element.querySelector("#"+r.parent.element.id+"_"+e+" .e-tbar-btn-text").textContent=t})},e.prototype.refreshThirdTabContent=function(){var e,t=this,r=this.parent.getActiveSheet(),n=this.parent.serviceLocator.getService(un),i=[0,2];["Headers","GridLines"].forEach(function(s,o){e=i[o],r["show"+s]?t.ribbon.items[3].content[e].text===n.getConstant("Show"+s)&&t.updateShowHideBtn("Hide",s,e):t.ribbon.items[3].content[e].text===n.getConstant("Hide"+s)&&t.updateShowHideBtn("Show",s,e)})},e.prototype.updateShowHideBtn=function(e,t,r){var n=this.parent.serviceLocator.getService(un).getConstant(e+t);this.ribbon.items[3].content[r].text=n,this.ribbon.setProperties({items:this.ribbon.items},!0),this.updateToggleText(t.toLowerCase(),n)},e.prototype.enableRibbonItems=function(e){var r=document.getElementById(e.id);r&&this.ribbon.enableItems(e.isEnable,t.closest(r,".e-toolbar-item"))},e.prototype.createMobileView=function(){var e=this,t=this.parent.element.id,r=this.parent.createElement("div",{className:"e-header-toolbar"}),i=this.parent.createElement("ul");r.appendChild(i);var s=new n.Toolbar({items:[{prefixIcon:"e-tick-icon",align:"Left",id:t+"focused_tick",cssClass:"e-focused-tick"},{template:i,align:"Right",id:t+"file_menu"}],clicked:function(r){switch(r.item.id){case t+"focused_tick":e.parent.element.classList.remove("e-mobile-focused"),e.parent.renderModule.setSheetPanelSize()}},created:function(){var t=new n.Menu({cssClass:"e-mobile e-file-menu",enableRtl:!0,showItemOnClick:!0,items:e.ribbon.items[0].menuItems,select:e.fileItemSelect.bind(e),beforeOpen:function(t){t.element.parentElement.classList.remove("e-rtl"),e.fileMenuBeforeOpen(t)},beforeClose:e.fileMenuBeforeClose.bind(e)});t.createElement=e.parent.createElement,t.appendTo(i)}});s.createElement=this.parent.createElement,s.appendTo(r),this.parent.element.insertBefore(r,this.parent.element.firstElementChild),this.renderMobileToolbar()},e.prototype.renderMobileToolbar=function(){var e=this,t=this.parent.createElement("div",{className:"e-toolbar-panel e-ribbon"}),r=this.parent.createElement("div"),o=this.parent.createElement("button");t.appendChild(r),t.appendChild(o),t.style.display="block",this.parent.element.appendChild(t);var a=new i.DropDownButton({cssClass:"e-caret-hide",content:this.ribbon.items[1].header.text,items:[{text:this.ribbon.items[1].header.text},{text:this.ribbon.items[2].header.text},{text:this.ribbon.items[3].header.text}],select:function(t){t.item.text!==a.content&&(l.element.style.display="none",a.content=t.item.text,a.dataBind(),l.items=e.ribbon.items[a.items.indexOf(t.item)+1].content,l.width="calc(100% - "+o.getBoundingClientRect().width+"px)",l.element.style.display="",l.dataBind(),l.items[0].text=t.item.text,l.dataBind())},open:function(e){var t=e.element.parentElement,r=t.getBoundingClientRect(),n=s.calculatePosition(a.element,"right","bottom");t.style.left=n.left-r.width+"px",t.style.top=n.top-r.height+"px";for(var i=0;i<a.items.length;i++)if(a.content===a.items[i].text){e.element.children[i].classList.add("e-selected");break}},close:function(){return e.parent.element.focus()}});a.createElement=this.parent.createElement,a.appendTo(o);var l=new n.Toolbar({width:"calc(100% - "+o.getBoundingClientRect().width+"px)",items:this.ribbon.items[1].content,clicked:this.toolbarClicked.bind(this)});l.createElement=this.parent.createElement,l.appendTo(r),t.style.display=""},e.prototype.fileMenuBeforeOpen=function(e){var t,r=this,n=this.parent.serviceLocator.getService(un),i=[".xlsx",".xls",".csv"];e.parentItem.text===n.getConstant("SaveAs")&&[].slice.call(e.element.children).forEach(function(e,n){t=r.parent.createElement("div",{innerHTML:e.innerHTML}),e.innerHTML="",t.appendChild(r.parent.createElement("span",{className:"e-extension",innerHTML:i[n]})),e.appendChild(t)}),this.parent.trigger("fileMenuBeforeOpen",e)},e.prototype.fileMenuBeforeClose=function(e){this.parent.trigger("fileMenuBeforeClose",e)},e.prototype.addEventListener=function(){this.parent.on(Ut,this.initRibbon,this),this.parent.on(mr,this.enableRibbonItems,this),this.parent.on(je,this.refreshRibbonContent,this),this.parent.on(Ar,this.enableToolbar,this)},e.prototype.destroy=function(){var e=this.parent.element,r=this.ribbon.element,n=e.id;we(e.querySelector("#"+n+"_paste"),i.SplitButton),we(e.querySelector("#"+n+"_number_format"),i.DropDownButton),we(e.querySelector("#"+n+"_font_size"),i.DropDownButton),we(e.querySelector("#"+n+"_font_name"),i.DropDownButton),we(e.querySelector("#"+n+"_text_align"),i.DropDownButton),we(e.querySelector("#"+n+"_vertical_align"),i.DropDownButton),we(e.querySelector("#"+n+"_sorting"),i.DropDownButton),["bold","italic","line-through","underline"].forEach(function(t){we(e.querySelector("#"+n+"_"+t),o.Button)}),this.ribbon.destroy(),r&&t.detach(r),this.ribbon=null,this.removeEventListener()},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Ut,this.initRibbon),this.parent.off(mr,this.enableRibbonItems),this.parent.off(je,this.refreshRibbonContent),this.parent.on(Ar,this.enableToolbar,this))},e}(),Jr=function(){function e(e){this.categoryCollection=[],this.formulaCollection=[],this.parent=e,this.addEventListener()}return e.prototype.getModuleName=function(){return"formulaBar"},e.prototype.createFormulaBar=function(e){if(this.parent.showFormulaBar||!this.insertFnRipple){var r=this.parent.serviceLocator.getService(un),n=this.parent.element.id,i=this.parent.createElement("div",{className:"e-formula-bar-panel"});if(!this.parent.isMobileView()){var s=this.parent.createElement("input",{id:n+"_name_box",attrs:{type:"text"}});i.appendChild(s),this.comboBoxInstance=new l.ComboBox({value:"A1",cssClass:"e-name-box",width:"",noRecordsTemplate:"",fields:{text:"name",value:"refersTo"},beforeOpen:this.nameBoxBeforeOpen.bind(this),blur:this.nameBoxBlur.bind(this),select:this.nameBoxSelect.bind(this),change:function(e){}}),this.comboBoxInstance.createElement=this.parent.createElement,this.comboBoxInstance.appendTo(s),this.comboBoxInstance.element.parentElement.title=r.getConstant("NameBox")}i.appendChild(this.parent.createElement("button",{className:"e-btn e-css e-flat e-icon-btn e-insert-function",attrs:{title:r.getConstant("InsertFunction")}})).appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons"})),this.insertFnRipple=t.rippleEffect(i,{selector:".e-insert-function"}),i.appendChild(this.parent.createElement("div",{className:"e-separator"}));var o=i.appendChild(this.parent.createElement("textarea",{className:"e-formula-bar e-css",id:n+"_formula_input",attrs:{title:r.getConstant("FormulaBar"),spellcheck:"false"}}));o.rows=1,this.parent.isMobileView()?(o.placeholder=r.getConstant("MobileFormulaBarPlaceHolder"),t.EventHandler.add(o,"focus",this.textAreaFocusIn,this),t.EventHandler.add(o,"blur",this.textAreaFocusOut,this)):i.appendChild(this.parent.createElement("span",{className:"e-drop-icon e-icons",attrs:{title:r.getConstant("ExpandFormulaBar")}})),e&&e.uiUpdate?this.parent.element.insertBefore(i,document.getElementById(n+"_sheet_panel")):this.parent.element.appendChild(i)}else this.destroy()},e.prototype.textAreaFocusIn=function(e){var t=this.parent.element.querySelector(".e-formula-bar-panel"),r=this.parent.createElement("button",{className:"e-btn e-css e-flat e-icon-btn e-formula-submit"});r.appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons e-tick-icon"})),t.classList.add("e-focused"),t.appendChild(r)},e.prototype.textAreaFocusOut=function(e){var r=this.parent.element.querySelector(".e-formula-bar-panel");r.classList.remove("e-focused"),t.detach(r.querySelector(".e-formula-submit"))},e.prototype.keyDownHandler=function(e){var t=e.target;this.parent.isEdit&&t.classList.contains("e-formula-bar")&&this.parent.notify(Jt,{action:"refreshEditor",value:t.value,refreshEditorElem:!0})},e.prototype.keyUpHandler=function(e){if(this.parent.isEdit){var t=e.target;if(t.classList.contains("e-formula-bar")){var r={action:"getCurrentEditValue",editedValue:""};this.parent.notify(Jt,r),r.editedValue!==t.value&&this.parent.notify(Jt,{action:"refreshEditor",value:t.value,refreshEditorElem:!0})}}},e.prototype.nameBoxBeforeOpen=function(e){this.comboBoxInstance.element.classList.contains("e-name-editing")?e.cancel=!0:this.comboBoxInstance.element.select()},e.prototype.nameBoxBlur=function(e){this.comboBoxInstance.element.classList.contains("e-name-editing")&&(this.comboBoxInstance.element.classList.remove("e-name-editing"),this.UpdateValueAfterMouseUp())},e.prototype.nameBoxSelect=function(e){if(e.isInteracted){var t=e.itemData.refersTo.substr(1),r=$(this.parent,Z(t)),n=g(t),i=ee(this.parent,r);r+1===this.parent.activeSheetTab?(this.parent.selectRange(n),this.parent.element.focus()):(Q(this.parent,n,i),this.parent.activeSheetTab=r+1)}},e.prototype.formulaBarUpdateHandler=function(e){var r,n=this,i=this.parent.getActiveSheet().selectedRange.split(":"),s=new t.Internationalization;if("mousemove"===e.type||"pointermove"===e.type){var o=p(i[0]),a=p(i[1]);r=Math.abs(o[0]-a[0])+1+"R x "+(Math.abs(o[1]-a[1])+1)+"C"}else{r=i[0];this.parent.getData(ie(this.parent)+"!"+r).then(function(e){var r,i="";e.forEach(function(e,o){var a=e&&e.format?D(e.format):"General";e&&(t.isNullOrUndefined(e.value)||(r=x(Number(e.value)),i="Invalid Date"===r.toString()||"ShortDate"!==a&&"LongDate"!==a?"Invalid Date"!==r.toString()&&"Time"===a?s.formatDate(r,{type:"dateTime",skeleton:"yMd"})+" "+s.formatDate(r,{type:"dateTime",skeleton:"hms"}):e.value:s.formatDate(r,{type:"date",skeleton:"yMd"})),e.formula&&(i=e.formula)),document.getElementById(n.parent.element.id+"_formula_input").value=i})})}this.updateComboBoxValue(r)},e.prototype.UpdateValueAfterMouseUp=function(){this.updateComboBoxValue(this.parent.getActiveSheet().selectedRange.split(":")[0])},e.prototype.updateComboBoxValue=function(e){var t=this.parent.getActiveSheet(),r={action:"getNameFromRange",range:ie(this.parent)+"!"+t.selectedRange,definedName:null};if(this.parent.notify(Zt,r),r.definedName&&(e=r.definedName.name),!this.parent.isMobileView()){if(this.comboBoxInstance.text===e)return;this.comboBoxInstance.text=e,this.comboBoxInstance.dataBind()}},e.prototype.clickHandler=function(e){var r=this,n=e.target;if(n.classList.contains("e-drop-icon")&&t.closest(n,".e-formula-bar-panel"))this.toggleFormulaBar(n);else if(n.classList.contains("e-formula-bar"))this.parent.isEdit||this.parent.notify(Jt,{action:"startEdit",refreshCurPos:!1});else if(n.parentElement.classList.contains("e-name-box"))if(n.classList.contains("e-ddl-icon")){var i={action:"getNames",names:[]};this.parent.notify(Zt,i),this.comboBoxInstance.dataSource=i.names}else this.comboBoxInstance.element.classList.add("e-name-editing"),this.comboBoxInstance.element.select();if(!t.isNullOrUndefined(n.offsetParent)&&(n.offsetParent.classList.contains("e-insert-function")||n.classList.contains("e-insert-function")||this.parent.element.id+"_insert_function"===n.offsetParent.id||this.parent.element.id+"_insert_function"===n.id||n.parentElement.classList.contains("e-insert-function")||this.parent.element.id+"_insert_function"===n.parentElement.id)){var s=!this.parent.isEdit,o={action:"getCurrentEditValue",editedValue:""};if(!s){i={action:"isFormulaEditing",isFormulaEdit:!1};this.parent.notify(Zt,i),s=i.isFormulaEdit,this.parent.notify(Jt,o)}if(s||""===o.editedValue){""===o.editedValue&&this.parent.notify(Jt,{action:"refreshEditor",value:"="});var a=this.parent.serviceLocator.getService(un),p=this.parent.createElement("div",{className:"e-formula-description",id:this.parent.element.id+"_description_content"}),c=this.parent.createElement("div",{className:"e-category-content",id:this.parent.element.id+"_category_content",innerHTML:a.getConstant("PickACategory")}),u=this.parent.createElement("input",{className:"e-formula-category",id:this.parent.element.id+"_formula_category"}),d=this.parent.createElement("div",{className:"e-formula-list",id:this.parent.element.id+"_formula_list"}),f=this.parent.createElement("div",{className:"e-description-content",innerHTML:a.getConstant("Description")}),m=this.parent.createElement("div",{className:"e-header-content",innerHTML:a.getConstant("InsertFunction")}),g={action:"getFormulaCategory",categoryCollection:[]};this.parent.notify(Me,g),this.categoryCollection=g.categoryCollection,this.categoryList=new l.DropDownList({dataSource:this.categoryCollection,index:0,width:"285px",popupHeight:"210px",select:this.dropDownSelect.bind(this)});var y={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(Me,y),this.formulaCollection=y.formulaCollection,this.formulaList=new h.ListView({dataSource:this.formulaCollection.sort(),actionComplete:this.updateFormulaList.bind(this),select:this.listSelected.bind(this),width:"285px",height:"200px"}),this.dialog=this.parent.serviceLocator.getService("dialog"),this.dialog.show({header:m.outerHTML,content:c.outerHTML+u.outerHTML+d.outerHTML+f.outerHTML+p.outerHTML,width:"320px",height:"485px",cssClass:"e-spreadsheet-function-dlg",showCloseIcon:!0,isModal:!0,beforeOpen:function(){return r.parent.element.focus()},open:this.dialogOpen.bind(this),beforeClose:this.dialogBeforeClose.bind(this),close:this.dialogClose.bind(this),buttons:[{click:this.selectFormula.bind(this,this.dialog,this),buttonModel:{content:"OK",isPrimary:!0}}]}),this.categoryList.appendTo("#"+this.parent.element.id+"_formula_category"),this.formulaList.appendTo("#"+this.parent.element.id+"_formula_list"),t.EventHandler.add(this.formulaList.element,"dblclick",this.formulaClickHandler,this)}}},e.prototype.toggleFormulaBar=function(e){var t=e.parentElement,r=this.parent.serviceLocator.getService(un);t.classList.contains("e-expanded")?(t.classList.remove("e-expanded"),document.getElementById(this.parent.element.id+"_formula_input").rows=1,e.title=r.getConstant("ExpandFormulaBar")):(t.classList.add("e-expanded"),document.getElementById(this.parent.element.id+"_formula_input").rows=3,e.title=r.getConstant("CollapseFormulaBar")),this.parent.setPanelSize()},e.prototype.dialogOpen=function(){this.focusOkButton()},e.prototype.dialogClose=function(){var e={action:"getCurrentEditValue",editedValue:""};this.parent.notify(Jt,e),"="===e.editedValue.toString().trim()&&this.parent.notify(Jt,{action:"refreshEditor",value:""})},e.prototype.dialogBeforeClose=function(){t.EventHandler.remove(this.formulaList.element,"dblclick",this.formulaClickHandler);var e=document.getElementById("_dialog-content");e.parentNode.removeChild(e),this.dialog.dialogInstance.storeActiveElement=document.getElementById(this.parent.element.id+"_edit")},e.prototype.selectFormula=function(e,t){var r=t.formulaList.getSelectedItems().text,n=ee(this.parent,this.parent.activeSheetTab-1);this.parent.isEdit?this.parent.notify(Jt,{action:"refreshEditor",value:r+"(",refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!0}):(this.parent.notify(Jt,{action:"startEdit",value:"="+r+"(",address:n.activeCell}),this.parent.notify(Qt,{action:"refreshFormulabar",value:"="+r+"("})),e.hide()},e.prototype.listSelected=function(){this.updateFormulaDescription()},e.prototype.updateFormulaList=function(){this.activeListFormula(),this.updateFormulaDescription()},e.prototype.dropDownSelect=function(e){this.formulaCollection=[];var t={action:"getLibraryFormulas",formulaCollection:[]};if("All"===e.item.textContent)this.parent.notify(Me,t),this.formulaCollection=t.formulaCollection;else{var r={action:"dropDownSelectFormulas",formulaCollection:[],selectCategory:e.item.textContent};this.parent.notify(Me,r),this.formulaCollection=r.formulaCollection}this.formulaList.dataSource=this.formulaCollection.sort()},e.prototype.focusOkButton=function(){document.getElementById("_dialog-content").nextElementSibling.firstElementChild.focus()},e.prototype.activeListFormula=function(){var e=document.getElementById(this.parent.element.id+"_formula_list").children[0].children[0].firstElementChild;this.formulaList.selectItem(e)},e.prototype.updateFormulaDescription=function(){var e=this.formulaList.getSelectedItems().text,t={action:"getFormulaDescription",description:"",selectedList:e};this.parent.notify(Me,t),this.focusOkButton(),document.getElementById(this.parent.element.id+"_description_content").innerHTML=this.parent.serviceLocator.getService(un).getConstant(e)},e.prototype.formulaClickHandler=function(e){var t=e.target,r=ee(this.parent,this.parent.activeSheetTab-1);(t.offsetParent.classList.contains("e-text-content")||t.classList.contains("e-list-item"))&&(this.parent.isEdit?this.parent.notify(Jt,{action:"refreshEditor",value:t.innerText+"(",refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!0}):(this.parent.notify(Jt,{action:"startEdit",value:"="+t.innerText+"(",address:r.activeCell}),this.parent.notify(Qt,{action:"refreshFormulabar",value:"="+t.innerText+"("})),this.dialog.hide())},e.prototype.addEventListener=function(){this.parent.on(zt,this.createFormulaBar,this),this.parent.on("click",this.clickHandler,this),this.parent.on(tr,this.keyDownHandler,this),this.parent.on(er,this.keyUpHandler,this),this.parent.on(hr,this.formulaBarUpdateHandler,this),this.parent.on(lr,this.UpdateValueAfterMouseUp,this),this.parent.on(Qt,this.editOperationHandler,this)},e.prototype.destroy=function(){this.removeEventListener(),this.comboBoxInstance.destroy(),this.comboBoxInstance=null,this.insertFnRipple(),this.insertFnRipple=null;var e=this.parent.element.querySelector(".e-formula-bar-panel");e&&t.detach(e)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(zt,this.createFormulaBar),this.parent.off("click",this.clickHandler),this.parent.off(tr,this.keyDownHandler),this.parent.off(er,this.keyUpHandler),this.parent.off(hr,this.formulaBarUpdateHandler),this.parent.off(lr,this.UpdateValueAfterMouseUp),this.parent.off(Qt,this.editOperationHandler))},e.prototype.editOperationHandler=function(e){switch(e.action){case"refreshFormulabar":this.getFormulaBar().value=e.value;break;case"getPosition":e.position=this.getFormulaBar().getBoundingClientRect()}},e.prototype.getFormulaBar=function(){return this.parent.element.querySelector("#"+this.parent.element.id+"_formula_input")},e}(),Zr=function(){function e(e){this.isFormulaBar=!1,this.isFormula=!1,this.isPopupOpened=!1,this.isPreventClose=!1,this.isSubFormula=!1,this.keyCodes={UP:38,DOWN:40,LEFT:37,RIGHT:39,FIRSTALPHABET:65,LASTALPHABET:90,SPACE:32,BACKSPACE:8,TAB:9,DELETE:46,ENTER:13,ESC:27},this.parent=e,this.addEventListener()}return e.prototype.getModuleName=function(){return"formula"},e.prototype.destroy=function(){this.removeEventListener(),this.autocompleteInstance&&this.autocompleteInstance.destroy(),this.autocompleteInstance=null,this.parent=null},e.prototype.addEventListener=function(){this.parent.on(Zt,this.performFormulaOperation,this),this.parent.on(er,this.keyUpHandler,this),this.parent.on(tr,this.keyDownHandler,this),this.parent.on("click",this.clickHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Zt,this.performFormulaOperation),this.parent.off(er,this.keyUpHandler),this.parent.off(tr,this.keyDownHandler),this.parent.off("click",this.clickHandler))},e.prototype.performFormulaOperation=function(e){switch(e.action){case"renderAutoComplete":this.renderAutoComplete();break;case"endEdit":this.endEdit();break;case"addDefinedName":this.addDefinedName(e.definedName);break;case"getNames":e.sheetName||(e.sheetName=ie(this.parent)),e.names=this.getNames(e.sheetName);break;case"getNameFromRange":e.definedName=this.getNameFromRange(e.range);break;case"isFormulaEditing":e.isFormulaEdit=this.isFormula;break;case"isCircularReference":var t=this.parent.serviceLocator.getService(un);this.parent.serviceLocator.getService(dn).show({height:180,width:400,isModal:!0,showCloseIcon:!0,content:t.getConstant("CircularReference")}),e.argValue="0"}},e.prototype.renderAutoComplete=function(){if(!this.parent.element.querySelector("#"+this.parent.element.id+"_ac")){var e=this.parent.createElement("input",{id:this.parent.element.id+"_ac",className:"e-ss-ac"});this.parent.element.appendChild(e);var t={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(Me,t);var r={dataSource:t.formulaCollection,cssClass:"e-ss-atc",popupWidth:"130px",allowFiltering:!0,filterType:"StartsWith",sortOrder:"Ascending",open:this.onSuggestionOpen.bind(this),close:this.onSuggestionClose.bind(this),select:this.onSelect.bind(this),actionComplete:this.onSuggestionComplete.bind(this)};this.autocompleteInstance=new l.AutoComplete(r,e),this.autocompleteInstance.createElement=this.parent.createElement}},e.prototype.onSuggestionOpen=function(e){var t=this;this.isPopupOpened=!0;var r=this.getPopupPosition();e.popup.offsetX=r.left,e.popup.offsetY=r.top+r.height,e.popup.refreshPosition(),e.popup.element.firstChild.style.maxHeight="180px",new Promise(function(e,t){setTimeout(function(){e()},100)}).then(function(){t.triggerKeyDownEvent(t.keyCodes.DOWN)})},e.prototype.onSuggestionClose=function(e){this.isPreventClose?e.cancel=!0:this.isPopupOpened=!1},e.prototype.onSelect=function(e){var t="="+e.itemData.value+"(";if(this.isSubFormula){var r=this.getEditingValue(),n=r.lastIndexOf(this.getArgumentSeparator());n>-1?t=r.slice(0,n+1):(n=r.lastIndexOf("("))>-1&&(t=r.slice(0,n+1)),t+=e.itemData.value+"("}this.parent.notify(Jt,{action:"refreshEditor",value:t,refreshFormulaBar:!0,refreshEditorElem:!0,refreshCurPos:!this.isFormulaBar})},e.prototype.onSuggestionComplete=function(e){this.isPreventClose=e.result.length>0,this.isPreventClose||(e.cancel=!0,this.hidePopUp())},e.prototype.keyUpHandler=function(e){if(this.parent.isEdit){var t=this.getEditingValue();this.isFormula=H(t),(this.isFormula||this.isPopupOpened)&&(e.keyCode!==this.keyCodes.TAB&&this.isFormula&&(t=this.getSuggestionKeyFromFormula(t)),this.refreshFormulaSuggestion(e,t))}else this.isPopupOpened&&this.hidePopUp()},e.prototype.keyDownHandler=function(e){var t=e.keyCode;if(this.isFormula){if(this.isPopupOpened)switch(t){case this.keyCodes.UP:case this.keyCodes.DOWN:e.preventDefault(),this.triggerKeyDownEvent(t);break;case this.keyCodes.TAB:e.preventDefault(),this.triggerKeyDownEvent(this.keyCodes.ENTER)}}else{var r=e.target;if(r.id===this.parent.element.id+"_name_box")switch(t){case this.keyCodes.ENTER:this.addDefinedName({name:r.value}),this.parent.element.focus();break;case this.keyCodes.ESC:this.parent.element.focus()}}},e.prototype.clickHandler=function(e){if(this.parent.isEdit){var t=e.target;this.isFormulaBar=t.classList.contains("e-formula-bar")}},e.prototype.refreshFormulaSuggestion=function(e,t){if(t.length>0){var r=this.autocompleteInstance.element,n=e.keyCode,i=this.isPopupOpened;this.isNavigationKey(n)||(r.value=t,r.dispatchEvent(new Event("input")),r.dispatchEvent(new Event("keyup")),i&&this.triggerKeyDownEvent(this.keyCodes.DOWN))}else this.isPopupOpened&&(this.isPreventClose=!1,this.hidePopUp())},e.prototype.endEdit=function(){if(this.isSubFormula=!1,this.isPreventClose=!1,this.isFormula=!1,this.isFormulaBar=!1,this.isPopupOpened){this.hidePopUp();var e=document.querySelector("#"+this.parent.element.id+"_ac_popup");e&&t.detach(e),this.isPopupOpened=!1}},e.prototype.hidePopUp=function(){this.autocompleteInstance.hidePopup()},e.prototype.getSuggestionKeyFromFormula=function(e){var t="";if(e=e.substr(1)){var r=e.lastIndexOf("("),n=(e=e.substr(r+1)).split(this.getArgumentSeparator());1===n.length?(t=n[0],this.isSubFormula=r>-1):(t=n[n.length-1],this.isSubFormula=!0);var i=t.match(/\w/);(!i||i&&0!==i.index)&&(t="")}return t},e.prototype.getPopupPosition=function(){var e={position:null};return this.isFormulaBar?(e.action="getPosition",this.parent.notify(Qt,e)):(e.action="getPosition",this.parent.notify(Jt,e)),e.position},e.prototype.getEditingValue=function(){var e={action:"getCurrentEditValue",editedValue:""};return this.parent.notify(Jt,e),e.editedValue},e.prototype.isNavigationKey=function(e){return e===this.keyCodes.UP||e===this.keyCodes.DOWN||e===this.keyCodes.LEFT||e===this.keyCodes.RIGHT},e.prototype.triggerKeyDownEvent=function(e){var t=this.autocompleteInstance.element;t.dispatchEvent(new Event("input"));var r=new Event("keydown");r.keyCode=e,r.which=e,r.altKey=!1,r.shiftKey=!1,r.ctrlKey=!1,t.dispatchEvent(r)},e.prototype.getArgumentSeparator=function(){if(this.argumentSeparator)return this.argumentSeparator;var e={action:"getArgumentSeparator",argumentSeparator:""};return this.parent.notify(Me,e),this.argumentSeparator=e.argumentSeparator,e.argumentSeparator},e.prototype.getNames=function(e){return this.parent.definedNames.filter(function(t){return""===t.scope||t.scope===e})},e.prototype.getNameFromRange=function(e){var t=e.slice(0,e.indexOf(":")),r=e.slice(e.indexOf("!")+1).split(":"),n=r.length>1&&r[0]===r[1],i=this.parent.definedNames.filter(function(r,i){return!(!n||r.refersTo!=="="+t)||r.refersTo==="="+e});return i&&i[0]},e.prototype.addDefinedName=function(e){if(!e.refersTo){var r=ee(this.parent,this.parent.activeSheetTab-1).selectedRange;if(!t.isNullOrUndefined(r)){var n=r.indexOf(":"),i=r.substr(0,n);r=i===r.substr(n+1,r.length)?i:r}e.refersTo=ie(this.parent)+"!"+r}var s={action:"addDefinedName",definedName:e,isAdded:!1};return this.parent.notify(Me,s),s.isAdded||this.parent.serviceLocator.getService(dn).show({content:this.parent.serviceLocator.getService(un).getConstant("DefineNameExists"),width:"300"}),!0},e}(),Qr=function(){function e(e){this.aggregateContent="",this.parent=e,this.addEventListener()}return e.prototype.getModuleName=function(){return"sheetTabs"},e.prototype.createSheetTabs=function(){var e=this;if(this.parent.showSheetTabs||!this.tabInstance){var r=this.parent.serviceLocator.getService(un),s=this.parent.createElement("div",{className:"e-sheet-tab-panel",id:this.parent.element.id+"_sheet_tab_panel"}),o=this.parent.createElement("button",{className:"e-add-sheet-tab e-btn e-css e-flat e-icon-btn",attrs:{title:r.getConstant("AddSheet")}});o.appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons e-add-icon"})),o.addEventListener("click",this.addSheetTab.bind(this)),s.appendChild(o),this.addBtnRipple=t.rippleEffect(s,{selector:".e-add-sheet-tab"});var a=this.parent.createElement("button",{attrs:{title:r.getConstant("ListAllSheets")}});s.appendChild(a),this.parent.element.appendChild(s);var l=this.getSheetTabItems();this.dropDownInstance=new i.DropDownButton({iconCss:"e-icons",items:l.ddbItems,select:function(t){return e.updateSheetTab({idx:e.dropDownInstance.items.indexOf(t.item)})},beforeOpen:function(t){return e.beforeOpenHandler(e.dropDownInstance,t.element)},open:function(t){return e.openHandler(e.dropDownInstance,t.element,"left")},cssClass:"e-sheets-list e-flat e-caret-hide",close:function(){return e.parent.element.focus()}}),this.dropDownInstance.createElement=this.parent.createElement,this.dropDownInstance.appendTo(a);var h=this.parent.createElement("div",{className:"e-sheet-tab"});this.tabInstance=new n.Tab({selectedItem:0,overflowMode:"Scrollable",items:l.tabItems,scrollStep:250,selecting:function(e){},selected:function(t){t.selectedIndex!==t.previousIndex&&(e.parent.activeSheetTab=t.selectedIndex+1,e.parent.dataBind(),e.updateDropDownItems(t.selectedIndex,t.previousIndex),e.parent.element.focus())},created:function(){var r=e.tabInstance.element.querySelector(".e-toolbar-items");r.classList.add("e-sheet-tabs-items"),t.EventHandler.add(r,"dblclick",e.renameSheetTab,e)}}),s.appendChild(h),this.tabInstance.createElement=this.parent.createElement,this.tabInstance.appendTo(h),t.EventHandler.remove(this.tabInstance.element,"keydown",this.tabInstance.spaceKeyDown)}else this.destroy()},e.prototype.updateDropDownItems=function(e,t){t>-1&&(this.dropDownInstance.items[t].iconCss=""),this.dropDownInstance.items[e].iconCss="e-selected-icon e-icons",this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0)},e.prototype.beforeOpenHandler=function(e,t){var r=this.parent.viewport.height;parseInt(getComputedStyle(t.firstElementChild).height,10)*e.items.length+2*parseInt(getComputedStyle(t).paddingTop,10)>r&&(t.style.height=r+"px",t.style.overflowY="auto"),t.parentElement.style.visibility="hidden"},e.prototype.openHandler=function(e,t,r){var n,i=t.parentElement;if(-1===s.isCollide(i).indexOf("bottom")){n="auto"===t.style.overflowY?this.parent.viewport.height:i.getBoundingClientRect().height;var o=s.calculatePosition(e.element,r,"top");"right"===r&&(o.left-=i.getBoundingClientRect().width),i.style.left=o.left+"px",i.style.top=o.top-n+"px"}i.style.visibility=""},e.prototype.getSheetTabItems=function(){var e,t=this,r=[],n=[];return this.parent.sheets.forEach(function(i,s){e=ie(t.parent,s+1),r.push({header:{text:e}}),n.push({text:e,iconCss:s+1===t.parent.activeSheetTab?"e-selected-icon e-icons":""})}),{tabItems:r,ddbItems:n}},e.prototype.refreshSheetTab=function(){var e=this.getSheetTabItems();this.dropDownInstance.items=e.ddbItems,this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),this.tabInstance.items=e.tabItems,this.tabInstance.selectedItem=this.parent.activeSheetTab-1,this.tabInstance.dataBind()},e.prototype.addSheetTab=function(e){var t=e.text&&"Insert"===e.text?this.parent.activeSheetTab-1:this.parent.activeSheetTab;this.parent.createSheet(t);var r=this.parent.sheets[t].name;this.dropDownInstance.items.splice(t,0,{text:r}),this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),this.tabInstance.addTab([{header:{text:r},content:""}],t),t===this.parent.activeSheetTab-1?(this.parent.renderModule.refreshSheet(),this.updateDropDownItems(t,t+1)):this.updateSheetTab({idx:t}),this.parent.element.focus()},e.prototype.updateSheetTab=function(e){this.tabInstance.selectedItem=e.idx,this.tabInstance.dataBind()},e.prototype.switchSheetTab=function(e){var r=t.closest(e.event.target,".e-toolbar-item");if(r)for(var n=r.querySelector(".e-tab-text").textContent,i=0,s=this.tabInstance.items.length;i<s;i++)if(this.tabInstance.items[i].header.text===n){this.parent.activeSheetTab-1!==i&&this.updateSheetTab({idx:i});break}},e.prototype.renameSheetTab=function(){var e=this.tabInstance.element.querySelector(".e-toolbar-item.e-active");if(e){var r=(e=e.querySelector(".e-text-wrap")).querySelector(".e-tab-text").textContent,n=this.parent.createElement("input",{id:this.parent.element.id+"_rename_input",className:"e-input e-sheet-rename",styles:"width: "+e.getBoundingClientRect().width+"px",attrs:{type:"text",name:"Rename",required:"",value:r,spellcheck:"false",maxlength:"31"}});e.firstElementChild.style.display="none",e.appendChild(n),t.EventHandler.add(document,"mousedown touchstart",this.renameInputFocusOut,this),t.EventHandler.add(n,"input",this.updateWidth,this),n.focus(),n.setSelectionRange(0,r.length),t.EventHandler.remove(t.closest(e,".e-toolbar-items"),"dblclick",this.renameSheetTab)}},e.prototype.updateWidth=function(e){var t=e.target,r=t.value.length,n=t.value.split(" ");if(n.length){var i=n.length-1;r-=i,r+=.5*i}t.style.width=r+"ch"},e.prototype.renameInputFocusOut=function(e){var r=e.target;if("mousedown"!==e.type&&"touchstart"!==e.type||!r.classList.contains("e-sheet-rename")&&!t.closest(r,".e-dlg-container")){if(r=document.getElementById(this.parent.element.id+"_rename_input"),"keydown"===e.type&&27===e.keyCode)return this.removeRenameInput(r),void this.parent.element.focus();var n=r.value,i=this.parent.serviceLocator.getService(un);if(n){var s=this.tabInstance.selectedItem;if(n.match(new RegExp(".*[\\[\\]\\*\\\\/\\?].*")))this.showRenameDialog(r,i.getConstant("SheetRenameInvalidAlert"));else{if(this.tabInstance.items[s].header.text!==n)for(var o=0,a=this.parent.sheets.length;o<a;o++)if(o+1!==this.parent.activeSheetTab&&this.parent.sheets[o].name.toLowerCase()===n.toLowerCase())return void this.showRenameDialog(r,i.getConstant("SheetRenameAlreadyExistsAlert"));var l=this.removeRenameInput(r);this.tabInstance.items[s].header.text!==n&&(this.parent.sheets[s].name=n,this.parent.setProperties({sheets:this.parent.sheets},!0),this.tabInstance.items[s].header.text=n,this.dropDownInstance.items[s].text=n,this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),n.indexOf("  ")>-1?(this.tabInstance.setProperties({items:this.tabInstance.items},!0),l.querySelector(".e-toolbar-item.e-active .e-tab-text").textContent=n):(this.tabInstance.items=this.tabInstance.items,this.tabInstance.dataBind())),("keydown"===e.type||t.closest(e.target,".e-spreadsheet"))&&this.parent.element.focus()}}else this.showRenameDialog(r,i.getConstant("SheetRenameEmptyAlert"))}},e.prototype.removeRenameInput=function(e){var r=e.parentElement.querySelector(".e-tab-text"),n=t.closest(e,".e-toolbar-items");return t.EventHandler.add(n,"dblclick",this.renameSheetTab,this),t.EventHandler.remove(document,"mousedown touchstart",this.renameInputFocusOut),t.EventHandler.remove(e,"input",this.updateWidth),t.remove(e),r.style.display="",n},e.prototype.showRenameDialog=function(e,t){this.parent.serviceLocator.getService(dn).show({target:document.getElementById(this.parent.element.id+"_sheet_panel"),height:180,width:400,isModal:!0,showCloseIcon:!0,content:t,beforeOpen:function(){return e.focus()},close:function(){return e.setSelectionRange(0,e.value.length)}})},e.prototype.focusRenameInput=function(){var e=document.getElementById(this.parent.element.id+"_rename_input");e&&e.focus()},e.prototype.removeSheetTab=function(e){var t=this,r=this.parent.serviceLocator.getService(un);if(this.parent.sheets.length>1){var n=this.parent.getActiveSheet();if(!(!n.rows||!n.rows.length)&&(1!==n.rows.length||!(!n.rows[0].cells||!n.rows[0].cells.length))){var i=this.parent.serviceLocator.getService(dn);i.show({height:180,width:400,isModal:!0,showCloseIcon:!0,content:r.getConstant("DeleteSheetAlert"),beforeOpen:function(){return t.parent.element.focus()},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0},click:function(){i.hide(),t.destroySheet()}}]})}else this.destroySheet()}else this.parent.serviceLocator.getService(dn).show({target:document.getElementById(this.parent.element.id+"_sheet_panel"),height:180,width:400,isModal:!0,showCloseIcon:!0,content:r.getConstant("DeleteSingleLastSheetAlert"),beforeOpen:function(){return t.parent.element.focus()}})},e.prototype.destroySheet=function(){var e=this.parent.activeSheetTab-1;this.parent.removeSheet(e),this.parent.notify(We,{sheetIndex:e}),this.dropDownInstance.items.splice(e,1),this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),this.tabInstance.removeTab(e),this.parent.setProperties({activeSheetTab:this.tabInstance.selectedItem+1},!0),this.parent.renderModule.refreshSheet(),this.updateDropDownItems(this.tabInstance.selectedItem),this.parent.element.focus()},e.prototype.showAggregate=function(){var e=this;C(p(this.parent.getActiveSheet().selectedRange))||oe(function(){var t={Count:0,Sum:"0",Avg:"0",Min:"0",Max:"0"};if(e.parent.notify(Ge,t),t.Count){e.aggregateContent||(e.aggregateContent=t.Sum?"Sum":"Count");var r=e.aggregateContent,n=r+": "+t[r];if(e.aggregateDropDown)e.updateAggregateContent(n,t);else{var s=e.parent.createElement("button");document.getElementById(e.parent.element.id+"_sheet_tab_panel").appendChild(s),e.aggregateDropDown=new i.DropDownButton({content:n,items:e.getAggregateItems(t),select:function(r){return e.updateAggregateContent(r.item.text,t)},beforeOpen:function(t){return e.beforeOpenHandler(e.aggregateDropDown,t.element)},open:function(t){return e.openHandler(e.aggregateDropDown,t.element,"right")},close:function(){return e.parent.element.focus()},cssClass:"e-aggregate-list e-flat"}),e.aggregateDropDown.createElement=e.parent.createElement,e.aggregateDropDown.appendTo(s)}}})},e.prototype.getAggregateItems=function(e){var t,r,n=this,i=[];return Object.keys(e).forEach(function(s){e[s]!==Ge&&(t=s+": "+e[s],r=s===n.aggregateContent?"e-selected-icon e-icons":"",i.push({text:t,iconCss:r}))}),i},e.prototype.updateAggregateContent=function(e,t){this.aggregateContent=e.split(": ")[0],this.aggregateDropDown.content=e,this.aggregateDropDown.dataBind(),this.aggregateDropDown.setProperties({items:this.getAggregateItems(t)},!0)},e.prototype.removeAggregate=function(){this.aggregateDropDown&&C(p(this.parent.getActiveSheet().selectedRange))&&(this.aggregateDropDown.destroy(),t.remove(this.aggregateDropDown.element),this.aggregateDropDown=null)},e.prototype.addEventListener=function(){this.parent.on(qt,this.createSheetTabs,this),this.parent.on(Wt,this.refreshSheetTab,this),this.parent.on(cr,this.addSheetTab,this),this.parent.on(ur,this.removeSheetTab,this),this.parent.on(dr,this.renameSheetTab,this),this.parent.on(pr,this.switchSheetTab,this),this.parent.on(Dr,this.updateSheetTab,this),this.parent.on(kr,this.renameInputFocusOut,this),this.parent.on(je,this.removeAggregate,this),this.parent.on(rr,this.focusRenameInput,this),this.parent.on(nr,this.focusRenameInput,this)},e.prototype.destroy=function(){this.removeEventListener(),this.dropDownInstance.destroy(),this.dropDownInstance=null,this.tabInstance.destroy(),this.tabInstance=null,this.aggregateDropDown=null,this.aggregateContent=null,this.addBtnRipple(),this.addBtnRipple=null,t.EventHandler.remove(document,"mousedown touchstart",this.renameInputFocusOut);var e=document.getElementById(this.parent.element.id+"_sheet_tab_panel");e&&t.remove(e),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(qt,this.createSheetTabs),this.parent.off(Wt,this.refreshSheetTab),this.parent.off(cr,this.addSheetTab),this.parent.off(ur,this.removeSheetTab),this.parent.off(dr,this.renameSheetTab),this.parent.off(pr,this.switchSheetTab),this.parent.off(Dr,this.updateSheetTab),this.parent.off(kr,this.renameInputFocusOut),this.parent.off(je,this.removeAggregate),this.parent.off(rr,this.focusRenameInput),this.parent.off(nr,this.focusRenameInput))},e}(),en=function(){function e(e){this.parent=e,this.addEventListener(),this.renderFileUpload()}return e.prototype.addEventListener=function(){this.parent.on(Ue,this.openSuccess,this),this.parent.on(ze,this.openFailed,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Ue,this.openSuccess),this.parent.off(ze,this.openFailed))},e.prototype.renderFileUpload=function(){var e=this.parent.element.id+"_fileUpload";this.parent.element.appendChild(this.parent.createElement("input",{id:e,attrs:{type:"file",accept:".xls, .xlsx, .csv",name:"fileUpload"}}));var t=document.getElementById(e);t.onchange=this.fileSelect.bind(this),t.onerror=this.openFailed.bind(this),t.style.display="none"},e.prototype.fileSelect=function(e){var t=e.target.files[0];if(!(t&&t.length<1)){var r={file:t};this.parent.open(r),document.getElementById(this.parent.element.id+"_fileUpload").value=""}},e.prototype.openSuccess=function(e){if(["UnsupportedFile","InvalidUrl"].indexOf(e.data)>-1)return this.parent.serviceLocator.getService(dn).show({content:this.parent.serviceLocator.getService("spreadsheetLocale").getConstant(e.data),width:"300"}),void this.parent.hideSpinner();this.parent.element&&(this.parent.renderModule.refreshSheet(),this.parent.notify(Wt,this),this.parent.hideSpinner())},e.prototype.openFailed=function(e){this.parent.trigger("openFailure",e),this.parent.hideSpinner()},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"open"},e}(),tn=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(Te,this.initiateSave,this),this.parent.on(De,this.saveCompleted,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Te,this.initiateSave),this.parent.off(De,this.saveCompleted))},e.prototype.getModuleName=function(){return"save"},e.prototype.initiateSave=function(e){this.parent.showSpinner()},e.prototype.saveCompleted=function(e){this.parent.hideSpinner()},e}(),rn=function(){function e(e){this.parent=e,this.init()}return e.prototype.init=function(){this.initContextMenu(),this.addEventListener()},e.prototype.initContextMenu=function(){var e=document.createElement("ul");e.id=this.parent.element.id+"_contextmenu",this.parent.element.appendChild(e),this.contextMenuInstance=new n.ContextMenu({cssClass:"e-spreadsheet-contextmenu",target:"#"+this.parent.element.id,filter:"e-numericcontainer e-active-cell e-selection e-row e-header-row e-select-all-cell e-sheet-tabs-items",select:this.selectHandler.bind(this),beforeOpen:this.beforeOpenHandler.bind(this),beforeClose:this.beforeCloseHandler.bind(this)},e)},e.prototype.beforeCloseHandler=function(e){this.parent.trigger("contextMenuBeforeClose",e)},e.prototype.selectHandler=function(e){var r=t.extend({cancel:!1},e);if(this.parent.trigger("contextMenuItemSelect",r),!r.cancel){var n=this.parent.serviceLocator.getService(un);switch(e.item.text){case n.getConstant("Cut"):this.parent.notify("cut",{isClick:!0});break;case n.getConstant("Copy"):this.parent.notify("copy",{isClick:!0});break;case n.getConstant("Paste"):this.parent.notify(vr,{isClick:!0});break;case n.getConstant("Values"):this.parent.notify(vr,{type:"Values"});break;case n.getConstant("Formats"):this.parent.notify(vr,{type:"Formats"});break;case n.getConstant("Rename"):this.parent.notify(dr,{});break;case n.getConstant("Delete"):this.parent.notify(ur,{});break;case n.getConstant("Insert"):this.parent.notify(cr,{text:"Insert"});break;case n.getConstant("SortAscending"):this.parent.sort();break;case n.getConstant("SortDescending"):this.parent.sort({sortDescriptors:{order:"Descending"}});break;case n.getConstant("CustomSort")+"...":this.parent.notify(Or,null)}}},e.prototype.beforeOpenHandler=function(e){var r=this.getTarget(e.event.target);if(e.element.classList.contains("e-contextmenu")){var n=this.getDataSource(r);this.contextMenuInstance.items=n,this.contextMenuInstance.dataBind()}this.parent.trigger("contextMenuBeforeOpen",e),this.parent.notify(pr,t.extend(e,{target:r}))},e.prototype.getTarget=function(e){return t.closest(e,".e-main-content")?"Content":t.closest(e,".e-column-header")?"ColumnHeader":t.closest(e,".e-row-header")?"RowHeader":t.closest(e,".e-sheet-tabs-items")?"Footer":t.closest(e,".e-selectall-container")?"SelectAll":""},e.prototype.getDataSource=function(e){var t=this.parent.serviceLocator.getService(un),r=[];return"Content"===e?(this.setClipboardData(r,t),this.setSortItems(r)):"RowHeader"===e?this.setClipboardData(r,t):"ColumnHeader"===e?this.setClipboardData(r,t):"SelectAll"===e?(this.setClipboardData(r,t),this.setSortItems(r)):"Footer"===e&&(r.push({text:t.getConstant("Insert")}),r.push({text:t.getConstant("Delete"),iconCss:"e-icons e-delete"}),r.push({text:t.getConstant("Rename")})),r},e.prototype.setSortItems=function(e){var t=this.parent.serviceLocator.getService(un);this.parent.allowSorting&&e.push({text:t.getConstant("Sort"),iconCss:"e-icons e-sort-icon",items:[{text:t.getConstant("SortAscending"),iconCss:"e-icons e-sort-asc"},{text:t.getConstant("SortDescending"),iconCss:"e-icons e-sort-desc"},{text:t.getConstant("CustomSort")+"...",iconCss:"e-icons e-sort-custom"}]})},e.prototype.setClipboardData=function(e,t){this.parent.enableClipboard&&(e.push({text:t.getConstant("Cut"),iconCss:"e-icons e-cut-icon"}),e.push({text:t.getConstant("Copy"),iconCss:"e-icons e-copy-icon"}),e.push({text:t.getConstant("Paste"),iconCss:"e-icons e-paste-icon"}),e.push({text:t.getConstant("PasteSpecial"),items:[{text:t.getConstant("Values")},{text:t.getConstant("Formats")}]}))},e.prototype.addEventListener=function(){this.parent.on(br,this.addItemsHandler,this),this.parent.on(Sr,this.removeItemsHandler,this),this.parent.on(Er,this.enableItemsHandler,this)},e.prototype.addItemsHandler=function(e){e.insertAfter?this.contextMenuInstance.insertAfter(e.items,e.text,e.isUniqueId):this.contextMenuInstance.insertBefore(e.items,e.text,e.isUniqueId)},e.prototype.removeItemsHandler=function(e){this.contextMenuInstance.removeItems(e.items,e.isUniqueId)},e.prototype.enableItemsHandler=function(e){this.contextMenuInstance.enableItems(e.items,e.enable,e.isUniqueId)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(br,this.addItemsHandler),this.parent.off(Sr,this.removeItemsHandler),this.parent.off(Er,this.enableItemsHandler))},e.prototype.getModuleName=function(){return"contextMenu"},e.prototype.destroy=function(){this.removeEventListener(),this.contextMenuInstance.destroy();var e=document.getElementById(this.parent.element.id+"_contextmenu");e&&t.detach(e),this.parent=null},e}(),nn=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.refreshCellElement=function(e){var r=this.parent.getCell(e.rowIndex,e.colIndex);t.isNullOrUndefined(r)||this.parent.refreshNode(r,e)},e.prototype.addEventListener=function(){this.parent.on(Oe,this.refreshCellElement,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Oe,this.refreshCellElement)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"numberFormat"},e}(),sn=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(Ke,this.beforeSortHandler,this),this.parent.on($e,this.sortRangeAlertHandler,this),this.parent.on(Ye,this.sortCompleteHandler,this),this.parent.on(Or,this.initiateCustomSortHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Ke,this.beforeSortHandler),this.parent.off($e,this.sortRangeAlertHandler),this.parent.off(Ye,this.sortCompleteHandler),this.parent.off(Or,this.initiateCustomSortHandler))},e.prototype.getModuleName=function(){return"sort"},e.prototype.isValidSortRange=function(){var e=this.parent.getActiveSheet(),t=y(m(e.selectedRange));return!(t[0]>e.usedRange.rowIndex-1||t[1]>e.usedRange.colIndex)},e.prototype.sortRangeAlertHandler=function(e){this.parent.serviceLocator.getService(dn).show({height:180,width:400,isModal:!0,showCloseIcon:!0,content:e.error}),this.parent.hideSpinner()},e.prototype.beforeSortHandler=function(){this.parent.showSpinner()},e.prototype.sortCompleteHandler=function(e){var t=m(e.range);this.parent.serviceLocator.getService("cell").refreshRange(t),this.parent.hideSpinner()},e.prototype.initiateCustomSortHandler=function(){var e=this,r=this.parent.serviceLocator.getService(un);if(this.isValidSortRange()){var n=this.parent.serviceLocator.getService(dn);n.show({height:400,width:560,isModal:!0,showCloseIcon:!0,cssClass:"e-customsort-dlg",header:r.getConstant("CustomSort"),beforeOpen:function(){n.dialogInstance.content=e.customSortContent(),n.dialogInstance.dataBind(),e.parent.element.focus()},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0},click:function(){var r=n.dialogInstance.content,i=r.getElementsByClassName("e-list-sort e-listview e-lib")[0],s=t.getComponent(i,"listview").dataSource;e.clearError();var o=r.getElementsByClassName("e-sort-error")[0];if(o.style.display="block",!e.validateError(s,r,o)){n.hide();var a=r.getElementsByClassName("e-sort-checkheader")[0],l=t.getComponent(a,"checkbox").checked;e.parent.sort({sortDescriptors:s,containsHeader:l})}}}]})}else this.sortRangeAlertHandler({error:r.getConstant("SortOutOfRangeError")})},e.prototype.validateError=function(e,r,n){var i=this.parent.serviceLocator.getService(un);if(e.some(function(e){return""===e.field.toString()}))return Array.prototype.some.call(r.getElementsByClassName("e-sort-field"),function(e){var r=!t.getComponent(e,"dropdownlist").value;return r&&e.parentElement.classList.add("e-error"),r}),n.innerText=i.getConstant("SortEmptyFieldError"),!0;var s=new Set,o="",a="";if(e.some(function(e){return o=e.field.toString(),s.size===s.add(e.field).size})){var l=0;return Array.prototype.some.call(r.getElementsByClassName("e-sort-field"),function(e){var r=t.getComponent(e,"dropdownlist");return r.value===o&&(e.parentElement.classList.add("e-error"),a=r.text,l++),2===l}),n.innerHTML="<strong>"+a+"</strong>"+i.getConstant("SortDuplicateFieldError"),!0}return!1},e.prototype.customSortContent=function(){var e=this.parent.createElement("div",{className:"e-sort-dialog"}),r=this.getFields(),n=t.getUniqueID("customSort"),i=this.getCustomListview(n);this.setHeaderTab(e,i,r);var s=this.parent.createElement("div",{className:"e-sort-listsection",styles:""});e.appendChild(s);var o=this.parent.createElement("div",{className:"e-list-sort",styles:""});s.appendChild(o),i.createElement=this.parent.createElement,i.appendTo(o),this.renderListItem(n,i,!0,r);var a=this.parent.createElement("div",{className:"e-sort-error"});return e.appendChild(a),e},e.prototype.getFields=function(){var e=this.parent.getActiveSheet(),t=y(m(e.selectedRange));t[0]===t[2]&&t[2]-t[0]==0&&(t[0]=0,t[1]=0,t[3]=e.usedRange.colIndex);var r,n=[];for(t[1];t[1]<=t[3];t[1]++){var i=_(t[0],t[1],e);if(i&&i.value){var s={formattedText:i.value,value:i.value,format:i.format,onLoad:!0};i.format&&this.parent.notify(Ae,s),r=s.formattedText}else r="Column "+f(t[1]+1);n.push({text:r,value:"Column "+f(t[1]+1)})}return n},e.prototype.setHeaderTab=function(e,r,n){var i=this,s=this.parent.serviceLocator.getService(un),a=this.parent.createElement("div",{className:"e-sort-header",styles:"",innerHTML:""});e.appendChild(a);var l=this.parent.createElement("button",{className:"e-btn e-sort-addbtn e-flat",innerHTML:s.getConstant("AddColumn")}),h=this.parent.element.querySelector(".e-customsort-dlg .e-footer-content");h.insertBefore(l,h.firstElementChild),l.addEventListener("click",function(){if(r){var e=t.getUniqueID("customSort");r.addItem([{id:e,text:s.getConstant("ThenBy"),field:"",order:"ascending"}]),i.renderListItem(e,r,p.checked,n,!0)}});var p=new o.CheckBox({label:s.getConstant("ContainsHeader"),checked:!0,change:function(r){var i=r.checked?{text:"text",value:"value"}:{text:"value"};Array.prototype.forEach.call(e.getElementsByClassName("e-sort-field e-dropdownlist e-lib"),function(e){var r=t.getComponent(e,"dropdownlist");r.dataSource=null,r.dataSource=n,r.fields=i,r.dataBind()})},cssClass:"e-sort-headercheckbox"}),c=this.parent.createElement("input",{className:"e-sort-checkheader",attrs:{type:"checkbox"}});a.appendChild(c),p.createElement=this.parent.createElement,p.appendTo(c)},e.prototype.getCustomListview=function(e){var r=[{id:e,text:this.parent.serviceLocator.getService(un).getConstant("SortBy"),field:"",order:"ascending"}];t.enableRipple(!1);return new h.ListView({dataSource:r,fields:{id:"id"},height:"100%",template:'<div class="e-sort-listwrapper"><span class="text">${text}</span><div class="e-sort-row"><div class="e-sort-field"></div><div class="e-sort-order"><span class="e-sort-ordertxt" style="display:none;">${order}</span></div><span class="e-icons e-sort-delete"></span></div>',cssClass:"e-sort-template"})},e.prototype.deleteHandler=function(e,t){e.getElementsByClassName("e-sort-delete")[0].addEventListener("click",function(){e&&t.removeItem(e)})},e.prototype.renderListItem=function(e,t,r,n,i){var s=this,a=this.parent.serviceLocator.getService(un),h=t.element.querySelector("li[data-uid="+e+"]"),p=r?{text:"text",value:"value"}:{text:"value"},c=h.getElementsByClassName("e-sort-field")[0],u=new l.DropDownList({dataSource:n,width:"auto",fields:p,placeholder:a.getConstant("SelectAColumn"),change:function(r){r.value&&(Array.prototype.some.call(t.dataSource,function(t){return t.id===e&&(t.field=r.value),t.id===e}),s.clearError())}});u.createElement=this.parent.createElement,u.appendTo(c),i||(u.index=0);var d=h.getElementsByClassName("e-sort-order")[0],f="ascending"===d.getElementsByClassName("e-sort-ordertxt")[0].innerText.toLocaleLowerCase(),m=new o.RadioButton({label:a.getConstant("SortAscending"),name:"sortAZ_"+e,value:"ascending",checked:f,cssClass:"e-sort-radiobutton",change:function(r){s.setRadioBtnValue(t,e,r.value)}}),g=this.parent.createElement("input",{id:"orderAsc_"+e,className:"e-sort-radioasc",styles:"",attrs:{type:"radio"}});d.appendChild(g),m.createElement=this.parent.createElement,m.appendTo(g);var y=new o.RadioButton({label:a.getConstant("SortDescending"),name:"sortAZ_"+e,value:"descending",checked:!f,cssClass:"e-sort-radiobutton",change:function(r){s.setRadioBtnValue(t,e,r.value)}}),v=this.parent.createElement("input",{id:"orderDesc_"+e,className:"e-sort-radiodesc",styles:"",attrs:{type:"radio"}});d.appendChild(v),y.createElement=this.parent.createElement,y.appendTo(v),this.deleteHandler(h,t)},e.prototype.setRadioBtnValue=function(e,t,r){r&&Array.prototype.some.call(e.dataSource,function(e){return e.id===t&&(e.order=r),e.id===t})},e.prototype.clearError=function(){var e=document.getElementsByClassName("e-sort-dialog")[0],t=e.getElementsByClassName("e-sort-error")[0];"none"!==t.style.display&&""!==t.innerHTML&&(t.style.display="none",Array.prototype.forEach.call(e.getElementsByClassName("e-error"),function(e){e.classList.remove("e-error")}))},e}(),on=function(){function e(){In.Inject($r,Jr,Qr,Pr,Mr,jr,Ur,_r,Ze,en,rn,tn,nn,zr,Zr,sn)}return e.prototype.getModuleName=function(){return"basic"},e.prototype.destroy=function(){},e}(),an=function(){function e(){In.Inject($r,Jr,Qr,Pr,Mr,jr,Ur,_r,Ze,en,tn,nn,zr,Zr,sn)}return e.prototype.getModuleName=function(){return"all"},e.prototype.destroy=function(){},e}(),ln=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),hn=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},pn=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return ln(r,e),hn([t.Property(!1)],r.prototype,"isFinite",void 0),hn([t.Property(!0)],r.prototype,"enableVirtualization",void 0),r}(t.ChildProperty),cn=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return ln(r,e),hn([t.Property("Multiple")],r.prototype,"mode",void 0),r}(t.ChildProperty),un="spreadsheetLocale",dn="dialog",fn={Custom:["#ffffff","#000000","#e7e6e6","#44546a","#4472c4","#ed7d31","#a5a5a5","#ffc000","#70ad47","#ff0000","#f2f2f2","#808080","#cfcdcd","#d5dce4","#d9e2f3","#fbe4d5","#ededed","#fff2cc","#e2efd9","#ffcccc","#d9d9d9","#595959","#aeaaaa","#acb9ca","#b4c6e7","#f7caac","#dbdbdb","#ffe599","#c5e0b3","#ff8080","#bfbfbf","#404040","#747070","#8496b0","#8eaadb","#f4b083","#c9c9c9","#ffd966","#a8d08d","#ff3333","#a6a6a6","#262626","#3b3838","#323e4f","#2f5496","#c45911","#7b7b7b","#bf8f00","#538135","#b30000","#7f7f7f","#0d0d0d","#161616","#212934","#1f3763","#823b0b","#525252","#7f5f00","#375623","#660000"]},mn={Custom:["#ffffff","#000000","#ffff00","#00ff00","#00ffff","#0000ff","#ff0000","#000080","#800080","#996633","#f2f2f2","#808080","#ffffcc","#b3ffb3","#ccffff","#ccccff","#ffcccc","#ccccff","#ff80ff","#f2e6d9","#d9d9d9","#595959","#ffff80","#80ff80","#b3ffff","#8080ff","#ff8080","#8080ff","#ff00ff","#dfbf9f","#bfbfbf","#404040","#ffff33","#33ff33","#33ffff","#3333ff","#ff3333","#0000b3","#b300b3","#c68c53","#a6a6a6","#262626","#e6e600","#00b300","#009999","#000099","#b30000","#000066","#660066","#86592d","#7f7f7f","#0d0d0d","#999900","#006600","#006666","#000066","#660000","#00004d","#4d004d","#734d26"]},gn={Cut:"Cut",Copy:"Copy",Paste:"Paste",PasteSpecial:"Paste Special",All:"All",Values:"Values",Formats:"Formats",Bold:"Bold",Font:"Font",FontSize:"Font Size",Italic:"Italic",Underline:"Underline",Strikethrough:"Strikethrough",TextColor:"Text Color",FillColor:"Fill Color",HorizontalAlignment:"Horizontal Alignment",AlignLeft:"Align Left",AlignCenter:"Center",AlignRight:"Align Right",VerticalAlignment:"Vertical Alignment",AlignTop:"Align Top",AlignMiddle:"Align Middle",AlignBottom:"Align Bottom",InsertFunction:"Insert Function",Insert:"Insert",Delete:"Delete",Rename:"Rename",Hide:"Hide",Unhide:"Unhide",NameBox:"Name Box",ShowHeaders:"Show Headers",HideHeaders:"Hide Headers",ShowGridLines:"Show Gridlines",HideGridLines:"Hide Gridlines",AddSheet:"Add Sheet",ListAllSheets:"List All Sheets",FullScreen:"Full Screen",CollapseToolbar:"Collapse Toolbar",ExpandToolbar:"Expand Toolbar",CollapseFormulaBar:"Collapse Formula Bar",ExpandFormulaBar:"Expand Formula Bar",File:"File",Home:"Home",Formulas:"Formulas",View:"View",New:"New",Open:"Open",SaveAs:"Save As",ExcelXlsx:"Microsoft Excel",ExcelXls:"Microsoft Excel 97-2003",CSV:"Comma-separated values",FormulaBar:"Formula Bar",Sort:"Sort",SortAscending:"Ascending",SortDescending:"Descending",CustomSort:"Custom Sort",AddColumn:"Add Column",ContainsHeader:"Data contains header",CaseSensitive:"Case sensitive",SortBy:"Sort by",ThenBy:"Then by",SelectAColumn:"Select a column",SortEmptyFieldError:"Sort criteria column should not be empty.",SortDuplicateFieldError:" is mentioned more than once. Duplicate columns must be removed.",SortOutOfRangeError:"Select a cell or range inside the used range and try again.",Ok:"Ok",Close:"Close",Cancel:"Cancel",Apply:"Apply",MoreColors:"More Colors",StandardColors:"Standard Colors",General:"General",Number:"Number",Currency:"Currency",Accounting:"Accounting",ShortDate:"Short Date",LongDate:"Long Date",Time:"Time",Percentage:"Percentage",Fraction:"Fraction",Scientific:"Scientific",Text:"Text",MobileFormulaBarPlaceHolder:"Enter value or Formula",NumberFormat:"Number Format",PasteAlert:"You can't paste this here, because the copy area and paste area aren't in the same size. Please try pasting in a different range.",DestroyAlert:"Are you sure you want to destroy the current workbook without saving and create a new workbook?",SheetRenameInvalidAlert:"Sheet name contains invalid character.",SheetRenameEmptyAlert:"Sheet name cannot be empty.",SheetRenameAlreadyExistsAlert:"Sheet name already exists. Please enter another name.",DeleteSheetAlert:"Are you sure you want to delete this sheet?",DeleteSingleLastSheetAlert:"A Workbook must contain at least one visible worksheet.",PickACategory:"Pick a category",Description:"Description",UnsupportedFile:"Unsupported File",InvalidUrl:"Invalid URL",SUM:"Adds a series of numbers and/or cells.",SUMIF:"Adds the cells based on specified condition.",SUMIFS:"Adds the cells based on specified conditions.",ABS:"Returns the value of a number without its sign.",RAND:"Returns a random number between 0 and 1.",RANDBETWEEN:"Returns a random integer based on specified values.",FLOOR:"Rounds a number down to the nearest multiple of a given factor.",CEILING:"Rounds a number up to the nearest multiple of a given factor.",PRODUCT:"Multiplies a series of numbers and/or cells.",AVERAGE:"Calculates average for the series of numbers and/or cells excluding text.",AVERAGEIF:"Calculates average for the cells based on specified criterion.",AVERAGEIFS:"Calculates average for the cells based on specified conditions.",AVERAGEA:"Calculates the average for the cells evaluating TRUE as 1, text and FALSE as 0.",COUNT:"Counts the cells that contain numeric values in a range.",COUNTIF:"Counts the cells based on specified condition.",COUNTIFS:"Counts the cells based on specified conditions.",COUNTA:"Counts the cells that contains values in a range.",MIN:"Returns the smallest number of the given arguments.",MAX:"Returns the largest number of the given arguments.",DATE:"Returns the date based on given year, month, and day.",DAY:"Returns the day from the given date.",DAYS:"Returns the number of days between two dates.",IF:"Returns value based on the given expression.",IFS:"Returns value based on the given multiple expressions.",AND:"Returns TRUE if all the arguments are TRUE, otherwise returns FALSE.",OR:"Returns TRUE if any of the arguments are TRUE, otherwise returns FALSE.",IFERROR:"Returns value if no error found else it will return specified value.",CHOOSE:"Returns a value from list of values, based on index number.",INDEX:"Returns a value of the cell in a given range based on row and column number.",FIND:"Returns the position of a string within another string, which is case sensitive",CONCATENATE:"Combines two or more strings together.",CONCAT:"Concatenates a list or a range of text strings.",SUBTOTAL:"Returns subtotal for a range using the given function number.",RADIANS:"Converts degrees into radians.",MATCH:"Returns the relative position of a specified value in given range.",DefineNameExists:"This name already exists, try different name.",CircularReference:"When a formula refers to one or more circular references, this may result in an incorrect calculation."},yn=function(){function e(e){this.freezePane=!1,this.colGroupWidth=30,this.parent=e,this.col=e.createElement("col"),this.rowRenderer=e.serviceLocator.getService("row"),this.cellRenderer=e.serviceLocator.getService("cell")}return e.prototype.refreshSelectALLContent=function(){var e;if(this.freezePane){var t=this.getSelectAllTable().querySelector("thead"),r=this.rowRenderer.render();t.appendChild(r),e=this.parent.createElement("th",{className:"e-select-all-cell"}),r.appendChild(e)}else(e=this.headerPanel.firstElementChild).classList.add("e-select-all-cell");e.appendChild(this.parent.createElement("button",{className:"e-selectall e-icons",id:this.parent.element.id+"_select_all"}))},e.prototype.updateLeftColGroup=function(e,t){e&&(this.colGroupWidth=e),t||(t=this.getRowHeaderPanel());var r=t.querySelector("table");this.detachColGroup(r);var n=this.parent.createElement("colgroup"),i=this.colGroupWidth+"px",s=this.col.cloneNode();s.style.width=i,n.appendChild(s),r.insertBefore(n,r.querySelector("tbody")),t.style.width=i,this.freezePane?(r=this.getSelectAllTable(),this.detachColGroup(r),r.insertBefore(n.cloneNode(!0),r.querySelector("thead"))):this.getSelectAllContent().style.width=i,this.parent.getActiveSheet().showHeaders&&(this.getColHeaderPanel().style.width="calc(100% - "+i+")",this.getContentPanel().style.width="calc(100% - "+i+")")},e.prototype.detachColGroup=function(e){var r=e.querySelector("colgroup");r&&t.detach(r)},e.prototype.renderPanel=function(){this.contentPanel=this.parent.createElement("div",{className:"e-main-panel"});var e=this.parent.getActiveSheet(),t=this.parent.element.id;e.showHeaders?(this.contentPanel.appendChild(this.parent.createElement("div",{className:"e-row-header",id:t+"_row_header"})),this.initHeaderPanel(),this.parent.scrollModule.setPadding()):this.updateHideHeaders();var r=this.contentPanel.appendChild(this.parent.createElement("div",{className:"e-main-content",id:t+"_main_content"}));e.showGridLines||r.classList.add("e-hide-gridlines"),this.parent.allowScrolling||(r.style.overflow="hidden")},e.prototype.initHeaderPanel=function(){var e=this.parent.element.id;this.headerPanel=this.parent.createElement("div",{className:"e-header-panel"}),this.headerPanel.appendChild(this.parent.createElement("div",{className:"e-selectall-container",id:e+"_selectall"})),this.headerPanel.appendChild(this.parent.createElement("div",{className:"e-column-header",id:e+"_col_header"}))},e.prototype.createTable=function(){this.parent.getActiveSheet().showHeaders&&this.createHeaderTable(),this.updateTable("tbody","content",this.contentPanel.lastElementChild)},e.prototype.createHeaderTable=function(e){void 0===e&&(e=this.contentPanel.querySelector(".e-row-header")),this.freezePane&&this.updateTable("thead","selectall",this.headerPanel.querySelector(".e-selectall-container")),this.updateTable("thead","colhdr",this.headerPanel.querySelector(".e-column-header")),this.updateTable("tbody","rowhdr",e),this.updateLeftColGroup(null,e)},e.prototype.updateTable=function(e,t,r){var n=this.parent.createElement("table",{className:"e-table",attrs:{role:"grid"}});n.classList.add("e-"+t+"-table"),r.appendChild(n),n.appendChild(this.parent.createElement(e))},e.prototype.renderTable=function(e,r,n,i,s,o){var a,l,h=this,c=this.parent.getActiveSheet(),u=document.createDocumentFragment();this.createTable();var d,f,m,g=this.parent.createElement("colgroup"),y=this.contentPanel.querySelector(".e-main-content tbody");c.showHeaders&&(u.appendChild(this.headerPanel),this.refreshSelectALLContent(),d=this.contentPanel.querySelector(".e-row-header tbody"),f=this.headerPanel.querySelector(".e-column-header thead"),this.getColHeaderTable().insertBefore(g,f),m=this.rowRenderer.render(),f.appendChild(m)),u.appendChild(this.contentPanel),this.parent.notify(ir,{startColIdx:n});var v=c.colCount.toString(),C=c.colCount.toString();c.showHeaders&&(this.parent.getColHeaderTable().setAttribute("aria-colcount",v),this.parent.getRowHeaderTable().setAttribute("aria-rowcount",C)),t.attributes(this.parent.getContentTable(),{"aria-rowcount":C,"aria-colcount":v}),e.forEach(function(e,t){(a=p(t))[0]===r&&(h.updateCol(a[1],g,c),c.showHeaders&&m.appendChild(h.cellRenderer.renderColHeader(a[1]))),a[1]===n&&(c.showHeaders&&(l=h.rowRenderer.render(a[0],!0),d.appendChild(l),l.appendChild(h.cellRenderer.renderRowHeader(a[0]))),l=h.rowRenderer.render(a[0]),y.appendChild(l)),l.appendChild(h.cellRenderer.render({colIdx:a[1],rowIdx:a[0],cell:e,address:t,lastCell:a[1]===i,isHeightCheckNeeded:!0}))}),this.getContentTable().insertBefore(g.cloneNode(!0),y),oe(function(){var e=h.parent.getMainContent();document.getElementById(h.parent.element.id+"_sheet").appendChild(u),s&&(e.scrollTop=s,c.showHeaders&&(h.parent.getRowHeaderContent().scrollTop=s)),o&&(e.scrollLeft=o,c.showHeaders&&(h.parent.getColumnHeaderContent().scrollLeft=o)),h.parent.notify(Xt,null),h.parent.notify(Jt,{action:"renderEditor"}),h.parent.isOpen||h.parent.hideSpinner(),xe(h.parent.getMainContent(),{busy:!1}),h.parent.trigger("dataBound",{})})},e.prototype.refreshColumnContent=function(e,t,r,n){var i,s,o,a=this,l=0,h=this.parent.getActiveSheet(),c=document.createDocumentFragment(),u=document.createDocumentFragment(),d=this.parent.element.querySelector(".e-main-content tbody");d=c.appendChild(d.cloneNode(!0));var f=this.parent.element.querySelector(".e-main-content colgroup");f=f.cloneNode();var m,g;h.showHeaders&&(u.appendChild(f),g=this.parent.element.querySelector(".e-column-header thead"),g=u.appendChild(g.cloneNode(!0)),(m=g.querySelector("tr")).innerHTML=""),e.forEach(function(e,n){if((i=p(n))[0]===t&&(a.updateCol(i[1],f,h),h.showHeaders&&m.appendChild(a.cellRenderer.renderColHeader(i[1]))),i[1]===r){if(!(s=d.children[l]))return;l++,s.innerHTML=""}s.appendChild(a.cellRenderer.render({colIdx:i[1],rowIdx:i[0],cell:e,address:n}))}),c.insertBefore(f.cloneNode(!0),d),oe(function(){h.showHeaders&&(ae(o=a.getColHeaderTable()),o.appendChild(u)),ae(o=a.getContentTable()),o.appendChild(c),a.parent.notify(or,{refresh:"Column"}),a.parent.isOpen||a.parent.hideSpinner(),xe(a.parent.getMainContent(),{busy:!1})})},e.prototype.refreshRowContent=function(e,r,n){var i,s,o,a,l,h=this,c=this.colGroupWidth,u=this.parent.getActiveSheet(),d=document.createDocumentFragment(),f=this.parent.createElement("tbody");u.showHeaders&&(a=document.createDocumentFragment(),l=f.cloneNode(),a.appendChild(l)),d.appendChild(f),e.forEach(function(e,t){(i=p(t))[1]===r&&(u.showHeaders&&(o=h.rowRenderer.render(i[0],!0),l.appendChild(o),o.appendChild(h.cellRenderer.renderRowHeader(i[0])),c=le(i[0]+1)),s=h.rowRenderer.render(i[0]),f.appendChild(s)),s.appendChild(h.cellRenderer.render({rowIdx:i[0],colIdx:i[1],cell:e,address:t,lastCell:i[1]===n,row:s,hRow:o,isHeightCheckNeeded:!0}))}),oe(function(){h.parent.isDestroyed||(h.colGroupWidth!==c&&h.updateLeftColGroup(c),u.showHeaders&&(t.detach(h.contentPanel.querySelector(".e-row-header tbody")),h.getRowHeaderTable().appendChild(a)),t.detach(h.contentPanel.querySelector(".e-main-content tbody")),h.getContentTable().appendChild(d),h.parent.notify(or,{refresh:"Row"}),h.parent.isOpen||h.parent.hideSpinner(),xe(h.parent.getMainContent(),{busy:!1}))})},e.prototype.updateCol=function(e,r,n){var i=this.col.cloneNode();i.style.width=t.formatUnit(W(n,e)),r.appendChild(i)},e.prototype.updateColContent=function(e,r,n,i,s){var o=this;oe(function(){var a,l,h,c,u,d,f,m,g=0,y=o.parent.getActiveSheet();y.showHeaders&&(d=o.parent.element.querySelector(".e-column-header .e-header-row"),m=d.firstElementChild);var v=o.parent.element.querySelector(".e-main-content colgroup"),C=v.firstElementChild,b=o.parent.element.querySelector(".e-main-content tbody");e.forEach(function(e,h){(a=p(h))[0]===r&&("first"===s?(o.updateCol(a[1],v,y),y.showHeaders&&d.appendChild(o.cellRenderer.renderColHeader(a[1]))):((f=o.col.cloneNode()).style.width=t.formatUnit(W(y,a[1])),v.insertBefore(f,C),y.showHeaders&&d.insertBefore(o.cellRenderer.renderColHeader(a[1]),m)),o.parent.scrollSettings.enableVirtualization&&(t.detach(v[s+"ElementChild"]),y.showHeaders&&t.detach(d[s+"ElementChild"]))),a[1]===n&&(l=b.children[g],g++,c=l.firstElementChild),u=o.cellRenderer.render({colIdx:a[1],rowIdx:a[0],cell:e,address:h,lastCell:a[1]===i,isHeightCheckNeeded:"first"===s}),"first"===s?l.appendChild(u):l.insertBefore(u,c),o.parent.scrollSettings.enableVirtualization&&t.detach(l[s+"ElementChild"])}),y.showHeaders&&(h=o.getColHeaderTable(),t.detach(h.querySelector("colgroup")),h.insertBefore(v.cloneNode(!0),h.querySelector("thead"))),o.parent.scrollSettings.enableVirtualization&&o.parent.notify(or,{refresh:"Column"}),o.parent.isOpen||o.parent.hideSpinner(),xe(o.parent.getMainContent(),{busy:!1})})},e.prototype.updateRowContent=function(e,r,n,i){var s,o,a,l,h=this,c=this.colGroupWidth,u=this.parent.getActiveSheet(),d=this.parent.getMainContent().querySelector("tbody");u.showHeaders&&(l=document.createDocumentFragment(),a=this.parent.getRowHeaderContent().querySelector("tbody"));var f,m=document.createDocumentFragment();this.parent.showSpinner(),e.forEach(function(e,g){(f=p(g))[1]===r&&(u.showHeaders&&(o=h.rowRenderer.render(f[0],!0),l.appendChild(o),o.appendChild(h.cellRenderer.renderRowHeader(f[0])),c=le(f[0]+1),h.parent.scrollSettings.enableVirtualization&&t.detach(a[i+"ElementChild"])),s=h.rowRenderer.render(f[0]),m.appendChild(s),h.parent.scrollSettings.enableVirtualization&&t.detach(d[i+"ElementChild"])),s.appendChild(h.cellRenderer.render({colIdx:f[1],rowIdx:f[0],cell:e,address:g,lastCell:f[1]===n,row:s,hRow:o,isHeightCheckNeeded:"first"===i}))}),oe(function(){h.colGroupWidth!==c&&h.updateLeftColGroup(c),"first"===i?(u.showHeaders&&a.appendChild(l),d.appendChild(m)):(u.showHeaders&&a.insertBefore(l,a.firstElementChild),d.insertBefore(m,d.firstElementChild)),h.parent.scrollSettings.enableVirtualization&&h.parent.notify(or,{refresh:"Row"}),h.parent.isOpen||h.parent.hideSpinner(),xe(h.parent.getMainContent(),{busy:!1})})},e.prototype.showHideHeaders=function(){var e=this,r=this.parent.getActiveSheet();if(r.showHeaders)if(this.parent.scrollSettings.enableVirtualization){var n=[this.parent.viewport.topIndex,this.parent.viewport.leftIndex];this.renderHeaders([n[0],n[0]+this.parent.viewport.rowCount+2*this.parent.getThreshold("row")],[n[1],n[1]+this.parent.viewport.colCount+2*this.parent.getThreshold("col")])}else this.renderHeaders([0,r.rowCount-1],[0,r.colCount-1]),"A1"!==r.topLeftCell&&this.parent.goTo(r.topLeftCell);else oe(function(){t.detach(e.headerPanel),t.detach(e.getRowHeaderPanel()),e.getContentPanel().style.width="",e.updateHideHeaders()})},e.prototype.renderHeaders=function(e,t){var r=this;this.initHeaderPanel();var n=document.createDocumentFragment(),i=document.createDocumentFragment();n.appendChild(this.headerPanel);var s=i.appendChild(this.parent.createElement("div",{className:"e-row-header",id:this.parent.element.id+"_row_header"}));this.createHeaderTable(s),this.parent.notify(Fr,{element:s}),this.refreshSelectALLContent();var o=s.querySelector("tbody"),a=this.headerPanel.querySelector(".e-column-header thead"),l=this.rowRenderer.render();a.appendChild(l);for(var h,p=t[0];p<=t[1];p++)l.appendChild(this.cellRenderer.renderColHeader(p));var c=le(e[1]);this.colGroupWidth!==c&&this.updateLeftColGroup(c,s);for(p=e[0];p<=e[1];p++)(h=this.rowRenderer.render(p,!0)).appendChild(this.cellRenderer.renderRowHeader(p)),o.appendChild(h);oe(function(){r.getColHeaderTable().insertBefore(r.getContentTable().querySelector("colgroup").cloneNode(!0),a);var e=document.getElementById(r.parent.element.id+"_sheet");e.classList.remove("e-hide-headers"),e.insertBefore(n,r.contentPanel);var t=r.getContentPanel();r.contentPanel.insertBefore(i,t),r.parent.scrollModule.setPadding(),s.scrollTop=t.scrollTop,r.getColHeaderPanel().scrollLeft=t.scrollLeft})},e.prototype.updateHideHeaders=function(){document.getElementById(this.parent.element.id+"_sheet").classList.add("e-hide-headers"),this.headerPanel=null},e.prototype.getSelectAllContent=function(){return this.headerPanel.getElementsByClassName("e-selectall-container")[0]},e.prototype.getSelectAllTable=function(){return this.headerPanel.getElementsByClassName("e-selectall-table")[0]},e.prototype.getColHeaderTable=function(){return this.headerPanel.getElementsByClassName("e-colhdr-table")[0]},e.prototype.getRowHeaderTable=function(){return this.contentPanel.getElementsByClassName("e-rowhdr-table")[0]},e.prototype.getContentTable=function(){return this.contentPanel.getElementsByClassName("e-content-table")[0]},e.prototype.getRowHeaderPanel=function(){return this.contentPanel.getElementsByClassName("e-row-header")[0]},e.prototype.getColHeaderPanel=function(){return this.headerPanel.getElementsByClassName("e-column-header")[0]},e.prototype.getContentPanel=function(){return this.contentPanel.getElementsByClassName("e-main-content")[0]},e}(),vn=function(){function e(e){this.parent=e,this.element=this.parent.createElement("tr",{attrs:{role:"row"}})}return e.prototype.render=function(e,r){var n=this.element.cloneNode();if(void 0===e)return n.classList.add("e-header-row"),n;n.classList.add("e-row");var i=this.parent.getActiveSheet();return t.attributes(n,{"aria-rowindex":(e+1).toString()}),n.style.height=j(i,e)+"px",n},e}(),Cn=function(){function e(e){this.parent=e,this.element=this.parent.createElement("td"),this.th=this.parent.createElement("th",{className:"e-header-cell"})}return e.prototype.renderColHeader=function(e){var r=this.th.cloneNode();return t.attributes(r,{role:"columnheader","aria-colindex":(e+1).toString(),tabindex:"-1"}),r.innerHTML=f(e+1),r},e.prototype.renderRowHeader=function(e){var r=this.element.cloneNode();return t.addClass([r],"e-header-cell"),t.attributes(r,{role:"rowheader",tabindex:"-1"}),r.innerHTML=(e+1).toString(),r},e.prototype.render=function(e){var r=this.element.cloneNode();return r.className="e-cell",t.attributes(r,{role:"gridcell","aria-colindex":(e.colIdx+1).toString(),tabindex:"-1"}),this.updateCell(e.rowIdx,e.colIdx,r,e.cell,e.lastCell,e.row,e.hRow,e.isHeightCheckNeeded),this.parent.trigger("beforeCellRender",{cell:e.cell,element:r,address:e.address}),r},e.prototype.updateCell=function(e,r,n,i,s,o,a,l,h){if(i&&i.formula&&!i.value){var p=H(i.formula),c={action:"refreshCalculate",value:i.formula,rowIndex:e,colIndex:r,isFormula:p};this.parent.notify(Me,c)}var d={type:i&&D(i.format),value:i&&i.value,format:i&&i.format?i.format:"General",formattedText:i&&i.value,onLoad:!0,isRightAlign:!1,cell:i};i&&this.parent.notify(Ae,d),n.textContent=n?d.formattedText:"",this.parent.refreshNode(n,{type:d.type,result:d.formattedText,curSymbol:t.getNumberDependable(this.parent.locale,"USD"),isRightAlign:d.isRightAlign,value:d.value||""});var f={};i&&i.style&&(f=i.style.properties?B(i.style,!0):i.style),Object.keys(f).length||Object.keys(this.parent.commonCellStyle).length||s?h?(this.removeStyle(n),this.parent.notify(Re,{style:f,range:u(e,r)})):this.parent.notify(He,{style:t.extend({},this.parent.commonCellStyle,f),rowIdx:e,colIdx:r,cell:n,lastCell:s,row:o,hRow:a,isHeightCheckNeeded:l,manualUpdate:!1}):h&&this.removeStyle(n)},e.prototype.removeStyle=function(e){e.style.length&&e.removeAttribute("style")},e.prototype.refreshRange=function(e){var t=this.parent.getActiveSheet(),r=e.slice();if(ue(this.parent,r,!0))for(var n=r[0];n<=r[2];n++)for(var i=r[1];i<=r[3];i++)this.updateCell(n,i,this.parent.getCell(n,i),_(n,i,t),!1,null,null,!0,!0)},e}(),bn=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.render=function(){this.parent.isMobileView()||(this.parent.notify(Ut,null),this.parent.notify(zt,null));var e=this.parent.createElement("div",{id:this.parent.element.id+"_sheet_panel",className:"e-sheet-panel"});this.parent.enableRtl&&e.classList.add("e-rtl"),this.parent.element.appendChild(e),this.parent.notify(qt,null),this.parent.isMobileView()&&(this.parent.notify(zt,null),this.parent.notify(Ut,null)),this.setSheetPanelSize(),this.renderSheet(e),this.checkTopLeftCell()},e.prototype.checkTopLeftCell=function(){var e=this.parent.getActiveSheet();if(this.parent.scrollSettings.enableVirtualization&&"A1"!==e.topLeftCell){var t=c(e.topLeftCell),r=t[0]?z(e,0,t[0]-1):0,n=t[1]?G(e,0,t[1]-1):0;this.parent.notify(Nr,{scrollLeft:n,scrollTop:r,preventScroll:!0});var i=this.parent.getThreshold("row"),s=t[0]>i?t[0]-i:0;i=this.parent.getThreshold("col");var o=t[1]>i?t[1]-i:0;this.refreshUI({rowIndex:s,colIndex:o,refresh:"All",top:r,left:n})}else this.refreshUI()},e.prototype.renderSheet=function(e){void 0===e&&(e=document.getElementById(this.parent.element.id+"_sheet_panel")),e.appendChild(this.parent.createElement("div",{className:"e-sheet",id:this.parent.element.id+"_sheet"})),this.parent.serviceLocator.getService("sheet").renderPanel()},e.prototype.refreshUI=function(e,t){void 0===e&&(e={rowIndex:0,colIndex:0,refresh:"All"});var r=this.parent.serviceLocator.getService("sheet"),n=this.parent.getActiveSheet(),i=ie(this.parent);this.parent.showSpinner(),t||(t=this.parent.scrollSettings.enableVirtualization?this.getAddress(e.rowIndex,e.colIndex):"A1:"+u(n.rowCount-1,n.colCount-1)),"All"===e.refresh&&this.parent.trigger("beforeDataBound",{}),xe(this.parent.getMainContent(),{busy:!0}),this.parent.getData(i+"!"+t).then(function(n){var i=c(t.split(":")[1])[1];switch(e.refresh){case"All":r.renderTable(n,e.rowIndex,e.colIndex,i,e.top,e.left);break;case"Row":r.refreshRowContent(n,e.colIndex,i);break;case"Column":r.refreshColumnContent(n,e.rowIndex,e.colIndex,i);break;case"RowPart":r.updateRowContent(n,e.colIndex,i,e.direction);break;case"ColumnPart":r.updateColContent(n,e.rowIndex,e.colIndex,i,e.direction)}}),this.parent.notify(sr,{refresh:e.refresh})},e.prototype.removeSheet=function(){t.remove(document.getElementById(this.parent.element.id+"_sheet"))},e.prototype.refreshSheet=function(){this.removeSheet(),this.renderSheet(),this.parent.notify(Tr,{}),this.checkTopLeftCell()},e.prototype.getAddress=function(e,t){var r=this.parent.getActiveSheet(),n=e+this.parent.viewport.rowCount+2*this.parent.getThreshold("row"),i=r.rowCount-1;this.parent.scrollSettings.isFinite&&n>i&&(n=i);var s=t+this.parent.viewport.colCount+2*this.parent.getThreshold("col");return i=r.colCount-1,this.parent.scrollSettings.isFinite&&s>i&&(s=i),u(e,t)+":"+u(n,s)},e.prototype.setSheetPanelSize=function(){var e,t=document.getElementById(this.parent.element.id+"_sheet_panel"),r=this.parent.element.getBoundingClientRect();"auto"===this.parent.height?(t.style.height="260px",e=230):(e=r.height-pe(t),t.style.height=e+"px",e-=30),this.parent.viewport.height=e,this.parent.viewport.width=r.width,this.parent.viewport.rowCount=this.roundValue(e,20),this.parent.viewport.colCount=this.roundValue(r.width,64)},e.prototype.roundValue=function(e,t){var r=e/t,n=Math.round(r);return Math.abs(r-n)<.5?n:n-1},e.prototype.instantiateRenderer=function(){this.parent.serviceLocator.register("row",new vn(this.parent)),this.parent.serviceLocator.register("cell",new Cn(this.parent)),this.parent.serviceLocator.register("sheet",new yn(this.parent))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(Kt,this.instantiateRenderer,this),this.parent.on(Gt,this.refreshSheet,this),this.parent.on($t,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.off(Kt,this.instantiateRenderer),this.parent.off(Gt,this.refreshSheet),this.parent.off($t,this.destroy)},e}(),Sn=function(){function e(){this.services={}}return e.prototype.getService=function(e){if(t.isNullOrUndefined(this.services[e]))throw"The service "+e+" is not registered";return this.services[e]},e.prototype.register=function(e,r){t.isNullOrUndefined(this.services[e])&&(this.services[e]=r)},e}(),En=function(){function e(e){this.parent=e}return e.prototype.show=function(e){var r,n=this,i=e.close||null,o={header:"Spreadsheet",cssClass:this.parent.cssClass,target:this.parent.element,buttons:[]};e.close=function(){n.dialogInstance.destroy(),t.remove(n.dialogInstance.element),n.dialogInstance=null,i&&i()},t.extend(o,e),r=this.parent.serviceLocator.getService(un).getConstant(o.buttons.length?"Cancel":"Ok"),o.buttons.push({buttonModel:{content:r,isPrimary:0===o.buttons.length},click:this.hide.bind(this)});var a=this.parent.createElement("div");document.body.appendChild(a),this.dialogInstance=new s.Dialog(o),this.dialogInstance.createElement=this.parent.createElement,this.dialogInstance.appendTo(a)},e.prototype.hide=function(){this.dialogInstance.hide()},e.prototype.destroy=function(){this.parent=null},e}(),xn=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),wn=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},In=function(e){function r(t,r){var i=e.call(this,t)||this;return i.isOpen=!1,i.isEdit=!1,i.viewport={rowCount:0,colCount:0,height:0,topIndex:0,leftIndex:0,width:0},i.needsID=!0,n.Inject($r,Jr,Qr,Pr,Mr,jr,Ur,_r,Ze,en,rn,tn,nn,zr,Zr,yt,Qe,rt,gt,Je,ft,sn,mt,qr),r&&i.appendTo(r),i}xn(r,e),n=r,r.prototype.getCell=function(e,t){this.scrollSettings.enableVirtualization&&(t-=this.viewport.leftIndex);var r=this.getRow(e);return r?r.cells[t]:r},r.prototype.getRow=function(e,t){return this.scrollSettings.enableVirtualization&&(e-=this.viewport.topIndex),(t=t||this.getContentTable())?t.rows[e]:null},r.prototype.preRender=function(){e.prototype.preRender.call(this),this.serviceLocator=new Sn,this.initServices()},r.prototype.initServices=function(){this.serviceLocator.register(un,new t.L10n(this.getModuleName(),gn,this.locale)),this.serviceLocator.register(dn,new En(this))},r.prototype.render=function(){e.prototype.render.call(this),this.element.setAttribute("tabindex","0"),xe(this.element,{role:"grid"}),this.renderModule=new bn(this),this.notify(Kt,null),this.renderSpreadsheet(),this.wireEvents()},r.prototype.renderSpreadsheet=function(){this.cssClass&&t.addClass([this.element],this.cssClass.split(" ")),this.setHeight(),this.setWidth(),s.createSpinner({target:this.element},this.createElement),this.isMobileView()&&-1===this.cssClass.indexOf("e-mobile-view")&&this.element.classList.add("e-mobile-view"),this.sheetModule=this.serviceLocator.getService("sheet"),this.allowScrolling&&(this.scrollModule=new Br(this)),this.scrollSettings.enableVirtualization&&new Vr(this),this.renderModule.render()},r.prototype.showSpinner=function(){s.showSpinner(this.element)},r.prototype.hideSpinner=function(){s.hideSpinner(this.element)},r.prototype.goTo=function(e){var t=p(e),r=this.getMainContent(),n=this.getActiveSheet();r.scrollTop=t[0]?z(n,0,t[0]-1):0,r.scrollLeft=t[1]?G(n,0,t[1]-1):0},r.prototype.resize=function(){this.renderModule.setSheetPanelSize(),this.scrollSettings.enableVirtualization&&this.renderModule.refreshSheet()},r.prototype.cut=function(e){this.notify("cut",e?{range:m(e),sId:this.sheets[$(this,Z(e))].id}:null)},r.prototype.copy=function(e){this.notify("copy",e?{range:m(e),sId:this.sheets[$(this,Z(e))].id}:null)},r.prototype.paste=function(e,t){this.notify(vr,{range:m(e),sIdx:$(this,Z(e)),type:t})},r.prototype.setHeight=function(){this.height.toString().indexOf("%")>-1&&(this.element.style.minHeight="400px"),this.element.style.height=t.formatUnit(this.height)},r.prototype.setWidth=function(){(this.width.toString().indexOf("%")>-1||"auto"===this.width)&&(this.element.style.minWidth="300px"),this.element.style.width=t.formatUnit(this.width)},r.prototype.setPanelSize=function(){if("auto"!==this.height){var e=document.getElementById(this.element.id+"_sheet_panel");e.style.height=this.element.getBoundingClientRect().height-pe(e)+"px"}},r.prototype.open=function(t){this.isOpen=!0,e.prototype.open.call(this,t),this.isOpen&&this.showSpinner()},r.prototype.getRowHeaderContent=function(){return this.sheetModule.getRowHeaderPanel()},r.prototype.getColumnHeaderContent=function(){return this.sheetModule.getColHeaderPanel()},r.prototype.getMainContent=function(){return this.sheetModule.getContentPanel()},r.prototype.getContentTable=function(){return this.sheetModule.getContentTable()},r.prototype.getRowHeaderTable=function(){return this.sheetModule.getRowHeaderTable()},r.prototype.getColHeaderTable=function(){return this.sheetModule.getColHeaderTable()},r.prototype.getThreshold=function(e){var t=Math.round((this.viewport[e+"Count"]+1)/2);return t<15?15:t},r.prototype.isMobileView=function(){return(this.cssClass.indexOf("e-mobile-view")>-1||t.Browser.isDevice)&&-1===this.cssClass.indexOf("e-desktop-view")&&!1},r.prototype.getValueRowCol=function(t,r,n){return e.prototype.getValueRowCol.call(this,t,r,n)},r.prototype.updateCell=function(t,r){r=r||this.getActiveSheet().activeCell,e.prototype.updateCell.call(this,t,r),this.serviceLocator.getService("cell").refreshRange(m(r)),this.notify(je,{})},r.prototype.sort=function(t,r){var n=this;if(!this.allowSorting)return Promise.reject();var i={range:r=r||this.getActiveSheet().selectedRange,sortOptions:t=t||{sortDescriptors:{}},cancel:!1};return this.trigger(Ke,i),i.cancel?Promise.reject():(this.notify(Ke,null),e.prototype.sort.call(this,i.sortOptions,i.range).then(function(e){return n.notify(Ye,e),n.trigger(Ye,e),Promise.resolve(e)}).catch(function(e){return n.notify($e,{error:e}),Promise.reject(e)}))},r.prototype.setValueRowCol=function(t,r,n,i){if("circular reference: "===r){var s={action:"isCircularReference",argValue:r};this.notify(Zt,s),r=s.argValue}e.prototype.setValueRowCol.call(this,t,r,n,i),t=J(this,t),this.notify(Jt,{action:"refreshDependentCellValue",rowIdx:n,colIdx:i,sheetIdx:t})},r.prototype.getModuleName=function(){return"spreadsheet"},r.prototype.setRowHeight=function(e,t,r){var n=c(this.getActiveSheet().activeCell)[0],i=this.element.querySelector(".e-main-content .e-table"),s=this.element.querySelector(".e-row-header .e-table");if(i.rows[t].style.height=r+"px",s.rows[t].style.height=r+"px",U(this.sheets[e-1],t,r),n===t)fe([{element:this.element.getElementsByClassName("e-selection")[0],attrs:{height:r+"px"}}]);else{var o=P(this.getActiveSheet(),[n,0,n,0]);fe([{element:this.element.getElementsByClassName("e-selection")[0],attrs:{top:o.top+"px"}}])}},r.prototype.refreshNode=function(e,r){var n,i=e.querySelector(".e-"+this.element.id+"_currency"),s="e-right-align";if(r){if(r.result=t.isNullOrUndefined(r.result)?"":r.result.toString(),i&&t.detach(i),"Accounting"===r.type&&F(r.value))return e.textContent=r.result.split(r.curSymbol).join(""),e.appendChild(this.createElement("span",{className:"e-"+this.element.id+"_currency",innerHTML:" "+r.curSymbol,styles:"float: left"})),void e.classList.add(s);!r.result||"true"!==r.result.toLowerCase()&&"false"!==r.result.toLowerCase()||(r.result=r.result.toUpperCase(),s="e-center-align",r.isRightAlign=!0),n=r.result,r.isRightAlign?e.classList.add(s):e.classList.remove(s)}if(n=t.isNullOrUndefined(n)?"":n,!t.isNullOrUndefined(e)){var o=e.lastChild;!o||3!==o.nodeType&&1!==o.nodeType?e.appendChild(document.createTextNode(n)):o.nodeValue=n}},r.prototype.mouseClickHandler=function(e){this.notify("click",e)},r.prototype.mouseDownHandler=function(e){this.notify(Yt,e)},r.prototype.keyUpHandler=function(e){this.notify(er,e)},r.prototype.keyDownHandler=function(e){this.notify(tr,e)},r.prototype.wireEvents=function(){t.EventHandler.add(this.element,"click",this.mouseClickHandler,this),t.EventHandler.add(this.element,me(),this.mouseDownHandler,this),t.EventHandler.add(this.element,"keyup",this.keyUpHandler,this),t.EventHandler.add(this.element,"keydown",this.keyDownHandler,this),t.EventHandler.add(this.element,"noderefresh",this.refreshNode,this)},r.prototype.destroy=function(){this.unwireEvents(),this.notify($t,null),e.prototype.destroy.call(this),this.element.innerHTML="",this.element.removeAttribute("tabindex"),this.element.removeAttribute("role"),this.element.style.removeProperty("height"),this.element.style.removeProperty("width"),this.element.style.removeProperty("min-height"),this.element.style.removeProperty("min-width")},r.prototype.unwireEvents=function(){t.EventHandler.remove(this.element,"click",this.mouseClickHandler),t.EventHandler.remove(this.element,me(),this.mouseDownHandler),t.EventHandler.remove(this.element,"keyup",this.keyUpHandler),t.EventHandler.remove(this.element,"keydown",this.keyDownHandler),t.EventHandler.remove(this.element,"noderefresh",this.refreshNode)},r.prototype.addContextMenuItems=function(e,t,r,n){void 0===r&&(r=!0),this.notify(br,{items:e,text:t,insertAfter:r,isUniqueId:n})},r.prototype.removeContextMenuItems=function(e,t){this.notify(Sr,{items:e,isUniqueId:t})},r.prototype.enableContextMenuItems=function(e,t,r){void 0===t&&(t=!0),this.notify(Er,{items:e,enable:t,isUniqueId:r})},r.prototype.selectRange=function(e){this.notify(yr,p(e))},r.prototype.startEdit=function(){this.notify(Jt,{action:"startEdit",isNewValueEdit:!1})},r.prototype.closeEdit=function(){this.notify(Jt,{action:"cancelEdit"})},r.prototype.endEdit=function(){this.notify(Jt,{action:"endEdit"})},r.prototype.onPropertyChanged=function(r,n){e.prototype.onPropertyChanged.call(this,r,n);for(var i=0,s=Object.keys(r);i<s.length;i++){switch(s[i]){case"enableRtl":r.enableRtl?document.getElementById(this.element.id+"_sheet_panel").classList.add("e-rtl"):document.getElementById(this.element.id+"_sheet_panel").classList.remove("e-rtl");break;case"cssClass":n.cssClass&&t.removeClass([this.element],n.cssClass.split(" ")),r.cssClass&&t.addClass([this.element],r.cssClass.split(" "));break;case"activeSheetTab":this.renderModule.refreshSheet(),this.notify(Dr,{idx:r.activeSheetTab-1});break;case"width":this.setWidth(),this.resize();break;case"height":this.setHeight(),this.resize();break;case"showRibbon":this.notify(Ut,{uiUpdate:!0});break;case"showFormulaBar":this.notify(zt,{uiUpdate:!0});break;case"showSheetTabs":this.notify(qt,null);break;case"cellStyle":this.renderModule.refreshSheet()}}},r.prototype.requiredModules=function(){return se(this)},r.prototype.appendTo=function(t){e.prototype.appendTo.call(this,t)};var n;return wn([t.Property("")],r.prototype,"cssClass",void 0),wn([t.Property(!0)],r.prototype,"allowScrolling",void 0),wn([t.Property(!0)],r.prototype,"allowResizing",void 0),wn([t.Property(!0)],r.prototype,"enableClipboard",void 0),wn([t.Property(!0)],r.prototype,"enableContextMenu",void 0),wn([t.Property(!0)],r.prototype,"enableKeyboardNavigation",void 0),wn([t.Property(!0)],r.prototype,"enableKeyboardShortcut",void 0),wn([t.Complex({},cn)],r.prototype,"selectionSettings",void 0),wn([t.Complex({},pn)],r.prototype,"scrollSettings",void 0),wn([t.Event()],r.prototype,"beforeCellRender",void 0),wn([t.Event()],r.prototype,"beforeSelect",void 0),wn([t.Event()],r.prototype,"select",void 0),wn([t.Event()],r.prototype,"contextMenuBeforeOpen",void 0),wn([t.Event()],r.prototype,"fileMenuBeforeOpen",void 0),wn([t.Event()],r.prototype,"contextMenuBeforeClose",void 0),wn([t.Event()],r.prototype,"fileMenuBeforeClose",void 0),wn([t.Event()],r.prototype,"contextMenuItemSelect",void 0),wn([t.Event()],r.prototype,"fileItemSelect",void 0),wn([t.Event()],r.prototype,"beforeDataBound",void 0),wn([t.Event()],r.prototype,"dataBound",void 0),wn([t.Event()],r.prototype,"cellEdit",void 0),wn([t.Event()],r.prototype,"cellEditing",void 0),wn([t.Event()],r.prototype,"cellSave",void 0),wn([t.Event()],r.prototype,"created",void 0),wn([t.Event()],r.prototype,"beforeSort",void 0),wn([t.Event()],r.prototype,"sortComplete",void 0),r=n=wn([t.NotifyPropertyChanges],r)}(jt);e.Workbook=jt,e.RangeSetting=Ht,e.UsedRange=_t,e.Sheet=Mt,e.getSheetIndex=$,e.getSheetIndexFromId=J,e.getSheetNameFromAddress=Z,e.updateSelectedRange=Q,e.getSelectedRange=function(e){return e&&e.selectedRange||"A1"},e.getSheet=ee,e.getSheetNameCount=te,e.getMaxSheetId=re,e.initSheet=ne,e.getSheetName=ie,e.Row=Dt,e.getRow=V,e.setRow=function(e,t,r){e.rows[t]||(e.rows[t]={}),Object.keys(r).forEach(function(n){e.rows[t][n]=r[n]})},e.getRowHeight=j,e.setRowHeight=U,e.getRowsHeight=z,e.Column=Ot,e.getColumn=q,e.getColumnWidth=W,e.getColumnsWidth=G,e.Cell=Ft,e.getCell=_,e.setCell=M,e.getCellPosition=P,e.skipDefaultValue=B,e.getData=K,e.getModel=function(e,r){var n,i,s;if(t.isUndefined(e[r])||!e[r]||e[r].index!==r)for(var o=0;o<=r;o++)if(e&&e[o]){if((n=e[o].index-o)>0){for(e.forEach(function(e,t){e&&e.index&&(s=e.index,i=1),e&&!e.index&&0!==t&&(e.index=s+i),i++});n--;)e.splice(o,0,null);o+=n}}else e?e[o]=null:e=[];return e[r]},e.processIdx=X,e.clearRange=Y,e.getRangeIndexes=p,e.getCellIndexes=c,e.getCellAddress=u,e.getRangeAddress=d,e.getColumnHeaderText=f,e.getIndexesFromAddress=m,e.getRangeFromAddress=g,e.getSwapRange=y,e.isSingleCell=C,e.executeTaskAsync=b,e.WorkbookBasicModule=vt,e.WorkbookAllModule=Ct,e.getWorkbookRequiredModules=L,e.CellStyle=Et,e.DefineName=xt,e.workbookDestroyed=Fe,e.workbookOpen=Ne,e.beginSave=Te,e.saveCompleted=De,e.applyNumberFormatting=ke,e.getFormattedCellObject=Ae,e.refreshCellElement=Oe,e.setCellFormat=Re,e.textDecorationUpdate=Le,e.applyCellFormat=He,e.updateUsedRange=_e,e.workbookFormulaOperation=Me,e.workbookEditOperation=Pe,e.checkDateFormat=Be,e.getFormattedBarText=Ve,e.activeCellChanged=je,e.openSuccess=Ue,e.openFailure=ze,e.sheetCreated=qe,e.sheetsDestroyed=We,e.aggregateComputation=Ge,e.beforeSort=Ke,e.initiateSort=Xe,e.sortComplete=Ye,e.sortRangeAlert=$e,e.checkIsFormula=H,e.toFraction=S,e.getGcd=E,e.intToDate=x,e.dateToInt=w,e.isDateTime=I,e.isNumber=F,e.toDate=N,e.DataBind=Ze,e.WorkbookOpen=Qe,e.WorkbookSave=rt,e.WorkbookFormula=ft,e.WorkbookNumberFormat=Je,e.getFormatFromType=T,e.getTypeFromFormat=D,e.WorkbookSort=mt,e.WorkbookCellFormat=gt,e.WorkbookEdit=yt,e.getRequiredModules=se,e.ribbon=Ut,e.formulaBar=zt,e.sheetTabs=qt,e.refreshSheetTabs=Wt,e.dataRefresh=Gt,e.initialLoad=Kt,e.contentLoaded=Xt,e.mouseDown=Yt,e.spreadsheetDestroyed=$t,e.editOperation=Jt,e.formulaOperation=Zt,e.formulaBarOperation=Qt,e.click="click",e.keyUp=er,e.keyDown=tr,e.formulaKeyUp="formulaKeyUp",e.formulaBarUpdate="formulaBarUpdate",e.onVerticalScroll=rr,e.onHorizontalScroll=nr,e.beforeContentLoaded=ir,e.beforeVirtualContentLoaded=sr,e.virtualContentLoaded=or,e.contextMenuOpen="contextMenuOpen",e.cellNavigate=ar,e.mouseUpAfterSelection=lr,e.selectionComplete=hr,e.cMenuBeforeOpen=pr,e.addSheetTab=cr,e.removeSheetTab=ur,e.renameSheetTab=dr,e.ribbonClick=fr,e.refreshRibbon="ribbonRefresh",e.enableRibbonItems=mr,e.tabSwitch=gr,e.selectRange=yr,e.cut="cut",e.copy="copy",e.paste=vr,e.clearCopy=Cr,e.dataBound="dataBound",e.beforeDataBound="beforeDataBound",e.addContextMenuItems=br,e.removeContextMenuItems=Sr,e.enableContextMenuItems=Er,e.beforeRibbonCreate=xr,e.rowHeightChanged=wr,e.colWidthChanged=Ir,e.beforeHeaderLoaded=Fr,e.onContentScroll=Nr,e.deInitProperties=Tr,e.activeSheetChanged=Dr,e.renameSheet=kr,e.enableToolbar=Ar,e.initiateCustomSort=Or,e.getUpdateUsingRaf=oe,e.removeAllChildren=ae,e.getColGroupWidth=le,e.getScrollBarWidth=he,e.getSiblingsHeight=pe,e.inView=ue,e.locateElem=de,e.setStyleAttribute=fe,e.getStartEvent=me,e.getMoveEvent=ge,e.getEndEvent=ye,e.isTouchStart=ve,e.isTouchMove=Ce,e.isTouchEnd=be,e.getClientX=Se,e.getClientY=Ee,e.setAriaOptions=xe,e.destroyComponent=we,e.BasicModule=on,e.AllModule=an,e.ScrollSettings=pn,e.SelectionSettings=cn,e.DISABLED="e-disabled",e.locale=un,e.dialog=dn,e.fontColor=fn,e.fillColor=mn,e.defaultLocale=gn,e.Spreadsheet=In,e.Clipboard=_r,e.Edit=Mr,e.Selection=Pr,e.Scroll=Br,e.VirtualScroll=Vr,e.KeyboardNavigation=jr,e.KeyboardShortcut=Ur,e.CellFormat=zr,e.Resize=qr,e.Ribbon=$r,e.FormulaBar=Jr,e.Formula=Zr,e.SheetTabs=Qr,e.Open=en,e.Save=tn,e.ContextMenu=rn,e.NumberFormat=nn,e.Sort=sn,e.Render=bn,e.SheetRender=yn,e.RowRenderer=vn,e.CellRenderer=Cn,e.Calculate=ht,e.FormulaError=pt,e.FormulaInfo=ct,e.CalcSheetFamilyItem=ut,e.getAlphalabel=R,e.ValueChangedArgs=dt,e.Parser=ot,e.CalculateCommon=nt,e.isUndefined=function(e){return void 0===e},e.getModules=k,e.getValue=A,e.setValue=O,e.ModuleLoader=it,e.BasicFormulas=st,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ej2-spreadsheet.umd.min.js.map
